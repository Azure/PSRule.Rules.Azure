{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"","title":"Home"},{"location":"CHANGELOG-v0/","text":"Change log # v0.19.0 # What's changed since v0.18.0: New features: Added Azure.GA_2020_12 baseline. #593 Includes rules released before or during December 2020 for Azure GA features. Marked baseline Azure.GA_2020_09 as obsolete. New rules: Database for MySQL: Check database servers meet name requirements. #583 Database for PostgreSQL: Check database servers meet name requirements. #583 SQL Database: Check SQL logical servers meet name requirements. #583 Check SQL failover groups meet name requirements. #583 Check SQL databases meet name requirements. #583 SQL Managed Instance: Check SQL Managed Instances meet name requirements. #583 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.19.3. #590 General improvements: Added support for true , false , and null template functions. #579 Added support for createObject template function. #580 Engineering: Bump PSRule dependency to v1.0.0. #588 What's changed since pre-release v0.19.0-B2012008: New features: Added Azure.GA_2020_12 baseline. #593 Includes rules released before or during December 2020 for Azure GA features. Marked baseline Azure.GA_2020_09 as obsolete. v0.19.0-B2012008 (pre-release) # What's changed since pre-release v0.19.0-B2011008: Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.19.3. #590 Engineering: Bump PSRule dependency to v1.0.0. #588 v0.19.0-B2011008 (pre-release) # What's changed since v0.18.0: New rules: Database for MySQL: Check database servers meet name requirements. #583 Database for PostgreSQL: Check database servers meet name requirements. #583 SQL Database: Check SQL logical servers meet name requirements. #583 Check SQL failover groups meet name requirements. #583 Check SQL databases meet name requirements. #583 SQL Managed Instance: Check SQL Managed Instances meet name requirements. #583 General improvements: Added support for true , false , and null template functions. #579 Added support for createObject template function. #580 v0.18.0 # What's changed since v0.17.0: New rules: Container Registry: Check registries use container image scanning. #558 Check registries image scanning results are healthy. #558 Check registries use content trust. #558 Check registries are geo-replicated. #558 Check registries uses storage space less than included storage. #558 Check registries have a retention set of untagged manifests (preview). #558 Check registries use image quarantine pattern (preview). #558 Front Door: Check Front Door WAF policy name requirements. #552 Bug fixes: Fixed HNS storage accounts so they are excluded from blob soft delete rule. #554 Fixed reason typo on template parameter metadata. #567 Fixed Get-AzRuleTemplateLink reports incorrect parameter with file path. #568 Fixed variable property not resolved with copy peer. #571 Fixed blob soft delete for FileStorage storage accounts. #573 Fixed top level variable copy detected as unused variable. #569 Fixed ResourceGroupName property cannot be found on this object. #561 What's changed since pre-release v0.18.0-B2011023: No additional changes. v0.18.0-B2011023 (pre-release) # What's changed since pre-release v0.18.0-B2011005: Bug fixes: Fixed reason typo on template parameter metadata. #567 Fixed Get-AzRuleTemplateLink reports incorrect parameter with file path. #568 Fixed variable property not resolved with copy peer. #571 Fixed blob soft delete for FileStorage storage accounts. #573 Fixed top level variable copy detected as unused variable. #569 v0.18.0-B2011005 (pre-release) # What's changed since pre-release v0.18.0-B2010016: Bug fixes: Fixed ResourceGroupName property cannot be found on this object. #561 v0.18.0-B2010016 (pre-release) # What's changed since v0.17.0: New rules: Container Registry: Check registries use container image scanning. #558 Check registries image scanning results are healthy. #558 Check registries use content trust. #558 Check registries are geo-replicated. #558 Check registries uses storage space less than included storage. #558 Check registries have a retention set of untagged manifests (preview). #558 Check registries use image quarantine pattern (preview). #558 Front Door: Check Front Door WAF policy name requirements. #552 Bug fixes: Fixed HNS storage accounts so they are excluded from blob soft delete rule. #554 v0.17.0 # What's changed since v0.16.0: New rules: Azure Cache for Redis: Check cache instances use Standard C1 or greater SKU. #501 Cache cache instances configure maxmemory-reserved setting. #502 App Configuration: Check App Configuration stores meet name requirements. #528 Check App Configuration stores use standard SKU. #528 App Service: Check App Service apps use HTTP/2. #538 Check App Service apps use managed identities. #537 Check App Service apps use Always On. #521 Check App Service apps have remote debugging disabled. #521 Check App Service apps use newer .NET Framework versions. #521 Check App Service apps use newer PHP runtime versions. #521 Logic App: Check Logic App apps limit IP range for HTTP triggers. #526 Updated rules: Storage: Updated Azure.Storage.UseReplication for additional use cases. Added support for geo-zone-redundant storage. #535 Exclude storage tagged with resource-usage = 'azure-functions' or resource-usage = 'azure-monitor' . #534 Azure Kubernetes Service: Promote Azure.AKS.AzurePolicyAddOn to GA rule set. #524 Removed rules: Azure Kubernetes Service: Remove Azure.AKS.PodSecurityPolicy as this AKS feature is replaced by Azure Policy. #523 General improvements: Added support for providers template function. #177 Added support for dateTimeAdd template function. #516 Bug fixes: Fixed expansion of templates with multiple variables copy blocks. #541 Fixed App Service rule site config false positives in templates. #533 What's changed since pre-release v0.17.0-B2010028: No additional changes. v0.17.0-B2010028 (pre-release) # What's changed since pre-release v0.17.0-B2010022: New rules: Azure Cache for Redis: Check cache instances use Standard C1 or greater SKU. #501 Cache cache instances configure maxmemory-reserved setting. #502 v0.17.0-B2010022 (pre-release) # What's changed since pre-release v0.17.0-B2010017: Bug fixes: Fixed expansion of templates with multiple variables copy blocks. #541 v0.17.0-B2010017 (pre-release) # What's changed since pre-release v0.17.0-B2010006: New rules: App Service: Check App Service apps use HTTP/2. #538 Check App Service apps use managed identities. #537 Updated rules: Storage: Updated Azure.Storage.UseReplication for additional use cases. Added support for geo-zone-redundant storage. #535 Exclude storage tagged with resource-usage = 'azure-functions' or resource-usage = 'azure-monitor' . #534 Bug fixes: Fixed App Service rule site config false positives in templates. #533 v0.17.0-B2010006 (pre-release) # What's changed since pre-release v0.17.0-B2009009: New rules: App Configuration: Check App Configuration stores meet name requirements. #528 Check App Configuration stores use standard SKU. #528 App Service: Check App Service apps use Always On. #521 Check App Service apps have remote debugging disabled. #521 Check App Service apps use newer .NET Framework versions. #521 Check App Service apps use newer PHP runtime versions. #521 Logic App: Check Logic App apps limit IP range for HTTP triggers. #526 Updated rules: Azure Kubernetes Service: Promote Azure.AKS.AzurePolicyAddOn to GA rule set. #524 Removed rules: Azure Kubernetes Service: Remove Azure.AKS.PodSecurityPolicy as this AKS feature is replaced by Azure Policy. #523 v0.17.0-B2009009 (pre-release) # What's changed since v0.16.0: General improvements: Added support for providers template function. #177 Added support for dateTimeAdd template function. #516 v0.16.0 # What's changed since v0.15.0: New features: Added Azure.GA_2020_09 baseline. #488 Includes rules released before or during September 2020 for Azure GA features. Marked baseline Azure.GA_2020_06 as obsolete. New rules: CDN: Check CDN endpoint naming requirements. #486 Check CDN endpoints use TLS 1.2. #487 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.18.8. #504 General improvements: Updated rule content to align with Microsoft Azure Well-Architected Framework pillars. #481 Improve output of template processing exceptions. #484 Engineering: Bump PSRule dependency to v0.20.0. Bug fixes: Fixed Data Factory version not detected with template. #498 Fixed parameter file detection with 2019-04-01 schema. #495 Fixed deprecated $Rule properties. #491 What's changed since pre-release v0.16.0-B2009033: No additional changes. v0.16.0-B2009033 (pre-release) # What's changed since pre-release v0.16.0-B2009024: New features: Added Azure.GA_2020_09 baseline. #488 Includes rules released before or during September 2020 for Azure GA features. Marked baseline Azure.GA_2020_06 as obsolete. Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.18.8. #504 Engineering: Bump PSRule dependency to v0.20.0. v0.16.0-B2009024 (pre-release) # What's changed since pre-release v0.16.0-B2009019: Bug fixes: Fixed Data Factory version not detected with template. #498 v0.16.0-B2009019 (pre-release) # What's changed since pre-release v0.16.0-B2009011: Bug fixes: Fixed parameter file detection with 2019-04-01 schema. #495 v0.16.0-B2009011 (pre-release) # What's changed since pre-release v0.16.0-B2009004: Bug fixes: Fixed deprecated $Rule properties. #491 v0.16.0-B2009004 (pre-release) # What's changed since v0.15.0: New rules: CDN: Check CDN endpoint naming requirements. #486 Check CDN endpoints use TLS 1.2. #487 General improvements: Updated rule content to align with Microsoft Azure Well-Architected Framework pillars. #481 Improve output of template processing exceptions. #484 v0.15.0 # What's changed since v0.14.1: New rules: All resources: Check ARM template parameters are used. #232 Check ARM template variables are used. #233 Check ARM template parameters include a metadata description. #360 Check ARM templates define at least one resource. #359 Database for MySQL: Check database servers reject TLS versions older than 1.2. #469 Database for PostgreSQL: Check database servers reject TLS versions older than 1.2. #470 SQL Database: Check database servers reject TLS versions older than 1.2. #471 Storage Account: Check Storage Accounts reject TLS versions older than 1.2. #455 Check Storage Accounts only accept authorized requests. #456 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.17.9. #452 Engineering: Bump PSRule dependency to v0.19.0. Bug fixes: Fixed export of non-blob Storage Accounts. #464 Fixed export of subscription Security Center data based on API version. #465 Fixed masking of sharedKey when property does not exist. #466 What's changed since pre-release v0.15.0-B2008034: No additional changes. v0.15.0-B2008043 (pre-release) # What's changed since pre-release v0.15.0-B2008034: New rules: Database for MySQL: Check database servers reject TLS versions older than 1.2. #469 Database for PostgreSQL: Check database servers reject TLS versions older than 1.2. #470 SQL Database: Check database servers reject TLS versions older than 1.2. #471 Bug fixes: Fixed use variables check when no variables are defined. #462 v0.15.0-B2008034 (pre-release) # What's changed since pre-release v0.15.0-B2008026: Bug fixes: Fixed export of non-blob Storage Accounts. #464 Fixed export of subscription Security Center data based on API version. #465 Fixed masking of sharedKey when property does not exist. #466 v0.15.0-B2008026 (pre-release) # What's changed since v0.14.1: New rules: All resources: Check ARM template parameters are used. #232 Check ARM template variables are used. #233 Check ARM template parameters include a metadata description. #360 Check ARM templates define at least one resource. #359 Storage Account: Check Storage Accounts reject TLS versions older than 1.2. #455 Check Storage Accounts only accept authorized requests. #456 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.17.9. #452 v0.14.1 # What's changed since v0.14.0: Bug fixes: Fixed resource tags rule to exclude diagnostic settings. #448 v0.14.0 # What's changed since v0.13.0: New rules: API Management: Check API Management service name requirements. #437 Check API Management products have legal terms. #438 Check API Management products have a display name and description. #439 Check API Management APIs have a display name and description. #440 Subscriptions: Check subscription is managed by PIM. #422 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.17.7. #427 General improvements: Updated rule reasons and logic. #424 Bug fixes: Fixed masking for network connection resource configuration. #434 Fixed hybrid use benefit rule to exclude Windows client OSs. #433 Fixed VM standalone rule to exclude Windows client OSs. #442 What's changed since pre-release v0.14.0-B2007031: No additional changes. v0.14.0-B2007031 (pre-release) # What's changed since pre-release v0.14.0-B2007020: New rules: API Management: Check API Management service name requirements. #437 Check API Management products have legal terms. #438 Check API Management products have a display name and description. #439 Check API Management APIs have a display name and description. #440 Bug fixes: Fixed masking for network connection resource configuration. #434 Fixed hybrid use benefit rule to exclude Windows client OSs. #433 Fixed VM standalone rule to exclude Windows client OSs. #442 v0.14.0-B2007020 (pre-release) # What's changed since v0.13.0: New rules: Subscriptions: Check subscription is managed by PIM. #422 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.17.7. #427 General improvements: Updated rule reasons and logic. #424 v0.13.0 # What's changed since v0.12.1: New features: Added Azure.GA_2020_06 baseline. #399 Includes rules released before or during June 2020 for Azure GA features. New rules: Azure Kubernetes Service: Check AKS clusters use a Standard load balancer SKU. #334 Check AKS clusters use Managed Identities for cluster infrastructure. #333 Check AKS clusters use Azure Policy add-on (preview). #405 Public IP: Check Public IP domain name label requirements. #389 Virtual Machines: Check Availability Set name requirements. #387 Check Computer name requirements. #387 Check Managed Disk name requirements. #387 Check Network Interface name requirements. #387 Check Virtual Machine name requirements. #387 Check Proximity Placement Group name requirements. #387 Virtual Machine Scale Sets: Check Computer name requirements. #387 Check Virtual Machine Scale Set name requirements. #387 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.16.9. #394 Bug fixes: Fixed module default culture. #390 Fixed exception message for object property that does not exist. #362 Fixed substring raises an exception processing sub expressions. #413 What's changed since pre-release v0.13.0-B2006032: Bug fixes: Fixed substring raises an exception processing sub expressions. #413 v0.13.0-B2006032 (pre-release) # New features: Added Azure.GA_2020_06 baseline. #399 Includes rules released before or during June 2020 for Azure GA features. Bug fixes: Fixed exception message for object property that does not exist. #362 v0.13.0-B2006023 (pre-release) # New rules: Public IP: Check Public IP domain name label requirements. #389 Virtual Machines: Check Availability Set name requirements. #387 Check Computer name requirements. #387 Check Managed Disk name requirements. #387 Check Network Interface name requirements. #387 Check Virtual Machine name requirements. #387 Check Proximity Placement Group name requirements. #387 Virtual Machine Scale Sets: Check Computer name requirements. #387 Check Virtual Machine Scale Set name requirements. #387 v0.13.0-B2006017 (pre-release) # New rules: Azure Kubernetes Service: Check AKS clusters use a Standard load balancer SKU. #334 Check AKS clusters use Managed Identities for cluster infrastructure. #333 Check AKS clusters use Azure Policy add-on (preview). #405 v0.13.0-B2006003 (pre-release) # Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.16.9. #394 Bug fixes: Fixed module default culture. #390 v0.12.1 # What's changed since v0.12.0: Bug fixes: Fixed subnet name check for VNET with no subnets. #386 v0.12.0 # What's changed since v0.11.0: New rules: Azure Kubernetes Service: Check AKS cluster name requirements. #373 Check AKS cluster DNS prefix requirements. #373 Container Registry: Check registry name requirements. #373 Front Door: Check Front Door name requirements. #373 Load Balancer: Check Load Balancer name requirements. #373 Network Security Group: Check NSG name requirements. #373 Public IP: Check Public IP name requirements. #373 Policy: Check Policy definitions use descriptive fields. #364 Resource Group: Check Resource Group name requirements. #373 Route table Check Route table name requirements. #373 SignalR Service: Check SignalR Service name requirements. #373 SQL Database: Check SQL Database uses TDE. #379 Check SQL Database uses AAD authentication. #378 Storage Account: Check Storage Account name requirements. #373 Check Storage blob containers use private access type. #365 Virtual Network: Check VNET name requirements. #373 Check VNET subnet name requirements. #373 Virtual Network Gateway: Check VNG name requirements. #373 Check VNG connection name requirements. #373 Check ExpressRoute Gateway uses current SKU. #369 Check VPN Gateway uses current SKU. #370 Check VPN Gateway uses active-active configuration. #371 What's changed since pre-release v0.12.0-B2005026: No additional changes. v0.12.0-B2005026 (pre-release) # New rules: SQL Database: Check SQL Database uses TDE. #379 Check SQL Database uses AAD authentication. #378 Bug fixes: Fixed handling of subnet sub-resource name with slash. #381 v0.12.0-B2005019 (pre-release) # New rules: Azure Kubernetes Service: Check AKS cluster name requirements. #373 Check AKS cluster DNS prefix requirements. #373 Container Registry: Check registry name requirements. #373 Front Door: Check Front Door name requirements. #373 Load Balancer: Check Load Balancer name requirements. #373 Network Security Group: Check NSG name requirements. #373 Public IP: Check Public IP name requirements. #373 Resource Group: Check Resource Group name requirements. #373 Route table Check Route table name requirements. #373 SignalR Service: Check SignalR Service name requirements. #373 Storage Account: Check Storage Account name requirements. #373 Virtual Network: Check VNET name requirements. #373 Check VNET subnet name requirements. #373 Virtual Network Gateway: Check VNG name requirements. #373 Check VNG connection name requirements. #373 Check ExpressRoute Gateway uses current SKU. #369 Check VPN Gateway uses current SKU. #370 Check VPN Gateway uses active-active configuration. #371 v0.12.0-B2005005 (pre-release) # New rules: Storage Account: Check Storage blob containers use private access type. #365 Policy: Check Policy definitions use descriptive fields. #364 v0.11.0 # What's changed since v0.10.1: New rules: Azure Kubernetes Service: Check AKS nodes use a minimum number of pods. #274 API Management: Check API Management products require a subscription. #342 Check API Management products require approval. #343 Check API Management sample products have been removed. #344 Check API Management uses a managed identity. #345 Check API Management certificates are not expired. #346 General improvements: Added name and type bindings for template files. #353 Breaking change : Renamed configuration options to use a standard prefix. #327 Configuration options use the Azure_ prefix. Update configuration settings to use the new name, old configuration names are ignored. Renamed minAKSVersion to Azure_AKSMinimumVersion . Renamed azureAllowedRegions to Azure_AllowedRegions . Added configuration option documentation. See about_PSRule_Azure_Configuration for details. What's changed since pre-release v0.11.0-B2004012: General improvements: Added name and type bindings for template files. #353 v0.11.0-B2004012 (pre-release) # New rules: Azure Kubernetes Service: Check AKS nodes use a minimum number of pods. #274 General improvements: Breaking change : Renamed configuration options to use a standard prefix. #327 Configuration options use the Azure_ prefix. Update configuration settings to use the new name, old configuration names are ignored. Renamed minAKSVersion to Azure_AKSMinimumVersion . Renamed azureAllowedRegions to Azure_AllowedRegions . Added configuration option documentation. See about_PSRule_Azure_Configuration for details. v0.11.0-B2004005 (pre-release) # New rules: API Management: Check API Management products require a subscription. #342 Check API Management products require approval. #343 Check API Management sample products have been removed. #344 Check API Management uses a managed identity. #345 Check API Management certificates are not expired. #346 v0.10.1 # What's changed since v0.10.0: Bug fixes: Fixed false positive for unused public IP in templates. #336 Fixed false positive for use of managed disks in templates. #337 Fixed false positive for disk caching when no VM data disks is null in templates. #338 v0.10.0 # What's changed since v0.9.0: New features: Added support for linking parameter and template files for analysis with metadata. #324 Added Get-AzRuleTemplateLink cmdlet to get metadata link to template files. See cmdlet help for usage. Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.16.7. #330 General improvements: Removed warning message for azureAllowedRegions option. #328 Improvements to verbose logging of Export-AzRuleData . #301 Bug fixes: Fixed unused VM resource false positives in templates. #312 Fixed handling SKU for accelerated networking. #314 Fixed detection of hybrid use benefit in templates. #313 Fixed exception message when a template or parameter file is not found. #316 Fixed detection of diagnostic logging for Front Door. #307 Fixed Front Door WAF Policy export. #308 Fixed union of object properties in templates. #303 What's changed since pre-release v0.10.0-B2003051: No additional changes. v0.10.0-B2003051 (pre-release) # New features: Added support for linking parameter and template files for analysis with metadata. #324 Added Get-AzRuleTemplateLink cmdlet to get metadata link to template files. See cmdlet help for usage. General improvements: Removed warning message for azureAllowedRegions option. #328 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.16.7. #330 v0.10.0-B2003032 (pre-release) # Bug fixes: Fixed unused VM resource false positives in templates. #312 Fixed handling SKU for accelerated networking. #314 Fixed detection of hybrid use benefit in templates. #313 Fixed exception message when a template or parameter file is not found. #316 v0.10.0-B2003004 (pre-release) # Bug fixes: Fixed detection of diagnostic logging for Front Door. #307 Fixed Front Door WAF Policy export. #308 v0.10.0-B2002023 (pre-release) # General improvements: Improvements to verbose logging of Export-AzRuleData . #301 Bug fixes: Fixed union of object properties in templates. #303 v0.9.0 # What's changed since v0.8.0: New rules: Azure Firewall: Check threat intelligence is configured as deny. #266 Front Door: Check Front Door is enabled. #267 Check Front Door uses TLS 1.2. #268 Check Front Door has a configured WAF policy. #269 Check Front Door WAF policy is configured in prevention mode. #271 Check Front Door WAF policy is enabled. #270 Check if diagnostic logs are configured. #289 Traffic Manager: Check web-based endpoints are monitored with HTTPS. #240 Check at least two endpoints are enabled. #241 Key Vault: Check soft delete is enabled. #277 Check purge protection is enabled. #280 Check least privileges permissions assigned in access policy. #281 Check if diagnostic logs are configured. #288 Subscriptions: Check if service health alerts are configured. #290 Updated rules: Exclude cloud shell storage accounts from data rules. #278 Azure.Storage.UseReplication and Azure.Storage.SoftDelete ignore cloud shell storage accounts. General improvements: Removed module dependency on Az.Security . #105 Bug fixes: Fixed incorrect string formatting in POSIX culture. #262 Fixed Azure.VNET.UseNSGs to exclude AzureFirewallSubnet . #261 What's changed since pre-release v0.9.0-B2002036: No additional changes. v0.9.0-B2002036 (pre-release) # Exclude cloud shell storage accounts from data rules. #278 Added new rule for Subscriptions: Check if service health alerts are configured. #290 Added new rule for Key Vault: Check if diagnostic logs are configured. #288 Added new rule for Front Door: Check if diagnostic logs are configured. #289 Removed module dependency on Az.Security . #105 v0.9.0-B2002026 (pre-release) # Added new rules for Traffic Manager: Check web-based endpoints are monitored with HTTPS. #240 Check at least two endpoints are enabled. #241 Added new rules for Key Vault: Check soft delete is enabled. #277 Check purge protection is enabled. #280 Check least privileges permissions assigned in access policy. #281 v0.9.0-B2002019 (pre-release) # Added new rule to check Azure Firewall threat intelligence is configured as deny. #266 Added new rules for Front Door: Check Front Door is enabled. #267 Check Front Door uses TLS 1.2. #268 Check Front Door has a configured WAF policy. #269 Check Front Door WAF policy is configured in prevention mode. #271 Check Front Door WAF policy is enabled. #270 v0.9.0-B2002011 (pre-release) # Fixed incorrect string formatting in POSIX culture. #262 Fixed Azure.VNET.UseNSGs to exclude AzureFirewallSubnet . #261 v0.8.0 # What's changed since v0.7.0: New rules: API Management: Check API Management uses secure protocol versions. #237 Check API Management published APIs use HTTPS. #236 Check API Management backend connections use HTTPS. #238 Check API Management named values are encrypted. #239 Automation Accounts: Check automation accounts use encrypted variables. #211 Check automation account webhook expiry interval. #212 CDN: Check Azure CDN connections use HTTPS. #242 Resource Manager Templates: Check ARM template and parameter file structure. #225 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.15.7. #247 Virtual networks: Updated Azure.VNET.UseNSGs to apply to subnet resources from templates. #246 General improvements: Improvements to rule help wording and usage of links section. #220 #224 #257 Documentation and reasons messages are now available for all en cultures. Various updates to rule implementation to take advantage of PSRule v0.12.0 language features. #220 Breaking change : Shorten rule names to improve output display. #119 Application Gateway rules have been renamed from Azure.VirtualNetwork.* to Azure.AppGW.* . Load balancer rules have been renamed from Azure.VirtualNetwork.* to Azure.LB.* . NSG rules have been renamed from Azure.VirtualNetwork.* to Azure.NSG.* . VNET rules have been renamed from Azure.VirtualNetwork.* to Azure.VNET.* . NIC rules have been renamed from Azure.VirtualNetwork.* to Azure.VM.* . Renamed storage account rule Azure.Storage.SecureTransferRequired to Azure.Storage.SecureTransfer . Bug fixes: Fix Azure.Resource.UseTags applying to template and parameter files. #230 What's changed since pre-release v0.8.0-B2001029: Fixed Azure.VNET.UseNSGs not populating subnet name in reason message. #256 Updated reason strings to use parent culture en . #257 v0.8.0-B2001029 (pre-release) # Updated Azure.VNET.UseNSGs to apply to subnet resources from templates. #246 Updated Azure.AKS.Version to 1.15.7. #247 Breaking change : Renamed Azure.File.* rules to Azure.Template.* . #252 v0.8.0-B2001018 (pre-release) # Fixed Azure.Resource.UseTags applying to template and parameter files. #230 Fixed ARM template and parameter schemas used to detect files. #234 Added new rule to check API Management uses secure protocol versions. #237 Added new rule to check API Management published APIs use HTTPS. #236 Added new rule to check API Management backend connections use HTTPS. #238 Added new rule to check API Management named values are encrypted. #239 Added new rule to check Azure CDN connections use HTTPS. #242 v0.8.0-B2001006 (pre-release) # Updated documentation to use parent culture en . #224 Added rules for ARM template and parameter file structure. #225 Breaking change : Application Gateway rules have been renamed from Azure.VirtualNetwork.* to Azure.AppGW.* . #119 Breaking change : Load balancer rules have been renamed from Azure.VirtualNetwork.* to Azure.LB.* . #119 Breaking change : NSG rules have been renamed from Azure.VirtualNetwork.* to Azure.NSG.* . #119 Breaking change : VNET rules have been renamed from Azure.VirtualNetwork.* to Azure.VNET.* . #119 Breaking change : NIC rules have been renamed from Azure.VirtualNetwork.* to Azure.VM.* . #119 Breaking change : Renamed storage account rule Azure.Storage.SecureTransferRequired to Azure.Storage.SecureTransfer . #119 v0.8.0-B1912026 (pre-release) # Fixed Automation account handling with no webhooks or variables. #219 Rule improvements from PSRule v0.12.0. #220 Updated Azure.AKS.Version to 1.15.5. #217 v0.8.0-B1912012 (pre-release) # Added new rule to check automation accounts use encrypted variables. #211 Added new rule to check automation account webhook expiry interval. #212 v0.7.0 # What's changed since v0.6.0: New rules: Role assignment: Check presence of classic Co-Administrators. #188 Azure Kubernetes Service: Check AKS node pool version matches cluster version. #186 Check AKS clusters use pod security policies. #142 Check AKS clusters use network policies. #143 Check AKS node pools use scale sets. #187 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to check for node pool version. #191 General improvements: Added custom bindings for common resource properties. #202 Added new baseline to include rules for preview features. #190 Breaking change : Shorten rule names to improve output display. #119 RBAC rules have been renamed from Azure.Subscription.* to Azure.RBAC.* . Security Center rules have been renamed from Azure.Subscription.* to Azure.SecureCenter.* . Breaking change : Renamed default baseline from Azure.SubscriptionDefault to Azure.Default . #190 Bug fixes: Fixed handling of tags for sub-resources. #203 Fixed missing cmdlet help. #196 Fixed AKS templates without node pool orchestratorVersion fail. #198 Fixed null reference without parameters file. #189 What's changed since pre-release v0.7.0-B1912024: No additional changes. v0.7.0-B1912024 (pre-release) # Fixed handling of tags for sub-resources. #203 Added custom bindings for common resource properties. #202 v0.7.0-B1912017 (pre-release) # Fixed missing cmdlet help. #196 Fixed AKS templates without node pool orchestratorVersion fail. #198 v0.7.0-B1912008 (pre-release) # Fixed null reference without parameters file. #189 Added new rule to check presence of classic Co-Administrators. #188 Added new rule to check AKS node pool version matches cluster version. #186 Added new rule to check AKS clusters use pod security policies. #142 Added new rule to check AKS clusters use network policies. #143 Added new rule to check AKS node pools use scale sets. #187 Added new baseline to include rules for preview features. #190 Updated Azure.AKS.Version to check for node pool version. #191 Breaking change : RBAC rules have been renamed from Azure.Subscription.* to Azure.RBAC.* . #119 Breaking change : Security Center rules have been renamed from Azure.Subscription.* to Azure.SecureCenter.* . #119 Breaking change : Renamed default baseline from Azure.SubscriptionDefault to Azure.Default . #190 v0.6.0 # What's changed since v0.5.0: New features: Added support for exporting rule data from templates. #145 Added Export-AzTemplateRuleData cmdlet to export templates. See cmdlet help for limitations. Template and parameters are merged, resolving functions, copy loops and conditions. Updated rules: Azure Kubernetes Services: Updated Azure.AKS.Version to 1.14.8. #140 General improvements: Updated rules to use type pre-conditions. #144 Bug fixes: Fixed processing of Azure.Resource.UseTags to exclude */providers/roleAssignments . #155 Provider role assignments do not support tags. Fixed processing of Azure.Resource.AllowedRegions . #156 Exclude */providers/roleAssignments , Microsoft.Authorization/* and Microsoft.Consumption/* . Fixed processing of Azure.VirtualNetwork.NSGAssociated for templates. #150 Fixed processing of Azure.VirtualNetwork.LateralTraversal when destinationPortRanges is used. #149 What's changed since pre-release v0.6.0-B1911046: No additional changes. v0.6.0-B1911046 (pre-release) # Improved template support of Export-AzTemplateRuleData cmdlet. #145 Added support for deployment function. Fixed property copy loop. Fixed Export-AzTemplateRuleData does not return FileInfo objects. #162 Fixed automatically name outputs from Export-AzTemplateRuleData . #163 Fixed resource segmentation issue when ResourceType includes trailing slash. #165 Fixed expand resource template property as null fails. #167 Fixed case-sensitivity of variables, parameters and functions. #168 Fixed out of order parameter and variables cross reference. #170 Fixed expression parser race condition. #171 Fixed handling of padding spaces in expressions. #173 Fixed property of property is parsed incorrectly. #174 Fixed root variable copy loop handling. #175 v0.6.0-B1911027 (pre-release) # Fixed processing of Azure.Resource.UseTags to exclude */providers/roleAssignments . #155 Provider role assignments do not support tags. Fixed processing of Azure.Resource.AllowedRegions . #156 Exclude */providers/roleAssignments , Microsoft.Authorization/* and Microsoft.Consumption/* . v0.6.0-B1911020 (pre-release) # Fixed processing of Azure.VirtualNetwork.NSGAssociated for templates. #150 Fixed processing of Azure.VirtualNetwork.LateralTraversal when destinationPortRanges is used. #149 Improved template support of Export-AzTemplateRuleData cmdlet. #145 Added support for nested templates. Added support for array , createArray , coalesce , intersection , dataUri and dataUriToString functions. v0.6.0-B1911011 (pre-release) # Updated Azure.AKS.Version to 1.14.8. #140 Updated rules to use type pre-conditions. #144 Experimental : Added support for exporting rule data from templates. #145 Added Export-AzTemplateRuleData cmdlet to export templates. See cmdlet help for limitations. Template and parameters are merged, resolving functions, copy loops and conditions. v0.5.0 # What's changed since v0.4.0: New rules: Virtual machines: Check Windows automatic updates are enabled. #132 Check VM agent is automatically provisioned. #131 Updated rules: Azure Kubernetes Services: Updated Azure.AKS.Version to 1.14.6. #130 General improvements: Shorten rule names for virtual machined to Azure.VM.* to improve output display. #119 Breaking change : Rules have been renamed from Azure.VirtualMachine.* to Azure.VM.* . What's changed since pre-release v0.5.0-B1910004: No additional changes. v0.5.0-B1910004 (pre-release) # Added rule to verify Windows automatic updates are enabled. #132 Added rule to verify VM agent is automatically provisioned. #131 Updated Azure.AKS.Version to 1.14.6. #130 Breaking change : Renamed Azure.VirtualMachine.* rules to Azure.VM.* . #119 v0.4.0 # What's changed since v0.3.0: New rules: Virtual machines: Added rule to verify Azure Disk Encryption. #122 Added rule to check if public key is used for Linux. #123 Virtual networking: Added rule to verify connectivity of VNET peers. #120 Added rule to check configuration of HTTP/ HTTPS load balancer probes. #121 General improvements: Removed dependency on Az.Storage module. #105 Added default baseline to module. #126 What's changed since pre-release v0.4.0-B190902: Added default baseline to module. #126 v0.4.0-B190902 (pre-release) # Added rule to verify connectivity of VNET peers. #120 Added rule to check configuration of HTTP/ HTTPS load balancer probes. #121 Added rule to verify Azure Disk Encryption. #122 Added rule to check if public key is used for Linux. #123 Removed dependency on Az.Storage module. #105 v0.3.0 # What's changed since v0.2.0: New rules: App Services: Enforce minimum TLS version for App Service. #99 Resource clean up: Network security groups that are not associated. #93 Unattached network interfaces. #92 Role assignment: Added subscription RBAC delegation rules. #107 Check for number of subscription owners. Check for RBAC inheritance from management groups. Check for user RBAC assignments. Check for RBAC delegation on individual resources. Virtual machines: VMs should avoid using expired promo SKUs. #87 VMs should avoid using basic SKUs. #69 Virtual networking: Added NSG rule to check for lateral traversal security rules. #103 Added rule to detect deny all inbound NSG rule. #94 Updated rules: App Services: Updated App Service site rules to include slots. #100 Azure.AppService.ARRAffinity and Azure.AppService.UseHTTPS now run against slots. Azure Kubernetes Services: Updated Azure.AKS.Version to 1.14.5. #109 Bug fixes: Fix handling of empty DNS servers in Azure.VirtualNetwork.LocalDNS . #84 Fix handling of no peering connections in Azure.VirtualNetwork.LocalDNS . #89 Fix export of additional properties for Microsoft.Sql/servers . #114 Excluded global services from Azure.Resource.AllowedRegions. #96 What's changed since pre-release v0.3.0-B190807: Fix export of additional properties for Microsoft.Sql/servers . #114 v0.3.0-B190807 (pre-release) # Updated Azure.AKS.Version to 1.14.5. #109 Added subscription RBAC delegation rules. #107 Check for number of subscription owners. Check for RBAC inheritance from management groups. Check for user RBAC assignments. Check for RBAC delegation on individual resources. v0.3.0-B190723 (pre-release) # Excluded global services from Azure.Resource.AllowedRegions. #96 Enforce minimum TLS version for App Service. #99 Updated App Service site rules to include slots. #100 Azure.AppService.ARRAffinity and Azure.AppService.UseHTTPS now run against slots. Added rule to detect deny all inbound NSG rule. #94 Added unused resource rules. Network security groups that are not associated. #93 Unattached network interfaces. #92 Added NSG rule to check for lateral traversal security rules. #103 v0.3.0-B190710 (pre-release) # Fix handling of empty DNS servers in Azure.VirtualNetwork.LocalDNS . #84 Fix handling of no peering connections in Azure.VirtualNetwork.LocalDNS . #89 Updated AKS version in Azure.AKS.Version to 1.13.7. #83 Added VM SKU rules: VMs should avoid using expired promo SKUs. #87 VMs should avoid using basic SKUs. #69 v0.2.0 # What's changed since v0.1.0: Fix rule Azure.AKS.UseRBAC returns null. #60 Fix rule Azure.Storage.SoftDelete and Azure.Storage.SecureTransferRequired returns null. #64 Fix collection of ASR vault configuration for cmdlet deprecation. #63 Updated rules to use Recommend keyword instead of Hint alias. #71 Added SQL firewall rule range check to determine an excessive number of permitted IP addresses. #3 #10 #54 The rules Azure.SQL.FirewallIPRange , Azure.MySQL.FirewallIPRange and Azure.PostgreSQL.FirewallIPRange were added to check SQL, MySQL and PostgreSQL. Added parameters to filter resource export by resource group and/ or tag. #59 Added -ResourceGroupName and -Tag parameters to Export-AzRuleData cmdlet. Added support for Application Gateway v2. #75 Added VNET rule to check for local DNS. #68 Added WAF hardening rules for Application Gateway. #78 Application Gateways use OWASP 3.x rules. Application Gateways have WAF enabled. Application Gateways have all OWASP rules enabled. What's changed since pre-release v0.2.0-B190715: No additional changes. v0.2.0-B190715 (pre-release) # Added support for Application Gateway v2. #75 Added VNET rule to check for local DNS. #68 Added WAF hardening rules for Application Gateway. #78 Application Gateways use OWASP 3.x rules. Application Gateways have WAF enabled. Application Gateways have all OWASP rules enabled. v0.2.0-B190706 (pre-release) # Fix rule Azure.AKS.UseRBAC returns null. #60 Fix rule Azure.Storage.SoftDelete and Azure.Storage.SecureTransferRequired returns null. #64 Fix collection of ASR vault configuration for cmdlet deprecation. #63 Added SQL firewall rule range check to determine an excessive number of permitted IP addresses. #3 #10 #54 The rules Azure.SQL.FirewallIPRange , Azure.MySQL.FirewallIPRange and Azure.PostgreSQL.FirewallIPRange were added to check SQL, MySQL and PostgreSQL. Updated rules to use Recommend keyword instead of Hint alias. #71 Added parameters to filter resource export by resource group and/ or tag. #59 Added -ResourceGroupName and -Tag parameters to Export-AzRuleData cmdlet. v0.1.0 # Initial release. What's changed since pre-release v0.1.0-B190624: No additional changes. v0.1.0-B190624 (pre-release) # Added rule to check if allow access to Azure services enabled for MySQL. #4 Added rule to count the number of database server firewall rules for MySQL. #2 Added rule to check if allow access to Azure services enabled for PostgreSQL. #50 Added rule to count the number of database server firewall rules for PostgreSQL. #51 Added rule to check if SSL is enforced for PostgreSQL. #49 v0.1.0-B190607 (pre-release) # Added rule documentation. #40 v0.1.0-B190569 (pre-release) # Fix exported resource data overwritten. #34 v0.1.0-B190562 (pre-release) # Add units tests for Export-AzRuleData and update filters. #28 Export-AzRuleData returns files generated by default. #27 Export-AzRuleData passes through objects resource objects to the pipeline. #25 Breaking change - Export-AzRuleData only exports data from current subscription context by default. #24 Data can be exported from all subscription contexts by using the -All switch, or specifying specific subscriptions with the -Subscription or -Tenant parameters. v0.1.0-B190543 (pre-release) # Fix cannot find the type for custom attribute error. #21 v0.1.0-B190536 (pre-release) # Initial pre-release.","title":"v0"},{"location":"CHANGELOG-v0/#change-log","text":"","title":"Change log"},{"location":"CHANGELOG-v0/#v0190","text":"What's changed since v0.18.0: New features: Added Azure.GA_2020_12 baseline. #593 Includes rules released before or during December 2020 for Azure GA features. Marked baseline Azure.GA_2020_09 as obsolete. New rules: Database for MySQL: Check database servers meet name requirements. #583 Database for PostgreSQL: Check database servers meet name requirements. #583 SQL Database: Check SQL logical servers meet name requirements. #583 Check SQL failover groups meet name requirements. #583 Check SQL databases meet name requirements. #583 SQL Managed Instance: Check SQL Managed Instances meet name requirements. #583 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.19.3. #590 General improvements: Added support for true , false , and null template functions. #579 Added support for createObject template function. #580 Engineering: Bump PSRule dependency to v1.0.0. #588 What's changed since pre-release v0.19.0-B2012008: New features: Added Azure.GA_2020_12 baseline. #593 Includes rules released before or during December 2020 for Azure GA features. Marked baseline Azure.GA_2020_09 as obsolete.","title":"v0.19.0"},{"location":"CHANGELOG-v0/#v0190-b2012008-pre-release","text":"What's changed since pre-release v0.19.0-B2011008: Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.19.3. #590 Engineering: Bump PSRule dependency to v1.0.0. #588","title":"v0.19.0-B2012008 (pre-release)"},{"location":"CHANGELOG-v0/#v0190-b2011008-pre-release","text":"What's changed since v0.18.0: New rules: Database for MySQL: Check database servers meet name requirements. #583 Database for PostgreSQL: Check database servers meet name requirements. #583 SQL Database: Check SQL logical servers meet name requirements. #583 Check SQL failover groups meet name requirements. #583 Check SQL databases meet name requirements. #583 SQL Managed Instance: Check SQL Managed Instances meet name requirements. #583 General improvements: Added support for true , false , and null template functions. #579 Added support for createObject template function. #580","title":"v0.19.0-B2011008 (pre-release)"},{"location":"CHANGELOG-v0/#v0180","text":"What's changed since v0.17.0: New rules: Container Registry: Check registries use container image scanning. #558 Check registries image scanning results are healthy. #558 Check registries use content trust. #558 Check registries are geo-replicated. #558 Check registries uses storage space less than included storage. #558 Check registries have a retention set of untagged manifests (preview). #558 Check registries use image quarantine pattern (preview). #558 Front Door: Check Front Door WAF policy name requirements. #552 Bug fixes: Fixed HNS storage accounts so they are excluded from blob soft delete rule. #554 Fixed reason typo on template parameter metadata. #567 Fixed Get-AzRuleTemplateLink reports incorrect parameter with file path. #568 Fixed variable property not resolved with copy peer. #571 Fixed blob soft delete for FileStorage storage accounts. #573 Fixed top level variable copy detected as unused variable. #569 Fixed ResourceGroupName property cannot be found on this object. #561 What's changed since pre-release v0.18.0-B2011023: No additional changes.","title":"v0.18.0"},{"location":"CHANGELOG-v0/#v0180-b2011023-pre-release","text":"What's changed since pre-release v0.18.0-B2011005: Bug fixes: Fixed reason typo on template parameter metadata. #567 Fixed Get-AzRuleTemplateLink reports incorrect parameter with file path. #568 Fixed variable property not resolved with copy peer. #571 Fixed blob soft delete for FileStorage storage accounts. #573 Fixed top level variable copy detected as unused variable. #569","title":"v0.18.0-B2011023 (pre-release)"},{"location":"CHANGELOG-v0/#v0180-b2011005-pre-release","text":"What's changed since pre-release v0.18.0-B2010016: Bug fixes: Fixed ResourceGroupName property cannot be found on this object. #561","title":"v0.18.0-B2011005 (pre-release)"},{"location":"CHANGELOG-v0/#v0180-b2010016-pre-release","text":"What's changed since v0.17.0: New rules: Container Registry: Check registries use container image scanning. #558 Check registries image scanning results are healthy. #558 Check registries use content trust. #558 Check registries are geo-replicated. #558 Check registries uses storage space less than included storage. #558 Check registries have a retention set of untagged manifests (preview). #558 Check registries use image quarantine pattern (preview). #558 Front Door: Check Front Door WAF policy name requirements. #552 Bug fixes: Fixed HNS storage accounts so they are excluded from blob soft delete rule. #554","title":"v0.18.0-B2010016 (pre-release)"},{"location":"CHANGELOG-v0/#v0170","text":"What's changed since v0.16.0: New rules: Azure Cache for Redis: Check cache instances use Standard C1 or greater SKU. #501 Cache cache instances configure maxmemory-reserved setting. #502 App Configuration: Check App Configuration stores meet name requirements. #528 Check App Configuration stores use standard SKU. #528 App Service: Check App Service apps use HTTP/2. #538 Check App Service apps use managed identities. #537 Check App Service apps use Always On. #521 Check App Service apps have remote debugging disabled. #521 Check App Service apps use newer .NET Framework versions. #521 Check App Service apps use newer PHP runtime versions. #521 Logic App: Check Logic App apps limit IP range for HTTP triggers. #526 Updated rules: Storage: Updated Azure.Storage.UseReplication for additional use cases. Added support for geo-zone-redundant storage. #535 Exclude storage tagged with resource-usage = 'azure-functions' or resource-usage = 'azure-monitor' . #534 Azure Kubernetes Service: Promote Azure.AKS.AzurePolicyAddOn to GA rule set. #524 Removed rules: Azure Kubernetes Service: Remove Azure.AKS.PodSecurityPolicy as this AKS feature is replaced by Azure Policy. #523 General improvements: Added support for providers template function. #177 Added support for dateTimeAdd template function. #516 Bug fixes: Fixed expansion of templates with multiple variables copy blocks. #541 Fixed App Service rule site config false positives in templates. #533 What's changed since pre-release v0.17.0-B2010028: No additional changes.","title":"v0.17.0"},{"location":"CHANGELOG-v0/#v0170-b2010028-pre-release","text":"What's changed since pre-release v0.17.0-B2010022: New rules: Azure Cache for Redis: Check cache instances use Standard C1 or greater SKU. #501 Cache cache instances configure maxmemory-reserved setting. #502","title":"v0.17.0-B2010028 (pre-release)"},{"location":"CHANGELOG-v0/#v0170-b2010022-pre-release","text":"What's changed since pre-release v0.17.0-B2010017: Bug fixes: Fixed expansion of templates with multiple variables copy blocks. #541","title":"v0.17.0-B2010022 (pre-release)"},{"location":"CHANGELOG-v0/#v0170-b2010017-pre-release","text":"What's changed since pre-release v0.17.0-B2010006: New rules: App Service: Check App Service apps use HTTP/2. #538 Check App Service apps use managed identities. #537 Updated rules: Storage: Updated Azure.Storage.UseReplication for additional use cases. Added support for geo-zone-redundant storage. #535 Exclude storage tagged with resource-usage = 'azure-functions' or resource-usage = 'azure-monitor' . #534 Bug fixes: Fixed App Service rule site config false positives in templates. #533","title":"v0.17.0-B2010017 (pre-release)"},{"location":"CHANGELOG-v0/#v0170-b2010006-pre-release","text":"What's changed since pre-release v0.17.0-B2009009: New rules: App Configuration: Check App Configuration stores meet name requirements. #528 Check App Configuration stores use standard SKU. #528 App Service: Check App Service apps use Always On. #521 Check App Service apps have remote debugging disabled. #521 Check App Service apps use newer .NET Framework versions. #521 Check App Service apps use newer PHP runtime versions. #521 Logic App: Check Logic App apps limit IP range for HTTP triggers. #526 Updated rules: Azure Kubernetes Service: Promote Azure.AKS.AzurePolicyAddOn to GA rule set. #524 Removed rules: Azure Kubernetes Service: Remove Azure.AKS.PodSecurityPolicy as this AKS feature is replaced by Azure Policy. #523","title":"v0.17.0-B2010006 (pre-release)"},{"location":"CHANGELOG-v0/#v0170-b2009009-pre-release","text":"What's changed since v0.16.0: General improvements: Added support for providers template function. #177 Added support for dateTimeAdd template function. #516","title":"v0.17.0-B2009009 (pre-release)"},{"location":"CHANGELOG-v0/#v0160","text":"What's changed since v0.15.0: New features: Added Azure.GA_2020_09 baseline. #488 Includes rules released before or during September 2020 for Azure GA features. Marked baseline Azure.GA_2020_06 as obsolete. New rules: CDN: Check CDN endpoint naming requirements. #486 Check CDN endpoints use TLS 1.2. #487 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.18.8. #504 General improvements: Updated rule content to align with Microsoft Azure Well-Architected Framework pillars. #481 Improve output of template processing exceptions. #484 Engineering: Bump PSRule dependency to v0.20.0. Bug fixes: Fixed Data Factory version not detected with template. #498 Fixed parameter file detection with 2019-04-01 schema. #495 Fixed deprecated $Rule properties. #491 What's changed since pre-release v0.16.0-B2009033: No additional changes.","title":"v0.16.0"},{"location":"CHANGELOG-v0/#v0160-b2009033-pre-release","text":"What's changed since pre-release v0.16.0-B2009024: New features: Added Azure.GA_2020_09 baseline. #488 Includes rules released before or during September 2020 for Azure GA features. Marked baseline Azure.GA_2020_06 as obsolete. Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.18.8. #504 Engineering: Bump PSRule dependency to v0.20.0.","title":"v0.16.0-B2009033 (pre-release)"},{"location":"CHANGELOG-v0/#v0160-b2009024-pre-release","text":"What's changed since pre-release v0.16.0-B2009019: Bug fixes: Fixed Data Factory version not detected with template. #498","title":"v0.16.0-B2009024 (pre-release)"},{"location":"CHANGELOG-v0/#v0160-b2009019-pre-release","text":"What's changed since pre-release v0.16.0-B2009011: Bug fixes: Fixed parameter file detection with 2019-04-01 schema. #495","title":"v0.16.0-B2009019 (pre-release)"},{"location":"CHANGELOG-v0/#v0160-b2009011-pre-release","text":"What's changed since pre-release v0.16.0-B2009004: Bug fixes: Fixed deprecated $Rule properties. #491","title":"v0.16.0-B2009011 (pre-release)"},{"location":"CHANGELOG-v0/#v0160-b2009004-pre-release","text":"What's changed since v0.15.0: New rules: CDN: Check CDN endpoint naming requirements. #486 Check CDN endpoints use TLS 1.2. #487 General improvements: Updated rule content to align with Microsoft Azure Well-Architected Framework pillars. #481 Improve output of template processing exceptions. #484","title":"v0.16.0-B2009004 (pre-release)"},{"location":"CHANGELOG-v0/#v0150","text":"What's changed since v0.14.1: New rules: All resources: Check ARM template parameters are used. #232 Check ARM template variables are used. #233 Check ARM template parameters include a metadata description. #360 Check ARM templates define at least one resource. #359 Database for MySQL: Check database servers reject TLS versions older than 1.2. #469 Database for PostgreSQL: Check database servers reject TLS versions older than 1.2. #470 SQL Database: Check database servers reject TLS versions older than 1.2. #471 Storage Account: Check Storage Accounts reject TLS versions older than 1.2. #455 Check Storage Accounts only accept authorized requests. #456 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.17.9. #452 Engineering: Bump PSRule dependency to v0.19.0. Bug fixes: Fixed export of non-blob Storage Accounts. #464 Fixed export of subscription Security Center data based on API version. #465 Fixed masking of sharedKey when property does not exist. #466 What's changed since pre-release v0.15.0-B2008034: No additional changes.","title":"v0.15.0"},{"location":"CHANGELOG-v0/#v0150-b2008043-pre-release","text":"What's changed since pre-release v0.15.0-B2008034: New rules: Database for MySQL: Check database servers reject TLS versions older than 1.2. #469 Database for PostgreSQL: Check database servers reject TLS versions older than 1.2. #470 SQL Database: Check database servers reject TLS versions older than 1.2. #471 Bug fixes: Fixed use variables check when no variables are defined. #462","title":"v0.15.0-B2008043 (pre-release)"},{"location":"CHANGELOG-v0/#v0150-b2008034-pre-release","text":"What's changed since pre-release v0.15.0-B2008026: Bug fixes: Fixed export of non-blob Storage Accounts. #464 Fixed export of subscription Security Center data based on API version. #465 Fixed masking of sharedKey when property does not exist. #466","title":"v0.15.0-B2008034 (pre-release)"},{"location":"CHANGELOG-v0/#v0150-b2008026-pre-release","text":"What's changed since v0.14.1: New rules: All resources: Check ARM template parameters are used. #232 Check ARM template variables are used. #233 Check ARM template parameters include a metadata description. #360 Check ARM templates define at least one resource. #359 Storage Account: Check Storage Accounts reject TLS versions older than 1.2. #455 Check Storage Accounts only accept authorized requests. #456 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.17.9. #452","title":"v0.15.0-B2008026 (pre-release)"},{"location":"CHANGELOG-v0/#v0141","text":"What's changed since v0.14.0: Bug fixes: Fixed resource tags rule to exclude diagnostic settings. #448","title":"v0.14.1"},{"location":"CHANGELOG-v0/#v0140","text":"What's changed since v0.13.0: New rules: API Management: Check API Management service name requirements. #437 Check API Management products have legal terms. #438 Check API Management products have a display name and description. #439 Check API Management APIs have a display name and description. #440 Subscriptions: Check subscription is managed by PIM. #422 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.17.7. #427 General improvements: Updated rule reasons and logic. #424 Bug fixes: Fixed masking for network connection resource configuration. #434 Fixed hybrid use benefit rule to exclude Windows client OSs. #433 Fixed VM standalone rule to exclude Windows client OSs. #442 What's changed since pre-release v0.14.0-B2007031: No additional changes.","title":"v0.14.0"},{"location":"CHANGELOG-v0/#v0140-b2007031-pre-release","text":"What's changed since pre-release v0.14.0-B2007020: New rules: API Management: Check API Management service name requirements. #437 Check API Management products have legal terms. #438 Check API Management products have a display name and description. #439 Check API Management APIs have a display name and description. #440 Bug fixes: Fixed masking for network connection resource configuration. #434 Fixed hybrid use benefit rule to exclude Windows client OSs. #433 Fixed VM standalone rule to exclude Windows client OSs. #442","title":"v0.14.0-B2007031 (pre-release)"},{"location":"CHANGELOG-v0/#v0140-b2007020-pre-release","text":"What's changed since v0.13.0: New rules: Subscriptions: Check subscription is managed by PIM. #422 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.17.7. #427 General improvements: Updated rule reasons and logic. #424","title":"v0.14.0-B2007020 (pre-release)"},{"location":"CHANGELOG-v0/#v0130","text":"What's changed since v0.12.1: New features: Added Azure.GA_2020_06 baseline. #399 Includes rules released before or during June 2020 for Azure GA features. New rules: Azure Kubernetes Service: Check AKS clusters use a Standard load balancer SKU. #334 Check AKS clusters use Managed Identities for cluster infrastructure. #333 Check AKS clusters use Azure Policy add-on (preview). #405 Public IP: Check Public IP domain name label requirements. #389 Virtual Machines: Check Availability Set name requirements. #387 Check Computer name requirements. #387 Check Managed Disk name requirements. #387 Check Network Interface name requirements. #387 Check Virtual Machine name requirements. #387 Check Proximity Placement Group name requirements. #387 Virtual Machine Scale Sets: Check Computer name requirements. #387 Check Virtual Machine Scale Set name requirements. #387 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.16.9. #394 Bug fixes: Fixed module default culture. #390 Fixed exception message for object property that does not exist. #362 Fixed substring raises an exception processing sub expressions. #413 What's changed since pre-release v0.13.0-B2006032: Bug fixes: Fixed substring raises an exception processing sub expressions. #413","title":"v0.13.0"},{"location":"CHANGELOG-v0/#v0130-b2006032-pre-release","text":"New features: Added Azure.GA_2020_06 baseline. #399 Includes rules released before or during June 2020 for Azure GA features. Bug fixes: Fixed exception message for object property that does not exist. #362","title":"v0.13.0-B2006032 (pre-release)"},{"location":"CHANGELOG-v0/#v0130-b2006023-pre-release","text":"New rules: Public IP: Check Public IP domain name label requirements. #389 Virtual Machines: Check Availability Set name requirements. #387 Check Computer name requirements. #387 Check Managed Disk name requirements. #387 Check Network Interface name requirements. #387 Check Virtual Machine name requirements. #387 Check Proximity Placement Group name requirements. #387 Virtual Machine Scale Sets: Check Computer name requirements. #387 Check Virtual Machine Scale Set name requirements. #387","title":"v0.13.0-B2006023 (pre-release)"},{"location":"CHANGELOG-v0/#v0130-b2006017-pre-release","text":"New rules: Azure Kubernetes Service: Check AKS clusters use a Standard load balancer SKU. #334 Check AKS clusters use Managed Identities for cluster infrastructure. #333 Check AKS clusters use Azure Policy add-on (preview). #405","title":"v0.13.0-B2006017 (pre-release)"},{"location":"CHANGELOG-v0/#v0130-b2006003-pre-release","text":"Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.16.9. #394 Bug fixes: Fixed module default culture. #390","title":"v0.13.0-B2006003 (pre-release)"},{"location":"CHANGELOG-v0/#v0121","text":"What's changed since v0.12.0: Bug fixes: Fixed subnet name check for VNET with no subnets. #386","title":"v0.12.1"},{"location":"CHANGELOG-v0/#v0120","text":"What's changed since v0.11.0: New rules: Azure Kubernetes Service: Check AKS cluster name requirements. #373 Check AKS cluster DNS prefix requirements. #373 Container Registry: Check registry name requirements. #373 Front Door: Check Front Door name requirements. #373 Load Balancer: Check Load Balancer name requirements. #373 Network Security Group: Check NSG name requirements. #373 Public IP: Check Public IP name requirements. #373 Policy: Check Policy definitions use descriptive fields. #364 Resource Group: Check Resource Group name requirements. #373 Route table Check Route table name requirements. #373 SignalR Service: Check SignalR Service name requirements. #373 SQL Database: Check SQL Database uses TDE. #379 Check SQL Database uses AAD authentication. #378 Storage Account: Check Storage Account name requirements. #373 Check Storage blob containers use private access type. #365 Virtual Network: Check VNET name requirements. #373 Check VNET subnet name requirements. #373 Virtual Network Gateway: Check VNG name requirements. #373 Check VNG connection name requirements. #373 Check ExpressRoute Gateway uses current SKU. #369 Check VPN Gateway uses current SKU. #370 Check VPN Gateway uses active-active configuration. #371 What's changed since pre-release v0.12.0-B2005026: No additional changes.","title":"v0.12.0"},{"location":"CHANGELOG-v0/#v0120-b2005026-pre-release","text":"New rules: SQL Database: Check SQL Database uses TDE. #379 Check SQL Database uses AAD authentication. #378 Bug fixes: Fixed handling of subnet sub-resource name with slash. #381","title":"v0.12.0-B2005026 (pre-release)"},{"location":"CHANGELOG-v0/#v0120-b2005019-pre-release","text":"New rules: Azure Kubernetes Service: Check AKS cluster name requirements. #373 Check AKS cluster DNS prefix requirements. #373 Container Registry: Check registry name requirements. #373 Front Door: Check Front Door name requirements. #373 Load Balancer: Check Load Balancer name requirements. #373 Network Security Group: Check NSG name requirements. #373 Public IP: Check Public IP name requirements. #373 Resource Group: Check Resource Group name requirements. #373 Route table Check Route table name requirements. #373 SignalR Service: Check SignalR Service name requirements. #373 Storage Account: Check Storage Account name requirements. #373 Virtual Network: Check VNET name requirements. #373 Check VNET subnet name requirements. #373 Virtual Network Gateway: Check VNG name requirements. #373 Check VNG connection name requirements. #373 Check ExpressRoute Gateway uses current SKU. #369 Check VPN Gateway uses current SKU. #370 Check VPN Gateway uses active-active configuration. #371","title":"v0.12.0-B2005019 (pre-release)"},{"location":"CHANGELOG-v0/#v0120-b2005005-pre-release","text":"New rules: Storage Account: Check Storage blob containers use private access type. #365 Policy: Check Policy definitions use descriptive fields. #364","title":"v0.12.0-B2005005 (pre-release)"},{"location":"CHANGELOG-v0/#v0110","text":"What's changed since v0.10.1: New rules: Azure Kubernetes Service: Check AKS nodes use a minimum number of pods. #274 API Management: Check API Management products require a subscription. #342 Check API Management products require approval. #343 Check API Management sample products have been removed. #344 Check API Management uses a managed identity. #345 Check API Management certificates are not expired. #346 General improvements: Added name and type bindings for template files. #353 Breaking change : Renamed configuration options to use a standard prefix. #327 Configuration options use the Azure_ prefix. Update configuration settings to use the new name, old configuration names are ignored. Renamed minAKSVersion to Azure_AKSMinimumVersion . Renamed azureAllowedRegions to Azure_AllowedRegions . Added configuration option documentation. See about_PSRule_Azure_Configuration for details. What's changed since pre-release v0.11.0-B2004012: General improvements: Added name and type bindings for template files. #353","title":"v0.11.0"},{"location":"CHANGELOG-v0/#v0110-b2004012-pre-release","text":"New rules: Azure Kubernetes Service: Check AKS nodes use a minimum number of pods. #274 General improvements: Breaking change : Renamed configuration options to use a standard prefix. #327 Configuration options use the Azure_ prefix. Update configuration settings to use the new name, old configuration names are ignored. Renamed minAKSVersion to Azure_AKSMinimumVersion . Renamed azureAllowedRegions to Azure_AllowedRegions . Added configuration option documentation. See about_PSRule_Azure_Configuration for details.","title":"v0.11.0-B2004012 (pre-release)"},{"location":"CHANGELOG-v0/#v0110-b2004005-pre-release","text":"New rules: API Management: Check API Management products require a subscription. #342 Check API Management products require approval. #343 Check API Management sample products have been removed. #344 Check API Management uses a managed identity. #345 Check API Management certificates are not expired. #346","title":"v0.11.0-B2004005 (pre-release)"},{"location":"CHANGELOG-v0/#v0101","text":"What's changed since v0.10.0: Bug fixes: Fixed false positive for unused public IP in templates. #336 Fixed false positive for use of managed disks in templates. #337 Fixed false positive for disk caching when no VM data disks is null in templates. #338","title":"v0.10.1"},{"location":"CHANGELOG-v0/#v0100","text":"What's changed since v0.9.0: New features: Added support for linking parameter and template files for analysis with metadata. #324 Added Get-AzRuleTemplateLink cmdlet to get metadata link to template files. See cmdlet help for usage. Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.16.7. #330 General improvements: Removed warning message for azureAllowedRegions option. #328 Improvements to verbose logging of Export-AzRuleData . #301 Bug fixes: Fixed unused VM resource false positives in templates. #312 Fixed handling SKU for accelerated networking. #314 Fixed detection of hybrid use benefit in templates. #313 Fixed exception message when a template or parameter file is not found. #316 Fixed detection of diagnostic logging for Front Door. #307 Fixed Front Door WAF Policy export. #308 Fixed union of object properties in templates. #303 What's changed since pre-release v0.10.0-B2003051: No additional changes.","title":"v0.10.0"},{"location":"CHANGELOG-v0/#v0100-b2003051-pre-release","text":"New features: Added support for linking parameter and template files for analysis with metadata. #324 Added Get-AzRuleTemplateLink cmdlet to get metadata link to template files. See cmdlet help for usage. General improvements: Removed warning message for azureAllowedRegions option. #328 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.16.7. #330","title":"v0.10.0-B2003051 (pre-release)"},{"location":"CHANGELOG-v0/#v0100-b2003032-pre-release","text":"Bug fixes: Fixed unused VM resource false positives in templates. #312 Fixed handling SKU for accelerated networking. #314 Fixed detection of hybrid use benefit in templates. #313 Fixed exception message when a template or parameter file is not found. #316","title":"v0.10.0-B2003032 (pre-release)"},{"location":"CHANGELOG-v0/#v0100-b2003004-pre-release","text":"Bug fixes: Fixed detection of diagnostic logging for Front Door. #307 Fixed Front Door WAF Policy export. #308","title":"v0.10.0-B2003004 (pre-release)"},{"location":"CHANGELOG-v0/#v0100-b2002023-pre-release","text":"General improvements: Improvements to verbose logging of Export-AzRuleData . #301 Bug fixes: Fixed union of object properties in templates. #303","title":"v0.10.0-B2002023 (pre-release)"},{"location":"CHANGELOG-v0/#v090","text":"What's changed since v0.8.0: New rules: Azure Firewall: Check threat intelligence is configured as deny. #266 Front Door: Check Front Door is enabled. #267 Check Front Door uses TLS 1.2. #268 Check Front Door has a configured WAF policy. #269 Check Front Door WAF policy is configured in prevention mode. #271 Check Front Door WAF policy is enabled. #270 Check if diagnostic logs are configured. #289 Traffic Manager: Check web-based endpoints are monitored with HTTPS. #240 Check at least two endpoints are enabled. #241 Key Vault: Check soft delete is enabled. #277 Check purge protection is enabled. #280 Check least privileges permissions assigned in access policy. #281 Check if diagnostic logs are configured. #288 Subscriptions: Check if service health alerts are configured. #290 Updated rules: Exclude cloud shell storage accounts from data rules. #278 Azure.Storage.UseReplication and Azure.Storage.SoftDelete ignore cloud shell storage accounts. General improvements: Removed module dependency on Az.Security . #105 Bug fixes: Fixed incorrect string formatting in POSIX culture. #262 Fixed Azure.VNET.UseNSGs to exclude AzureFirewallSubnet . #261 What's changed since pre-release v0.9.0-B2002036: No additional changes.","title":"v0.9.0"},{"location":"CHANGELOG-v0/#v090-b2002036-pre-release","text":"Exclude cloud shell storage accounts from data rules. #278 Added new rule for Subscriptions: Check if service health alerts are configured. #290 Added new rule for Key Vault: Check if diagnostic logs are configured. #288 Added new rule for Front Door: Check if diagnostic logs are configured. #289 Removed module dependency on Az.Security . #105","title":"v0.9.0-B2002036 (pre-release)"},{"location":"CHANGELOG-v0/#v090-b2002026-pre-release","text":"Added new rules for Traffic Manager: Check web-based endpoints are monitored with HTTPS. #240 Check at least two endpoints are enabled. #241 Added new rules for Key Vault: Check soft delete is enabled. #277 Check purge protection is enabled. #280 Check least privileges permissions assigned in access policy. #281","title":"v0.9.0-B2002026 (pre-release)"},{"location":"CHANGELOG-v0/#v090-b2002019-pre-release","text":"Added new rule to check Azure Firewall threat intelligence is configured as deny. #266 Added new rules for Front Door: Check Front Door is enabled. #267 Check Front Door uses TLS 1.2. #268 Check Front Door has a configured WAF policy. #269 Check Front Door WAF policy is configured in prevention mode. #271 Check Front Door WAF policy is enabled. #270","title":"v0.9.0-B2002019 (pre-release)"},{"location":"CHANGELOG-v0/#v090-b2002011-pre-release","text":"Fixed incorrect string formatting in POSIX culture. #262 Fixed Azure.VNET.UseNSGs to exclude AzureFirewallSubnet . #261","title":"v0.9.0-B2002011 (pre-release)"},{"location":"CHANGELOG-v0/#v080","text":"What's changed since v0.7.0: New rules: API Management: Check API Management uses secure protocol versions. #237 Check API Management published APIs use HTTPS. #236 Check API Management backend connections use HTTPS. #238 Check API Management named values are encrypted. #239 Automation Accounts: Check automation accounts use encrypted variables. #211 Check automation account webhook expiry interval. #212 CDN: Check Azure CDN connections use HTTPS. #242 Resource Manager Templates: Check ARM template and parameter file structure. #225 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.15.7. #247 Virtual networks: Updated Azure.VNET.UseNSGs to apply to subnet resources from templates. #246 General improvements: Improvements to rule help wording and usage of links section. #220 #224 #257 Documentation and reasons messages are now available for all en cultures. Various updates to rule implementation to take advantage of PSRule v0.12.0 language features. #220 Breaking change : Shorten rule names to improve output display. #119 Application Gateway rules have been renamed from Azure.VirtualNetwork.* to Azure.AppGW.* . Load balancer rules have been renamed from Azure.VirtualNetwork.* to Azure.LB.* . NSG rules have been renamed from Azure.VirtualNetwork.* to Azure.NSG.* . VNET rules have been renamed from Azure.VirtualNetwork.* to Azure.VNET.* . NIC rules have been renamed from Azure.VirtualNetwork.* to Azure.VM.* . Renamed storage account rule Azure.Storage.SecureTransferRequired to Azure.Storage.SecureTransfer . Bug fixes: Fix Azure.Resource.UseTags applying to template and parameter files. #230 What's changed since pre-release v0.8.0-B2001029: Fixed Azure.VNET.UseNSGs not populating subnet name in reason message. #256 Updated reason strings to use parent culture en . #257","title":"v0.8.0"},{"location":"CHANGELOG-v0/#v080-b2001029-pre-release","text":"Updated Azure.VNET.UseNSGs to apply to subnet resources from templates. #246 Updated Azure.AKS.Version to 1.15.7. #247 Breaking change : Renamed Azure.File.* rules to Azure.Template.* . #252","title":"v0.8.0-B2001029 (pre-release)"},{"location":"CHANGELOG-v0/#v080-b2001018-pre-release","text":"Fixed Azure.Resource.UseTags applying to template and parameter files. #230 Fixed ARM template and parameter schemas used to detect files. #234 Added new rule to check API Management uses secure protocol versions. #237 Added new rule to check API Management published APIs use HTTPS. #236 Added new rule to check API Management backend connections use HTTPS. #238 Added new rule to check API Management named values are encrypted. #239 Added new rule to check Azure CDN connections use HTTPS. #242","title":"v0.8.0-B2001018 (pre-release)"},{"location":"CHANGELOG-v0/#v080-b2001006-pre-release","text":"Updated documentation to use parent culture en . #224 Added rules for ARM template and parameter file structure. #225 Breaking change : Application Gateway rules have been renamed from Azure.VirtualNetwork.* to Azure.AppGW.* . #119 Breaking change : Load balancer rules have been renamed from Azure.VirtualNetwork.* to Azure.LB.* . #119 Breaking change : NSG rules have been renamed from Azure.VirtualNetwork.* to Azure.NSG.* . #119 Breaking change : VNET rules have been renamed from Azure.VirtualNetwork.* to Azure.VNET.* . #119 Breaking change : NIC rules have been renamed from Azure.VirtualNetwork.* to Azure.VM.* . #119 Breaking change : Renamed storage account rule Azure.Storage.SecureTransferRequired to Azure.Storage.SecureTransfer . #119","title":"v0.8.0-B2001006 (pre-release)"},{"location":"CHANGELOG-v0/#v080-b1912026-pre-release","text":"Fixed Automation account handling with no webhooks or variables. #219 Rule improvements from PSRule v0.12.0. #220 Updated Azure.AKS.Version to 1.15.5. #217","title":"v0.8.0-B1912026 (pre-release)"},{"location":"CHANGELOG-v0/#v080-b1912012-pre-release","text":"Added new rule to check automation accounts use encrypted variables. #211 Added new rule to check automation account webhook expiry interval. #212","title":"v0.8.0-B1912012 (pre-release)"},{"location":"CHANGELOG-v0/#v070","text":"What's changed since v0.6.0: New rules: Role assignment: Check presence of classic Co-Administrators. #188 Azure Kubernetes Service: Check AKS node pool version matches cluster version. #186 Check AKS clusters use pod security policies. #142 Check AKS clusters use network policies. #143 Check AKS node pools use scale sets. #187 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to check for node pool version. #191 General improvements: Added custom bindings for common resource properties. #202 Added new baseline to include rules for preview features. #190 Breaking change : Shorten rule names to improve output display. #119 RBAC rules have been renamed from Azure.Subscription.* to Azure.RBAC.* . Security Center rules have been renamed from Azure.Subscription.* to Azure.SecureCenter.* . Breaking change : Renamed default baseline from Azure.SubscriptionDefault to Azure.Default . #190 Bug fixes: Fixed handling of tags for sub-resources. #203 Fixed missing cmdlet help. #196 Fixed AKS templates without node pool orchestratorVersion fail. #198 Fixed null reference without parameters file. #189 What's changed since pre-release v0.7.0-B1912024: No additional changes.","title":"v0.7.0"},{"location":"CHANGELOG-v0/#v070-b1912024-pre-release","text":"Fixed handling of tags for sub-resources. #203 Added custom bindings for common resource properties. #202","title":"v0.7.0-B1912024 (pre-release)"},{"location":"CHANGELOG-v0/#v070-b1912017-pre-release","text":"Fixed missing cmdlet help. #196 Fixed AKS templates without node pool orchestratorVersion fail. #198","title":"v0.7.0-B1912017 (pre-release)"},{"location":"CHANGELOG-v0/#v070-b1912008-pre-release","text":"Fixed null reference without parameters file. #189 Added new rule to check presence of classic Co-Administrators. #188 Added new rule to check AKS node pool version matches cluster version. #186 Added new rule to check AKS clusters use pod security policies. #142 Added new rule to check AKS clusters use network policies. #143 Added new rule to check AKS node pools use scale sets. #187 Added new baseline to include rules for preview features. #190 Updated Azure.AKS.Version to check for node pool version. #191 Breaking change : RBAC rules have been renamed from Azure.Subscription.* to Azure.RBAC.* . #119 Breaking change : Security Center rules have been renamed from Azure.Subscription.* to Azure.SecureCenter.* . #119 Breaking change : Renamed default baseline from Azure.SubscriptionDefault to Azure.Default . #190","title":"v0.7.0-B1912008 (pre-release)"},{"location":"CHANGELOG-v0/#v060","text":"What's changed since v0.5.0: New features: Added support for exporting rule data from templates. #145 Added Export-AzTemplateRuleData cmdlet to export templates. See cmdlet help for limitations. Template and parameters are merged, resolving functions, copy loops and conditions. Updated rules: Azure Kubernetes Services: Updated Azure.AKS.Version to 1.14.8. #140 General improvements: Updated rules to use type pre-conditions. #144 Bug fixes: Fixed processing of Azure.Resource.UseTags to exclude */providers/roleAssignments . #155 Provider role assignments do not support tags. Fixed processing of Azure.Resource.AllowedRegions . #156 Exclude */providers/roleAssignments , Microsoft.Authorization/* and Microsoft.Consumption/* . Fixed processing of Azure.VirtualNetwork.NSGAssociated for templates. #150 Fixed processing of Azure.VirtualNetwork.LateralTraversal when destinationPortRanges is used. #149 What's changed since pre-release v0.6.0-B1911046: No additional changes.","title":"v0.6.0"},{"location":"CHANGELOG-v0/#v060-b1911046-pre-release","text":"Improved template support of Export-AzTemplateRuleData cmdlet. #145 Added support for deployment function. Fixed property copy loop. Fixed Export-AzTemplateRuleData does not return FileInfo objects. #162 Fixed automatically name outputs from Export-AzTemplateRuleData . #163 Fixed resource segmentation issue when ResourceType includes trailing slash. #165 Fixed expand resource template property as null fails. #167 Fixed case-sensitivity of variables, parameters and functions. #168 Fixed out of order parameter and variables cross reference. #170 Fixed expression parser race condition. #171 Fixed handling of padding spaces in expressions. #173 Fixed property of property is parsed incorrectly. #174 Fixed root variable copy loop handling. #175","title":"v0.6.0-B1911046 (pre-release)"},{"location":"CHANGELOG-v0/#v060-b1911027-pre-release","text":"Fixed processing of Azure.Resource.UseTags to exclude */providers/roleAssignments . #155 Provider role assignments do not support tags. Fixed processing of Azure.Resource.AllowedRegions . #156 Exclude */providers/roleAssignments , Microsoft.Authorization/* and Microsoft.Consumption/* .","title":"v0.6.0-B1911027 (pre-release)"},{"location":"CHANGELOG-v0/#v060-b1911020-pre-release","text":"Fixed processing of Azure.VirtualNetwork.NSGAssociated for templates. #150 Fixed processing of Azure.VirtualNetwork.LateralTraversal when destinationPortRanges is used. #149 Improved template support of Export-AzTemplateRuleData cmdlet. #145 Added support for nested templates. Added support for array , createArray , coalesce , intersection , dataUri and dataUriToString functions.","title":"v0.6.0-B1911020 (pre-release)"},{"location":"CHANGELOG-v0/#v060-b1911011-pre-release","text":"Updated Azure.AKS.Version to 1.14.8. #140 Updated rules to use type pre-conditions. #144 Experimental : Added support for exporting rule data from templates. #145 Added Export-AzTemplateRuleData cmdlet to export templates. See cmdlet help for limitations. Template and parameters are merged, resolving functions, copy loops and conditions.","title":"v0.6.0-B1911011 (pre-release)"},{"location":"CHANGELOG-v0/#v050","text":"What's changed since v0.4.0: New rules: Virtual machines: Check Windows automatic updates are enabled. #132 Check VM agent is automatically provisioned. #131 Updated rules: Azure Kubernetes Services: Updated Azure.AKS.Version to 1.14.6. #130 General improvements: Shorten rule names for virtual machined to Azure.VM.* to improve output display. #119 Breaking change : Rules have been renamed from Azure.VirtualMachine.* to Azure.VM.* . What's changed since pre-release v0.5.0-B1910004: No additional changes.","title":"v0.5.0"},{"location":"CHANGELOG-v0/#v050-b1910004-pre-release","text":"Added rule to verify Windows automatic updates are enabled. #132 Added rule to verify VM agent is automatically provisioned. #131 Updated Azure.AKS.Version to 1.14.6. #130 Breaking change : Renamed Azure.VirtualMachine.* rules to Azure.VM.* . #119","title":"v0.5.0-B1910004 (pre-release)"},{"location":"CHANGELOG-v0/#v040","text":"What's changed since v0.3.0: New rules: Virtual machines: Added rule to verify Azure Disk Encryption. #122 Added rule to check if public key is used for Linux. #123 Virtual networking: Added rule to verify connectivity of VNET peers. #120 Added rule to check configuration of HTTP/ HTTPS load balancer probes. #121 General improvements: Removed dependency on Az.Storage module. #105 Added default baseline to module. #126 What's changed since pre-release v0.4.0-B190902: Added default baseline to module. #126","title":"v0.4.0"},{"location":"CHANGELOG-v0/#v040-b190902-pre-release","text":"Added rule to verify connectivity of VNET peers. #120 Added rule to check configuration of HTTP/ HTTPS load balancer probes. #121 Added rule to verify Azure Disk Encryption. #122 Added rule to check if public key is used for Linux. #123 Removed dependency on Az.Storage module. #105","title":"v0.4.0-B190902 (pre-release)"},{"location":"CHANGELOG-v0/#v030","text":"What's changed since v0.2.0: New rules: App Services: Enforce minimum TLS version for App Service. #99 Resource clean up: Network security groups that are not associated. #93 Unattached network interfaces. #92 Role assignment: Added subscription RBAC delegation rules. #107 Check for number of subscription owners. Check for RBAC inheritance from management groups. Check for user RBAC assignments. Check for RBAC delegation on individual resources. Virtual machines: VMs should avoid using expired promo SKUs. #87 VMs should avoid using basic SKUs. #69 Virtual networking: Added NSG rule to check for lateral traversal security rules. #103 Added rule to detect deny all inbound NSG rule. #94 Updated rules: App Services: Updated App Service site rules to include slots. #100 Azure.AppService.ARRAffinity and Azure.AppService.UseHTTPS now run against slots. Azure Kubernetes Services: Updated Azure.AKS.Version to 1.14.5. #109 Bug fixes: Fix handling of empty DNS servers in Azure.VirtualNetwork.LocalDNS . #84 Fix handling of no peering connections in Azure.VirtualNetwork.LocalDNS . #89 Fix export of additional properties for Microsoft.Sql/servers . #114 Excluded global services from Azure.Resource.AllowedRegions. #96 What's changed since pre-release v0.3.0-B190807: Fix export of additional properties for Microsoft.Sql/servers . #114","title":"v0.3.0"},{"location":"CHANGELOG-v0/#v030-b190807-pre-release","text":"Updated Azure.AKS.Version to 1.14.5. #109 Added subscription RBAC delegation rules. #107 Check for number of subscription owners. Check for RBAC inheritance from management groups. Check for user RBAC assignments. Check for RBAC delegation on individual resources.","title":"v0.3.0-B190807 (pre-release)"},{"location":"CHANGELOG-v0/#v030-b190723-pre-release","text":"Excluded global services from Azure.Resource.AllowedRegions. #96 Enforce minimum TLS version for App Service. #99 Updated App Service site rules to include slots. #100 Azure.AppService.ARRAffinity and Azure.AppService.UseHTTPS now run against slots. Added rule to detect deny all inbound NSG rule. #94 Added unused resource rules. Network security groups that are not associated. #93 Unattached network interfaces. #92 Added NSG rule to check for lateral traversal security rules. #103","title":"v0.3.0-B190723 (pre-release)"},{"location":"CHANGELOG-v0/#v030-b190710-pre-release","text":"Fix handling of empty DNS servers in Azure.VirtualNetwork.LocalDNS . #84 Fix handling of no peering connections in Azure.VirtualNetwork.LocalDNS . #89 Updated AKS version in Azure.AKS.Version to 1.13.7. #83 Added VM SKU rules: VMs should avoid using expired promo SKUs. #87 VMs should avoid using basic SKUs. #69","title":"v0.3.0-B190710 (pre-release)"},{"location":"CHANGELOG-v0/#v020","text":"What's changed since v0.1.0: Fix rule Azure.AKS.UseRBAC returns null. #60 Fix rule Azure.Storage.SoftDelete and Azure.Storage.SecureTransferRequired returns null. #64 Fix collection of ASR vault configuration for cmdlet deprecation. #63 Updated rules to use Recommend keyword instead of Hint alias. #71 Added SQL firewall rule range check to determine an excessive number of permitted IP addresses. #3 #10 #54 The rules Azure.SQL.FirewallIPRange , Azure.MySQL.FirewallIPRange and Azure.PostgreSQL.FirewallIPRange were added to check SQL, MySQL and PostgreSQL. Added parameters to filter resource export by resource group and/ or tag. #59 Added -ResourceGroupName and -Tag parameters to Export-AzRuleData cmdlet. Added support for Application Gateway v2. #75 Added VNET rule to check for local DNS. #68 Added WAF hardening rules for Application Gateway. #78 Application Gateways use OWASP 3.x rules. Application Gateways have WAF enabled. Application Gateways have all OWASP rules enabled. What's changed since pre-release v0.2.0-B190715: No additional changes.","title":"v0.2.0"},{"location":"CHANGELOG-v0/#v020-b190715-pre-release","text":"Added support for Application Gateway v2. #75 Added VNET rule to check for local DNS. #68 Added WAF hardening rules for Application Gateway. #78 Application Gateways use OWASP 3.x rules. Application Gateways have WAF enabled. Application Gateways have all OWASP rules enabled.","title":"v0.2.0-B190715 (pre-release)"},{"location":"CHANGELOG-v0/#v020-b190706-pre-release","text":"Fix rule Azure.AKS.UseRBAC returns null. #60 Fix rule Azure.Storage.SoftDelete and Azure.Storage.SecureTransferRequired returns null. #64 Fix collection of ASR vault configuration for cmdlet deprecation. #63 Added SQL firewall rule range check to determine an excessive number of permitted IP addresses. #3 #10 #54 The rules Azure.SQL.FirewallIPRange , Azure.MySQL.FirewallIPRange and Azure.PostgreSQL.FirewallIPRange were added to check SQL, MySQL and PostgreSQL. Updated rules to use Recommend keyword instead of Hint alias. #71 Added parameters to filter resource export by resource group and/ or tag. #59 Added -ResourceGroupName and -Tag parameters to Export-AzRuleData cmdlet.","title":"v0.2.0-B190706 (pre-release)"},{"location":"CHANGELOG-v0/#v010","text":"Initial release. What's changed since pre-release v0.1.0-B190624: No additional changes.","title":"v0.1.0"},{"location":"CHANGELOG-v0/#v010-b190624-pre-release","text":"Added rule to check if allow access to Azure services enabled for MySQL. #4 Added rule to count the number of database server firewall rules for MySQL. #2 Added rule to check if allow access to Azure services enabled for PostgreSQL. #50 Added rule to count the number of database server firewall rules for PostgreSQL. #51 Added rule to check if SSL is enforced for PostgreSQL. #49","title":"v0.1.0-B190624 (pre-release)"},{"location":"CHANGELOG-v0/#v010-b190607-pre-release","text":"Added rule documentation. #40","title":"v0.1.0-B190607 (pre-release)"},{"location":"CHANGELOG-v0/#v010-b190569-pre-release","text":"Fix exported resource data overwritten. #34","title":"v0.1.0-B190569 (pre-release)"},{"location":"CHANGELOG-v0/#v010-b190562-pre-release","text":"Add units tests for Export-AzRuleData and update filters. #28 Export-AzRuleData returns files generated by default. #27 Export-AzRuleData passes through objects resource objects to the pipeline. #25 Breaking change - Export-AzRuleData only exports data from current subscription context by default. #24 Data can be exported from all subscription contexts by using the -All switch, or specifying specific subscriptions with the -Subscription or -Tenant parameters.","title":"v0.1.0-B190562 (pre-release)"},{"location":"CHANGELOG-v0/#v010-b190543-pre-release","text":"Fix cannot find the type for custom attribute error. #21","title":"v0.1.0-B190543 (pre-release)"},{"location":"CHANGELOG-v0/#v010-b190536-pre-release","text":"Initial pre-release.","title":"v0.1.0-B190536 (pre-release)"},{"location":"CHANGELOG-v1/","text":"Change log # See upgrade notes for helpful information when upgrading from previous versions. Important notes : Issue #741: Could not load file or assembly YamlDotNet . See troubleshooting guide for a workaround to this issue. The configuration option Azure_AKSMinimumVersion is replaced with AZURE_AKS_CLUSTER_MINIMUM_VERSION . If you have this option configured, please update it to AZURE_AKS_CLUSTER_MINIMUM_VERSION . Support for Azure_AKSMinimumVersion will be removed in v2. See upgrade notes for more information. The SupportsTag PowerShell function has been replaced with the Azure.Resource.SupportsTags selector. Update PowerShell rules to use the Azure.Resource.SupportsTags selector instead. Support for the SupportsTag function will be removed in v2. See upgrade notes for more information. Unreleased # New rules: CDN: Check CDN profile used Front Door Standard or Premium tier by @bengeset96. #1612 v1.20.0-B0004 (pre-release) # What's changed since v1.19.1: New rules: Azure Resources: Check that nested deployments securely pass through administrator usernames by @ms-sambell. #1479 Engineering: Bump Microsoft.NET.Test.Sdk to v17.3.1. #1603 v1.19.1 # What's changed since v1.19.0: Bug fixes: Fixed Azure.VNET.UseNSGs is missing exceptions by @BernieWhite. #1609 Added exclusions for RouteServerSubnet and any subnet with a dedicated HSM delegation. v1.19.0 # What's changed since v1.18.1: New rules: Azure Kubernetes Service: Check clusters use uptime SLA by @bengeset96. #1601 General improvements: Updated rule level for the following rules by @BernieWhite. #1551 Set Azure.APIM.APIDescriptors to warning from error. Set Azure.APIM.ProductDescriptors to warning from error. Set Azure.Template.UseLocationParameter to warning from error. Set Azure.Template.UseComments to information from error. Set Azure.Template.UseDescriptions to information from error. Improve reporting of failing resource property for rules by @BernieWhite. #1429 Engineering: Added publishing of symbols for NuGet packages by @BernieWhite. #1549 Bump Az.Resources to v6.1.0. #1557 Bump Microsoft.NET.Test.Sdk to v17.3.0. #1563 Bump PSRule to v2.3.2. #1574 Bump support projects to .NET 6 by @BernieWhite. #1560 Bump BenchmarkDotNet to v0.13.2. #1593 Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.2. #1594 Updated provider data for analysis. #1598 Bug fixes: Fixed parameter files linked to bicep code via naming convention is not working by @BernieWhite. #1582 Fixed handling of storage accounts sub-resources with CMK by @BernieWhite. #1575 What's changed since pre-release v1.19.0-B0077: No additional changes. v1.19.0-B0077 (pre-release) # What's changed since pre-release v1.19.0-B0042: New rules: Azure Kubernetes Service: Check clusters use uptime SLA by @bengeset96. #1601 v1.19.0-B0042 (pre-release) # What's changed since pre-release v1.19.0-B0010: General improvements: Improve reporting of failing resource property for rules by @BernieWhite. #1429 Engineering: Bump PSRule to v2.3.2. #1574 Bump support projects to .NET 6 by @BernieWhite. #1560 Bump BenchmarkDotNet to v0.13.2. #1593 Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.2. #1594 Updated provider data for analysis. #1598 Bug fixes: Fixed parameter files linked to bicep code via naming convention is not working by @BernieWhite. #1582 Fixed handling of storage accounts sub-resources with CMK by @BernieWhite. #1575 v1.19.0-B0010 (pre-release) # What's changed since v1.18.1: General improvements: Updated rule level for the following rules by @BernieWhite. #1551 Set Azure.APIM.APIDescriptors to warning from error. Set Azure.APIM.ProductDescriptors to warning from error. Set Azure.Template.UseLocationParameter to warning from error. Set Azure.Template.UseComments to information from error. Set Azure.Template.UseDescriptions to information from error. Engineering: Added publishing of symbols for NuGet packages by @BernieWhite. #1549 Bump PSRule to v2.3.1. #1561 Bump Az.Resources to v6.1.0. #1557 Bump Microsoft.NET.Test.Sdk to v17.3.0. #1563 v1.18.1 # What's changed since v1.18.0: Bug fixes: Fixed Azure.APIM.HTTPBackend reports failure when service URL is not defined by @BernieWhite. #1555 Fixed Azure.SQL.AAD failure with newer API by @BernieWhite. #1302 v1.18.0 # What's changed since v1.17.1: New rules: Cognitive Services: Check accounts use network access restrictions by @BernieWhite. #1532 Check accounts use managed identities to access Azure resources by @BernieWhite. #1532 Check accounts only accept requests using Azure AD identities by @BernieWhite. #1532 Check accounts disable access using public endpoints by @BernieWhite. #1532 General improvements: Added support for array indexOf , lastIndexOf , and items ARM functions by @BernieWhite. #1440 Added support for join ARM function by @BernieWhite. #1535 Improved output of full path to emitted resources by @BernieWhite. #1523 Engineering: Bump Az.Resources to v6.0.1. #1521 Updated provider data for analysis. #1540 Bump xunit to v2.4.2. #1542 Added readme and tags to NuGet by @BernieWhite. #1513 Bug fixes: Fixed Azure.SQL.TDE is not required to enable Transparent Data Encryption for IaC by @BernieWhite. #1530 What's changed since pre-release v1.18.0-B0027: No additional changes. v1.18.0-B0027 (pre-release) # What's changed since pre-release v1.18.0-B0010: New rules: Cognitive Services: Check accounts use network access restrictions by @BernieWhite. #1532 Check accounts use managed identities to access Azure resources by @BernieWhite. #1532 Check accounts only accept requests using Azure AD identities by @BernieWhite. #1532 Check accounts disable access using public endpoints by @BernieWhite. #1532 General improvements: Added support for array indexOf , lastIndexOf , and items ARM functions by @BernieWhite. #1440 Added support for join ARM function by @BernieWhite. #1535 Engineering: Updated provider data for analysis. #1540 Bump xunit to v2.4.2. #1542 Bug fixes: Fixed Azure.SQL.TDE is not required to enable Transparent Data Encryption for IaC by @BernieWhite. #1530 v1.18.0-B0010 (pre-release) # What's changed since pre-release v1.18.0-B0002: General improvements: Improved output of full path to emitted resources by @BernieWhite. #1523 Engineering: Bump Az.Resources to v6.0.1. #1521 v1.18.0-B0002 (pre-release) # What's changed since v1.17.1: Engineering: Added readme and tags to NuGet by @BernieWhite. #1513 v1.17.1 # What's changed since v1.17.0: Bug fixes: Fixed union returns null when merged with built-in expansion objects by @BernieWhite. #1515 Fixed missing zones in test for standalone VM by @BernieWhite. #1506 v1.17.0 # What's changed since v1.16.1: New features: Added more field count expression support for Azure Policy JSON rules by @ArmaanMcleod. #181 Added June 2022 baselines Azure.GA_2022_06 and Azure.Preview_2022_06 by @BernieWhite. #1499 Includes rules released before or during June 2022. Marked Azure.GA_2022_03 and Azure.Preview_2022_03 baselines as obsolete. New rules: Deployment: Check for secure values in outputs by @BernieWhite. #297 Engineering: Bump Newtonsoft.Json to v13.0.1. #1494 Updated NuGet packaging metadata by @BernieWhite. #1428 Updated provider data for analysis. #1502 Bump PSRule to v2.2.0. #1444 Updated NuGet packaging metadata by @BernieWhite. #1428 Bug fixes: Fixed TDE property status to state by @Dylan-Prins. #1505 Fixed the language expression value fails in outputs by @BernieWhite. #1485 What's changed since pre-release v1.17.0-B0064: No additional changes. v1.17.0-B0064 (pre-release) # What's changed since pre-release v1.17.0-B0035: Engineering: Updated provider data for analysis. #1502 Bump PSRule to v2.2.0. #1444 Bug fixes: Fixed TDE property status to state by @Dylan-Prins. #1505 v1.17.0-B0035 (pre-release) # What's changed since pre-release v1.17.0-B0014: New features: Added June 2022 baselines Azure.GA_2022_06 and Azure.Preview_2022_06 by @BernieWhite. #1499 Includes rules released before or during June 2022. Marked Azure.GA_2022_03 and Azure.Preview_2022_03 baselines as obsolete. Engineering: Bump Newtonsoft.Json to v13.0.1. #1494 Updated NuGet packaging metadata by @BernieWhite. #1428 v1.17.0-B0014 (pre-release) # What's changed since v1.16.1: New features: Added more field count expression support for Azure Policy JSON rules by @ArmaanMcleod. #181 New rules: Deployment: Check for secure values in outputs by @BernieWhite. #297 Engineering: Updated NuGet packaging metadata by @BernieWhite. #1428 Bug fixes: Fixed the language expression value fails in outputs by @BernieWhite. #1485 v1.16.1 # What's changed since v1.16.0: Bug fixes: Fixed TLS 1.3 support in Azure.AppGw.SSLPolicy by @BernieWhite. #1469 Fixed Application Gateway referencing a WAF policy by @BernieWhite. #1466 v1.16.0 # What's changed since v1.15.2: New rules: App Service: Check web apps have insecure FTP disabled by @BernieWhite. #1436 Check web apps use a dedicated health probe by @BernieWhite. #1437 Updated rules: Public IP: Updated Azure.PublicIP.AvailabilityZone to exclude IP addresses for Azure Bastion by @BernieWhite. #1442 Public IP addresses with the resource-usage tag set to azure-bastion are excluded. General improvements: Added support for dateTimeFromEpoch and dateTimeToEpoch ARM functions by @BernieWhite. #1451 Engineering: Updated built documentation to include rule ref and metadata by @BernieWhite. #1432 Added ref properties for several rules by @BernieWhite. #1430 Updated provider data for analysis. #1453 Bump Microsoft.NET.Test.Sdk to v17.2.0. #1410 Update CI checks to include required ref property by @BernieWhite. #1431 Added ref properties for rules by @BernieWhite. #1430 Bug fixes: Fixed Azure.Template.UseVariables does not accept function variables names by @BernieWhite. #1427 Fixed dependency issue within Azure Pipelines AzurePowerShell task by @BernieWhite. #1447 Removed dependency on Az.Accounts and Az.Resources from manifest. Pre-install these modules to use export cmdlets. What's changed since pre-release v1.16.0-B0072: No additional changes. v1.16.0-B0072 (pre-release) # What's changed since pre-release v1.16.0-B0041: Engineering: Update CI checks to include required ref property by @BernieWhite. #1431 Added ref properties for rules by @BernieWhite. #1430 Bug fixes: Fixed dependency issue within Azure Pipelines AzurePowerShell task by @BernieWhite. #1447 Removed dependency on Az.Accounts and Az.Resources from manifest. Pre-install these modules to use export cmdlets. v1.16.0-B0041 (pre-release) # What's changed since pre-release v1.16.0-B0017: Updated rules: Public IP: Updated Azure.PublicIP.AvailabilityZone to exclude IP addresses for Azure Bastion by @BernieWhite. #1442 Public IP addresses with the resource-usage tag set to azure-bastion are excluded. General improvements: Added support for dateTimeFromEpoch and dateTimeToEpoch ARM functions by @BernieWhite. #1451 Engineering: Updated built documentation to include rule ref and metadata by @BernieWhite. #1432 Added ref properties for several rules by @BernieWhite. #1430 Updated provider data for analysis. #1453 v1.16.0-B0017 (pre-release) # What's changed since v1.15.2: New rules: App Service: Check web apps have insecure FTP disabled by @BernieWhite. #1436 Check web apps use a dedicated health probe by @BernieWhite. #1437 Engineering: Bump Microsoft.NET.Test.Sdk to v17.2.0. #1410 Bug fixes: Fixed Azure.Template.UseVariables does not accept function variables names by @BernieWhite. #1427 v1.15.2 # What's changed since v1.15.1: Bug fixes: Fixed Azure.AppService.ManagedIdentity does not accept both system and user assigned by @BernieWhite. #1415 This also applies to: Azure.ADX.ManagedIdentity Azure.APIM.ManagedIdentity Azure.EventGrid.ManagedIdentity Azure.Automation.ManagedIdentity Fixed Web apps with .NET 6 do not meet version constraint of Azure.AppService.NETVersion by @BernieWhite. #1414 This also applies to Azure.AppService.PHPVersion . v1.15.1 # What's changed since v1.15.0: Bug fixes: Fixed exclusion of dataCollectionRuleAssociations from Azure.Resource.UseTags by @BernieWhite. #1400 Fixed could not determine JSON object type for MockObject using CreateObject by @BernieWhite. #1411 Fixed cannot bind argument to parameter 'Sku' because it is an empty string by @BernieWhite. #1407 v1.15.0 # What's changed since v1.14.3: New features: Important change : Added Azure.Resource.SupportsTags selector by @BernieWhite. #1339 Use this selector in custom rules to filter rules to only run against resources that support tags. This selector replaces the SupportsTags PowerShell function. Using the SupportsTag function will now result in a warning. The SupportsTags function will be removed in v2. See upgrade notes for more information. Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to use latest stable version 1.22.6 by @BernieWhite. #1386 Use AZURE_AKS_CLUSTER_MINIMUM_VERSION to configure the minimum version of the cluster. Engineering: Added code signing of module by @BernieWhite. #1379 Added SBOM manifests to module by @BernieWhite. #1380 Embedded provider and alias information as manifest resources by @BernieWhite. #1383 Resources are minified and compressed to improve size and speed. Added additional nodeps manifest that does not include dependencies for Az modules by @BernieWhite. #1392 Bump Az.Accounts to 2.7.6. #1338 Bump Az.Resources to 5.6.0. #1338 Bump PSRule to 2.1.0. #1338 Bump Pester to 5.3.3. #1338 Bug fixes: Fixed dependency chain order when dependsOn copy by @BernieWhite. #1381 Fixed error calling SupportsTags function by @BernieWhite. #1401 What's changed since pre-release v1.15.0-B0053: Bug fixes: Fixed error calling SupportsTags function by @BernieWhite. #1401 v1.15.0-B0053 (pre-release) # What's changed since pre-release v1.15.0-B0022: New features: Important change : Added Azure.Resource.SupportsTags selector. #1339 Use this selector in custom rules to filter rules to only run against resources that support tags. This selector replaces the SupportsTags PowerShell function. Using the SupportsTag function will now result in a warning. The SupportsTags function will be removed in v2. See upgrade notes for more information. Engineering: Embedded provider and alias information as manifest resources. #1383 Resources are minified and compressed to improve size and speed. Added additional nodeps manifest that does not include dependencies for Az modules. #1392 Bump Az.Accounts to 2.7.6. #1338 Bump Az.Resources to 5.6.0. #1338 Bump PSRule to 2.1.0. #1338 Bump Pester to 5.3.3. #1338 v1.15.0-B0022 (pre-release) # What's changed since v1.14.3: Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to use latest stable version 1.22.6 . #1386 Use AZURE_AKS_CLUSTER_MINIMUM_VERSION to configure the minimum version of the cluster. Engineering: Added code signing of module. #1379 Added SBOM manifests to module. #1380 Bug fixes: Fixed dependency chain order when dependsOn copy. #1381 v1.14.3 # What's changed since v1.14.2: Bug fixes: Fixed Azure Firewall threat intel mode reported for Secure VNET hubs. #1365 Fixed array function handling with mock objects. #1367 v1.14.2 # What's changed since v1.14.1: Bug fixes: Fixed handling of parent resources when sub resource is in a separate deployment. #1360 v1.14.1 # What's changed since v1.14.0: Bug fixes: Fixed unable to set parameter defaults option with type object. #1355 v1.14.0 # What's changed since v1.13.4: New features: Added support for referencing resources in template. #1315 The reference() function can be used to reference resources in template. A placeholder value is still used for resources outside of the template. Added March 2022 baselines Azure.GA_2022_03 and Azure.Preview_2022_03 . #1334 Includes rules released before or during March 2022. Marked Azure.GA_2021_12 and Azure.Preview_2021_12 baselines as obsolete. Experimental : Cmdlets to validate objects with Azure policy conditions: Export-AzPolicyAssignmentData - Exports policy assignment data. #1266 Export-AzPolicyAssignmentRuleData - Exports JSON rules from policy assignment data. #1278 Get-AzPolicyAssignmentDataSource - Discovers policy assignment data. #1340 See cmdlet help for limitations and usage. Additional information will be posted as this feature evolves here . New rules: SignalR Service: Check services use Managed Identities. #1306 Check services use a SKU with an SLA. #1307 Web PubSub Service: Check services use Managed Identities. #1308 Check services use a SKU with an SLA. #1309 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to use latest stable version 1.21.9 . #1318 Use AZURE_AKS_CLUSTER_MINIMUM_VERSION to configure the minimum version of the cluster. Engineering: Cache Azure Policy Aliases. #1277 Cleanup of additional alias metadata. #1351 Bug fixes: Fixed index was out of range with split on mock properties. #1327 Fixed mock objects with no properties. #1347 Fixed sub-resources nesting by scope regression. #1348 Fixed expand of runtime properties on reference objects. #1324 Fixed processing of deployment outputs. #1316 What's changed since pre-release v1.14.0-B2204013: No additional changes. v1.14.0-B2204013 (pre-release) # What's changed since pre-release v1.14.0-B2204007: Engineering: Cleanup of additional alias metadata. #1351 v1.14.0-B2204007 (pre-release) # What's changed since pre-release v1.14.0-B2203117: Bug fixes: Fixed mock objects with no properties. #1347 Fixed sub-resources nesting by scope regression. #1348 v1.14.0-B2203117 (pre-release) # What's changed since pre-release v1.14.0-B2203088: New features: Experimental : Cmdlets to validate objects with Azure policy conditions: Export-AzPolicyAssignmentData - Exports policy assignment data. #1266 Export-AzPolicyAssignmentRuleData - Exports JSON rules from policy assignment data. #1278 Get-AzPolicyAssignmentDataSource - Discovers policy assignment data. #1340 See cmdlet help for limitations and usage. Additional information will be posted as this feature evolves here . Engineering: Cache Azure Policy Aliases. #1277 Bug fixes: Fixed index was out of range with split on mock properties. #1327 v1.14.0-B2203088 (pre-release) # What's changed since pre-release v1.14.0-B2203066: New features: Added March 2022 baselines Azure.GA_2022_03 and Azure.Preview_2022_03 . #1334 Includes rules released before or during March 2022. Marked Azure.GA_2021_12 and Azure.Preview_2021_12 baselines as obsolete. Bug fixes: Fixed expand of runtime properties on reference objects. #1324 v1.14.0-B2203066 (pre-release) # What's changed since v1.13.4: New features: Added support for referencing resources in template. #1315 The reference() function can be used to reference resources in template. A placeholder value is still used for resources outside of the template. New rules: SignalR Service: Check services use Managed Identities. #1306 Check services use a SKU with an SLA. #1307 Web PubSub Service: Check services use Managed Identities. #1308 Check services use a SKU with an SLA. #1309 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to use latest stable version 1.21.9 . #1318 Use AZURE_AKS_CLUSTER_MINIMUM_VERSION to configure the minimum version of the cluster. Bug fixes: Fixed processing of deployment outputs. #1316 v1.13.4 # What's changed since v1.13.3: Bug fixes: Fixed virtual network without any subnets is invalid. #1303 Fixed container registry rules that require a premium tier. #1304 Rules Azure.ACR.Retention and Azure.ACR.ContentTrust are now only run against premium instances. v1.13.3 # What's changed since v1.13.2: Bug fixes: Fixed bicep build timeout for complex deployments. #1299 v1.13.2 # What's changed since v1.13.1: Engineering: Bump PowerShellStandard.Library to 5.1.1. #1295 Bug fixes: Fixed nested resource loops. #1293 v1.13.1 # What's changed since v1.13.0: Bug fixes: Fixed parsing of nested quote pairs within JSON function. #1288 v1.13.0 # What's changed since v1.12.2: New features: Added support for setting defaults for required parameters. #1065 When specified, the value will be used when a parameter value is not provided. Added support expanding Bicep from parameter files. #1160 New rules: Azure Cache for Redis: Limit public access for Azure Cache for Redis instances. #935 Container App: Check insecure ingress is not enabled (preview). #1252 Key Vault: Check key auto-rotation is enabled (preview). #1159 Recovery Services Vault: Check vaults have replication alerts configured. #7 Engineering: Automatically build baseline docs. #1242 Bump PSRule dependency to v1.11.1. #1269 Bug fixes: Fixed empty value with strong type. #1258 Fixed error with empty logic app trigger. #1249 Fixed out of order parameters. #1257 Fixed mapping default configuration causes cast exception. #1274 Fixed resource id is incorrectly built for sub resource types. #1279 What's changed since pre-release v1.13.0-B2202113: No additional changes. v1.13.0-B2202113 (pre-release) # What's changed since pre-release v1.13.0-B2202108: Bug fixes: Fixed resource id is incorrectly built for sub resource types. #1279 v1.13.0-B2202108 (pre-release) # What's changed since pre-release v1.13.0-B2202103: Bug fixes: Fixed mapping default configuration causes cast exception. #1274 v1.13.0-B2202103 (pre-release) # What's changed since pre-release v1.13.0-B2202090: Engineering: Bump PSRule dependency to v1.11.1. #1269 Bug fixes: Fixed out of order parameters. #1257 v1.13.0-B2202090 (pre-release) # What's changed since pre-release v1.13.0-B2202063: New rules: Azure Cache for Redis: Limit public access for Azure Cache for Redis instances. #935 Engineering: Automatically build baseline docs. #1242 Bug fixes: Fixed empty value with strong type. #1258 v1.13.0-B2202063 (pre-release) # What's changed since v1.12.2: New features: Added support for setting defaults for required parameters. #1065 When specified, the value will be used when a parameter value is not provided. Added support expanding Bicep from parameter files. #1160 New rules: Container App: Check insecure ingress is not enabled (preview). #1252 Key Vault: Check key auto-rotation is enabled (preview). #1159 Recovery Services Vault: Check vaults have replication alerts configured. #7 Bug fixes: Fixed error with empty logic app trigger. #1249 v1.12.2 # What's changed since v1.12.1: Bug fixes: Fixed detect strong type requirements for nested deployments. #1235 v1.12.1 # What's changed since v1.12.0: Bug fixes: Fixed Bicep already exists with PSRule v2. #1232 v1.12.0 # What's changed since v1.11.1: New rules: Data Explorer: Check clusters use Managed Identities. #1207 Check clusters use a SKU with a SLA. #1208 Check clusters use disk encryption. #1209 Check clusters are in use with databases. #1215 Event Hub: Check namespaces are in use with event hubs. #1216 Check namespaces only accept identity-based authentication. #1217 Azure Recovery Services Vault: Check vaults use geo-redundant storage. #5 Service Bus: Check namespaces are in use with queues and topics. #1218 Check namespaces only accept identity-based authentication. #1219 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to use latest stable version 1.21.7 . #1188 Pinned latest GA baseline Azure.GA_2021_12 to previous version 1.20.5 . Use AZURE_AKS_CLUSTER_MINIMUM_VERSION to configure the minimum version of the cluster. Azure API Management: Check service disabled insecure ciphers. #1128 Refactored the cipher and protocol rule into individual rules. Azure.APIM.Protocols Azure.APIM.Ciphers General improvements: Important change: Replaced Azure_AKSMinimumVersion option with AZURE_AKS_CLUSTER_MINIMUM_VERSION . #941 For compatibility, if Azure_AKSMinimumVersion is set it will be used instead of AZURE_AKS_CLUSTER_MINIMUM_VERSION . If only AZURE_AKS_CLUSTER_MINIMUM_VERSION is set, this value will be used. The default will be used neither options are configured. If Azure_AKSMinimumVersion is set a warning will be generated until the configuration is removed. Support for Azure_AKSMinimumVersion is deprecated and will be removed in v2. See upgrade notes for details. Bug fixes: Fixed false positive of blob container with access unspecified. #1212 What's changed since pre-release v1.12.0-B2201086: No additional changes. v1.12.0-B2201086 (pre-release) # What's changed since pre-release v1.12.0-B2201067: New rules: Data Explorer: Check clusters are in use with databases. #1215 Event Hub: Check namespaces are in use with event hubs. #1216 Check namespaces only accept identity-based authentication. #1217 Azure Recovery Services Vault: Check vaults use geo-redundant storage. #5 Service Bus: Check namespaces are in use with queues and topics. #1218 Check namespaces only accept identity-based authentication. #1219 v1.12.0-B2201067 (pre-release) # What's changed since pre-release v1.12.0-B2201054: New rules: Data Explorer: Check clusters use Managed Identities. #1207 Check clusters use a SKU with a SLA. #1208 Check clusters use disk encryption. #1209 Bug fixes: Fixed false positive of blob container with access unspecified. #1212 v1.12.0-B2201054 (pre-release) # What's changed since v1.11.1: Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to use latest stable version 1.21.7 . #1188 Pinned latest GA baseline Azure.GA_2021_12 to previous version 1.20.5 . Use AZURE_AKS_CLUSTER_MINIMUM_VERSION to configure the minimum version of the cluster. Azure API Management: Check service disabled insecure ciphers. #1128 Refactored the cipher and protocol rule into individual rules. Azure.APIM.Protocols Azure.APIM.Ciphers General improvements: Important change: Replaced Azure_AKSMinimumVersion option with AZURE_AKS_CLUSTER_MINIMUM_VERSION . #941 For compatibility, if Azure_AKSMinimumVersion is set it will be used instead of AZURE_AKS_CLUSTER_MINIMUM_VERSION . If only AZURE_AKS_CLUSTER_MINIMUM_VERSION is set, this value will be used. The default will be used neither options are configured. If Azure_AKSMinimumVersion is set a warning will be generated until the configuration is removed. Support for Azure_AKSMinimumVersion is deprecated and will be removed in v2. See upgrade notes for details. v1.11.1 # What's changed since v1.11.0: Bug fixes: Fixed Azure.AKS.CNISubnetSize rule to use CNI selector. #1178 v1.11.0 # What's changed since v1.10.4: New features: Added baselines containing only Azure preview features. #1129 Added baseline Azure.Preview_2021_09 . Added baseline Azure.Preview_2021_12 . Added Azure.GA_2021_12 baseline. #1146 Includes rules released before or during December 2021 for Azure GA features. Marked baseline Azure.GA_2021_09 as obsolete. Bicep support promoted from experimental to generally available (GA). #1176 New rules: All resources: Check comments for each template resource. #969 Automation Account: Automation accounts should enable diagnostic logs. #1075 Azure Kubernetes Service: Check clusters have the HTTP application routing add-on disabled. #1131 Check clusters use the Secrets Store CSI Driver add-on. #992 Check clusters autorotation with the Secrets Store CSI Driver add-on. #993 Check clusters use Azure AD Pod Managed Identities (preview). #991 Azure Redis Cache: Use availability zones for Azure Cache for Redis for regions that support it. #1078 Azure.Redis.AvailabilityZone Azure.RedisEnterprise.Zones Application Security Group: Check Application Security Groups meet naming requirements. #1110 Firewall: Check Firewalls meet naming requirements. #1110 Check Firewall policies meet naming requirements. #1110 Private Endpoint: Check Private Endpoints meet naming requirements. #1110 Virtual WAN: Check Virtual WANs meet naming requirements. #1110 Updated rules: Azure Kubernetes Service: Promoted Azure.AKS.AutoUpgrade to GA rule set. #1130 General improvements: Added support for template function tenant() . #1124 Added support for template function managementGroup() . #1125 Added support for template function pickZones() . #518 Engineering: Rule refactoring of rules from PowerShell to YAML. #1109 The following rules were refactored: Azure.LB.Name Azure.NSG.Name Azure.Firewall.Mode Azure.Route.Name Azure.VNET.Name Azure.VNG.Name Azure.VNG.ConnectionName Azure.AppConfig.SKU Azure.AppConfig.Name Azure.AppInsights.Workspace Azure.AppInsights.Name Azure.Cosmos.AccountName Azure.FrontDoor.State Azure.FrontDoor.Name Azure.FrontDoor.WAF.Mode Azure.FrontDoor.WAF.Enabled Azure.FrontDoor.WAF.Name Azure.AKS.MinNodeCount Azure.AKS.ManagedIdentity Azure.AKS.StandardLB Azure.AKS.AzurePolicyAddOn Azure.AKS.ManagedAAD Azure.AKS.AuthorizedIPs Azure.AKS.LocalAccounts Azure.AKS.AzureRBAC Bug fixes: Fixed output of Bicep informational and warning messages in error stream. #1157 What's changed since pre-release v1.11.0-B2112112: New features: Bicep support promoted from experimental to generally available (GA). #1176 v1.11.0-B2112112 (pre-release) # What's changed since pre-release v1.11.0-B2112104: New rules: Azure Redis Cache: Use availability zones for Azure Cache for Redis for regions that support it. #1078 Azure.Redis.AvailabilityZone Azure.RedisEnterprise.Zones v1.11.0-B2112104 (pre-release) # What's changed since pre-release v1.11.0-B2112073: New rules: Azure Kubernetes Service: Check clusters use Azure AD Pod Managed Identities (preview). #991 Engineering: Rule refactoring of rules from PowerShell to YAML. #1109 The following rules were refactored: Azure.AppConfig.SKU Azure.AppConfig.Name Azure.AppInsights.Workspace Azure.AppInsights.Name Azure.Cosmos.AccountName Azure.FrontDoor.State Azure.FrontDoor.Name Azure.FrontDoor.WAF.Mode Azure.FrontDoor.WAF.Enabled Azure.FrontDoor.WAF.Name Azure.AKS.MinNodeCount Azure.AKS.ManagedIdentity Azure.AKS.StandardLB Azure.AKS.AzurePolicyAddOn Azure.AKS.ManagedAAD Azure.AKS.AuthorizedIPs Azure.AKS.LocalAccounts Azure.AKS.AzureRBAC Bug fixes: Fixed output of Bicep informational and warning messages in error stream. #1157 Fixed obsolete flag for baseline Azure.Preview_2021_12 . #1166 v1.11.0-B2112073 (pre-release) # What's changed since pre-release v1.11.0-B2112024: New features: Added baselines containing only Azure preview features. #1129 Added baseline Azure.Preview_2021_09 . Added baseline Azure.Preview_2021_12 . Added Azure.GA_2021_12 baseline. #1146 Includes rules released before or during December 2021 for Azure GA features. Marked baseline Azure.GA_2021_09 as obsolete. New rules: All resources: Check comments for each template resource. #969 Bug fixes: Fixed template function equals parameter count mismatch. #1137 Fixed copy loop on nested deployment parameters is not handled. #1144 Fixed outer copy loop of nested deployment. #1154 v1.11.0-B2112024 (pre-release) # What's changed since pre-release v1.11.0-B2111014: New rules: Azure Kubernetes Service: Check clusters have the HTTP application routing add-on disabled. #1131 Check clusters use the Secrets Store CSI Driver add-on. #992 Check clusters autorotation with the Secrets Store CSI Driver add-on. #993 Automation Account: Automation accounts should enable diagnostic logs. #1075 Updated rules: Azure Kubernetes Service: Promoted Azure.AKS.AutoUpgrade to GA rule set. #1130 General improvements: Added support for template function tenant() . #1124 Added support for template function managementGroup() . #1125 Added support for template function pickZones() . #518 Bug fixes: Fixed Azure.Policy.WaiverExpiry date conversion. #1118 v1.11.0-B2111014 (pre-release) # What's changed since v1.10.0: New rules: Application Security Group: Check Application Security Groups meet naming requirements. #1110 Firewall: Check Firewalls meet naming requirements. #1110 Check Firewall policies meet naming requirements. #1110 Private Endpoint: Check Private Endpoints meet naming requirements. #1110 Virtual WAN: Check Virtual WANs meet naming requirements. #1110 Engineering: Rule refactoring of rules from PowerShell to YAML. #1109 The following rules were refactored: Azure.LB.Name Azure.NSG.Name Azure.Firewall.Mode Azure.Route.Name Azure.VNET.Name Azure.VNG.Name Azure.VNG.ConnectionName v1.10.4 # What's changed since v1.10.3: Bug fixes: Fixed outer copy loop of nested deployment. #1154 v1.10.3 # What's changed since v1.10.2: Bug fixes: Fixed copy loop on nested deployment parameters is not handled. #1144 v1.10.2 # What's changed since v1.10.1: Bug fixes: Fixed template function equals parameter count mismatch. #1137 v1.10.1 # What's changed since v1.10.0: Bug fixes: Fixed Azure.Policy.WaiverExpiry date conversion. #1118 v1.10.0 # What's changed since v1.9.1: New features: Added support for parameter strong types. #1083 The value of string parameters can be tested against the expected type. When configuring a location strong type, the parameter value must be a valid Azure location. When configuring a resource type strong type, the parameter value must be a matching resource Id. New rules: All resources: Check template expressions do not exceed a maximum length. #1006 Automation Service: Check automation accounts should use managed identities for authentication. #1074 Event Grid: Check topics and domains use managed identities. #1091 Check topics and domains use private endpoints. #1092 Check topics and domains use identity-based authentication. #1093 General improvements: Updated default baseline to use module configuration. #1089 Engineering: Bump PSRule dependency to v1.9.0. #1081 Bump Microsoft.CodeAnalysis.NetAnalyzers to v6.0.0. #1080 Bump Microsoft.SourceLink.GitHub to 1.1.1. #1085 Bug fixes: Fixed expansion of secret references. #1098 Fixed handling of tagging for deployments. #1099 Fixed strong type issue flagged with empty defaultValue string. #1100 What's changed since pre-release v1.10.0-B2111081: No additional changes. v1.10.0-B2111081 (pre-release) # What's changed since pre-release v1.10.0-B2111072: New rules: Automation Service: Automation accounts should use managed identities for authentication. #1074 v1.10.0-B2111072 (pre-release) # What's changed since pre-release v1.10.0-B2111058: New rules: All resources: Check template expressions do not exceed a maximum length. #1006 Bug fixes: Fixed expansion of secret references. #1098 Fixed handling of tagging for deployments. #1099 Fixed strong type issue flagged with empty defaultValue string. #1100 v1.10.0-B2111058 (pre-release) # What's changed since pre-release v1.10.0-B2111040: New rules: Event Grid: Check topics and domains use managed identities. #1091 Check topics and domains use private endpoints. #1092 Check topics and domains use identity-based authentication. #1093 General improvements: Updated default baseline to use module configuration. #1089 v1.10.0-B2111040 (pre-release) # What's changed since v1.9.1: New features: Added support for parameter strong types. #1083 The value of string parameters can be tested against the expected type. When configuring a location strong type, the parameter value must be a valid Azure location. When configuring a resource type strong type, the parameter value must be a matching resource Id. Engineering: Bump PSRule dependency to v1.9.0. #1081 Bump Microsoft.CodeAnalysis.NetAnalyzers to v6.0.0. #1080 Bump Microsoft.SourceLink.GitHub to 1.1.1. #1085 v1.9.1 # What's changed since v1.9.0: Bug fixes: Fixed can not index into resource group tags. #1066 Fixed Azure.VM.ASMinMembers for template deployments. #1064 Fixed zones property not found on public IP resource. #1070 v1.9.0 # What's changed since v1.8.1: New rules: API Management Service: Check API management services are using availability zones when available. #1017 Public IP Address: Check Public IP addresses are configured with zone-redundancy. #958 Check Public IP addresses are using Standard SKU. #979 User Assigned Managed Identity: Check identities meet naming requirements. #1021 Virtual Network Gateway: Check VPN/ExpressRoute gateways are configured with availability zone SKU. #926 General improvements: Improved processing of AzOps generated templates. #799 Azure.Template.DefineParameters is ignored for AzOps generated templates. Azure.Template.UseLocationParameter is ignored for AzOps generated templates. Bicep is now installed when using PSRule GitHub Action. #1050 Engineering: Bump PSRule dependency to v1.8.0. #1018 Added automated PR workflow to bump providers.json monthly. #1041 Bug fixes: Fixed AKS Network Policy should accept calico. #1046 Fixed Azure.ACR.AdminUser fails when adminUserEnabled not set. #1014 Fixed Azure.KeyVault.Logs reports cannot index into a null array. #1024 Fixed template function empty returns object reference not set exception. #1025 Fixed delayed binding of and template function. #1026 Fixed template function array nests array with array parameters. #1027 Fixed property used by Azure.ACR.MinSKU to work more reliably with templates. #1034 Fixed could not determine JSON object type for MockMember using CreateObject. #1035 Fixed Bicep convention ordering. #1053 What's changed since pre-release v1.9.0-B2110087: No additional changes. v1.9.0-B2110087 (pre-release) # What's changed since pre-release v1.9.0-B2110082: Bug fixes: Fixed Bicep convention ordering. #1053 v1.9.0-B2110082 (pre-release) # What's changed since pre-release v1.9.0-B2110059: General improvements: Bicep is now installed when using PSRule GitHub Action. #1050 Engineering: Added automated PR workflow to bump providers.json monthly. #1041 Bug fixes: Fixed AKS Network Policy should accept calico. #1046 v1.9.0-B2110059 (pre-release) # What's changed since pre-release v1.9.0-B2110040: New rules: API Management Service: Check API management services are using availability zones when available. #1017 Bug fixes: Fixed property used by Azure.ACR.MinSKU to work more reliably with templates. #1034 Fixed could not determine JSON object type for MockMember using CreateObject. #1035 v1.9.0-B2110040 (pre-release) # What's changed since pre-release v1.9.0-B2110025: New rules: User Assigned Managed Identity: Check identities meet naming requirements. #1021 Bug fixes: Fixed Azure.KeyVault.Logs reports cannot index into a null array. #1024 Fixed template function empty returns object reference not set exception. #1025 Fixed delayed binding of and template function. #1026 Fixed template function array nests array with array parameters. #1027 v1.9.0-B2110025 (pre-release) # What's changed since pre-release v1.9.0-B2110014: Engineering: Bump PSRule dependency to v1.8.0. #1018 Bug fixes: Fixed Azure.ACR.AdminUser fails when adminUserEnabled not set. #1014 v1.9.0-B2110014 (pre-release) # What's changed since pre-release v1.9.0-B2110009: Bug fixes: Fixed expression out of range of valid values. #1005 Fixed template expand fails in nested reference expansion. #1007 v1.9.0-B2110009 (pre-release) # What's changed since pre-release v1.9.0-B2109027: Bug fixes: Fixed handling of comments with template and parameter file rules. #996 Fixed Azure.Template.UseLocationParameter to only apply to templates deployed as RG scope #995 Fixed expand template fails with createObject when no parameters are specified. #1000 v1.9.0-B2109027 (pre-release) # What's changed since v1.8.0: New rules: Public IP Address: Check Public IP addresses are configured with zone-redundancy. #958 Check Public IP addresses are using Standard SKU. #979 Virtual Network Gateway: Check VPN/ExpressRoute gateways are configured with availability zone SKU. #926 General improvements: Improved processing of AzOps generated templates. #799 Azure.Template.DefineParameters is ignored for AzOps generated templates. Azure.Template.UseLocationParameter is ignored for AzOps generated templates. Bug fixes: Fixed ToUpper fails to convert character. #986 v1.8.1 # What's changed since v1.8.0: Bug fixes: Fixed handling of comments with template and parameter file rules. #996 Fixed Azure.Template.UseLocationParameter to only apply to templates deployed as RG scope #995 Fixed expand template fails with createObject when no parameters are specified. #1000 Fixed ToUpper fails to convert character. #986 Fixed expression out of range of valid values. #1005 Fixed template expand fails in nested reference expansion. #1007 v1.8.0 # What's changed since v1.7.0: New features: Added Azure.GA_2021_09 baseline. #961 Includes rules released before or during September 2021 for Azure GA features. Marked baseline Azure.GA_2021_06 as obsolete. New rules: Application Gateway: Check App Gateways should use availability zones when available. Thanks @ArmaanMcleod . #928 Azure Kubernetes Service: Check clusters have control plane audit logs enabled. Thanks @ArmaanMcleod . #882 Check clusters have control plane diagnostics enabled. Thanks @ArmaanMcleod . #922 Check clusters use Container Insights for monitoring workloads. Thanks @ArmaanMcleod . #881 Check clusters use availability zones when available. Thanks @ArmaanMcleod . #880 Cosmos DB: Check DB account names meet naming requirements. #954 Check DB accounts use Azure AD identities for resource management operations. #953 Load Balancer: Check Load balancers are using Standard SKU. Thanks @ArmaanMcleod . #957 Check Load Balancers are configured with zone-redundancy. Thanks @ArmaanMcleod . #927 Engineering: Bump PSRule dependency to v1.7.2. #951 Automated update of availability zone information in providers.json. #907 Increased test coverage of rule reasons. Thanks @ArmaanMcleod . #960 Bug fixes: Fixed export of in-flight AKS related subnets for kubenet clusters. Thanks @ArmaanMcleod . #920 Fixed plan instance count is not applicable to Elastic Premium plans. #946 Fixed minimum App Service Plan fails Elastic Premium plans. #945 Fixed App Service Plan should include PremiumV3 plan. #944 Fixed Azure.VM.NICAttached with private endpoints. #932 Fixed Bicep CLI fails with unexpected end of content. #889 Fixed incomplete reason message for Azure.Storage.MinTLS . #971 Fixed false positive of Azure.Storage.UseReplication with large file storage. #965 What's changed since pre-release v1.8.0-B2109060: No additional changes. v1.8.0-B2109086 (pre-release) # What's changed since pre-release v1.8.0-B2109060: New rules: Load Balancer: Check Load balancers are using Standard SKU. Thanks @ArmaanMcleod . #957 Engineering: Increased test coverage of rule reasons. Thanks @ArmaanMcleod . #960 Bug fixes: Fixed Bicep CLI fails with unexpected end of content. #889 Fixed incomplete reason message for Azure.Storage.MinTLS . #971 Fixed false positive of Azure.Storage.UseReplication with large file storage. #965 v1.8.0-B2109060 (pre-release) # What's changed since pre-release v1.8.0-B2109046: New features: Added Azure.GA_2021_09 baseline. #961 Includes rules released before or during September 2021 for Azure GA features. Marked baseline Azure.GA_2021_06 as obsolete. New rules: Load Balancer: Check Load Balancers are configured with zone-redundancy. Thanks @ArmaanMcleod . #927 v1.8.0-B2109046 (pre-release) # What's changed since pre-release v1.8.0-B2109020: New rules: Application Gateway: Check App Gateways should use availability zones when available. Thanks @ArmaanMcleod . #928 Cosmos DB: Check DB account names meet naming requirements. #954 Check DB accounts use Azure AD identities for resource management operations. #953 Bug fixes: Fixed plan instance count is not applicable to Elastic Premium plans. #946 Fixed minimum App Service Plan fails Elastic Premium plans. #945 Fixed App Service Plan should include PremiumV3 plan. #944 Fixed Azure.VM.NICAttached with private endpoints. #932 Engineering: Bump PSRule dependency to v1.7.2. #951 v1.8.0-B2109020 (pre-release) # What's changed since pre-release v1.8.0-B2108026: New rules: Azure Kubernetes Service: Check clusters have control plane audit logs enabled. Thanks @ArmaanMcleod . #882 Check clusters have control plane diagnostics enabled. Thanks @ArmaanMcleod . #922 Engineering: Bump PSRule dependency to v1.7.0. #938 v1.8.0-B2108026 (pre-release) # What's changed since pre-release v1.8.0-B2108013: New rules: Azure Kubernetes Service: Check clusters use Container Insights for monitoring workloads. Thanks @ArmaanMcleod . #881 Bug fixes: Fixed export of in-flight AKS related subnets for kubenet clusters. Thanks @ArmaanMcleod . #920 v1.8.0-B2108013 (pre-release) # What's changed since v1.7.0: New rules: Azure Kubernetes Service: Check clusters use availability zones when available. Thanks @ArmaanMcleod . #880 Engineering: Bump PSRule dependency to v1.6.1. #913 Automated update of availability zone information in providers.json. #907 v1.7.0 # What's changed since v1.6.0: New rules: All resources: Check template parameter files use metadata links. #846 Configure the AZURE_PARAMETER_FILE_METADATA_LINK option to enable this rule. Check template files use a recent schema. #845 Check template files use a https schema scheme. #894 Check template parameter files use a https schema scheme. #894 Check template parameters set a value. #896 Check template parameters use a valid secret reference. #897 Azure Kubernetes Service: Check clusters using Azure CNI should use large subnets. Thanks @ArmaanMcleod . #273 Check clusters use auto-scale node pools. Thanks @ArmaanMcleod . #218 By default, a minimum of a /23 subnet is required. Configure AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE to change the default minimum subnet size. Storage Account: Check Storage Accounts only accept explicitly allowed network traffic. #884 Updated rules: Virtual Network: Excluded AzureFirewallManagementSubnet from Azure.VNET.UseNSGs . #869 General improvements: Added version information to bicep compilation exceptions. #903 Engineering: Bump PSRule dependency to v1.6.0. #871 Bug fixes: Fixed DateTimeAdd function and tests within timezones with DST. #891 Fixed Azure.Template.ParameterValue failing on empty value. #901 What's changed since pre-release v1.7.0-B2108059: No additional changes. v1.7.0-B2108059 (pre-release) # What's changed since pre-release v1.7.0-B2108049: General improvements: Added version information to bicep compilation exceptions. #903 Bug fixes: Fixed Azure.Template.ParameterValue failing on empty value. #901 v1.7.0-B2108049 (pre-release) # What's changed since pre-release v1.7.0-B2108040: New rules: All resources: Check template files use a recent schema. #845 Check template files use a https schema scheme. #894 Check template parameter files use a https schema scheme. #894 Check template parameters set a value. #896 Check template parameters use a valid secret reference. #897 Bug fixes: Fixed DateTimeAdd function and tests within timezones with DST. #891 v1.7.0-B2108040 (pre-release) # What's changed since pre-release v1.7.0-B2108020: New rules: All resources: Check template parameter files use metadata links. #846 Configure the AZURE_PARAMETER_FILE_METADATA_LINK option to enable this rule. Azure Kubernetes Service: Check clusters using Azure CNI should use large subnets. Thanks @ArmaanMcleod . #273 By default, a minimum of a /23 subnet is required. Configure AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE to change the default minimum subnet size. Storage Account: Check Storage Accounts only accept explicitly allowed network traffic. #884 v1.7.0-B2108020 (pre-release) # What's changed since v1.6.0: New rules: Azure Kubernetes Service: Check clusters use auto-scale node pools. Thanks @ArmaanMcleod . #218 Updated rules: Virtual Network: Excluded AzureFirewallManagementSubnet from Azure.VNET.UseNSGs . #869 Engineering: Bump PSRule dependency to v1.6.0. #871 v1.6.0 # What's changed since v1.5.1: New features: Experimental : Added support for expansion from Bicep source files. #848 #670 #858 Bicep support is currently experimental. To opt-in set the AZURE_BICEP_FILE_EXPANSION configuration to true . For more information see Using Bicep . New rules: Application Gateways: Check Application Gateways publish endpoints by HTTPS. #841 Engineering: Bump PSRule dependency to v1.5.0. #832 Migration of Pester v4 tests to Pester v5. Thanks @ArmaanMcleod . #395 What's changed since pre-release v1.6.0-B2108038: Bug fixes: Fixed Bicep expand creates deadlock and times out. #863 v1.6.0-B2108038 (pre-release) # What's changed since pre-release v1.6.0-B2108023: Bug fixes: Fixed Bicep expand hangs analysis. #858 v1.6.0-B2108023 (pre-release) # What's changed since pre-release v1.6.0-B2107028: New features: Experimental : Added support for expansion from Bicep source files. #848 #670 Bicep support is currently experimental. To opt-in set the AZURE_BICEP_FILE_EXPANSION configuration to true . For more information see Using Bicep . v1.6.0-B2107028 (pre-release) # What's changed since v1.5.1: New rules: Application Gateways: Check Application Gateways publish endpoints by HTTPS. #841 Engineering: Bump PSRule dependency to v1.5.0. #832 v1.5.1 # What's changed since v1.5.0: Bug fixes: Fixed rule does not detect more restrictive NSG rules. #831 v1.5.0 # What's changed since v1.4.1: New features: Added Azure.GA_2021_06 baseline. #822 Includes rules released before or during June 2021 for Azure GA features. Marked baseline Azure.GA_2021_03 as obsolete. New rules: Application Insights: Check App Insights resources use workspace-based configuration. #813 Check App Insights resources meet naming requirements. #814 General improvements: Exclude not applicable rules for templates generated with Bicep and PSArm. #815 Updated rule help to use docs pages for online version. #824 Engineering: Bump PSRule dependency to v1.4.0. #823 Bump YamlDotNet dependency to v11.2.1. #821 Migrate project to Azure GitHub organization and updated links. #800 Bug fixes: Fixed detection of parameters and variables with line breaks. #811 What's changed since pre-release v1.5.0-B2107002: No additional changes. v1.5.0-B2107002 (pre-release) # What's changed since pre-release v1.5.0-B2106018: New features: Added Azure.GA_2021_06 baseline. #822 Includes rules released before or during June 2021 for Azure GA features. Marked baseline Azure.GA_2021_03 as obsolete. General improvements: Updated rule help to use docs pages for online version. #824 Engineering: Bump PSRule dependency to v1.4.0. #823 Bump YamlDotNet dependency to v11.2.1. #821 v1.5.0-B2106018 (pre-release) # What's changed since v1.4.1: New rules: Application Insights: Check App Insights resources use workspace-based configuration. #813 Check App Insights resources meet naming requirements. #814 General improvements: Exclude not applicable rules for templates generated with Bicep and PSArm. #815 Engineering: Bump YamlDotNet dependency to v11.2.0. #801 Migrate project to Azure GitHub organization and updated links. #800 Bug fixes: Fixed detection of parameters and variables with line breaks. #811 v1.4.1 # What's changed since v1.4.0: Bug fixes: Fixed boolean string conversion case. #793 Fixed case sensitive property matching. #794 Fixed automatic expansion of template parameter files. #796 Template parameter files are not automatically expanded by default. To enable this, set the AZURE_PARAMETER_FILE_EXPANSION configuration option. v1.4.0 # What's changed since v1.3.2: New features: Automatically expand template from parameter files for analysis. #772 Previously templates needed to be exported with Export-AzRuleTemplateData . To export template data automatically use PSRule cmdlets with -Format File . New rules: Cognitive Search: Check search services meet index SLA replica requirement. #761 Check search services meet query SLA replica requirement. #762 Check search services meet naming requirements. #763 Check search services use a minimum SKU. #764 Check search services use managed identities. #765 Azure Kubernetes Service: Check clusters use AKS-managed Azure AD integration. #436 Check clusters have local account disabled (preview). #786 Check clusters have an auto-upgrade channel set (preview). #787 Check clusters limit access network access to the API server. #788 Check clusters used Azure RBAC for Kubernetes authorization. #789 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.20.5. #767 General improvements: Automatically nest template sub-resources for analysis. #746 Sub-resources such as diagnostic logs or configurations are automatically nested. Automatic nesting a resource requires: The parent resource is defined in the same template. The sub-resource depends on the parent resource. Added support for source location references to template files. #781 Output includes source location to resources exported from a templates. Bug fixes: Fixed string index parsing in expressions with whitespace. #775 Fixed base for DateTimeAdd is not a valid string. #777 Engineering: Added source link to project. #783 What's changed since pre-release v1.4.0-B2105057: No additional changes. v1.4.0-B2105057 (pre-release) # What's changed since pre-release v1.4.0-B2105050: New rules: Azure Kubernetes Service: Check clusters use AKS-managed Azure AD integration. #436 Check clusters have local account disabled (preview). #786 Check clusters have an auto-upgrade channel set (preview). #787 Check clusters limit access network access to the API server. #788 Check clusters used Azure RBAC for Kubernetes authorization. #789 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.20.5. #767 Engineering: Added source link to project. #783 v1.4.0-B2105050 (pre-release) # What's changed since pre-release v1.4.0-B2105044: General improvements: Added support for source location references to template files. #781 Output includes source location to resources exported from a templates. v1.4.0-B2105044 (pre-release) # What's changed since pre-release v1.4.0-B2105027: New features: Automatically expand template from parameter files for analysis. #772 Previously templates needed to be exported with Export-AzRuleTemplateData . To export template data automatically use PSRule cmdlets with -Format File . Bug fixes: Fixed string index parsing in expressions with whitespace. #775 Fixed base for DateTimeAdd is not a valid string. #777 v1.4.0-B2105027 (pre-release) # What's changed since pre-release v1.4.0-B2105020: New rules: Cognitive Search: Check search services meet index SLA replica requirement. #761 Check search services meet query SLA replica requirement. #762 Check search services meet naming requirements. #763 Check search services use a minimum SKU. #764 Check search services use managed identities. #765 v1.4.0-B2105020 (pre-release) # What's changed since v1.3.2: General improvements: Automatically nest template sub-resources for analysis. #746 Sub-resources such as diagnostic logs or configurations are automatically nested. Automatic nesting a resource requires: The parent resource is defined in the same template. The sub-resource depends on the parent resource. v1.3.2 # What's changed since v1.3.1: Bug fixes: Fixed rule reason reported the parameter inputObject is null. #753 v1.3.1 # What's changed since v1.3.0: Engineering: Bump PSRule dependency to v1.3.0. #749 Bump YamlDotNet dependency to v11.1.1. #742 v1.3.0 # What's changed since v1.2.1: New rules: Policy: Check policy assignment display name and description are set. #725 Check policy assignment assigned by metadata is set. #726 Check policy exemption display name and description are set. #723 Check policy waiver exemptions have an expiry date set. #724 Removed rules: Storage: Remove Azure.Storage.UseEncryption as Storage Service Encryption (SSE) is always on. #630 SSE is on by default and can not be disabled. General improvements: Additional metadata added in parameter files is passed through with Get-AzRuleTemplateLink . #706 Improved binding support for File inputs. #480 Template and parameter file names now return a relative path instead of full path. Added API version for each module resource. #729 Engineering: Clean up depreciated warning message for configuration option azureAllowedRegions . #737 Clean up depreciated warning message for configuration option minAKSVersion . #738 Bump PSRule dependency to v1.2.0. #713 Bug fixes: Fixed could not load file or assembly YamlDotNet. #741 This fix pins the PSRule version to v1.2.0 until the next stable release of PSRule for Azure. What's changed since pre-release v1.3.0-B2104040: No additional changes. v1.3.0-B2104040 (pre-release) # What's changed since pre-release v1.3.0-B2104034: Bug fixes: Fixed could not load file or assembly YamlDotNet. #741 This fix pins the PSRule version to v1.2.0 until the next stable release of PSRule for Azure. v1.3.0-B2104034 (pre-release) # What's changed since pre-release v1.3.0-B2104023: New rules: Policy: Check policy assignment display name and description are set. #725 Check policy assignment assigned by metadata is set. #726 Check policy exemption display name and description are set. #723 Check policy waiver exemptions have an expiry date set. #724 Engineering: Clean up depreciated warning message for configuration option azureAllowedRegions . #737 Clean up depreciated warning message for configuration option minAKSVersion . #738 v1.3.0-B2104023 (pre-release) # What's changed since pre-release v1.3.0-B2104013: General improvements: Improved binding support for File inputs. #480 Template and parameter file names now return a relative path instead of full path. Added API version for each module resource. #729 v1.3.0-B2104013 (pre-release) # What's changed since pre-release v1.3.0-B2103007: Engineering: Bump PSRule dependency to v1.2.0. #713 Bug fixes: Fixed export not expanding nested deployments. #715 v1.3.0-B2103007 (pre-release) # What's changed since v1.2.0: Removed rules: Storage: Remove Azure.Storage.UseEncryption as Storage Service Encryption (SSE) is always on. #630 SSE is on by default and can not be disabled. General improvements: Additional metadata added in parameter files is passed through with Get-AzRuleTemplateLink . #706 v1.2.1 # What's changed since v1.2.0: Bug fixes: Fixed export not expanding nested deployments. #715 v1.2.0 # What's changed since v1.1.4: New features: Added Azure.GA_2021_03 baseline. #673 Includes rules released before or during March 2021 for Azure GA features. Marked baseline Azure.GA_2020_12 as obsolete. New rules: Key Vault: Check vaults, keys, and secrets meet name requirements. #646 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.19.7. #696 General improvements: Added support for user defined functions in templates. #682 Engineering: Bump PSRule dependency to v1.1.0. #692 What's changed since pre-release v1.2.0-B2103044: No additional changes. v1.2.0-B2103044 (pre-release) # What's changed since pre-release v1.2.0-B2103032: New features: Added Azure.GA_2021_03 baseline. #673 Includes rules released before or during March 2021 for Azure GA features. Marked baseline Azure.GA_2020_12 as obsolete. Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.19.7. #696 v1.2.0-B2103032 (pre-release) # What's changed since pre-release v1.2.0-B2103024: New rules: Key Vault: Check vaults, keys, and secrets meet name requirements. #646 Engineering: Bump PSRule dependency to v1.1.0. #692 v1.2.0-B2103024 (pre-release) # What's changed since v1.1.4: General improvements: Added support for user defined functions in templates. #682 v1.1.4 # What's changed since v1.1.3: Bug fixes: Fixed handling of literal index with copyIndex function. #686 Fixed handling of inner scoped nested deployments. #687 v1.1.3 # What's changed since v1.1.2: Bug fixes: Fixed parsing of property names for functions across multiple lines. #683 v1.1.2 # What's changed since v1.1.1: Bug fixes: Fixed copy peer property resolve. #677 Fixed partial resource group or subscription object not populating. #678 Fixed lazy loading of environment and resource providers. #679 v1.1.1 # What's changed since v1.1.0: Bug fixes: Fixed support for parameter file schemas. #674 v1.1.0 # What's changed since v1.0.0: New features: Exporting template with Export-AzRuleTemplateData supports custom resource group and subscription. #651 Subscription and resource group used for deployment can be specified instead of using defaults. ResourceGroupName parameter of Export-AzRuleTemplateData has been renamed to ResourceGroup . Added a parameter alias for ResourceGroupName on Export-AzRuleTemplateData . New rules: All resources: Check template parameters are defined. #631 Check location parameter is type string. #632 Check template parameter minValue and maxValue constraints are valid. #637 Check template resources do not use hard coded locations. #633 Check resource group location not referenced instead of location parameter. #634 Check increased debug detail is disabled for nested deployments. #638 General improvements: Added support for matching template by name. #661 Get-AzRuleTemplateLink discovers <templateName>.json from <templateName>.parameters.json . Engineering: Bump PSRule dependency to v1.0.3. #648 Bug fixes: Fixed Azure.VM.ADE to limit rule to exports only. #644 Fixed if condition values evaluation order. #652 Fixed handling of int parameters with large values. #653 Fixed handling of expressions split over multiple lines. #654 Fixed handling of bool parameter values within logical expressions. #655 Fixed copy loop value does not fall within the expected range. #664 Fixed template comparison functions handling of large integer values. #666 Fixed handling of createArray function with no arguments. #667 What's changed since pre-release v1.1.0-B2102034: No additional changes. v1.1.0-B2102034 (pre-release) # What's changed since pre-release v1.1.0-B2102023: General improvements: Added support for matching template by name. #661 Get-AzRuleTemplateLink discovers <templateName>.json from <templateName>.parameters.json . Bug fixes: Fixed copy loop value does not fall within the expected range. #664 Fixed template comparison functions handling of large integer values. #666 Fixed handling of createArray function with no arguments. #667 v1.1.0-B2102023 (pre-release) # What's changed since pre-release v1.1.0-B2102015: New features: Exporting template with Export-AzRuleTemplateData supports custom resource group and subscription. #651 Subscription and resource group used for deployment can be specified instead of using defaults. ResourceGroupName parameter of Export-AzRuleTemplateData has been renamed to ResourceGroup . Added a parameter alias for ResourceGroupName on Export-AzRuleTemplateData . v1.1.0-B2102015 (pre-release) # What's changed since pre-release v1.1.0-B2102010: Bug fixes: Fixed if condition values evaluation order. #652 Fixed handling of int parameters with large values. #653 Fixed handling of expressions split over multiple lines. #654 Fixed handling of bool parameter values within logical expressions. #655 v1.1.0-B2102010 (pre-release) # What's changed since pre-release v1.1.0-B2102001: Engineering: Bump PSRule dependency to v1.0.3. #648 Bug fixes: Fixed Azure.VM.ADE to limit rule to exports only. #644 v1.1.0-B2102001 (pre-release) # What's changed since v1.0.0: New rules: All resources: Check template parameters are defined. #631 Check location parameter is type string. #632 Check template parameter minValue and maxValue constraints are valid. #637 Check template resources do not use hard coded locations. #633 Check resource group location not referenced instead of location parameter. #634 Check increased debug detail is disabled for nested deployments. #638 Engineering: Bump PSRule dependency to v1.0.2. #635 v1.0.0 # What's changed since v0.19.0: New rules: All resources: Check parameter default value type matches type. #311 Check location parameter defaults to resource group. #361 Front Door: Check Front Door uses a health probe for each backend pool. #546 Check Front Door uses a dedicated health probe path backend pools. #547 Check Front Door uses HEAD requests for backend health probes. #613 Service Fabric: Check Service Fabric clusters use AAD client authentication. #619 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.19.6. #603 General improvements: Renamed Export-AzTemplateRuleData to Export-AzRuleTemplateData . #596 New name Export-AzRuleTemplateData aligns with prefix of other cmdlets. Use of Export-AzTemplateRuleData is now deprecated and will be removed in the next major version. Added alias to allow Export-AzTemplateRuleData to continue to be used. Using Export-AzTemplateRuleData returns a deprecation warning. Added support for environment template function. #517 Engineering: Bump PSRule dependency to v1.0.1. #611 What's changed since pre-release v1.0.0-B2101028: No additional changes. v1.0.0-B2101028 (pre-release) # What's changed since pre-release v1.0.0-B2101016: New rules: All resources: Check parameter default value type matches type. #311 General improvements: Renamed Export-AzTemplateRuleData to Export-AzRuleTemplateData . #596 New name Export-AzRuleTemplateData aligns with prefix of other cmdlets. Use of Export-AzTemplateRuleData is now deprecated and will be removed in the next major version. Added alias to allow Export-AzTemplateRuleData to continue to be used. Using Export-AzTemplateRuleData returns a deprecation warning. v1.0.0-B2101016 (pre-release) # What's changed since pre-release v1.0.0-B2101006: New rules: Service Fabric: Check Service Fabric clusters use AAD client authentication. #619 Bug fixes: Fixed reason Azure.FrontDoor.ProbePath so the probe name is included. #617 v1.0.0-B2101006 (pre-release) # What's changed since v0.19.0: New rules: All resources: Check location parameter defaults to resource group. #361 Front Door: Check Front Door uses a health probe for each backend pool. #546 Check Front Door uses a dedicated health probe path backend pools. #547 Check Front Door uses HEAD requests for backend health probes. #613 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.19.6. #603 General improvements: Added support for environment template function. #517 Engineering: Bump PSRule dependency to v1.0.1. #611","title":"v1"},{"location":"CHANGELOG-v1/#change-log","text":"See upgrade notes for helpful information when upgrading from previous versions. Important notes : Issue #741: Could not load file or assembly YamlDotNet . See troubleshooting guide for a workaround to this issue. The configuration option Azure_AKSMinimumVersion is replaced with AZURE_AKS_CLUSTER_MINIMUM_VERSION . If you have this option configured, please update it to AZURE_AKS_CLUSTER_MINIMUM_VERSION . Support for Azure_AKSMinimumVersion will be removed in v2. See upgrade notes for more information. The SupportsTag PowerShell function has been replaced with the Azure.Resource.SupportsTags selector. Update PowerShell rules to use the Azure.Resource.SupportsTags selector instead. Support for the SupportsTag function will be removed in v2. See upgrade notes for more information.","title":"Change log"},{"location":"CHANGELOG-v1/#unreleased","text":"New rules: CDN: Check CDN profile used Front Door Standard or Premium tier by @bengeset96. #1612","title":"Unreleased"},{"location":"CHANGELOG-v1/#v1200-b0004-pre-release","text":"What's changed since v1.19.1: New rules: Azure Resources: Check that nested deployments securely pass through administrator usernames by @ms-sambell. #1479 Engineering: Bump Microsoft.NET.Test.Sdk to v17.3.1. #1603","title":"v1.20.0-B0004 (pre-release)"},{"location":"CHANGELOG-v1/#v1191","text":"What's changed since v1.19.0: Bug fixes: Fixed Azure.VNET.UseNSGs is missing exceptions by @BernieWhite. #1609 Added exclusions for RouteServerSubnet and any subnet with a dedicated HSM delegation.","title":"v1.19.1"},{"location":"CHANGELOG-v1/#v1190","text":"What's changed since v1.18.1: New rules: Azure Kubernetes Service: Check clusters use uptime SLA by @bengeset96. #1601 General improvements: Updated rule level for the following rules by @BernieWhite. #1551 Set Azure.APIM.APIDescriptors to warning from error. Set Azure.APIM.ProductDescriptors to warning from error. Set Azure.Template.UseLocationParameter to warning from error. Set Azure.Template.UseComments to information from error. Set Azure.Template.UseDescriptions to information from error. Improve reporting of failing resource property for rules by @BernieWhite. #1429 Engineering: Added publishing of symbols for NuGet packages by @BernieWhite. #1549 Bump Az.Resources to v6.1.0. #1557 Bump Microsoft.NET.Test.Sdk to v17.3.0. #1563 Bump PSRule to v2.3.2. #1574 Bump support projects to .NET 6 by @BernieWhite. #1560 Bump BenchmarkDotNet to v0.13.2. #1593 Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.2. #1594 Updated provider data for analysis. #1598 Bug fixes: Fixed parameter files linked to bicep code via naming convention is not working by @BernieWhite. #1582 Fixed handling of storage accounts sub-resources with CMK by @BernieWhite. #1575 What's changed since pre-release v1.19.0-B0077: No additional changes.","title":"v1.19.0"},{"location":"CHANGELOG-v1/#v1190-b0077-pre-release","text":"What's changed since pre-release v1.19.0-B0042: New rules: Azure Kubernetes Service: Check clusters use uptime SLA by @bengeset96. #1601","title":"v1.19.0-B0077 (pre-release)"},{"location":"CHANGELOG-v1/#v1190-b0042-pre-release","text":"What's changed since pre-release v1.19.0-B0010: General improvements: Improve reporting of failing resource property for rules by @BernieWhite. #1429 Engineering: Bump PSRule to v2.3.2. #1574 Bump support projects to .NET 6 by @BernieWhite. #1560 Bump BenchmarkDotNet to v0.13.2. #1593 Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.2. #1594 Updated provider data for analysis. #1598 Bug fixes: Fixed parameter files linked to bicep code via naming convention is not working by @BernieWhite. #1582 Fixed handling of storage accounts sub-resources with CMK by @BernieWhite. #1575","title":"v1.19.0-B0042 (pre-release)"},{"location":"CHANGELOG-v1/#v1190-b0010-pre-release","text":"What's changed since v1.18.1: General improvements: Updated rule level for the following rules by @BernieWhite. #1551 Set Azure.APIM.APIDescriptors to warning from error. Set Azure.APIM.ProductDescriptors to warning from error. Set Azure.Template.UseLocationParameter to warning from error. Set Azure.Template.UseComments to information from error. Set Azure.Template.UseDescriptions to information from error. Engineering: Added publishing of symbols for NuGet packages by @BernieWhite. #1549 Bump PSRule to v2.3.1. #1561 Bump Az.Resources to v6.1.0. #1557 Bump Microsoft.NET.Test.Sdk to v17.3.0. #1563","title":"v1.19.0-B0010 (pre-release)"},{"location":"CHANGELOG-v1/#v1181","text":"What's changed since v1.18.0: Bug fixes: Fixed Azure.APIM.HTTPBackend reports failure when service URL is not defined by @BernieWhite. #1555 Fixed Azure.SQL.AAD failure with newer API by @BernieWhite. #1302","title":"v1.18.1"},{"location":"CHANGELOG-v1/#v1180","text":"What's changed since v1.17.1: New rules: Cognitive Services: Check accounts use network access restrictions by @BernieWhite. #1532 Check accounts use managed identities to access Azure resources by @BernieWhite. #1532 Check accounts only accept requests using Azure AD identities by @BernieWhite. #1532 Check accounts disable access using public endpoints by @BernieWhite. #1532 General improvements: Added support for array indexOf , lastIndexOf , and items ARM functions by @BernieWhite. #1440 Added support for join ARM function by @BernieWhite. #1535 Improved output of full path to emitted resources by @BernieWhite. #1523 Engineering: Bump Az.Resources to v6.0.1. #1521 Updated provider data for analysis. #1540 Bump xunit to v2.4.2. #1542 Added readme and tags to NuGet by @BernieWhite. #1513 Bug fixes: Fixed Azure.SQL.TDE is not required to enable Transparent Data Encryption for IaC by @BernieWhite. #1530 What's changed since pre-release v1.18.0-B0027: No additional changes.","title":"v1.18.0"},{"location":"CHANGELOG-v1/#v1180-b0027-pre-release","text":"What's changed since pre-release v1.18.0-B0010: New rules: Cognitive Services: Check accounts use network access restrictions by @BernieWhite. #1532 Check accounts use managed identities to access Azure resources by @BernieWhite. #1532 Check accounts only accept requests using Azure AD identities by @BernieWhite. #1532 Check accounts disable access using public endpoints by @BernieWhite. #1532 General improvements: Added support for array indexOf , lastIndexOf , and items ARM functions by @BernieWhite. #1440 Added support for join ARM function by @BernieWhite. #1535 Engineering: Updated provider data for analysis. #1540 Bump xunit to v2.4.2. #1542 Bug fixes: Fixed Azure.SQL.TDE is not required to enable Transparent Data Encryption for IaC by @BernieWhite. #1530","title":"v1.18.0-B0027 (pre-release)"},{"location":"CHANGELOG-v1/#v1180-b0010-pre-release","text":"What's changed since pre-release v1.18.0-B0002: General improvements: Improved output of full path to emitted resources by @BernieWhite. #1523 Engineering: Bump Az.Resources to v6.0.1. #1521","title":"v1.18.0-B0010 (pre-release)"},{"location":"CHANGELOG-v1/#v1180-b0002-pre-release","text":"What's changed since v1.17.1: Engineering: Added readme and tags to NuGet by @BernieWhite. #1513","title":"v1.18.0-B0002 (pre-release)"},{"location":"CHANGELOG-v1/#v1171","text":"What's changed since v1.17.0: Bug fixes: Fixed union returns null when merged with built-in expansion objects by @BernieWhite. #1515 Fixed missing zones in test for standalone VM by @BernieWhite. #1506","title":"v1.17.1"},{"location":"CHANGELOG-v1/#v1170","text":"What's changed since v1.16.1: New features: Added more field count expression support for Azure Policy JSON rules by @ArmaanMcleod. #181 Added June 2022 baselines Azure.GA_2022_06 and Azure.Preview_2022_06 by @BernieWhite. #1499 Includes rules released before or during June 2022. Marked Azure.GA_2022_03 and Azure.Preview_2022_03 baselines as obsolete. New rules: Deployment: Check for secure values in outputs by @BernieWhite. #297 Engineering: Bump Newtonsoft.Json to v13.0.1. #1494 Updated NuGet packaging metadata by @BernieWhite. #1428 Updated provider data for analysis. #1502 Bump PSRule to v2.2.0. #1444 Updated NuGet packaging metadata by @BernieWhite. #1428 Bug fixes: Fixed TDE property status to state by @Dylan-Prins. #1505 Fixed the language expression value fails in outputs by @BernieWhite. #1485 What's changed since pre-release v1.17.0-B0064: No additional changes.","title":"v1.17.0"},{"location":"CHANGELOG-v1/#v1170-b0064-pre-release","text":"What's changed since pre-release v1.17.0-B0035: Engineering: Updated provider data for analysis. #1502 Bump PSRule to v2.2.0. #1444 Bug fixes: Fixed TDE property status to state by @Dylan-Prins. #1505","title":"v1.17.0-B0064 (pre-release)"},{"location":"CHANGELOG-v1/#v1170-b0035-pre-release","text":"What's changed since pre-release v1.17.0-B0014: New features: Added June 2022 baselines Azure.GA_2022_06 and Azure.Preview_2022_06 by @BernieWhite. #1499 Includes rules released before or during June 2022. Marked Azure.GA_2022_03 and Azure.Preview_2022_03 baselines as obsolete. Engineering: Bump Newtonsoft.Json to v13.0.1. #1494 Updated NuGet packaging metadata by @BernieWhite. #1428","title":"v1.17.0-B0035 (pre-release)"},{"location":"CHANGELOG-v1/#v1170-b0014-pre-release","text":"What's changed since v1.16.1: New features: Added more field count expression support for Azure Policy JSON rules by @ArmaanMcleod. #181 New rules: Deployment: Check for secure values in outputs by @BernieWhite. #297 Engineering: Updated NuGet packaging metadata by @BernieWhite. #1428 Bug fixes: Fixed the language expression value fails in outputs by @BernieWhite. #1485","title":"v1.17.0-B0014 (pre-release)"},{"location":"CHANGELOG-v1/#v1161","text":"What's changed since v1.16.0: Bug fixes: Fixed TLS 1.3 support in Azure.AppGw.SSLPolicy by @BernieWhite. #1469 Fixed Application Gateway referencing a WAF policy by @BernieWhite. #1466","title":"v1.16.1"},{"location":"CHANGELOG-v1/#v1160","text":"What's changed since v1.15.2: New rules: App Service: Check web apps have insecure FTP disabled by @BernieWhite. #1436 Check web apps use a dedicated health probe by @BernieWhite. #1437 Updated rules: Public IP: Updated Azure.PublicIP.AvailabilityZone to exclude IP addresses for Azure Bastion by @BernieWhite. #1442 Public IP addresses with the resource-usage tag set to azure-bastion are excluded. General improvements: Added support for dateTimeFromEpoch and dateTimeToEpoch ARM functions by @BernieWhite. #1451 Engineering: Updated built documentation to include rule ref and metadata by @BernieWhite. #1432 Added ref properties for several rules by @BernieWhite. #1430 Updated provider data for analysis. #1453 Bump Microsoft.NET.Test.Sdk to v17.2.0. #1410 Update CI checks to include required ref property by @BernieWhite. #1431 Added ref properties for rules by @BernieWhite. #1430 Bug fixes: Fixed Azure.Template.UseVariables does not accept function variables names by @BernieWhite. #1427 Fixed dependency issue within Azure Pipelines AzurePowerShell task by @BernieWhite. #1447 Removed dependency on Az.Accounts and Az.Resources from manifest. Pre-install these modules to use export cmdlets. What's changed since pre-release v1.16.0-B0072: No additional changes.","title":"v1.16.0"},{"location":"CHANGELOG-v1/#v1160-b0072-pre-release","text":"What's changed since pre-release v1.16.0-B0041: Engineering: Update CI checks to include required ref property by @BernieWhite. #1431 Added ref properties for rules by @BernieWhite. #1430 Bug fixes: Fixed dependency issue within Azure Pipelines AzurePowerShell task by @BernieWhite. #1447 Removed dependency on Az.Accounts and Az.Resources from manifest. Pre-install these modules to use export cmdlets.","title":"v1.16.0-B0072 (pre-release)"},{"location":"CHANGELOG-v1/#v1160-b0041-pre-release","text":"What's changed since pre-release v1.16.0-B0017: Updated rules: Public IP: Updated Azure.PublicIP.AvailabilityZone to exclude IP addresses for Azure Bastion by @BernieWhite. #1442 Public IP addresses with the resource-usage tag set to azure-bastion are excluded. General improvements: Added support for dateTimeFromEpoch and dateTimeToEpoch ARM functions by @BernieWhite. #1451 Engineering: Updated built documentation to include rule ref and metadata by @BernieWhite. #1432 Added ref properties for several rules by @BernieWhite. #1430 Updated provider data for analysis. #1453","title":"v1.16.0-B0041 (pre-release)"},{"location":"CHANGELOG-v1/#v1160-b0017-pre-release","text":"What's changed since v1.15.2: New rules: App Service: Check web apps have insecure FTP disabled by @BernieWhite. #1436 Check web apps use a dedicated health probe by @BernieWhite. #1437 Engineering: Bump Microsoft.NET.Test.Sdk to v17.2.0. #1410 Bug fixes: Fixed Azure.Template.UseVariables does not accept function variables names by @BernieWhite. #1427","title":"v1.16.0-B0017 (pre-release)"},{"location":"CHANGELOG-v1/#v1152","text":"What's changed since v1.15.1: Bug fixes: Fixed Azure.AppService.ManagedIdentity does not accept both system and user assigned by @BernieWhite. #1415 This also applies to: Azure.ADX.ManagedIdentity Azure.APIM.ManagedIdentity Azure.EventGrid.ManagedIdentity Azure.Automation.ManagedIdentity Fixed Web apps with .NET 6 do not meet version constraint of Azure.AppService.NETVersion by @BernieWhite. #1414 This also applies to Azure.AppService.PHPVersion .","title":"v1.15.2"},{"location":"CHANGELOG-v1/#v1151","text":"What's changed since v1.15.0: Bug fixes: Fixed exclusion of dataCollectionRuleAssociations from Azure.Resource.UseTags by @BernieWhite. #1400 Fixed could not determine JSON object type for MockObject using CreateObject by @BernieWhite. #1411 Fixed cannot bind argument to parameter 'Sku' because it is an empty string by @BernieWhite. #1407","title":"v1.15.1"},{"location":"CHANGELOG-v1/#v1150","text":"What's changed since v1.14.3: New features: Important change : Added Azure.Resource.SupportsTags selector by @BernieWhite. #1339 Use this selector in custom rules to filter rules to only run against resources that support tags. This selector replaces the SupportsTags PowerShell function. Using the SupportsTag function will now result in a warning. The SupportsTags function will be removed in v2. See upgrade notes for more information. Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to use latest stable version 1.22.6 by @BernieWhite. #1386 Use AZURE_AKS_CLUSTER_MINIMUM_VERSION to configure the minimum version of the cluster. Engineering: Added code signing of module by @BernieWhite. #1379 Added SBOM manifests to module by @BernieWhite. #1380 Embedded provider and alias information as manifest resources by @BernieWhite. #1383 Resources are minified and compressed to improve size and speed. Added additional nodeps manifest that does not include dependencies for Az modules by @BernieWhite. #1392 Bump Az.Accounts to 2.7.6. #1338 Bump Az.Resources to 5.6.0. #1338 Bump PSRule to 2.1.0. #1338 Bump Pester to 5.3.3. #1338 Bug fixes: Fixed dependency chain order when dependsOn copy by @BernieWhite. #1381 Fixed error calling SupportsTags function by @BernieWhite. #1401 What's changed since pre-release v1.15.0-B0053: Bug fixes: Fixed error calling SupportsTags function by @BernieWhite. #1401","title":"v1.15.0"},{"location":"CHANGELOG-v1/#v1150-b0053-pre-release","text":"What's changed since pre-release v1.15.0-B0022: New features: Important change : Added Azure.Resource.SupportsTags selector. #1339 Use this selector in custom rules to filter rules to only run against resources that support tags. This selector replaces the SupportsTags PowerShell function. Using the SupportsTag function will now result in a warning. The SupportsTags function will be removed in v2. See upgrade notes for more information. Engineering: Embedded provider and alias information as manifest resources. #1383 Resources are minified and compressed to improve size and speed. Added additional nodeps manifest that does not include dependencies for Az modules. #1392 Bump Az.Accounts to 2.7.6. #1338 Bump Az.Resources to 5.6.0. #1338 Bump PSRule to 2.1.0. #1338 Bump Pester to 5.3.3. #1338","title":"v1.15.0-B0053 (pre-release)"},{"location":"CHANGELOG-v1/#v1150-b0022-pre-release","text":"What's changed since v1.14.3: Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to use latest stable version 1.22.6 . #1386 Use AZURE_AKS_CLUSTER_MINIMUM_VERSION to configure the minimum version of the cluster. Engineering: Added code signing of module. #1379 Added SBOM manifests to module. #1380 Bug fixes: Fixed dependency chain order when dependsOn copy. #1381","title":"v1.15.0-B0022 (pre-release)"},{"location":"CHANGELOG-v1/#v1143","text":"What's changed since v1.14.2: Bug fixes: Fixed Azure Firewall threat intel mode reported for Secure VNET hubs. #1365 Fixed array function handling with mock objects. #1367","title":"v1.14.3"},{"location":"CHANGELOG-v1/#v1142","text":"What's changed since v1.14.1: Bug fixes: Fixed handling of parent resources when sub resource is in a separate deployment. #1360","title":"v1.14.2"},{"location":"CHANGELOG-v1/#v1141","text":"What's changed since v1.14.0: Bug fixes: Fixed unable to set parameter defaults option with type object. #1355","title":"v1.14.1"},{"location":"CHANGELOG-v1/#v1140","text":"What's changed since v1.13.4: New features: Added support for referencing resources in template. #1315 The reference() function can be used to reference resources in template. A placeholder value is still used for resources outside of the template. Added March 2022 baselines Azure.GA_2022_03 and Azure.Preview_2022_03 . #1334 Includes rules released before or during March 2022. Marked Azure.GA_2021_12 and Azure.Preview_2021_12 baselines as obsolete. Experimental : Cmdlets to validate objects with Azure policy conditions: Export-AzPolicyAssignmentData - Exports policy assignment data. #1266 Export-AzPolicyAssignmentRuleData - Exports JSON rules from policy assignment data. #1278 Get-AzPolicyAssignmentDataSource - Discovers policy assignment data. #1340 See cmdlet help for limitations and usage. Additional information will be posted as this feature evolves here . New rules: SignalR Service: Check services use Managed Identities. #1306 Check services use a SKU with an SLA. #1307 Web PubSub Service: Check services use Managed Identities. #1308 Check services use a SKU with an SLA. #1309 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to use latest stable version 1.21.9 . #1318 Use AZURE_AKS_CLUSTER_MINIMUM_VERSION to configure the minimum version of the cluster. Engineering: Cache Azure Policy Aliases. #1277 Cleanup of additional alias metadata. #1351 Bug fixes: Fixed index was out of range with split on mock properties. #1327 Fixed mock objects with no properties. #1347 Fixed sub-resources nesting by scope regression. #1348 Fixed expand of runtime properties on reference objects. #1324 Fixed processing of deployment outputs. #1316 What's changed since pre-release v1.14.0-B2204013: No additional changes.","title":"v1.14.0"},{"location":"CHANGELOG-v1/#v1140-b2204013-pre-release","text":"What's changed since pre-release v1.14.0-B2204007: Engineering: Cleanup of additional alias metadata. #1351","title":"v1.14.0-B2204013 (pre-release)"},{"location":"CHANGELOG-v1/#v1140-b2204007-pre-release","text":"What's changed since pre-release v1.14.0-B2203117: Bug fixes: Fixed mock objects with no properties. #1347 Fixed sub-resources nesting by scope regression. #1348","title":"v1.14.0-B2204007 (pre-release)"},{"location":"CHANGELOG-v1/#v1140-b2203117-pre-release","text":"What's changed since pre-release v1.14.0-B2203088: New features: Experimental : Cmdlets to validate objects with Azure policy conditions: Export-AzPolicyAssignmentData - Exports policy assignment data. #1266 Export-AzPolicyAssignmentRuleData - Exports JSON rules from policy assignment data. #1278 Get-AzPolicyAssignmentDataSource - Discovers policy assignment data. #1340 See cmdlet help for limitations and usage. Additional information will be posted as this feature evolves here . Engineering: Cache Azure Policy Aliases. #1277 Bug fixes: Fixed index was out of range with split on mock properties. #1327","title":"v1.14.0-B2203117 (pre-release)"},{"location":"CHANGELOG-v1/#v1140-b2203088-pre-release","text":"What's changed since pre-release v1.14.0-B2203066: New features: Added March 2022 baselines Azure.GA_2022_03 and Azure.Preview_2022_03 . #1334 Includes rules released before or during March 2022. Marked Azure.GA_2021_12 and Azure.Preview_2021_12 baselines as obsolete. Bug fixes: Fixed expand of runtime properties on reference objects. #1324","title":"v1.14.0-B2203088 (pre-release)"},{"location":"CHANGELOG-v1/#v1140-b2203066-pre-release","text":"What's changed since v1.13.4: New features: Added support for referencing resources in template. #1315 The reference() function can be used to reference resources in template. A placeholder value is still used for resources outside of the template. New rules: SignalR Service: Check services use Managed Identities. #1306 Check services use a SKU with an SLA. #1307 Web PubSub Service: Check services use Managed Identities. #1308 Check services use a SKU with an SLA. #1309 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to use latest stable version 1.21.9 . #1318 Use AZURE_AKS_CLUSTER_MINIMUM_VERSION to configure the minimum version of the cluster. Bug fixes: Fixed processing of deployment outputs. #1316","title":"v1.14.0-B2203066 (pre-release)"},{"location":"CHANGELOG-v1/#v1134","text":"What's changed since v1.13.3: Bug fixes: Fixed virtual network without any subnets is invalid. #1303 Fixed container registry rules that require a premium tier. #1304 Rules Azure.ACR.Retention and Azure.ACR.ContentTrust are now only run against premium instances.","title":"v1.13.4"},{"location":"CHANGELOG-v1/#v1133","text":"What's changed since v1.13.2: Bug fixes: Fixed bicep build timeout for complex deployments. #1299","title":"v1.13.3"},{"location":"CHANGELOG-v1/#v1132","text":"What's changed since v1.13.1: Engineering: Bump PowerShellStandard.Library to 5.1.1. #1295 Bug fixes: Fixed nested resource loops. #1293","title":"v1.13.2"},{"location":"CHANGELOG-v1/#v1131","text":"What's changed since v1.13.0: Bug fixes: Fixed parsing of nested quote pairs within JSON function. #1288","title":"v1.13.1"},{"location":"CHANGELOG-v1/#v1130","text":"What's changed since v1.12.2: New features: Added support for setting defaults for required parameters. #1065 When specified, the value will be used when a parameter value is not provided. Added support expanding Bicep from parameter files. #1160 New rules: Azure Cache for Redis: Limit public access for Azure Cache for Redis instances. #935 Container App: Check insecure ingress is not enabled (preview). #1252 Key Vault: Check key auto-rotation is enabled (preview). #1159 Recovery Services Vault: Check vaults have replication alerts configured. #7 Engineering: Automatically build baseline docs. #1242 Bump PSRule dependency to v1.11.1. #1269 Bug fixes: Fixed empty value with strong type. #1258 Fixed error with empty logic app trigger. #1249 Fixed out of order parameters. #1257 Fixed mapping default configuration causes cast exception. #1274 Fixed resource id is incorrectly built for sub resource types. #1279 What's changed since pre-release v1.13.0-B2202113: No additional changes.","title":"v1.13.0"},{"location":"CHANGELOG-v1/#v1130-b2202113-pre-release","text":"What's changed since pre-release v1.13.0-B2202108: Bug fixes: Fixed resource id is incorrectly built for sub resource types. #1279","title":"v1.13.0-B2202113 (pre-release)"},{"location":"CHANGELOG-v1/#v1130-b2202108-pre-release","text":"What's changed since pre-release v1.13.0-B2202103: Bug fixes: Fixed mapping default configuration causes cast exception. #1274","title":"v1.13.0-B2202108 (pre-release)"},{"location":"CHANGELOG-v1/#v1130-b2202103-pre-release","text":"What's changed since pre-release v1.13.0-B2202090: Engineering: Bump PSRule dependency to v1.11.1. #1269 Bug fixes: Fixed out of order parameters. #1257","title":"v1.13.0-B2202103 (pre-release)"},{"location":"CHANGELOG-v1/#v1130-b2202090-pre-release","text":"What's changed since pre-release v1.13.0-B2202063: New rules: Azure Cache for Redis: Limit public access for Azure Cache for Redis instances. #935 Engineering: Automatically build baseline docs. #1242 Bug fixes: Fixed empty value with strong type. #1258","title":"v1.13.0-B2202090 (pre-release)"},{"location":"CHANGELOG-v1/#v1130-b2202063-pre-release","text":"What's changed since v1.12.2: New features: Added support for setting defaults for required parameters. #1065 When specified, the value will be used when a parameter value is not provided. Added support expanding Bicep from parameter files. #1160 New rules: Container App: Check insecure ingress is not enabled (preview). #1252 Key Vault: Check key auto-rotation is enabled (preview). #1159 Recovery Services Vault: Check vaults have replication alerts configured. #7 Bug fixes: Fixed error with empty logic app trigger. #1249","title":"v1.13.0-B2202063 (pre-release)"},{"location":"CHANGELOG-v1/#v1122","text":"What's changed since v1.12.1: Bug fixes: Fixed detect strong type requirements for nested deployments. #1235","title":"v1.12.2"},{"location":"CHANGELOG-v1/#v1121","text":"What's changed since v1.12.0: Bug fixes: Fixed Bicep already exists with PSRule v2. #1232","title":"v1.12.1"},{"location":"CHANGELOG-v1/#v1120","text":"What's changed since v1.11.1: New rules: Data Explorer: Check clusters use Managed Identities. #1207 Check clusters use a SKU with a SLA. #1208 Check clusters use disk encryption. #1209 Check clusters are in use with databases. #1215 Event Hub: Check namespaces are in use with event hubs. #1216 Check namespaces only accept identity-based authentication. #1217 Azure Recovery Services Vault: Check vaults use geo-redundant storage. #5 Service Bus: Check namespaces are in use with queues and topics. #1218 Check namespaces only accept identity-based authentication. #1219 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to use latest stable version 1.21.7 . #1188 Pinned latest GA baseline Azure.GA_2021_12 to previous version 1.20.5 . Use AZURE_AKS_CLUSTER_MINIMUM_VERSION to configure the minimum version of the cluster. Azure API Management: Check service disabled insecure ciphers. #1128 Refactored the cipher and protocol rule into individual rules. Azure.APIM.Protocols Azure.APIM.Ciphers General improvements: Important change: Replaced Azure_AKSMinimumVersion option with AZURE_AKS_CLUSTER_MINIMUM_VERSION . #941 For compatibility, if Azure_AKSMinimumVersion is set it will be used instead of AZURE_AKS_CLUSTER_MINIMUM_VERSION . If only AZURE_AKS_CLUSTER_MINIMUM_VERSION is set, this value will be used. The default will be used neither options are configured. If Azure_AKSMinimumVersion is set a warning will be generated until the configuration is removed. Support for Azure_AKSMinimumVersion is deprecated and will be removed in v2. See upgrade notes for details. Bug fixes: Fixed false positive of blob container with access unspecified. #1212 What's changed since pre-release v1.12.0-B2201086: No additional changes.","title":"v1.12.0"},{"location":"CHANGELOG-v1/#v1120-b2201086-pre-release","text":"What's changed since pre-release v1.12.0-B2201067: New rules: Data Explorer: Check clusters are in use with databases. #1215 Event Hub: Check namespaces are in use with event hubs. #1216 Check namespaces only accept identity-based authentication. #1217 Azure Recovery Services Vault: Check vaults use geo-redundant storage. #5 Service Bus: Check namespaces are in use with queues and topics. #1218 Check namespaces only accept identity-based authentication. #1219","title":"v1.12.0-B2201086 (pre-release)"},{"location":"CHANGELOG-v1/#v1120-b2201067-pre-release","text":"What's changed since pre-release v1.12.0-B2201054: New rules: Data Explorer: Check clusters use Managed Identities. #1207 Check clusters use a SKU with a SLA. #1208 Check clusters use disk encryption. #1209 Bug fixes: Fixed false positive of blob container with access unspecified. #1212","title":"v1.12.0-B2201067 (pre-release)"},{"location":"CHANGELOG-v1/#v1120-b2201054-pre-release","text":"What's changed since v1.11.1: Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to use latest stable version 1.21.7 . #1188 Pinned latest GA baseline Azure.GA_2021_12 to previous version 1.20.5 . Use AZURE_AKS_CLUSTER_MINIMUM_VERSION to configure the minimum version of the cluster. Azure API Management: Check service disabled insecure ciphers. #1128 Refactored the cipher and protocol rule into individual rules. Azure.APIM.Protocols Azure.APIM.Ciphers General improvements: Important change: Replaced Azure_AKSMinimumVersion option with AZURE_AKS_CLUSTER_MINIMUM_VERSION . #941 For compatibility, if Azure_AKSMinimumVersion is set it will be used instead of AZURE_AKS_CLUSTER_MINIMUM_VERSION . If only AZURE_AKS_CLUSTER_MINIMUM_VERSION is set, this value will be used. The default will be used neither options are configured. If Azure_AKSMinimumVersion is set a warning will be generated until the configuration is removed. Support for Azure_AKSMinimumVersion is deprecated and will be removed in v2. See upgrade notes for details.","title":"v1.12.0-B2201054 (pre-release)"},{"location":"CHANGELOG-v1/#v1111","text":"What's changed since v1.11.0: Bug fixes: Fixed Azure.AKS.CNISubnetSize rule to use CNI selector. #1178","title":"v1.11.1"},{"location":"CHANGELOG-v1/#v1110","text":"What's changed since v1.10.4: New features: Added baselines containing only Azure preview features. #1129 Added baseline Azure.Preview_2021_09 . Added baseline Azure.Preview_2021_12 . Added Azure.GA_2021_12 baseline. #1146 Includes rules released before or during December 2021 for Azure GA features. Marked baseline Azure.GA_2021_09 as obsolete. Bicep support promoted from experimental to generally available (GA). #1176 New rules: All resources: Check comments for each template resource. #969 Automation Account: Automation accounts should enable diagnostic logs. #1075 Azure Kubernetes Service: Check clusters have the HTTP application routing add-on disabled. #1131 Check clusters use the Secrets Store CSI Driver add-on. #992 Check clusters autorotation with the Secrets Store CSI Driver add-on. #993 Check clusters use Azure AD Pod Managed Identities (preview). #991 Azure Redis Cache: Use availability zones for Azure Cache for Redis for regions that support it. #1078 Azure.Redis.AvailabilityZone Azure.RedisEnterprise.Zones Application Security Group: Check Application Security Groups meet naming requirements. #1110 Firewall: Check Firewalls meet naming requirements. #1110 Check Firewall policies meet naming requirements. #1110 Private Endpoint: Check Private Endpoints meet naming requirements. #1110 Virtual WAN: Check Virtual WANs meet naming requirements. #1110 Updated rules: Azure Kubernetes Service: Promoted Azure.AKS.AutoUpgrade to GA rule set. #1130 General improvements: Added support for template function tenant() . #1124 Added support for template function managementGroup() . #1125 Added support for template function pickZones() . #518 Engineering: Rule refactoring of rules from PowerShell to YAML. #1109 The following rules were refactored: Azure.LB.Name Azure.NSG.Name Azure.Firewall.Mode Azure.Route.Name Azure.VNET.Name Azure.VNG.Name Azure.VNG.ConnectionName Azure.AppConfig.SKU Azure.AppConfig.Name Azure.AppInsights.Workspace Azure.AppInsights.Name Azure.Cosmos.AccountName Azure.FrontDoor.State Azure.FrontDoor.Name Azure.FrontDoor.WAF.Mode Azure.FrontDoor.WAF.Enabled Azure.FrontDoor.WAF.Name Azure.AKS.MinNodeCount Azure.AKS.ManagedIdentity Azure.AKS.StandardLB Azure.AKS.AzurePolicyAddOn Azure.AKS.ManagedAAD Azure.AKS.AuthorizedIPs Azure.AKS.LocalAccounts Azure.AKS.AzureRBAC Bug fixes: Fixed output of Bicep informational and warning messages in error stream. #1157 What's changed since pre-release v1.11.0-B2112112: New features: Bicep support promoted from experimental to generally available (GA). #1176","title":"v1.11.0"},{"location":"CHANGELOG-v1/#v1110-b2112112-pre-release","text":"What's changed since pre-release v1.11.0-B2112104: New rules: Azure Redis Cache: Use availability zones for Azure Cache for Redis for regions that support it. #1078 Azure.Redis.AvailabilityZone Azure.RedisEnterprise.Zones","title":"v1.11.0-B2112112 (pre-release)"},{"location":"CHANGELOG-v1/#v1110-b2112104-pre-release","text":"What's changed since pre-release v1.11.0-B2112073: New rules: Azure Kubernetes Service: Check clusters use Azure AD Pod Managed Identities (preview). #991 Engineering: Rule refactoring of rules from PowerShell to YAML. #1109 The following rules were refactored: Azure.AppConfig.SKU Azure.AppConfig.Name Azure.AppInsights.Workspace Azure.AppInsights.Name Azure.Cosmos.AccountName Azure.FrontDoor.State Azure.FrontDoor.Name Azure.FrontDoor.WAF.Mode Azure.FrontDoor.WAF.Enabled Azure.FrontDoor.WAF.Name Azure.AKS.MinNodeCount Azure.AKS.ManagedIdentity Azure.AKS.StandardLB Azure.AKS.AzurePolicyAddOn Azure.AKS.ManagedAAD Azure.AKS.AuthorizedIPs Azure.AKS.LocalAccounts Azure.AKS.AzureRBAC Bug fixes: Fixed output of Bicep informational and warning messages in error stream. #1157 Fixed obsolete flag for baseline Azure.Preview_2021_12 . #1166","title":"v1.11.0-B2112104 (pre-release)"},{"location":"CHANGELOG-v1/#v1110-b2112073-pre-release","text":"What's changed since pre-release v1.11.0-B2112024: New features: Added baselines containing only Azure preview features. #1129 Added baseline Azure.Preview_2021_09 . Added baseline Azure.Preview_2021_12 . Added Azure.GA_2021_12 baseline. #1146 Includes rules released before or during December 2021 for Azure GA features. Marked baseline Azure.GA_2021_09 as obsolete. New rules: All resources: Check comments for each template resource. #969 Bug fixes: Fixed template function equals parameter count mismatch. #1137 Fixed copy loop on nested deployment parameters is not handled. #1144 Fixed outer copy loop of nested deployment. #1154","title":"v1.11.0-B2112073 (pre-release)"},{"location":"CHANGELOG-v1/#v1110-b2112024-pre-release","text":"What's changed since pre-release v1.11.0-B2111014: New rules: Azure Kubernetes Service: Check clusters have the HTTP application routing add-on disabled. #1131 Check clusters use the Secrets Store CSI Driver add-on. #992 Check clusters autorotation with the Secrets Store CSI Driver add-on. #993 Automation Account: Automation accounts should enable diagnostic logs. #1075 Updated rules: Azure Kubernetes Service: Promoted Azure.AKS.AutoUpgrade to GA rule set. #1130 General improvements: Added support for template function tenant() . #1124 Added support for template function managementGroup() . #1125 Added support for template function pickZones() . #518 Bug fixes: Fixed Azure.Policy.WaiverExpiry date conversion. #1118","title":"v1.11.0-B2112024 (pre-release)"},{"location":"CHANGELOG-v1/#v1110-b2111014-pre-release","text":"What's changed since v1.10.0: New rules: Application Security Group: Check Application Security Groups meet naming requirements. #1110 Firewall: Check Firewalls meet naming requirements. #1110 Check Firewall policies meet naming requirements. #1110 Private Endpoint: Check Private Endpoints meet naming requirements. #1110 Virtual WAN: Check Virtual WANs meet naming requirements. #1110 Engineering: Rule refactoring of rules from PowerShell to YAML. #1109 The following rules were refactored: Azure.LB.Name Azure.NSG.Name Azure.Firewall.Mode Azure.Route.Name Azure.VNET.Name Azure.VNG.Name Azure.VNG.ConnectionName","title":"v1.11.0-B2111014 (pre-release)"},{"location":"CHANGELOG-v1/#v1104","text":"What's changed since v1.10.3: Bug fixes: Fixed outer copy loop of nested deployment. #1154","title":"v1.10.4"},{"location":"CHANGELOG-v1/#v1103","text":"What's changed since v1.10.2: Bug fixes: Fixed copy loop on nested deployment parameters is not handled. #1144","title":"v1.10.3"},{"location":"CHANGELOG-v1/#v1102","text":"What's changed since v1.10.1: Bug fixes: Fixed template function equals parameter count mismatch. #1137","title":"v1.10.2"},{"location":"CHANGELOG-v1/#v1101","text":"What's changed since v1.10.0: Bug fixes: Fixed Azure.Policy.WaiverExpiry date conversion. #1118","title":"v1.10.1"},{"location":"CHANGELOG-v1/#v1100","text":"What's changed since v1.9.1: New features: Added support for parameter strong types. #1083 The value of string parameters can be tested against the expected type. When configuring a location strong type, the parameter value must be a valid Azure location. When configuring a resource type strong type, the parameter value must be a matching resource Id. New rules: All resources: Check template expressions do not exceed a maximum length. #1006 Automation Service: Check automation accounts should use managed identities for authentication. #1074 Event Grid: Check topics and domains use managed identities. #1091 Check topics and domains use private endpoints. #1092 Check topics and domains use identity-based authentication. #1093 General improvements: Updated default baseline to use module configuration. #1089 Engineering: Bump PSRule dependency to v1.9.0. #1081 Bump Microsoft.CodeAnalysis.NetAnalyzers to v6.0.0. #1080 Bump Microsoft.SourceLink.GitHub to 1.1.1. #1085 Bug fixes: Fixed expansion of secret references. #1098 Fixed handling of tagging for deployments. #1099 Fixed strong type issue flagged with empty defaultValue string. #1100 What's changed since pre-release v1.10.0-B2111081: No additional changes.","title":"v1.10.0"},{"location":"CHANGELOG-v1/#v1100-b2111081-pre-release","text":"What's changed since pre-release v1.10.0-B2111072: New rules: Automation Service: Automation accounts should use managed identities for authentication. #1074","title":"v1.10.0-B2111081 (pre-release)"},{"location":"CHANGELOG-v1/#v1100-b2111072-pre-release","text":"What's changed since pre-release v1.10.0-B2111058: New rules: All resources: Check template expressions do not exceed a maximum length. #1006 Bug fixes: Fixed expansion of secret references. #1098 Fixed handling of tagging for deployments. #1099 Fixed strong type issue flagged with empty defaultValue string. #1100","title":"v1.10.0-B2111072 (pre-release)"},{"location":"CHANGELOG-v1/#v1100-b2111058-pre-release","text":"What's changed since pre-release v1.10.0-B2111040: New rules: Event Grid: Check topics and domains use managed identities. #1091 Check topics and domains use private endpoints. #1092 Check topics and domains use identity-based authentication. #1093 General improvements: Updated default baseline to use module configuration. #1089","title":"v1.10.0-B2111058 (pre-release)"},{"location":"CHANGELOG-v1/#v1100-b2111040-pre-release","text":"What's changed since v1.9.1: New features: Added support for parameter strong types. #1083 The value of string parameters can be tested against the expected type. When configuring a location strong type, the parameter value must be a valid Azure location. When configuring a resource type strong type, the parameter value must be a matching resource Id. Engineering: Bump PSRule dependency to v1.9.0. #1081 Bump Microsoft.CodeAnalysis.NetAnalyzers to v6.0.0. #1080 Bump Microsoft.SourceLink.GitHub to 1.1.1. #1085","title":"v1.10.0-B2111040 (pre-release)"},{"location":"CHANGELOG-v1/#v191","text":"What's changed since v1.9.0: Bug fixes: Fixed can not index into resource group tags. #1066 Fixed Azure.VM.ASMinMembers for template deployments. #1064 Fixed zones property not found on public IP resource. #1070","title":"v1.9.1"},{"location":"CHANGELOG-v1/#v190","text":"What's changed since v1.8.1: New rules: API Management Service: Check API management services are using availability zones when available. #1017 Public IP Address: Check Public IP addresses are configured with zone-redundancy. #958 Check Public IP addresses are using Standard SKU. #979 User Assigned Managed Identity: Check identities meet naming requirements. #1021 Virtual Network Gateway: Check VPN/ExpressRoute gateways are configured with availability zone SKU. #926 General improvements: Improved processing of AzOps generated templates. #799 Azure.Template.DefineParameters is ignored for AzOps generated templates. Azure.Template.UseLocationParameter is ignored for AzOps generated templates. Bicep is now installed when using PSRule GitHub Action. #1050 Engineering: Bump PSRule dependency to v1.8.0. #1018 Added automated PR workflow to bump providers.json monthly. #1041 Bug fixes: Fixed AKS Network Policy should accept calico. #1046 Fixed Azure.ACR.AdminUser fails when adminUserEnabled not set. #1014 Fixed Azure.KeyVault.Logs reports cannot index into a null array. #1024 Fixed template function empty returns object reference not set exception. #1025 Fixed delayed binding of and template function. #1026 Fixed template function array nests array with array parameters. #1027 Fixed property used by Azure.ACR.MinSKU to work more reliably with templates. #1034 Fixed could not determine JSON object type for MockMember using CreateObject. #1035 Fixed Bicep convention ordering. #1053 What's changed since pre-release v1.9.0-B2110087: No additional changes.","title":"v1.9.0"},{"location":"CHANGELOG-v1/#v190-b2110087-pre-release","text":"What's changed since pre-release v1.9.0-B2110082: Bug fixes: Fixed Bicep convention ordering. #1053","title":"v1.9.0-B2110087 (pre-release)"},{"location":"CHANGELOG-v1/#v190-b2110082-pre-release","text":"What's changed since pre-release v1.9.0-B2110059: General improvements: Bicep is now installed when using PSRule GitHub Action. #1050 Engineering: Added automated PR workflow to bump providers.json monthly. #1041 Bug fixes: Fixed AKS Network Policy should accept calico. #1046","title":"v1.9.0-B2110082 (pre-release)"},{"location":"CHANGELOG-v1/#v190-b2110059-pre-release","text":"What's changed since pre-release v1.9.0-B2110040: New rules: API Management Service: Check API management services are using availability zones when available. #1017 Bug fixes: Fixed property used by Azure.ACR.MinSKU to work more reliably with templates. #1034 Fixed could not determine JSON object type for MockMember using CreateObject. #1035","title":"v1.9.0-B2110059 (pre-release)"},{"location":"CHANGELOG-v1/#v190-b2110040-pre-release","text":"What's changed since pre-release v1.9.0-B2110025: New rules: User Assigned Managed Identity: Check identities meet naming requirements. #1021 Bug fixes: Fixed Azure.KeyVault.Logs reports cannot index into a null array. #1024 Fixed template function empty returns object reference not set exception. #1025 Fixed delayed binding of and template function. #1026 Fixed template function array nests array with array parameters. #1027","title":"v1.9.0-B2110040 (pre-release)"},{"location":"CHANGELOG-v1/#v190-b2110025-pre-release","text":"What's changed since pre-release v1.9.0-B2110014: Engineering: Bump PSRule dependency to v1.8.0. #1018 Bug fixes: Fixed Azure.ACR.AdminUser fails when adminUserEnabled not set. #1014","title":"v1.9.0-B2110025 (pre-release)"},{"location":"CHANGELOG-v1/#v190-b2110014-pre-release","text":"What's changed since pre-release v1.9.0-B2110009: Bug fixes: Fixed expression out of range of valid values. #1005 Fixed template expand fails in nested reference expansion. #1007","title":"v1.9.0-B2110014 (pre-release)"},{"location":"CHANGELOG-v1/#v190-b2110009-pre-release","text":"What's changed since pre-release v1.9.0-B2109027: Bug fixes: Fixed handling of comments with template and parameter file rules. #996 Fixed Azure.Template.UseLocationParameter to only apply to templates deployed as RG scope #995 Fixed expand template fails with createObject when no parameters are specified. #1000","title":"v1.9.0-B2110009 (pre-release)"},{"location":"CHANGELOG-v1/#v190-b2109027-pre-release","text":"What's changed since v1.8.0: New rules: Public IP Address: Check Public IP addresses are configured with zone-redundancy. #958 Check Public IP addresses are using Standard SKU. #979 Virtual Network Gateway: Check VPN/ExpressRoute gateways are configured with availability zone SKU. #926 General improvements: Improved processing of AzOps generated templates. #799 Azure.Template.DefineParameters is ignored for AzOps generated templates. Azure.Template.UseLocationParameter is ignored for AzOps generated templates. Bug fixes: Fixed ToUpper fails to convert character. #986","title":"v1.9.0-B2109027 (pre-release)"},{"location":"CHANGELOG-v1/#v181","text":"What's changed since v1.8.0: Bug fixes: Fixed handling of comments with template and parameter file rules. #996 Fixed Azure.Template.UseLocationParameter to only apply to templates deployed as RG scope #995 Fixed expand template fails with createObject when no parameters are specified. #1000 Fixed ToUpper fails to convert character. #986 Fixed expression out of range of valid values. #1005 Fixed template expand fails in nested reference expansion. #1007","title":"v1.8.1"},{"location":"CHANGELOG-v1/#v180","text":"What's changed since v1.7.0: New features: Added Azure.GA_2021_09 baseline. #961 Includes rules released before or during September 2021 for Azure GA features. Marked baseline Azure.GA_2021_06 as obsolete. New rules: Application Gateway: Check App Gateways should use availability zones when available. Thanks @ArmaanMcleod . #928 Azure Kubernetes Service: Check clusters have control plane audit logs enabled. Thanks @ArmaanMcleod . #882 Check clusters have control plane diagnostics enabled. Thanks @ArmaanMcleod . #922 Check clusters use Container Insights for monitoring workloads. Thanks @ArmaanMcleod . #881 Check clusters use availability zones when available. Thanks @ArmaanMcleod . #880 Cosmos DB: Check DB account names meet naming requirements. #954 Check DB accounts use Azure AD identities for resource management operations. #953 Load Balancer: Check Load balancers are using Standard SKU. Thanks @ArmaanMcleod . #957 Check Load Balancers are configured with zone-redundancy. Thanks @ArmaanMcleod . #927 Engineering: Bump PSRule dependency to v1.7.2. #951 Automated update of availability zone information in providers.json. #907 Increased test coverage of rule reasons. Thanks @ArmaanMcleod . #960 Bug fixes: Fixed export of in-flight AKS related subnets for kubenet clusters. Thanks @ArmaanMcleod . #920 Fixed plan instance count is not applicable to Elastic Premium plans. #946 Fixed minimum App Service Plan fails Elastic Premium plans. #945 Fixed App Service Plan should include PremiumV3 plan. #944 Fixed Azure.VM.NICAttached with private endpoints. #932 Fixed Bicep CLI fails with unexpected end of content. #889 Fixed incomplete reason message for Azure.Storage.MinTLS . #971 Fixed false positive of Azure.Storage.UseReplication with large file storage. #965 What's changed since pre-release v1.8.0-B2109060: No additional changes.","title":"v1.8.0"},{"location":"CHANGELOG-v1/#v180-b2109086-pre-release","text":"What's changed since pre-release v1.8.0-B2109060: New rules: Load Balancer: Check Load balancers are using Standard SKU. Thanks @ArmaanMcleod . #957 Engineering: Increased test coverage of rule reasons. Thanks @ArmaanMcleod . #960 Bug fixes: Fixed Bicep CLI fails with unexpected end of content. #889 Fixed incomplete reason message for Azure.Storage.MinTLS . #971 Fixed false positive of Azure.Storage.UseReplication with large file storage. #965","title":"v1.8.0-B2109086 (pre-release)"},{"location":"CHANGELOG-v1/#v180-b2109060-pre-release","text":"What's changed since pre-release v1.8.0-B2109046: New features: Added Azure.GA_2021_09 baseline. #961 Includes rules released before or during September 2021 for Azure GA features. Marked baseline Azure.GA_2021_06 as obsolete. New rules: Load Balancer: Check Load Balancers are configured with zone-redundancy. Thanks @ArmaanMcleod . #927","title":"v1.8.0-B2109060 (pre-release)"},{"location":"CHANGELOG-v1/#v180-b2109046-pre-release","text":"What's changed since pre-release v1.8.0-B2109020: New rules: Application Gateway: Check App Gateways should use availability zones when available. Thanks @ArmaanMcleod . #928 Cosmos DB: Check DB account names meet naming requirements. #954 Check DB accounts use Azure AD identities for resource management operations. #953 Bug fixes: Fixed plan instance count is not applicable to Elastic Premium plans. #946 Fixed minimum App Service Plan fails Elastic Premium plans. #945 Fixed App Service Plan should include PremiumV3 plan. #944 Fixed Azure.VM.NICAttached with private endpoints. #932 Engineering: Bump PSRule dependency to v1.7.2. #951","title":"v1.8.0-B2109046 (pre-release)"},{"location":"CHANGELOG-v1/#v180-b2109020-pre-release","text":"What's changed since pre-release v1.8.0-B2108026: New rules: Azure Kubernetes Service: Check clusters have control plane audit logs enabled. Thanks @ArmaanMcleod . #882 Check clusters have control plane diagnostics enabled. Thanks @ArmaanMcleod . #922 Engineering: Bump PSRule dependency to v1.7.0. #938","title":"v1.8.0-B2109020 (pre-release)"},{"location":"CHANGELOG-v1/#v180-b2108026-pre-release","text":"What's changed since pre-release v1.8.0-B2108013: New rules: Azure Kubernetes Service: Check clusters use Container Insights for monitoring workloads. Thanks @ArmaanMcleod . #881 Bug fixes: Fixed export of in-flight AKS related subnets for kubenet clusters. Thanks @ArmaanMcleod . #920","title":"v1.8.0-B2108026 (pre-release)"},{"location":"CHANGELOG-v1/#v180-b2108013-pre-release","text":"What's changed since v1.7.0: New rules: Azure Kubernetes Service: Check clusters use availability zones when available. Thanks @ArmaanMcleod . #880 Engineering: Bump PSRule dependency to v1.6.1. #913 Automated update of availability zone information in providers.json. #907","title":"v1.8.0-B2108013 (pre-release)"},{"location":"CHANGELOG-v1/#v170","text":"What's changed since v1.6.0: New rules: All resources: Check template parameter files use metadata links. #846 Configure the AZURE_PARAMETER_FILE_METADATA_LINK option to enable this rule. Check template files use a recent schema. #845 Check template files use a https schema scheme. #894 Check template parameter files use a https schema scheme. #894 Check template parameters set a value. #896 Check template parameters use a valid secret reference. #897 Azure Kubernetes Service: Check clusters using Azure CNI should use large subnets. Thanks @ArmaanMcleod . #273 Check clusters use auto-scale node pools. Thanks @ArmaanMcleod . #218 By default, a minimum of a /23 subnet is required. Configure AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE to change the default minimum subnet size. Storage Account: Check Storage Accounts only accept explicitly allowed network traffic. #884 Updated rules: Virtual Network: Excluded AzureFirewallManagementSubnet from Azure.VNET.UseNSGs . #869 General improvements: Added version information to bicep compilation exceptions. #903 Engineering: Bump PSRule dependency to v1.6.0. #871 Bug fixes: Fixed DateTimeAdd function and tests within timezones with DST. #891 Fixed Azure.Template.ParameterValue failing on empty value. #901 What's changed since pre-release v1.7.0-B2108059: No additional changes.","title":"v1.7.0"},{"location":"CHANGELOG-v1/#v170-b2108059-pre-release","text":"What's changed since pre-release v1.7.0-B2108049: General improvements: Added version information to bicep compilation exceptions. #903 Bug fixes: Fixed Azure.Template.ParameterValue failing on empty value. #901","title":"v1.7.0-B2108059 (pre-release)"},{"location":"CHANGELOG-v1/#v170-b2108049-pre-release","text":"What's changed since pre-release v1.7.0-B2108040: New rules: All resources: Check template files use a recent schema. #845 Check template files use a https schema scheme. #894 Check template parameter files use a https schema scheme. #894 Check template parameters set a value. #896 Check template parameters use a valid secret reference. #897 Bug fixes: Fixed DateTimeAdd function and tests within timezones with DST. #891","title":"v1.7.0-B2108049 (pre-release)"},{"location":"CHANGELOG-v1/#v170-b2108040-pre-release","text":"What's changed since pre-release v1.7.0-B2108020: New rules: All resources: Check template parameter files use metadata links. #846 Configure the AZURE_PARAMETER_FILE_METADATA_LINK option to enable this rule. Azure Kubernetes Service: Check clusters using Azure CNI should use large subnets. Thanks @ArmaanMcleod . #273 By default, a minimum of a /23 subnet is required. Configure AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE to change the default minimum subnet size. Storage Account: Check Storage Accounts only accept explicitly allowed network traffic. #884","title":"v1.7.0-B2108040 (pre-release)"},{"location":"CHANGELOG-v1/#v170-b2108020-pre-release","text":"What's changed since v1.6.0: New rules: Azure Kubernetes Service: Check clusters use auto-scale node pools. Thanks @ArmaanMcleod . #218 Updated rules: Virtual Network: Excluded AzureFirewallManagementSubnet from Azure.VNET.UseNSGs . #869 Engineering: Bump PSRule dependency to v1.6.0. #871","title":"v1.7.0-B2108020 (pre-release)"},{"location":"CHANGELOG-v1/#v160","text":"What's changed since v1.5.1: New features: Experimental : Added support for expansion from Bicep source files. #848 #670 #858 Bicep support is currently experimental. To opt-in set the AZURE_BICEP_FILE_EXPANSION configuration to true . For more information see Using Bicep . New rules: Application Gateways: Check Application Gateways publish endpoints by HTTPS. #841 Engineering: Bump PSRule dependency to v1.5.0. #832 Migration of Pester v4 tests to Pester v5. Thanks @ArmaanMcleod . #395 What's changed since pre-release v1.6.0-B2108038: Bug fixes: Fixed Bicep expand creates deadlock and times out. #863","title":"v1.6.0"},{"location":"CHANGELOG-v1/#v160-b2108038-pre-release","text":"What's changed since pre-release v1.6.0-B2108023: Bug fixes: Fixed Bicep expand hangs analysis. #858","title":"v1.6.0-B2108038 (pre-release)"},{"location":"CHANGELOG-v1/#v160-b2108023-pre-release","text":"What's changed since pre-release v1.6.0-B2107028: New features: Experimental : Added support for expansion from Bicep source files. #848 #670 Bicep support is currently experimental. To opt-in set the AZURE_BICEP_FILE_EXPANSION configuration to true . For more information see Using Bicep .","title":"v1.6.0-B2108023 (pre-release)"},{"location":"CHANGELOG-v1/#v160-b2107028-pre-release","text":"What's changed since v1.5.1: New rules: Application Gateways: Check Application Gateways publish endpoints by HTTPS. #841 Engineering: Bump PSRule dependency to v1.5.0. #832","title":"v1.6.0-B2107028 (pre-release)"},{"location":"CHANGELOG-v1/#v151","text":"What's changed since v1.5.0: Bug fixes: Fixed rule does not detect more restrictive NSG rules. #831","title":"v1.5.1"},{"location":"CHANGELOG-v1/#v150","text":"What's changed since v1.4.1: New features: Added Azure.GA_2021_06 baseline. #822 Includes rules released before or during June 2021 for Azure GA features. Marked baseline Azure.GA_2021_03 as obsolete. New rules: Application Insights: Check App Insights resources use workspace-based configuration. #813 Check App Insights resources meet naming requirements. #814 General improvements: Exclude not applicable rules for templates generated with Bicep and PSArm. #815 Updated rule help to use docs pages for online version. #824 Engineering: Bump PSRule dependency to v1.4.0. #823 Bump YamlDotNet dependency to v11.2.1. #821 Migrate project to Azure GitHub organization and updated links. #800 Bug fixes: Fixed detection of parameters and variables with line breaks. #811 What's changed since pre-release v1.5.0-B2107002: No additional changes.","title":"v1.5.0"},{"location":"CHANGELOG-v1/#v150-b2107002-pre-release","text":"What's changed since pre-release v1.5.0-B2106018: New features: Added Azure.GA_2021_06 baseline. #822 Includes rules released before or during June 2021 for Azure GA features. Marked baseline Azure.GA_2021_03 as obsolete. General improvements: Updated rule help to use docs pages for online version. #824 Engineering: Bump PSRule dependency to v1.4.0. #823 Bump YamlDotNet dependency to v11.2.1. #821","title":"v1.5.0-B2107002 (pre-release)"},{"location":"CHANGELOG-v1/#v150-b2106018-pre-release","text":"What's changed since v1.4.1: New rules: Application Insights: Check App Insights resources use workspace-based configuration. #813 Check App Insights resources meet naming requirements. #814 General improvements: Exclude not applicable rules for templates generated with Bicep and PSArm. #815 Engineering: Bump YamlDotNet dependency to v11.2.0. #801 Migrate project to Azure GitHub organization and updated links. #800 Bug fixes: Fixed detection of parameters and variables with line breaks. #811","title":"v1.5.0-B2106018 (pre-release)"},{"location":"CHANGELOG-v1/#v141","text":"What's changed since v1.4.0: Bug fixes: Fixed boolean string conversion case. #793 Fixed case sensitive property matching. #794 Fixed automatic expansion of template parameter files. #796 Template parameter files are not automatically expanded by default. To enable this, set the AZURE_PARAMETER_FILE_EXPANSION configuration option.","title":"v1.4.1"},{"location":"CHANGELOG-v1/#v140","text":"What's changed since v1.3.2: New features: Automatically expand template from parameter files for analysis. #772 Previously templates needed to be exported with Export-AzRuleTemplateData . To export template data automatically use PSRule cmdlets with -Format File . New rules: Cognitive Search: Check search services meet index SLA replica requirement. #761 Check search services meet query SLA replica requirement. #762 Check search services meet naming requirements. #763 Check search services use a minimum SKU. #764 Check search services use managed identities. #765 Azure Kubernetes Service: Check clusters use AKS-managed Azure AD integration. #436 Check clusters have local account disabled (preview). #786 Check clusters have an auto-upgrade channel set (preview). #787 Check clusters limit access network access to the API server. #788 Check clusters used Azure RBAC for Kubernetes authorization. #789 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.20.5. #767 General improvements: Automatically nest template sub-resources for analysis. #746 Sub-resources such as diagnostic logs or configurations are automatically nested. Automatic nesting a resource requires: The parent resource is defined in the same template. The sub-resource depends on the parent resource. Added support for source location references to template files. #781 Output includes source location to resources exported from a templates. Bug fixes: Fixed string index parsing in expressions with whitespace. #775 Fixed base for DateTimeAdd is not a valid string. #777 Engineering: Added source link to project. #783 What's changed since pre-release v1.4.0-B2105057: No additional changes.","title":"v1.4.0"},{"location":"CHANGELOG-v1/#v140-b2105057-pre-release","text":"What's changed since pre-release v1.4.0-B2105050: New rules: Azure Kubernetes Service: Check clusters use AKS-managed Azure AD integration. #436 Check clusters have local account disabled (preview). #786 Check clusters have an auto-upgrade channel set (preview). #787 Check clusters limit access network access to the API server. #788 Check clusters used Azure RBAC for Kubernetes authorization. #789 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.20.5. #767 Engineering: Added source link to project. #783","title":"v1.4.0-B2105057 (pre-release)"},{"location":"CHANGELOG-v1/#v140-b2105050-pre-release","text":"What's changed since pre-release v1.4.0-B2105044: General improvements: Added support for source location references to template files. #781 Output includes source location to resources exported from a templates.","title":"v1.4.0-B2105050 (pre-release)"},{"location":"CHANGELOG-v1/#v140-b2105044-pre-release","text":"What's changed since pre-release v1.4.0-B2105027: New features: Automatically expand template from parameter files for analysis. #772 Previously templates needed to be exported with Export-AzRuleTemplateData . To export template data automatically use PSRule cmdlets with -Format File . Bug fixes: Fixed string index parsing in expressions with whitespace. #775 Fixed base for DateTimeAdd is not a valid string. #777","title":"v1.4.0-B2105044 (pre-release)"},{"location":"CHANGELOG-v1/#v140-b2105027-pre-release","text":"What's changed since pre-release v1.4.0-B2105020: New rules: Cognitive Search: Check search services meet index SLA replica requirement. #761 Check search services meet query SLA replica requirement. #762 Check search services meet naming requirements. #763 Check search services use a minimum SKU. #764 Check search services use managed identities. #765","title":"v1.4.0-B2105027 (pre-release)"},{"location":"CHANGELOG-v1/#v140-b2105020-pre-release","text":"What's changed since v1.3.2: General improvements: Automatically nest template sub-resources for analysis. #746 Sub-resources such as diagnostic logs or configurations are automatically nested. Automatic nesting a resource requires: The parent resource is defined in the same template. The sub-resource depends on the parent resource.","title":"v1.4.0-B2105020 (pre-release)"},{"location":"CHANGELOG-v1/#v132","text":"What's changed since v1.3.1: Bug fixes: Fixed rule reason reported the parameter inputObject is null. #753","title":"v1.3.2"},{"location":"CHANGELOG-v1/#v131","text":"What's changed since v1.3.0: Engineering: Bump PSRule dependency to v1.3.0. #749 Bump YamlDotNet dependency to v11.1.1. #742","title":"v1.3.1"},{"location":"CHANGELOG-v1/#v130","text":"What's changed since v1.2.1: New rules: Policy: Check policy assignment display name and description are set. #725 Check policy assignment assigned by metadata is set. #726 Check policy exemption display name and description are set. #723 Check policy waiver exemptions have an expiry date set. #724 Removed rules: Storage: Remove Azure.Storage.UseEncryption as Storage Service Encryption (SSE) is always on. #630 SSE is on by default and can not be disabled. General improvements: Additional metadata added in parameter files is passed through with Get-AzRuleTemplateLink . #706 Improved binding support for File inputs. #480 Template and parameter file names now return a relative path instead of full path. Added API version for each module resource. #729 Engineering: Clean up depreciated warning message for configuration option azureAllowedRegions . #737 Clean up depreciated warning message for configuration option minAKSVersion . #738 Bump PSRule dependency to v1.2.0. #713 Bug fixes: Fixed could not load file or assembly YamlDotNet. #741 This fix pins the PSRule version to v1.2.0 until the next stable release of PSRule for Azure. What's changed since pre-release v1.3.0-B2104040: No additional changes.","title":"v1.3.0"},{"location":"CHANGELOG-v1/#v130-b2104040-pre-release","text":"What's changed since pre-release v1.3.0-B2104034: Bug fixes: Fixed could not load file or assembly YamlDotNet. #741 This fix pins the PSRule version to v1.2.0 until the next stable release of PSRule for Azure.","title":"v1.3.0-B2104040 (pre-release)"},{"location":"CHANGELOG-v1/#v130-b2104034-pre-release","text":"What's changed since pre-release v1.3.0-B2104023: New rules: Policy: Check policy assignment display name and description are set. #725 Check policy assignment assigned by metadata is set. #726 Check policy exemption display name and description are set. #723 Check policy waiver exemptions have an expiry date set. #724 Engineering: Clean up depreciated warning message for configuration option azureAllowedRegions . #737 Clean up depreciated warning message for configuration option minAKSVersion . #738","title":"v1.3.0-B2104034 (pre-release)"},{"location":"CHANGELOG-v1/#v130-b2104023-pre-release","text":"What's changed since pre-release v1.3.0-B2104013: General improvements: Improved binding support for File inputs. #480 Template and parameter file names now return a relative path instead of full path. Added API version for each module resource. #729","title":"v1.3.0-B2104023 (pre-release)"},{"location":"CHANGELOG-v1/#v130-b2104013-pre-release","text":"What's changed since pre-release v1.3.0-B2103007: Engineering: Bump PSRule dependency to v1.2.0. #713 Bug fixes: Fixed export not expanding nested deployments. #715","title":"v1.3.0-B2104013 (pre-release)"},{"location":"CHANGELOG-v1/#v130-b2103007-pre-release","text":"What's changed since v1.2.0: Removed rules: Storage: Remove Azure.Storage.UseEncryption as Storage Service Encryption (SSE) is always on. #630 SSE is on by default and can not be disabled. General improvements: Additional metadata added in parameter files is passed through with Get-AzRuleTemplateLink . #706","title":"v1.3.0-B2103007 (pre-release)"},{"location":"CHANGELOG-v1/#v121","text":"What's changed since v1.2.0: Bug fixes: Fixed export not expanding nested deployments. #715","title":"v1.2.1"},{"location":"CHANGELOG-v1/#v120","text":"What's changed since v1.1.4: New features: Added Azure.GA_2021_03 baseline. #673 Includes rules released before or during March 2021 for Azure GA features. Marked baseline Azure.GA_2020_12 as obsolete. New rules: Key Vault: Check vaults, keys, and secrets meet name requirements. #646 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.19.7. #696 General improvements: Added support for user defined functions in templates. #682 Engineering: Bump PSRule dependency to v1.1.0. #692 What's changed since pre-release v1.2.0-B2103044: No additional changes.","title":"v1.2.0"},{"location":"CHANGELOG-v1/#v120-b2103044-pre-release","text":"What's changed since pre-release v1.2.0-B2103032: New features: Added Azure.GA_2021_03 baseline. #673 Includes rules released before or during March 2021 for Azure GA features. Marked baseline Azure.GA_2020_12 as obsolete. Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.19.7. #696","title":"v1.2.0-B2103044 (pre-release)"},{"location":"CHANGELOG-v1/#v120-b2103032-pre-release","text":"What's changed since pre-release v1.2.0-B2103024: New rules: Key Vault: Check vaults, keys, and secrets meet name requirements. #646 Engineering: Bump PSRule dependency to v1.1.0. #692","title":"v1.2.0-B2103032 (pre-release)"},{"location":"CHANGELOG-v1/#v120-b2103024-pre-release","text":"What's changed since v1.1.4: General improvements: Added support for user defined functions in templates. #682","title":"v1.2.0-B2103024 (pre-release)"},{"location":"CHANGELOG-v1/#v114","text":"What's changed since v1.1.3: Bug fixes: Fixed handling of literal index with copyIndex function. #686 Fixed handling of inner scoped nested deployments. #687","title":"v1.1.4"},{"location":"CHANGELOG-v1/#v113","text":"What's changed since v1.1.2: Bug fixes: Fixed parsing of property names for functions across multiple lines. #683","title":"v1.1.3"},{"location":"CHANGELOG-v1/#v112","text":"What's changed since v1.1.1: Bug fixes: Fixed copy peer property resolve. #677 Fixed partial resource group or subscription object not populating. #678 Fixed lazy loading of environment and resource providers. #679","title":"v1.1.2"},{"location":"CHANGELOG-v1/#v111","text":"What's changed since v1.1.0: Bug fixes: Fixed support for parameter file schemas. #674","title":"v1.1.1"},{"location":"CHANGELOG-v1/#v110","text":"What's changed since v1.0.0: New features: Exporting template with Export-AzRuleTemplateData supports custom resource group and subscription. #651 Subscription and resource group used for deployment can be specified instead of using defaults. ResourceGroupName parameter of Export-AzRuleTemplateData has been renamed to ResourceGroup . Added a parameter alias for ResourceGroupName on Export-AzRuleTemplateData . New rules: All resources: Check template parameters are defined. #631 Check location parameter is type string. #632 Check template parameter minValue and maxValue constraints are valid. #637 Check template resources do not use hard coded locations. #633 Check resource group location not referenced instead of location parameter. #634 Check increased debug detail is disabled for nested deployments. #638 General improvements: Added support for matching template by name. #661 Get-AzRuleTemplateLink discovers <templateName>.json from <templateName>.parameters.json . Engineering: Bump PSRule dependency to v1.0.3. #648 Bug fixes: Fixed Azure.VM.ADE to limit rule to exports only. #644 Fixed if condition values evaluation order. #652 Fixed handling of int parameters with large values. #653 Fixed handling of expressions split over multiple lines. #654 Fixed handling of bool parameter values within logical expressions. #655 Fixed copy loop value does not fall within the expected range. #664 Fixed template comparison functions handling of large integer values. #666 Fixed handling of createArray function with no arguments. #667 What's changed since pre-release v1.1.0-B2102034: No additional changes.","title":"v1.1.0"},{"location":"CHANGELOG-v1/#v110-b2102034-pre-release","text":"What's changed since pre-release v1.1.0-B2102023: General improvements: Added support for matching template by name. #661 Get-AzRuleTemplateLink discovers <templateName>.json from <templateName>.parameters.json . Bug fixes: Fixed copy loop value does not fall within the expected range. #664 Fixed template comparison functions handling of large integer values. #666 Fixed handling of createArray function with no arguments. #667","title":"v1.1.0-B2102034 (pre-release)"},{"location":"CHANGELOG-v1/#v110-b2102023-pre-release","text":"What's changed since pre-release v1.1.0-B2102015: New features: Exporting template with Export-AzRuleTemplateData supports custom resource group and subscription. #651 Subscription and resource group used for deployment can be specified instead of using defaults. ResourceGroupName parameter of Export-AzRuleTemplateData has been renamed to ResourceGroup . Added a parameter alias for ResourceGroupName on Export-AzRuleTemplateData .","title":"v1.1.0-B2102023 (pre-release)"},{"location":"CHANGELOG-v1/#v110-b2102015-pre-release","text":"What's changed since pre-release v1.1.0-B2102010: Bug fixes: Fixed if condition values evaluation order. #652 Fixed handling of int parameters with large values. #653 Fixed handling of expressions split over multiple lines. #654 Fixed handling of bool parameter values within logical expressions. #655","title":"v1.1.0-B2102015 (pre-release)"},{"location":"CHANGELOG-v1/#v110-b2102010-pre-release","text":"What's changed since pre-release v1.1.0-B2102001: Engineering: Bump PSRule dependency to v1.0.3. #648 Bug fixes: Fixed Azure.VM.ADE to limit rule to exports only. #644","title":"v1.1.0-B2102010 (pre-release)"},{"location":"CHANGELOG-v1/#v110-b2102001-pre-release","text":"What's changed since v1.0.0: New rules: All resources: Check template parameters are defined. #631 Check location parameter is type string. #632 Check template parameter minValue and maxValue constraints are valid. #637 Check template resources do not use hard coded locations. #633 Check resource group location not referenced instead of location parameter. #634 Check increased debug detail is disabled for nested deployments. #638 Engineering: Bump PSRule dependency to v1.0.2. #635","title":"v1.1.0-B2102001 (pre-release)"},{"location":"CHANGELOG-v1/#v100","text":"What's changed since v0.19.0: New rules: All resources: Check parameter default value type matches type. #311 Check location parameter defaults to resource group. #361 Front Door: Check Front Door uses a health probe for each backend pool. #546 Check Front Door uses a dedicated health probe path backend pools. #547 Check Front Door uses HEAD requests for backend health probes. #613 Service Fabric: Check Service Fabric clusters use AAD client authentication. #619 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.19.6. #603 General improvements: Renamed Export-AzTemplateRuleData to Export-AzRuleTemplateData . #596 New name Export-AzRuleTemplateData aligns with prefix of other cmdlets. Use of Export-AzTemplateRuleData is now deprecated and will be removed in the next major version. Added alias to allow Export-AzTemplateRuleData to continue to be used. Using Export-AzTemplateRuleData returns a deprecation warning. Added support for environment template function. #517 Engineering: Bump PSRule dependency to v1.0.1. #611 What's changed since pre-release v1.0.0-B2101028: No additional changes.","title":"v1.0.0"},{"location":"CHANGELOG-v1/#v100-b2101028-pre-release","text":"What's changed since pre-release v1.0.0-B2101016: New rules: All resources: Check parameter default value type matches type. #311 General improvements: Renamed Export-AzTemplateRuleData to Export-AzRuleTemplateData . #596 New name Export-AzRuleTemplateData aligns with prefix of other cmdlets. Use of Export-AzTemplateRuleData is now deprecated and will be removed in the next major version. Added alias to allow Export-AzTemplateRuleData to continue to be used. Using Export-AzTemplateRuleData returns a deprecation warning.","title":"v1.0.0-B2101028 (pre-release)"},{"location":"CHANGELOG-v1/#v100-b2101016-pre-release","text":"What's changed since pre-release v1.0.0-B2101006: New rules: Service Fabric: Check Service Fabric clusters use AAD client authentication. #619 Bug fixes: Fixed reason Azure.FrontDoor.ProbePath so the probe name is included. #617","title":"v1.0.0-B2101016 (pre-release)"},{"location":"CHANGELOG-v1/#v100-b2101006-pre-release","text":"What's changed since v0.19.0: New rules: All resources: Check location parameter defaults to resource group. #361 Front Door: Check Front Door uses a health probe for each backend pool. #546 Check Front Door uses a dedicated health probe path backend pools. #547 Check Front Door uses HEAD requests for backend health probes. #613 Updated rules: Azure Kubernetes Service: Updated Azure.AKS.Version to 1.19.6. #603 General improvements: Added support for environment template function. #517 Engineering: Bump PSRule dependency to v1.0.1. #611","title":"v1.0.0-B2101006 (pre-release)"},{"location":"about/","text":"What is PSRule for Azure? # PSRule for Azure is a pre-built set of tests and documentation to help you configure Azure solutions. These tests allow you to check your Infrastructure as Code ( IaC ) before or after deployment to Azure. PSRule for Azure includes tests that check how IaC is written and how Azure resources are configured. Why use PSRule for Azure? # PSRule for Azure helps you identify changes to improve the quality of solutions deployed on Azure. PSRule for Azure uses the principles of the Azure Well-Architected Framework (WAF) to: Suggest changes \u2014 you can use to improve the quality of your solution. Link to documentation \u2014 to learn how this applies to your environment. Demonstrate \u2014 how you can implement the change with examples.","title":"About"},{"location":"about/#what-is-psrule-for-azure","text":"PSRule for Azure is a pre-built set of tests and documentation to help you configure Azure solutions. These tests allow you to check your Infrastructure as Code ( IaC ) before or after deployment to Azure. PSRule for Azure includes tests that check how IaC is written and how Azure resources are configured.","title":"What is PSRule for Azure?"},{"location":"about/#why-use-psrule-for-azure","text":"PSRule for Azure helps you identify changes to improve the quality of solutions deployed on Azure. PSRule for Azure uses the principles of the Azure Well-Architected Framework (WAF) to: Suggest changes \u2014 you can use to improve the quality of your solution. Link to documentation \u2014 to learn how this applies to your environment. Demonstrate \u2014 how you can implement the change with examples.","title":"Why use PSRule for Azure?"},{"location":"analyzing-resources/","text":"Analyzing resources # The current state of Azure resources can be tested with PSRule for Azure, referred to as in-flight analysis. This is a two step process that works in high security environments with separation of roles. Abstract This topics covers how you can test the state of deployed Azure resources that have been exported. Important This step requires that you have already exported the state of deployed Azure resources. Before continuing, complete Exporting rule data for the resources that will be tested. Analyzing exported state # The state of resources can be analyzed for exported state by using the Invoke-PSRule PowerShell cmdlet. For example: Invoke-PSRule -InputPath 'out/' -Module 'PSRule.Rules.Azure' ; To filter results to only failed rules, use Invoke-PSRule -Outcome Fail . Passed, failed and error results are shown by default. For example: # Only show failed results Invoke-PSRule -InputPath 'out/' -Module 'PSRule.Rules.Azure' -Outcome Fail ; The output of this example is: TargetName: storage RuleName Outcome Recommendation -------- ------- -------------- Azure.Storage.UseReplication Fail Storage accounts not using GRS may be at risk Azure.Storage.SecureTransferRequ... Fail Storage accounts should only accept secure traffic Azure.Storage.SoftDelete Fail Enable soft delete on Storage Accounts A summary of results can be displayed by using Invoke-PSRule -As Summary . For example: # Display as summary results Invoke-PSRule -InputPath 'out/' -Module 'PSRule.Rules.Azure' -As Summary ; The output of this example is: RuleName Pass Fail Outcome -------- ---- ---- ------- Azure.ACR.MinSku 0 1 Fail Azure.AppService.PlanInstanceCount 0 1 Fail Azure.AppService.UseHTTPS 0 2 Fail Azure.Resource.UseTags 73 36 Fail Azure.SQL.ThreatDetection 0 1 Fail Azure.SQL.Auditing 0 1 Fail Azure.Storage.UseReplication 1 7 Fail Azure.Storage.SecureTransferRequ... 2 6 Fail Azure.Storage.SoftDelete 0 8 Fail Ignoring rules # To prevent a rule executing you can either: Exclude \u2014 The rule is not executed for any resource. Suppress \u2014 The rule is not executed for a specific resource by name. To exclude a rule, set Rule.Exclude option within the ps-rule.yaml file. Docs rule : exclude : # Ignore the following rules for all resources - Azure.VM.UseHybridUseBenefit - Azure.VM.Standalone To suppress a rule, set Suppression option within the ps-rule.yaml file. Docs suppression : Azure.AKS.AuthorizedIPs : # Exclude the following externally managed AKS clusters - aks-cluster-prod-eus-001 Azure.Storage.SoftDelete : # Exclude the following non-production storage accounts - storagedeveus6jo36t - storagedeveus1df278 Tip Use comments within ps-rule.yaml to describe the reason why rules are excluded or suppressed. Meaningful comments help during peer review within a Pull Request (PR). Also consider including a date if the exclusions or suppressions are temporary. Advanced configuration # Docs PSRule for Azure comes with many configuration options. The setup section explains in detail how to configure each option.","title":"Analyzing resources"},{"location":"analyzing-resources/#analyzing-resources","text":"The current state of Azure resources can be tested with PSRule for Azure, referred to as in-flight analysis. This is a two step process that works in high security environments with separation of roles. Abstract This topics covers how you can test the state of deployed Azure resources that have been exported. Important This step requires that you have already exported the state of deployed Azure resources. Before continuing, complete Exporting rule data for the resources that will be tested.","title":"Analyzing resources"},{"location":"analyzing-resources/#analyzing-exported-state","text":"The state of resources can be analyzed for exported state by using the Invoke-PSRule PowerShell cmdlet. For example: Invoke-PSRule -InputPath 'out/' -Module 'PSRule.Rules.Azure' ; To filter results to only failed rules, use Invoke-PSRule -Outcome Fail . Passed, failed and error results are shown by default. For example: # Only show failed results Invoke-PSRule -InputPath 'out/' -Module 'PSRule.Rules.Azure' -Outcome Fail ; The output of this example is: TargetName: storage RuleName Outcome Recommendation -------- ------- -------------- Azure.Storage.UseReplication Fail Storage accounts not using GRS may be at risk Azure.Storage.SecureTransferRequ... Fail Storage accounts should only accept secure traffic Azure.Storage.SoftDelete Fail Enable soft delete on Storage Accounts A summary of results can be displayed by using Invoke-PSRule -As Summary . For example: # Display as summary results Invoke-PSRule -InputPath 'out/' -Module 'PSRule.Rules.Azure' -As Summary ; The output of this example is: RuleName Pass Fail Outcome -------- ---- ---- ------- Azure.ACR.MinSku 0 1 Fail Azure.AppService.PlanInstanceCount 0 1 Fail Azure.AppService.UseHTTPS 0 2 Fail Azure.Resource.UseTags 73 36 Fail Azure.SQL.ThreatDetection 0 1 Fail Azure.SQL.Auditing 0 1 Fail Azure.Storage.UseReplication 1 7 Fail Azure.Storage.SecureTransferRequ... 2 6 Fail Azure.Storage.SoftDelete 0 8 Fail","title":"Analyzing exported state"},{"location":"analyzing-resources/#ignoring-rules","text":"To prevent a rule executing you can either: Exclude \u2014 The rule is not executed for any resource. Suppress \u2014 The rule is not executed for a specific resource by name. To exclude a rule, set Rule.Exclude option within the ps-rule.yaml file. Docs rule : exclude : # Ignore the following rules for all resources - Azure.VM.UseHybridUseBenefit - Azure.VM.Standalone To suppress a rule, set Suppression option within the ps-rule.yaml file. Docs suppression : Azure.AKS.AuthorizedIPs : # Exclude the following externally managed AKS clusters - aks-cluster-prod-eus-001 Azure.Storage.SoftDelete : # Exclude the following non-production storage accounts - storagedeveus6jo36t - storagedeveus1df278 Tip Use comments within ps-rule.yaml to describe the reason why rules are excluded or suppressed. Meaningful comments help during peer review within a Pull Request (PR). Also consider including a date if the exclusions or suppressions are temporary.","title":"Ignoring rules"},{"location":"analyzing-resources/#advanced-configuration","text":"Docs PSRule for Azure comes with many configuration options. The setup section explains in detail how to configure each option.","title":"Advanced configuration"},{"location":"creating-your-pipeline/","text":"Creating your pipeline # You can use PSRule for Azure to validate Azure resources throughout their lifecycle. By using validation within a continuous integration (CI) pipeline, any issues provide fast feedback. Within the root directory of your infrastructure as code repository: GitHub Actions Azure Pipelines Create a new GitHub Actions workflow by creating .github/workflows/analyze-arm.yaml . name : Analyze templates on : push : branches : - main pull_request : branches : - main jobs : analyze_arm : name : Analyze templates runs-on : ubuntu-latest steps : - name : Checkout uses : actions/checkout@v3 # Analyze Azure resources using PSRule for Azure - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : 'PSRule.Rules.Azure' Create a new Azure DevOps YAML pipeline by creating .azure-pipelines/analyze-arm.yaml . steps : # Analyze Azure resources using PSRule for Azure - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure' This will automatically install compatible versions of all dependencies. Parameters # Several parameters are available to customize the behavior of the pipeline. In addition, many of these parameters are also available as configuration options configurable within ps-rule.yaml . Some of the most common parameters are listed below. For a full list of parameters see the readme for GitHub Actions or Azure Pipelines . Limiting input to a specific path # You can use the inputPath parameter to limit the analysis to a specific path. Tip The inputPath parameter only accepts a relative path. For example: azure/modules/ if you have a azure/modules/ directory in the root of your repository. Becareful not to specify a leading / such as /azure/modules/ . On Linux / is the root directory, which makes this a fully qualified path instead of a relative path. GitHub Actions Azure Pipelines # Analyze Azure resources using PSRule for Azure - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : 'PSRule.Rules.Azure' inputPath : azure/modules/ # Analyze Azure resources using PSRule for Azure - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure' inputPath : azure/modules/ Configuring a baseline # You can set the baseline parameter to specify the name of a baseline to use. A baseline is a set of rules and configuration. PSRule for Azure ships with multiple baselines to choose from. See working with baselines for more information. GitHub Actions Azure Pipelines # Analyze Azure resources using PSRule for Azure - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : 'PSRule.Rules.Azure' baseline : Azure.GA_2022_06 # Analyze Azure resources using PSRule for Azure - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure' baseline : Azure.GA_2022_06 Adding additional modules # You can add additional modules to the modules parameter by using comma ( , ) separating each module name. GitHub Actions Azure Pipelines # Analyze Azure resources using PSRule for Azure - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : 'PSRule.Rules.Azure,PSRule.Monitor' # Analyze Azure resources using PSRule for Azure - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure,PSRule.Monitor' Outputting results # You can configure PSRule to output results into a file by using the outputFormat and outputPath parameters. For details on the formats that are supported see analysis output . GitHub Actions Azure Pipelines # Analyze Azure resources using PSRule for Azure - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : 'PSRule.Rules.Azure' outputFormat : Sarif outputPath : reports/ps-rule-results.sarif # Analyze Azure resources using PSRule for Azure - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure' outputFormat : Sarif outputPath : reports/ps-rule-results.sarif Configuration # Configuration options for PSRule for Azure are set within the ps-rule.yaml file. To set options, create a new file named ps-rule.yaml in the root directory of your repository. Tip This file should be committed to your repository so it is available when your pipeline runs. Expand template parameter files # Docs PSRule for Azure can automatically expand Azure template parameter files. When enabled, PSRule for Azure automatically resolves parameter and template file context at runtime. To enabled this feature, set the Configuration.AZURE_PARAMETER_FILE_EXPANSION option to true . This option can be set within the ps-rule.yaml file. ps-rule.yaml configuration : # Enable automatic expansion of Azure parameter files AZURE_PARAMETER_FILE_EXPANSION : true Expand Bicep source files # Docs PSRule for Azure can automatically expand Bicep source files. When enabled, PSRule for Azure automatically expands and analyzes Azure resource from .bicep files. To enabled this feature, set the Configuration.AZURE_BICEP_FILE_EXPANSION option to true . This option can be set within the ps-rule.yaml file. ps-rule.yaml configuration : # Enable automatic expansion of bicep source files AZURE_BICEP_FILE_EXPANSION : true Ignoring rules # To prevent a rule executing you can either: Exclude \u2014 The rule is not executed for any resource. Suppress \u2014 The rule is not executed for a specific resource by name. To exclude a rule, set Rule.Exclude option within the ps-rule.yaml file. Docs ps-rule.yaml rule : exclude : # Ignore the following rules for all resources - Azure.VM.UseHybridUseBenefit - Azure.VM.Standalone To suppress a rule, set Suppression option within the ps-rule.yaml file. Docs ps-rule.yaml suppression : Azure.AKS.AuthorizedIPs : # Exclude the following externally managed AKS clusters - aks-cluster-prod-eus-001 Azure.Storage.SoftDelete : # Exclude the following non-production storage accounts - storagedeveus6jo36t - storagedeveus1df278 Tip Use comments within ps-rule.yaml to describe the reason why rules are excluded or suppressed. Meaningful comments help during peer review within a Pull Request (PR). Also consider including a date if the exclusions or suppressions are temporary. Advanced configuration # Docs PSRule for Azure comes with many configuration options. The setup section explains in detail how to configure each option.","title":"Creating your pipeline"},{"location":"creating-your-pipeline/#creating-your-pipeline","text":"You can use PSRule for Azure to validate Azure resources throughout their lifecycle. By using validation within a continuous integration (CI) pipeline, any issues provide fast feedback. Within the root directory of your infrastructure as code repository: GitHub Actions Azure Pipelines Create a new GitHub Actions workflow by creating .github/workflows/analyze-arm.yaml . name : Analyze templates on : push : branches : - main pull_request : branches : - main jobs : analyze_arm : name : Analyze templates runs-on : ubuntu-latest steps : - name : Checkout uses : actions/checkout@v3 # Analyze Azure resources using PSRule for Azure - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : 'PSRule.Rules.Azure' Create a new Azure DevOps YAML pipeline by creating .azure-pipelines/analyze-arm.yaml . steps : # Analyze Azure resources using PSRule for Azure - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure' This will automatically install compatible versions of all dependencies.","title":"Creating your pipeline"},{"location":"creating-your-pipeline/#parameters","text":"Several parameters are available to customize the behavior of the pipeline. In addition, many of these parameters are also available as configuration options configurable within ps-rule.yaml . Some of the most common parameters are listed below. For a full list of parameters see the readme for GitHub Actions or Azure Pipelines .","title":"Parameters"},{"location":"creating-your-pipeline/#limiting-input-to-a-specific-path","text":"You can use the inputPath parameter to limit the analysis to a specific path. Tip The inputPath parameter only accepts a relative path. For example: azure/modules/ if you have a azure/modules/ directory in the root of your repository. Becareful not to specify a leading / such as /azure/modules/ . On Linux / is the root directory, which makes this a fully qualified path instead of a relative path. GitHub Actions Azure Pipelines # Analyze Azure resources using PSRule for Azure - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : 'PSRule.Rules.Azure' inputPath : azure/modules/ # Analyze Azure resources using PSRule for Azure - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure' inputPath : azure/modules/","title":"Limiting input to a specific path"},{"location":"creating-your-pipeline/#configuring-a-baseline","text":"You can set the baseline parameter to specify the name of a baseline to use. A baseline is a set of rules and configuration. PSRule for Azure ships with multiple baselines to choose from. See working with baselines for more information. GitHub Actions Azure Pipelines # Analyze Azure resources using PSRule for Azure - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : 'PSRule.Rules.Azure' baseline : Azure.GA_2022_06 # Analyze Azure resources using PSRule for Azure - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure' baseline : Azure.GA_2022_06","title":"Configuring a baseline"},{"location":"creating-your-pipeline/#adding-additional-modules","text":"You can add additional modules to the modules parameter by using comma ( , ) separating each module name. GitHub Actions Azure Pipelines # Analyze Azure resources using PSRule for Azure - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : 'PSRule.Rules.Azure,PSRule.Monitor' # Analyze Azure resources using PSRule for Azure - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure,PSRule.Monitor'","title":"Adding additional modules"},{"location":"creating-your-pipeline/#outputting-results","text":"You can configure PSRule to output results into a file by using the outputFormat and outputPath parameters. For details on the formats that are supported see analysis output . GitHub Actions Azure Pipelines # Analyze Azure resources using PSRule for Azure - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : 'PSRule.Rules.Azure' outputFormat : Sarif outputPath : reports/ps-rule-results.sarif # Analyze Azure resources using PSRule for Azure - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure' outputFormat : Sarif outputPath : reports/ps-rule-results.sarif","title":"Outputting results"},{"location":"creating-your-pipeline/#configuration","text":"Configuration options for PSRule for Azure are set within the ps-rule.yaml file. To set options, create a new file named ps-rule.yaml in the root directory of your repository. Tip This file should be committed to your repository so it is available when your pipeline runs.","title":"Configuration"},{"location":"creating-your-pipeline/#expand-template-parameter-files","text":"Docs PSRule for Azure can automatically expand Azure template parameter files. When enabled, PSRule for Azure automatically resolves parameter and template file context at runtime. To enabled this feature, set the Configuration.AZURE_PARAMETER_FILE_EXPANSION option to true . This option can be set within the ps-rule.yaml file. ps-rule.yaml configuration : # Enable automatic expansion of Azure parameter files AZURE_PARAMETER_FILE_EXPANSION : true","title":"Expand template parameter files"},{"location":"creating-your-pipeline/#expand-bicep-source-files","text":"Docs PSRule for Azure can automatically expand Bicep source files. When enabled, PSRule for Azure automatically expands and analyzes Azure resource from .bicep files. To enabled this feature, set the Configuration.AZURE_BICEP_FILE_EXPANSION option to true . This option can be set within the ps-rule.yaml file. ps-rule.yaml configuration : # Enable automatic expansion of bicep source files AZURE_BICEP_FILE_EXPANSION : true","title":"Expand Bicep source files"},{"location":"creating-your-pipeline/#ignoring-rules","text":"To prevent a rule executing you can either: Exclude \u2014 The rule is not executed for any resource. Suppress \u2014 The rule is not executed for a specific resource by name. To exclude a rule, set Rule.Exclude option within the ps-rule.yaml file. Docs ps-rule.yaml rule : exclude : # Ignore the following rules for all resources - Azure.VM.UseHybridUseBenefit - Azure.VM.Standalone To suppress a rule, set Suppression option within the ps-rule.yaml file. Docs ps-rule.yaml suppression : Azure.AKS.AuthorizedIPs : # Exclude the following externally managed AKS clusters - aks-cluster-prod-eus-001 Azure.Storage.SoftDelete : # Exclude the following non-production storage accounts - storagedeveus6jo36t - storagedeveus1df278 Tip Use comments within ps-rule.yaml to describe the reason why rules are excluded or suppressed. Meaningful comments help during peer review within a Pull Request (PR). Also consider including a date if the exclusions or suppressions are temporary.","title":"Ignoring rules"},{"location":"creating-your-pipeline/#advanced-configuration","text":"Docs PSRule for Azure comes with many configuration options. The setup section explains in detail how to configure each option.","title":"Advanced configuration"},{"location":"deprecations/","text":"Deprecations # Deprecations for v2.0.0 # Realigned configuration option names # The following configuration options will be renamed in upcoming releases of PSRule for Azure. This is part of a ongoing effort to align the naming of configuration options across PSRule for Azure. We plan to have all the old option names renamed and they will not longer work from v2. To upgrade use the new names instead. Until v2, the old option names are still work and will take precedence if new and old are configured. New name Old name Available from AZURE_AKS_CLUSTER_MINIMUM_VERSION Azure_AKSMinimumVersion v1.12.0 AZURE_AKS_POOL_MINIMUM_MAXPODS Azure_AKSNodeMinimumMaxPods TBA - not available AZURE_RESOURCE_ALLOWED_LOCATIONS Azure_AllowedRegions TBA - not available AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME Azure_MinimumCertificateLifetime TBA - not available Note Configuration options marked TBA are not available yet. Please use the old names until they are available. Check the change log and the upgrade notes for more information on a future release. Important New option names will work from the release specified by Available from . Configuring these options prior to that release will have no affect. For details on configuring these options see upgrade notes for details.","title":"Deprecations"},{"location":"deprecations/#deprecations","text":"","title":"Deprecations"},{"location":"deprecations/#deprecations-for-v200","text":"","title":"Deprecations for v2.0.0"},{"location":"deprecations/#realigned-configuration-option-names","text":"The following configuration options will be renamed in upcoming releases of PSRule for Azure. This is part of a ongoing effort to align the naming of configuration options across PSRule for Azure. We plan to have all the old option names renamed and they will not longer work from v2. To upgrade use the new names instead. Until v2, the old option names are still work and will take precedence if new and old are configured. New name Old name Available from AZURE_AKS_CLUSTER_MINIMUM_VERSION Azure_AKSMinimumVersion v1.12.0 AZURE_AKS_POOL_MINIMUM_MAXPODS Azure_AKSNodeMinimumMaxPods TBA - not available AZURE_RESOURCE_ALLOWED_LOCATIONS Azure_AllowedRegions TBA - not available AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME Azure_MinimumCertificateLifetime TBA - not available Note Configuration options marked TBA are not available yet. Please use the old names until they are available. Check the change log and the upgrade notes for more information on a future release. Important New option names will work from the release specified by Available from . Configuring these options prior to that release will have no affect. For details on configuring these options see upgrade notes for details.","title":"Realigned configuration option names"},{"location":"expanding-source-files/","text":"Expanding source files # PSRule for Azure supports analyzing resources contained within Azure Infrastructure as Code. Abstract This topic covers what source expansion is, why it's important, and how to use it within PSRule for Azure. Source expansion # PSRule for Azure goes beyond linting Azure Bicep and template files for syntax. Source expansion performs context specific static analysis on Azure resources. Azure resources are analyzed before deployment as if they are deployed. This provides some unique benefits such as: Improve success \u2014 Azure resources are resolved before deployment, increasing success by finding errors earlier such as within a PR . Detect common templates issues such as missing parameters and JSON structure. Identify deployment issues such as invalid resource names and incorrect resource identifiers. As deployed \u2014 Analysis of Azure resources against Azure WAF as if they are deployed. Parameters, conditional resources, functions (built-in and user defined), variables, and copy loops are resolved. Azure resource names are shown in passing and failing results. Resolving issues with resource configurations can be targeted by resource. Resource file locations for template and parameter files are included in results. Suppression by resource name \u2014 Azure resource names can be used to apply exceptions. Suppression allows for individual resources to be excluded from rules by name. Offline support \u2014 Static analysis is performed against source files instead of deployed resources. Some functions that may be included in templates dynamically query Azure for current state. For these functions standard placeholder values are used by default. Functions that use placeholders include reference , list* . Feature support # Source expansion is supported with: Azure template and parameter files \u2014 Azure templates are expanded from parameter files. Link parameter files to templates by metadata or naming convention. See Using templates for a detailed explanation of how to do this. Azure Bicep deployments \u2014 Files with the .bicep extension are detected and expanded. See Using Bicep source for a detailed explanation of how to do this. Azure Bicep modules with tests \u2014 Reusable Bicep modules can be expanded with tests. See Using Bicep source for a detailed explanation of how to do this. Limitations # Currently the following limitations apply: Required parameters in must be provided in parameter files or Bicep deployments. Nested templates are expanded, external templates are not. Deployment resources that link to an external template are returned as a resource. Sub-resources such as diagnostic logs or configurations are automatically nested. Automatic nesting a sub-resource requires: The parent resource is defined in the same template. The sub-resource depends on the parent resource. The environment() template function always returns values for Azure public cloud. References to Key Vault secrets are not expanded. A placeholder value is used instead. The reference() function will return objects for resources within the same template. For resources that are not in the same template, a placeholder value is used instead. Multi-line strings are not supported. Template expressions up to a maximum of 100,000 characters are supported. In addition, currently the following limitation apply to using Bicep source files: The Bicep CLI must be installed. When using GitHub Actions or Azure Pipelines the Bicep CLI is pre-installed. Location of issues in Bicep source files is not supported. Expansion of Bicep source files times out after 5 seconds by default. The timeout can be overridden by setting the AZURE_BICEP_FILE_EXPANSION_TIMEOUT option. Strong type # String parameters are commonly used to pass values such as a resource Id or location. PSRule for Azure provides additional support to allow parameters to be strongly typed. When a parameter is strongly typed, the value is checked against the type during expansion. To configure a strong type for a parameter set the strongType metadata property on the parameter. The strong type will be set to the resource type that the parameter will accept, such as Microsoft.OperationalInsights/workspaces . Template Bicep { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { \"workspaceId\" : { \"type\" : \"string\" , \"metadata\" : { \"description\" : \"The resource identifier for a Log Analytics workspace.\" , \"strongType\" : \"Microsoft.OperationalInsights/workspaces\" } } } } @metadata({ strongType: 'Microsoft.OperationalInsights/workspaces' }) @description('The resource identifier for a Log Analytics workspace.') param workspaceId string Strong type also supports the following non-resource type values: location - Specifies the parameter must contain any valid Azure location. Scope functions # Azure deployments support a number of scope functions can be used within Infrastructure as Code. When using PSRule for Azure, these functions have a default meaning that can be configured. When configuring scope functions, only the properties you want to override has to be specified. Unspecified properties will inherit from the defaults. Subscription # The subscription() function will return the following unless overridden: subscriptionId : 'ffffffff-ffff-ffff-ffff-ffffffffffff' displayName : 'PSRule Test Subscription' state : 'NotDefined' To override, configure AZURE_SUBSCRIPTION . Resource Group # The resourceGroup() function will return the following unless overridden: name : 'ps-rule-test-rg' location : 'eastus' tags : { } properties : provisioningState : 'Succeeded' To override, configure AZURE_RESOURCE_GROUP . Tenant # The tenant() function will return the following unless overridden: countryCode : 'US' tenantId : 'ffffffff-ffff-ffff-ffff-ffffffffffff' displayName : 'PSRule' To override, configure AZURE_TENANT . Management Group # The managementGroup() function will return the following unless overridden: name : 'psrule-test' properties : displyName : 'PSRule Test Management Group' To override, configure AZURE_MANAGEMENT_GROUP .","title":"Expanding source files"},{"location":"expanding-source-files/#expanding-source-files","text":"PSRule for Azure supports analyzing resources contained within Azure Infrastructure as Code. Abstract This topic covers what source expansion is, why it's important, and how to use it within PSRule for Azure.","title":"Expanding source files"},{"location":"expanding-source-files/#source-expansion","text":"PSRule for Azure goes beyond linting Azure Bicep and template files for syntax. Source expansion performs context specific static analysis on Azure resources. Azure resources are analyzed before deployment as if they are deployed. This provides some unique benefits such as: Improve success \u2014 Azure resources are resolved before deployment, increasing success by finding errors earlier such as within a PR . Detect common templates issues such as missing parameters and JSON structure. Identify deployment issues such as invalid resource names and incorrect resource identifiers. As deployed \u2014 Analysis of Azure resources against Azure WAF as if they are deployed. Parameters, conditional resources, functions (built-in and user defined), variables, and copy loops are resolved. Azure resource names are shown in passing and failing results. Resolving issues with resource configurations can be targeted by resource. Resource file locations for template and parameter files are included in results. Suppression by resource name \u2014 Azure resource names can be used to apply exceptions. Suppression allows for individual resources to be excluded from rules by name. Offline support \u2014 Static analysis is performed against source files instead of deployed resources. Some functions that may be included in templates dynamically query Azure for current state. For these functions standard placeholder values are used by default. Functions that use placeholders include reference , list* .","title":"Source expansion"},{"location":"expanding-source-files/#feature-support","text":"Source expansion is supported with: Azure template and parameter files \u2014 Azure templates are expanded from parameter files. Link parameter files to templates by metadata or naming convention. See Using templates for a detailed explanation of how to do this. Azure Bicep deployments \u2014 Files with the .bicep extension are detected and expanded. See Using Bicep source for a detailed explanation of how to do this. Azure Bicep modules with tests \u2014 Reusable Bicep modules can be expanded with tests. See Using Bicep source for a detailed explanation of how to do this.","title":"Feature support"},{"location":"expanding-source-files/#limitations","text":"Currently the following limitations apply: Required parameters in must be provided in parameter files or Bicep deployments. Nested templates are expanded, external templates are not. Deployment resources that link to an external template are returned as a resource. Sub-resources such as diagnostic logs or configurations are automatically nested. Automatic nesting a sub-resource requires: The parent resource is defined in the same template. The sub-resource depends on the parent resource. The environment() template function always returns values for Azure public cloud. References to Key Vault secrets are not expanded. A placeholder value is used instead. The reference() function will return objects for resources within the same template. For resources that are not in the same template, a placeholder value is used instead. Multi-line strings are not supported. Template expressions up to a maximum of 100,000 characters are supported. In addition, currently the following limitation apply to using Bicep source files: The Bicep CLI must be installed. When using GitHub Actions or Azure Pipelines the Bicep CLI is pre-installed. Location of issues in Bicep source files is not supported. Expansion of Bicep source files times out after 5 seconds by default. The timeout can be overridden by setting the AZURE_BICEP_FILE_EXPANSION_TIMEOUT option.","title":"Limitations"},{"location":"expanding-source-files/#strong-type","text":"String parameters are commonly used to pass values such as a resource Id or location. PSRule for Azure provides additional support to allow parameters to be strongly typed. When a parameter is strongly typed, the value is checked against the type during expansion. To configure a strong type for a parameter set the strongType metadata property on the parameter. The strong type will be set to the resource type that the parameter will accept, such as Microsoft.OperationalInsights/workspaces . Template Bicep { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { \"workspaceId\" : { \"type\" : \"string\" , \"metadata\" : { \"description\" : \"The resource identifier for a Log Analytics workspace.\" , \"strongType\" : \"Microsoft.OperationalInsights/workspaces\" } } } } @metadata({ strongType: 'Microsoft.OperationalInsights/workspaces' }) @description('The resource identifier for a Log Analytics workspace.') param workspaceId string Strong type also supports the following non-resource type values: location - Specifies the parameter must contain any valid Azure location.","title":"Strong type"},{"location":"expanding-source-files/#scope-functions","text":"Azure deployments support a number of scope functions can be used within Infrastructure as Code. When using PSRule for Azure, these functions have a default meaning that can be configured. When configuring scope functions, only the properties you want to override has to be specified. Unspecified properties will inherit from the defaults.","title":"Scope functions"},{"location":"expanding-source-files/#subscription","text":"The subscription() function will return the following unless overridden: subscriptionId : 'ffffffff-ffff-ffff-ffff-ffffffffffff' displayName : 'PSRule Test Subscription' state : 'NotDefined' To override, configure AZURE_SUBSCRIPTION .","title":"Subscription"},{"location":"expanding-source-files/#resource-group","text":"The resourceGroup() function will return the following unless overridden: name : 'ps-rule-test-rg' location : 'eastus' tags : { } properties : provisioningState : 'Succeeded' To override, configure AZURE_RESOURCE_GROUP .","title":"Resource Group"},{"location":"expanding-source-files/#tenant","text":"The tenant() function will return the following unless overridden: countryCode : 'US' tenantId : 'ffffffff-ffff-ffff-ffff-ffffffffffff' displayName : 'PSRule' To override, configure AZURE_TENANT .","title":"Tenant"},{"location":"expanding-source-files/#management-group","text":"The managementGroup() function will return the following unless overridden: name : 'psrule-test' properties : displyName : 'PSRule Test Management Group' To override, configure AZURE_MANAGEMENT_GROUP .","title":"Management Group"},{"location":"export-rule-data/","text":"Exporting rule data # The current state of Azure resources can be tested with PSRule for Azure, referred to as in-flight analysis. This is a two step process that works in high security environments with separation of roles. Abstract This topics covers how you can export the current state of Azure resources deployed into a subscription. After the current state has been exported, offline analysis can be performed against the saved state. Important Before continuing, complete the steps from Installing locally . To export data from a subscription, Azure PowerShell modules must be installed. Exporting rule data can also be automated and scheduled with Azure Automation Service. However, for this scenario we will focus how to run this process interactively. To perform analysis on Azure resources the current configuration state is exported to a JSON file format. The exported state is processed later during analysis. What's exported \u2014 Configurations such as: Resource SKUs, names, tags, and settings configured for an Azure resource. What's not exported \u2014 Resource data such as: The contents of blobs stored on a storage account, or databases tables. Export an Azure subscription # The state of resources from the current Azure subscription will be exported by using the following commands: # STEP 1: Authenticate to Azure, only required if not currently connected Connect-AzAccount ; # STEP 2: Confirm the current subscription context Get-AzContext ; # STEP 3: Exports Azure resources to JSON files Export-AzRuleData -OutputPath 'out/' ; Additional options # By default, resource data for the current subscription context will be exported. To export resource data for specific subscriptions use: -Subscription - to specify subscriptions by id or name. -Tenant - to specify subscriptions within an Azure Active Directory Tenant by id. For example: # Export data from two specific subscriptions Export-AzRuleData -Subscription 'Contoso Production' , 'Contoso Non-production' ; To export specific resource data use: -ResourceGroupName - to filter resources by Resource Group. -Tag - to filter resources based on tag. For example: # Export information from two resource groups within the current subscription context Export-AzRuleData -ResourceGroupName 'rg-app1-web' , 'rg-app1-db' ; To export resource data for all subscription contexts use: -All - to export resource data for all subscription contexts. For example: # Export data from all subscription contexts Export-AzRuleData -All ;","title":"Exporting rule data"},{"location":"export-rule-data/#exporting-rule-data","text":"The current state of Azure resources can be tested with PSRule for Azure, referred to as in-flight analysis. This is a two step process that works in high security environments with separation of roles. Abstract This topics covers how you can export the current state of Azure resources deployed into a subscription. After the current state has been exported, offline analysis can be performed against the saved state. Important Before continuing, complete the steps from Installing locally . To export data from a subscription, Azure PowerShell modules must be installed. Exporting rule data can also be automated and scheduled with Azure Automation Service. However, for this scenario we will focus how to run this process interactively. To perform analysis on Azure resources the current configuration state is exported to a JSON file format. The exported state is processed later during analysis. What's exported \u2014 Configurations such as: Resource SKUs, names, tags, and settings configured for an Azure resource. What's not exported \u2014 Resource data such as: The contents of blobs stored on a storage account, or databases tables.","title":"Exporting rule data"},{"location":"export-rule-data/#export-an-azure-subscription","text":"The state of resources from the current Azure subscription will be exported by using the following commands: # STEP 1: Authenticate to Azure, only required if not currently connected Connect-AzAccount ; # STEP 2: Confirm the current subscription context Get-AzContext ; # STEP 3: Exports Azure resources to JSON files Export-AzRuleData -OutputPath 'out/' ;","title":"Export an Azure subscription"},{"location":"export-rule-data/#additional-options","text":"By default, resource data for the current subscription context will be exported. To export resource data for specific subscriptions use: -Subscription - to specify subscriptions by id or name. -Tenant - to specify subscriptions within an Azure Active Directory Tenant by id. For example: # Export data from two specific subscriptions Export-AzRuleData -Subscription 'Contoso Production' , 'Contoso Non-production' ; To export specific resource data use: -ResourceGroupName - to filter resources by Resource Group. -Tag - to filter resources based on tag. For example: # Export information from two resource groups within the current subscription context Export-AzRuleData -ResourceGroupName 'rg-app1-web' , 'rg-app1-db' ; To export resource data for all subscription contexts use: -All - to export resource data for all subscription contexts. For example: # Export data from all subscription contexts Export-AzRuleData -All ;","title":"Additional options"},{"location":"faq/","text":"Frequently Asked Questions (FAQ) # Continue reading for FAQ relating to PSRule for Azure . For general FAQ see PSRule - Frequently Asked Questions (FAQ) , including: How is PSRule different to Pester? How do I configure PSRule? How do I ignore a rule? How do I layer on custom rules on top of an existing module? Note If you have a question that is not answered here, please join or start a discussion . What is a rule? # A rule is a named set of checks and documentation. You can find the documentation for each rule under reference . What is a baseline? # A baseline combines rules and configuration. PSRule for Azure provides several baselines that can be referenced when running PSRule. Quarterly baselines provide a stable checkpoint of rules when you need to stagger adoption of new rules. Continue reading working with baselines for a detailed breakdown. Is Terraform supported? # Currently PSRule for Azure supports testing Azure resources from Infrastructure as Code ( IaC ) with: Azure Resource Manager ( ARM ) templates. Azure Bicep deployments. Checking Terraform from HashiCorp Configuration Language (HCL) is not supported at this time. If this feature is important to you, please upvote \ud83d\udc4d the issue on GitHub. What is supported? After resources are deployed to Azure, PSRule for Azure can be used to check the Azure resources in-flight . This methods works for Azure resources regardless of how they are deployed. Use this method for analyzing resources deployed via the Azure Portal, Terraform, Pulumi, or other tools. For instructions on how to do this see Exporting rule data . What methods are supported for checking resources? # PSRule for Azure supports two methods for analyzing Azure resources: Pre-flight \u2014 Before resources are deployed from an ARM template or Bicep. Use pre-flight analysis to: Implement checks within Pull Requests ( PRs ). Improve alignment of resources to WAF recommendations. Identify issues that prevent successful resource deployments on Azure. Integrate continual improvement and standardization of Azure resource configurations. Implement release gates between environments. For more information see Creating your pipeline . In-flight \u2014 After resources are deployed to an Azure subscription. Use in-flight analysis to: Implement release gates between environments for non-native tools such as Terraform. Performing offline analysis in split-environments. For more information see Exporting rule data . How do I create a custom rule to enforce resource group tagging? # PSRule for Azure covers common use cases that align to the Microsoft Azure Well-Architected Framework . Use of resource and resource group tags is recommended in the WAF , however implementation may vary. You may want to use PSRule to enforce tagging or something similar early in a DevOps pipeline. We have a walk through scenario Enforcing custom tags to get you started. How do I create a custom rule to enforce code ownership? # GitHub, Azure DevOps, and other DevOps platforms may implement code ownership. This process involves assigning a team or an individual review and approval responsibility. In GitHub or Azure DevOps implementation, ownership is linked to the file path. When a repository contains resources that different teams would approve how do you: Ensure resources are created in a path that triggers the correct approval? We have a walk through scenario Enforcing code ownership to get you started. Do you have sample code? # In addition to the walk through scenarios, we have a quick start template here . The repository contains sample ARM templates, Bicep, and pipeline code to get you started. In GitHub you can simply use the repository as a template for your own project. Do I need PowerShell experience to start using PSRule for Azure? # No. You can start using built-in rules and CI with Azure Pipelines or GitHub Actions. If we didn't tell you, you might not even know that PowerShell runs under the covers. To perform local validation, some PowerShell setup is required but we step you through that. See installation and validating locally for details. To start writing your own custom rules you can use YAML, JSON, or PowerShell. PowerShell experience is required for some scenarios. We have a walk through scenario Enforcing custom tags to get you started. What permissions do I need to export rule data? # When exporting data for in-flight analysis, the default built-in Reader role to a subscription is required for: Exporting rule data with Export-AzRuleData . Exporting rule data from templates with Export-AzRuleTemplateData when online features are used. Optionally -ResourceGroupName and -Subscription parameter can be used; these require access Reader access. What permissions do I need to analyze exported rule data? # When exporting data for in-flight analysis, no access to Azure is required after data has been exported to JSON. Should I continue to use Azure Advisor, Security Center, or Azure Policy? # Absolutely. PSRule for Azure does not replace Azure Advisor, Security Center, or Azure Policy. PSRule complements Azure Advisor, Security Center, and Azure Policy features by: Recommending turning on and using features of Azure Advisor, Azure Security Center, or Azure Policy. Providing offline analysis in split environments where the analyst has no access to Azure subscriptions. Rule data for analysis can be exported out to a JSON file. Providing the ability to analyze resources in Azure Resource Manager templates before deployment. Additionally, analysis can be performed in a CI process. Providing the ability to layer on organization specific rules, as required. Data collection requires limited permissions and requires no additional configuration. What do the different severity and levels for rules means? # PSRule for Azure annotates rules with three (3) severities which indicate how you should prioritize remediation. The following severities are defined: Critical \u2014 Consider addressing these first, ideally within the next thirty (30) days. Rules identified as critical often have high impact and are highly likely to affect your services. Important \u2014 Consider addressing these next, ideally within the next sixty (60) days. Rules identified as important often have a significant impact and are likely to affect your services. Awareness \u2014 Consider addressing these last, ideally within the next ninty (90) days. Rules identified as awareness often have a moderate or low impact to the operation of your services. Tip Severities and suggested time frames are an indicator only. They may affect your environment, compliance, or security differently based on your specific requirements. If you feel the severity for a rule is broadly incorrect then please let as know. You can do this by joining or starting a discussion . Additionally, PSRule for Azure uses three (3) rule levels. These levels determine how PSRule provides feedback about failing cases. The following levels are defined: Error \u2014 Rules defined as error will stop CI pipelines that are configured to break on error. Warning \u2014 Rules defined as warning will not stop CI pipelines and will produce a warning. Information \u2014 Rules defined as information will not stop CI pipelines. Traditional unit testing vs PSRule for Azure? # You may already be using a unit test framework such as Pester to test infrastructure code. If you are, then you may have encountered the following challenges. For a general PSRule/ Pester comparison see How is PSRule different to Pester? Unit testing more than basic JSON structure # Unit tests are unable to effectively test resources contained within Azure templates. Templates should be reusable, but this creates problems for testing when functions, conditions and copy loops are used. Template parameters could completely change the type, number of, or configuration of resources. PSRule resolves templates to allow analysis of the resources that would be deployed based on provided parameters. Standard library of tests # When building unit tests for Azure resources, starting with an empty repository can be a daunting experience. While there are several open source repositories and samples around to get you started, you need to integrate these yourself. PSRule for Azure is distributed as a PowerShell module using the PowerShell Gallery. Using a PowerShell module makes it easy to install and update. The built-in rules allow you starting testing resources quickly, with minimal integration. For detailed examples see: Validate Azure resources from templates with Azure Pipelines Validate Azure resources from templates with continuous integration ( CI ) Collection of telemetry # PSRule and PSRule for Azure currently do not collect any telemetry during installation or execution. PowerShell (used by PSRule for Azure) does collect basic telemetry by default. Collection of telemetry in PowerShell and how to opt-out is explained in about_Telemetry .","title":"FAQ"},{"location":"faq/#frequently-asked-questions-faq","text":"Continue reading for FAQ relating to PSRule for Azure . For general FAQ see PSRule - Frequently Asked Questions (FAQ) , including: How is PSRule different to Pester? How do I configure PSRule? How do I ignore a rule? How do I layer on custom rules on top of an existing module? Note If you have a question that is not answered here, please join or start a discussion .","title":"Frequently Asked Questions (FAQ)"},{"location":"faq/#what-is-a-rule","text":"A rule is a named set of checks and documentation. You can find the documentation for each rule under reference .","title":"What is a rule?"},{"location":"faq/#what-is-a-baseline","text":"A baseline combines rules and configuration. PSRule for Azure provides several baselines that can be referenced when running PSRule. Quarterly baselines provide a stable checkpoint of rules when you need to stagger adoption of new rules. Continue reading working with baselines for a detailed breakdown.","title":"What is a baseline?"},{"location":"faq/#is-terraform-supported","text":"Currently PSRule for Azure supports testing Azure resources from Infrastructure as Code ( IaC ) with: Azure Resource Manager ( ARM ) templates. Azure Bicep deployments. Checking Terraform from HashiCorp Configuration Language (HCL) is not supported at this time. If this feature is important to you, please upvote \ud83d\udc4d the issue on GitHub. What is supported? After resources are deployed to Azure, PSRule for Azure can be used to check the Azure resources in-flight . This methods works for Azure resources regardless of how they are deployed. Use this method for analyzing resources deployed via the Azure Portal, Terraform, Pulumi, or other tools. For instructions on how to do this see Exporting rule data .","title":"Is Terraform supported?"},{"location":"faq/#what-methods-are-supported-for-checking-resources","text":"PSRule for Azure supports two methods for analyzing Azure resources: Pre-flight \u2014 Before resources are deployed from an ARM template or Bicep. Use pre-flight analysis to: Implement checks within Pull Requests ( PRs ). Improve alignment of resources to WAF recommendations. Identify issues that prevent successful resource deployments on Azure. Integrate continual improvement and standardization of Azure resource configurations. Implement release gates between environments. For more information see Creating your pipeline . In-flight \u2014 After resources are deployed to an Azure subscription. Use in-flight analysis to: Implement release gates between environments for non-native tools such as Terraform. Performing offline analysis in split-environments. For more information see Exporting rule data .","title":"What methods are supported for checking resources?"},{"location":"faq/#how-do-i-create-a-custom-rule-to-enforce-resource-group-tagging","text":"PSRule for Azure covers common use cases that align to the Microsoft Azure Well-Architected Framework . Use of resource and resource group tags is recommended in the WAF , however implementation may vary. You may want to use PSRule to enforce tagging or something similar early in a DevOps pipeline. We have a walk through scenario Enforcing custom tags to get you started.","title":"How do I create a custom rule to enforce resource group tagging?"},{"location":"faq/#how-do-i-create-a-custom-rule-to-enforce-code-ownership","text":"GitHub, Azure DevOps, and other DevOps platforms may implement code ownership. This process involves assigning a team or an individual review and approval responsibility. In GitHub or Azure DevOps implementation, ownership is linked to the file path. When a repository contains resources that different teams would approve how do you: Ensure resources are created in a path that triggers the correct approval? We have a walk through scenario Enforcing code ownership to get you started.","title":"How do I create a custom rule to enforce code ownership?"},{"location":"faq/#do-you-have-sample-code","text":"In addition to the walk through scenarios, we have a quick start template here . The repository contains sample ARM templates, Bicep, and pipeline code to get you started. In GitHub you can simply use the repository as a template for your own project.","title":"Do you have sample code?"},{"location":"faq/#do-i-need-powershell-experience-to-start-using-psrule-for-azure","text":"No. You can start using built-in rules and CI with Azure Pipelines or GitHub Actions. If we didn't tell you, you might not even know that PowerShell runs under the covers. To perform local validation, some PowerShell setup is required but we step you through that. See installation and validating locally for details. To start writing your own custom rules you can use YAML, JSON, or PowerShell. PowerShell experience is required for some scenarios. We have a walk through scenario Enforcing custom tags to get you started.","title":"Do I need PowerShell experience to start using PSRule for Azure?"},{"location":"faq/#what-permissions-do-i-need-to-export-rule-data","text":"When exporting data for in-flight analysis, the default built-in Reader role to a subscription is required for: Exporting rule data with Export-AzRuleData . Exporting rule data from templates with Export-AzRuleTemplateData when online features are used. Optionally -ResourceGroupName and -Subscription parameter can be used; these require access Reader access.","title":"What permissions do I need to export rule data?"},{"location":"faq/#what-permissions-do-i-need-to-analyze-exported-rule-data","text":"When exporting data for in-flight analysis, no access to Azure is required after data has been exported to JSON.","title":"What permissions do I need to analyze exported rule data?"},{"location":"faq/#should-i-continue-to-use-azure-advisor-security-center-or-azure-policy","text":"Absolutely. PSRule for Azure does not replace Azure Advisor, Security Center, or Azure Policy. PSRule complements Azure Advisor, Security Center, and Azure Policy features by: Recommending turning on and using features of Azure Advisor, Azure Security Center, or Azure Policy. Providing offline analysis in split environments where the analyst has no access to Azure subscriptions. Rule data for analysis can be exported out to a JSON file. Providing the ability to analyze resources in Azure Resource Manager templates before deployment. Additionally, analysis can be performed in a CI process. Providing the ability to layer on organization specific rules, as required. Data collection requires limited permissions and requires no additional configuration.","title":"Should I continue to use Azure Advisor, Security Center, or Azure Policy?"},{"location":"faq/#what-do-the-different-severity-and-levels-for-rules-means","text":"PSRule for Azure annotates rules with three (3) severities which indicate how you should prioritize remediation. The following severities are defined: Critical \u2014 Consider addressing these first, ideally within the next thirty (30) days. Rules identified as critical often have high impact and are highly likely to affect your services. Important \u2014 Consider addressing these next, ideally within the next sixty (60) days. Rules identified as important often have a significant impact and are likely to affect your services. Awareness \u2014 Consider addressing these last, ideally within the next ninty (90) days. Rules identified as awareness often have a moderate or low impact to the operation of your services. Tip Severities and suggested time frames are an indicator only. They may affect your environment, compliance, or security differently based on your specific requirements. If you feel the severity for a rule is broadly incorrect then please let as know. You can do this by joining or starting a discussion . Additionally, PSRule for Azure uses three (3) rule levels. These levels determine how PSRule provides feedback about failing cases. The following levels are defined: Error \u2014 Rules defined as error will stop CI pipelines that are configured to break on error. Warning \u2014 Rules defined as warning will not stop CI pipelines and will produce a warning. Information \u2014 Rules defined as information will not stop CI pipelines.","title":"What do the different severity and levels for rules means?"},{"location":"faq/#traditional-unit-testing-vs-psrule-for-azure","text":"You may already be using a unit test framework such as Pester to test infrastructure code. If you are, then you may have encountered the following challenges. For a general PSRule/ Pester comparison see How is PSRule different to Pester?","title":"Traditional unit testing vs PSRule for Azure?"},{"location":"faq/#unit-testing-more-than-basic-json-structure","text":"Unit tests are unable to effectively test resources contained within Azure templates. Templates should be reusable, but this creates problems for testing when functions, conditions and copy loops are used. Template parameters could completely change the type, number of, or configuration of resources. PSRule resolves templates to allow analysis of the resources that would be deployed based on provided parameters.","title":"Unit testing more than basic JSON structure"},{"location":"faq/#standard-library-of-tests","text":"When building unit tests for Azure resources, starting with an empty repository can be a daunting experience. While there are several open source repositories and samples around to get you started, you need to integrate these yourself. PSRule for Azure is distributed as a PowerShell module using the PowerShell Gallery. Using a PowerShell module makes it easy to install and update. The built-in rules allow you starting testing resources quickly, with minimal integration. For detailed examples see: Validate Azure resources from templates with Azure Pipelines Validate Azure resources from templates with continuous integration ( CI )","title":"Standard library of tests"},{"location":"faq/#collection-of-telemetry","text":"PSRule and PSRule for Azure currently do not collect any telemetry during installation or execution. PowerShell (used by PSRule for Azure) does collect basic telemetry by default. Collection of telemetry in PowerShell and how to opt-out is explained in about_Telemetry .","title":"Collection of telemetry"},{"location":"features/","text":"Features # Framework aligned # PSRule for Azure is aligned to the Azure Well-Architected Framework ( WAF ) . Tests called rules check the configuration of Azure resources against WAF principles. Rules exist across five (5) WAF pillars: Cost Optimization Operational Excellence Performance Efficiency Reliability Security To help you align your Infrastructure as Code ( IaC ) to WAF principles, PSRule for Azure includes documentation. Included are examples, references to WAF and product documentation. This allows you to explore and learn the context of each WAF principle. Ready to go # PSRule for Azure includes over 280 rules for validating resources against configuration recommendations. Rules automatically detect and analyze resources from Azure IaC artifacts. This allows you to quickly light up unit testing of Azure resources from templates and Bicep deployments. Use the built-in rules to start enforcing testing quickly. Then layer on your own rules as your organization's requirements mature. Custom rules can be implemented quickly and work side-by-side with built-in rules. As new built-in rules are added and improved, download the latest version to start using them. Tip For detailed information on building custom rules see: Enforcing custom tags . Enforcing code ownership . DevOps integrated # Azure resources can be validated throughout their lifecycle to support a DevOps culture. From as early as authoring an ARM template, resources can be validated offline before deployment. Pre-flight validation can be integrated into a continuous integration ( CI ) pipeline as unit tests to: Shift-left \u2014 Identify configuration issues and provide fast feedback in PRs . Quality gates \u2014 Implement quality gates between environments such as dev, test, and production. Monitor continuously \u2014 Perform ongoing checks for configuration optimization opportunities. Cross-platform # PSRule for Azure uses modern PowerShell libraries at its core, allowing it to go anywhere PowerShell can go. PSRule for Azure runs on MacOS, Linux, and Windows. PowerShell makes it easy to integrate PSRule into popular CI systems. Run natively or in a container depending on your platform. PSRule has native extensions for: Azure Pipelines (Azure DevOps) GitHub Actions Visual Studio Code Additionally, PSRule for Azure can be installed locally or within Azure Cloud Shell. For installation options see installation .","title":"Features"},{"location":"features/#features","text":"","title":"Features"},{"location":"features/#framework-aligned","text":"PSRule for Azure is aligned to the Azure Well-Architected Framework ( WAF ) . Tests called rules check the configuration of Azure resources against WAF principles. Rules exist across five (5) WAF pillars: Cost Optimization Operational Excellence Performance Efficiency Reliability Security To help you align your Infrastructure as Code ( IaC ) to WAF principles, PSRule for Azure includes documentation. Included are examples, references to WAF and product documentation. This allows you to explore and learn the context of each WAF principle.","title":"Framework aligned"},{"location":"features/#ready-to-go","text":"PSRule for Azure includes over 280 rules for validating resources against configuration recommendations. Rules automatically detect and analyze resources from Azure IaC artifacts. This allows you to quickly light up unit testing of Azure resources from templates and Bicep deployments. Use the built-in rules to start enforcing testing quickly. Then layer on your own rules as your organization's requirements mature. Custom rules can be implemented quickly and work side-by-side with built-in rules. As new built-in rules are added and improved, download the latest version to start using them. Tip For detailed information on building custom rules see: Enforcing custom tags . Enforcing code ownership .","title":"Ready to go"},{"location":"features/#devops-integrated","text":"Azure resources can be validated throughout their lifecycle to support a DevOps culture. From as early as authoring an ARM template, resources can be validated offline before deployment. Pre-flight validation can be integrated into a continuous integration ( CI ) pipeline as unit tests to: Shift-left \u2014 Identify configuration issues and provide fast feedback in PRs . Quality gates \u2014 Implement quality gates between environments such as dev, test, and production. Monitor continuously \u2014 Perform ongoing checks for configuration optimization opportunities.","title":"DevOps integrated"},{"location":"features/#cross-platform","text":"PSRule for Azure uses modern PowerShell libraries at its core, allowing it to go anywhere PowerShell can go. PSRule for Azure runs on MacOS, Linux, and Windows. PowerShell makes it easy to integrate PSRule into popular CI systems. Run natively or in a container depending on your platform. PSRule has native extensions for: Azure Pipelines (Azure DevOps) GitHub Actions Visual Studio Code Additionally, PSRule for Azure can be installed locally or within Azure Cloud Shell. For installation options see installation .","title":"Cross-platform"},{"location":"install-instructions/","text":"Installation # PSRule for Azure supports running within continuous integration ( CI ) systems or locally. It is shipped as a PowerShell module which makes it easy to install and distribute updates. Tip PSRule for Azure provides native integration to popular CI systems such as GitHub Actions and Azure Pipelines. If you are using a different CI system you can use the local install to run on MacOS, Linux, and Windows worker nodes. With GitHub Actions # GitHub Action Install and use PSRule for Azure with GitHub Actions by referencing the microsoft/ps-rule action. Stable Pre-release Install the latest stable version of PSRule for Azure. - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : 'PSRule.Rules.Azure' Install the latest stable or pre-release version of PSRule for Azure. - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : 'PSRule.Rules.Azure' prerelease : true This will automatically install compatible versions of all dependencies. With Azure Pipelines # Extension Install and use PSRule for Azure with Azure Pipeline by using extension tasks. Install the extension from the marketplace, then use the ps-rule-assert task in pipeline steps. Stable Pre-release Install the latest stable version of PSRule for Azure. - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure' Install the latest stable or pre-release version of PSRule for Azure. - task : ps-rule-install@2 displayName : Install PSRule for Azure (pre-release) inputs : module : PSRule.Rules.Azure prerelease : true - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure' This will automatically install compatible versions of all dependencies. Installing locally # PSRule for Azure can be installed locally from the PowerShell Gallery using PowerShell. You can also use this option to install on CI workers that are not natively supported. PreRequisites # Operating System Tool Overview Installation Link Windows Windows PowerShell Support for version 5.1 with .NET Framework 4.7.2 or greater. link Windows, MacOS, Linux PowerShell Version 7.2 or greater is support. link - - Multiple PowerShell modules are required (PlatyPS, Pester, PSScriptAnalyzer, PowerShellGet, PackageManagement, InvokeBuild, PSRule). Installed when you run the build.ps1 script - .NET .NET SDK v6 is required. link - Bicep CLI PsRule depends on the Bicep CLI to decompile (expand) Bicep modules to ARM Installed when you run the build.ps1 script To use PSRule for Azure, PSRule a separate PowerShell module must be installed. The required version will automatically be installed along-side PSRule for Azure. Additionally, the exporting data from a subscription functionality requires the additional PowerShell modules: Az.Accounts Az.Resources Note Azure PowerShell modules are not installed automatically when installing PSRule for Azure. This has been changed from v1.16.0 due to module dependency chains in Azure DevOps . In most cases these modules will be pre-installed on the CI worker. For private CI workers, consider pre-installing these modules in a previous step. Installing PowerShell # PowerShell 7.x can be installed on MacOS, Linux, and Windows but is not installed by default. For a list of platforms that PowerShell 7.2 is supported on and install instructions see Get PowerShell . Getting the modules # Module PSRule for Azure can be installed or updated from the PowerShell Gallery. Use the following command line examples from a PowerShell terminal to install or update PSRule for Azure. For the current user For all users To install PSRule for Azure for the current user use: Install-Module -Name 'PSRule.Rules.Azure' -Repository PSGallery -Scope CurrentUser To update PSRule for Azure for the current user use: Update-Module -Name 'PSRule.Rules.Azure' -Scope CurrentUser This will automatically install compatible versions of all dependencies. To install PSRule for Azure for all users (requires admin/ root permissions) use: Install-Module -Name 'PSRule.Rules.Azure' -Repository PSGallery -Scope AllUsers To update PSRule for Azure for all users (requires admin/ root permissions) use: Update-Module -Name 'PSRule.Rules.Azure' -Scope AllUsers This will automatically install compatible versions of all dependencies. Pre-release versions # To use a pre-release version of PSRule for Azure add the -AllowPrerelease switch when calling Install-Module , Update-Module , or Save-Module cmdlets. Tip To install pre-release module versions, the latest version of PowerShellGet may be required. # Install the latest PowerShellGet version Install-Module -Name PowerShellGet -Repository PSGallery -Scope CurrentUser -Force Tip To install a pre-release version of PSRule and PSRule for Azure , install each in separate steps. For the current user For all users To install PSRule for Azure for the current user use: Install-Module -Name PowerShellGet -Repository PSGallery -Scope CurrentUser -Force Install-Module -Name PSRule -Repository PSGallery -Scope CurrentUser -AllowPrerelease Install-Module -Name PSRule . Rules . Azure -Repository PSGallery -Scope CurrentUser -AllowPrerelease Open PowerShell with Run as administrator on Windows or sudo pwsh on Linux. To install PSRule for Azure for all users (requires admin/ root permissions) use: Install-Module -Name PowerShellGet -Repository PSGallery -Scope CurrentUser -Force Install-Module -Name PSRule -Repository PSGallery -Scope AllUsers -AllowPrerelease Install-Module -Name PSRule . Rules . Azure -Repository PSGallery -Scope AllUsers -AllowPrerelease Development dependencies # The following dependencies will be automatically installed if the required versions are not present: PowerShell modules: PlatyPS Pester PSScriptAnalyzer PowerShellGet PackageManagement InvokeBuild Bicep CLI These dependencies are only required for building and running tests for PSRule for Azure. Building from source # Source PSRule for Azure is provided as open source on GitHub. To build PSRule for Azure from source code: Clone the GitHub repository . Run ./build.ps1 from a PowerShell terminal in the cloned path. This build script will compile the module and documentation then output the result into out/modules/PSRule.Rules.Azure . Troubleshooting # If the ./build.ps1 script fails, you can start troubleshooting this by: Checking the prerequisites are installed installed (and the specific versions) Check the PowerShell version enter the following statement in the PowerShell terminal: $PSVersionTable.PSVersion Check the installed .NET version by entering the dotnet --list-sdks command in your terminal. Check if your .NET setup is connected to any Nuget repositories and if there's any connectivity or authentication issues. Limited access networks # If you are on a network that does not permit Internet access to the PowerShell Gallery, download the required PowerShell modules on an alternative device that has access. PowerShell provides the Save-Module cmdlet that can be run from a PowerShell terminal to do this. The following command lines can be used to download the required modules using a PowerShell terminal. After downloading the modules, copy the module directories to devices with restricted Internet access. Runtime modules Development modules To save PSRule for Azure for offline use: $modules = @( 'PSRule' , 'PSRule.Rules.Azure' , 'Az.Accounts' , 'Az.Resources' ) Save-Module -Name $modules -Path '.\\modules' This will save PSRule for Azure and all dependencies into the modules sub-directory. To save PSRule for Azure development module dependencies for offline use: $modules = @( 'PSRule' , 'Az.Accounts' , 'Az.Resources' , 'PlatyPS' , 'Pester' , 'PSScriptAnalyzer' , 'PowerShellGet' , 'PackageManagement' , 'InvokeBuild' ) Save-Module -Name $modules -Repository PSGallery -Path '.\\modules' ; This will save required developments dependencies into the modules sub-directory.","title":"Installation"},{"location":"install-instructions/#installation","text":"PSRule for Azure supports running within continuous integration ( CI ) systems or locally. It is shipped as a PowerShell module which makes it easy to install and distribute updates. Tip PSRule for Azure provides native integration to popular CI systems such as GitHub Actions and Azure Pipelines. If you are using a different CI system you can use the local install to run on MacOS, Linux, and Windows worker nodes.","title":"Installation"},{"location":"install-instructions/#with-github-actions","text":"GitHub Action Install and use PSRule for Azure with GitHub Actions by referencing the microsoft/ps-rule action. Stable Pre-release Install the latest stable version of PSRule for Azure. - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : 'PSRule.Rules.Azure' Install the latest stable or pre-release version of PSRule for Azure. - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : 'PSRule.Rules.Azure' prerelease : true This will automatically install compatible versions of all dependencies.","title":"With GitHub Actions"},{"location":"install-instructions/#with-azure-pipelines","text":"Extension Install and use PSRule for Azure with Azure Pipeline by using extension tasks. Install the extension from the marketplace, then use the ps-rule-assert task in pipeline steps. Stable Pre-release Install the latest stable version of PSRule for Azure. - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure' Install the latest stable or pre-release version of PSRule for Azure. - task : ps-rule-install@2 displayName : Install PSRule for Azure (pre-release) inputs : module : PSRule.Rules.Azure prerelease : true - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure' This will automatically install compatible versions of all dependencies.","title":"With Azure Pipelines"},{"location":"install-instructions/#installing-locally","text":"PSRule for Azure can be installed locally from the PowerShell Gallery using PowerShell. You can also use this option to install on CI workers that are not natively supported.","title":"Installing locally"},{"location":"install-instructions/#prerequisites","text":"Operating System Tool Overview Installation Link Windows Windows PowerShell Support for version 5.1 with .NET Framework 4.7.2 or greater. link Windows, MacOS, Linux PowerShell Version 7.2 or greater is support. link - - Multiple PowerShell modules are required (PlatyPS, Pester, PSScriptAnalyzer, PowerShellGet, PackageManagement, InvokeBuild, PSRule). Installed when you run the build.ps1 script - .NET .NET SDK v6 is required. link - Bicep CLI PsRule depends on the Bicep CLI to decompile (expand) Bicep modules to ARM Installed when you run the build.ps1 script To use PSRule for Azure, PSRule a separate PowerShell module must be installed. The required version will automatically be installed along-side PSRule for Azure. Additionally, the exporting data from a subscription functionality requires the additional PowerShell modules: Az.Accounts Az.Resources Note Azure PowerShell modules are not installed automatically when installing PSRule for Azure. This has been changed from v1.16.0 due to module dependency chains in Azure DevOps . In most cases these modules will be pre-installed on the CI worker. For private CI workers, consider pre-installing these modules in a previous step.","title":"PreRequisites"},{"location":"install-instructions/#installing-powershell","text":"PowerShell 7.x can be installed on MacOS, Linux, and Windows but is not installed by default. For a list of platforms that PowerShell 7.2 is supported on and install instructions see Get PowerShell .","title":"Installing PowerShell"},{"location":"install-instructions/#getting-the-modules","text":"Module PSRule for Azure can be installed or updated from the PowerShell Gallery. Use the following command line examples from a PowerShell terminal to install or update PSRule for Azure. For the current user For all users To install PSRule for Azure for the current user use: Install-Module -Name 'PSRule.Rules.Azure' -Repository PSGallery -Scope CurrentUser To update PSRule for Azure for the current user use: Update-Module -Name 'PSRule.Rules.Azure' -Scope CurrentUser This will automatically install compatible versions of all dependencies. To install PSRule for Azure for all users (requires admin/ root permissions) use: Install-Module -Name 'PSRule.Rules.Azure' -Repository PSGallery -Scope AllUsers To update PSRule for Azure for all users (requires admin/ root permissions) use: Update-Module -Name 'PSRule.Rules.Azure' -Scope AllUsers This will automatically install compatible versions of all dependencies.","title":"Getting the modules"},{"location":"install-instructions/#pre-release-versions","text":"To use a pre-release version of PSRule for Azure add the -AllowPrerelease switch when calling Install-Module , Update-Module , or Save-Module cmdlets. Tip To install pre-release module versions, the latest version of PowerShellGet may be required. # Install the latest PowerShellGet version Install-Module -Name PowerShellGet -Repository PSGallery -Scope CurrentUser -Force Tip To install a pre-release version of PSRule and PSRule for Azure , install each in separate steps. For the current user For all users To install PSRule for Azure for the current user use: Install-Module -Name PowerShellGet -Repository PSGallery -Scope CurrentUser -Force Install-Module -Name PSRule -Repository PSGallery -Scope CurrentUser -AllowPrerelease Install-Module -Name PSRule . Rules . Azure -Repository PSGallery -Scope CurrentUser -AllowPrerelease Open PowerShell with Run as administrator on Windows or sudo pwsh on Linux. To install PSRule for Azure for all users (requires admin/ root permissions) use: Install-Module -Name PowerShellGet -Repository PSGallery -Scope CurrentUser -Force Install-Module -Name PSRule -Repository PSGallery -Scope AllUsers -AllowPrerelease Install-Module -Name PSRule . Rules . Azure -Repository PSGallery -Scope AllUsers -AllowPrerelease","title":"Pre-release versions"},{"location":"install-instructions/#development-dependencies","text":"The following dependencies will be automatically installed if the required versions are not present: PowerShell modules: PlatyPS Pester PSScriptAnalyzer PowerShellGet PackageManagement InvokeBuild Bicep CLI These dependencies are only required for building and running tests for PSRule for Azure.","title":"Development dependencies"},{"location":"install-instructions/#building-from-source","text":"Source PSRule for Azure is provided as open source on GitHub. To build PSRule for Azure from source code: Clone the GitHub repository . Run ./build.ps1 from a PowerShell terminal in the cloned path. This build script will compile the module and documentation then output the result into out/modules/PSRule.Rules.Azure .","title":"Building from source"},{"location":"install-instructions/#troubleshooting","text":"If the ./build.ps1 script fails, you can start troubleshooting this by: Checking the prerequisites are installed installed (and the specific versions) Check the PowerShell version enter the following statement in the PowerShell terminal: $PSVersionTable.PSVersion Check the installed .NET version by entering the dotnet --list-sdks command in your terminal. Check if your .NET setup is connected to any Nuget repositories and if there's any connectivity or authentication issues.","title":"Troubleshooting"},{"location":"install-instructions/#limited-access-networks","text":"If you are on a network that does not permit Internet access to the PowerShell Gallery, download the required PowerShell modules on an alternative device that has access. PowerShell provides the Save-Module cmdlet that can be run from a PowerShell terminal to do this. The following command lines can be used to download the required modules using a PowerShell terminal. After downloading the modules, copy the module directories to devices with restricted Internet access. Runtime modules Development modules To save PSRule for Azure for offline use: $modules = @( 'PSRule' , 'PSRule.Rules.Azure' , 'Az.Accounts' , 'Az.Resources' ) Save-Module -Name $modules -Path '.\\modules' This will save PSRule for Azure and all dependencies into the modules sub-directory. To save PSRule for Azure development module dependencies for offline use: $modules = @( 'PSRule' , 'Az.Accounts' , 'Az.Resources' , 'PlatyPS' , 'Pester' , 'PSScriptAnalyzer' , 'PowerShellGet' , 'PackageManagement' , 'InvokeBuild' ) Save-Module -Name $modules -Repository PSGallery -Path '.\\modules' ; This will save required developments dependencies into the modules sub-directory.","title":"Limited access networks"},{"location":"integrations/","text":"Integrations # Integrates with PSRule for Azure # The following tools also take advantage of PSRule for Azure. Azure Governance Visualizer # Docs \u00b7 v6_major_20220521_1 AzGovViz provides a convenient way to view your Azure governance and hierarchy. Additionally you can view recommendations from PSRule as you navigate to each level in your hierarchy. You can include PSRule recommendations in AzGovViz output by adding the -DoPSRule command-line switch. This and more is included in the documentation .","title":"Integrations"},{"location":"integrations/#integrations","text":"","title":"Integrations"},{"location":"integrations/#integrates-with-psrule-for-azure","text":"The following tools also take advantage of PSRule for Azure.","title":"Integrates with PSRule for Azure"},{"location":"integrations/#azure-governance-visualizer","text":"Docs \u00b7 v6_major_20220521_1 AzGovViz provides a convenient way to view your Azure governance and hierarchy. Additionally you can view recommendations from PSRule as you navigate to each level in your hierarchy. You can include PSRule recommendations in AzGovViz output by adding the -DoPSRule command-line switch. This and more is included in the documentation .","title":"Azure Governance Visualizer"},{"location":"license-contributing/","text":"License and contributing # PSRule for Azure is licensed with an MIT License , which means it's free to use and modify. But please check out the details. We open source at Microsoft. In addition to our team, we hope you will think about contributing too. Here is how you can get started: Report issues. Upvote existing issues that are important to you. Improve documentation. Contribute code. Please read our contributing guidelines and code of conduct to learn how to contribute.","title":"License and contributing"},{"location":"license-contributing/#license-and-contributing","text":"PSRule for Azure is licensed with an MIT License , which means it's free to use and modify. But please check out the details. We open source at Microsoft. In addition to our team, we hope you will think about contributing too. Here is how you can get started: Report issues. Upvote existing issues that are important to you. Improve documentation. Contribute code. Please read our contributing guidelines and code of conduct to learn how to contribute.","title":"License and contributing"},{"location":"related-projects/","text":"Related projects # The PSRule project is distributed across multiple repositories. You can find out more by visiting each repository. Name Description microsoft/PSRule Core engine responsible for running rules. microsoft/ps-rule GitHub continious integration using GitHub Actions. microsoft/PSRule-pipelines Azure DevOps continious integration using Azure Pipelines. microsoft/PSRule-vscode Support for running and authoring rules within Visual Studio Code. microsoft/PSRule.Monitor Support for logging PSRule analysis results to Azure Monitor.","title":"Related projects"},{"location":"related-projects/#related-projects","text":"The PSRule project is distributed across multiple repositories. You can find out more by visiting each repository. Name Description microsoft/PSRule Core engine responsible for running rules. microsoft/ps-rule GitHub continious integration using GitHub Actions. microsoft/PSRule-pipelines Azure DevOps continious integration using Azure Pipelines. microsoft/PSRule-vscode Support for running and authoring rules within Visual Studio Code. microsoft/PSRule.Monitor Support for logging PSRule analysis results to Azure Monitor.","title":"Related projects"},{"location":"samples/","text":"Samples # Quick Start repository # Template You can clone, download, or use as a template for your own repository. This repository contains the following samples for PSRule for Azure: Azure Templates \u2014 Starter Azure Resource Manager (ARM) templates and parameter files. Azure Bicep \u2014 Starter Azure Bicep deployments and test files. GitHub Actions \u2014 Starter workflow for checking Azure Infrastructure as Code (IaC). Azure Pipelines \u2014 Starter pipelines for checking Azure Infrastructure as Code (IaC). Custom rules \u2014 Example custom rules that enforce organization specific requirements. PSRule options \u2014 Example options for using PSRule for Azure.","title":"Samples"},{"location":"samples/#samples","text":"","title":"Samples"},{"location":"samples/#quick-start-repository","text":"Template You can clone, download, or use as a template for your own repository. This repository contains the following samples for PSRule for Azure: Azure Templates \u2014 Starter Azure Resource Manager (ARM) templates and parameter files. Azure Bicep \u2014 Starter Azure Bicep deployments and test files. GitHub Actions \u2014 Starter workflow for checking Azure Infrastructure as Code (IaC). Azure Pipelines \u2014 Starter pipelines for checking Azure Infrastructure as Code (IaC). Custom rules \u2014 Example custom rules that enforce organization specific requirements. PSRule options \u2014 Example options for using PSRule for Azure.","title":"Quick Start repository"},{"location":"support/","text":"Support # This project uses GitHub Issues to track bugs and feature requests. Before logging an issue please see our troubleshooting guide . Please search the existing issues before filing new issues to avoid duplicates. For new issues, file your bug or feature request as a new issue . For help, discussion, and support questions about using this project, join or start a discussion . Microsoft Support Policy # Support for this project/ product is limited to the resources listed above.","title":"Support"},{"location":"support/#support","text":"This project uses GitHub Issues to track bugs and feature requests. Before logging an issue please see our troubleshooting guide . Please search the existing issues before filing new issues to avoid duplicates. For new issues, file your bug or feature request as a new issue . For help, discussion, and support questions about using this project, join or start a discussion .","title":"Support"},{"location":"support/#microsoft-support-policy","text":"Support for this project/ product is limited to the resources listed above.","title":"Microsoft Support Policy"},{"location":"troubleshooting/","text":"Troubleshooting # This article provides troubleshooting instructions for common errors. An earlier version of Az.Accounts is imported # When running PSRule for Azure in Azure DevOps within the AzurePowerShell@5 task, you may see the following error. Error This module requires Az.Accounts version 2.8.0. An earlier version of Az.Accounts is imported in the current PowerShell session. Please open a new session before importing this module. This error could indicate that multiple incompatible versions of the Azure PowerShell cmdlets are installed on your system. Please see https://aka.ms/azps-version-error for troubleshooting information. This error is raised by a chained dependency failure importing a newer version of Az.Accounts . To avoid this issue attempt to install the exact versions of Az.Resources . In the AzurePowerShell@5 task before installing PSRule. Install-Module Az . Resources -RequiredVersion '5.6.0' -Force -Scope CurrentUser From PSRule for Azure v1.16.0, Az.Accounts and Az.Resources are no longer installed as dependencies. When using export commands from PSRule, you may need to install these modules. To install these modules, use the following PowerShell command: Install-Module Az . Resources -Force -Scope CurrentUser Bicep compilation timeout # When expanding Bicep source files you may get an error similar to the following: Error Bicep (0.4.1124) compilation of 'C:\\temp\\deploy.bicep' failed with: Bicep compilation hasn't completed within the timeout window. This can be caused by errors or warnings. Check the Bicep output by running bicep build and addressing any issues. This error is raised when Bicep takes longer then the timeout to build a source file. The default timeout is 5 seconds. You can take steps to reduce your code complexity and reduce the time a build takes by: Removing unnecessary nested module calls. Cache bicep modules restored from a registry in continuous integration (CI) pipelines. To increase the timeout value, set the AZURE_BICEP_FILE_EXPANSION_TIMEOUT configuration option. See Bicep compilation timeout for details on how to configure this option. No rules or no Azure resources are found # There is a few common causes of this issue including: Check input format \u2014 PSRule for Azure must discover files to expand them. When running PSRule for Azure using GitHub Actions or the Azure Pipelines extension: Your pipeline must be set to inputType: repository , which is the default value. PSRule for Azure will not work with inputType set to inputPath . You may have set this parameter because you wanted to use the inputPath parameter. Setting the inputType is not a requirement for using the inputPath parameter. The inputPath parameter can be used independently. When running PSRule for Azure from PowerShell: Your command-line must use the -Format File parameter. Your command-line must use the -InputPath or -f parameter followed by a file or directory path. For example: Assert-PSRule -Module PSRule.Rules.Azure -Format File -f 'modules/' . Check expansion is enabled \u2014 Expansion must be enabled to analyze Azure Infrastructure as Code. See using templates and using Bicep source for details on how to enable expansion. Check parameter files are linked \u2014 Parameter files must be linked to ARM templates or Bicep source files. See using templates for details on how to link using metadata or naming convention. Note If your pipeline is still not finding any Azure resources, please join or start a discussion . Custom rules are not running # There is a few common causes of this issue including: Check rule path \u2014 By default, PSRule will look for rules in the .ps-rule/ directory. This directory is the root for your repository or the current working path by default. On case-sensitive file systems such as Linux, this directory name is case-sensitive. See Storing and naming rules for more information. Check file name suffix \u2014 PSRule only looks for files with the .Rule.ps1 , .Rule.yaml , or .Rule.jsonc suffix. On case-sensitive file systems such as Linux, this file siffix is case-sensitive. See Storing and naming rules for more information. Check binding configuration \u2014 PSRule uses binding to work out which property to use for a resource type. To be able to use the -Type parameter or type properties in rules definitions, binding must be set. This is automatically configured for PSRule for Azure, however must be set in ps-rule.yaml for custom rules. See binding type for more information. Check modules \u2014 PSRule for Azure is responsible for expanding Azure resources from Infrastructure as Code. Expansion occurs automatically in memory when enabled. For this to work, the module PSRule.Rules.Azure must be run with any custom rules. See using templates and using Bicep source for details on how to enable expansion. Tip You may be able to use git mv to change the case of a file if it is commited to the repository inorrectly. Parameter file warns of metadata property # You may find while editing a .json parameter file the root metadata property is flagged with a warning. Warning The property 'metadata' is not allowed. Azure parameter file { \"$schema\" : \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"template\" : \"./storage.template.json\" }, \"parameters\" : { } } This doesn't affect the workings of the parameter file or deployment. The reason for the warning is that the metadata property has not been added to the parameter file JSON schema. However, the top level metadata property is ignored by Azure Resource Manager when deploying a template. Could not load file or assembly YamlDotNet # PSRule >=1.3.0 uses an updated version of the YamlDotNet library. The PSRule for Azure <1.3.1 uses an older version of this library which may conflict. To avoid this issue: Update to the latest version and use PSRule for Azure >=1.3.1 with PSRule >=1.3.0 . Alternatively, when using PSRule for Azure <1.3.1 use PSRule =1.2.0 . To install the latest module version of PSRule use the following commands: Install-Module -Name PSRule . Rules . Azure -MinimumVersion 1 . 3 . 1 -Scope CurrentUser -Force ; For the PSRule GitHub Action, use >=1.4.0 . - name : Run PSRule analysis uses : Microsoft/ps-rule@v2.3.2","title":"Troubleshooting"},{"location":"troubleshooting/#troubleshooting","text":"This article provides troubleshooting instructions for common errors.","title":"Troubleshooting"},{"location":"troubleshooting/#an-earlier-version-of-azaccounts-is-imported","text":"When running PSRule for Azure in Azure DevOps within the AzurePowerShell@5 task, you may see the following error. Error This module requires Az.Accounts version 2.8.0. An earlier version of Az.Accounts is imported in the current PowerShell session. Please open a new session before importing this module. This error could indicate that multiple incompatible versions of the Azure PowerShell cmdlets are installed on your system. Please see https://aka.ms/azps-version-error for troubleshooting information. This error is raised by a chained dependency failure importing a newer version of Az.Accounts . To avoid this issue attempt to install the exact versions of Az.Resources . In the AzurePowerShell@5 task before installing PSRule. Install-Module Az . Resources -RequiredVersion '5.6.0' -Force -Scope CurrentUser From PSRule for Azure v1.16.0, Az.Accounts and Az.Resources are no longer installed as dependencies. When using export commands from PSRule, you may need to install these modules. To install these modules, use the following PowerShell command: Install-Module Az . Resources -Force -Scope CurrentUser","title":"An earlier version of Az.Accounts is imported"},{"location":"troubleshooting/#bicep-compilation-timeout","text":"When expanding Bicep source files you may get an error similar to the following: Error Bicep (0.4.1124) compilation of 'C:\\temp\\deploy.bicep' failed with: Bicep compilation hasn't completed within the timeout window. This can be caused by errors or warnings. Check the Bicep output by running bicep build and addressing any issues. This error is raised when Bicep takes longer then the timeout to build a source file. The default timeout is 5 seconds. You can take steps to reduce your code complexity and reduce the time a build takes by: Removing unnecessary nested module calls. Cache bicep modules restored from a registry in continuous integration (CI) pipelines. To increase the timeout value, set the AZURE_BICEP_FILE_EXPANSION_TIMEOUT configuration option. See Bicep compilation timeout for details on how to configure this option.","title":"Bicep compilation timeout"},{"location":"troubleshooting/#no-rules-or-no-azure-resources-are-found","text":"There is a few common causes of this issue including: Check input format \u2014 PSRule for Azure must discover files to expand them. When running PSRule for Azure using GitHub Actions or the Azure Pipelines extension: Your pipeline must be set to inputType: repository , which is the default value. PSRule for Azure will not work with inputType set to inputPath . You may have set this parameter because you wanted to use the inputPath parameter. Setting the inputType is not a requirement for using the inputPath parameter. The inputPath parameter can be used independently. When running PSRule for Azure from PowerShell: Your command-line must use the -Format File parameter. Your command-line must use the -InputPath or -f parameter followed by a file or directory path. For example: Assert-PSRule -Module PSRule.Rules.Azure -Format File -f 'modules/' . Check expansion is enabled \u2014 Expansion must be enabled to analyze Azure Infrastructure as Code. See using templates and using Bicep source for details on how to enable expansion. Check parameter files are linked \u2014 Parameter files must be linked to ARM templates or Bicep source files. See using templates for details on how to link using metadata or naming convention. Note If your pipeline is still not finding any Azure resources, please join or start a discussion .","title":"No rules or no Azure resources are found"},{"location":"troubleshooting/#custom-rules-are-not-running","text":"There is a few common causes of this issue including: Check rule path \u2014 By default, PSRule will look for rules in the .ps-rule/ directory. This directory is the root for your repository or the current working path by default. On case-sensitive file systems such as Linux, this directory name is case-sensitive. See Storing and naming rules for more information. Check file name suffix \u2014 PSRule only looks for files with the .Rule.ps1 , .Rule.yaml , or .Rule.jsonc suffix. On case-sensitive file systems such as Linux, this file siffix is case-sensitive. See Storing and naming rules for more information. Check binding configuration \u2014 PSRule uses binding to work out which property to use for a resource type. To be able to use the -Type parameter or type properties in rules definitions, binding must be set. This is automatically configured for PSRule for Azure, however must be set in ps-rule.yaml for custom rules. See binding type for more information. Check modules \u2014 PSRule for Azure is responsible for expanding Azure resources from Infrastructure as Code. Expansion occurs automatically in memory when enabled. For this to work, the module PSRule.Rules.Azure must be run with any custom rules. See using templates and using Bicep source for details on how to enable expansion. Tip You may be able to use git mv to change the case of a file if it is commited to the repository inorrectly.","title":"Custom rules are not running"},{"location":"troubleshooting/#parameter-file-warns-of-metadata-property","text":"You may find while editing a .json parameter file the root metadata property is flagged with a warning. Warning The property 'metadata' is not allowed. Azure parameter file { \"$schema\" : \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"template\" : \"./storage.template.json\" }, \"parameters\" : { } } This doesn't affect the workings of the parameter file or deployment. The reason for the warning is that the metadata property has not been added to the parameter file JSON schema. However, the top level metadata property is ignored by Azure Resource Manager when deploying a template.","title":"Parameter file warns of metadata property"},{"location":"troubleshooting/#could-not-load-file-or-assembly-yamldotnet","text":"PSRule >=1.3.0 uses an updated version of the YamlDotNet library. The PSRule for Azure <1.3.1 uses an older version of this library which may conflict. To avoid this issue: Update to the latest version and use PSRule for Azure >=1.3.1 with PSRule >=1.3.0 . Alternatively, when using PSRule for Azure <1.3.1 use PSRule =1.2.0 . To install the latest module version of PSRule use the following commands: Install-Module -Name PSRule . Rules . Azure -MinimumVersion 1 . 3 . 1 -Scope CurrentUser -Force ; For the PSRule GitHub Action, use >=1.4.0 . - name : Run PSRule analysis uses : Microsoft/ps-rule@v2.3.2","title":"Could not load file or assembly YamlDotNet"},{"location":"upgrade-notes/","text":"Upgrade notes # This document contains notes to help upgrade from previous versions of PSRule for Azure. Upgrading to v2.0.0 # PSRule for Azure v2.0.0 is a planned future release. It's not yet available, but you can take these steps to proactively prepare for the release. Realigned configuration option names # Several configuration options will be renamed in upcoming releases of PSRule for Azure. This is part of a ongoing effort to align the naming of configuration options across PSRule for Azure. For information on other options that will be renamed see deprecations . You only need to take action if you have explicitly set old configuration option names. The old option names may be set in: An option file such as ps-rule.yaml . A custom baseline. An environment variable. To locate any configurations, search for the old option names within your Infrastructure as Code repo. New name Old name Available from AZURE_AKS_CLUSTER_MINIMUM_VERSION Azure_AKSMinimumVersion v1.12.0 To update your configuration, use the new name instead. Note Environment variables are prefixed by PSRULE_CONFIGURATION_ and are case sensitive. Options file Bash GitHub Actions Azure Pipelines Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION option in ps-rule.yaml . # YAML: Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option to 1.22.4 configuration : AZURE_AKS_CLUSTER_MINIMUM_VERSION : 1.22.4 Set the PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION environment variable. # Bash: Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option to 1.22.4 export PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION = 1 .22.4 Set the PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION environment variable. # GitHub Actions: Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option to 1.22.4 env : PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION : '1.22.4' Set the PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION environment variable. # Azure Pipelines: Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option to 1.22.4 variables : - name : PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION value : '1.22.4' Removal of SupportsTags function # The SupportsTags function is a PowerShell function used for filtering rules. Previously you could use this function to only run a rule against resources that support tags. As of v1.15.0 this function has been deprecated for removal in the next major release v2.0.0 . From v2.0.0 the SupportsTags function will not longer work. The SupportsTags function was previously only available for PowerShell rules and not well documented. Instead you can use the Azure.Resource.SupportsTags selector introduced in v1.15.0 . This selector supports the the same features but also supports YAML and JSON rules in addition to PowerShell. To upgrade your PowerShell rules use the -With parameter to set Azure.Resource.SupportsTags . For example: # Synopsis: Old rule using the SupportsTags function Rule 'Local.MyRule' -If { ( SupportsTags ) } { # Rule logic goes here } # Synopsis: Rule updated using the Azure.Resource.SupportsTags selector Rule 'Local.MyRule' -With 'Azure.Resource.SupportsTags' { # Rule logic goes here } To read more about the selector, see the documentation .","title":"Upgrade notes"},{"location":"upgrade-notes/#upgrade-notes","text":"This document contains notes to help upgrade from previous versions of PSRule for Azure.","title":"Upgrade notes"},{"location":"upgrade-notes/#upgrading-to-v200","text":"PSRule for Azure v2.0.0 is a planned future release. It's not yet available, but you can take these steps to proactively prepare for the release.","title":"Upgrading to v2.0.0"},{"location":"upgrade-notes/#realigned-configuration-option-names","text":"Several configuration options will be renamed in upcoming releases of PSRule for Azure. This is part of a ongoing effort to align the naming of configuration options across PSRule for Azure. For information on other options that will be renamed see deprecations . You only need to take action if you have explicitly set old configuration option names. The old option names may be set in: An option file such as ps-rule.yaml . A custom baseline. An environment variable. To locate any configurations, search for the old option names within your Infrastructure as Code repo. New name Old name Available from AZURE_AKS_CLUSTER_MINIMUM_VERSION Azure_AKSMinimumVersion v1.12.0 To update your configuration, use the new name instead. Note Environment variables are prefixed by PSRULE_CONFIGURATION_ and are case sensitive. Options file Bash GitHub Actions Azure Pipelines Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION option in ps-rule.yaml . # YAML: Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option to 1.22.4 configuration : AZURE_AKS_CLUSTER_MINIMUM_VERSION : 1.22.4 Set the PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION environment variable. # Bash: Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option to 1.22.4 export PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION = 1 .22.4 Set the PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION environment variable. # GitHub Actions: Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option to 1.22.4 env : PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION : '1.22.4' Set the PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION environment variable. # Azure Pipelines: Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option to 1.22.4 variables : - name : PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION value : '1.22.4'","title":"Realigned configuration option names"},{"location":"upgrade-notes/#removal-of-supportstags-function","text":"The SupportsTags function is a PowerShell function used for filtering rules. Previously you could use this function to only run a rule against resources that support tags. As of v1.15.0 this function has been deprecated for removal in the next major release v2.0.0 . From v2.0.0 the SupportsTags function will not longer work. The SupportsTags function was previously only available for PowerShell rules and not well documented. Instead you can use the Azure.Resource.SupportsTags selector introduced in v1.15.0 . This selector supports the the same features but also supports YAML and JSON rules in addition to PowerShell. To upgrade your PowerShell rules use the -With parameter to set Azure.Resource.SupportsTags . For example: # Synopsis: Old rule using the SupportsTags function Rule 'Local.MyRule' -If { ( SupportsTags ) } { # Rule logic goes here } # Synopsis: Rule updated using the Azure.Resource.SupportsTags selector Rule 'Local.MyRule' -With 'Azure.Resource.SupportsTags' { # Rule logic goes here } To read more about the selector, see the documentation .","title":"Removal of SupportsTags function"},{"location":"using-bicep/","text":"Using Bicep source # PSRule for Azure discovers and analyzes Azure resources contained within Bicep files. To enable this feature, you need to: Enable expansion. For modules (if used): Define a deployment or parameters file. Configure path exclusions. Abstract This topic covers how you can validate Azure resources within .bicep files. To learn more about why this is important see Expanding source files . Enabling expansion # To expand Bicep deployments configure ps-rule.yaml with the AZURE_BICEP_FILE_EXPANSION option. ps-rule.yaml # YAML: Enable expansion for Bicep source files. configuration : AZURE_BICEP_FILE_EXPANSION : true Note If you are using JSON parameter files exclusively, you do not need to set this option. Instead continue reading using parameter files . Setup Bicep # To expand Azure resources for analysis from Bicep source files the Bicep CLI is required. The Bicep CLI is already installed on hosted runners and agents used by GitHub Actions and Azure Pipelines. For details on how to configure Bicep for PSRule for Azure see Setup Bicep . Building files # It's not nessecary to build .bicep files with bicep build or az bicep build . PSRule will automatically detect and build .bicep files. You may choose to pre-build .bicep files if the Bicep CLI is not available when PSRule is run. Important If using this method, follow using templates instead. Using bicep build transpiles Bicep code into an Azure template .json . Testing Bicep modules # Bicep allows you to separate out complex details into separate files called modules . To expand resources, any parameters must be resolved. Tip If you are not familar with the concept of expansion within PSRule for Azure see Expanding source files . Two types of parameters exist, required (also called mandatory) and optional . An optional parameter is any parameter with a default value. Required parameters do not have a default value and must be specified. Example modules/storage/main.bicep // Required parameter param name string // Optional parameters param location string = resourceGroup().location param sku string = 'Standard_LRS' To specify required parameters for a module, create a deployment or test that references the module. Example deploy.bicep // Deploy storage account to production subscription module storageAccount './modules/storage/main.bicep' = { name: 'deploy-storage' params: { name: 'stpsrulebicep001' sku: 'Standard_GRS' } } Example modules/storage/.tests/main.tests.bicep // Test with only required parameters module test_required_params '../main.bicep' = { name: 'test_required_params' params: { name: 'sttest001' } } Configuring path exclusions # Unless configured, PSRule will discover all .bicep files when expansion is enabled. Bicep module files with required parameters will not be able be expanded and should be excluded. Instead expand resources from deployments or tests. To do this configure ps-rule.yaml with the input.pathIgnore option. Example ps-rule.yaml configuration : # Enable expansion for Bicep source files. AZURE_BICEP_FILE_EXPANSION : true input : pathIgnore : # Exclude bicepconfig.json - 'bicepconfig.json' # Exclude module files - 'modules/**/*.bicep' # Include test files from modules - '!modules/**/*.tests.bicep' Note In this example, Bicep files such as deploy.bicep in other directories will be expanded. Restoring modules from a private registry # Bicep modules can be stored in a private registry. Storing modules in a private registry gives you a central location to reference modules across your organization. To test Bicep deployments which uses modules stored in a private registry, these modules must be restored. The restore process automatically occurs when PSRule is run, however must be authenticated. To authenticate to a private registry configure bicepconfig.json by setting credentialPrecedence . This setting determines the order to find a credential to use when authenticating to the registry. You may need to configure credentials to access the private registry from a CI pipeline. GitHub Actions Azure Pipelines Configure the microsoft/ps-rule action with Azure environment variables. - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : PSRule.Rules.Azure,PSRule.Monitor conventions : Monitor.LogAnalytics.Import env : # Define environment variables using GitHub encrypted secrets AZURE_CLIENT_ID : ${{ secrets.BICEP_REGISTRY_CLIENTID }} AZURE_CLIENT_SECRET : ${{ secrets.BICEP_REGISTRY_CLIENTSECRET }} AZURE_TENANT_ID : ${{ secrets.BICEP_REGISTRY_TENANTID }} Important Environment variables can be configured in the workflow or from a secret. To keep BICEP_REGISTRY_CLIENTSECRET secure, use an encrypted secret . Configure the ps-rule-assert task with Azure environment variables. - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure' env : # Define environment variables within Azure Pipelines AZURE_CLIENT_ID : $(BICEPREGISTRYCLIENTID) AZURE_CLIENT_SECRET : $(BICEPREGISTRYCLIENTSECRET) AZURE_TENANT_ID : $(BICEPREGISTRYTENANTID) Important Variables can be configured in YAML, on the pipeline, or referenced from a defined variable group. To keep BICEPREGISTRYCLIENTSECRET secure, use a variable group linked to an Azure Key Vault. Using parameter files # When using Bicep, you don't need to use parameter files. You can call .bicep files directly from other .bicep files with modules by using the module keyword. Alternatively, you can choose to expand and test a Bicep module from JSON parameter files by metadata . When using parameter files exclusively, the AZURE_BICEP_FILE_EXPANSION configuration option does not need to be set. Instead set the AZURE_PARAMETER_FILE_EXPANSION configuration option to true . This option will discover Bicep files from parameter metadata. Example ps-rule.yaml configuration : # Enable expansion for Bicep module from parameter files. AZURE_PARAMETER_FILE_EXPANSION : true input : pathIgnore : # Exclude bicepconfig.json - 'bicepconfig.json' # Exclude module files - 'modules/**/*.bicep' Example template.parameters.json { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"template\" : \"./template.bicep\" }, \"parameters\" : { \"storageAccountName\" : { \"value\" : \"bicepstorage001\" }, \"tags\" : { \"value\" : { \"env\" : \"test\" } } } }","title":"Using Bicep source"},{"location":"using-bicep/#using-bicep-source","text":"PSRule for Azure discovers and analyzes Azure resources contained within Bicep files. To enable this feature, you need to: Enable expansion. For modules (if used): Define a deployment or parameters file. Configure path exclusions. Abstract This topic covers how you can validate Azure resources within .bicep files. To learn more about why this is important see Expanding source files .","title":"Using Bicep source"},{"location":"using-bicep/#enabling-expansion","text":"To expand Bicep deployments configure ps-rule.yaml with the AZURE_BICEP_FILE_EXPANSION option. ps-rule.yaml # YAML: Enable expansion for Bicep source files. configuration : AZURE_BICEP_FILE_EXPANSION : true Note If you are using JSON parameter files exclusively, you do not need to set this option. Instead continue reading using parameter files .","title":"Enabling expansion"},{"location":"using-bicep/#setup-bicep","text":"To expand Azure resources for analysis from Bicep source files the Bicep CLI is required. The Bicep CLI is already installed on hosted runners and agents used by GitHub Actions and Azure Pipelines. For details on how to configure Bicep for PSRule for Azure see Setup Bicep .","title":"Setup Bicep"},{"location":"using-bicep/#building-files","text":"It's not nessecary to build .bicep files with bicep build or az bicep build . PSRule will automatically detect and build .bicep files. You may choose to pre-build .bicep files if the Bicep CLI is not available when PSRule is run. Important If using this method, follow using templates instead. Using bicep build transpiles Bicep code into an Azure template .json .","title":"Building files"},{"location":"using-bicep/#testing-bicep-modules","text":"Bicep allows you to separate out complex details into separate files called modules . To expand resources, any parameters must be resolved. Tip If you are not familar with the concept of expansion within PSRule for Azure see Expanding source files . Two types of parameters exist, required (also called mandatory) and optional . An optional parameter is any parameter with a default value. Required parameters do not have a default value and must be specified. Example modules/storage/main.bicep // Required parameter param name string // Optional parameters param location string = resourceGroup().location param sku string = 'Standard_LRS' To specify required parameters for a module, create a deployment or test that references the module. Example deploy.bicep // Deploy storage account to production subscription module storageAccount './modules/storage/main.bicep' = { name: 'deploy-storage' params: { name: 'stpsrulebicep001' sku: 'Standard_GRS' } } Example modules/storage/.tests/main.tests.bicep // Test with only required parameters module test_required_params '../main.bicep' = { name: 'test_required_params' params: { name: 'sttest001' } }","title":"Testing Bicep modules"},{"location":"using-bicep/#configuring-path-exclusions","text":"Unless configured, PSRule will discover all .bicep files when expansion is enabled. Bicep module files with required parameters will not be able be expanded and should be excluded. Instead expand resources from deployments or tests. To do this configure ps-rule.yaml with the input.pathIgnore option. Example ps-rule.yaml configuration : # Enable expansion for Bicep source files. AZURE_BICEP_FILE_EXPANSION : true input : pathIgnore : # Exclude bicepconfig.json - 'bicepconfig.json' # Exclude module files - 'modules/**/*.bicep' # Include test files from modules - '!modules/**/*.tests.bicep' Note In this example, Bicep files such as deploy.bicep in other directories will be expanded.","title":"Configuring path exclusions"},{"location":"using-bicep/#restoring-modules-from-a-private-registry","text":"Bicep modules can be stored in a private registry. Storing modules in a private registry gives you a central location to reference modules across your organization. To test Bicep deployments which uses modules stored in a private registry, these modules must be restored. The restore process automatically occurs when PSRule is run, however must be authenticated. To authenticate to a private registry configure bicepconfig.json by setting credentialPrecedence . This setting determines the order to find a credential to use when authenticating to the registry. You may need to configure credentials to access the private registry from a CI pipeline. GitHub Actions Azure Pipelines Configure the microsoft/ps-rule action with Azure environment variables. - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : PSRule.Rules.Azure,PSRule.Monitor conventions : Monitor.LogAnalytics.Import env : # Define environment variables using GitHub encrypted secrets AZURE_CLIENT_ID : ${{ secrets.BICEP_REGISTRY_CLIENTID }} AZURE_CLIENT_SECRET : ${{ secrets.BICEP_REGISTRY_CLIENTSECRET }} AZURE_TENANT_ID : ${{ secrets.BICEP_REGISTRY_TENANTID }} Important Environment variables can be configured in the workflow or from a secret. To keep BICEP_REGISTRY_CLIENTSECRET secure, use an encrypted secret . Configure the ps-rule-assert task with Azure environment variables. - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure' env : # Define environment variables within Azure Pipelines AZURE_CLIENT_ID : $(BICEPREGISTRYCLIENTID) AZURE_CLIENT_SECRET : $(BICEPREGISTRYCLIENTSECRET) AZURE_TENANT_ID : $(BICEPREGISTRYTENANTID) Important Variables can be configured in YAML, on the pipeline, or referenced from a defined variable group. To keep BICEPREGISTRYCLIENTSECRET secure, use a variable group linked to an Azure Key Vault.","title":"Restoring modules from a private registry"},{"location":"using-bicep/#using-parameter-files","text":"When using Bicep, you don't need to use parameter files. You can call .bicep files directly from other .bicep files with modules by using the module keyword. Alternatively, you can choose to expand and test a Bicep module from JSON parameter files by metadata . When using parameter files exclusively, the AZURE_BICEP_FILE_EXPANSION configuration option does not need to be set. Instead set the AZURE_PARAMETER_FILE_EXPANSION configuration option to true . This option will discover Bicep files from parameter metadata. Example ps-rule.yaml configuration : # Enable expansion for Bicep module from parameter files. AZURE_PARAMETER_FILE_EXPANSION : true input : pathIgnore : # Exclude bicepconfig.json - 'bicepconfig.json' # Exclude module files - 'modules/**/*.bicep' Example template.parameters.json { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"template\" : \"./template.bicep\" }, \"parameters\" : { \"storageAccountName\" : { \"value\" : \"bicepstorage001\" }, \"tags\" : { \"value\" : { \"env\" : \"test\" } } } }","title":"Using parameter files"},{"location":"using-templates/","text":"Using templates # PSRule for Azure discovers and analyzes Azure resources contained within template and parameter files. To enable this feature, you need to: Enable expansion. Link parameter files to templates. Abstract This topic covers how you can validate Azure resources within template .json files. To learn more about why this is important see Expanding source files . Enabling expansion # To expand parameter files configure ps-rule.yaml with the AZURE_PARAMETER_FILE_EXPANSION option. ps-rule.yaml # YAML: Enable expansion for template expansion. configuration : AZURE_PARAMETER_FILE_EXPANSION : true Linking templates # PSRule for Azure automatically detects parameter files and uses the following logic to link templates or Bicep modules. By metadata \u2014 Check parameter file for a metadata link identifying the associated template. By naming convention \u2014 Check for matching template files using file naming convention. Note Metadata links take priority over naming convention. For details on both options continue reading. Tip Linking templates also applies to Bicep modules when you are using .json parameter files. By metadata # A parameter file can be linked to an associated template or Bicep module by setting metadata. To link a template within a parameter file, set the metadata.template property to the path of the template. PSRule for Azure supports either: Relative to repository \u2014 By default, the path is relative to the root of the repository. Relative to template \u2014 To use a path relative to the parameter file, prefix the path with ./ . Tip Referencing a path outside of the repository is blocked as this could lead to unintended exposure. Relative to repository Relative to parameter file The following example shows linking to a template which is stored within a hierarchical template/ sub-directory. Example { \"$schema\" : \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"template\" : \"templates/storage/v1/template.json\" }, \"parameters\" : { } } The following example shows linking to a template that is in the same directory as the parameter file. Example { \"$schema\" : \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"template\" : \"./storage.template.json\" }, \"parameters\" : { } } Additional benefits you get by using metadata links include: You can share a common set of versioned templates across multiple deployments in a repository. This works great to mono-repositories. You can discover all the deployments using a specific template by reading metadata. PSRule for Azure includes the Get-AzRuleTemplateLink cmdlet to list parameter file links. Tip By default, metadata links are not required. By configuring the AZURE_PARAMETER_FILE_METADATA_LINK option to true , this can be enforced. When configured, PSRule for Azure will fail parameter files that do not contain a metadata link. For details on AZURE_PARAMETER_FILE_METADATA_LINK see Configuring expansion . Note Bicep modules can also be expanded from parameter files. Instead of specifing a template path, you can specify the path to a Bicep file. Note You may find while editing a .json parameter file the root metadata property is flagged with a warning. For example Property metadata is not allowed. . This doesn't affect the workings of the parameter file or deployment. If you like a detailed description continue reading Troubleshooting . By naming convention # When metadata links are not set, PSRule will fallback to use a naming convention to link to template files. Example A parameter file named azuredeploy.parameters.json links to the template file named azuredeploy.json . PSRule for Azure supports linking by naming convention when: Parameter files end with .parameters.json linking to ARM templates or Bicep modules. The parameter file prefix matches the file name of the template or Bicep module. For example, azuredeploy.parameters.json links to azuredeploy.json or azuredeploy.bicep . If both an ARM template and Bicep module exist, the template ( .json ) is preferred. For example, azuredeploy.parameters.json chooses azuredeploy.json over azuredeploy.bicep if both exist. Both parameter file and template or Bicep module must be in the same directory. The following is not currently supported: Using a different naming convention for parameter files such as <templateName>.param.json . Template or parameter files with alternative file extensions such as .jsonc .","title":"Using templates"},{"location":"using-templates/#using-templates","text":"PSRule for Azure discovers and analyzes Azure resources contained within template and parameter files. To enable this feature, you need to: Enable expansion. Link parameter files to templates. Abstract This topic covers how you can validate Azure resources within template .json files. To learn more about why this is important see Expanding source files .","title":"Using templates"},{"location":"using-templates/#enabling-expansion","text":"To expand parameter files configure ps-rule.yaml with the AZURE_PARAMETER_FILE_EXPANSION option. ps-rule.yaml # YAML: Enable expansion for template expansion. configuration : AZURE_PARAMETER_FILE_EXPANSION : true","title":"Enabling expansion"},{"location":"using-templates/#linking-templates","text":"PSRule for Azure automatically detects parameter files and uses the following logic to link templates or Bicep modules. By metadata \u2014 Check parameter file for a metadata link identifying the associated template. By naming convention \u2014 Check for matching template files using file naming convention. Note Metadata links take priority over naming convention. For details on both options continue reading. Tip Linking templates also applies to Bicep modules when you are using .json parameter files.","title":"Linking templates"},{"location":"using-templates/#by-metadata","text":"A parameter file can be linked to an associated template or Bicep module by setting metadata. To link a template within a parameter file, set the metadata.template property to the path of the template. PSRule for Azure supports either: Relative to repository \u2014 By default, the path is relative to the root of the repository. Relative to template \u2014 To use a path relative to the parameter file, prefix the path with ./ . Tip Referencing a path outside of the repository is blocked as this could lead to unintended exposure. Relative to repository Relative to parameter file The following example shows linking to a template which is stored within a hierarchical template/ sub-directory. Example { \"$schema\" : \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"template\" : \"templates/storage/v1/template.json\" }, \"parameters\" : { } } The following example shows linking to a template that is in the same directory as the parameter file. Example { \"$schema\" : \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"template\" : \"./storage.template.json\" }, \"parameters\" : { } } Additional benefits you get by using metadata links include: You can share a common set of versioned templates across multiple deployments in a repository. This works great to mono-repositories. You can discover all the deployments using a specific template by reading metadata. PSRule for Azure includes the Get-AzRuleTemplateLink cmdlet to list parameter file links. Tip By default, metadata links are not required. By configuring the AZURE_PARAMETER_FILE_METADATA_LINK option to true , this can be enforced. When configured, PSRule for Azure will fail parameter files that do not contain a metadata link. For details on AZURE_PARAMETER_FILE_METADATA_LINK see Configuring expansion . Note Bicep modules can also be expanded from parameter files. Instead of specifing a template path, you can specify the path to a Bicep file. Note You may find while editing a .json parameter file the root metadata property is flagged with a warning. For example Property metadata is not allowed. . This doesn't affect the workings of the parameter file or deployment. If you like a detailed description continue reading Troubleshooting .","title":"By metadata"},{"location":"using-templates/#by-naming-convention","text":"When metadata links are not set, PSRule will fallback to use a naming convention to link to template files. Example A parameter file named azuredeploy.parameters.json links to the template file named azuredeploy.json . PSRule for Azure supports linking by naming convention when: Parameter files end with .parameters.json linking to ARM templates or Bicep modules. The parameter file prefix matches the file name of the template or Bicep module. For example, azuredeploy.parameters.json links to azuredeploy.json or azuredeploy.bicep . If both an ARM template and Bicep module exist, the template ( .json ) is preferred. For example, azuredeploy.parameters.json chooses azuredeploy.json over azuredeploy.bicep if both exist. Both parameter file and template or Bicep module must be in the same directory. The following is not currently supported: Using a different naming convention for parameter files such as <templateName>.param.json . Template or parameter files with alternative file extensions such as .jsonc .","title":"By naming convention"},{"location":"validating-locally/","text":"Validating locally # While preparing infrastructure code artifacts, Azure resources can be validated locally. PSRule for Azure can be installed locally on MacOS, Linux, and Windows for local validation. Tip If you haven't already, follow the instructions on Installing locally before continuing. If analyzing Azure resources from Bicep source files, complete Setup Bicep . With Visual Studio Code # Extension An extension for Visual Studio Code is available for an integrated experience using PSRule for Azure. The Visual Studio Code extension includes a built-in PSRule: Run analysis task. To learn about tasks in Visual Studio Code see Integrate with External Tools via Tasks . To use PSRule for Azure with the built-in PSRule: Run analysis task, insert the following into .vscode/tasks.json . { \"type\" : \"PSRule\" , \"problemMatcher\" : [ \"$PSRule\" ], \"label\" : \"PSRule: Run analysis\" , \"modules\" : [ \"PSRule.Rules.Azure\" ], \"presentation\" : { \"clear\" : true , \"panel\" : \"dedicated\" } } Example A complete .vscode/tasks.json might look like the following: { \"version\" : \"2.0.0\" , \"tasks\" : [ { \"type\" : \"PSRule\" , \"problemMatcher\" : [ \"$PSRule\" ], \"label\" : \"PSRule: Run analysis\" , \"modules\" : [ \"PSRule.Rules.Azure\" ], \"presentation\" : { \"clear\" : true , \"panel\" : \"dedicated\" } } ] }","title":"Validating locally"},{"location":"validating-locally/#validating-locally","text":"While preparing infrastructure code artifacts, Azure resources can be validated locally. PSRule for Azure can be installed locally on MacOS, Linux, and Windows for local validation. Tip If you haven't already, follow the instructions on Installing locally before continuing. If analyzing Azure resources from Bicep source files, complete Setup Bicep .","title":"Validating locally"},{"location":"validating-locally/#with-visual-studio-code","text":"Extension An extension for Visual Studio Code is available for an integrated experience using PSRule for Azure. The Visual Studio Code extension includes a built-in PSRule: Run analysis task. To learn about tasks in Visual Studio Code see Integrate with External Tools via Tasks . To use PSRule for Azure with the built-in PSRule: Run analysis task, insert the following into .vscode/tasks.json . { \"type\" : \"PSRule\" , \"problemMatcher\" : [ \"$PSRule\" ], \"label\" : \"PSRule: Run analysis\" , \"modules\" : [ \"PSRule.Rules.Azure\" ], \"presentation\" : { \"clear\" : true , \"panel\" : \"dedicated\" } } Example A complete .vscode/tasks.json might look like the following: { \"version\" : \"2.0.0\" , \"tasks\" : [ { \"type\" : \"PSRule\" , \"problemMatcher\" : [ \"$PSRule\" ], \"label\" : \"PSRule: Run analysis\" , \"modules\" : [ \"PSRule.Rules.Azure\" ], \"presentation\" : { \"clear\" : true , \"panel\" : \"dedicated\" } } ] }","title":"With Visual Studio Code"},{"location":"working-with-baselines/","text":"Working with baselines # A baseline is a standard PSRule artifact that combines rules and configuration. PSRule for Azure provides several baselines that can be referenced when running PSRule. Abstract This topic covers how to use baselines shipped with PSRule for Azure. Quarterly baselines # PSRule for Azure ships new rules on a monthly cadence. As new rules are added, existing pipelines that previously passed may fail based on additional requirements. It is generally expected that files committed to an integration branch such as main continue to pass. PSRule for Azure addresses this through quarterly baselines that provide: Greater consistency \u2014 Quarterly baselines provide a stable checkpoint of rules to use. Each quarterly baseline includes rules for generally available ( GA ) and preview Azure features to date. Rules released after the quarterly baseline are added to the next quarterly baseline. New quarterly baselines are released every three (3) months. Baselines are named Azure.GA_yyyy_mm and Azure.Preview_yyyy_mm based on the release year/ month. Incremental adoption \u2014 It may not be possibly to implement new rules immediately. Existing backlogs or timelines may make it impossible to add new requirements until a future sprint. In a future sprint, bump the quarterly baseline to the latest release to get the additional rules. Considerations for adopting a quarterly baseline include: The quarterly baselines older than the latest are flagged as obsolete. Obsolete baselines can still be used, however will generate a warning. As Azure evolves there may be cases where a feature change means a rule is no longer required. In these cases, a rule may be removed from PSRule for Azure and any applicable baselines. Separate quarterly baselines for Azure GA and preview features are provided. The baseline for GA features is named Azure.GA_yyyy_mm and preview features is named Azure.Preview_yyyy_mm . Important When using a quarterly baseline, by default PSRule will ignore custom/ standalone rules. To include custom rules, set the Rule.IncludeLocal option to true . This is described further in including custom rules . Note The preview quarterly baselines includes Azure features relased under preview only. This is different from the Azure.Preview baseline which contains GA and preview features. Limitations # Quarterly baselines don't address all cases where a previously passing pipeline may fail, specifically: As bugs are identified they are corrected and shipped in the next minor or patch release. If the rule was not correctly working previously, failures may be generated after the fix. To workaround this you can either: Create a temporary suppression to ignore the issue. Install a previous version of the PSRule for Azure module. Rule configuration defaults change. Currently rule configuration defaults are not included in quarterly baselines. To workaround this, override the rule configuration option by setting the value in ps-rule.yaml . Additional standard baselines # In additional to quarterly baselines, some additional baselines exist: Azure.Default - Includes rules for GA Azure features. This is the default baseline that is used when no baseline is specified. Rules for Azure features that are within the scope of a public or private preview are not included. Azure.Preview - Includes rules for GA and preview Azure features. Azure.All - Includes all Azure rules shipped with PSRule for Azure. This is functionally the same as Azure.Preview however intended for internal use only. Using baselines # To use a baseline within a CI pipeline specify the baseline by name. See reference for a list baselines shipped with PSRule for Azure. GitHub Actions Azure Pipelines PowerShell Update your GitHub Actions workflow by specifying baseline: <name_of_baseline> . # Analyze Azure resources using PSRule for Azure - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : 'PSRule.Rules.Azure' baseline : 'Azure.GA_2022_06' Update your Azure DevOps YAML pipeline by specifying baseline: <name_of_baseline> . # Analyze Azure resources using PSRule for Azure - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure' baseline : 'Azure.GA_2022_06' Update your PowerShell command-line with -Baseline <name_of_baseline> . With Assert-PSRule Assert-PSRule -Format File -InputPath '.' -Module 'PSRule.Rules.Azure' -Baseline 'Azure.GA_2022_06' With Invoke-PSRule Invoke-PSRule -Format File -InputPath '.' -Module 'PSRule.Rules.Azure' -Baseline 'Azure.GA_2022_06' Creating baselines # To create your own baselines see the PSRule help topic about_PSRule_Baseline . Including custom rules # v1.8.0 The quarterly baselines shipped with PSRule for Azure target a subset of rules for GA Azure features. When you specify a baseline, custom rules you create and store in .ps-rule/ will be ignored by default. To change this behavior, set the Rule.IncludeLocal option to true . This option can be set in ps-rule.yaml . ps-rule.yaml # YAML: Enable custom rules that don't exist in the baseline rule : includeLocal : true","title":"Working with baselines"},{"location":"working-with-baselines/#working-with-baselines","text":"A baseline is a standard PSRule artifact that combines rules and configuration. PSRule for Azure provides several baselines that can be referenced when running PSRule. Abstract This topic covers how to use baselines shipped with PSRule for Azure.","title":"Working with baselines"},{"location":"working-with-baselines/#quarterly-baselines","text":"PSRule for Azure ships new rules on a monthly cadence. As new rules are added, existing pipelines that previously passed may fail based on additional requirements. It is generally expected that files committed to an integration branch such as main continue to pass. PSRule for Azure addresses this through quarterly baselines that provide: Greater consistency \u2014 Quarterly baselines provide a stable checkpoint of rules to use. Each quarterly baseline includes rules for generally available ( GA ) and preview Azure features to date. Rules released after the quarterly baseline are added to the next quarterly baseline. New quarterly baselines are released every three (3) months. Baselines are named Azure.GA_yyyy_mm and Azure.Preview_yyyy_mm based on the release year/ month. Incremental adoption \u2014 It may not be possibly to implement new rules immediately. Existing backlogs or timelines may make it impossible to add new requirements until a future sprint. In a future sprint, bump the quarterly baseline to the latest release to get the additional rules. Considerations for adopting a quarterly baseline include: The quarterly baselines older than the latest are flagged as obsolete. Obsolete baselines can still be used, however will generate a warning. As Azure evolves there may be cases where a feature change means a rule is no longer required. In these cases, a rule may be removed from PSRule for Azure and any applicable baselines. Separate quarterly baselines for Azure GA and preview features are provided. The baseline for GA features is named Azure.GA_yyyy_mm and preview features is named Azure.Preview_yyyy_mm . Important When using a quarterly baseline, by default PSRule will ignore custom/ standalone rules. To include custom rules, set the Rule.IncludeLocal option to true . This is described further in including custom rules . Note The preview quarterly baselines includes Azure features relased under preview only. This is different from the Azure.Preview baseline which contains GA and preview features.","title":"Quarterly baselines"},{"location":"working-with-baselines/#limitations","text":"Quarterly baselines don't address all cases where a previously passing pipeline may fail, specifically: As bugs are identified they are corrected and shipped in the next minor or patch release. If the rule was not correctly working previously, failures may be generated after the fix. To workaround this you can either: Create a temporary suppression to ignore the issue. Install a previous version of the PSRule for Azure module. Rule configuration defaults change. Currently rule configuration defaults are not included in quarterly baselines. To workaround this, override the rule configuration option by setting the value in ps-rule.yaml .","title":"Limitations"},{"location":"working-with-baselines/#additional-standard-baselines","text":"In additional to quarterly baselines, some additional baselines exist: Azure.Default - Includes rules for GA Azure features. This is the default baseline that is used when no baseline is specified. Rules for Azure features that are within the scope of a public or private preview are not included. Azure.Preview - Includes rules for GA and preview Azure features. Azure.All - Includes all Azure rules shipped with PSRule for Azure. This is functionally the same as Azure.Preview however intended for internal use only.","title":"Additional standard baselines"},{"location":"working-with-baselines/#using-baselines","text":"To use a baseline within a CI pipeline specify the baseline by name. See reference for a list baselines shipped with PSRule for Azure. GitHub Actions Azure Pipelines PowerShell Update your GitHub Actions workflow by specifying baseline: <name_of_baseline> . # Analyze Azure resources using PSRule for Azure - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : 'PSRule.Rules.Azure' baseline : 'Azure.GA_2022_06' Update your Azure DevOps YAML pipeline by specifying baseline: <name_of_baseline> . # Analyze Azure resources using PSRule for Azure - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : 'PSRule.Rules.Azure' baseline : 'Azure.GA_2022_06' Update your PowerShell command-line with -Baseline <name_of_baseline> . With Assert-PSRule Assert-PSRule -Format File -InputPath '.' -Module 'PSRule.Rules.Azure' -Baseline 'Azure.GA_2022_06' With Invoke-PSRule Invoke-PSRule -Format File -InputPath '.' -Module 'PSRule.Rules.Azure' -Baseline 'Azure.GA_2022_06'","title":"Using baselines"},{"location":"working-with-baselines/#creating-baselines","text":"To create your own baselines see the PSRule help topic about_PSRule_Baseline .","title":"Creating baselines"},{"location":"working-with-baselines/#including-custom-rules","text":"v1.8.0 The quarterly baselines shipped with PSRule for Azure target a subset of rules for GA Azure features. When you specify a baseline, custom rules you create and store in .ps-rule/ will be ignored by default. To change this behavior, set the Rule.IncludeLocal option to true . This option can be set in ps-rule.yaml . ps-rule.yaml # YAML: Enable custom rules that don't exist in the baseline rule : includeLocal : true","title":"Including custom rules"},{"location":"benchmark/results-pre-1.2.0/","text":"BenchmarkDotNet = v0.12.1, OS=Windows 10.0.19042 Intel Core i7-1065G7 CPU 1.30GHz, 1 CPU, 8 logical and 4 physical cores .NET Core SDK = 5.0.201 [Host] : .NET Core 3.1.13 (CoreCLR 4.700.21.11102, CoreFX 4.700.21.11602), X64 RyuJIT DefaultJob : .NET Core 3.1.13 (CoreCLR 4.700.21.11102, CoreFX 4.700.21.11602), X64 RyuJIT | Method | Mean | Error | StdDev | Gen 0 | Gen 1 | Gen 2 | Allocated | |--------------------- |---------:|---------:|---------:|----------:|--------:|------:|----------:| | Template | 45.44 ms | 0.885 ms | 2.170 ms | 5000.0000 | - | - | 20.82 MB | | PropertyCopyLoop | 27.49 ms | 0.545 ms | 1.252 ms | 3687.5000 | 62.5000 | - | 14.84 MB | | UserDefinedFunctions | 12.92 ms | 0.223 ms | 0.186 ms | 953.1250 | 15.6250 | - | 3.87 MB |","title":"Results pre 1.2.0"},{"location":"benchmark/results-pre-1.4.0/","text":"BenchmarkDotNet = v0.13.0, OS=Windows 10.0.19043.985 (21H1/May2021Update) Intel Core i7-1065G7 CPU 1.30GHz, 1 CPU, 8 logical and 4 physical cores .NET SDK = 6.0.100-preview.3.21202.5 [Host] : .NET Core 3.1.15 (CoreCLR 4.700.21.21202, CoreFX 4.700.21.21402), X64 RyuJIT DefaultJob : .NET Core 3.1.15 (CoreCLR 4.700.21.21202, CoreFX 4.700.21.21402), X64 RyuJIT | Method | Mean | Error | StdDev | Gen 0 | Gen 1 | Gen 2 | Allocated | |--------------------- |---------:|---------:|---------:|----------:|---------:|------:|----------:| | Template | 35.73 ms | 0.660 ms | 0.585 ms | 5266.6667 | 133.3333 | - | 21 MB | | PropertyCopyLoop | 25.85 ms | 0.315 ms | 0.279 ms | 3812.5000 | 31.2500 | - | 15 MB | | UserDefinedFunctions | 13.37 ms | 0.142 ms | 0.133 ms | 1109.3750 | 31.2500 | - | 4 MB |","title":"Results pre 1.4.0"},{"location":"benchmark/results-pre-v1.8.0/","text":"BenchmarkDotNet = v0.13.1, OS=Windows 10.0.19043.1165 (21H1/May2021Update) Intel Core i7-1065G7 CPU 1.30GHz, 1 CPU, 8 logical and 4 physical cores .NET SDK = 5.0.400 [Host] : .NET Core 3.1.18 (CoreCLR 4.700.21.35901, CoreFX 4.700.21.36305), X64 RyuJIT DefaultJob : .NET Core 3.1.18 (CoreCLR 4.700.21.35901, CoreFX 4.700.21.36305), X64 RyuJIT | Method | Mean | Error | StdDev | Gen 0 | Gen 1 | Allocated | |--------------------- |---------:|---------:|---------:|----------:|---------:|----------:| | Template | 41.65 ms | 0.824 ms | 0.731 ms | 5333.3333 | 416.6667 | 21 MB | | PropertyCopyLoop | 30.70 ms | 0.542 ms | 0.795 ms | 3843.7500 | 62.5000 | 15 MB | | UserDefinedFunctions | 17.54 ms | 0.322 ms | 0.301 ms | 1125.0000 | 31.2500 | 5 MB |","title":"Results pre v1.8.0"},{"location":"benchmark/results-v1.10.4/","text":"BenchmarkDotNet = v0.13.1, OS=Windows 10.0.22000 Intel Core i7-1065G7 CPU 1.30GHz, 1 CPU, 8 logical and 4 physical cores .NET SDK = 5.0.404 [Host] : .NET Core 3.1.22 (CoreCLR 4.700.21.56803, CoreFX 4.700.21.57101), X64 RyuJIT DefaultJob : .NET Core 3.1.22 (CoreCLR 4.700.21.56803, CoreFX 4.700.21.57101), X64 RyuJIT | Method | Mean | Error | StdDev | Gen 0 | Gen 1 | Allocated | |--------------------- |---------:|---------:|----------:|----------:|----------:|----------:| | Template | 74.25 ms | 4.140 ms | 12.206 ms | 6000.0000 | 1000.0000 | 27 MB | | PropertyCopyLoop | 47.84 ms | 0.936 ms | 1.615 ms | 4444.4444 | 222.2222 | 18 MB | | UserDefinedFunctions | 28.87 ms | 0.574 ms | 1.224 ms | 1500.0000 | 62.5000 | 6 MB |","title":"Results v1.10.4"},{"location":"benchmark/results-v1.11.0/","text":"BenchmarkDotNet = v0.13.1, OS=Windows 10.0.22000 Intel Core i7-1065G7 CPU 1.30GHz, 1 CPU, 8 logical and 4 physical cores .NET SDK = 5.0.404 [Host] : .NET Core 3.1.22 (CoreCLR 4.700.21.56803, CoreFX 4.700.21.57101), X64 RyuJIT DefaultJob : .NET Core 3.1.22 (CoreCLR 4.700.21.56803, CoreFX 4.700.21.57101), X64 RyuJIT | Method | Mean | Error | StdDev | Gen 0 | Gen 1 | Allocated | |--------------------- |---------:|---------:|---------:|----------:|----------:|----------:| | Template | 78.97 ms | 2.842 ms | 8.246 ms | 6000.0000 | 1000.0000 | 27 MB | | PropertyCopyLoop | 47.83 ms | 0.954 ms | 2.033 ms | 4400.0000 | 200.0000 | 18 MB | | UserDefinedFunctions | 29.42 ms | 0.587 ms | 1.172 ms | 1500.0000 | 62.5000 | 6 MB |","title":"Results v1.11.0"},{"location":"benchmark/results-v1.14.3/","text":"BenchmarkDotNet = v0.13.1, OS=Windows 10.0.22000 Intel Core i7-1065G7 CPU 1.30GHz, 1 CPU, 8 logical and 4 physical cores .NET SDK = 6.0.202 [Host] : .NET Core 3.1.24 (CoreCLR 4.700.22.16002, CoreFX 4.700.22.17909), X64 RyuJIT DefaultJob : .NET Core 3.1.24 (CoreCLR 4.700.22.16002, CoreFX 4.700.22.17909), X64 RyuJIT | Method | Mean | Error | StdDev | Gen 0 | Gen 1 | Allocated | |--------------------- |---------:|---------:|---------:|----------:|---------:|----------:| | Template | 80.07 ms | 2.250 ms | 6.598 ms | 6666.6667 | 666.6667 | 28 MB | | PropertyCopyLoop | 52.08 ms | 0.955 ms | 0.798 ms | 4500.0000 | 125.0000 | 18 MB | | UserDefinedFunctions | 35.51 ms | 0.705 ms | 1.635 ms | 1600.0000 | 66.6667 | 7 MB |","title":"Results v1.14.3"},{"location":"benchmark/results-v1.15.0/","text":"BenchmarkDotNet = v0.13.1, OS=Windows 10.0.22000 Intel Core i7-1065G7 CPU 1.30GHz, 1 CPU, 8 logical and 4 physical cores .NET SDK = 6.0.202 [Host] : .NET Core 3.1.24 (CoreCLR 4.700.22.16002, CoreFX 4.700.22.17909), X64 RyuJIT DefaultJob : .NET Core 3.1.24 (CoreCLR 4.700.22.16002, CoreFX 4.700.22.17909), X64 RyuJIT | Method | Mean | Error | StdDev | Median | Gen 0 | Gen 1 | Allocated | |----------------------- |----------------:|----------------:|----------------:|----------------:|----------:|----------:|-------------:| | Template | 58,758,457.6 ns | 1,368,418.79 ns | 3,859,649.48 ns | 57,989,600.0 ns | 6000.0000 | 2000.0000 | 28,881,656 B | | PropertyCopyLoop | 35,152,022.3 ns | 699,686.11 ns | 1,206,924.16 ns | 34,927,013.3 ns | 4466.6667 | 133.3333 | 19,040,308 B | | UserDefinedFunctions | 19,601,380.5 ns | 382,322.59 ns | 560,403.50 ns | 19,517,700.0 ns | 1562.5000 | 62.5000 | 6,821,540 B | | ResolvePolicyAliasPath | 2,194.6 ns | 42.05 ns | 84.93 ns | 2,154.7 ns | 0.2861 | - | 1,200 B | | GetResourceType | 293.9 ns | 1.82 ns | 1.52 ns | 293.9 ns | 0.0858 | - | 360 B |","title":"Results v1.15.0"},{"location":"benchmark/results-v1.8.1/","text":"BenchmarkDotNet = v0.13.1, OS=Windows 10.0.22000 Intel Core i7-1065G7 CPU 1.30GHz, 1 CPU, 8 logical and 4 physical cores .NET SDK = 5.0.404 [Host] : .NET Core 3.1.22 (CoreCLR 4.700.21.56803, CoreFX 4.700.21.57101), X64 RyuJIT DefaultJob : .NET Core 3.1.22 (CoreCLR 4.700.21.56803, CoreFX 4.700.21.57101), X64 RyuJIT | Method | Mean | Error | StdDev | Gen 0 | Gen 1 | Allocated | |--------------------- |---------:|---------:|---------:|----------:|----------:|----------:| | Template | 49.11 ms | 1.871 ms | 5.307 ms | 5000.0000 | 1000.0000 | 21 MB | | PropertyCopyLoop | 42.65 ms | 0.815 ms | 1.001 ms | 3812.5000 | 125.0000 | 15 MB | | UserDefinedFunctions | 26.26 ms | 0.518 ms | 1.126 ms | 1125.0000 | 31.2500 | 5 MB |","title":"Results v1.8.1"},{"location":"benchmark/results-v1.9.1/","text":"BenchmarkDotNet = v0.13.1, OS=Windows 10.0.22000 Intel Core i7-1065G7 CPU 1.30GHz, 1 CPU, 8 logical and 4 physical cores .NET SDK = 5.0.404 [Host] : .NET Core 3.1.22 (CoreCLR 4.700.21.56803, CoreFX 4.700.21.57101), X64 RyuJIT DefaultJob : .NET Core 3.1.22 (CoreCLR 4.700.21.56803, CoreFX 4.700.21.57101), X64 RyuJIT | Method | Mean | Error | StdDev | Gen 0 | Gen 1 | Allocated | |--------------------- |---------:|---------:|---------:|----------:|---------:|----------:| | Template | 54.28 ms | 1.081 ms | 1.443 ms | 5333.3333 | 555.5556 | 21 MB | | PropertyCopyLoop | 42.15 ms | 0.823 ms | 0.881 ms | 3833.3333 | 166.6667 | 15 MB | | UserDefinedFunctions | 25.76 ms | 0.510 ms | 1.076 ms | 1125.0000 | 31.2500 | 5 MB |","title":"Results v1.9.1"},{"location":"commands/Export-AzPolicyAssignmentData/","text":"Export-AzPolicyAssignmentData # Export policy assignment data. SYNTAX # Default (Default) # Export-AzPolicyAssignmentData [-OutputPath <string>] [-PassThru] [-WhatIf] [-Confirm] [<CommonParameters>] Name # Export-AzPolicyAssignmentData [-Name <string>] [-Scope <string>] [-PolicyDefinitionId <string>] [-OutputPath <string>] [-PassThru] [-WhatIf] [-Confirm] [<CommonParameters>] Id # Export-AzPolicyAssignmentData -Id <string> [-PolicyDefinitionId <string>] [-OutputPath <string>] [-PassThru] [-WhatIf] [-Confirm] [<CommonParameters>] IncludeDescendent # Export-AzPolicyAssignmentData -IncludeDescendent [-Scope <string>] [-OutputPath <string>] [-PassThru] [-WhatIf] [-Confirm] [<CommonParameters>] Description # This is an experimental cmdlet. Export policy assignment data. By default the current subscription context will be exported. i.e Get-AzContext Policy assignment data will be exported to the current working directory by default as JSON files, one per subscription. All output files include a .assignment.json extension by default. Examples # Example 1 # Export-AzPolicyAssignmentData Directory: C:\\ Mode LastWriteTime Length Name ---- ------------- ------ ---- -a--- 26/03/2022 7:01 PM 740098 \ue60b 00000000-0000-0000-0000-000000000000.assignment.json Export policy assignment data from current subscription context. Example 2 # Export-AzPolicyAssignmentData -Name '000000000000000000000000' -Scope '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/PolicyRG' Directory: C:\\ Mode LastWriteTime Length Name ---- ------------- ------ ---- -a--- 26/03/2022 7:15 PM 4185 \ue60b 00000000-0000-0000-0000-000000000000.assignment.json Export policy assignment with specific name and scope. Example 3 # Export-AzPolicyAssignmentData -Id '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/PolicyRG/providers/Microsoft.Authorization/policyAssignments/000000000000000000000000' Directory: C:\\ Mode LastWriteTime Length Name ---- ------------- ------ ---- -a--- 26/03/2022 7:42 PM 4185 \ue60b 00000000-0000-0000-0000-00000000000.assignment.json Export policy assignment with specific resource ID. PARAMETERS # -Name # Specifies the name of the policy assignment. Type : String Parameter Sets : (Name) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -Id # Specifies the fully qualified resource ID for the policy assignment. Type : String Parameter Sets : (Id) Aliases : AssignmentId Required : True Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -Scope # Specifies the scope at which the policy is applied for the assignment. Type : String Parameter Sets : (Name, IncludeDescendent) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -PolicyDefinitionId # Specifies the ID of the policy definition of the policy assignment. Type : String Parameter Sets : (Name, Id) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -IncludeDescendent # Causes the list of returned policy assignments to include all assignments related to the given scope, including those from ancestor scopes and those from descendent scopes. Type : String Parameter Sets : (IncludeDescendent) Aliases : Required : True Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -OutputPath # The path to store generated JSON files containing policy assignment data. Type : String Parameter Sets : Default Aliases : Required : True Position : Named Default value : $PWD Accept pipeline input : False Accept wildcard characters : False -PassThru # By default, FileInfo objects are returned to the pipeline for each JSON file created. When -PassThru is specified, JSON files are not created and Azure resource objects are returned to the pipeline instead. Type : SwitchParameter Parameter Sets : Default Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False CommonParameters # This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters . INPUTS # None # OUTPUTS # System.IO.FileInfo # Return FileInfo for each of the output files created, one per subscription context. This is the default. PSObject # Return an object for each Azure resource, and configuration exported. This is returned when the -PassThru switch is used. Notes # RELATED LINKS #","title":"Export-AzPolicyAssignmentData"},{"location":"commands/Export-AzPolicyAssignmentData/#export-azpolicyassignmentdata","text":"Export policy assignment data.","title":"Export-AzPolicyAssignmentData"},{"location":"commands/Export-AzPolicyAssignmentData/#syntax","text":"","title":"SYNTAX"},{"location":"commands/Export-AzPolicyAssignmentData/#default-default","text":"Export-AzPolicyAssignmentData [-OutputPath <string>] [-PassThru] [-WhatIf] [-Confirm] [<CommonParameters>]","title":"Default (Default)"},{"location":"commands/Export-AzPolicyAssignmentData/#name","text":"Export-AzPolicyAssignmentData [-Name <string>] [-Scope <string>] [-PolicyDefinitionId <string>] [-OutputPath <string>] [-PassThru] [-WhatIf] [-Confirm] [<CommonParameters>]","title":"Name"},{"location":"commands/Export-AzPolicyAssignmentData/#id","text":"Export-AzPolicyAssignmentData -Id <string> [-PolicyDefinitionId <string>] [-OutputPath <string>] [-PassThru] [-WhatIf] [-Confirm] [<CommonParameters>]","title":"Id"},{"location":"commands/Export-AzPolicyAssignmentData/#includedescendent","text":"Export-AzPolicyAssignmentData -IncludeDescendent [-Scope <string>] [-OutputPath <string>] [-PassThru] [-WhatIf] [-Confirm] [<CommonParameters>]","title":"IncludeDescendent"},{"location":"commands/Export-AzPolicyAssignmentData/#description","text":"This is an experimental cmdlet. Export policy assignment data. By default the current subscription context will be exported. i.e Get-AzContext Policy assignment data will be exported to the current working directory by default as JSON files, one per subscription. All output files include a .assignment.json extension by default.","title":"Description"},{"location":"commands/Export-AzPolicyAssignmentData/#examples","text":"","title":"Examples"},{"location":"commands/Export-AzPolicyAssignmentData/#example-1","text":"Export-AzPolicyAssignmentData Directory: C:\\ Mode LastWriteTime Length Name ---- ------------- ------ ---- -a--- 26/03/2022 7:01 PM 740098 \ue60b 00000000-0000-0000-0000-000000000000.assignment.json Export policy assignment data from current subscription context.","title":"Example 1"},{"location":"commands/Export-AzPolicyAssignmentData/#example-2","text":"Export-AzPolicyAssignmentData -Name '000000000000000000000000' -Scope '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/PolicyRG' Directory: C:\\ Mode LastWriteTime Length Name ---- ------------- ------ ---- -a--- 26/03/2022 7:15 PM 4185 \ue60b 00000000-0000-0000-0000-000000000000.assignment.json Export policy assignment with specific name and scope.","title":"Example 2"},{"location":"commands/Export-AzPolicyAssignmentData/#example-3","text":"Export-AzPolicyAssignmentData -Id '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/PolicyRG/providers/Microsoft.Authorization/policyAssignments/000000000000000000000000' Directory: C:\\ Mode LastWriteTime Length Name ---- ------------- ------ ---- -a--- 26/03/2022 7:42 PM 4185 \ue60b 00000000-0000-0000-0000-00000000000.assignment.json Export policy assignment with specific resource ID.","title":"Example 3"},{"location":"commands/Export-AzPolicyAssignmentData/#parameters","text":"","title":"PARAMETERS"},{"location":"commands/Export-AzPolicyAssignmentData/#-name","text":"Specifies the name of the policy assignment. Type : String Parameter Sets : (Name) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-Name"},{"location":"commands/Export-AzPolicyAssignmentData/#-id","text":"Specifies the fully qualified resource ID for the policy assignment. Type : String Parameter Sets : (Id) Aliases : AssignmentId Required : True Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-Id"},{"location":"commands/Export-AzPolicyAssignmentData/#-scope","text":"Specifies the scope at which the policy is applied for the assignment. Type : String Parameter Sets : (Name, IncludeDescendent) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-Scope"},{"location":"commands/Export-AzPolicyAssignmentData/#-policydefinitionid","text":"Specifies the ID of the policy definition of the policy assignment. Type : String Parameter Sets : (Name, Id) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-PolicyDefinitionId"},{"location":"commands/Export-AzPolicyAssignmentData/#-includedescendent","text":"Causes the list of returned policy assignments to include all assignments related to the given scope, including those from ancestor scopes and those from descendent scopes. Type : String Parameter Sets : (IncludeDescendent) Aliases : Required : True Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-IncludeDescendent"},{"location":"commands/Export-AzPolicyAssignmentData/#-outputpath","text":"The path to store generated JSON files containing policy assignment data. Type : String Parameter Sets : Default Aliases : Required : True Position : Named Default value : $PWD Accept pipeline input : False Accept wildcard characters : False","title":"-OutputPath"},{"location":"commands/Export-AzPolicyAssignmentData/#-passthru","text":"By default, FileInfo objects are returned to the pipeline for each JSON file created. When -PassThru is specified, JSON files are not created and Azure resource objects are returned to the pipeline instead. Type : SwitchParameter Parameter Sets : Default Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-PassThru"},{"location":"commands/Export-AzPolicyAssignmentData/#commonparameters","text":"This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters .","title":"CommonParameters"},{"location":"commands/Export-AzPolicyAssignmentData/#inputs","text":"","title":"INPUTS"},{"location":"commands/Export-AzPolicyAssignmentData/#none","text":"","title":"None"},{"location":"commands/Export-AzPolicyAssignmentData/#outputs","text":"","title":"OUTPUTS"},{"location":"commands/Export-AzPolicyAssignmentData/#systemiofileinfo","text":"Return FileInfo for each of the output files created, one per subscription context. This is the default.","title":"System.IO.FileInfo"},{"location":"commands/Export-AzPolicyAssignmentData/#psobject","text":"Return an object for each Azure resource, and configuration exported. This is returned when the -PassThru switch is used.","title":"PSObject"},{"location":"commands/Export-AzPolicyAssignmentData/#notes","text":"","title":"Notes"},{"location":"commands/Export-AzPolicyAssignmentData/#related-links","text":"","title":"RELATED LINKS"},{"location":"commands/Export-AzPolicyAssignmentRuleData/","text":"Export-AzPolicyAssignmentRuleData # Export JSON based rules from policy assignment data. SYNTAX # Default (Default) # Export-AzPolicyAssignmentRuleData [[-Name] <string>] [-AssignmentFile] <string> [[-ResourceGroup] <ResourceGroupReference>] [[-Subscription] <SubscriptionReference>] [[-OutputPath] <string>] [-PassThru] [<CommonParameters>] Description # This is an experimental cmdlet. Export JSON based rules from policy assignment data. Policy assignment data generated from Export-AzPolicyAssignmentData is used to generate JSON rules. By default this is an offline process, requiring no connectivity to Azure. Policy definitions with the Disabled effect are ignored. The subscription() function will return the following unless overridden: subscriptionId: 'ffffffff-ffff-ffff-ffff-ffffffffffff' tenantId: 'ffffffff-ffff-ffff-ffff-ffffffffffff' displayName: 'PSRule Test Subscription' state: 'NotDefined' The resourceGroup() function will return the following unless overridden: name: 'ps-rule-test-rg' location: 'eastus' tags: { } properties: provisioningState: 'Succeeded' To override, set the AZURE_SUBSCRIPTION and AZURE_RESOURCE_GROUP in configuration. Currently the following limitations apply: field() expressions are not expanded. Field/Value count expressions are not supported. Template functions with value cannot be expanded e.g. \"value\": \"[substring(field('name'), 0, 3)]\" . Any of the above will lead to errors when emitting JSON rules. Examples # Example 1 # Export-AzPolicyAssignmentRuleData -Name \"policy\" -AssignmentFile .\\ 00000000 - 0000 - 0000 - 0000 - 000000000000 . assignment . json Mode LastWriteTime Length Name ---- ------------- ------ ---- -a--- 26/03/2022 9:41 PM 361 \uf15b definitions-policy.Rule.jsonc Export JSON rules to file in current working directory. Example 2 # $subscription = @{ subscriptionId = 'nnnnnnnn-nnnn-nnnn-nnnn-nnnnnnnnnnnn' displayName = 'My Azure Subscription' tenantId = 'nnnnnnnn-nnnn-nnnn-nnnn-nnnnnnnnnnnn' } Export-AzPolicyAssignmentRuleData -Name \"policy\" -AssignmentFile .\\ 00000000 - 0000 - 0000 - 0000 - 000000000000 . assignment . json -Subscription $subscription Mode LastWriteTime Length Name ---- ------------- ------ ---- -a--- 26/03/2022 9:41 PM 361 \uf15b definitions-policy.Rule.jsonc Export JSON rules to file in current working directory using a specific subscription. Example 3 # Get-AzPolicyAssignmentDataSource | Export-AzPolicyAssignmentRuleData Mode LastWriteTime Length Name ---- ------------- ------ ---- -a--- 27/03/2022 11:26 AM 721 \uf15b definitions-export-1b474938.Rule.jsonc Export JSON rules from the current working directory using discovered assignment sources in the current working directory. PARAMETERS # -Name # The name of the assignment. If not specified export-<xxxxxxxx> will be used as the name of the assignment. Type : String Parameter Sets : Default Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -AssignmentFile # The absolute or relative path to an assignment data file. Type : String Parameter Sets : Default Aliases : Required : True Position : Named Default value : None Accept pipeline input : True (ByPropertyName) Accept wildcard characters : False -OutputPath # The path to store generated JSON files containing resources. If this parameter is not specified, output will be written to the current working path. The file name definitions-<name>.Rule.jsonc will be used when this parameter is not set or a directory is specified. Where <name> is the name of the assignment specified by -Name . This parameter has no affect when -PassThru is used. Type : String Parameter Sets : Default Aliases : Required : False Position : Named Default value : $PWD Accept pipeline input : False Accept wildcard characters : False -PassThru # By default, FileInfo objects are returned to the pipeline for each JSON file created. When -PassThru is specified, JSON files are not created and Azure resource objects are returned to the pipeline instead. Type : SwitchParameter Parameter Sets : Default Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -ResourceGroup # A name or hashtable of the Resource Group in the assignment data file. This Resource Group specified here will be used to resolve the resourceGroup() function. When the name of Resource Group is specified, the Resource Group will be looked up and used during export. This requires an authenticated connection to Azure with permissions to read the specified Resource Group. Alternately, a hashtable of a Resource Group object can be specified. This option does not require an authenticated Azure connection. The hashtable will override the defaults for any specified properties. For more details see about_PSRule_Azure_Configuration. Type : ResourceGroupReference Parameter Sets : Default Aliases : ResourceGroupName Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -Subscription # The name or hashtable of the Subscription in the assignment data file. This subscription specified here will be used to resolve the subscription() function. When a subscription name is specified, the Subscription will be looked up and used during export. This requires an authenticated connection to Azure with permissions to read the specified Subscription. Alternately, a hashtable of a Subscription object can be specified. This option does not require an authenticated Azure connection. The hashtable will override the defaults for any specified properties. For more details see about_PSRule_Azure_Configuration. Type : SubscriptionReference Parameter Sets : Default Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False CommonParameters # This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters . INPUTS # System.String # OUTPUTS # System.IO.FileInfo # System.Object # Notes # RELATED LINKS #","title":"Export-AzPolicyAssignmentRuleData"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#export-azpolicyassignmentruledata","text":"Export JSON based rules from policy assignment data.","title":"Export-AzPolicyAssignmentRuleData"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#syntax","text":"","title":"SYNTAX"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#default-default","text":"Export-AzPolicyAssignmentRuleData [[-Name] <string>] [-AssignmentFile] <string> [[-ResourceGroup] <ResourceGroupReference>] [[-Subscription] <SubscriptionReference>] [[-OutputPath] <string>] [-PassThru] [<CommonParameters>]","title":"Default (Default)"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#description","text":"This is an experimental cmdlet. Export JSON based rules from policy assignment data. Policy assignment data generated from Export-AzPolicyAssignmentData is used to generate JSON rules. By default this is an offline process, requiring no connectivity to Azure. Policy definitions with the Disabled effect are ignored. The subscription() function will return the following unless overridden: subscriptionId: 'ffffffff-ffff-ffff-ffff-ffffffffffff' tenantId: 'ffffffff-ffff-ffff-ffff-ffffffffffff' displayName: 'PSRule Test Subscription' state: 'NotDefined' The resourceGroup() function will return the following unless overridden: name: 'ps-rule-test-rg' location: 'eastus' tags: { } properties: provisioningState: 'Succeeded' To override, set the AZURE_SUBSCRIPTION and AZURE_RESOURCE_GROUP in configuration. Currently the following limitations apply: field() expressions are not expanded. Field/Value count expressions are not supported. Template functions with value cannot be expanded e.g. \"value\": \"[substring(field('name'), 0, 3)]\" . Any of the above will lead to errors when emitting JSON rules.","title":"Description"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#examples","text":"","title":"Examples"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#example-1","text":"Export-AzPolicyAssignmentRuleData -Name \"policy\" -AssignmentFile .\\ 00000000 - 0000 - 0000 - 0000 - 000000000000 . assignment . json Mode LastWriteTime Length Name ---- ------------- ------ ---- -a--- 26/03/2022 9:41 PM 361 \uf15b definitions-policy.Rule.jsonc Export JSON rules to file in current working directory.","title":"Example 1"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#example-2","text":"$subscription = @{ subscriptionId = 'nnnnnnnn-nnnn-nnnn-nnnn-nnnnnnnnnnnn' displayName = 'My Azure Subscription' tenantId = 'nnnnnnnn-nnnn-nnnn-nnnn-nnnnnnnnnnnn' } Export-AzPolicyAssignmentRuleData -Name \"policy\" -AssignmentFile .\\ 00000000 - 0000 - 0000 - 0000 - 000000000000 . assignment . json -Subscription $subscription Mode LastWriteTime Length Name ---- ------------- ------ ---- -a--- 26/03/2022 9:41 PM 361 \uf15b definitions-policy.Rule.jsonc Export JSON rules to file in current working directory using a specific subscription.","title":"Example 2"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#example-3","text":"Get-AzPolicyAssignmentDataSource | Export-AzPolicyAssignmentRuleData Mode LastWriteTime Length Name ---- ------------- ------ ---- -a--- 27/03/2022 11:26 AM 721 \uf15b definitions-export-1b474938.Rule.jsonc Export JSON rules from the current working directory using discovered assignment sources in the current working directory.","title":"Example 3"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#parameters","text":"","title":"PARAMETERS"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#-name","text":"The name of the assignment. If not specified export-<xxxxxxxx> will be used as the name of the assignment. Type : String Parameter Sets : Default Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-Name"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#-assignmentfile","text":"The absolute or relative path to an assignment data file. Type : String Parameter Sets : Default Aliases : Required : True Position : Named Default value : None Accept pipeline input : True (ByPropertyName) Accept wildcard characters : False","title":"-AssignmentFile"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#-outputpath","text":"The path to store generated JSON files containing resources. If this parameter is not specified, output will be written to the current working path. The file name definitions-<name>.Rule.jsonc will be used when this parameter is not set or a directory is specified. Where <name> is the name of the assignment specified by -Name . This parameter has no affect when -PassThru is used. Type : String Parameter Sets : Default Aliases : Required : False Position : Named Default value : $PWD Accept pipeline input : False Accept wildcard characters : False","title":"-OutputPath"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#-passthru","text":"By default, FileInfo objects are returned to the pipeline for each JSON file created. When -PassThru is specified, JSON files are not created and Azure resource objects are returned to the pipeline instead. Type : SwitchParameter Parameter Sets : Default Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-PassThru"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#-resourcegroup","text":"A name or hashtable of the Resource Group in the assignment data file. This Resource Group specified here will be used to resolve the resourceGroup() function. When the name of Resource Group is specified, the Resource Group will be looked up and used during export. This requires an authenticated connection to Azure with permissions to read the specified Resource Group. Alternately, a hashtable of a Resource Group object can be specified. This option does not require an authenticated Azure connection. The hashtable will override the defaults for any specified properties. For more details see about_PSRule_Azure_Configuration. Type : ResourceGroupReference Parameter Sets : Default Aliases : ResourceGroupName Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-ResourceGroup"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#-subscription","text":"The name or hashtable of the Subscription in the assignment data file. This subscription specified here will be used to resolve the subscription() function. When a subscription name is specified, the Subscription will be looked up and used during export. This requires an authenticated connection to Azure with permissions to read the specified Subscription. Alternately, a hashtable of a Subscription object can be specified. This option does not require an authenticated Azure connection. The hashtable will override the defaults for any specified properties. For more details see about_PSRule_Azure_Configuration. Type : SubscriptionReference Parameter Sets : Default Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-Subscription"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#commonparameters","text":"This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters .","title":"CommonParameters"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#inputs","text":"","title":"INPUTS"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#systemstring","text":"","title":"System.String"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#outputs","text":"","title":"OUTPUTS"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#systemiofileinfo","text":"","title":"System.IO.FileInfo"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#systemobject","text":"","title":"System.Object"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#notes","text":"","title":"Notes"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#related-links","text":"","title":"RELATED LINKS"},{"location":"commands/Export-AzRuleData/","text":"Export-AzRuleData # Export resource configuration data from one or more Azure subscriptions. SYNTAX # Default (Default) # Export-AzRuleData [[-OutputPath] <String>] [-Subscription <String[]>] [-Tenant <String[]>] [-ResourceGroupName <String[]>] [-Tag <Hashtable>] [-PassThru] [-WhatIf] [-Confirm] [<CommonParameters>] All # Export-AzRuleData [[-OutputPath] <String>] [-ResourceGroupName <String[]>] [-Tag <Hashtable>] [-PassThru] [-All] [-WhatIf] [-Confirm] [<CommonParameters>] Description # Export resource configuration data from deployed resources in one or more Azure subscriptions. If no filters are specified then the current subscription context will be exported. i.e. Get-AzContext To export all subscriptions contexts use the -All switch. When the -All switch is used, all subscriptions contexts will be exported. i.e. Get-AzContext -ListAvailable Resource data will be exported to the current working directory by default as JSON files, one per subscription. Examples # Example 1 # Export-AzRuleData Directory: C:\\ Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 1/07/2019 10:03 AM 7304948 00000000-0000-0000-0000-000000000001.json Export resource configuration data from current subscription context. Example 2 # Export-AzRuleData -Subscription 'Contoso Production' , 'Contoso Non-production' Directory: C:\\ Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 1/07/2019 10:03 AM 7304948 00000000-0000-0000-0000-000000000001.json -a---- 1/07/2019 10:03 AM 7304948 00000000-0000-0000-0000-000000000002.json Export resource configuration data from subscriptions by name. Example 3 # Export-AzRuleData -ResourceGroupName 'rg-app1-web' , 'rg-app1-db' Directory: C:\\ Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 1/07/2019 10:03 AM 7304948 00000000-0000-0000-0000-000000000001.json Export resource configuration data from two resource groups within the current subscription context. PARAMETERS # -All # By default, resources from the current subscription context are extracted. Use -All to extract resource data for all subscription contexts instead. Type : SwitchParameter Parameter Sets : All Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -OutputPath # The path to store generated JSON files containing resources. Type : String Parameter Sets : (All) Aliases : Required : False Position : 0 Default value : None Accept pipeline input : False Accept wildcard characters : False -PassThru # By default, FileInfo objects are returned to the pipeline for each JSON file created. When -PassThru is specified, JSON files are not created and Azure resource objects are returned to the pipeline instead. Type : SwitchParameter Parameter Sets : (All) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -ResourceGroupName # Optionally filter resources by Resource Group name. Type : String[] Parameter Sets : (All) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -Subscription # Optionally filter resources by subscription, Id or Name. Type : String[] Parameter Sets : Default Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -Tag # Optionally filter resources based on tag. Type : Hashtable Parameter Sets : (All) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -Tenant # Optionally filter resources by a unique Tenant identifer. Type : String[] Parameter Sets : Default Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -Confirm # Prompts you for confirmation before running the cmdlet. Type : SwitchParameter Parameter Sets : (All) Aliases : cf Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -WhatIf # Shows what would happen if the cmdlet runs. The cmdlet is not run. Type : SwitchParameter Parameter Sets : (All) Aliases : wi Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False CommonParameters # This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters . INPUTS # None # OUTPUTS # System.IO.FileInfo # Return FileInfo for each of the output files created, one per subscription. This is the default. PSObject # Return an object for each Azure resource, and configuration exported. This is returned when the -PassThru switch is used. Notes # RELATED LINKS #","title":"Export-AzRuleData"},{"location":"commands/Export-AzRuleData/#export-azruledata","text":"Export resource configuration data from one or more Azure subscriptions.","title":"Export-AzRuleData"},{"location":"commands/Export-AzRuleData/#syntax","text":"","title":"SYNTAX"},{"location":"commands/Export-AzRuleData/#default-default","text":"Export-AzRuleData [[-OutputPath] <String>] [-Subscription <String[]>] [-Tenant <String[]>] [-ResourceGroupName <String[]>] [-Tag <Hashtable>] [-PassThru] [-WhatIf] [-Confirm] [<CommonParameters>]","title":"Default (Default)"},{"location":"commands/Export-AzRuleData/#all","text":"Export-AzRuleData [[-OutputPath] <String>] [-ResourceGroupName <String[]>] [-Tag <Hashtable>] [-PassThru] [-All] [-WhatIf] [-Confirm] [<CommonParameters>]","title":"All"},{"location":"commands/Export-AzRuleData/#description","text":"Export resource configuration data from deployed resources in one or more Azure subscriptions. If no filters are specified then the current subscription context will be exported. i.e. Get-AzContext To export all subscriptions contexts use the -All switch. When the -All switch is used, all subscriptions contexts will be exported. i.e. Get-AzContext -ListAvailable Resource data will be exported to the current working directory by default as JSON files, one per subscription.","title":"Description"},{"location":"commands/Export-AzRuleData/#examples","text":"","title":"Examples"},{"location":"commands/Export-AzRuleData/#example-1","text":"Export-AzRuleData Directory: C:\\ Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 1/07/2019 10:03 AM 7304948 00000000-0000-0000-0000-000000000001.json Export resource configuration data from current subscription context.","title":"Example 1"},{"location":"commands/Export-AzRuleData/#example-2","text":"Export-AzRuleData -Subscription 'Contoso Production' , 'Contoso Non-production' Directory: C:\\ Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 1/07/2019 10:03 AM 7304948 00000000-0000-0000-0000-000000000001.json -a---- 1/07/2019 10:03 AM 7304948 00000000-0000-0000-0000-000000000002.json Export resource configuration data from subscriptions by name.","title":"Example 2"},{"location":"commands/Export-AzRuleData/#example-3","text":"Export-AzRuleData -ResourceGroupName 'rg-app1-web' , 'rg-app1-db' Directory: C:\\ Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 1/07/2019 10:03 AM 7304948 00000000-0000-0000-0000-000000000001.json Export resource configuration data from two resource groups within the current subscription context.","title":"Example 3"},{"location":"commands/Export-AzRuleData/#parameters","text":"","title":"PARAMETERS"},{"location":"commands/Export-AzRuleData/#-all","text":"By default, resources from the current subscription context are extracted. Use -All to extract resource data for all subscription contexts instead. Type : SwitchParameter Parameter Sets : All Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-All"},{"location":"commands/Export-AzRuleData/#-outputpath","text":"The path to store generated JSON files containing resources. Type : String Parameter Sets : (All) Aliases : Required : False Position : 0 Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-OutputPath"},{"location":"commands/Export-AzRuleData/#-passthru","text":"By default, FileInfo objects are returned to the pipeline for each JSON file created. When -PassThru is specified, JSON files are not created and Azure resource objects are returned to the pipeline instead. Type : SwitchParameter Parameter Sets : (All) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-PassThru"},{"location":"commands/Export-AzRuleData/#-resourcegroupname","text":"Optionally filter resources by Resource Group name. Type : String[] Parameter Sets : (All) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-ResourceGroupName"},{"location":"commands/Export-AzRuleData/#-subscription","text":"Optionally filter resources by subscription, Id or Name. Type : String[] Parameter Sets : Default Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-Subscription"},{"location":"commands/Export-AzRuleData/#-tag","text":"Optionally filter resources based on tag. Type : Hashtable Parameter Sets : (All) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-Tag"},{"location":"commands/Export-AzRuleData/#-tenant","text":"Optionally filter resources by a unique Tenant identifer. Type : String[] Parameter Sets : Default Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-Tenant"},{"location":"commands/Export-AzRuleData/#-confirm","text":"Prompts you for confirmation before running the cmdlet. Type : SwitchParameter Parameter Sets : (All) Aliases : cf Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-Confirm"},{"location":"commands/Export-AzRuleData/#-whatif","text":"Shows what would happen if the cmdlet runs. The cmdlet is not run. Type : SwitchParameter Parameter Sets : (All) Aliases : wi Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-WhatIf"},{"location":"commands/Export-AzRuleData/#commonparameters","text":"This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters .","title":"CommonParameters"},{"location":"commands/Export-AzRuleData/#inputs","text":"","title":"INPUTS"},{"location":"commands/Export-AzRuleData/#none","text":"","title":"None"},{"location":"commands/Export-AzRuleData/#outputs","text":"","title":"OUTPUTS"},{"location":"commands/Export-AzRuleData/#systemiofileinfo","text":"Return FileInfo for each of the output files created, one per subscription. This is the default.","title":"System.IO.FileInfo"},{"location":"commands/Export-AzRuleData/#psobject","text":"Return an object for each Azure resource, and configuration exported. This is returned when the -PassThru switch is used.","title":"PSObject"},{"location":"commands/Export-AzRuleData/#notes","text":"","title":"Notes"},{"location":"commands/Export-AzRuleData/#related-links","text":"","title":"RELATED LINKS"},{"location":"commands/Export-AzRuleTemplateData/","text":"Export-AzRuleTemplateData # Export resource configuration data from Azure templates. SYNTAX # Export-AzRuleTemplateData [[-Name] <String>] -TemplateFile <String> [-ParameterFile <String[]>] [-ResourceGroup <ResourceGroupReference>] [-Subscription <SubscriptionReference>] [-OutputPath <String>] [-PassThru] [<CommonParameters>] Description # Export resource configuration data by merging Azure Resource Manager (ARM) template and parameter files. Template and parameters are merged by resolving template parameters, variables and functions. This function does not check template files for strict compliance with Azure schemas. By default this is an offline process, requiring no connectivity to Azure. Some functions that may be included in templates dynamically query Azure for current state. For these functions standard placeholder values are used by default. Functions that use placeholders include reference , list* . The subscription() function will return the following unless overridden: subscriptionId: 'ffffffff-ffff-ffff-ffff-ffffffffffff' tenantId: 'ffffffff-ffff-ffff-ffff-ffffffffffff' displayName: 'PSRule Test Subscription' state: 'NotDefined' The resourceGroup() function will return the following unless overridden: name: 'ps-rule-test-rg' location: 'eastus' tags: { } properties: provisioningState: 'Succeeded' To override, set the AZURE_SUBSCRIPTION and AZURE_RESOURCE_GROUP in configuration. Currently the following limitations apply: Nested templates are expanded, external templates are not. Deployment resources that link to an external template are returned as a resource. Sub-resources such as diagnostic logs or configurations are automatically nested. Automatic nesting a sub-resource requires: The parent resource is defined in the same template. The sub-resource depends on the parent resource. The environment template function always returns values for Azure public cloud. References to Key Vault secrets are not expanded. A placeholder value is used instead. The reference() function will return objects for resources within the same template. For resources that are not in the same template, a placeholder value is used instead. Multi-line strings are not supported. Template expressions up to a maximum of 100,000 characters are supported. Examples # Example 1 # Export-AzRuleTemplateData -TemplateFile .\\ template . json -ParameterFile .\\ parameters . json ; Export resource configuration data based on merging a template and parameter file together. Example 2 # Get-AzRuleTemplateLink | Export-AzRuleTemplateData ; Recursively scan the current working path and export linked templates. Example 3 # $subscription = @{ subscriptionId = 'nnnnnnnn-nnnn-nnnn-nnnn-nnnnnnnnnnnn' displayName = 'My Azure Subscription' tenantId = 'nnnnnnnn-nnnn-nnnn-nnnn-nnnnnnnnnnnn' } Get-AzRuleTemplateLink | Export-AzRuleTemplateData -Subscription $subscription ; Export linked templates from the current working path using a specific subscription. Example 4 # $rg = @{ name = 'my-test-rg' location = 'australiaeast' tags = @{ env = 'prod' } } Get-AzRuleTemplateLink | Export-AzRuleTemplateData -ResourceGroup $rg ; Export linked templates from the current working path using a specific resource group. PARAMETERS # -Name # The name of the deployment. If not specified export-<xxxxxxxx> will be used as the name of the deployment. This parameter is used by the deployment() function and is also used to name the output file. Type : String Parameter Sets : (All) Aliases : Required : False Position : 0 Default value : None Accept pipeline input : False Accept wildcard characters : False -TemplateFile # The absolute or relative file path to an Azure Resource Manager template file. Type : String Parameter Sets : (All) Aliases : Required : True Position : Named Default value : None Accept pipeline input : True (ByPropertyName) Accept wildcard characters : False -ParameterFile # The absolute or relative file path to one or more Azure Resource Manager template parameter files. Type : String[] Parameter Sets : (All) Aliases : TemplateParameterFile Required : False Position : Named Default value : None Accept pipeline input : True (ByPropertyName) Accept wildcard characters : False -OutputPath # The path to store generated JSON files containing resources. If this parameter is not specified, output will be written to the current working path. The file name resources-<name>.json will be used when this parameter is not set or a directory is specified. Where <name> is the name of the deployment specified by -Name . This parameter has no affect when -PassThru is used. Type : String Parameter Sets : (All) Aliases : Required : False Position : Named Default value : $PWD Accept pipeline input : False Accept wildcard characters : False -PassThru # By default, FileInfo objects are returned to the pipeline for each JSON file created. When -PassThru is specified, JSON files are not created and Azure resource objects are returned to the pipeline instead. Type : SwitchParameter Parameter Sets : (All) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -ResourceGroup # A name or hashtable of the Resource Group where the deployment will occur. This Resource Group specified here will be used to resolve the resourceGroup() function. When the name of Resource Group is specified, the Resource Group will be looked up and used during export. This requires an authenticated connection to Azure with permissions to read the specified Resource Group. Alternately, a hashtable of a Resource Group object can be specified. This option does not require an authenticated Azure connection. The hashtable will override the defaults for any specified properties. For more details see about_PSRule_Azure_Configuration. Type : ResourceGroupReference Parameter Sets : (All) Aliases : ResourceGroupName Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -Subscription # The name or hashtable of the Subscription where the deployment will occur. This subscription specified here will be used to resolve the subscription() function. When a subscription name is specified, the Subscription will be looked up and used during export. This requires an authenticated connection to Azure with permissions to read the specified Subscription. Alternately, a hashtable of a Subscription object can be specified. This option does not require an authenticated Azure connection. The hashtable will override the defaults for any specified properties. For more details see about_PSRule_Azure_Configuration. Type : SubscriptionReference Parameter Sets : (All) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False CommonParameters # This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters . INPUTS # System.String # System.String[] # OUTPUTS # System.IO.FileInfo # System.Object # Notes # RELATED LINKS #","title":"Export-AzRuleTemplateData"},{"location":"commands/Export-AzRuleTemplateData/#export-azruletemplatedata","text":"Export resource configuration data from Azure templates.","title":"Export-AzRuleTemplateData"},{"location":"commands/Export-AzRuleTemplateData/#syntax","text":"Export-AzRuleTemplateData [[-Name] <String>] -TemplateFile <String> [-ParameterFile <String[]>] [-ResourceGroup <ResourceGroupReference>] [-Subscription <SubscriptionReference>] [-OutputPath <String>] [-PassThru] [<CommonParameters>]","title":"SYNTAX"},{"location":"commands/Export-AzRuleTemplateData/#description","text":"Export resource configuration data by merging Azure Resource Manager (ARM) template and parameter files. Template and parameters are merged by resolving template parameters, variables and functions. This function does not check template files for strict compliance with Azure schemas. By default this is an offline process, requiring no connectivity to Azure. Some functions that may be included in templates dynamically query Azure for current state. For these functions standard placeholder values are used by default. Functions that use placeholders include reference , list* . The subscription() function will return the following unless overridden: subscriptionId: 'ffffffff-ffff-ffff-ffff-ffffffffffff' tenantId: 'ffffffff-ffff-ffff-ffff-ffffffffffff' displayName: 'PSRule Test Subscription' state: 'NotDefined' The resourceGroup() function will return the following unless overridden: name: 'ps-rule-test-rg' location: 'eastus' tags: { } properties: provisioningState: 'Succeeded' To override, set the AZURE_SUBSCRIPTION and AZURE_RESOURCE_GROUP in configuration. Currently the following limitations apply: Nested templates are expanded, external templates are not. Deployment resources that link to an external template are returned as a resource. Sub-resources such as diagnostic logs or configurations are automatically nested. Automatic nesting a sub-resource requires: The parent resource is defined in the same template. The sub-resource depends on the parent resource. The environment template function always returns values for Azure public cloud. References to Key Vault secrets are not expanded. A placeholder value is used instead. The reference() function will return objects for resources within the same template. For resources that are not in the same template, a placeholder value is used instead. Multi-line strings are not supported. Template expressions up to a maximum of 100,000 characters are supported.","title":"Description"},{"location":"commands/Export-AzRuleTemplateData/#examples","text":"","title":"Examples"},{"location":"commands/Export-AzRuleTemplateData/#example-1","text":"Export-AzRuleTemplateData -TemplateFile .\\ template . json -ParameterFile .\\ parameters . json ; Export resource configuration data based on merging a template and parameter file together.","title":"Example 1"},{"location":"commands/Export-AzRuleTemplateData/#example-2","text":"Get-AzRuleTemplateLink | Export-AzRuleTemplateData ; Recursively scan the current working path and export linked templates.","title":"Example 2"},{"location":"commands/Export-AzRuleTemplateData/#example-3","text":"$subscription = @{ subscriptionId = 'nnnnnnnn-nnnn-nnnn-nnnn-nnnnnnnnnnnn' displayName = 'My Azure Subscription' tenantId = 'nnnnnnnn-nnnn-nnnn-nnnn-nnnnnnnnnnnn' } Get-AzRuleTemplateLink | Export-AzRuleTemplateData -Subscription $subscription ; Export linked templates from the current working path using a specific subscription.","title":"Example 3"},{"location":"commands/Export-AzRuleTemplateData/#example-4","text":"$rg = @{ name = 'my-test-rg' location = 'australiaeast' tags = @{ env = 'prod' } } Get-AzRuleTemplateLink | Export-AzRuleTemplateData -ResourceGroup $rg ; Export linked templates from the current working path using a specific resource group.","title":"Example 4"},{"location":"commands/Export-AzRuleTemplateData/#parameters","text":"","title":"PARAMETERS"},{"location":"commands/Export-AzRuleTemplateData/#-name","text":"The name of the deployment. If not specified export-<xxxxxxxx> will be used as the name of the deployment. This parameter is used by the deployment() function and is also used to name the output file. Type : String Parameter Sets : (All) Aliases : Required : False Position : 0 Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-Name"},{"location":"commands/Export-AzRuleTemplateData/#-templatefile","text":"The absolute or relative file path to an Azure Resource Manager template file. Type : String Parameter Sets : (All) Aliases : Required : True Position : Named Default value : None Accept pipeline input : True (ByPropertyName) Accept wildcard characters : False","title":"-TemplateFile"},{"location":"commands/Export-AzRuleTemplateData/#-parameterfile","text":"The absolute or relative file path to one or more Azure Resource Manager template parameter files. Type : String[] Parameter Sets : (All) Aliases : TemplateParameterFile Required : False Position : Named Default value : None Accept pipeline input : True (ByPropertyName) Accept wildcard characters : False","title":"-ParameterFile"},{"location":"commands/Export-AzRuleTemplateData/#-outputpath","text":"The path to store generated JSON files containing resources. If this parameter is not specified, output will be written to the current working path. The file name resources-<name>.json will be used when this parameter is not set or a directory is specified. Where <name> is the name of the deployment specified by -Name . This parameter has no affect when -PassThru is used. Type : String Parameter Sets : (All) Aliases : Required : False Position : Named Default value : $PWD Accept pipeline input : False Accept wildcard characters : False","title":"-OutputPath"},{"location":"commands/Export-AzRuleTemplateData/#-passthru","text":"By default, FileInfo objects are returned to the pipeline for each JSON file created. When -PassThru is specified, JSON files are not created and Azure resource objects are returned to the pipeline instead. Type : SwitchParameter Parameter Sets : (All) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-PassThru"},{"location":"commands/Export-AzRuleTemplateData/#-resourcegroup","text":"A name or hashtable of the Resource Group where the deployment will occur. This Resource Group specified here will be used to resolve the resourceGroup() function. When the name of Resource Group is specified, the Resource Group will be looked up and used during export. This requires an authenticated connection to Azure with permissions to read the specified Resource Group. Alternately, a hashtable of a Resource Group object can be specified. This option does not require an authenticated Azure connection. The hashtable will override the defaults for any specified properties. For more details see about_PSRule_Azure_Configuration. Type : ResourceGroupReference Parameter Sets : (All) Aliases : ResourceGroupName Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-ResourceGroup"},{"location":"commands/Export-AzRuleTemplateData/#-subscription","text":"The name or hashtable of the Subscription where the deployment will occur. This subscription specified here will be used to resolve the subscription() function. When a subscription name is specified, the Subscription will be looked up and used during export. This requires an authenticated connection to Azure with permissions to read the specified Subscription. Alternately, a hashtable of a Subscription object can be specified. This option does not require an authenticated Azure connection. The hashtable will override the defaults for any specified properties. For more details see about_PSRule_Azure_Configuration. Type : SubscriptionReference Parameter Sets : (All) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-Subscription"},{"location":"commands/Export-AzRuleTemplateData/#commonparameters","text":"This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters .","title":"CommonParameters"},{"location":"commands/Export-AzRuleTemplateData/#inputs","text":"","title":"INPUTS"},{"location":"commands/Export-AzRuleTemplateData/#systemstring","text":"","title":"System.String"},{"location":"commands/Export-AzRuleTemplateData/#systemstring_1","text":"","title":"System.String[]"},{"location":"commands/Export-AzRuleTemplateData/#outputs","text":"","title":"OUTPUTS"},{"location":"commands/Export-AzRuleTemplateData/#systemiofileinfo","text":"","title":"System.IO.FileInfo"},{"location":"commands/Export-AzRuleTemplateData/#systemobject","text":"","title":"System.Object"},{"location":"commands/Export-AzRuleTemplateData/#notes","text":"","title":"Notes"},{"location":"commands/Export-AzRuleTemplateData/#related-links","text":"","title":"RELATED LINKS"},{"location":"commands/Get-AzPolicyAssignmentDataSource/","text":"Get-AzPolicyAssignmentDataSource # Get policy assignment sources. SYNTAX # Get-AzPolicyAssignmentDataSource [[-InputPath] <string[]>] [[-Path] <string>] [<CommonParameters>] Description # This is an experimental cmdlet. Get policy assignment sources. By default *.assignment.json sources are discovered from the current working directory. Examples # Example 1 # Get-AzPolicyAssignmentDataSource AssignmentFile -------------- C:\\00000000-0000-0000-0000-000000000001.assignment.json C:\\Users\\user\\00000000-0000-0000-0000-000000000002.assignment.json Gets policy assignment sources from any *.assignment.json sources within any folder in the current working directory path. PARAMETERS # -InputPath # A path or filter to search for assignment files within the path specified by -Path . By default, files with *.assignment.json suffix will be used. When searching for assignment files all sub-directories will be scanned. To perform a shallow search, prefix input paths with ./ . Type : String[] Parameter Sets : Default Aliases : f, AssignmentFile, FullName Required : False Position : Named Default value : '*.assignment.json' Accept pipeline input : True (ByPropertyName) Accept wildcard characters : True -Path # Sets the path to search for assignment files in. By default, this is the current working path. Type : String Parameter Sets : Default Aliases : p Required : False Position : 0 Default value : $PWD Accept pipeline input : False Accept wildcard characters : False CommonParameters # This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters . INPUTS # System.String[] # OUTPUTS # PSRule.Rules.Azure.Pipeline.PolicyAssignmentSource # Notes # RELATED LINKS #","title":"Get-AzPolicyAssignmentDataSource"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#get-azpolicyassignmentdatasource","text":"Get policy assignment sources.","title":"Get-AzPolicyAssignmentDataSource"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#syntax","text":"Get-AzPolicyAssignmentDataSource [[-InputPath] <string[]>] [[-Path] <string>] [<CommonParameters>]","title":"SYNTAX"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#description","text":"This is an experimental cmdlet. Get policy assignment sources. By default *.assignment.json sources are discovered from the current working directory.","title":"Description"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#examples","text":"","title":"Examples"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#example-1","text":"Get-AzPolicyAssignmentDataSource AssignmentFile -------------- C:\\00000000-0000-0000-0000-000000000001.assignment.json C:\\Users\\user\\00000000-0000-0000-0000-000000000002.assignment.json Gets policy assignment sources from any *.assignment.json sources within any folder in the current working directory path.","title":"Example 1"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#parameters","text":"","title":"PARAMETERS"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#-inputpath","text":"A path or filter to search for assignment files within the path specified by -Path . By default, files with *.assignment.json suffix will be used. When searching for assignment files all sub-directories will be scanned. To perform a shallow search, prefix input paths with ./ . Type : String[] Parameter Sets : Default Aliases : f, AssignmentFile, FullName Required : False Position : Named Default value : '*.assignment.json' Accept pipeline input : True (ByPropertyName) Accept wildcard characters : True","title":"-InputPath"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#-path","text":"Sets the path to search for assignment files in. By default, this is the current working path. Type : String Parameter Sets : Default Aliases : p Required : False Position : 0 Default value : $PWD Accept pipeline input : False Accept wildcard characters : False","title":"-Path"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#commonparameters","text":"This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters .","title":"CommonParameters"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#inputs","text":"","title":"INPUTS"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#systemstring","text":"","title":"System.String[]"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#outputs","text":"","title":"OUTPUTS"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#psrulerulesazurepipelinepolicyassignmentsource","text":"","title":"PSRule.Rules.Azure.Pipeline.PolicyAssignmentSource"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#notes","text":"","title":"Notes"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#related-links","text":"","title":"RELATED LINKS"},{"location":"commands/Get-AzRuleTemplateLink/","text":"Get-AzRuleTemplateLink # Get a metadata link to a Azure template file. SYNTAX # Get-AzRuleTemplateLink [[-InputPath] <String[]>] [-SkipUnlinked] [[-Path] <String>] [<CommonParameters>] Description # Gets a link between an Azure Resource Manager (ARM) parameter file and its referenced template file. Parameter files reference a template file by defining metadata. Alternatively, template files are discovered by naming convention. By default, when parameter files without a matching template are discovered an error is raised. To reference a template, set the metadata.template property to a file path. Referencing templates outside of the path specified with -Path is not permitted. To discover template files by naming convention: Both template and parameter files must be in the same sub-directory. The parameter file must end with .parameters.json . The parameter file must be named <templateName>.parameters.json . The template file must be named <templateName>.json . For more information see the about_PSRule_Azure_Metadata_Link topic. Examples # Example 1 # Get-AzRuleTemplateLink Get links from any *.parameters.json files within any folder in the current working path. PARAMETERS # -InputPath # A path or filter to search for parameter files within the path specified by -Path . By default, files with *.parameters.json suffix will be used. When searching for parameter files all sub-directories will be scanned. To perform a shallow search, prefix input paths with ./ . Type : String[] Parameter Sets : (All) Aliases : f, TemplateParameterFile, FullName Required : False Position : 1 Default value : '*.parameters.json' Accept pipeline input : True (ByPropertyName) Accept wildcard characters : True -SkipUnlinked # Use this option to ignore parameter files that have no matching template. By default, when parameter files without a matching template are discovered an error is raised. Type : SwitchParameter Parameter Sets : (All) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False -Path # Sets the path to search for parameter files in. By default, this is the current working path. Type : String Parameter Sets : (All) Aliases : p Required : False Position : 0 Default value : $PWD Accept pipeline input : False Accept wildcard characters : False CommonParameters # This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters . INPUTS # System.String[] # OUTPUTS # PSRule.Rules.Azure.Data.Metadata.ITemplateLink # Notes # RELATED LINKS # about_PSRule_Azure_Metadata_Link","title":"Get-AzRuleTemplateLink"},{"location":"commands/Get-AzRuleTemplateLink/#get-azruletemplatelink","text":"Get a metadata link to a Azure template file.","title":"Get-AzRuleTemplateLink"},{"location":"commands/Get-AzRuleTemplateLink/#syntax","text":"Get-AzRuleTemplateLink [[-InputPath] <String[]>] [-SkipUnlinked] [[-Path] <String>] [<CommonParameters>]","title":"SYNTAX"},{"location":"commands/Get-AzRuleTemplateLink/#description","text":"Gets a link between an Azure Resource Manager (ARM) parameter file and its referenced template file. Parameter files reference a template file by defining metadata. Alternatively, template files are discovered by naming convention. By default, when parameter files without a matching template are discovered an error is raised. To reference a template, set the metadata.template property to a file path. Referencing templates outside of the path specified with -Path is not permitted. To discover template files by naming convention: Both template and parameter files must be in the same sub-directory. The parameter file must end with .parameters.json . The parameter file must be named <templateName>.parameters.json . The template file must be named <templateName>.json . For more information see the about_PSRule_Azure_Metadata_Link topic.","title":"Description"},{"location":"commands/Get-AzRuleTemplateLink/#examples","text":"","title":"Examples"},{"location":"commands/Get-AzRuleTemplateLink/#example-1","text":"Get-AzRuleTemplateLink Get links from any *.parameters.json files within any folder in the current working path.","title":"Example 1"},{"location":"commands/Get-AzRuleTemplateLink/#parameters","text":"","title":"PARAMETERS"},{"location":"commands/Get-AzRuleTemplateLink/#-inputpath","text":"A path or filter to search for parameter files within the path specified by -Path . By default, files with *.parameters.json suffix will be used. When searching for parameter files all sub-directories will be scanned. To perform a shallow search, prefix input paths with ./ . Type : String[] Parameter Sets : (All) Aliases : f, TemplateParameterFile, FullName Required : False Position : 1 Default value : '*.parameters.json' Accept pipeline input : True (ByPropertyName) Accept wildcard characters : True","title":"-InputPath"},{"location":"commands/Get-AzRuleTemplateLink/#-skipunlinked","text":"Use this option to ignore parameter files that have no matching template. By default, when parameter files without a matching template are discovered an error is raised. Type : SwitchParameter Parameter Sets : (All) Aliases : Required : False Position : Named Default value : None Accept pipeline input : False Accept wildcard characters : False","title":"-SkipUnlinked"},{"location":"commands/Get-AzRuleTemplateLink/#-path","text":"Sets the path to search for parameter files in. By default, this is the current working path. Type : String Parameter Sets : (All) Aliases : p Required : False Position : 0 Default value : $PWD Accept pipeline input : False Accept wildcard characters : False","title":"-Path"},{"location":"commands/Get-AzRuleTemplateLink/#commonparameters","text":"This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters .","title":"CommonParameters"},{"location":"commands/Get-AzRuleTemplateLink/#inputs","text":"","title":"INPUTS"},{"location":"commands/Get-AzRuleTemplateLink/#systemstring","text":"","title":"System.String[]"},{"location":"commands/Get-AzRuleTemplateLink/#outputs","text":"","title":"OUTPUTS"},{"location":"commands/Get-AzRuleTemplateLink/#psrulerulesazuredatametadataitemplatelink","text":"","title":"PSRule.Rules.Azure.Data.Metadata.ITemplateLink"},{"location":"commands/Get-AzRuleTemplateLink/#notes","text":"","title":"Notes"},{"location":"commands/Get-AzRuleTemplateLink/#related-links","text":"about_PSRule_Azure_Metadata_Link","title":"RELATED LINKS"},{"location":"commands/PSRule.Rules.Azure/","text":"PSRule.Rules.Azure Module # Description # Validate Azure resources and infrastructure as code using PSRule. PSRule Cmdlets # Export-AzRuleData # Export resource configuration data from one or more Azure subscriptions. Export-AzRuleTemplateData # Export resource configuration data from Azure templates. Get-AzRuleTemplateLink # Get a metadata link to a Azure template file.","title":"PSRule.Rules.Azure Module"},{"location":"commands/PSRule.Rules.Azure/#psrulerulesazure-module","text":"","title":"PSRule.Rules.Azure Module"},{"location":"commands/PSRule.Rules.Azure/#description","text":"Validate Azure resources and infrastructure as code using PSRule.","title":"Description"},{"location":"commands/PSRule.Rules.Azure/#psrule-cmdlets","text":"","title":"PSRule Cmdlets"},{"location":"commands/PSRule.Rules.Azure/#export-azruledata","text":"Export resource configuration data from one or more Azure subscriptions.","title":"Export-AzRuleData"},{"location":"commands/PSRule.Rules.Azure/#export-azruletemplatedata","text":"Export resource configuration data from Azure templates.","title":"Export-AzRuleTemplateData"},{"location":"commands/PSRule.Rules.Azure/#get-azruletemplatelink","text":"Get a metadata link to a Azure template file.","title":"Get-AzRuleTemplateLink"},{"location":"concepts/about_PSRule_Azure_Configuration/","text":"Configuration options # Describes PSRule configuration options specific to PSRule for Azure. Description # PSRule exposes configuration options that can be used to customize execution of PSRule.Rules.Azure . This topic describes what configuration options are available. PSRule configuration options can be specified by setting the configuration option in ps-rule.yaml . Additionally, configuration options can be configured in a baseline or set at runtime. For details of setting configuration options see PSRule options . The following configurations options are available for use: Azure_AKSMinimumVersion Azure_AKSNodeMinimumMaxPods Azure_AllowedRegions Azure_MinimumCertificateLifetime AZURE_PARAMETER_FILE_EXPANSION AZURE_POLICY_WAIVER_MAX_EXPIRY AZURE_RESOURCE_GROUP AZURE_SUBSCRIPTION Azure_AKSMinimumVersion # This configuration option determines the minimum version of Kubernetes for AKS clusters and node pools. Rules that check the Kubernetes version fail when the version is older than the version specified. Syntax: configuration : Azure_AKSMinimumVersion : string # A version string Default: # YAML: The default Azure_AKSMinimumVersion configuration option configuration : Azure_AKSMinimumVersion : 1.20.5 Example: # YAML: Set the Azure_AKSMinimumVersion configuration option to 1.19.7 configuration : Azure_AKSMinimumVersion : 1.19.7 Azure_AKSNodeMinimumMaxPods # This configuration option determines the minimum allowed max pods setting per node pool. When an AKS cluster node pool is created, a maxPods option is used to determine the maximum number of pods for each node in the node pool. Syntax: configuration : Azure_AKSNodeMinimumMaxPods : integer Default: # YAML: The default Azure_AKSNodeMinimumMaxPods configuration option configuration : Azure_AKSNodeMinimumMaxPods : 50 Example: # YAML: Set the Azure_AKSNodeMinimumMaxPods configuration option to 30 configuration : Azure_AKSNodeMinimumMaxPods : 30 Azure_AllowedRegions # This configuration option specifies a list of allowed locations that resources can be deployed to. Rules that check the location of Azure resources fail when a resource or resource group is created in a different region. By default, Azure_AllowedRegions is not configured. The rule Azure.Resource.AllowedRegions is skipped when no allowed locations are configured. Syntax: configuration : Azure_AllowedRegions : array # An array of regions Default: # YAML: The default Azure_AllowedRegions configuration option configuration : Azure_AllowedRegions : [] Example: # YAML: Set the Azure_AllowedRegions configuration option to Australia East, Australia South East configuration : Azure_AllowedRegions : - 'australiaeast' - 'australiasoutheast' Azure_MinimumCertificateLifetime # This configuration option determines the minimum number of days allowed before certificate expiry. Rules that check certificate lifetime fail when the days remaining before expiry drop below this number. Syntax: configuration : Azure_MinimumCertificateLifetime : integer Default: # YAML: The default Azure_MinimumCertificateLifetime configuration option configuration : Azure_MinimumCertificateLifetime : 30 Example: # YAML: Set the Azure_MinimumCertificateLifetime configuration option to 90 configuration : Azure_MinimumCertificateLifetime : 90 AZURE_PARAMETER_FILE_EXPANSION # This configuration option determines if Azure template parameter files will automatically be expanded. By default, parameter files will not be automatically expanded. Parameter files are expanded when PSRule cmdlets with the -Format File parameter are used. Syntax: configuration : AZURE_PARAMETER_FILE_EXPANSION : bool Default: # YAML: The default AZURE_PARAMETER_FILE_EXPANSION configuration option configuration : AZURE_PARAMETER_FILE_EXPANSION : false Example: # YAML: Set the AZURE_PARAMETER_FILE_EXPANSION configuration option to enable expansion configuration : AZURE_PARAMETER_FILE_EXPANSION : true AZURE_POLICY_WAIVER_MAX_EXPIRY # This configuration option determines the maximum number of days in the future for a waiver policy exemption. Syntax: configuration : AZURE_POLICY_WAIVER_MAX_EXPIRY : integer Default: # YAML: The default AZURE_POLICY_WAIVER_MAX_EXPIRY configuration option configuration : AZURE_POLICY_WAIVER_MAX_EXPIRY : 366 Example: # YAML: Set the AZURE_POLICY_WAIVER_MAX_EXPIRY configuration option to 90 configuration : AZURE_POLICY_WAIVER_MAX_EXPIRY : 90 AZURE_RESOURCE_GROUP # This configuration option sets the resource group object used by the resourceGroup() function. Configure this option to change the resource group object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below. This configuration option will be ignored when -ResourceGroup is used with Export-AzRuleTemplateData . Syntax: configuration : AZURE_RESOURCE_GROUP : name : string location : string tags : object properties : provisioningState : string Default: # YAML: The default AZURE_RESOURCE_GROUP configuration option configuration : AZURE_RESOURCE_GROUP : name : 'ps-rule-test-rg' location : 'eastus' tags : { } properties : provisioningState : 'Succeeded' Example: # YAML: Override the location of the resource group object. configuration : AZURE_RESOURCE_GROUP : location : 'australiasoutheast' AZURE_SUBSCRIPTION # This configuration option sets the subscription object used by the subscription() function. Configure this option to change the subscription object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below. This configuration option will be ignored when -Subscription is used with Export-AzRuleTemplateData . Syntax: configuration : AZURE_SUBSCRIPTION : subscriptionId : string tenantId : string displayName : string state : string Default: # YAML: The default AZURE_SUBSCRIPTION configuration option configuration : AZURE_SUBSCRIPTION : subscriptionId : 'ffffffff-ffff-ffff-ffff-ffffffffffff' tenantId : 'ffffffff-ffff-ffff-ffff-ffffffffffff' displayName : 'PSRule Test Subscription' state : 'NotDefined' Example: # YAML: Override the display name of the subscription object AZURE_SUBSCRIPTION : displayName : 'My test subscription'","title":"PSRule_Azure_Configuration"},{"location":"concepts/about_PSRule_Azure_Configuration/#configuration-options","text":"Describes PSRule configuration options specific to PSRule for Azure.","title":"Configuration options"},{"location":"concepts/about_PSRule_Azure_Configuration/#description","text":"PSRule exposes configuration options that can be used to customize execution of PSRule.Rules.Azure . This topic describes what configuration options are available. PSRule configuration options can be specified by setting the configuration option in ps-rule.yaml . Additionally, configuration options can be configured in a baseline or set at runtime. For details of setting configuration options see PSRule options . The following configurations options are available for use: Azure_AKSMinimumVersion Azure_AKSNodeMinimumMaxPods Azure_AllowedRegions Azure_MinimumCertificateLifetime AZURE_PARAMETER_FILE_EXPANSION AZURE_POLICY_WAIVER_MAX_EXPIRY AZURE_RESOURCE_GROUP AZURE_SUBSCRIPTION","title":"Description"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_aksminimumversion","text":"This configuration option determines the minimum version of Kubernetes for AKS clusters and node pools. Rules that check the Kubernetes version fail when the version is older than the version specified. Syntax: configuration : Azure_AKSMinimumVersion : string # A version string Default: # YAML: The default Azure_AKSMinimumVersion configuration option configuration : Azure_AKSMinimumVersion : 1.20.5 Example: # YAML: Set the Azure_AKSMinimumVersion configuration option to 1.19.7 configuration : Azure_AKSMinimumVersion : 1.19.7","title":"Azure_AKSMinimumVersion"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_aksnodeminimummaxpods","text":"This configuration option determines the minimum allowed max pods setting per node pool. When an AKS cluster node pool is created, a maxPods option is used to determine the maximum number of pods for each node in the node pool. Syntax: configuration : Azure_AKSNodeMinimumMaxPods : integer Default: # YAML: The default Azure_AKSNodeMinimumMaxPods configuration option configuration : Azure_AKSNodeMinimumMaxPods : 50 Example: # YAML: Set the Azure_AKSNodeMinimumMaxPods configuration option to 30 configuration : Azure_AKSNodeMinimumMaxPods : 30","title":"Azure_AKSNodeMinimumMaxPods"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_allowedregions","text":"This configuration option specifies a list of allowed locations that resources can be deployed to. Rules that check the location of Azure resources fail when a resource or resource group is created in a different region. By default, Azure_AllowedRegions is not configured. The rule Azure.Resource.AllowedRegions is skipped when no allowed locations are configured. Syntax: configuration : Azure_AllowedRegions : array # An array of regions Default: # YAML: The default Azure_AllowedRegions configuration option configuration : Azure_AllowedRegions : [] Example: # YAML: Set the Azure_AllowedRegions configuration option to Australia East, Australia South East configuration : Azure_AllowedRegions : - 'australiaeast' - 'australiasoutheast'","title":"Azure_AllowedRegions"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_minimumcertificatelifetime","text":"This configuration option determines the minimum number of days allowed before certificate expiry. Rules that check certificate lifetime fail when the days remaining before expiry drop below this number. Syntax: configuration : Azure_MinimumCertificateLifetime : integer Default: # YAML: The default Azure_MinimumCertificateLifetime configuration option configuration : Azure_MinimumCertificateLifetime : 30 Example: # YAML: Set the Azure_MinimumCertificateLifetime configuration option to 90 configuration : Azure_MinimumCertificateLifetime : 90","title":"Azure_MinimumCertificateLifetime"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_parameter_file_expansion","text":"This configuration option determines if Azure template parameter files will automatically be expanded. By default, parameter files will not be automatically expanded. Parameter files are expanded when PSRule cmdlets with the -Format File parameter are used. Syntax: configuration : AZURE_PARAMETER_FILE_EXPANSION : bool Default: # YAML: The default AZURE_PARAMETER_FILE_EXPANSION configuration option configuration : AZURE_PARAMETER_FILE_EXPANSION : false Example: # YAML: Set the AZURE_PARAMETER_FILE_EXPANSION configuration option to enable expansion configuration : AZURE_PARAMETER_FILE_EXPANSION : true","title":"AZURE_PARAMETER_FILE_EXPANSION"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_policy_waiver_max_expiry","text":"This configuration option determines the maximum number of days in the future for a waiver policy exemption. Syntax: configuration : AZURE_POLICY_WAIVER_MAX_EXPIRY : integer Default: # YAML: The default AZURE_POLICY_WAIVER_MAX_EXPIRY configuration option configuration : AZURE_POLICY_WAIVER_MAX_EXPIRY : 366 Example: # YAML: Set the AZURE_POLICY_WAIVER_MAX_EXPIRY configuration option to 90 configuration : AZURE_POLICY_WAIVER_MAX_EXPIRY : 90","title":"AZURE_POLICY_WAIVER_MAX_EXPIRY"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_resource_group","text":"This configuration option sets the resource group object used by the resourceGroup() function. Configure this option to change the resource group object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below. This configuration option will be ignored when -ResourceGroup is used with Export-AzRuleTemplateData . Syntax: configuration : AZURE_RESOURCE_GROUP : name : string location : string tags : object properties : provisioningState : string Default: # YAML: The default AZURE_RESOURCE_GROUP configuration option configuration : AZURE_RESOURCE_GROUP : name : 'ps-rule-test-rg' location : 'eastus' tags : { } properties : provisioningState : 'Succeeded' Example: # YAML: Override the location of the resource group object. configuration : AZURE_RESOURCE_GROUP : location : 'australiasoutheast'","title":"AZURE_RESOURCE_GROUP"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_subscription","text":"This configuration option sets the subscription object used by the subscription() function. Configure this option to change the subscription object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below. This configuration option will be ignored when -Subscription is used with Export-AzRuleTemplateData . Syntax: configuration : AZURE_SUBSCRIPTION : subscriptionId : string tenantId : string displayName : string state : string Default: # YAML: The default AZURE_SUBSCRIPTION configuration option configuration : AZURE_SUBSCRIPTION : subscriptionId : 'ffffffff-ffff-ffff-ffff-ffffffffffff' tenantId : 'ffffffff-ffff-ffff-ffff-ffffffffffff' displayName : 'PSRule Test Subscription' state : 'NotDefined' Example: # YAML: Override the display name of the subscription object AZURE_SUBSCRIPTION : displayName : 'My test subscription'","title":"AZURE_SUBSCRIPTION"},{"location":"concepts/about_PSRule_Azure_Metadata_Link/","text":"PSRule_Azure_Metadata_Link # about_PSRule_Azure_Metadata_Link # Describes how Azure Resource Manager (ARM) parameter files reference a template file. Description # Azure Resource Manager (ARM) supports storing additional metadata within parameter files. PSRule uses this metadata to link template and parameter files together to improve unit testing of templates. To reference a template within a parameter file: Set the metadata.template property to the template. Prefix a template file relative to the parameter file with ./ . When ./ is not used, the template with is relative to the -Path parameter. For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"template\" : \"./Resources.Template.json\" }, \"parameters\" : { } } SEE ALSO # Get-AzRuleTemplateLink","title":"PSRule_Azure_Metadata_Link"},{"location":"concepts/about_PSRule_Azure_Metadata_Link/#psrule_azure_metadata_link","text":"","title":"PSRule_Azure_Metadata_Link"},{"location":"concepts/about_PSRule_Azure_Metadata_Link/#about_psrule_azure_metadata_link","text":"Describes how Azure Resource Manager (ARM) parameter files reference a template file.","title":"about_PSRule_Azure_Metadata_Link"},{"location":"concepts/about_PSRule_Azure_Metadata_Link/#description","text":"Azure Resource Manager (ARM) supports storing additional metadata within parameter files. PSRule uses this metadata to link template and parameter files together to improve unit testing of templates. To reference a template within a parameter file: Set the metadata.template property to the template. Prefix a template file relative to the parameter file with ./ . When ./ is not used, the template with is relative to the -Path parameter. For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"template\" : \"./Resources.Template.json\" }, \"parameters\" : { } }","title":"Description"},{"location":"concepts/about_PSRule_Azure_Metadata_Link/#see-also","text":"Get-AzRuleTemplateLink","title":"SEE ALSO"},{"location":"customization/enforce-codeowners/","text":"Enforcing code ownership # With PSRule, you can layer on custom rules with to implement organization specific requirements. These custom rules work side-by-side with PSRule for Azure. Pull requests are a key concept within common Git workflows used with DevOps to enforce peer review. To support peer review across a team tools such as GitHub and Azure DevOps provide code ownership. Code ownership, allows mix discipline teams to direct peer reviews based the path of a changed file. For sensitive changes such as firewall or policy exemptions, peer reviews may form a security control. In these cases, it may be important that specific paths are used for Infrastructure as Code artifacts. Info Code ownership is implemented through CODEOWNERS in GitHub and required reviewers in Azure Repos. Abstract The following scenario shows how to create a custom rule to validate the path of artifacts. The scenario walks you through the process so that you can apply the same concepts for similar requirements. Creating a new rule # Within the .ps-rule sub-directory create a new file called Org.Azure.Rule.ps1 . Use the following snippet to populate the rule file: # Synopsis: Policy exemptions must be stored under designated paths for review. Rule 'Org.Azure.Policy.Path' -Type 'Microsoft.Authorization/policyExemptions' { $Assert . WithinPath ( $PSRule . Source [ 'Parameter' ], '.' , @( 'deployments/policy/' )); } Some key points to call out with the rule snippet include: The name of the rule is Org.Azure.Policy.Path . Each rule name must be unique. The rule applies to resources with the type of Microsoft.Authorization/policyExemptions . i.e. Policy exemptions. The synopsis comment above the rule is read and used as the default recommendation if the rule fails. The rule recommendation appears in output and is intended as an instruction to remediate the failure. The assertion $Assert.WithinPath ensures the specifies path is within the deployments/policy/ sub-directory. The automatic variable $PSRule.Source exposes the source path for the resource. PSRule for Azure exposes a Template and Parameter source for resources originating from a template. Tip For recommendations on naming and storing rules see storing custom rules . Binding type # Rules packaged within PSRule for Azure will automatically detect Policy Exemptions by their type properties. Standalone rules will get their type binding configuration from ps-rule.yaml instead. To configure type binding: Create/ update the ps-rule.yaml file within the root of the repository. Add the following configuration snippet. # Configure binding options binding : targetType : - 'resourceType' - 'type' Some key points to call out include: Configuring the binding for targetType allows rules to use the -Type parameter. Our custom rule uses -Type 'Microsoft.Authorization/policyExemptions' . The binding configuration will use the resourceType property if it exists, alternative it will use type . If neither property exists, PSRule will use the object type. Testing locally # To test the custom rule within Visual Studio Code, see validating locally . Alternatively you can test the rule manually by running the following from a PowerShell terminal. Assert-PSRule -Path '.ps-rule/' -Module 'PSRule.Rules.Azure' -InputPath . -Format File Sample code # Grab the full sample code for each of these files from: Org.Azure.Rule.ps1 ps-rule.yaml policy-exemption.parameters.json template.json","title":"Enforcing code ownership"},{"location":"customization/enforce-codeowners/#enforcing-code-ownership","text":"With PSRule, you can layer on custom rules with to implement organization specific requirements. These custom rules work side-by-side with PSRule for Azure. Pull requests are a key concept within common Git workflows used with DevOps to enforce peer review. To support peer review across a team tools such as GitHub and Azure DevOps provide code ownership. Code ownership, allows mix discipline teams to direct peer reviews based the path of a changed file. For sensitive changes such as firewall or policy exemptions, peer reviews may form a security control. In these cases, it may be important that specific paths are used for Infrastructure as Code artifacts. Info Code ownership is implemented through CODEOWNERS in GitHub and required reviewers in Azure Repos. Abstract The following scenario shows how to create a custom rule to validate the path of artifacts. The scenario walks you through the process so that you can apply the same concepts for similar requirements.","title":"Enforcing code ownership"},{"location":"customization/enforce-codeowners/#creating-a-new-rule","text":"Within the .ps-rule sub-directory create a new file called Org.Azure.Rule.ps1 . Use the following snippet to populate the rule file: # Synopsis: Policy exemptions must be stored under designated paths for review. Rule 'Org.Azure.Policy.Path' -Type 'Microsoft.Authorization/policyExemptions' { $Assert . WithinPath ( $PSRule . Source [ 'Parameter' ], '.' , @( 'deployments/policy/' )); } Some key points to call out with the rule snippet include: The name of the rule is Org.Azure.Policy.Path . Each rule name must be unique. The rule applies to resources with the type of Microsoft.Authorization/policyExemptions . i.e. Policy exemptions. The synopsis comment above the rule is read and used as the default recommendation if the rule fails. The rule recommendation appears in output and is intended as an instruction to remediate the failure. The assertion $Assert.WithinPath ensures the specifies path is within the deployments/policy/ sub-directory. The automatic variable $PSRule.Source exposes the source path for the resource. PSRule for Azure exposes a Template and Parameter source for resources originating from a template. Tip For recommendations on naming and storing rules see storing custom rules .","title":"Creating a new rule"},{"location":"customization/enforce-codeowners/#binding-type","text":"Rules packaged within PSRule for Azure will automatically detect Policy Exemptions by their type properties. Standalone rules will get their type binding configuration from ps-rule.yaml instead. To configure type binding: Create/ update the ps-rule.yaml file within the root of the repository. Add the following configuration snippet. # Configure binding options binding : targetType : - 'resourceType' - 'type' Some key points to call out include: Configuring the binding for targetType allows rules to use the -Type parameter. Our custom rule uses -Type 'Microsoft.Authorization/policyExemptions' . The binding configuration will use the resourceType property if it exists, alternative it will use type . If neither property exists, PSRule will use the object type.","title":"Binding type"},{"location":"customization/enforce-codeowners/#testing-locally","text":"To test the custom rule within Visual Studio Code, see validating locally . Alternatively you can test the rule manually by running the following from a PowerShell terminal. Assert-PSRule -Path '.ps-rule/' -Module 'PSRule.Rules.Azure' -InputPath . -Format File","title":"Testing locally"},{"location":"customization/enforce-codeowners/#sample-code","text":"Grab the full sample code for each of these files from: Org.Azure.Rule.ps1 ps-rule.yaml policy-exemption.parameters.json template.json","title":"Sample code"},{"location":"customization/enforce-custom-tags/","text":"Enforcing custom tags # With PSRule, you can layer on custom rules with to implement organization specific requirements. These custom rules work side-by-side with PSRule for Azure. Use of resource and resource group tags is recommended in the WAF, however implementations may vary. You may want to use PSRule to enforce tagging or something similar early in a DevOps pipeline. Abstract The following scenario shows how to create a custom rule to validate Resource Group tags. The scenario walks you through the process so that you can apply the same concepts for similar requirements. Creating a new rule # Within the .ps-rule sub-directory create a new file called Org.Azure.Rule.ps1 . Use the following snippet to populate the rule file: # Synopsis: Resource Groups must have all mandatory tags defined. Rule 'Org.Azure.RG.Tags' -Type 'Microsoft.Resources/resourceGroups' { $hasTags = $Assert . HasField ( $TargetObject , 'Tags' ) if (! $hasTags . Result ) { return $hasTags } # <Code for custom tags goes here> } Some key points to call out with the rule snippet include: The name of the rule is Org.Azure.RG.Tags . Each rule name must be unique. The rule applies to resources with the type of Microsoft.Resources/resourceGroups . i.e. Resource Groups. The synopsis comment above the rule is read and used as the default recommendation if the rule fails. The rule recommendation appears in output and is intended as an instruction to remediate the failure. The assertion $Assert.HasField ensures that Resource Group has a tags property. The automatic variable $TargetObject automatically exposes the current resource being processed. Tip For recommendations on naming and storing rules see storing custom rules . Adding mandatory tags # To require specific tags to be configured on Resource Groups append this code to the rule. # Require tags be case-sensitive $Assert . HasField ( $TargetObject . tags , 'costCentre' , <# case-sensitive #> $True ) $Assert . HasField ( $TargetObject . tags , 'env' , $True ) Some key points to call out include: The $Assert.HasField assertions are case-sensitive which differs from the previous snippet. A list of supported assertions can be found here . Comments can be added just like normal PowerShell code. Updated Rule The updated rule should look like: # Synopsis: Resource Groups must have all mandatory tags defined. Rule 'Org.Azure.RG.Tags' -Type 'Microsoft.Resources/resourceGroups' { $hasTags = $Assert . HasField ( $TargetObject , 'Tags' ) if (! $hasTags . Result ) { return $hasTags } # Require tags be case-sensitive $Assert . HasField ( $TargetObject . tags , 'costCentre' , <# case-sensitive #> $True ) $Assert . HasField ( $TargetObject . tags , 'env' , $True ) } Limiting tags values # To require these tags to only accept allowed values, append this code to the rule. <# The costCentre tag must: - Start with a letter. - Be followed by a number between 10000-9999999999. #> $Assert . Match ( $TargetObject , 'tags.costCentre' , '^([A-Z][1-9][0-9]{4,9})$' , $True ) # Require specific values for environment tag $Assert . In ( $TargetObject , 'tags.env' , @( 'dev' , 'prod' , 'uat' ), $True ) Some key points to call out include: Each of these assertions for the field value are case-sensitive. Assertions can automatically traverse fields be using the dotted syntax. i.e. tags.costCentre . Completed rule The completed rule should look like: # Synopsis: Resource Groups must have all mandatory tags defined. Rule 'Org.Azure.RG.Tags' -Type 'Microsoft.Resources/resourceGroups' { $hasTags = $Assert . HasField ( $TargetObject , 'Tags' ) if (! $hasTags . Result ) { return $hasTags } # Require tags be case-sensitive. $Assert . HasField ( $TargetObject . tags , 'costCentre' , <# case-sensitive #> $True ) $Assert . HasField ( $TargetObject . tags , 'env' , $True ) <# The costCentre tag must: - Start with a letter. - Be followed by a number between 10000-9999999999. #> $Assert . Match ( $TargetObject , 'tags.costCentre' , '^([A-Z][1-9][0-9]{4,9})$' , $True ) # Require specific values for environment tag. $Assert . In ( $TargetObject , 'tags.env' , @( 'dev' , 'prod' , 'uat' ), $True ) } Binding type # Rules packaged within PSRule for Azure will automatically detect Resource Groups by their type properties. Standalone rules will get their type binding configuration from ps-rule.yaml instead. To configure type binding: Create/ update the ps-rule.yaml file within the root of the repository. Add the following configuration snippet. # Configure binding options binding : targetType : - 'resourceType' - 'type' Some key points to call out include: Configuring the binding for targetType allows rules to use the -Type parameter. Our custom rule uses -Type 'Microsoft.Resources/resourceGroups' . The binding configuration will use the resourceType property if it exists, alternative it will use type . If neither property exists, PSRule will use the object type. Testing locally # To test the custom rule within Visual Studio Code, see validating locally . Alternatively you can test the rule manually by running the following from a PowerShell terminal. Assert-PSRule -Path '.ps-rule/' -Module 'PSRule.Rules.Azure' -InputPath . -Format File Sample code # Grab the full sample code for each of these files from: Org.Azure.Rule.ps1 ps-rule.yaml","title":"Enforcing custom tags"},{"location":"customization/enforce-custom-tags/#enforcing-custom-tags","text":"With PSRule, you can layer on custom rules with to implement organization specific requirements. These custom rules work side-by-side with PSRule for Azure. Use of resource and resource group tags is recommended in the WAF, however implementations may vary. You may want to use PSRule to enforce tagging or something similar early in a DevOps pipeline. Abstract The following scenario shows how to create a custom rule to validate Resource Group tags. The scenario walks you through the process so that you can apply the same concepts for similar requirements.","title":"Enforcing custom tags"},{"location":"customization/enforce-custom-tags/#creating-a-new-rule","text":"Within the .ps-rule sub-directory create a new file called Org.Azure.Rule.ps1 . Use the following snippet to populate the rule file: # Synopsis: Resource Groups must have all mandatory tags defined. Rule 'Org.Azure.RG.Tags' -Type 'Microsoft.Resources/resourceGroups' { $hasTags = $Assert . HasField ( $TargetObject , 'Tags' ) if (! $hasTags . Result ) { return $hasTags } # <Code for custom tags goes here> } Some key points to call out with the rule snippet include: The name of the rule is Org.Azure.RG.Tags . Each rule name must be unique. The rule applies to resources with the type of Microsoft.Resources/resourceGroups . i.e. Resource Groups. The synopsis comment above the rule is read and used as the default recommendation if the rule fails. The rule recommendation appears in output and is intended as an instruction to remediate the failure. The assertion $Assert.HasField ensures that Resource Group has a tags property. The automatic variable $TargetObject automatically exposes the current resource being processed. Tip For recommendations on naming and storing rules see storing custom rules .","title":"Creating a new rule"},{"location":"customization/enforce-custom-tags/#adding-mandatory-tags","text":"To require specific tags to be configured on Resource Groups append this code to the rule. # Require tags be case-sensitive $Assert . HasField ( $TargetObject . tags , 'costCentre' , <# case-sensitive #> $True ) $Assert . HasField ( $TargetObject . tags , 'env' , $True ) Some key points to call out include: The $Assert.HasField assertions are case-sensitive which differs from the previous snippet. A list of supported assertions can be found here . Comments can be added just like normal PowerShell code. Updated Rule The updated rule should look like: # Synopsis: Resource Groups must have all mandatory tags defined. Rule 'Org.Azure.RG.Tags' -Type 'Microsoft.Resources/resourceGroups' { $hasTags = $Assert . HasField ( $TargetObject , 'Tags' ) if (! $hasTags . Result ) { return $hasTags } # Require tags be case-sensitive $Assert . HasField ( $TargetObject . tags , 'costCentre' , <# case-sensitive #> $True ) $Assert . HasField ( $TargetObject . tags , 'env' , $True ) }","title":"Adding mandatory tags"},{"location":"customization/enforce-custom-tags/#limiting-tags-values","text":"To require these tags to only accept allowed values, append this code to the rule. <# The costCentre tag must: - Start with a letter. - Be followed by a number between 10000-9999999999. #> $Assert . Match ( $TargetObject , 'tags.costCentre' , '^([A-Z][1-9][0-9]{4,9})$' , $True ) # Require specific values for environment tag $Assert . In ( $TargetObject , 'tags.env' , @( 'dev' , 'prod' , 'uat' ), $True ) Some key points to call out include: Each of these assertions for the field value are case-sensitive. Assertions can automatically traverse fields be using the dotted syntax. i.e. tags.costCentre . Completed rule The completed rule should look like: # Synopsis: Resource Groups must have all mandatory tags defined. Rule 'Org.Azure.RG.Tags' -Type 'Microsoft.Resources/resourceGroups' { $hasTags = $Assert . HasField ( $TargetObject , 'Tags' ) if (! $hasTags . Result ) { return $hasTags } # Require tags be case-sensitive. $Assert . HasField ( $TargetObject . tags , 'costCentre' , <# case-sensitive #> $True ) $Assert . HasField ( $TargetObject . tags , 'env' , $True ) <# The costCentre tag must: - Start with a letter. - Be followed by a number between 10000-9999999999. #> $Assert . Match ( $TargetObject , 'tags.costCentre' , '^([A-Z][1-9][0-9]{4,9})$' , $True ) # Require specific values for environment tag. $Assert . In ( $TargetObject , 'tags.env' , @( 'dev' , 'prod' , 'uat' ), $True ) }","title":"Limiting tags values"},{"location":"customization/enforce-custom-tags/#binding-type","text":"Rules packaged within PSRule for Azure will automatically detect Resource Groups by their type properties. Standalone rules will get their type binding configuration from ps-rule.yaml instead. To configure type binding: Create/ update the ps-rule.yaml file within the root of the repository. Add the following configuration snippet. # Configure binding options binding : targetType : - 'resourceType' - 'type' Some key points to call out include: Configuring the binding for targetType allows rules to use the -Type parameter. Our custom rule uses -Type 'Microsoft.Resources/resourceGroups' . The binding configuration will use the resourceType property if it exists, alternative it will use type . If neither property exists, PSRule will use the object type.","title":"Binding type"},{"location":"customization/enforce-custom-tags/#testing-locally","text":"To test the custom rule within Visual Studio Code, see validating locally . Alternatively you can test the rule manually by running the following from a PowerShell terminal. Assert-PSRule -Path '.ps-rule/' -Module 'PSRule.Rules.Azure' -InputPath . -Format File","title":"Testing locally"},{"location":"customization/enforce-custom-tags/#sample-code","text":"Grab the full sample code for each of these files from: Org.Azure.Rule.ps1 ps-rule.yaml","title":"Sample code"},{"location":"customization/storing-custom-rules/","text":"Storing custom rules # PSRule for Azure covers common use cases that align to the Microsoft Azure Well-Architected Framework (WAF) . In addition to WAF alignment you may have a requirement to enforce organization specific rules. For example: Required tags on a resource group. Code ownership for sensitive resource types. PSRule allows custom rules to be layered on. These custom rules work side-by-side with PSRule for Azure. Using a standard file path # Rules can be standalone or packaged within a module. Standalone rules are ideal for a single project such as an Infrastructure as Code (IaC) repository. To reuse rules across multiple projects consider packaging these as a module. The instructions for packaging rules in a module can be found here: Packaging rules in a module To store standalone rules we recommend that you: Use .ps-rule/ \u2014 Create a sub-directory called .ps-rule in the root of your repository. Use all lower-case in the sub-directory name. Put any custom rules within this sub-directory. Use files ending with .Rule.ps1 \u2014 PSRule uses a file naming convention to discover rules. We recommend using a file name that ends in .Rule.ps1 . Note Build pipelines are often case-sensitive or run on Linux-based systems. Using the casing rule above reduces confusion latter when you configure continuous integration (CI). Naming rules # When running PSRule, rule names must be unique. PSRule for Azure uses the name prefix of Azure. on all rules and resources included in the module. Example The following names are examples of rules included within PSRule for Azure: Azure.AKS.Version Azure.AKS.AuthorizedIPs Azure.SQL.MinTLS When naming custom rules we recommend that you: Use a standard prefix \u2014 You can use the Local. or Org. prefix for standalone rules. Alternatively choose a short prefix that identifies your organization. Use dotted notation \u2014 Use dots to separate rule name. Use a maximum length of 35 characters \u2014 The default view of Invoke-PSRule truncates longer names. PSRule supports longer rule names however if Invoke-PSRule is called directly consider using Format-List .","title":"Storing custom rules"},{"location":"customization/storing-custom-rules/#storing-custom-rules","text":"PSRule for Azure covers common use cases that align to the Microsoft Azure Well-Architected Framework (WAF) . In addition to WAF alignment you may have a requirement to enforce organization specific rules. For example: Required tags on a resource group. Code ownership for sensitive resource types. PSRule allows custom rules to be layered on. These custom rules work side-by-side with PSRule for Azure.","title":"Storing custom rules"},{"location":"customization/storing-custom-rules/#using-a-standard-file-path","text":"Rules can be standalone or packaged within a module. Standalone rules are ideal for a single project such as an Infrastructure as Code (IaC) repository. To reuse rules across multiple projects consider packaging these as a module. The instructions for packaging rules in a module can be found here: Packaging rules in a module To store standalone rules we recommend that you: Use .ps-rule/ \u2014 Create a sub-directory called .ps-rule in the root of your repository. Use all lower-case in the sub-directory name. Put any custom rules within this sub-directory. Use files ending with .Rule.ps1 \u2014 PSRule uses a file naming convention to discover rules. We recommend using a file name that ends in .Rule.ps1 . Note Build pipelines are often case-sensitive or run on Linux-based systems. Using the casing rule above reduces confusion latter when you configure continuous integration (CI).","title":"Using a standard file path"},{"location":"customization/storing-custom-rules/#naming-rules","text":"When running PSRule, rule names must be unique. PSRule for Azure uses the name prefix of Azure. on all rules and resources included in the module. Example The following names are examples of rules included within PSRule for Azure: Azure.AKS.Version Azure.AKS.AuthorizedIPs Azure.SQL.MinTLS When naming custom rules we recommend that you: Use a standard prefix \u2014 You can use the Local. or Org. prefix for standalone rules. Alternatively choose a short prefix that identifies your organization. Use dotted notation \u2014 Use dots to separate rule name. Use a maximum length of 35 characters \u2014 The default view of Invoke-PSRule truncates longer names. PSRule supports longer rule names however if Invoke-PSRule is called directly consider using Format-List .","title":"Naming rules"},{"location":"en/baselines/Azure.All/","text":"Azure.All # Includes all Azure rules. Rules # The following rules are included within Azure.All . This baseline includes a total of 286 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PodIdentity Configure AKS clusters to use AAD pod identities to access Azure resources securely. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled to ensure availability of control plane components for production workloads. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.Cognitive.DisableLocalAuth Authenticate requests to Cognitive Services with Azure AD identities. Important Azure.Cognitive.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Cognitive.PrivateEndpoints Use Private Endpoints to access Cognitive Services accounts. Important Azure.Cognitive.PublicAccess Restrict access of Cognitive Services accounts to authorized virtual networks. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Deployment.AdminUsername The adminUsername or administratorUsername property should not be a string literal in nested templates. Awareness Azure.Deployment.OutputSecretValue Avoid outputting sensitive deployment values. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Azure AD identities. Important Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Azure AD identities. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important","title":"Azure.All"},{"location":"en/baselines/Azure.All/#azureall","text":"Includes all Azure rules.","title":"Azure.All"},{"location":"en/baselines/Azure.All/#rules","text":"The following rules are included within Azure.All . This baseline includes a total of 286 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PodIdentity Configure AKS clusters to use AAD pod identities to access Azure resources securely. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled to ensure availability of control plane components for production workloads. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.Cognitive.DisableLocalAuth Authenticate requests to Cognitive Services with Azure AD identities. Important Azure.Cognitive.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Cognitive.PrivateEndpoints Use Private Endpoints to access Cognitive Services accounts. Important Azure.Cognitive.PublicAccess Restrict access of Cognitive Services accounts to authorized virtual networks. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Deployment.AdminUsername The adminUsername or administratorUsername property should not be a string literal in nested templates. Awareness Azure.Deployment.OutputSecretValue Avoid outputting sensitive deployment values. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Azure AD identities. Important Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Azure AD identities. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important","title":"Rules"},{"location":"en/baselines/Azure.Default/","text":"Azure.Default # Default baseline for Azure rules. Rules # The following rules are included within Azure.Default . This baseline includes a total of 279 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled to ensure availability of control plane components for production workloads. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.Cognitive.DisableLocalAuth Authenticate requests to Cognitive Services with Azure AD identities. Important Azure.Cognitive.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Cognitive.PrivateEndpoints Use Private Endpoints to access Cognitive Services accounts. Important Azure.Cognitive.PublicAccess Restrict access of Cognitive Services accounts to authorized virtual networks. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Deployment.AdminUsername The adminUsername or administratorUsername property should not be a string literal in nested templates. Awareness Azure.Deployment.OutputSecretValue Avoid outputting sensitive deployment values. Critical Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Azure AD identities. Important Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Azure AD identities. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important","title":"Azure.Default"},{"location":"en/baselines/Azure.Default/#azuredefault","text":"Default baseline for Azure rules.","title":"Azure.Default"},{"location":"en/baselines/Azure.Default/#rules","text":"The following rules are included within Azure.Default . This baseline includes a total of 279 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled to ensure availability of control plane components for production workloads. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.Cognitive.DisableLocalAuth Authenticate requests to Cognitive Services with Azure AD identities. Important Azure.Cognitive.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Cognitive.PrivateEndpoints Use Private Endpoints to access Cognitive Services accounts. Important Azure.Cognitive.PublicAccess Restrict access of Cognitive Services accounts to authorized virtual networks. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Deployment.AdminUsername The adminUsername or administratorUsername property should not be a string literal in nested templates. Awareness Azure.Deployment.OutputSecretValue Avoid outputting sensitive deployment values. Critical Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Azure AD identities. Important Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Azure AD identities. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important","title":"Rules"},{"location":"en/baselines/Azure.GA_2020_06/","text":"Azure.GA_2020_06 # Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released June 2020 or prior for Azure GA features. Rules # The following rules are included within Azure.GA_2020_06 . This baseline includes a total of 138 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important","title":"Azure.GA_2020_06"},{"location":"en/baselines/Azure.GA_2020_06/#azurega_2020_06","text":"Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released June 2020 or prior for Azure GA features.","title":"Azure.GA_2020_06"},{"location":"en/baselines/Azure.GA_2020_06/#rules","text":"The following rules are included within Azure.GA_2020_06 . This baseline includes a total of 138 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important","title":"Rules"},{"location":"en/baselines/Azure.GA_2020_09/","text":"Azure.GA_2020_09 # Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released September 2020 or prior for Azure GA features. Rules # The following rules are included within Azure.GA_2020_09 . This baseline includes a total of 154 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important","title":"Azure.GA_2020_09"},{"location":"en/baselines/Azure.GA_2020_09/#azurega_2020_09","text":"Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released September 2020 or prior for Azure GA features.","title":"Azure.GA_2020_09"},{"location":"en/baselines/Azure.GA_2020_09/#rules","text":"The following rules are included within Azure.GA_2020_09 . This baseline includes a total of 154 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important","title":"Rules"},{"location":"en/baselines/Azure.GA_2020_12/","text":"Azure.GA_2020_12 # Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released December 2020 or prior for Azure GA features. Rules # The following rules are included within Azure.GA_2020_12 . This baseline includes a total of 178 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important","title":"Azure.GA_2020_12"},{"location":"en/baselines/Azure.GA_2020_12/#azurega_2020_12","text":"Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released December 2020 or prior for Azure GA features.","title":"Azure.GA_2020_12"},{"location":"en/baselines/Azure.GA_2020_12/#rules","text":"The following rules are included within Azure.GA_2020_12 . This baseline includes a total of 178 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important","title":"Rules"},{"location":"en/baselines/Azure.GA_2021_03/","text":"Azure.GA_2021_03 # Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released March 2021 or prior for Azure GA features. Rules # The following rules are included within Azure.GA_2021_03 . This baseline includes a total of 193 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important","title":"Azure.GA_2021_03"},{"location":"en/baselines/Azure.GA_2021_03/#azurega_2021_03","text":"Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released March 2021 or prior for Azure GA features.","title":"Azure.GA_2021_03"},{"location":"en/baselines/Azure.GA_2021_03/#rules","text":"The following rules are included within Azure.GA_2021_03 . This baseline includes a total of 193 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important","title":"Rules"},{"location":"en/baselines/Azure.GA_2021_06/","text":"Azure.GA_2021_06 # Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released June 2021 or prior for Azure GA features. Rules # The following rules are included within Azure.GA_2021_06 . This baseline includes a total of 207 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important","title":"Azure.GA_2021_06"},{"location":"en/baselines/Azure.GA_2021_06/#azurega_2021_06","text":"Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released June 2021 or prior for Azure GA features.","title":"Azure.GA_2021_06"},{"location":"en/baselines/Azure.GA_2021_06/#rules","text":"The following rules are included within Azure.GA_2021_06 . This baseline includes a total of 207 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important","title":"Rules"},{"location":"en/baselines/Azure.GA_2021_09/","text":"Azure.GA_2021_09 # Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released September 2021 or prior for Azure GA features. Rules # The following rules are included within Azure.GA_2021_09 . This baseline includes a total of 226 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important","title":"Azure.GA_2021_09"},{"location":"en/baselines/Azure.GA_2021_09/#azurega_2021_09","text":"Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released September 2021 or prior for Azure GA features.","title":"Azure.GA_2021_09"},{"location":"en/baselines/Azure.GA_2021_09/#rules","text":"The following rules are included within Azure.GA_2021_09 . This baseline includes a total of 226 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important","title":"Rules"},{"location":"en/baselines/Azure.GA_2021_12/","text":"Azure.GA_2021_12 # Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released December 2021 or prior for Azure GA features. Rules # The following rules are included within Azure.GA_2021_12 . This baseline includes a total of 252 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness","title":"Azure.GA_2021_12"},{"location":"en/baselines/Azure.GA_2021_12/#azurega_2021_12","text":"Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released December 2021 or prior for Azure GA features.","title":"Azure.GA_2021_12"},{"location":"en/baselines/Azure.GA_2021_12/#rules","text":"The following rules are included within Azure.GA_2021_12 . This baseline includes a total of 252 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness","title":"Rules"},{"location":"en/baselines/Azure.GA_2022_03/","text":"Azure.GA_2022_03 # Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released March 2022 or prior for Azure GA features. Rules # The following rules are included within Azure.GA_2022_03 . This baseline includes a total of 268 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Azure AD identities. Important Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Azure AD identities. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important","title":"Azure.GA_2022_03"},{"location":"en/baselines/Azure.GA_2022_03/#azurega_2022_03","text":"Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released March 2022 or prior for Azure GA features.","title":"Azure.GA_2022_03"},{"location":"en/baselines/Azure.GA_2022_03/#rules","text":"The following rules are included within Azure.GA_2022_03 . This baseline includes a total of 268 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Azure AD identities. Important Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Azure AD identities. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important","title":"Rules"},{"location":"en/baselines/Azure.GA_2022_06/","text":"Azure.GA_2022_06 # Include rules released June 2022 or prior for Azure GA features. Rules # The following rules are included within Azure.GA_2022_06 . This baseline includes a total of 272 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Deployment.OutputSecretValue Avoid outputting sensitive deployment values. Critical Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Azure AD identities. Important Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Azure AD identities. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important","title":"Azure.GA_2022_06"},{"location":"en/baselines/Azure.GA_2022_06/#azurega_2022_06","text":"Include rules released June 2022 or prior for Azure GA features.","title":"Azure.GA_2022_06"},{"location":"en/baselines/Azure.GA_2022_06/#rules","text":"The following rules are included within Azure.GA_2022_06 . This baseline includes a total of 272 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Deployment.OutputSecretValue Avoid outputting sensitive deployment values. Critical Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Azure AD identities. Important Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Azure AD identities. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important","title":"Rules"},{"location":"en/baselines/Azure.Preview/","text":"Azure.Preview # Includes rules for Azure GA and preview features. Rules # The following rules are included within Azure.Preview . This baseline includes a total of 286 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PodIdentity Configure AKS clusters to use AAD pod identities to access Azure resources securely. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled to ensure availability of control plane components for production workloads. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.Cognitive.DisableLocalAuth Authenticate requests to Cognitive Services with Azure AD identities. Important Azure.Cognitive.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Cognitive.PrivateEndpoints Use Private Endpoints to access Cognitive Services accounts. Important Azure.Cognitive.PublicAccess Restrict access of Cognitive Services accounts to authorized virtual networks. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Deployment.AdminUsername The adminUsername or administratorUsername property should not be a string literal in nested templates. Awareness Azure.Deployment.OutputSecretValue Avoid outputting sensitive deployment values. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Azure AD identities. Important Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Azure AD identities. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important","title":"Azure.Preview"},{"location":"en/baselines/Azure.Preview/#azurepreview","text":"Includes rules for Azure GA and preview features.","title":"Azure.Preview"},{"location":"en/baselines/Azure.Preview/#rules","text":"The following rules are included within Azure.Preview . This baseline includes a total of 286 rules. Name Synopsis Severity Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PodIdentity Configure AKS clusters to use AAD pod identities to access Azure resources securely. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled to ensure availability of control plane components for production workloads. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers. Important Azure.APIM.EncryptValues API Management named values should be encrypted. Important Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Enforce HTTPS for client connections. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.Cognitive.DisableLocalAuth Authenticate requests to Cognitive Services with Azure AD identities. Important Azure.Cognitive.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Cognitive.PrivateEndpoints Use Private Endpoints to access Cognitive Services accounts. Important Azure.Cognitive.PublicAccess Restrict access of Cognitive Services accounts to authorized virtual networks. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Deployment.AdminUsername The adminUsername or administratorUsername property should not be a string literal in nested templates. Awareness Azure.Deployment.OutputSecretValue Avoid outputting sensitive deployment values. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Azure AD identities. Important Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Azure AD identities. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important","title":"Rules"},{"location":"en/baselines/Azure.Preview_2021_09/","text":"Azure.Preview_2021_09 # Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released September 2021 or prior for Azure preview only features. Rules # The following rules are included within Azure.Preview_2021_09 . This baseline includes a total of 3 rules. Name Synopsis Severity Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important","title":"Azure.Preview_2021_09"},{"location":"en/baselines/Azure.Preview_2021_09/#azurepreview_2021_09","text":"Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released September 2021 or prior for Azure preview only features.","title":"Azure.Preview_2021_09"},{"location":"en/baselines/Azure.Preview_2021_09/#rules","text":"The following rules are included within Azure.Preview_2021_09 . This baseline includes a total of 3 rules. Name Synopsis Severity Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important","title":"Rules"},{"location":"en/baselines/Azure.Preview_2021_12/","text":"Azure.Preview_2021_12 # Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released December 2021 or prior for Azure preview only features. Rules # The following rules are included within Azure.Preview_2021_12 . This baseline includes a total of 5 rules. Name Synopsis Severity Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.PodIdentity Configure AKS clusters to use AAD pod identities to access Azure resources securely. Important Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important","title":"Azure.Preview_2021_12"},{"location":"en/baselines/Azure.Preview_2021_12/#azurepreview_2021_12","text":"Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released December 2021 or prior for Azure preview only features.","title":"Azure.Preview_2021_12"},{"location":"en/baselines/Azure.Preview_2021_12/#rules","text":"The following rules are included within Azure.Preview_2021_12 . This baseline includes a total of 5 rules. Name Synopsis Severity Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.PodIdentity Configure AKS clusters to use AAD pod identities to access Azure resources securely. Important Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important","title":"Rules"},{"location":"en/baselines/Azure.Preview_2022_03/","text":"Azure.Preview_2022_03 # Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released March 2022 or prior for Azure preview only features. Rules # The following rules are included within Azure.Preview_2022_03 . This baseline includes a total of 7 rules. Name Synopsis Severity Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.PodIdentity Configure AKS clusters to use AAD pod identities to access Azure resources securely. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important","title":"Azure.Preview_2022_03"},{"location":"en/baselines/Azure.Preview_2022_03/#azurepreview_2022_03","text":"Warning The baseline is obsolete. Consider switching to a newer baseline. Include rules released March 2022 or prior for Azure preview only features.","title":"Azure.Preview_2022_03"},{"location":"en/baselines/Azure.Preview_2022_03/#rules","text":"The following rules are included within Azure.Preview_2022_03 . This baseline includes a total of 7 rules. Name Synopsis Severity Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.PodIdentity Configure AKS clusters to use AAD pod identities to access Azure resources securely. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important","title":"Rules"},{"location":"en/baselines/Azure.Preview_2022_06/","text":"Azure.Preview_2022_06 # Include rules released June 2022 or prior for Azure preview only features. Rules # The following rules are included within Azure.Preview_2022_06 . This baseline includes a total of 7 rules. Name Synopsis Severity Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.PodIdentity Configure AKS clusters to use AAD pod identities to access Azure resources securely. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important","title":"Azure.Preview_2022_06"},{"location":"en/baselines/Azure.Preview_2022_06/#azurepreview_2022_06","text":"Include rules released June 2022 or prior for Azure preview only features.","title":"Azure.Preview_2022_06"},{"location":"en/baselines/Azure.Preview_2022_06/#rules","text":"The following rules are included within Azure.Preview_2022_06 . This baseline includes a total of 7 rules. Name Synopsis Severity Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.PodIdentity Configure AKS clusters to use AAD pod identities to access Azure resources securely. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important","title":"Rules"},{"location":"en/rules/","text":"Reference # The following rules and features are included in PSRule for Azure. Info The rule release indicates if the Azure feature is generally available ( GA ) or available under preview . Features provided under previews may have additional limits, availablity restrictions, or terms . By default, PSRule for Azure will not provide recommendations that relate to preview features. To include rules for preview features see working with baselines . Rules # The following rules are included in PSRule for Azure. Reference Name Synopsis Release AZR-000001 Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. GA AZR-000002 Azure.ACR.ContainerScan Enable vulnerability scanning for container images. GA AZR-000003 Azure.ACR.ImageHealth Remove container images with known vulnerabilities. GA AZR-000004 Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. GA AZR-000005 Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. GA AZR-000006 Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. GA AZR-000007 Azure.ACR.Name Container registry names should meet naming requirements. GA AZR-000008 Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Preview AZR-000009 Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. GA AZR-000010 Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Preview AZR-000011 Azure.ADX.Usage Regularly remove unused resources to reduce costs. GA AZR-000012 Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. GA AZR-000013 Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. GA AZR-000014 Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. GA AZR-000015 Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. GA AZR-000016 Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. GA AZR-000017 Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. GA AZR-000018 Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. GA AZR-000019 Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. GA AZR-000020 Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. GA AZR-000021 Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. GA AZR-000022 Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. GA AZR-000023 Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. GA AZR-000024 Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. GA AZR-000025 Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. GA AZR-000026 Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. GA AZR-000027 Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. GA AZR-000028 Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. GA AZR-000029 Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. GA AZR-000030 Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. GA AZR-000031 Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Preview AZR-000032 Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. GA AZR-000033 Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. GA AZR-000034 Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. GA AZR-000035 Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. GA AZR-000036 Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. GA AZR-000037 Azure.AKS.PodIdentity Configure AKS clusters to use AAD pod identities to access Azure resources securely. Preview AZR-000038 Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. GA AZR-000039 Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. GA AZR-000040 Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. GA AZR-000041 Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. GA AZR-000042 Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. GA AZR-000043 Azure.APIM.APIDescriptors API Management APIs should have a display name and description. GA AZR-000044 Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. GA AZR-000045 Azure.APIM.EncryptValues API Management named values should be encrypted. GA AZR-000046 Azure.APIM.ProductSubscription Configure products to require a subscription. GA AZR-000047 Azure.APIM.ProductApproval Configure products to require approval. GA AZR-000048 Azure.APIM.SampleProducts Remove starter and unlimited sample products. GA AZR-000049 Azure.APIM.ProductDescriptors API Management products should have a display name and description. GA AZR-000050 Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. GA AZR-000051 Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. GA AZR-000052 Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. GA AZR-000053 Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. GA AZR-000054 Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. GA AZR-000055 Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers. GA AZR-000056 Azure.APIM.Name API Management service names should meet naming requirements. GA AZR-000057 Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. GA AZR-000058 Azure.AppConfig.Name App Configuration store names should meet naming requirements. GA AZR-000059 Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. GA AZR-000060 Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. GA AZR-000061 Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. GA AZR-000062 Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. GA AZR-000063 Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. GA AZR-000064 Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. GA AZR-000065 Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. GA AZR-000066 Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. GA AZR-000067 Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. GA AZR-000068 Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. GA AZR-000069 Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. GA AZR-000070 Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. GA AZR-000071 Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. GA AZR-000072 Azure.AppService.MinPlan Use at least a Standard App Service Plan. GA AZR-000073 Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. GA AZR-000074 Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. GA AZR-000075 Azure.AppService.NETVersion Configure applications to use newer .NET versions. GA AZR-000076 Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. GA AZR-000077 Azure.AppService.AlwaysOn Configure Always On for App Service apps. GA AZR-000078 Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. GA AZR-000079 Azure.AppService.WebProbe Configure and enable instance health probes. GA AZR-000080 Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. GA AZR-000081 Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. GA AZR-000082 Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. GA AZR-000083 Azure.AppService.ARRAffinity Disable client affinity for stateless services. GA AZR-000084 Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. GA AZR-000085 Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. GA AZR-000086 Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. GA AZR-000087 Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). GA AZR-000088 Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. GA AZR-000089 Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. GA AZR-000090 Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. GA AZR-000091 Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. GA AZR-000092 Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. GA AZR-000093 Azure.CDN.HTTP Enforce HTTPS for client connections. GA AZR-000094 Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Preview AZR-000095 Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. GA AZR-000096 Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. GA AZR-000097 Azure.DataFactory.Version Consider migrating to DataFactory v2. GA AZR-000098 Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. GA AZR-000099 Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. GA AZR-000100 Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Preview AZR-000101 Azure.EventHub.Usage Regularly remove unused resources to reduce costs. GA AZR-000102 Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Azure AD identities. GA AZR-000103 Azure.Firewall.Name Firewall names should meet naming requirements. GA AZR-000104 Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. GA AZR-000105 Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. GA AZR-000106 Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. GA AZR-000107 Azure.FrontDoor.Logs Audit and monitor access through Front Door. GA AZR-000108 Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. GA AZR-000109 Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. GA AZR-000110 Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. GA AZR-000111 Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. GA AZR-000112 Azure.FrontDoor.State Enable Azure Front Door instance. GA AZR-000113 Azure.FrontDoor.Name Front Door names should meet naming requirements. GA AZR-000114 Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. GA AZR-000115 Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. GA AZR-000116 Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. GA AZR-000117 Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. GA AZR-000118 Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. GA AZR-000119 Azure.KeyVault.Logs Audit and monitor access to Key Vault data. GA AZR-000120 Azure.KeyVault.Name Key Vault names should meet naming requirements. GA AZR-000121 Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. GA AZR-000122 Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. GA AZR-000123 Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Preview AZR-000124 Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. GA AZR-000125 Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. GA AZR-000126 Azure.LB.Probe Use a specific probe for web protocols. GA AZR-000127 Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. GA AZR-000128 Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. GA AZR-000129 Azure.LB.Name Load Balancer names should meet naming requirements. GA AZR-000130 Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. GA AZR-000131 Azure.MySQL.UseSSL Enforce encrypted MySQL connections. GA AZR-000132 Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. GA AZR-000133 Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. GA AZR-000134 Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. GA AZR-000135 Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. GA AZR-000136 Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. GA AZR-000137 Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. GA AZR-000138 Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. GA AZR-000139 Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. GA AZR-000140 Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. GA AZR-000141 Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. GA AZR-000142 Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. GA AZR-000143 Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. GA AZR-000144 Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. GA AZR-000145 Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. GA AZR-000146 Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. GA AZR-000147 Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. GA AZR-000148 Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. GA AZR-000149 Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. GA AZR-000150 Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. GA AZR-000151 Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. GA AZR-000152 Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. GA AZR-000153 Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. GA AZR-000154 Azure.PublicIP.IsAttached Public IP address should be attached or removed. GA AZR-000155 Azure.PublicIP.Name Public IP names should meet naming requirements. GA AZR-000156 Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. GA AZR-000157 Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. GA AZR-000158 Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. GA AZR-000159 Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. GA AZR-000160 Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. GA AZR-000161 Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. GA AZR-000162 Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. GA AZR-000163 Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. GA AZR-000164 Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. GA AZR-000165 Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. GA AZR-000166 Azure.Resource.UseTags Azure resources should be tagged using a standard convention. GA AZR-000167 Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. GA AZR-000168 Azure.ResourceGroup.Name Resource Group names should meet naming requirements. GA AZR-000169 Azure.Route.Name Route table names should meet naming requirements. GA AZR-000170 Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. GA AZR-000171 Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. GA AZR-000172 Azure.Search.SKU Use the basic and standard tiers for entry level workloads. GA AZR-000173 Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. GA AZR-000174 Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. GA AZR-000175 Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. GA AZR-000176 Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. GA AZR-000177 Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. GA AZR-000178 Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Azure AD identities. GA AZR-000179 Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. GA AZR-000180 Azure.SignalR.Name SignalR service instance names should meet naming requirements. GA AZR-000181 Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. GA AZR-000182 Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. GA AZR-000183 Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. GA AZR-000184 Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. GA AZR-000185 Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. GA AZR-000186 Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. GA AZR-000187 Azure.SQL.Auditing Enable auditing for Azure SQL logical server. GA AZR-000188 Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. GA AZR-000189 Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. GA AZR-000190 Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. GA AZR-000191 Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. GA AZR-000192 Azure.SQL.DBName Azure SQL Database names should meet naming requirements. GA AZR-000193 Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. GA AZR-000194 Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. GA AZR-000195 Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. GA AZR-000196 Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. GA AZR-000197 Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. GA AZR-000198 Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. GA AZR-000199 Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. GA AZR-000200 Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. GA AZR-000201 Azure.Storage.Name Storage Account names should meet naming requirements. GA AZR-000202 Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. GA AZR-000203 Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. GA AZR-000204 Azure.RBAC.LimitOwner Limit the number of subscription Owners. GA AZR-000205 Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. GA AZR-000206 Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). GA AZR-000207 Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. GA AZR-000208 Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. GA AZR-000209 Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. GA AZR-000210 Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. GA AZR-000211 Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. GA AZR-000212 Azure.Template.TemplateFile Use ARM template files that are valid. GA AZR-000213 Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. GA AZR-000214 Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. GA AZR-000215 Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. GA AZR-000216 Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. GA AZR-000217 Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. GA AZR-000218 Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. GA AZR-000219 Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. GA AZR-000220 Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. GA AZR-000221 Azure.Template.LocationType Location parameters should use a string value. GA AZR-000222 Azure.Template.ResourceLocation Template resource location should be an expression or global. GA AZR-000223 Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. GA AZR-000224 Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. GA AZR-000225 Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. GA AZR-000226 Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. GA AZR-000227 Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. GA AZR-000228 Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. GA AZR-000229 Azure.Template.ParameterFile Use ARM template parameter files that are valid. GA AZR-000230 Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. GA AZR-000231 Azure.Template.MetadataLink Configure a metadata link for each parameter file. GA AZR-000232 Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. GA AZR-000233 Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. GA AZR-000234 Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. GA AZR-000235 Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. GA AZR-000236 Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. GA AZR-000237 Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. GA AZR-000238 Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. GA AZR-000239 Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. GA AZR-000240 Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. GA AZR-000241 Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. GA AZR-000242 Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. GA AZR-000243 Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. GA AZR-000244 Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. GA AZR-000245 Azure.VM.PublicKey Linux virtual machines should use public keys. GA AZR-000246 Azure.VM.Agent Ensure the VM agent is provisioned automatically. GA AZR-000247 Azure.VM.Updates Ensure automatic updates are enabled at deployment. GA AZR-000248 Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. GA AZR-000249 Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. GA AZR-000250 Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. GA AZR-000251 Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. GA AZR-000252 Azure.VM.ADE Use Azure Disk Encryption (ADE). GA AZR-000253 Azure.VM.DiskName Managed Disk names should meet naming requirements. GA AZR-000254 Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. GA AZR-000255 Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). GA AZR-000256 Azure.VM.ASName Availability Set names should meet naming requirements. GA AZR-000257 Azure.VM.NICAttached Network interfaces (NICs) should be attached. GA AZR-000258 Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. GA AZR-000259 Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. GA AZR-000260 Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. GA AZR-000261 Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. GA AZR-000262 Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. GA AZR-000263 Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. GA AZR-000264 Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. GA AZR-000265 Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. GA AZR-000266 Azure.VNET.PeerState VNET peering connections must be connected. GA AZR-000267 Azure.VNET.SubnetName Subnet names should meet naming requirements. GA AZR-000268 Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. GA AZR-000269 Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. GA AZR-000270 Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. GA AZR-000271 Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. GA AZR-000272 Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. GA AZR-000273 Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. GA AZR-000274 Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. GA AZR-000275 Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. GA AZR-000276 Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. GA AZR-000277 Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. GA AZR-000278 Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. GA AZR-000279 Azure.Deployment.OutputSecretValue Avoid outputting sensitive deployment values. GA AZR-000280 Azure.Cognitive.PublicAccess Restrict access of Cognitive Services accounts to authorized virtual networks. GA AZR-000281 Azure.Cognitive.ManagedIdentity Configure managed identities to access Azure resources. GA AZR-000282 Azure.Cognitive.DisableLocalAuth Authenticate requests to Cognitive Services with Azure AD identities. GA AZR-000283 Azure.Cognitive.PrivateEndpoints Use Private Endpoints to access Cognitive Services accounts. GA AZR-000284 Azure.Deployment.AdminUsername The adminUsername or administratorUsername property should not be a string literal in nested templates. GA AZR-000285 Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled to ensure availability of control plane components for production workloads. GA AZR-000286 Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. GA","title":"Index"},{"location":"en/rules/#reference","text":"The following rules and features are included in PSRule for Azure. Info The rule release indicates if the Azure feature is generally available ( GA ) or available under preview . Features provided under previews may have additional limits, availablity restrictions, or terms . By default, PSRule for Azure will not provide recommendations that relate to preview features. To include rules for preview features see working with baselines .","title":"Reference"},{"location":"en/rules/#rules","text":"The following rules are included in PSRule for Azure. Reference Name Synopsis Release AZR-000001 Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. GA AZR-000002 Azure.ACR.ContainerScan Enable vulnerability scanning for container images. GA AZR-000003 Azure.ACR.ImageHealth Remove container images with known vulnerabilities. GA AZR-000004 Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. GA AZR-000005 Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. GA AZR-000006 Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. GA AZR-000007 Azure.ACR.Name Container registry names should meet naming requirements. GA AZR-000008 Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Preview AZR-000009 Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. GA AZR-000010 Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Preview AZR-000011 Azure.ADX.Usage Regularly remove unused resources to reduce costs. GA AZR-000012 Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. GA AZR-000013 Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. GA AZR-000014 Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. GA AZR-000015 Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. GA AZR-000016 Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. GA AZR-000017 Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. GA AZR-000018 Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. GA AZR-000019 Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. GA AZR-000020 Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. GA AZR-000021 Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. GA AZR-000022 Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. GA AZR-000023 Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. GA AZR-000024 Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. GA AZR-000025 Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. GA AZR-000026 Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. GA AZR-000027 Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. GA AZR-000028 Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. GA AZR-000029 Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. GA AZR-000030 Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. GA AZR-000031 Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Preview AZR-000032 Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. GA AZR-000033 Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. GA AZR-000034 Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. GA AZR-000035 Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. GA AZR-000036 Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. GA AZR-000037 Azure.AKS.PodIdentity Configure AKS clusters to use AAD pod identities to access Azure resources securely. Preview AZR-000038 Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. GA AZR-000039 Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. GA AZR-000040 Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. GA AZR-000041 Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. GA AZR-000042 Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. GA AZR-000043 Azure.APIM.APIDescriptors API Management APIs should have a display name and description. GA AZR-000044 Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. GA AZR-000045 Azure.APIM.EncryptValues API Management named values should be encrypted. GA AZR-000046 Azure.APIM.ProductSubscription Configure products to require a subscription. GA AZR-000047 Azure.APIM.ProductApproval Configure products to require approval. GA AZR-000048 Azure.APIM.SampleProducts Remove starter and unlimited sample products. GA AZR-000049 Azure.APIM.ProductDescriptors API Management products should have a display name and description. GA AZR-000050 Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. GA AZR-000051 Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. GA AZR-000052 Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. GA AZR-000053 Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. GA AZR-000054 Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. GA AZR-000055 Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers. GA AZR-000056 Azure.APIM.Name API Management service names should meet naming requirements. GA AZR-000057 Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. GA AZR-000058 Azure.AppConfig.Name App Configuration store names should meet naming requirements. GA AZR-000059 Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. GA AZR-000060 Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. GA AZR-000061 Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. GA AZR-000062 Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. GA AZR-000063 Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. GA AZR-000064 Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. GA AZR-000065 Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. GA AZR-000066 Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. GA AZR-000067 Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. GA AZR-000068 Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. GA AZR-000069 Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. GA AZR-000070 Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. GA AZR-000071 Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. GA AZR-000072 Azure.AppService.MinPlan Use at least a Standard App Service Plan. GA AZR-000073 Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. GA AZR-000074 Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. GA AZR-000075 Azure.AppService.NETVersion Configure applications to use newer .NET versions. GA AZR-000076 Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. GA AZR-000077 Azure.AppService.AlwaysOn Configure Always On for App Service apps. GA AZR-000078 Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. GA AZR-000079 Azure.AppService.WebProbe Configure and enable instance health probes. GA AZR-000080 Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. GA AZR-000081 Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. GA AZR-000082 Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. GA AZR-000083 Azure.AppService.ARRAffinity Disable client affinity for stateless services. GA AZR-000084 Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. GA AZR-000085 Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. GA AZR-000086 Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. GA AZR-000087 Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). GA AZR-000088 Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. GA AZR-000089 Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. GA AZR-000090 Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. GA AZR-000091 Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. GA AZR-000092 Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. GA AZR-000093 Azure.CDN.HTTP Enforce HTTPS for client connections. GA AZR-000094 Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Preview AZR-000095 Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. GA AZR-000096 Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. GA AZR-000097 Azure.DataFactory.Version Consider migrating to DataFactory v2. GA AZR-000098 Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. GA AZR-000099 Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. GA AZR-000100 Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Preview AZR-000101 Azure.EventHub.Usage Regularly remove unused resources to reduce costs. GA AZR-000102 Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Azure AD identities. GA AZR-000103 Azure.Firewall.Name Firewall names should meet naming requirements. GA AZR-000104 Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. GA AZR-000105 Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. GA AZR-000106 Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. GA AZR-000107 Azure.FrontDoor.Logs Audit and monitor access through Front Door. GA AZR-000108 Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. GA AZR-000109 Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. GA AZR-000110 Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. GA AZR-000111 Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. GA AZR-000112 Azure.FrontDoor.State Enable Azure Front Door instance. GA AZR-000113 Azure.FrontDoor.Name Front Door names should meet naming requirements. GA AZR-000114 Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. GA AZR-000115 Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. GA AZR-000116 Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. GA AZR-000117 Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. GA AZR-000118 Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. GA AZR-000119 Azure.KeyVault.Logs Audit and monitor access to Key Vault data. GA AZR-000120 Azure.KeyVault.Name Key Vault names should meet naming requirements. GA AZR-000121 Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. GA AZR-000122 Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. GA AZR-000123 Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Preview AZR-000124 Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. GA AZR-000125 Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. GA AZR-000126 Azure.LB.Probe Use a specific probe for web protocols. GA AZR-000127 Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. GA AZR-000128 Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. GA AZR-000129 Azure.LB.Name Load Balancer names should meet naming requirements. GA AZR-000130 Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. GA AZR-000131 Azure.MySQL.UseSSL Enforce encrypted MySQL connections. GA AZR-000132 Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. GA AZR-000133 Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. GA AZR-000134 Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. GA AZR-000135 Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. GA AZR-000136 Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. GA AZR-000137 Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. GA AZR-000138 Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. GA AZR-000139 Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. GA AZR-000140 Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. GA AZR-000141 Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. GA AZR-000142 Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. GA AZR-000143 Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. GA AZR-000144 Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. GA AZR-000145 Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. GA AZR-000146 Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. GA AZR-000147 Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. GA AZR-000148 Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. GA AZR-000149 Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. GA AZR-000150 Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. GA AZR-000151 Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. GA AZR-000152 Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. GA AZR-000153 Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. GA AZR-000154 Azure.PublicIP.IsAttached Public IP address should be attached or removed. GA AZR-000155 Azure.PublicIP.Name Public IP names should meet naming requirements. GA AZR-000156 Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. GA AZR-000157 Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. GA AZR-000158 Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. GA AZR-000159 Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. GA AZR-000160 Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. GA AZR-000161 Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. GA AZR-000162 Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. GA AZR-000163 Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. GA AZR-000164 Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. GA AZR-000165 Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. GA AZR-000166 Azure.Resource.UseTags Azure resources should be tagged using a standard convention. GA AZR-000167 Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. GA AZR-000168 Azure.ResourceGroup.Name Resource Group names should meet naming requirements. GA AZR-000169 Azure.Route.Name Route table names should meet naming requirements. GA AZR-000170 Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. GA AZR-000171 Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. GA AZR-000172 Azure.Search.SKU Use the basic and standard tiers for entry level workloads. GA AZR-000173 Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. GA AZR-000174 Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. GA AZR-000175 Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. GA AZR-000176 Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. GA AZR-000177 Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. GA AZR-000178 Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Azure AD identities. GA AZR-000179 Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. GA AZR-000180 Azure.SignalR.Name SignalR service instance names should meet naming requirements. GA AZR-000181 Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. GA AZR-000182 Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. GA AZR-000183 Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. GA AZR-000184 Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. GA AZR-000185 Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. GA AZR-000186 Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. GA AZR-000187 Azure.SQL.Auditing Enable auditing for Azure SQL logical server. GA AZR-000188 Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. GA AZR-000189 Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. GA AZR-000190 Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. GA AZR-000191 Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. GA AZR-000192 Azure.SQL.DBName Azure SQL Database names should meet naming requirements. GA AZR-000193 Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. GA AZR-000194 Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. GA AZR-000195 Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. GA AZR-000196 Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. GA AZR-000197 Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. GA AZR-000198 Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. GA AZR-000199 Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. GA AZR-000200 Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. GA AZR-000201 Azure.Storage.Name Storage Account names should meet naming requirements. GA AZR-000202 Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. GA AZR-000203 Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. GA AZR-000204 Azure.RBAC.LimitOwner Limit the number of subscription Owners. GA AZR-000205 Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. GA AZR-000206 Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). GA AZR-000207 Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. GA AZR-000208 Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. GA AZR-000209 Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. GA AZR-000210 Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. GA AZR-000211 Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. GA AZR-000212 Azure.Template.TemplateFile Use ARM template files that are valid. GA AZR-000213 Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. GA AZR-000214 Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. GA AZR-000215 Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. GA AZR-000216 Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. GA AZR-000217 Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. GA AZR-000218 Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. GA AZR-000219 Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. GA AZR-000220 Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. GA AZR-000221 Azure.Template.LocationType Location parameters should use a string value. GA AZR-000222 Azure.Template.ResourceLocation Template resource location should be an expression or global. GA AZR-000223 Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. GA AZR-000224 Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. GA AZR-000225 Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. GA AZR-000226 Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. GA AZR-000227 Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. GA AZR-000228 Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. GA AZR-000229 Azure.Template.ParameterFile Use ARM template parameter files that are valid. GA AZR-000230 Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. GA AZR-000231 Azure.Template.MetadataLink Configure a metadata link for each parameter file. GA AZR-000232 Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. GA AZR-000233 Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. GA AZR-000234 Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. GA AZR-000235 Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. GA AZR-000236 Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. GA AZR-000237 Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. GA AZR-000238 Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. GA AZR-000239 Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. GA AZR-000240 Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. GA AZR-000241 Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. GA AZR-000242 Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. GA AZR-000243 Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. GA AZR-000244 Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. GA AZR-000245 Azure.VM.PublicKey Linux virtual machines should use public keys. GA AZR-000246 Azure.VM.Agent Ensure the VM agent is provisioned automatically. GA AZR-000247 Azure.VM.Updates Ensure automatic updates are enabled at deployment. GA AZR-000248 Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. GA AZR-000249 Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. GA AZR-000250 Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. GA AZR-000251 Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. GA AZR-000252 Azure.VM.ADE Use Azure Disk Encryption (ADE). GA AZR-000253 Azure.VM.DiskName Managed Disk names should meet naming requirements. GA AZR-000254 Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. GA AZR-000255 Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). GA AZR-000256 Azure.VM.ASName Availability Set names should meet naming requirements. GA AZR-000257 Azure.VM.NICAttached Network interfaces (NICs) should be attached. GA AZR-000258 Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. GA AZR-000259 Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. GA AZR-000260 Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. GA AZR-000261 Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. GA AZR-000262 Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. GA AZR-000263 Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. GA AZR-000264 Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. GA AZR-000265 Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. GA AZR-000266 Azure.VNET.PeerState VNET peering connections must be connected. GA AZR-000267 Azure.VNET.SubnetName Subnet names should meet naming requirements. GA AZR-000268 Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. GA AZR-000269 Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. GA AZR-000270 Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. GA AZR-000271 Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. GA AZR-000272 Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. GA AZR-000273 Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. GA AZR-000274 Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. GA AZR-000275 Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. GA AZR-000276 Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. GA AZR-000277 Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. GA AZR-000278 Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. GA AZR-000279 Azure.Deployment.OutputSecretValue Avoid outputting sensitive deployment values. GA AZR-000280 Azure.Cognitive.PublicAccess Restrict access of Cognitive Services accounts to authorized virtual networks. GA AZR-000281 Azure.Cognitive.ManagedIdentity Configure managed identities to access Azure resources. GA AZR-000282 Azure.Cognitive.DisableLocalAuth Authenticate requests to Cognitive Services with Azure AD identities. GA AZR-000283 Azure.Cognitive.PrivateEndpoints Use Private Endpoints to access Cognitive Services accounts. GA AZR-000284 Azure.Deployment.AdminUsername The adminUsername or administratorUsername property should not be a string literal in nested templates. GA AZR-000285 Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled to ensure availability of control plane components for production workloads. GA AZR-000286 Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. GA","title":"Rules"},{"location":"en/rules/Azure.ACR.AdminUser/","tags":["Azure.ACR.AdminUser","AZR-000005"],"text":"Disable ACR admin user # Azure.ACR.AdminUser AZR-000005 Error Security \u00b7 Container Registry \u00b7 2020_06 Use Azure AD identities instead of using the registry admin user. Description # Azure Container Registry (ACR) includes a built-in admin user account. The admin user account is a single user account with administrative access to the registry. This account provides single user access for early test and development. The admin user account is not intended for use with production container registries. Instead use role-based access control (RBAC). RBAC can be used to delegate registry permissions to an Azure AD (AAD) identity. Recommendation # Consider disabling the admin user account and only use identity-based authentication for registry operations. Examples # Configure with Azure template # To deploy Container Registries that pass this rule: Set properties.adminUserEnabled to false . For example: { \"type\" : \"Microsoft.ContainerRegistry/registries\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[parameters('registryName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Premium\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"adminUserEnabled\" : false , \"policies\" : { \"quarantinePolicy\" : { \"status\" : \"enabled\" }, \"trustPolicy\" : { \"status\" : \"enabled\" , \"type\" : \"Notary\" }, \"retentionPolicy\" : { \"status\" : \"enabled\" , \"days\" : 30 } } } } Configure with Bicep # To deploy Container Registries that pass this rule: Set properties.adminUserEnabled to false . For example: resource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = { name: registryName location: location sku: { name: 'Premium' } identity: { type: 'SystemAssigned' } properties: { adminUserEnabled: false policies: { quarantinePolicy: { status: 'enabled' } trustPolicy: { status: 'enabled' type: 'Notary' } retentionPolicy: { status: 'enabled' days: 30 } } } } Configure with Azure CLI # az acr update --admin-enabled false -n '<name>' -g '<resource_group>' Configure with Azure PowerShell # Update-AzContainerRegistry -ResourceGroupName '<resource_group>' -Name '<name>' -DisableAdminUser Links # Use identity-based authentication Authenticate with a private Docker container registry Best practices for Azure Container Registry Use an Azure managed identity to authenticate to an Azure container registry Azure Container Registry roles and permissions What is Azure role-based access control (Azure RBAC)? Azure deployment reference","title":"Azure.ACR.AdminUser"},{"location":"en/rules/Azure.ACR.AdminUser/#disable-acr-admin-user","text":"Azure.ACR.AdminUser AZR-000005 Error Security \u00b7 Container Registry \u00b7 2020_06 Use Azure AD identities instead of using the registry admin user.","title":"Disable ACR admin user"},{"location":"en/rules/Azure.ACR.AdminUser/#description","text":"Azure Container Registry (ACR) includes a built-in admin user account. The admin user account is a single user account with administrative access to the registry. This account provides single user access for early test and development. The admin user account is not intended for use with production container registries. Instead use role-based access control (RBAC). RBAC can be used to delegate registry permissions to an Azure AD (AAD) identity.","title":"Description"},{"location":"en/rules/Azure.ACR.AdminUser/#recommendation","text":"Consider disabling the admin user account and only use identity-based authentication for registry operations.","title":"Recommendation"},{"location":"en/rules/Azure.ACR.AdminUser/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.ACR.AdminUser/#configure-with-azure-template","text":"To deploy Container Registries that pass this rule: Set properties.adminUserEnabled to false . For example: { \"type\" : \"Microsoft.ContainerRegistry/registries\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[parameters('registryName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Premium\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"adminUserEnabled\" : false , \"policies\" : { \"quarantinePolicy\" : { \"status\" : \"enabled\" }, \"trustPolicy\" : { \"status\" : \"enabled\" , \"type\" : \"Notary\" }, \"retentionPolicy\" : { \"status\" : \"enabled\" , \"days\" : 30 } } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.ACR.AdminUser/#configure-with-bicep","text":"To deploy Container Registries that pass this rule: Set properties.adminUserEnabled to false . For example: resource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = { name: registryName location: location sku: { name: 'Premium' } identity: { type: 'SystemAssigned' } properties: { adminUserEnabled: false policies: { quarantinePolicy: { status: 'enabled' } trustPolicy: { status: 'enabled' type: 'Notary' } retentionPolicy: { status: 'enabled' days: 30 } } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.ACR.AdminUser/#configure-with-azure-cli","text":"az acr update --admin-enabled false -n '<name>' -g '<resource_group>'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.ACR.AdminUser/#configure-with-azure-powershell","text":"Update-AzContainerRegistry -ResourceGroupName '<resource_group>' -Name '<name>' -DisableAdminUser","title":"Configure with Azure PowerShell"},{"location":"en/rules/Azure.ACR.AdminUser/#links","text":"Use identity-based authentication Authenticate with a private Docker container registry Best practices for Azure Container Registry Use an Azure managed identity to authenticate to an Azure container registry Azure Container Registry roles and permissions What is Azure role-based access control (Azure RBAC)? Azure deployment reference","title":"Links"},{"location":"en/rules/Azure.ACR.ContainerScan/","tags":["Azure.ACR.ContainerScan","AZR-000002"],"text":"Scan Container Registry images # Azure.ACR.ContainerScan AZR-000002 Error Security \u00b7 Container Registry \u00b7 2020_12 Enable vulnerability scanning for container images. Description # A potential risk with container-based workloads is un-patched security vulnerabilities in: Operating System base images. Frameworks and runtime dependencies used by application code. It is important to adopt a strategy to actively scan images for security vulnerabilities. One option for scanning container images is to use Microsoft Defender for container registries. Microsoft Defender for container registries scans each container image pushed to the registry. Microsoft Defender for container registries scans images on push, import, and recently pulled images. Recently pulled images are scanned on a regular basis when they have been pulled within the last 30 days. When scanned, the container image is pulled and executed in an isolated sandbox for scanning. Any detected vulnerabilities are reported to Microsoft Defender for Cloud. Container image vulnerability scanning with Microsoft Defender for container registries: Is currently only available for Linux-hosted ACR registries. The container registry must be accessible by Microsoft Defender for Container registries. Network access can not be restricted by firewall, Service Endpoints, or Private Endpoints. Is supported in commercial clouds. Is not currently supported in sovereign or national clouds (e.g. US Gov, China Gov, etc.). Recommendation # Consider using Microsoft Defender for Cloud to scan for security vulnerabilities in container images. Examples # Configure with Azure template # To enable container image scanning: Set the Standard pricing tier for Microsoft Defender for container registries. For example: { \"type\" : \"Microsoft.Security/pricings\" , \"apiVersion\" : \"2018-06-01\" , \"name\" : \"ContainerRegistry\" , \"properties\" : { \"pricingTier\" : \"Standard\" } } Configure with Bicep # To enable container image scanning: Set the Standard pricing tier for Microsoft Defender for container registries. For example: resource defenderForContainerRegistry 'Microsoft.Security/pricings@2018-06-01' = { name: 'ContainerRegistry' properties: { pricingTier: 'Standard' } } Configure with Azure CLI # az security pricing create -n 'ContainerRegistry' --tier 'standard' Configure with Azure PowerShell # Set-AzSecurityPricing -Name 'ContainerRegistry' -PricingTier 'Standard' Notes # This rule applies when analyzing resources deployed (in-flight) to Azure. Links # Monitor Azure resources in Microsoft Defender for Cloud Introduction to Microsoft Defender for container registries Container security in Microsoft Defender for Cloud Secure the images and run time","title":"Azure.ACR.ContainerScan"},{"location":"en/rules/Azure.ACR.ContainerScan/#scan-container-registry-images","text":"Azure.ACR.ContainerScan AZR-000002 Error Security \u00b7 Container Registry \u00b7 2020_12 Enable vulnerability scanning for container images.","title":"Scan Container Registry images"},{"location":"en/rules/Azure.ACR.ContainerScan/#description","text":"A potential risk with container-based workloads is un-patched security vulnerabilities in: Operating System base images. Frameworks and runtime dependencies used by application code. It is important to adopt a strategy to actively scan images for security vulnerabilities. One option for scanning container images is to use Microsoft Defender for container registries. Microsoft Defender for container registries scans each container image pushed to the registry. Microsoft Defender for container registries scans images on push, import, and recently pulled images. Recently pulled images are scanned on a regular basis when they have been pulled within the last 30 days. When scanned, the container image is pulled and executed in an isolated sandbox for scanning. Any detected vulnerabilities are reported to Microsoft Defender for Cloud. Container image vulnerability scanning with Microsoft Defender for container registries: Is currently only available for Linux-hosted ACR registries. The container registry must be accessible by Microsoft Defender for Container registries. Network access can not be restricted by firewall, Service Endpoints, or Private Endpoints. Is supported in commercial clouds. Is not currently supported in sovereign or national clouds (e.g. US Gov, China Gov, etc.).","title":"Description"},{"location":"en/rules/Azure.ACR.ContainerScan/#recommendation","text":"Consider using Microsoft Defender for Cloud to scan for security vulnerabilities in container images.","title":"Recommendation"},{"location":"en/rules/Azure.ACR.ContainerScan/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.ACR.ContainerScan/#configure-with-azure-template","text":"To enable container image scanning: Set the Standard pricing tier for Microsoft Defender for container registries. For example: { \"type\" : \"Microsoft.Security/pricings\" , \"apiVersion\" : \"2018-06-01\" , \"name\" : \"ContainerRegistry\" , \"properties\" : { \"pricingTier\" : \"Standard\" } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.ACR.ContainerScan/#configure-with-bicep","text":"To enable container image scanning: Set the Standard pricing tier for Microsoft Defender for container registries. For example: resource defenderForContainerRegistry 'Microsoft.Security/pricings@2018-06-01' = { name: 'ContainerRegistry' properties: { pricingTier: 'Standard' } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.ACR.ContainerScan/#configure-with-azure-cli","text":"az security pricing create -n 'ContainerRegistry' --tier 'standard'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.ACR.ContainerScan/#configure-with-azure-powershell","text":"Set-AzSecurityPricing -Name 'ContainerRegistry' -PricingTier 'Standard'","title":"Configure with Azure PowerShell"},{"location":"en/rules/Azure.ACR.ContainerScan/#notes","text":"This rule applies when analyzing resources deployed (in-flight) to Azure.","title":"Notes"},{"location":"en/rules/Azure.ACR.ContainerScan/#links","text":"Monitor Azure resources in Microsoft Defender for Cloud Introduction to Microsoft Defender for container registries Container security in Microsoft Defender for Cloud Secure the images and run time","title":"Links"},{"location":"en/rules/Azure.ACR.ContentTrust/","tags":["Azure.ACR.ContentTrust","AZR-000009"],"text":"Use trusted container images # Azure.ACR.ContentTrust AZR-000009 Error Security \u00b7 Container Registry \u00b7 2020_12 Use container images signed by a trusted image publisher. Description # Azure Container Registry (ACR) content trust enables pushing and pulling of signed images. Signed images provides additional assurance that they have been built on a trusted source. To enable content trust, the container registry must be using a Premium SKU. Recommendation # Consider enabling content trust on registries, clients, and sign container images. Examples # Configure with Azure template # To deploy Container Registries that pass this rule: Set properties.trustPolicy.status to enabled . Set properties.trustPolicy.type to Notary . For example: { \"type\" : \"Microsoft.ContainerRegistry/registries\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[parameters('registryName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Premium\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"adminUserEnabled\" : false , \"policies\" : { \"quarantinePolicy\" : { \"status\" : \"enabled\" }, \"trustPolicy\" : { \"status\" : \"enabled\" , \"type\" : \"Notary\" }, \"retentionPolicy\" : { \"status\" : \"enabled\" , \"days\" : 30 } } } } Configure with Bicep # To deploy Container Registries that pass this rule: Set properties.trustPolicy.status to enabled . Set properties.trustPolicy.type to Notary . For example: resource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = { name: registryName location: location sku: { name: 'Premium' } identity: { type: 'SystemAssigned' } properties: { adminUserEnabled: false policies: { quarantinePolicy: { status: 'enabled' } trustPolicy: { status: 'enabled' type: 'Notary' } retentionPolicy: { status: 'enabled' days: 30 } } } } Links # Content trust in Azure Container Registry Follow best practices for container security Content trust in Docker Azure template reference","title":"Azure.ACR.ContentTrust"},{"location":"en/rules/Azure.ACR.ContentTrust/#use-trusted-container-images","text":"Azure.ACR.ContentTrust AZR-000009 Error Security \u00b7 Container Registry \u00b7 2020_12 Use container images signed by a trusted image publisher.","title":"Use trusted container images"},{"location":"en/rules/Azure.ACR.ContentTrust/#description","text":"Azure Container Registry (ACR) content trust enables pushing and pulling of signed images. Signed images provides additional assurance that they have been built on a trusted source. To enable content trust, the container registry must be using a Premium SKU.","title":"Description"},{"location":"en/rules/Azure.ACR.ContentTrust/#recommendation","text":"Consider enabling content trust on registries, clients, and sign container images.","title":"Recommendation"},{"location":"en/rules/Azure.ACR.ContentTrust/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.ACR.ContentTrust/#configure-with-azure-template","text":"To deploy Container Registries that pass this rule: Set properties.trustPolicy.status to enabled . Set properties.trustPolicy.type to Notary . For example: { \"type\" : \"Microsoft.ContainerRegistry/registries\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[parameters('registryName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Premium\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"adminUserEnabled\" : false , \"policies\" : { \"quarantinePolicy\" : { \"status\" : \"enabled\" }, \"trustPolicy\" : { \"status\" : \"enabled\" , \"type\" : \"Notary\" }, \"retentionPolicy\" : { \"status\" : \"enabled\" , \"days\" : 30 } } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.ACR.ContentTrust/#configure-with-bicep","text":"To deploy Container Registries that pass this rule: Set properties.trustPolicy.status to enabled . Set properties.trustPolicy.type to Notary . For example: resource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = { name: registryName location: location sku: { name: 'Premium' } identity: { type: 'SystemAssigned' } properties: { adminUserEnabled: false policies: { quarantinePolicy: { status: 'enabled' } trustPolicy: { status: 'enabled' type: 'Notary' } retentionPolicy: { status: 'enabled' days: 30 } } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.ACR.ContentTrust/#links","text":"Content trust in Azure Container Registry Follow best practices for container security Content trust in Docker Azure template reference","title":"Links"},{"location":"en/rules/Azure.ACR.GeoReplica/","tags":["Azure.ACR.GeoReplica","AZR-000004"],"text":"Geo-replicate container images # Azure.ACR.GeoReplica AZR-000004 Error Reliability \u00b7 Container Registry \u00b7 2020_12 Use geo-replicated container registries to compliment a multi-region container deployments. Description # A container registry is stored and maintained by default in a single region. Optionally geo-replication to one or more additional regions can be enabled. Geo-replicating container registries provides the following benefits: Single registry/ image/ tag names can be used across multiple regions. Network-close registry access within the region reduces latency. As images are pulled from a local replicated registry, each pull does not incur additional egress costs. Recommendation # Consider using a geo-replicated container registry for multi-region deployments. Notes # This rule applies when analyzing resources deployed (in-flight) to Azure. Links # Resiliency and dependencies Geo-replicate multi-region deployments Geo-replication in Azure Container Registry Tutorial: Prepare a geo-replicated Azure container registry","title":"Azure.ACR.GeoReplica"},{"location":"en/rules/Azure.ACR.GeoReplica/#geo-replicate-container-images","text":"Azure.ACR.GeoReplica AZR-000004 Error Reliability \u00b7 Container Registry \u00b7 2020_12 Use geo-replicated container registries to compliment a multi-region container deployments.","title":"Geo-replicate container images"},{"location":"en/rules/Azure.ACR.GeoReplica/#description","text":"A container registry is stored and maintained by default in a single region. Optionally geo-replication to one or more additional regions can be enabled. Geo-replicating container registries provides the following benefits: Single registry/ image/ tag names can be used across multiple regions. Network-close registry access within the region reduces latency. As images are pulled from a local replicated registry, each pull does not incur additional egress costs.","title":"Description"},{"location":"en/rules/Azure.ACR.GeoReplica/#recommendation","text":"Consider using a geo-replicated container registry for multi-region deployments.","title":"Recommendation"},{"location":"en/rules/Azure.ACR.GeoReplica/#notes","text":"This rule applies when analyzing resources deployed (in-flight) to Azure.","title":"Notes"},{"location":"en/rules/Azure.ACR.GeoReplica/#links","text":"Resiliency and dependencies Geo-replicate multi-region deployments Geo-replication in Azure Container Registry Tutorial: Prepare a geo-replicated Azure container registry","title":"Links"},{"location":"en/rules/Azure.ACR.ImageHealth/","tags":["Azure.ACR.ImageHealth","AZR-000003"],"text":"Remove vulnerable container images # Azure.ACR.ImageHealth AZR-000003 Error Security \u00b7 Container Registry \u00b7 2020_12 Remove container images with known vulnerabilities. Description # When Azure Defender for container registries is enabled, Azure Defender scans container images. Container images are scanned for known vulnerabilities and marked as healthy or unhealthy. Vulnerable container images should not be used. Recommendation # Consider using removing container images with known vulnerabilities. Notes # This rule applies when analyzing resources deployed (in-flight) to Azure. Links # Introduction to Azure Defender for container registries Container security in Security Center Secure the images and run time Follow best practices for container security","title":"Azure.ACR.ImageHealth"},{"location":"en/rules/Azure.ACR.ImageHealth/#remove-vulnerable-container-images","text":"Azure.ACR.ImageHealth AZR-000003 Error Security \u00b7 Container Registry \u00b7 2020_12 Remove container images with known vulnerabilities.","title":"Remove vulnerable container images"},{"location":"en/rules/Azure.ACR.ImageHealth/#description","text":"When Azure Defender for container registries is enabled, Azure Defender scans container images. Container images are scanned for known vulnerabilities and marked as healthy or unhealthy. Vulnerable container images should not be used.","title":"Description"},{"location":"en/rules/Azure.ACR.ImageHealth/#recommendation","text":"Consider using removing container images with known vulnerabilities.","title":"Recommendation"},{"location":"en/rules/Azure.ACR.ImageHealth/#notes","text":"This rule applies when analyzing resources deployed (in-flight) to Azure.","title":"Notes"},{"location":"en/rules/Azure.ACR.ImageHealth/#links","text":"Introduction to Azure Defender for container registries Container security in Security Center Secure the images and run time Follow best practices for container security","title":"Links"},{"location":"en/rules/Azure.ACR.MinSku/","tags":["Azure.ACR.MinSku","AZR-000006"],"text":"Use ACR production SKU # Azure.ACR.MinSku AZR-000006 Error Reliability \u00b7 Container Registry \u00b7 2020_06 ACR should use the Premium or Standard SKU for production deployments. Description # Azure Container Registry (ACR) provides a range of different service tiers (also known as SKUs). These service tiers provide different levels of performance and features. Three service tiers are available: Basic, Standard, and Premium. Basic container registries are only recommended for non-production deployments. Use a minimum of Standard for production container registries. The Premium SKU provides higher image throughput and included storage, and is required for: Geo-replication Availablity zones Private Endpoints Firewall restrictions Tokens and scope-maps Recommendation # Consider using the Premium Container Registry SKU for production deployments. Examples # Configure with Azure template # To deploy Container Registries that pass this rule: Set sku.name to Premium or Standard . For example: { \"type\" : \"Microsoft.ContainerRegistry/registries\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[parameters('registryName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Premium\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"adminUserEnabled\" : false , \"policies\" : { \"quarantinePolicy\" : { \"status\" : \"enabled\" }, \"trustPolicy\" : { \"status\" : \"enabled\" , \"type\" : \"Notary\" }, \"retentionPolicy\" : { \"status\" : \"enabled\" , \"days\" : 30 } } } } Configure with Bicep # To deploy Container Registries that pass this rule: Set sku.name to Premium or Standard . For example: resource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = { name: registryName location: location sku: { name: 'Premium' } identity: { type: 'SystemAssigned' } properties: { adminUserEnabled: false policies: { quarantinePolicy: { status: 'enabled' } trustPolicy: { status: 'enabled' type: 'Notary' } retentionPolicy: { status: 'enabled' days: 30 } } } } Links # Target and non-functional requirements Azure Container Registry SKUs Geo-replication in Azure Container Registry Best practices for Azure Container Registry Azure template reference","title":"Azure.ACR.MinSku"},{"location":"en/rules/Azure.ACR.MinSku/#use-acr-production-sku","text":"Azure.ACR.MinSku AZR-000006 Error Reliability \u00b7 Container Registry \u00b7 2020_06 ACR should use the Premium or Standard SKU for production deployments.","title":"Use ACR production SKU"},{"location":"en/rules/Azure.ACR.MinSku/#description","text":"Azure Container Registry (ACR) provides a range of different service tiers (also known as SKUs). These service tiers provide different levels of performance and features. Three service tiers are available: Basic, Standard, and Premium. Basic container registries are only recommended for non-production deployments. Use a minimum of Standard for production container registries. The Premium SKU provides higher image throughput and included storage, and is required for: Geo-replication Availablity zones Private Endpoints Firewall restrictions Tokens and scope-maps","title":"Description"},{"location":"en/rules/Azure.ACR.MinSku/#recommendation","text":"Consider using the Premium Container Registry SKU for production deployments.","title":"Recommendation"},{"location":"en/rules/Azure.ACR.MinSku/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.ACR.MinSku/#configure-with-azure-template","text":"To deploy Container Registries that pass this rule: Set sku.name to Premium or Standard . For example: { \"type\" : \"Microsoft.ContainerRegistry/registries\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[parameters('registryName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Premium\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"adminUserEnabled\" : false , \"policies\" : { \"quarantinePolicy\" : { \"status\" : \"enabled\" }, \"trustPolicy\" : { \"status\" : \"enabled\" , \"type\" : \"Notary\" }, \"retentionPolicy\" : { \"status\" : \"enabled\" , \"days\" : 30 } } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.ACR.MinSku/#configure-with-bicep","text":"To deploy Container Registries that pass this rule: Set sku.name to Premium or Standard . For example: resource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = { name: registryName location: location sku: { name: 'Premium' } identity: { type: 'SystemAssigned' } properties: { adminUserEnabled: false policies: { quarantinePolicy: { status: 'enabled' } trustPolicy: { status: 'enabled' type: 'Notary' } retentionPolicy: { status: 'enabled' days: 30 } } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.ACR.MinSku/#links","text":"Target and non-functional requirements Azure Container Registry SKUs Geo-replication in Azure Container Registry Best practices for Azure Container Registry Azure template reference","title":"Links"},{"location":"en/rules/Azure.ACR.Name/","tags":["Azure.ACR.Name","AZR-000007"],"text":"Use valid registry names # Azure.ACR.Name AZR-000007 Error Operational Excellence \u00b7 Container Registry \u00b7 2020_06 Container registry names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for container registry names are: Between 5 and 50 characters long. Alphanumerics. Container registry names must be globally unique. Recommendation # Consider using names that meet container registry naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if container registry names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Recommended abbreviations for Azure resource types Azure template reference","title":"Azure.ACR.Name"},{"location":"en/rules/Azure.ACR.Name/#use-valid-registry-names","text":"Azure.ACR.Name AZR-000007 Error Operational Excellence \u00b7 Container Registry \u00b7 2020_06 Container registry names should meet naming requirements.","title":"Use valid registry names"},{"location":"en/rules/Azure.ACR.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for container registry names are: Between 5 and 50 characters long. Alphanumerics. Container registry names must be globally unique.","title":"Description"},{"location":"en/rules/Azure.ACR.Name/#recommendation","text":"Consider using names that meet container registry naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.ACR.Name/#notes","text":"This rule does not check if container registry names are unique.","title":"Notes"},{"location":"en/rules/Azure.ACR.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Recommended abbreviations for Azure resource types Azure template reference","title":"Links"},{"location":"en/rules/Azure.ACR.Quarantine/","tags":["Azure.ACR.Quarantine","AZR-000008"],"text":"Use container image quarantine pattern # Azure.ACR.Quarantine AZR-000008 Error Security \u00b7 Container Registry \u00b7 Preview \u00b7 2020_12 Enable container image quarantine, scan, and mark images as verified. Description # Image quarantine is a configurable option for Azure Container Registry (ACR). When enabled, images pushed to the container registry are not available by default. Each image must be verified and marked as Passed before it is available to pull. To verify container images, integrate with an external security tool that supports this feature. Recommendation # Consider configuring a security tool to implement the image quarantine pattern. Enable image quarantine on the container registry to ensure each image is verified before use. Examples # Configure with Azure template # To deploy Container Registries that pass this rule: Set properties.quarantinePolicy.status to enabled . For example: { \"type\" : \"Microsoft.ContainerRegistry/registries\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[parameters('registryName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Premium\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"adminUserEnabled\" : false , \"policies\" : { \"quarantinePolicy\" : { \"status\" : \"enabled\" }, \"trustPolicy\" : { \"status\" : \"enabled\" , \"type\" : \"Notary\" }, \"retentionPolicy\" : { \"status\" : \"enabled\" , \"days\" : 30 } } } } Configure with Bicep # To deploy Container Registries that pass this rule: Set properties.quarantinePolicy.status to enabled . For example: resource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = { name: registryName location: location sku: { name: 'Premium' } identity: { type: 'SystemAssigned' } properties: { adminUserEnabled: false policies: { quarantinePolicy: { status: 'enabled' } trustPolicy: { status: 'enabled' type: 'Notary' } retentionPolicy: { status: 'enabled' days: 30 } } } } Notes # Image quarantine for Azure Container Registry is currently in preview. Links # Monitor Azure resources in Microsoft Defender for Cloud How do I enable automatic image quarantine for a registry? Quarantine Pattern Secure the images and run time Azure template reference","title":"Azure.ACR.Quarantine"},{"location":"en/rules/Azure.ACR.Quarantine/#use-container-image-quarantine-pattern","text":"Azure.ACR.Quarantine AZR-000008 Error Security \u00b7 Container Registry \u00b7 Preview \u00b7 2020_12 Enable container image quarantine, scan, and mark images as verified.","title":"Use container image quarantine pattern"},{"location":"en/rules/Azure.ACR.Quarantine/#description","text":"Image quarantine is a configurable option for Azure Container Registry (ACR). When enabled, images pushed to the container registry are not available by default. Each image must be verified and marked as Passed before it is available to pull. To verify container images, integrate with an external security tool that supports this feature.","title":"Description"},{"location":"en/rules/Azure.ACR.Quarantine/#recommendation","text":"Consider configuring a security tool to implement the image quarantine pattern. Enable image quarantine on the container registry to ensure each image is verified before use.","title":"Recommendation"},{"location":"en/rules/Azure.ACR.Quarantine/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.ACR.Quarantine/#configure-with-azure-template","text":"To deploy Container Registries that pass this rule: Set properties.quarantinePolicy.status to enabled . For example: { \"type\" : \"Microsoft.ContainerRegistry/registries\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[parameters('registryName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Premium\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"adminUserEnabled\" : false , \"policies\" : { \"quarantinePolicy\" : { \"status\" : \"enabled\" }, \"trustPolicy\" : { \"status\" : \"enabled\" , \"type\" : \"Notary\" }, \"retentionPolicy\" : { \"status\" : \"enabled\" , \"days\" : 30 } } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.ACR.Quarantine/#configure-with-bicep","text":"To deploy Container Registries that pass this rule: Set properties.quarantinePolicy.status to enabled . For example: resource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = { name: registryName location: location sku: { name: 'Premium' } identity: { type: 'SystemAssigned' } properties: { adminUserEnabled: false policies: { quarantinePolicy: { status: 'enabled' } trustPolicy: { status: 'enabled' type: 'Notary' } retentionPolicy: { status: 'enabled' days: 30 } } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.ACR.Quarantine/#notes","text":"Image quarantine for Azure Container Registry is currently in preview.","title":"Notes"},{"location":"en/rules/Azure.ACR.Quarantine/#links","text":"Monitor Azure resources in Microsoft Defender for Cloud How do I enable automatic image quarantine for a registry? Quarantine Pattern Secure the images and run time Azure template reference","title":"Links"},{"location":"en/rules/Azure.ACR.Retention/","tags":["Azure.ACR.Retention","AZR-000010"],"text":"Configure ACR retention policies # Azure.ACR.Retention AZR-000010 Error Cost Optimization \u00b7 Container Registry \u00b7 Preview \u00b7 2020_12 Use a retention policy to cleanup untagged manifests. Description # Retention policy is a configurable option of Premium Azure Container Registry (ACR). When a retention policy is configured, untagged manifests in the registry are automatically deleted. A manifest is untagged when a more recent image is pushed using the same tag. i.e. latest. The retention policy (in days) can be set to 0-365. The default is 7 days. To configure a retention policy, the container registry must be using a Premium SKU. Recommendation # Consider enabling a retention policy for untagged manifests. Examples # Configure with Azure template # To deploy Container Registries that pass this rule: Set properties.retentionPolicy.status to enabled . For example: { \"type\" : \"Microsoft.ContainerRegistry/registries\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[parameters('registryName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Premium\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"adminUserEnabled\" : false , \"policies\" : { \"quarantinePolicy\" : { \"status\" : \"enabled\" }, \"trustPolicy\" : { \"status\" : \"enabled\" , \"type\" : \"Notary\" }, \"retentionPolicy\" : { \"status\" : \"enabled\" , \"days\" : 30 } } } } Configure with Bicep # To deploy Container Registries that pass this rule: Set properties.retentionPolicy.status to enabled . For example: resource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = { name: registryName location: location sku: { name: 'Premium' } identity: { type: 'SystemAssigned' } properties: { adminUserEnabled: false policies: { quarantinePolicy: { status: 'enabled' } trustPolicy: { status: 'enabled' type: 'Notary' } retentionPolicy: { status: 'enabled' days: 30 } } } } Notes # Retention policies for Azure Container Registry is currently in preview. Links # Scalable storage Set a retention policy for untagged manifests Lock a container image in an Azure container registry Azure template reference","title":"Azure.ACR.Retention"},{"location":"en/rules/Azure.ACR.Retention/#configure-acr-retention-policies","text":"Azure.ACR.Retention AZR-000010 Error Cost Optimization \u00b7 Container Registry \u00b7 Preview \u00b7 2020_12 Use a retention policy to cleanup untagged manifests.","title":"Configure ACR retention policies"},{"location":"en/rules/Azure.ACR.Retention/#description","text":"Retention policy is a configurable option of Premium Azure Container Registry (ACR). When a retention policy is configured, untagged manifests in the registry are automatically deleted. A manifest is untagged when a more recent image is pushed using the same tag. i.e. latest. The retention policy (in days) can be set to 0-365. The default is 7 days. To configure a retention policy, the container registry must be using a Premium SKU.","title":"Description"},{"location":"en/rules/Azure.ACR.Retention/#recommendation","text":"Consider enabling a retention policy for untagged manifests.","title":"Recommendation"},{"location":"en/rules/Azure.ACR.Retention/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.ACR.Retention/#configure-with-azure-template","text":"To deploy Container Registries that pass this rule: Set properties.retentionPolicy.status to enabled . For example: { \"type\" : \"Microsoft.ContainerRegistry/registries\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[parameters('registryName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Premium\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"adminUserEnabled\" : false , \"policies\" : { \"quarantinePolicy\" : { \"status\" : \"enabled\" }, \"trustPolicy\" : { \"status\" : \"enabled\" , \"type\" : \"Notary\" }, \"retentionPolicy\" : { \"status\" : \"enabled\" , \"days\" : 30 } } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.ACR.Retention/#configure-with-bicep","text":"To deploy Container Registries that pass this rule: Set properties.retentionPolicy.status to enabled . For example: resource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = { name: registryName location: location sku: { name: 'Premium' } identity: { type: 'SystemAssigned' } properties: { adminUserEnabled: false policies: { quarantinePolicy: { status: 'enabled' } trustPolicy: { status: 'enabled' type: 'Notary' } retentionPolicy: { status: 'enabled' days: 30 } } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.ACR.Retention/#notes","text":"Retention policies for Azure Container Registry is currently in preview.","title":"Notes"},{"location":"en/rules/Azure.ACR.Retention/#links","text":"Scalable storage Set a retention policy for untagged manifests Lock a container image in an Azure container registry Azure template reference","title":"Links"},{"location":"en/rules/Azure.ACR.Usage/","tags":["Azure.ACR.Usage","AZR-000001"],"text":"Container registry storage usage # Azure.ACR.Usage AZR-000001 Error Cost Optimization \u00b7 Container Registry \u00b7 2020_12 Regularly remove deprecated and unneeded images to reduce storage usage. Description # Each ACR SKU has an amount of included storage. When the amount of included storage is exceeded, additional storage costs per GiB are accrued. It is good practice to regularly clean-up orphaned (or dangling ) images. These images are a result of pushing updated images with the same tag. Recommendation # Consider removing deprecated and unneeded images to reduce storage consumption. Also consider upgrading to the Premium SKU for Basic or Standard registries to increase included storage. Notes # This rule applies when analyzing resources deployed (in-flight) to Azure. Links # Generate cost reports Azure Container Registry service tiers Scalable storage Manage registry size Delete container images in Azure Container Registry using the Azure CLI","title":"Azure.ACR.Usage"},{"location":"en/rules/Azure.ACR.Usage/#container-registry-storage-usage","text":"Azure.ACR.Usage AZR-000001 Error Cost Optimization \u00b7 Container Registry \u00b7 2020_12 Regularly remove deprecated and unneeded images to reduce storage usage.","title":"Container registry storage usage"},{"location":"en/rules/Azure.ACR.Usage/#description","text":"Each ACR SKU has an amount of included storage. When the amount of included storage is exceeded, additional storage costs per GiB are accrued. It is good practice to regularly clean-up orphaned (or dangling ) images. These images are a result of pushing updated images with the same tag.","title":"Description"},{"location":"en/rules/Azure.ACR.Usage/#recommendation","text":"Consider removing deprecated and unneeded images to reduce storage consumption. Also consider upgrading to the Premium SKU for Basic or Standard registries to increase included storage.","title":"Recommendation"},{"location":"en/rules/Azure.ACR.Usage/#notes","text":"This rule applies when analyzing resources deployed (in-flight) to Azure.","title":"Notes"},{"location":"en/rules/Azure.ACR.Usage/#links","text":"Generate cost reports Azure Container Registry service tiers Scalable storage Manage registry size Delete container images in Azure Container Registry using the Azure CLI","title":"Links"},{"location":"en/rules/Azure.ADX.DiskEncryption/","tags":["Azure.ADX.DiskEncryption","AZR-000013"],"text":"Use disk encryption for Azure Data Explorer clusters # Azure.ADX.DiskEncryption AZR-000013 Error Security \u00b7 Data Explorer \u00b7 2022_03 Use disk encryption for Azure Data Explorer (ADX) clusters. Description # Azure storage is encrypted at rest, however computing resources can additionally use disk encryption. Disk encryption provides additional security for data at rest. Recommendation # Consider enabling disk encryption on Azure Data Explorer clusters. Examples # Configure with Azure template # To deploy clusters that pass this rule: Set properties.enableDiskEncryption to true . For example: { \"type\" : \"Microsoft.Kusto/clusters\" , \"apiVersion\" : \"2021-08-27\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_D11_v2\" , \"tier\" : \"Standard\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"enableDiskEncryption\" : true } } Configure with Bicep # To deploy clusters that pass this rule: Set properties.enableDiskEncryption to true . For example: resource adx 'Microsoft.Kusto/clusters@2021-08-27' = { name: name location: location sku: { name: 'Standard_D11_v2' tier: 'Standard' } identity: { type: 'SystemAssigned' } properties: { enableDiskEncryption: true } } Links # Data encryption in Azure Secure your cluster using Disk Encryption in Azure Data Explorer Azure template reference","title":"Azure.ADX.DiskEncryption"},{"location":"en/rules/Azure.ADX.DiskEncryption/#use-disk-encryption-for-azure-data-explorer-clusters","text":"Azure.ADX.DiskEncryption AZR-000013 Error Security \u00b7 Data Explorer \u00b7 2022_03 Use disk encryption for Azure Data Explorer (ADX) clusters.","title":"Use disk encryption for Azure Data Explorer clusters"},{"location":"en/rules/Azure.ADX.DiskEncryption/#description","text":"Azure storage is encrypted at rest, however computing resources can additionally use disk encryption. Disk encryption provides additional security for data at rest.","title":"Description"},{"location":"en/rules/Azure.ADX.DiskEncryption/#recommendation","text":"Consider enabling disk encryption on Azure Data Explorer clusters.","title":"Recommendation"},{"location":"en/rules/Azure.ADX.DiskEncryption/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.ADX.DiskEncryption/#configure-with-azure-template","text":"To deploy clusters that pass this rule: Set properties.enableDiskEncryption to true . For example: { \"type\" : \"Microsoft.Kusto/clusters\" , \"apiVersion\" : \"2021-08-27\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_D11_v2\" , \"tier\" : \"Standard\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"enableDiskEncryption\" : true } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.ADX.DiskEncryption/#configure-with-bicep","text":"To deploy clusters that pass this rule: Set properties.enableDiskEncryption to true . For example: resource adx 'Microsoft.Kusto/clusters@2021-08-27' = { name: name location: location sku: { name: 'Standard_D11_v2' tier: 'Standard' } identity: { type: 'SystemAssigned' } properties: { enableDiskEncryption: true } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.ADX.DiskEncryption/#links","text":"Data encryption in Azure Secure your cluster using Disk Encryption in Azure Data Explorer Azure template reference","title":"Links"},{"location":"en/rules/Azure.ADX.ManagedIdentity/","tags":["Azure.ADX.ManagedIdentity","AZR-000012"],"text":"Use managed identities for Data Explorer clusters # Azure.ADX.ManagedIdentity AZR-000012 Error Security \u00b7 Data Explorer \u00b7 2022_03 Configure Data Explorer clusters to use managed identities to access Azure resources securely. Description # A managed identity allows your cluster to access other Azure AD-protected resources such as Azure Storage. The identity is managed by the Azure platform and doesn't require you to provision or rotate any secrets. Using Azure managed identities have the following benefits: You don't need to store or manage credentials. Azure automatically generates tokens and performs rotation. You can use managed identities to authenticate to any Azure service that supports Azure AD authentication. Managed identities can be used without any additional cost. Recommendation # Consider configuring a managed identity for each Azure Data Explorer cluster. Also consider using managed identities to authenticate to related Azure services. Examples # Configure with Azure template # To deploy clusters that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: { \"type\" : \"Microsoft.Kusto/clusters\" , \"apiVersion\" : \"2021-08-27\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_D11_v2\" , \"tier\" : \"Standard\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"enableDiskEncryption\" : true } } Configure with Bicep # To deploy clusters that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: resource adx 'Microsoft.Kusto/clusters@2021-08-27' = { name: name location: location sku: { name: 'Standard_D11_v2' tier: 'Standard' } identity: { type: 'SystemAssigned' } properties: { enableDiskEncryption: true } } Links # Use identity-based authentication Managed identities overview Configure managed identities for your Azure Data Explorer cluster Managed identities for Azure resources Azure template reference","title":"Azure.ADX.ManagedIdentity"},{"location":"en/rules/Azure.ADX.ManagedIdentity/#use-managed-identities-for-data-explorer-clusters","text":"Azure.ADX.ManagedIdentity AZR-000012 Error Security \u00b7 Data Explorer \u00b7 2022_03 Configure Data Explorer clusters to use managed identities to access Azure resources securely.","title":"Use managed identities for Data Explorer clusters"},{"location":"en/rules/Azure.ADX.ManagedIdentity/#description","text":"A managed identity allows your cluster to access other Azure AD-protected resources such as Azure Storage. The identity is managed by the Azure platform and doesn't require you to provision or rotate any secrets. Using Azure managed identities have the following benefits: You don't need to store or manage credentials. Azure automatically generates tokens and performs rotation. You can use managed identities to authenticate to any Azure service that supports Azure AD authentication. Managed identities can be used without any additional cost.","title":"Description"},{"location":"en/rules/Azure.ADX.ManagedIdentity/#recommendation","text":"Consider configuring a managed identity for each Azure Data Explorer cluster. Also consider using managed identities to authenticate to related Azure services.","title":"Recommendation"},{"location":"en/rules/Azure.ADX.ManagedIdentity/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.ADX.ManagedIdentity/#configure-with-azure-template","text":"To deploy clusters that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: { \"type\" : \"Microsoft.Kusto/clusters\" , \"apiVersion\" : \"2021-08-27\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_D11_v2\" , \"tier\" : \"Standard\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"enableDiskEncryption\" : true } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.ADX.ManagedIdentity/#configure-with-bicep","text":"To deploy clusters that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: resource adx 'Microsoft.Kusto/clusters@2021-08-27' = { name: name location: location sku: { name: 'Standard_D11_v2' tier: 'Standard' } identity: { type: 'SystemAssigned' } properties: { enableDiskEncryption: true } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.ADX.ManagedIdentity/#links","text":"Use identity-based authentication Managed identities overview Configure managed identities for your Azure Data Explorer cluster Managed identities for Azure resources Azure template reference","title":"Links"},{"location":"en/rules/Azure.ADX.SLA/","tags":["Azure.ADX.SLA","AZR-000014"],"text":"Use an SLA for Azure Data Explorer clusters # Azure.ADX.SLA AZR-000014 Error Reliability \u00b7 Data Explorer \u00b7 2022_03 Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Description # When choosing a SKU for an ADX cluster you should consider the SLA that is included in the SKU. ADX clusters offer a range of offerings. Development SKUs are designed for early non-production use and do not include any SLA. Recommendation # Consider using a production ready SKU that includes a SLA. Examples # Configure with Azure template # To deploy clusters that pass this rule: Set sku.tier to Standard . Set sku.name to non-development SKU such as Standard_D11_v2 . For example: { \"type\" : \"Microsoft.Kusto/clusters\" , \"apiVersion\" : \"2021-08-27\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_D11_v2\" , \"tier\" : \"Standard\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"enableDiskEncryption\" : true } } Configure with Bicep # To deploy clusters that pass this rule: Set sku.tier to Standard . Set sku.name to non-development SKU such as Standard_D11_v2 . For example: resource adx 'Microsoft.Kusto/clusters@2021-08-27' = { name: name location: location sku: { name: 'Standard_D11_v2' tier: 'Standard' } identity: { type: 'SystemAssigned' } properties: { enableDiskEncryption: true } } Links # Target and non-functional requirements Azure Data Explorer pricing Azure template reference","title":"Azure.ADX.SLA"},{"location":"en/rules/Azure.ADX.SLA/#use-an-sla-for-azure-data-explorer-clusters","text":"Azure.ADX.SLA AZR-000014 Error Reliability \u00b7 Data Explorer \u00b7 2022_03 Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters.","title":"Use an SLA for Azure Data Explorer clusters"},{"location":"en/rules/Azure.ADX.SLA/#description","text":"When choosing a SKU for an ADX cluster you should consider the SLA that is included in the SKU. ADX clusters offer a range of offerings. Development SKUs are designed for early non-production use and do not include any SLA.","title":"Description"},{"location":"en/rules/Azure.ADX.SLA/#recommendation","text":"Consider using a production ready SKU that includes a SLA.","title":"Recommendation"},{"location":"en/rules/Azure.ADX.SLA/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.ADX.SLA/#configure-with-azure-template","text":"To deploy clusters that pass this rule: Set sku.tier to Standard . Set sku.name to non-development SKU such as Standard_D11_v2 . For example: { \"type\" : \"Microsoft.Kusto/clusters\" , \"apiVersion\" : \"2021-08-27\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_D11_v2\" , \"tier\" : \"Standard\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"enableDiskEncryption\" : true } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.ADX.SLA/#configure-with-bicep","text":"To deploy clusters that pass this rule: Set sku.tier to Standard . Set sku.name to non-development SKU such as Standard_D11_v2 . For example: resource adx 'Microsoft.Kusto/clusters@2021-08-27' = { name: name location: location sku: { name: 'Standard_D11_v2' tier: 'Standard' } identity: { type: 'SystemAssigned' } properties: { enableDiskEncryption: true } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.ADX.SLA/#links","text":"Target and non-functional requirements Azure Data Explorer pricing Azure template reference","title":"Links"},{"location":"en/rules/Azure.ADX.Usage/","tags":["Azure.ADX.Usage","AZR-000011"],"text":"Remove unused Data Explorer clusters # Azure.ADX.Usage AZR-000011 Error Cost Optimization \u00b7 Data Explorer \u00b7 2022_03 Regularly remove unused resources to reduce costs. Description # Billing starts for an Azure Data Explorer (ADX) cluster after it is provisioned. To store data in an ADX cluster, you must first create a database. Clusters without any databases are considered unused. Additionally, ADX clusters can stopped. Stopping an ADX cluster deallocates and removes compute resources. While in the stopped state, compute charges are not incurred. Any data stored in the cluster is persisted while the cluster is stopped. Recommendation # Consider removing Data Explorer clusters that are not used. Notes # This rule applies when analyzing ADX clusters deployed (in-flight) and running within Azure. If the cluster is stopped, this rule is ignored. Links # Generate cost reports Pricing Stop and restart the cluster Automatic stop of inactive Azure Data Explorer clusters","title":"Azure.ADX.Usage"},{"location":"en/rules/Azure.ADX.Usage/#remove-unused-data-explorer-clusters","text":"Azure.ADX.Usage AZR-000011 Error Cost Optimization \u00b7 Data Explorer \u00b7 2022_03 Regularly remove unused resources to reduce costs.","title":"Remove unused Data Explorer clusters"},{"location":"en/rules/Azure.ADX.Usage/#description","text":"Billing starts for an Azure Data Explorer (ADX) cluster after it is provisioned. To store data in an ADX cluster, you must first create a database. Clusters without any databases are considered unused. Additionally, ADX clusters can stopped. Stopping an ADX cluster deallocates and removes compute resources. While in the stopped state, compute charges are not incurred. Any data stored in the cluster is persisted while the cluster is stopped.","title":"Description"},{"location":"en/rules/Azure.ADX.Usage/#recommendation","text":"Consider removing Data Explorer clusters that are not used.","title":"Recommendation"},{"location":"en/rules/Azure.ADX.Usage/#notes","text":"This rule applies when analyzing ADX clusters deployed (in-flight) and running within Azure. If the cluster is stopped, this rule is ignored.","title":"Notes"},{"location":"en/rules/Azure.ADX.Usage/#links","text":"Generate cost reports Pricing Stop and restart the cluster Automatic stop of inactive Azure Data Explorer clusters","title":"Links"},{"location":"en/rules/Azure.AKS.AuditLogs/","tags":["Azure.AKS.AuditLogs","AZR-000022"],"text":"AKS clusters should collect security-based audit logs # Azure.AKS.AuditLogs AZR-000022 Error Security \u00b7 Azure Kubernetes Service \u00b7 2021_09 AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Description # To capture security-based audit logs from AKS clusters, the following diagnostic log categories should be enabled: kube-audit or kube-audit-admin , or both. kube-audit - Contains all audit log data for every audit event, including get, list, create, update, delete, patch, and post. kube-audit-admin - Is a subset of the kube-audit log category. kube-audit-admin reduces the number of logs significantly by excluding the get and list audit events from the log. guard - Contains logs for Azure Active Directory (AAD) authorization integration. For managed Azure AD, this includes token in and user info out. For Azure RBAC, this includes access reviews in and out. Recommendation # Consider configuring diagnostic settings to capture security-based audit logs from AKS clusters. Examples # Configure with Azure template # To deploy AKS clusters that pass this rule: Deploy a diagnostic settings sub-resource. Enable logging for the kube-audit / kube-audit-admin and guard categories. For example: { \"comments\" : \"Azure Kubernetes Cluster\" , \"apiVersion\" : \"2020-12-01\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ], \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"location\" : \"[parameters('location')]\" , \"name\" : \"[parameters('clusterName')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"disableLocalAccounts\" : true , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : [ { \"name\" : \"system\" , \"osDiskSizeGB\" : 32 , \"count\" : 3 , \"minCount\" : 3 , \"maxCount\" : 10 , \"enableAutoScaling\" : true , \"maxPods\" : 50 , \"vmSize\" : \"Standard_D2s_v3\" , \"osType\" : \"Linux\" , \"type\" : \"VirtualMachineScaleSets\" , \"vnetSubnetID\" : \"[variables('clusterSubnetId')]\" , \"mode\" : \"System\" , \"osDiskType\" : \"Ephemeral\" , \"scaleSetPriority\" : \"Regular\" } ], \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"Standard\" , \"serviceCidr\" : \"192.168.0.0/16\" , \"dnsServiceIP\" : \"192.168.0.4\" , \"dockerBridgeCidr\" : \"172.17.0.1/16\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false } } }, \"resources\" : [ { \"apiVersion\" : \"2016-09-01\" , \"type\" : \"Microsoft.ContainerService/managedClusters/providers/diagnosticSettings\" , \"name\" : \"[concat(parameters('clusterName'), '/Microsoft.Insights/service')]\" , \"properties\" : { \"workspaceId\" : \"[parameters('workspaceId')]\" , \"logs\" : [ { \"category\" : \"kube-audit\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } }, { \"category\" : \"kube-audit-admin\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } }, { \"category\" : \"guard\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } } ], \"metrics\" : [] } } ] } Links # Security audits Monitoring AKS data reference Collect resource logs Template reference","title":"Azure.AKS.AuditLogs"},{"location":"en/rules/Azure.AKS.AuditLogs/#aks-clusters-should-collect-security-based-audit-logs","text":"Azure.AKS.AuditLogs AZR-000022 Error Security \u00b7 Azure Kubernetes Service \u00b7 2021_09 AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads.","title":"AKS clusters should collect security-based audit logs"},{"location":"en/rules/Azure.AKS.AuditLogs/#description","text":"To capture security-based audit logs from AKS clusters, the following diagnostic log categories should be enabled: kube-audit or kube-audit-admin , or both. kube-audit - Contains all audit log data for every audit event, including get, list, create, update, delete, patch, and post. kube-audit-admin - Is a subset of the kube-audit log category. kube-audit-admin reduces the number of logs significantly by excluding the get and list audit events from the log. guard - Contains logs for Azure Active Directory (AAD) authorization integration. For managed Azure AD, this includes token in and user info out. For Azure RBAC, this includes access reviews in and out.","title":"Description"},{"location":"en/rules/Azure.AKS.AuditLogs/#recommendation","text":"Consider configuring diagnostic settings to capture security-based audit logs from AKS clusters.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.AuditLogs/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.AuditLogs/#configure-with-azure-template","text":"To deploy AKS clusters that pass this rule: Deploy a diagnostic settings sub-resource. Enable logging for the kube-audit / kube-audit-admin and guard categories. For example: { \"comments\" : \"Azure Kubernetes Cluster\" , \"apiVersion\" : \"2020-12-01\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ], \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"location\" : \"[parameters('location')]\" , \"name\" : \"[parameters('clusterName')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"disableLocalAccounts\" : true , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : [ { \"name\" : \"system\" , \"osDiskSizeGB\" : 32 , \"count\" : 3 , \"minCount\" : 3 , \"maxCount\" : 10 , \"enableAutoScaling\" : true , \"maxPods\" : 50 , \"vmSize\" : \"Standard_D2s_v3\" , \"osType\" : \"Linux\" , \"type\" : \"VirtualMachineScaleSets\" , \"vnetSubnetID\" : \"[variables('clusterSubnetId')]\" , \"mode\" : \"System\" , \"osDiskType\" : \"Ephemeral\" , \"scaleSetPriority\" : \"Regular\" } ], \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"Standard\" , \"serviceCidr\" : \"192.168.0.0/16\" , \"dnsServiceIP\" : \"192.168.0.4\" , \"dockerBridgeCidr\" : \"172.17.0.1/16\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false } } }, \"resources\" : [ { \"apiVersion\" : \"2016-09-01\" , \"type\" : \"Microsoft.ContainerService/managedClusters/providers/diagnosticSettings\" , \"name\" : \"[concat(parameters('clusterName'), '/Microsoft.Insights/service')]\" , \"properties\" : { \"workspaceId\" : \"[parameters('workspaceId')]\" , \"logs\" : [ { \"category\" : \"kube-audit\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } }, { \"category\" : \"kube-audit-admin\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } }, { \"category\" : \"guard\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } } ], \"metrics\" : [] } } ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.AuditLogs/#links","text":"Security audits Monitoring AKS data reference Collect resource logs Template reference","title":"Links"},{"location":"en/rules/Azure.AKS.AuthorizedIPs/","tags":["Azure.AKS.AuthorizedIPs","AZR-000030"],"text":"Restrict access to AKS API server endpoints # Azure.AKS.AuthorizedIPs AZR-000030 Error Security \u00b7 Azure Kubernetes Service \u00b7 2021_06 Restrict access to API server endpoints to authorized IP addresses. Description # In Kubernetes, the API server is the control plane of the cluster. Access to the API server is required by various cluster functions as well as all administrator activities. All activities performed against the cluster require authorization. To improve cluster security, the API server can be restricted to a limited set of IP address ranges. Restricting authorized IP addresses for the API server as the following limitations: Requires AKS clusters configured with a Standard Load Balancer SKU. This feature is not compatible with clusters that use Public IP per Node. When configuring this feature you must specify the IP address ranges that will be authorized. To allow only the outbound public IP of the Standard SKU load balancer, use 0.0.0.0/32 . Recommendation # Consider restricting network traffic to the API server endpoints to trusted IP addresses. Include output IP addresses for cluster nodes and any range where administration will occur from. Examples # Configure with Azure CLI # az aks update -n '<name>' -g '<resource_group>' --api-server-authorized-ip-ranges '0.0.0.0/32' Links # Network security Secure access to the API server using authorized IP address ranges in Azure Kubernetes Service (AKS) Best practices for cluster security and upgrades in Azure Kubernetes Service (AKS) Azure template reference","title":"Azure.AKS.AuthorizedIPs"},{"location":"en/rules/Azure.AKS.AuthorizedIPs/#restrict-access-to-aks-api-server-endpoints","text":"Azure.AKS.AuthorizedIPs AZR-000030 Error Security \u00b7 Azure Kubernetes Service \u00b7 2021_06 Restrict access to API server endpoints to authorized IP addresses.","title":"Restrict access to AKS API server endpoints"},{"location":"en/rules/Azure.AKS.AuthorizedIPs/#description","text":"In Kubernetes, the API server is the control plane of the cluster. Access to the API server is required by various cluster functions as well as all administrator activities. All activities performed against the cluster require authorization. To improve cluster security, the API server can be restricted to a limited set of IP address ranges. Restricting authorized IP addresses for the API server as the following limitations: Requires AKS clusters configured with a Standard Load Balancer SKU. This feature is not compatible with clusters that use Public IP per Node. When configuring this feature you must specify the IP address ranges that will be authorized. To allow only the outbound public IP of the Standard SKU load balancer, use 0.0.0.0/32 .","title":"Description"},{"location":"en/rules/Azure.AKS.AuthorizedIPs/#recommendation","text":"Consider restricting network traffic to the API server endpoints to trusted IP addresses. Include output IP addresses for cluster nodes and any range where administration will occur from.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.AuthorizedIPs/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.AuthorizedIPs/#configure-with-azure-cli","text":"az aks update -n '<name>' -g '<resource_group>' --api-server-authorized-ip-ranges '0.0.0.0/32'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AKS.AuthorizedIPs/#links","text":"Network security Secure access to the API server using authorized IP address ranges in Azure Kubernetes Service (AKS) Best practices for cluster security and upgrades in Azure Kubernetes Service (AKS) Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.AutoScaling/","tags":["Azure.AKS.AutoScaling","AZR-000019"],"text":"Enable AKS cluster autoscaler # Azure.AKS.AutoScaling AZR-000019 Error Performance Efficiency \u00b7 Azure Kubernetes Service \u00b7 2021_09 Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Description # In addition to perform manual scaling, AKS clusters support autoscaling. Autoscaling reduces manual intervention required to scale a cluster to keep up with application demands. Recommendation # Consider enabling autoscaling for AKS clusters deployed with virtual machine scale sets. Examples # Configure with Azure template # To set enable autoscaling for an AKS cluster: Set properties.agentPoolProfiles[*].enableAutoScaling to true . Set properties.agentPoolProfiles[*].type to VirtualMachineScaleSets . For example: { \"comments\" : \"Azure Kubernetes Cluster\" , \"apiVersion\" : \"2020-12-01\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ], \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"location\" : \"[parameters('location')]\" , \"name\" : \"[parameters('clusterName')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"disableLocalAccounts\" : true , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : [ { \"name\" : \"system\" , \"osDiskSizeGB\" : 32 , \"count\" : 3 , \"minCount\" : 3 , \"maxCount\" : 10 , \"enableAutoScaling\" : true , \"maxPods\" : 50 , \"vmSize\" : \"Standard_D2s_v3\" , \"osType\" : \"Linux\" , \"type\" : \"VirtualMachineScaleSets\" , \"vnetSubnetID\" : \"[variables('clusterSubnetId')]\" , \"mode\" : \"System\" , \"osDiskType\" : \"Ephemeral\" , \"scaleSetPriority\" : \"Regular\" } ], \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"Standard\" , \"serviceCidr\" : \"192.168.0.0/16\" , \"dnsServiceIP\" : \"192.168.0.4\" , \"dockerBridgeCidr\" : \"172.17.0.1/16\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false } } } } Configure with Azure CLI # Enable cluster autoscaler # az aks update \\ --name '<name>' \\ --resource-group '<resource_group>' \\ --enable-cluster-autoscaler \\ --min-count '<min_count>' \\ --max-count '<max_count>' Enable cluster nodepool autoscaler # az aks nodepool update \\ --name '<name>' \\ --resource-group '<resource_group>' \\ --cluster-name '<cluster_name>' \\ --enable-cluster-autoscaler \\ --min-count '<min_count>' \\ --max-count '<max_count>' Links # Autoscale with Azure compute services Autoscaling Automatically scale a cluster to meet application demands on Azure Kubernetes Service (AKS) Scaling options for applications in Azure Kubernetes Service (AKS) Azure template reference","title":"Azure.AKS.AutoScaling"},{"location":"en/rules/Azure.AKS.AutoScaling/#enable-aks-cluster-autoscaler","text":"Azure.AKS.AutoScaling AZR-000019 Error Performance Efficiency \u00b7 Azure Kubernetes Service \u00b7 2021_09 Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present.","title":"Enable AKS cluster autoscaler"},{"location":"en/rules/Azure.AKS.AutoScaling/#description","text":"In addition to perform manual scaling, AKS clusters support autoscaling. Autoscaling reduces manual intervention required to scale a cluster to keep up with application demands.","title":"Description"},{"location":"en/rules/Azure.AKS.AutoScaling/#recommendation","text":"Consider enabling autoscaling for AKS clusters deployed with virtual machine scale sets.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.AutoScaling/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.AutoScaling/#configure-with-azure-template","text":"To set enable autoscaling for an AKS cluster: Set properties.agentPoolProfiles[*].enableAutoScaling to true . Set properties.agentPoolProfiles[*].type to VirtualMachineScaleSets . For example: { \"comments\" : \"Azure Kubernetes Cluster\" , \"apiVersion\" : \"2020-12-01\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ], \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"location\" : \"[parameters('location')]\" , \"name\" : \"[parameters('clusterName')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"disableLocalAccounts\" : true , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : [ { \"name\" : \"system\" , \"osDiskSizeGB\" : 32 , \"count\" : 3 , \"minCount\" : 3 , \"maxCount\" : 10 , \"enableAutoScaling\" : true , \"maxPods\" : 50 , \"vmSize\" : \"Standard_D2s_v3\" , \"osType\" : \"Linux\" , \"type\" : \"VirtualMachineScaleSets\" , \"vnetSubnetID\" : \"[variables('clusterSubnetId')]\" , \"mode\" : \"System\" , \"osDiskType\" : \"Ephemeral\" , \"scaleSetPriority\" : \"Regular\" } ], \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"Standard\" , \"serviceCidr\" : \"192.168.0.0/16\" , \"dnsServiceIP\" : \"192.168.0.4\" , \"dockerBridgeCidr\" : \"172.17.0.1/16\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false } } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.AutoScaling/#configure-with-azure-cli","text":"","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AKS.AutoScaling/#enable-cluster-autoscaler","text":"az aks update \\ --name '<name>' \\ --resource-group '<resource_group>' \\ --enable-cluster-autoscaler \\ --min-count '<min_count>' \\ --max-count '<max_count>'","title":"Enable cluster autoscaler"},{"location":"en/rules/Azure.AKS.AutoScaling/#enable-cluster-nodepool-autoscaler","text":"az aks nodepool update \\ --name '<name>' \\ --resource-group '<resource_group>' \\ --cluster-name '<cluster_name>' \\ --enable-cluster-autoscaler \\ --min-count '<min_count>' \\ --max-count '<max_count>'","title":"Enable cluster nodepool autoscaler"},{"location":"en/rules/Azure.AKS.AutoScaling/#links","text":"Autoscale with Azure compute services Autoscaling Automatically scale a cluster to meet application demands on Azure Kubernetes Service (AKS) Scaling options for applications in Azure Kubernetes Service (AKS) Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.AutoUpgrade/","tags":["Azure.AKS.AutoUpgrade","AZR-000036"],"text":"Set AKS auto-upgrade channel # Azure.AKS.AutoUpgrade AZR-000036 Error Operational Excellence \u00b7 Azure Kubernetes Service \u00b7 2021_12 Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Description # In additional to performing manual upgrades, AKS supports auto-upgrades. Auto-upgrades reduces manual intervention required to maintain an AKS cluster. To configure auto-upgrades select a release channel instead of the default none . The following release channels are available: none - Disables auto-upgrades. The default setting. patch - Automatically upgrade to the latest supported patch version of the current minor version. stable - Automatically upgrade to the latest supported patch release of the recommended minor version. This is N-1 of the current AKS non-preview minor version. rapid - Automatically upgrade to the latest supported patch of the latest support minor version. node-image - Automatically upgrade to the latest node image version. Normally upgraded weekly. Recommendation # Consider enabling auto-upgrades for AKS clusters by setting an auto-upgrade channel. Examples # Configure with Azure template # To deploy AKS clusters that pass this rule: Set properties.autoUpgradeProfile.upgradeChannel to an upgrade channel such as stable . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-07-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] } Configure with Bicep # To deploy AKS clusters that pass this rule: Set properties.autoUpgradeProfile.upgradeChannel to an upgrade channel such as stable . For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-07-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } } tags: tags } Configure with Azure CLI # az aks update -n '<name>' -g '<resource_group>' --auto-upgrade-channel 'stable' Links # Automation overview Supported Kubernetes versions in Azure Kubernetes Service Support policies for Azure Kubernetes Service Set auto-upgrade channel Azure template reference","title":"Azure.AKS.AutoUpgrade"},{"location":"en/rules/Azure.AKS.AutoUpgrade/#set-aks-auto-upgrade-channel","text":"Azure.AKS.AutoUpgrade AZR-000036 Error Operational Excellence \u00b7 Azure Kubernetes Service \u00b7 2021_12 Configure AKS to automatically upgrade to newer supported AKS versions as they are made available.","title":"Set AKS auto-upgrade channel"},{"location":"en/rules/Azure.AKS.AutoUpgrade/#description","text":"In additional to performing manual upgrades, AKS supports auto-upgrades. Auto-upgrades reduces manual intervention required to maintain an AKS cluster. To configure auto-upgrades select a release channel instead of the default none . The following release channels are available: none - Disables auto-upgrades. The default setting. patch - Automatically upgrade to the latest supported patch version of the current minor version. stable - Automatically upgrade to the latest supported patch release of the recommended minor version. This is N-1 of the current AKS non-preview minor version. rapid - Automatically upgrade to the latest supported patch of the latest support minor version. node-image - Automatically upgrade to the latest node image version. Normally upgraded weekly.","title":"Description"},{"location":"en/rules/Azure.AKS.AutoUpgrade/#recommendation","text":"Consider enabling auto-upgrades for AKS clusters by setting an auto-upgrade channel.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.AutoUpgrade/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.AutoUpgrade/#configure-with-azure-template","text":"To deploy AKS clusters that pass this rule: Set properties.autoUpgradeProfile.upgradeChannel to an upgrade channel such as stable . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-07-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.AutoUpgrade/#configure-with-bicep","text":"To deploy AKS clusters that pass this rule: Set properties.autoUpgradeProfile.upgradeChannel to an upgrade channel such as stable . For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-07-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AKS.AutoUpgrade/#configure-with-azure-cli","text":"az aks update -n '<name>' -g '<resource_group>' --auto-upgrade-channel 'stable'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AKS.AutoUpgrade/#links","text":"Automation overview Supported Kubernetes versions in Azure Kubernetes Service Support policies for Azure Kubernetes Service Set auto-upgrade channel Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.AvailabilityZone/","tags":["Azure.AKS.AvailabilityZone","AZR-000021"],"text":"AKS clusters should use Availability zones in supported regions # Azure.AKS.AvailabilityZone AZR-000021 Error Reliability \u00b7 Azure Kubernetes Service \u00b7 2021_09 AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Description # AKS clusters using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. Nodes in one availability zone are physically separated from nodes defined in another availability zone. By spreading node pools across multiple zones, nodes in one node pool will continue running even if another zone has gone down. Recommendation # Consider using availability zones for AKS clusters deployed with virtual machine scale sets. Notes # This rule applies when analyzing resources deployed to Azure using pre-flight and in-flight data. This rule fails when \"availabilityZones\" is null , [] or not set when the AKS cluster is deployed to a virtual machine scale set and there are supported availability zones for the given region. Configure AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST to set additional availability zones that need to be supported which are not in the existing providers for namespace Microsoft.Compute and resource type virtualMachineScaleSets . # YAML: The default AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option configuration : AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : [] Examples # Configure with Azure template # To set availability zones for an AKS cluster: Set properties.agentPoolProfiles[*].availabilityZones to any or all of [\"1\", \"2\", \"3\"] . Set properties.agentPoolProfiles[*].type to VirtualMachineScaleSets . For example: { \"comments\" : \"Azure Kubernetes Cluster\" , \"apiVersion\" : \"2020-12-01\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ], \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"location\" : \"[parameters('location')]\" , \"name\" : \"[parameters('clusterName')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"disableLocalAccounts\" : true , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : [ { \"name\" : \"system\" , \"osDiskSizeGB\" : 32 , \"count\" : 3 , \"minCount\" : 3 , \"maxCount\" : 10 , \"enableAutoScaling\" : true , \"maxPods\" : 50 , \"vmSize\" : \"Standard_D2s_v3\" , \"osType\" : \"Linux\" , \"type\" : \"VirtualMachineScaleSets\" , \"vnetSubnetID\" : \"[variables('clusterSubnetId')]\" , \"mode\" : \"System\" , \"osDiskType\" : \"Ephemeral\" , \"scaleSetPriority\" : \"Regular\" , \"availabilityZones\" : [ \"1\" , \"2\" , \"3\" ] } ], \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"Standard\" , \"serviceCidr\" : \"192.168.0.0/16\" , \"dnsServiceIP\" : \"192.168.0.4\" , \"dockerBridgeCidr\" : \"172.17.0.1/16\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false } } } } Configure with Azure CLI # Create AKS Cluster in Zone 1, 2 and 3 # az aks create \\ --resource-group '<resource_group>' \\ --name '<cluster_name>' \\ --generate-ssh-keys \\ --vm-set-type VirtualMachineScaleSets \\ --load-balancer-sku standard \\ --node-count '<node_count>' \\ --zones 1 2 3 Links # Azure template reference Create an Azure Kubernetes Service (AKS) cluster that uses availability zones Use zone-aware services","title":"Azure.AKS.AvailabilityZone"},{"location":"en/rules/Azure.AKS.AvailabilityZone/#aks-clusters-should-use-availability-zones-in-supported-regions","text":"Azure.AKS.AvailabilityZone AZR-000021 Error Reliability \u00b7 Azure Kubernetes Service \u00b7 2021_09 AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability.","title":"AKS clusters should use Availability zones in supported regions"},{"location":"en/rules/Azure.AKS.AvailabilityZone/#description","text":"AKS clusters using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. Nodes in one availability zone are physically separated from nodes defined in another availability zone. By spreading node pools across multiple zones, nodes in one node pool will continue running even if another zone has gone down.","title":"Description"},{"location":"en/rules/Azure.AKS.AvailabilityZone/#recommendation","text":"Consider using availability zones for AKS clusters deployed with virtual machine scale sets.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.AvailabilityZone/#notes","text":"This rule applies when analyzing resources deployed to Azure using pre-flight and in-flight data. This rule fails when \"availabilityZones\" is null , [] or not set when the AKS cluster is deployed to a virtual machine scale set and there are supported availability zones for the given region. Configure AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST to set additional availability zones that need to be supported which are not in the existing providers for namespace Microsoft.Compute and resource type virtualMachineScaleSets . # YAML: The default AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option configuration : AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : []","title":"Notes"},{"location":"en/rules/Azure.AKS.AvailabilityZone/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.AvailabilityZone/#configure-with-azure-template","text":"To set availability zones for an AKS cluster: Set properties.agentPoolProfiles[*].availabilityZones to any or all of [\"1\", \"2\", \"3\"] . Set properties.agentPoolProfiles[*].type to VirtualMachineScaleSets . For example: { \"comments\" : \"Azure Kubernetes Cluster\" , \"apiVersion\" : \"2020-12-01\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ], \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"location\" : \"[parameters('location')]\" , \"name\" : \"[parameters('clusterName')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"disableLocalAccounts\" : true , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : [ { \"name\" : \"system\" , \"osDiskSizeGB\" : 32 , \"count\" : 3 , \"minCount\" : 3 , \"maxCount\" : 10 , \"enableAutoScaling\" : true , \"maxPods\" : 50 , \"vmSize\" : \"Standard_D2s_v3\" , \"osType\" : \"Linux\" , \"type\" : \"VirtualMachineScaleSets\" , \"vnetSubnetID\" : \"[variables('clusterSubnetId')]\" , \"mode\" : \"System\" , \"osDiskType\" : \"Ephemeral\" , \"scaleSetPriority\" : \"Regular\" , \"availabilityZones\" : [ \"1\" , \"2\" , \"3\" ] } ], \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"Standard\" , \"serviceCidr\" : \"192.168.0.0/16\" , \"dnsServiceIP\" : \"192.168.0.4\" , \"dockerBridgeCidr\" : \"172.17.0.1/16\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false } } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.AvailabilityZone/#configure-with-azure-cli","text":"","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AKS.AvailabilityZone/#create-aks-cluster-in-zone-1-2-and-3","text":"az aks create \\ --resource-group '<resource_group>' \\ --name '<cluster_name>' \\ --generate-ssh-keys \\ --vm-set-type VirtualMachineScaleSets \\ --load-balancer-sku standard \\ --node-count '<node_count>' \\ --zones 1 2 3","title":"Create AKS Cluster in Zone 1, 2 and 3"},{"location":"en/rules/Azure.AKS.AvailabilityZone/#links","text":"Azure template reference Create an Azure Kubernetes Service (AKS) cluster that uses availability zones Use zone-aware services","title":"Links"},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/","tags":["Azure.AKS.AzurePolicyAddOn","AZR-000028"],"text":"Use Azure Policy Add-on with AKS clusters # Azure.AKS.AzurePolicyAddOn AZR-000028 Error Security \u00b7 Azure Kubernetes Service \u00b7 2020_12 Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Description # AKS clusters support integration with Azure Policy using an Open Policy Agent (OPA). Azure Policy integration is provided by an optional add-on that can be enabled on AKS clusters. Once enabled and Azure policies assigned, AKS clusters will enforce the configured constraints. Examples of policies include: Enforce HTTPS ingress in Kubernetes cluster. Do not allow privileged containers in Kubernetes cluster. Ensure container CPU and memory resource limits do not exceed the specified limits in Kubernetes cluster. Recommendation # Consider installing the Azure Policy Add-on for AKS clusters. Additionally, assign one or more Azure Policy definitions to security controls. Examples # Configure with Azure template # To deploy AKS clusters that pass this rule: Set properties.addonProfiles.azurepolicy.enabled to true . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } }, \"podIdentityProfile\" : { \"enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] } Configure with Bicep # To deploy AKS clusters that pass this rule: Set properties.addonProfiles.azurepolicy.enabled to true . For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-10-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } podIdentityProfile: { enabled: true } } tags: tags } Notes # Azure Policy for AKS clusters is generally available (GA). Azure Policy for AKS Engine and Arc enabled Kubernetes are currently in preview. Links # Governance, risk, and compliance Understand Azure Policy for Kubernetes clusters Secure your cluster with Azure Policy Azure template reference","title":"Azure.AKS.AzurePolicyAddOn"},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/#use-azure-policy-add-on-with-aks-clusters","text":"Azure.AKS.AzurePolicyAddOn AZR-000028 Error Security \u00b7 Azure Kubernetes Service \u00b7 2020_12 Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes.","title":"Use Azure Policy Add-on with AKS clusters"},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/#description","text":"AKS clusters support integration with Azure Policy using an Open Policy Agent (OPA). Azure Policy integration is provided by an optional add-on that can be enabled on AKS clusters. Once enabled and Azure policies assigned, AKS clusters will enforce the configured constraints. Examples of policies include: Enforce HTTPS ingress in Kubernetes cluster. Do not allow privileged containers in Kubernetes cluster. Ensure container CPU and memory resource limits do not exceed the specified limits in Kubernetes cluster.","title":"Description"},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/#recommendation","text":"Consider installing the Azure Policy Add-on for AKS clusters. Additionally, assign one or more Azure Policy definitions to security controls.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/#configure-with-azure-template","text":"To deploy AKS clusters that pass this rule: Set properties.addonProfiles.azurepolicy.enabled to true . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } }, \"podIdentityProfile\" : { \"enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/#configure-with-bicep","text":"To deploy AKS clusters that pass this rule: Set properties.addonProfiles.azurepolicy.enabled to true . For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-10-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } podIdentityProfile: { enabled: true } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/#notes","text":"Azure Policy for AKS clusters is generally available (GA). Azure Policy for AKS Engine and Arc enabled Kubernetes are currently in preview.","title":"Notes"},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/#links","text":"Governance, risk, and compliance Understand Azure Policy for Kubernetes clusters Secure your cluster with Azure Policy Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.AzureRBAC/","tags":["Azure.AKS.AzureRBAC","AZR-000032"],"text":"Use Azure RBAC for Kubernetes Authorization # Azure.AKS.AzureRBAC AZR-000032 Error Security \u00b7 Azure Kubernetes Service \u00b7 2021_06 Use Azure RBAC for Kubernetes Authorization with AKS clusters. Description # Azure Kubernetes Service (AKS) supports Role-based Access Control (RBAC). RBAC is supported using Kubernetes RBAC and optionally Azure RBAC. Using Kubernetes RBAC, you can grant users, groups, and service accounts access to cluster resources. Additionally AKS supports granting Azure AD identities access to cluster resources using Azure RBAC. Using authorization provided by Azure RBAC simplifies and centralizes authorization of Azure AD principals. Access to Kubernetes resource can be managed using Azure Resource Manager (ARM). When Azure RBAC is enabled: Azure AD principals will be validated exclusively by Azure RBAC. Kubernetes users and service accounts are exclusively validated by Kubernetes RBAC. Recommendation # Consider using Azure RBAC for Kubernetes Authorization to centralize authorization of Azure AD principals. Examples # Configure with Azure template # To deploy AKS clusters that pass this rule: Set properties.aadProfile.enableAzureRBAC to true . For example: { \"comments\" : \"Azure Kubernetes Cluster\" , \"apiVersion\" : \"2020-12-01\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ], \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"location\" : \"[parameters('location')]\" , \"name\" : \"[parameters('clusterName')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"disableLocalAccounts\" : true , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : [ { \"name\" : \"system\" , \"osDiskSizeGB\" : 32 , \"count\" : 3 , \"minCount\" : 3 , \"maxCount\" : 10 , \"enableAutoScaling\" : true , \"maxPods\" : 50 , \"vmSize\" : \"Standard_D2s_v3\" , \"osType\" : \"Linux\" , \"type\" : \"VirtualMachineScaleSets\" , \"vnetSubnetID\" : \"[variables('clusterSubnetId')]\" , \"mode\" : \"System\" , \"osDiskType\" : \"Ephemeral\" , \"scaleSetPriority\" : \"Regular\" } ], \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"Standard\" , \"serviceCidr\" : \"192.168.0.0/16\" , \"dnsServiceIP\" : \"192.168.0.4\" , \"dockerBridgeCidr\" : \"172.17.0.1/16\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false } } } } Configure with Azure CLI # az aks update -n '<name>' -g '<resource_group>' --enable-azure-rbac Links # Authorization with Azure AD Use Azure RBAC for Kubernetes Authorization Access and identity options for Azure Kubernetes Service (AKS) Azure template reference","title":"Azure.AKS.AzureRBAC"},{"location":"en/rules/Azure.AKS.AzureRBAC/#use-azure-rbac-for-kubernetes-authorization","text":"Azure.AKS.AzureRBAC AZR-000032 Error Security \u00b7 Azure Kubernetes Service \u00b7 2021_06 Use Azure RBAC for Kubernetes Authorization with AKS clusters.","title":"Use Azure RBAC for Kubernetes Authorization"},{"location":"en/rules/Azure.AKS.AzureRBAC/#description","text":"Azure Kubernetes Service (AKS) supports Role-based Access Control (RBAC). RBAC is supported using Kubernetes RBAC and optionally Azure RBAC. Using Kubernetes RBAC, you can grant users, groups, and service accounts access to cluster resources. Additionally AKS supports granting Azure AD identities access to cluster resources using Azure RBAC. Using authorization provided by Azure RBAC simplifies and centralizes authorization of Azure AD principals. Access to Kubernetes resource can be managed using Azure Resource Manager (ARM). When Azure RBAC is enabled: Azure AD principals will be validated exclusively by Azure RBAC. Kubernetes users and service accounts are exclusively validated by Kubernetes RBAC.","title":"Description"},{"location":"en/rules/Azure.AKS.AzureRBAC/#recommendation","text":"Consider using Azure RBAC for Kubernetes Authorization to centralize authorization of Azure AD principals.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.AzureRBAC/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.AzureRBAC/#configure-with-azure-template","text":"To deploy AKS clusters that pass this rule: Set properties.aadProfile.enableAzureRBAC to true . For example: { \"comments\" : \"Azure Kubernetes Cluster\" , \"apiVersion\" : \"2020-12-01\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ], \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"location\" : \"[parameters('location')]\" , \"name\" : \"[parameters('clusterName')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"disableLocalAccounts\" : true , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : [ { \"name\" : \"system\" , \"osDiskSizeGB\" : 32 , \"count\" : 3 , \"minCount\" : 3 , \"maxCount\" : 10 , \"enableAutoScaling\" : true , \"maxPods\" : 50 , \"vmSize\" : \"Standard_D2s_v3\" , \"osType\" : \"Linux\" , \"type\" : \"VirtualMachineScaleSets\" , \"vnetSubnetID\" : \"[variables('clusterSubnetId')]\" , \"mode\" : \"System\" , \"osDiskType\" : \"Ephemeral\" , \"scaleSetPriority\" : \"Regular\" } ], \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"Standard\" , \"serviceCidr\" : \"192.168.0.0/16\" , \"dnsServiceIP\" : \"192.168.0.4\" , \"dockerBridgeCidr\" : \"172.17.0.1/16\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false } } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.AzureRBAC/#configure-with-azure-cli","text":"az aks update -n '<name>' -g '<resource_group>' --enable-azure-rbac","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AKS.AzureRBAC/#links","text":"Authorization with Azure AD Use Azure RBAC for Kubernetes Authorization Access and identity options for Azure Kubernetes Service (AKS) Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.CNISubnetSize/","tags":["Azure.AKS.CNISubnetSize","AZR-000020"],"text":"AKS clusters using Azure CNI should use large subnets # Azure.AKS.CNISubnetSize AZR-000020 Error Performance Efficiency \u00b7 Azure Kubernetes Service \u00b7 2021_09 AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Description # In addition to kubenet, AKS clusters support Azure Container Networking Interface (CNI). This enables every pod to be accessed directly from the subnet via an IP address. Each node supports a maximum number of pods, which are reserved as IP addresses. This approach requires more capacity planning ahead of time, and can result in IP address exhaustion or the need to rebuild AKS clusters into larger subnets as application workloads begin to grow. Recommendation # Consider allocating a large subnet(/23 or bigger) to your AKS cluster. Notes # This rule applies when analyzing resources deployed to Azure using Export in-flight resource data . This rule fails when the CNI subnet size is smaller than /23. Configure AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE to set the minimum AKS CNI cluster subnet size. # YAML: The default AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE configuration option configuration : AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE : 23 Links # Configure Azure CNI networking in Azure Kubernetes Service (AKS) Plan for growth Use kubenet networking with your own IP address ranges in Azure Kubernetes Service (AKS) Tutorial: Configure Azure CNI networking in Azure Kubernetes Service (AKS) using Ansible","title":"Azure.AKS.CNISubnetSize"},{"location":"en/rules/Azure.AKS.CNISubnetSize/#aks-clusters-using-azure-cni-should-use-large-subnets","text":"Azure.AKS.CNISubnetSize AZR-000020 Error Performance Efficiency \u00b7 Azure Kubernetes Service \u00b7 2021_09 AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues.","title":"AKS clusters using Azure CNI should use large subnets"},{"location":"en/rules/Azure.AKS.CNISubnetSize/#description","text":"In addition to kubenet, AKS clusters support Azure Container Networking Interface (CNI). This enables every pod to be accessed directly from the subnet via an IP address. Each node supports a maximum number of pods, which are reserved as IP addresses. This approach requires more capacity planning ahead of time, and can result in IP address exhaustion or the need to rebuild AKS clusters into larger subnets as application workloads begin to grow.","title":"Description"},{"location":"en/rules/Azure.AKS.CNISubnetSize/#recommendation","text":"Consider allocating a large subnet(/23 or bigger) to your AKS cluster.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.CNISubnetSize/#notes","text":"This rule applies when analyzing resources deployed to Azure using Export in-flight resource data . This rule fails when the CNI subnet size is smaller than /23. Configure AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE to set the minimum AKS CNI cluster subnet size. # YAML: The default AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE configuration option configuration : AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE : 23","title":"Notes"},{"location":"en/rules/Azure.AKS.CNISubnetSize/#links","text":"Configure Azure CNI networking in Azure Kubernetes Service (AKS) Plan for growth Use kubenet networking with your own IP address ranges in Azure Kubernetes Service (AKS) Tutorial: Configure Azure CNI networking in Azure Kubernetes Service (AKS) using Ansible","title":"Links"},{"location":"en/rules/Azure.AKS.ContainerInsights/","tags":["Azure.AKS.ContainerInsights","AZR-000041"],"text":"Enable AKS Container insights # Azure.AKS.ContainerInsights AZR-000041 Error Operational Excellence \u00b7 Azure Kubernetes Service \u00b7 2021_09 Enable Container insights to monitor AKS cluster workloads. Description # With Container insights, you can use performance charts and health status to monitor AKS clusters, nodes and pods. Container insights delivers quick, visual and actionable information: from the CPU and memory pressure of your nodes to the logs of individual Kubernetes pods. Recommendation # Consider enabling Container insights for AKS clusters. Monitoring containers is critical, especially when running production AKS clusters at scale with multiple applications. Examples # Configure with Azure template # To enable Container insights for an AKS cluster: Set properties.addonProfiles.omsAgent.enabled to true . Set Log Analytics workspace ID with properties.addonProfiles.omsAgent.config.logAnalyticsWorkspaceResourceID . For example: { \"comments\" : \"Azure Kubernetes Cluster\" , \"apiVersion\" : \"2020-12-01\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ], \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"location\" : \"[parameters('location')]\" , \"name\" : \"[parameters('clusterName')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"disableLocalAccounts\" : true , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : [ { \"name\" : \"system\" , \"osDiskSizeGB\" : 32 , \"count\" : 3 , \"minCount\" : 3 , \"maxCount\" : 10 , \"enableAutoScaling\" : true , \"maxPods\" : 50 , \"vmSize\" : \"Standard_D2s_v3\" , \"osType\" : \"Linux\" , \"type\" : \"VirtualMachineScaleSets\" , \"vnetSubnetID\" : \"[variables('clusterSubnetId')]\" , \"mode\" : \"System\" , \"osDiskType\" : \"Ephemeral\" , \"scaleSetPriority\" : \"Regular\" } ], \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"Standard\" , \"serviceCidr\" : \"192.168.0.0/16\" , \"dnsServiceIP\" : \"192.168.0.4\" , \"dockerBridgeCidr\" : \"172.17.0.1/16\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false } } } } Configure with Azure CLI # Enable for default Log Analytics workspace # az aks enable-addons \\ --addons monitoring \\ --name '<cluster_name>' \\ --resource-group '<cluster_resource_group>' Enable for an existing Log Analytics workspace # az aks enable-addons \\ --addons monitoring \\ --name '<cluster_name>' \\ --resource-group '<cluster_resource_group>' \\ --workspace-resource-id '<workspace_id>' Links # Container Insights Monitor your Kubernetes cluster performance with Container insights Container insights overview Enable monitoring of a new Azure Kubernetes Service (AKS) cluster Enable monitoring of Azure Kubernetes Service (AKS) cluster already deployed Azure template reference","title":"Azure.AKS.ContainerInsights"},{"location":"en/rules/Azure.AKS.ContainerInsights/#enable-aks-container-insights","text":"Azure.AKS.ContainerInsights AZR-000041 Error Operational Excellence \u00b7 Azure Kubernetes Service \u00b7 2021_09 Enable Container insights to monitor AKS cluster workloads.","title":"Enable AKS Container insights"},{"location":"en/rules/Azure.AKS.ContainerInsights/#description","text":"With Container insights, you can use performance charts and health status to monitor AKS clusters, nodes and pods. Container insights delivers quick, visual and actionable information: from the CPU and memory pressure of your nodes to the logs of individual Kubernetes pods.","title":"Description"},{"location":"en/rules/Azure.AKS.ContainerInsights/#recommendation","text":"Consider enabling Container insights for AKS clusters. Monitoring containers is critical, especially when running production AKS clusters at scale with multiple applications.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.ContainerInsights/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.ContainerInsights/#configure-with-azure-template","text":"To enable Container insights for an AKS cluster: Set properties.addonProfiles.omsAgent.enabled to true . Set Log Analytics workspace ID with properties.addonProfiles.omsAgent.config.logAnalyticsWorkspaceResourceID . For example: { \"comments\" : \"Azure Kubernetes Cluster\" , \"apiVersion\" : \"2020-12-01\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ], \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"location\" : \"[parameters('location')]\" , \"name\" : \"[parameters('clusterName')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"disableLocalAccounts\" : true , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : [ { \"name\" : \"system\" , \"osDiskSizeGB\" : 32 , \"count\" : 3 , \"minCount\" : 3 , \"maxCount\" : 10 , \"enableAutoScaling\" : true , \"maxPods\" : 50 , \"vmSize\" : \"Standard_D2s_v3\" , \"osType\" : \"Linux\" , \"type\" : \"VirtualMachineScaleSets\" , \"vnetSubnetID\" : \"[variables('clusterSubnetId')]\" , \"mode\" : \"System\" , \"osDiskType\" : \"Ephemeral\" , \"scaleSetPriority\" : \"Regular\" } ], \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"Standard\" , \"serviceCidr\" : \"192.168.0.0/16\" , \"dnsServiceIP\" : \"192.168.0.4\" , \"dockerBridgeCidr\" : \"172.17.0.1/16\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false } } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.ContainerInsights/#configure-with-azure-cli","text":"","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AKS.ContainerInsights/#enable-for-default-log-analytics-workspace","text":"az aks enable-addons \\ --addons monitoring \\ --name '<cluster_name>' \\ --resource-group '<cluster_resource_group>'","title":"Enable for default Log Analytics workspace"},{"location":"en/rules/Azure.AKS.ContainerInsights/#enable-for-an-existing-log-analytics-workspace","text":"az aks enable-addons \\ --addons monitoring \\ --name '<cluster_name>' \\ --resource-group '<cluster_resource_group>' \\ --workspace-resource-id '<workspace_id>'","title":"Enable for an existing Log Analytics workspace"},{"location":"en/rules/Azure.AKS.ContainerInsights/#links","text":"Container Insights Monitor your Kubernetes cluster performance with Container insights Container insights overview Enable monitoring of a new Azure Kubernetes Service (AKS) cluster Enable monitoring of Azure Kubernetes Service (AKS) cluster already deployed Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.DNSPrefix/","tags":["Azure.AKS.DNSPrefix","AZR-000040"],"text":"Use valid AKS cluster DNS prefix # Azure.AKS.DNSPrefix AZR-000040 Error Operational Excellence \u00b7 Azure Kubernetes Service \u00b7 2020_06 Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Description # The DNS prefix for AKS clusters has different requirements then the cluster name. The requirements for DNS prefixes are: Between 1 and 54 characters long. Alphanumerics and hyphens. Start and end with alphanumeric. Recommendation # Consider using a DNS prefix that meets naming requirements. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Recommended abbreviations for Azure resource types Azure template reference","title":"Azure.AKS.DNSPrefix"},{"location":"en/rules/Azure.AKS.DNSPrefix/#use-valid-aks-cluster-dns-prefix","text":"Azure.AKS.DNSPrefix AZR-000040 Error Operational Excellence \u00b7 Azure Kubernetes Service \u00b7 2020_06 Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements.","title":"Use valid AKS cluster DNS prefix"},{"location":"en/rules/Azure.AKS.DNSPrefix/#description","text":"The DNS prefix for AKS clusters has different requirements then the cluster name. The requirements for DNS prefixes are: Between 1 and 54 characters long. Alphanumerics and hyphens. Start and end with alphanumeric.","title":"Description"},{"location":"en/rules/Azure.AKS.DNSPrefix/#recommendation","text":"Consider using a DNS prefix that meets naming requirements.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.DNSPrefix/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Recommended abbreviations for Azure resource types Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.HttpAppRouting/","tags":["Azure.AKS.HttpAppRouting","AZR-000035"],"text":"Disable HTTP application routing add-on # Azure.AKS.HttpAppRouting AZR-000035 Error Security \u00b7 Azure Kubernetes Service \u00b7 2021_12 Disable HTTP application routing add-on in AKS clusters. Description # The HTTP application routing add-on is designed to quickly expose HTTP endpoints to the public internet. This may be helpful in some limited scenarios, but should not be used in production. When exposing application endpoints consider using an ingress controller that supports: Security filtering behind web application firewall (WAF). Encyption in transit over TLS. Multiple replicas. Azure provides a production ready ingress controller Application Gateway Ingress Controller (AGIC). Recommendation # Consider disabling the HTTP application routing add-on in your AKS cluster. Also consider using Application Gateway Ingress Controller (AGIC) instead to protect application endpoints. Examples # Configure with Azure template # To deploy AKS clusters that pass this rule: Set Properties.addonProfiles.httpApplicationRouting.enabled to false . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-07-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] } Configure with Bicep # To deploy AKS clusters that pass this rule: Set Properties.addonProfiles.httpApplicationRouting.enabled to false . For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-07-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } } tags: tags } Links # Best practices for endpoint security on Azure HTTP application routing Enable Application Gateway Ingress Controller add-on for an existing AKS cluster Azure template reference","title":"Azure.AKS.HttpAppRouting"},{"location":"en/rules/Azure.AKS.HttpAppRouting/#disable-http-application-routing-add-on","text":"Azure.AKS.HttpAppRouting AZR-000035 Error Security \u00b7 Azure Kubernetes Service \u00b7 2021_12 Disable HTTP application routing add-on in AKS clusters.","title":"Disable HTTP application routing add-on"},{"location":"en/rules/Azure.AKS.HttpAppRouting/#description","text":"The HTTP application routing add-on is designed to quickly expose HTTP endpoints to the public internet. This may be helpful in some limited scenarios, but should not be used in production. When exposing application endpoints consider using an ingress controller that supports: Security filtering behind web application firewall (WAF). Encyption in transit over TLS. Multiple replicas. Azure provides a production ready ingress controller Application Gateway Ingress Controller (AGIC).","title":"Description"},{"location":"en/rules/Azure.AKS.HttpAppRouting/#recommendation","text":"Consider disabling the HTTP application routing add-on in your AKS cluster. Also consider using Application Gateway Ingress Controller (AGIC) instead to protect application endpoints.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.HttpAppRouting/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.HttpAppRouting/#configure-with-azure-template","text":"To deploy AKS clusters that pass this rule: Set Properties.addonProfiles.httpApplicationRouting.enabled to false . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-07-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.HttpAppRouting/#configure-with-bicep","text":"To deploy AKS clusters that pass this rule: Set Properties.addonProfiles.httpApplicationRouting.enabled to false . For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-07-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AKS.HttpAppRouting/#links","text":"Best practices for endpoint security on Azure HTTP application routing Enable Application Gateway Ingress Controller add-on for an existing AKS cluster Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.LocalAccounts/","tags":["Azure.AKS.LocalAccounts","AZR-000031"],"text":"Disable AKS local accounts # Azure.AKS.LocalAccounts AZR-000031 Error Security \u00b7 Azure Kubernetes Service \u00b7 Preview \u00b7 2021_06 Enforce named user accounts with RBAC assigned permissions. Description # AKS clusters support Role-based Access Control (RBAC). RBAC allows users, groups, and service accounts to be granted access to resources on an as needed basis. Actions performed by each identity can be logged for auditing with Kubernetes audit policies. Additionally some default cluster local account credentials are enabled by default. When enabled, an identity with permissions can perform cluster actions using local account credentials. If local account credentials are used, Kubernetes auditing logs the local account instead of named accounts. In an AKS cluster with local account disabled administrator will be unable to get the clusterAdmin credential. For example, using az aks get-credentials -g '<resource-group>' -n '<cluster-name>' --admin will fail. Recommendation # Consider enforcing usage of named accounts by disabling local Kubernetes account credentials. Examples # Configure with Azure template # To deploy AKS clusters that pass this rule: Set properties.disableLocalAccounts to true . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"disableLocalAccounts\" : true , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } }, \"podIdentityProfile\" : { \"enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] } Configure with Bicep # To deploy AKS clusters that pass this rule: Set properties.disableLocalAccounts to true . For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-10-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion disableLocalAccounts: true enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } podIdentityProfile: { enabled: true } } tags: tags } Configure with Azure CLI # az aks update -n '<name>' -g '<resource_group>' --enable-aad --aad-admin-group-object-ids '<aad-group-id>' --disable-local Notes # This Azure feature is currently in preview. To use this feature you must first opt-in by registering the feature on a per-subscription basis. Links # Authorization with Azure AD Security design principles Disable local accounts (preview) Access and identity options for Azure Kubernetes Service (AKS) Azure template reference","title":"Azure.AKS.LocalAccounts"},{"location":"en/rules/Azure.AKS.LocalAccounts/#disable-aks-local-accounts","text":"Azure.AKS.LocalAccounts AZR-000031 Error Security \u00b7 Azure Kubernetes Service \u00b7 Preview \u00b7 2021_06 Enforce named user accounts with RBAC assigned permissions.","title":"Disable AKS local accounts"},{"location":"en/rules/Azure.AKS.LocalAccounts/#description","text":"AKS clusters support Role-based Access Control (RBAC). RBAC allows users, groups, and service accounts to be granted access to resources on an as needed basis. Actions performed by each identity can be logged for auditing with Kubernetes audit policies. Additionally some default cluster local account credentials are enabled by default. When enabled, an identity with permissions can perform cluster actions using local account credentials. If local account credentials are used, Kubernetes auditing logs the local account instead of named accounts. In an AKS cluster with local account disabled administrator will be unable to get the clusterAdmin credential. For example, using az aks get-credentials -g '<resource-group>' -n '<cluster-name>' --admin will fail.","title":"Description"},{"location":"en/rules/Azure.AKS.LocalAccounts/#recommendation","text":"Consider enforcing usage of named accounts by disabling local Kubernetes account credentials.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.LocalAccounts/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.LocalAccounts/#configure-with-azure-template","text":"To deploy AKS clusters that pass this rule: Set properties.disableLocalAccounts to true . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"disableLocalAccounts\" : true , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } }, \"podIdentityProfile\" : { \"enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.LocalAccounts/#configure-with-bicep","text":"To deploy AKS clusters that pass this rule: Set properties.disableLocalAccounts to true . For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-10-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion disableLocalAccounts: true enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } podIdentityProfile: { enabled: true } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AKS.LocalAccounts/#configure-with-azure-cli","text":"az aks update -n '<name>' -g '<resource_group>' --enable-aad --aad-admin-group-object-ids '<aad-group-id>' --disable-local","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AKS.LocalAccounts/#notes","text":"This Azure feature is currently in preview. To use this feature you must first opt-in by registering the feature on a per-subscription basis.","title":"Notes"},{"location":"en/rules/Azure.AKS.LocalAccounts/#links","text":"Authorization with Azure AD Security design principles Disable local accounts (preview) Access and identity options for Azure Kubernetes Service (AKS) Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.ManagedAAD/","tags":["Azure.AKS.ManagedAAD","AZR-000029"],"text":"Enable AKS-managed Azure AD # Azure.AKS.ManagedAAD AZR-000029 Error Security \u00b7 Azure Kubernetes Service \u00b7 2021_06 Use AKS-managed Azure AD to simplify authorization and improve security. Description # AKS-managed integration provides an easy way to use Azure AD authorization for AKS. Previous Azure AD integration with AKS required app registration and management within Azure AD. Recommendation # Consider configuring AKS-managed Azure AD integration for AKS clusters. Examples # Configure with Azure template # To deploy AKS clusters that pass this rule: Set properties.aadProfile.managed to true . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"disableLocalAccounts\" : true , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } }, \"podIdentityProfile\" : { \"enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] } Configure with Bicep # To deploy AKS clusters that pass this rule: Set properties.aadProfile.managed to true . For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-10-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion disableLocalAccounts: true enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } podIdentityProfile: { enabled: true } } tags: tags } Configure with Azure CLI # az aks update -n '<name>' -g '<resource_group>' --enable-aad --aad-admin-group-object-ids '<group_id>' Links # Authorization with Azure AD Security design principles Access and identity options for Azure Kubernetes Service (AKS) AKS-managed Azure Active Directory integration Azure template reference","title":"Azure.AKS.ManagedAAD"},{"location":"en/rules/Azure.AKS.ManagedAAD/#enable-aks-managed-azure-ad","text":"Azure.AKS.ManagedAAD AZR-000029 Error Security \u00b7 Azure Kubernetes Service \u00b7 2021_06 Use AKS-managed Azure AD to simplify authorization and improve security.","title":"Enable AKS-managed Azure AD"},{"location":"en/rules/Azure.AKS.ManagedAAD/#description","text":"AKS-managed integration provides an easy way to use Azure AD authorization for AKS. Previous Azure AD integration with AKS required app registration and management within Azure AD.","title":"Description"},{"location":"en/rules/Azure.AKS.ManagedAAD/#recommendation","text":"Consider configuring AKS-managed Azure AD integration for AKS clusters.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.ManagedAAD/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.ManagedAAD/#configure-with-azure-template","text":"To deploy AKS clusters that pass this rule: Set properties.aadProfile.managed to true . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"disableLocalAccounts\" : true , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } }, \"podIdentityProfile\" : { \"enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.ManagedAAD/#configure-with-bicep","text":"To deploy AKS clusters that pass this rule: Set properties.aadProfile.managed to true . For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-10-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion disableLocalAccounts: true enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } podIdentityProfile: { enabled: true } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AKS.ManagedAAD/#configure-with-azure-cli","text":"az aks update -n '<name>' -g '<resource_group>' --enable-aad --aad-admin-group-object-ids '<group_id>'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AKS.ManagedAAD/#links","text":"Authorization with Azure AD Security design principles Access and identity options for Azure Kubernetes Service (AKS) AKS-managed Azure Active Directory integration Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.ManagedIdentity/","tags":["Azure.AKS.ManagedIdentity","AZR-000025"],"text":"Use managed identities for AKS cluster authentication # Azure.AKS.ManagedIdentity AZR-000025 Error Operational Excellence \u00b7 Azure Kubernetes Service \u00b7 2020_06 Configure AKS clusters to use managed identities for managing cluster infrastructure. Description # During the lifecycle of an AKS cluster, the control plane configures a number of Azure resources. This includes node pools, networking, storage and other supporting services. When making calls against the Azure REST APIs, an identity must be used to authenticate requests. The type of identity the control plane will use is configurable at cluster creation. Either a service principal or system-assigned managed identity can be used. By default, the service principal credentials are valid for one year. Service principal credentials must be rotated before expiry to prevent issues. You can update or rotate the service principal credentials at any time. Using a system-assigned managed identity abstracts the process of managing a service principal. The managed identity is automatically created/ removed with the cluster. Managed identities also reduce maintenance (and improve security) by automatically rotating credentials. Separately, applications within an AKS cluster may use managed identities with AAD Pod Identity. Recommendation # Consider using managed identities during AKS cluster creation. Additionally, consider redeploying the AKS cluster with managed identities instead of service principals. Notes # AKS clusters can not be updated to use managed identities for cluster infrastructure after deployment. Links # Use identity-based authentication Use managed identities in Azure Kubernetes Service What are managed identities for Azure resources? Azure template reference","title":"Azure.AKS.ManagedIdentity"},{"location":"en/rules/Azure.AKS.ManagedIdentity/#use-managed-identities-for-aks-cluster-authentication","text":"Azure.AKS.ManagedIdentity AZR-000025 Error Operational Excellence \u00b7 Azure Kubernetes Service \u00b7 2020_06 Configure AKS clusters to use managed identities for managing cluster infrastructure.","title":"Use managed identities for AKS cluster authentication"},{"location":"en/rules/Azure.AKS.ManagedIdentity/#description","text":"During the lifecycle of an AKS cluster, the control plane configures a number of Azure resources. This includes node pools, networking, storage and other supporting services. When making calls against the Azure REST APIs, an identity must be used to authenticate requests. The type of identity the control plane will use is configurable at cluster creation. Either a service principal or system-assigned managed identity can be used. By default, the service principal credentials are valid for one year. Service principal credentials must be rotated before expiry to prevent issues. You can update or rotate the service principal credentials at any time. Using a system-assigned managed identity abstracts the process of managing a service principal. The managed identity is automatically created/ removed with the cluster. Managed identities also reduce maintenance (and improve security) by automatically rotating credentials. Separately, applications within an AKS cluster may use managed identities with AAD Pod Identity.","title":"Description"},{"location":"en/rules/Azure.AKS.ManagedIdentity/#recommendation","text":"Consider using managed identities during AKS cluster creation. Additionally, consider redeploying the AKS cluster with managed identities instead of service principals.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.ManagedIdentity/#notes","text":"AKS clusters can not be updated to use managed identities for cluster infrastructure after deployment.","title":"Notes"},{"location":"en/rules/Azure.AKS.ManagedIdentity/#links","text":"Use identity-based authentication Use managed identities in Azure Kubernetes Service What are managed identities for Azure resources? Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.MinNodeCount/","tags":["Azure.AKS.MinNodeCount","AZR-000024"],"text":"Azure.AKS.MinNodeCount # Azure.AKS.MinNodeCount AZR-000024 Error Reliability \u00b7 Azure Kubernetes Service \u00b7 2020_06 AKS clusters should have minimum number of nodes for failover and updates. Description # Kubernetes clusters should have minimum number of three (3) nodes for high availability and planned maintenance. Recommendation # Use at least three (3) agent nodes. Consider deploying additional nodes as required to provide enough resiliency during nodes failures or planned maintenance. Links # Baseline architecture for an Azure Kubernetes Service (AKS) cluster Create an AKS cluster Azure template reference","title":"Azure.AKS.MinNodeCount"},{"location":"en/rules/Azure.AKS.MinNodeCount/#azureaksminnodecount","text":"Azure.AKS.MinNodeCount AZR-000024 Error Reliability \u00b7 Azure Kubernetes Service \u00b7 2020_06 AKS clusters should have minimum number of nodes for failover and updates.","title":"Azure.AKS.MinNodeCount"},{"location":"en/rules/Azure.AKS.MinNodeCount/#description","text":"Kubernetes clusters should have minimum number of three (3) nodes for high availability and planned maintenance.","title":"Description"},{"location":"en/rules/Azure.AKS.MinNodeCount/#recommendation","text":"Use at least three (3) agent nodes. Consider deploying additional nodes as required to provide enough resiliency during nodes failures or planned maintenance.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.MinNodeCount/#links","text":"Baseline architecture for an Azure Kubernetes Service (AKS) cluster Create an AKS cluster Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.Name/","tags":["Azure.AKS.Name","AZR-000039"],"text":"Use valid AKS cluster names # Azure.AKS.Name AZR-000039 Error Operational Excellence \u00b7 Azure Kubernetes Service \u00b7 2020_06 Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for AKS cluster names are: Between 1 and 63 characters long. Alphanumerics, underscores, and hyphens. Start and end with alphanumeric. Cluster names must be unique within a resource group. Recommendation # Consider using names that meet AKS cluster naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if cluster names are unique. Cluster DNS prefix has different naming requirements then cluster name. The requirements for DNS prefixes are: Between 1 and 54 characters long. Alphanumerics and hyphens. Start and end with alphanumeric. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Recommended abbreviations for Azure resource types Azure template reference","title":"Azure.AKS.Name"},{"location":"en/rules/Azure.AKS.Name/#use-valid-aks-cluster-names","text":"Azure.AKS.Name AZR-000039 Error Operational Excellence \u00b7 Azure Kubernetes Service \u00b7 2020_06 Azure Kubernetes Service (AKS) cluster names should meet naming requirements.","title":"Use valid AKS cluster names"},{"location":"en/rules/Azure.AKS.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for AKS cluster names are: Between 1 and 63 characters long. Alphanumerics, underscores, and hyphens. Start and end with alphanumeric. Cluster names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.AKS.Name/#recommendation","text":"Consider using names that meet AKS cluster naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.Name/#notes","text":"This rule does not check if cluster names are unique. Cluster DNS prefix has different naming requirements then cluster name. The requirements for DNS prefixes are: Between 1 and 54 characters long. Alphanumerics and hyphens. Start and end with alphanumeric.","title":"Notes"},{"location":"en/rules/Azure.AKS.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Recommended abbreviations for Azure resource types Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.NetworkPolicy/","tags":["Azure.AKS.NetworkPolicy","AZR-000027"],"text":"AKS clusters use Network Policies # Azure.AKS.NetworkPolicy AZR-000027 Error Security \u00b7 Azure Kubernetes Service \u00b7 2020_06 Deploy AKS clusters with Network Policies enabled. Description # AKS clusters provides a platform to host containerized workloads. The running of these applications or services is orchestrated by Kubernetes. Workloads may elasticly scale or change network addressing. By default, all pods in an AKS cluster can send and receive traffic without limitations. Network Policy defines access policies for limiting network communication of pods. Using Network Policies allows network controls to be applied with the context of the workload. For improved security, define network policy rules to control the flow of traffic. For example, only permit backend components to receive traffic from frontend components. To use Network Policy it must be enabled at cluster deployment time. AKS supports two implementations of network policies, Azure Network Policies and Calico Network Policies. Azure Network Policies are supported by Azure support and engineering teams. Recommendation # Consider deploying AKS clusters with network policy enabled to extend network segmentation into clusters. Examples # Configure with Azure template # To deploy AKS clusters that pass this rule: Set Properties.networkProfile.networkPolicy to azure or calico . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-07-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"[parameters('upgradeChannel')]\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"[string(parameters('useSecretRotation'))]\" } }, \"openServiceMesh\" : { \"enabled\" : \"[parameters('useOpenServiceMesh')]\" } } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] } Configure with Bicep # To deploy AKS clusters that pass this rule: Set Properties.networkProfile.networkPolicy to azure or calico . For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-07-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: upgradeChannel } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: string(useSecretRotation) } } openServiceMesh: { enabled: useOpenServiceMesh } } } tags: tags } Notes # Network Policy is a deployment time configuration. AKS clusters must be redeployed to enable Network Policy. Links # Implement network segmentation patterns on Azure Secure traffic between pods using network policies in Azure Kubernetes Service (AKS) Best practices for network connectivity and security in Azure Kubernetes Service (AKS) Network Policies Azure template reference","title":"Azure.AKS.NetworkPolicy"},{"location":"en/rules/Azure.AKS.NetworkPolicy/#aks-clusters-use-network-policies","text":"Azure.AKS.NetworkPolicy AZR-000027 Error Security \u00b7 Azure Kubernetes Service \u00b7 2020_06 Deploy AKS clusters with Network Policies enabled.","title":"AKS clusters use Network Policies"},{"location":"en/rules/Azure.AKS.NetworkPolicy/#description","text":"AKS clusters provides a platform to host containerized workloads. The running of these applications or services is orchestrated by Kubernetes. Workloads may elasticly scale or change network addressing. By default, all pods in an AKS cluster can send and receive traffic without limitations. Network Policy defines access policies for limiting network communication of pods. Using Network Policies allows network controls to be applied with the context of the workload. For improved security, define network policy rules to control the flow of traffic. For example, only permit backend components to receive traffic from frontend components. To use Network Policy it must be enabled at cluster deployment time. AKS supports two implementations of network policies, Azure Network Policies and Calico Network Policies. Azure Network Policies are supported by Azure support and engineering teams.","title":"Description"},{"location":"en/rules/Azure.AKS.NetworkPolicy/#recommendation","text":"Consider deploying AKS clusters with network policy enabled to extend network segmentation into clusters.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.NetworkPolicy/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.NetworkPolicy/#configure-with-azure-template","text":"To deploy AKS clusters that pass this rule: Set Properties.networkProfile.networkPolicy to azure or calico . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-07-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"[parameters('upgradeChannel')]\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"[string(parameters('useSecretRotation'))]\" } }, \"openServiceMesh\" : { \"enabled\" : \"[parameters('useOpenServiceMesh')]\" } } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.NetworkPolicy/#configure-with-bicep","text":"To deploy AKS clusters that pass this rule: Set Properties.networkProfile.networkPolicy to azure or calico . For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-07-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: upgradeChannel } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: string(useSecretRotation) } } openServiceMesh: { enabled: useOpenServiceMesh } } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AKS.NetworkPolicy/#notes","text":"Network Policy is a deployment time configuration. AKS clusters must be redeployed to enable Network Policy.","title":"Notes"},{"location":"en/rules/Azure.AKS.NetworkPolicy/#links","text":"Implement network segmentation patterns on Azure Secure traffic between pods using network policies in Azure Kubernetes Service (AKS) Best practices for network connectivity and security in Azure Kubernetes Service (AKS) Network Policies Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.NodeMinPods/","tags":["Azure.AKS.NodeMinPods","AZR-000018"],"text":"Nodes use a minimum number of pods # Azure.AKS.NodeMinPods AZR-000018 Error Performance Efficiency \u00b7 Azure Kubernetes Service \u00b7 2020_06 Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Description # Node pools within a Azure Kubernetes Cluster (AKS) support between 30 and 250 pods per node. The maximum number of pods for nodes within a node pool is set at deployment time. When deploying AKS clusters with kubernet networking the default maximum number of pods is 110. For Azure CNI AKS clusters, the default maximum number of pods is 30. In many environments, deploying DaemonSets for monitoring and management tools can exhaust the CNI default. Recommendation # Consider deploying node pools with a minimum number of pods per node. Notes # By default, this rule fails when node pools have maxPods set to less than 50. To configure this rule: Override the Azure_AKSNodeMinimumMaxPods configuration value with the minimum maxPods. Links # Azure template reference","title":"Azure.AKS.NodeMinPods"},{"location":"en/rules/Azure.AKS.NodeMinPods/#nodes-use-a-minimum-number-of-pods","text":"Azure.AKS.NodeMinPods AZR-000018 Error Performance Efficiency \u00b7 Azure Kubernetes Service \u00b7 2020_06 Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods.","title":"Nodes use a minimum number of pods"},{"location":"en/rules/Azure.AKS.NodeMinPods/#description","text":"Node pools within a Azure Kubernetes Cluster (AKS) support between 30 and 250 pods per node. The maximum number of pods for nodes within a node pool is set at deployment time. When deploying AKS clusters with kubernet networking the default maximum number of pods is 110. For Azure CNI AKS clusters, the default maximum number of pods is 30. In many environments, deploying DaemonSets for monitoring and management tools can exhaust the CNI default.","title":"Description"},{"location":"en/rules/Azure.AKS.NodeMinPods/#recommendation","text":"Consider deploying node pools with a minimum number of pods per node.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.NodeMinPods/#notes","text":"By default, this rule fails when node pools have maxPods set to less than 50. To configure this rule: Override the Azure_AKSNodeMinimumMaxPods configuration value with the minimum maxPods.","title":"Notes"},{"location":"en/rules/Azure.AKS.NodeMinPods/#links","text":"Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.PlatformLogs/","tags":["Azure.AKS.PlatformLogs","AZR-000023"],"text":"AKS clusters should collect platform diagnostic logs # Azure.AKS.PlatformLogs AZR-000023 Error Operational Excellence \u00b7 Azure Kubernetes Service \u00b7 2021_09 AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Description # To capture platform logs from AKS clusters, the following diagnostic log/metric categories should be enabled: cluster-autoscaler Understand why the AKS cluster is scaling up or down, which may not be expected. This information is also useful to correlate time intervals where something interesting may have happened in the cluster. kube-apiserver Logs from the Kubernetes API server. kube-controller-manager Gain deeper visibility of issues that may arise between Kubernetes and the Azure control plane. A typical example is the AKS cluster having a lack of permissions to interact with Azure. kube-scheduler Logs from the Kubernetes scheduler. AllMetrics Includes all platform metrics. Sends these values to Log Analytics workspace where it can be evaluated with other data using log queries. Recommendation # Consider configuring diagnostic settings to capture platform logs from AKS clusters. Notes # Configure AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST to enable selective log categories. By default all log categories are selected, as shown below. # YAML: The default AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option configuration : AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST : [ 'cluster-autoscaler' , 'kube-apiserver' , 'kube-controller-manager' , 'kube-scheduler' , 'AllMetrics' ] Examples # Configure with Azure template # To deploy AKS clusters that pass this rule: Deploy a diagnostic settings sub-resource. Enable logging for the cluster-autoscaler , kube-apiserver , kube-controller-manager , kube-scheduler and AllMetrics categories. For example: { \"comments\" : \"Azure Kubernetes Cluster\" , \"apiVersion\" : \"2020-12-01\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ], \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"location\" : \"[parameters('location')]\" , \"name\" : \"[parameters('clusterName')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"disableLocalAccounts\" : true , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : [ { \"name\" : \"system\" , \"osDiskSizeGB\" : 32 , \"count\" : 3 , \"minCount\" : 3 , \"maxCount\" : 10 , \"enableAutoScaling\" : true , \"maxPods\" : 50 , \"vmSize\" : \"Standard_D2s_v3\" , \"osType\" : \"Linux\" , \"type\" : \"VirtualMachineScaleSets\" , \"vnetSubnetID\" : \"[variables('clusterSubnetId')]\" , \"mode\" : \"System\" , \"osDiskType\" : \"Ephemeral\" , \"scaleSetPriority\" : \"Regular\" } ], \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"Standard\" , \"serviceCidr\" : \"192.168.0.0/16\" , \"dnsServiceIP\" : \"192.168.0.4\" , \"dockerBridgeCidr\" : \"172.17.0.1/16\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false } } }, \"resources\" : [ { \"apiVersion\" : \"2016-09-01\" , \"type\" : \"Microsoft.ContainerService/managedClusters/providers/diagnosticSettings\" , \"name\" : \"[concat(parameters('clusterName'), '/Microsoft.Insights/service')]\" , \"properties\" : { \"workspaceId\" : \"[parameters('workspaceId')]\" , \"logs\" : [ { \"category\" : \"kube-apiserver\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } }, { \"category\" : \"kube-controller-manager\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } }, { \"category\" : \"kube-scheduler\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } }, { \"category\" : \"cluster-autoscaler\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } } ], \"metrics\" : [ { \"category\" : \"AllMetrics\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } } ] } } ] } Links # Platform Monitoring Monitoring AKS data reference Collect resource logs Template reference","title":"Azure.AKS.PlatformLogs"},{"location":"en/rules/Azure.AKS.PlatformLogs/#aks-clusters-should-collect-platform-diagnostic-logs","text":"Azure.AKS.PlatformLogs AZR-000023 Error Operational Excellence \u00b7 Azure Kubernetes Service \u00b7 2021_09 AKS clusters should collect platform diagnostic logs to monitor the state of workloads.","title":"AKS clusters should collect platform diagnostic logs"},{"location":"en/rules/Azure.AKS.PlatformLogs/#description","text":"To capture platform logs from AKS clusters, the following diagnostic log/metric categories should be enabled: cluster-autoscaler Understand why the AKS cluster is scaling up or down, which may not be expected. This information is also useful to correlate time intervals where something interesting may have happened in the cluster. kube-apiserver Logs from the Kubernetes API server. kube-controller-manager Gain deeper visibility of issues that may arise between Kubernetes and the Azure control plane. A typical example is the AKS cluster having a lack of permissions to interact with Azure. kube-scheduler Logs from the Kubernetes scheduler. AllMetrics Includes all platform metrics. Sends these values to Log Analytics workspace where it can be evaluated with other data using log queries.","title":"Description"},{"location":"en/rules/Azure.AKS.PlatformLogs/#recommendation","text":"Consider configuring diagnostic settings to capture platform logs from AKS clusters.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.PlatformLogs/#notes","text":"Configure AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST to enable selective log categories. By default all log categories are selected, as shown below. # YAML: The default AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option configuration : AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST : [ 'cluster-autoscaler' , 'kube-apiserver' , 'kube-controller-manager' , 'kube-scheduler' , 'AllMetrics' ]","title":"Notes"},{"location":"en/rules/Azure.AKS.PlatformLogs/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.PlatformLogs/#configure-with-azure-template","text":"To deploy AKS clusters that pass this rule: Deploy a diagnostic settings sub-resource. Enable logging for the cluster-autoscaler , kube-apiserver , kube-controller-manager , kube-scheduler and AllMetrics categories. For example: { \"comments\" : \"Azure Kubernetes Cluster\" , \"apiVersion\" : \"2020-12-01\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ], \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"location\" : \"[parameters('location')]\" , \"name\" : \"[parameters('clusterName')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"disableLocalAccounts\" : true , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : [ { \"name\" : \"system\" , \"osDiskSizeGB\" : 32 , \"count\" : 3 , \"minCount\" : 3 , \"maxCount\" : 10 , \"enableAutoScaling\" : true , \"maxPods\" : 50 , \"vmSize\" : \"Standard_D2s_v3\" , \"osType\" : \"Linux\" , \"type\" : \"VirtualMachineScaleSets\" , \"vnetSubnetID\" : \"[variables('clusterSubnetId')]\" , \"mode\" : \"System\" , \"osDiskType\" : \"Ephemeral\" , \"scaleSetPriority\" : \"Regular\" } ], \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"Standard\" , \"serviceCidr\" : \"192.168.0.0/16\" , \"dnsServiceIP\" : \"192.168.0.4\" , \"dockerBridgeCidr\" : \"172.17.0.1/16\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false } } }, \"resources\" : [ { \"apiVersion\" : \"2016-09-01\" , \"type\" : \"Microsoft.ContainerService/managedClusters/providers/diagnosticSettings\" , \"name\" : \"[concat(parameters('clusterName'), '/Microsoft.Insights/service')]\" , \"properties\" : { \"workspaceId\" : \"[parameters('workspaceId')]\" , \"logs\" : [ { \"category\" : \"kube-apiserver\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } }, { \"category\" : \"kube-controller-manager\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } }, { \"category\" : \"kube-scheduler\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } }, { \"category\" : \"cluster-autoscaler\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } } ], \"metrics\" : [ { \"category\" : \"AllMetrics\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } } ] } } ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.PlatformLogs/#links","text":"Platform Monitoring Monitoring AKS data reference Collect resource logs Template reference","title":"Links"},{"location":"en/rules/Azure.AKS.PodIdentity/","tags":["Azure.AKS.PodIdentity","AZR-000037"],"text":"Use managed identities for AKS pod authentication # Azure.AKS.PodIdentity AZR-000037 Error Security \u00b7 Azure Kubernetes Service \u00b7 Preview \u00b7 2021_12 Configure AKS clusters to use AAD pod identities to access Azure resources securely. Description # AAD pod identities allows AKS clusters to assign a user identity to a pod in Kubernetes. Administrators create identities and bindings as Kubernetes primitives that allow pods to access Azure resources that rely on Azure AD as an identity provider. Recommendation # Consider enabling AAD pod identities on AKS clusters. It is only recommended to use AAD pod identities with AKS clusters that use Azure CNI. Examples # Configure with Azure CLI # Register EnablePodIdentityPreview feature: az feature register --name EnablePodIdentityPreview --namespace Microsoft.ContainerService Install the aks-preview Azure CLI: # Install the aks-preview extension az extension add --name aks-preview # Update the extension to make sure you have the latest version installed az extension update --name aks-preview Create AKS cluster with AAD Pod identity enabled: az aks create -g '<resource_group>' -n '<cluster_name>' --enable-pod-identity --network-plugin azure Update an existing AKS cluster with AAD pod identity enabled: az aks update -g '<resource_group>' -n '<cluster_name>' --enable-pod-identity Configure with Azure template # To deploy AKS clusters that pass this rule: Set Properties.networkProfile.networkPlugin to azure . Set Properties.podIdentityProfile.enabled to true . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-07-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } }, \"podIdentityProfile\" : { \"enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] } Configure with Bicep # To deploy AKS clusters that pass this rule: Set Properties.networkProfile.networkPlugin to azure . Set Properties.podIdentityProfile.enabled to true . For example: // Cluster resource cluster 'Microsoft.ContainerService/managedClusters@2021-07-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } podIdentityProfile: { enabled: true } } tags: tags } Links # Use identity-based authentication Use Azure Active Directory pod-managed identities in Azure Kubernetes Service (Preview) Use managed identities in Azure Kubernetes Service What are managed identities for Azure resources? AAD Pod Identity Azure template reference","title":"Azure.AKS.PodIdentity"},{"location":"en/rules/Azure.AKS.PodIdentity/#use-managed-identities-for-aks-pod-authentication","text":"Azure.AKS.PodIdentity AZR-000037 Error Security \u00b7 Azure Kubernetes Service \u00b7 Preview \u00b7 2021_12 Configure AKS clusters to use AAD pod identities to access Azure resources securely.","title":"Use managed identities for AKS pod authentication"},{"location":"en/rules/Azure.AKS.PodIdentity/#description","text":"AAD pod identities allows AKS clusters to assign a user identity to a pod in Kubernetes. Administrators create identities and bindings as Kubernetes primitives that allow pods to access Azure resources that rely on Azure AD as an identity provider.","title":"Description"},{"location":"en/rules/Azure.AKS.PodIdentity/#recommendation","text":"Consider enabling AAD pod identities on AKS clusters. It is only recommended to use AAD pod identities with AKS clusters that use Azure CNI.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.PodIdentity/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.PodIdentity/#configure-with-azure-cli","text":"Register EnablePodIdentityPreview feature: az feature register --name EnablePodIdentityPreview --namespace Microsoft.ContainerService Install the aks-preview Azure CLI: # Install the aks-preview extension az extension add --name aks-preview # Update the extension to make sure you have the latest version installed az extension update --name aks-preview Create AKS cluster with AAD Pod identity enabled: az aks create -g '<resource_group>' -n '<cluster_name>' --enable-pod-identity --network-plugin azure Update an existing AKS cluster with AAD pod identity enabled: az aks update -g '<resource_group>' -n '<cluster_name>' --enable-pod-identity","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AKS.PodIdentity/#configure-with-azure-template","text":"To deploy AKS clusters that pass this rule: Set Properties.networkProfile.networkPlugin to azure . Set Properties.podIdentityProfile.enabled to true . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-07-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } }, \"podIdentityProfile\" : { \"enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.PodIdentity/#configure-with-bicep","text":"To deploy AKS clusters that pass this rule: Set Properties.networkProfile.networkPlugin to azure . Set Properties.podIdentityProfile.enabled to true . For example: // Cluster resource cluster 'Microsoft.ContainerService/managedClusters@2021-07-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } podIdentityProfile: { enabled: true } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AKS.PodIdentity/#links","text":"Use identity-based authentication Use Azure Active Directory pod-managed identities in Azure Kubernetes Service (Preview) Use managed identities in Azure Kubernetes Service What are managed identities for Azure resources? AAD Pod Identity Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.PoolScaleSet/","tags":["Azure.AKS.PoolScaleSet","AZR-000017"],"text":"AKS clusters use VM scale sets # Azure.AKS.PoolScaleSet AZR-000017 Error Performance Efficiency \u00b7 Azure Kubernetes Service \u00b7 2020_06 Deploy AKS clusters with nodes pools based on VM scale sets. Description # When deploying AKS clusters, Azure node pool VMs can be deployed using Availability Sets or VM Scale Sets. New AKS clusters default to VM scale set node pools. Deploying AKS clusters with scale set node pools is required for some cluster features such as multiple node pools and cluster autoscaler. Recommendation # Multiple node pools and the cluster autoscaler can be used to improve the scalability and performance of a cluster while minimizing cost. Using VM scale sets is a deployment time configuration. Consider redeploying the AKS cluster with VM Scale Sets instead of Availability Sets. Links # Create and manage multiple node pools for a cluster in Azure Kubernetes Service (AKS) Cluster autoscaler Azure template reference","title":"Azure.AKS.PoolScaleSet"},{"location":"en/rules/Azure.AKS.PoolScaleSet/#aks-clusters-use-vm-scale-sets","text":"Azure.AKS.PoolScaleSet AZR-000017 Error Performance Efficiency \u00b7 Azure Kubernetes Service \u00b7 2020_06 Deploy AKS clusters with nodes pools based on VM scale sets.","title":"AKS clusters use VM scale sets"},{"location":"en/rules/Azure.AKS.PoolScaleSet/#description","text":"When deploying AKS clusters, Azure node pool VMs can be deployed using Availability Sets or VM Scale Sets. New AKS clusters default to VM scale set node pools. Deploying AKS clusters with scale set node pools is required for some cluster features such as multiple node pools and cluster autoscaler.","title":"Description"},{"location":"en/rules/Azure.AKS.PoolScaleSet/#recommendation","text":"Multiple node pools and the cluster autoscaler can be used to improve the scalability and performance of a cluster while minimizing cost. Using VM scale sets is a deployment time configuration. Consider redeploying the AKS cluster with VM Scale Sets instead of Availability Sets.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.PoolScaleSet/#links","text":"Create and manage multiple node pools for a cluster in Azure Kubernetes Service (AKS) Cluster autoscaler Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.PoolVersion/","tags":["Azure.AKS.PoolVersion","AZR-000016"],"text":"Upgrade AKS node pool version # Azure.AKS.PoolVersion AZR-000016 Error Reliability \u00b7 Azure Kubernetes Service \u00b7 2020_06 AKS node pools should match Kubernetes control plane version. Description # AKS supports multiple node pools. In a multi-node pool configuration, it is possible that the control plane and node pools could be running a different version of Kubernetes. Different versions of Kubernetes between the control plane and node pools is intended as a short term option to allow rolling upgrades. For general operation, the control plane and node pool Kubernetes versions should match. Recommendation # Consider upgrading node pools to match AKS control plan version. Links # Upgrade a cluster control plane with multiple node pools Supported Kubernetes versions in Azure Kubernetes Service Azure template reference","title":"Azure.AKS.PoolVersion"},{"location":"en/rules/Azure.AKS.PoolVersion/#upgrade-aks-node-pool-version","text":"Azure.AKS.PoolVersion AZR-000016 Error Reliability \u00b7 Azure Kubernetes Service \u00b7 2020_06 AKS node pools should match Kubernetes control plane version.","title":"Upgrade AKS node pool version"},{"location":"en/rules/Azure.AKS.PoolVersion/#description","text":"AKS supports multiple node pools. In a multi-node pool configuration, it is possible that the control plane and node pools could be running a different version of Kubernetes. Different versions of Kubernetes between the control plane and node pools is intended as a short term option to allow rolling upgrades. For general operation, the control plane and node pool Kubernetes versions should match.","title":"Description"},{"location":"en/rules/Azure.AKS.PoolVersion/#recommendation","text":"Consider upgrading node pools to match AKS control plan version.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.PoolVersion/#links","text":"Upgrade a cluster control plane with multiple node pools Supported Kubernetes versions in Azure Kubernetes Service Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.SecretStore/","tags":["Azure.AKS.SecretStore","AZR-000033"],"text":"AKS clusters use Key Vault to store secrets # Azure.AKS.SecretStore AZR-000033 Error Security \u00b7 Azure Kubernetes Service \u00b7 2021_12 Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Description # AKS clusters may need to store and retrieve secrets, keys, and certificates. The Secrets Store CSI Driver provides cluster support to integrate with Key Vault. When enabled and configured secrets, keys, and certificates can be securely accessed from a pod. The Secrets Store CSI Driver can automatically refresh secrets and keys periodically from Key Vault. To enable this feature, enable Secrets Store CSI Driver autorotation. Avoid storing secrets to access Azure resources. Use a Managed Identity when possible instead of cryptographic keys or a regular service principal. Recommendation # Consider deploying AKS clusters with the Secrets Store CSI Driver and store Secrets in Key Vault. Examples # Configure with Azure template # To deploy AKS clusters that pass this rule: Set Properties.addonProfiles.azureKeyvaultSecretsProvider.enabled to true . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-07-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] } Configure with Bicep # To deploy AKS clusters that pass this rule: Set Properties.addonProfiles.azureKeyvaultSecretsProvider.enabled to true . For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-07-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } } tags: tags } Configure with Azure CLI # az aks enable-addons --addons azure-keyvault-secrets-provider -n '<name>' -g '<resource_group>' Links # Key and secret management considerations in Azure Operational considerations Use the Azure Key Vault Provider for Secrets Store CSI Driver in an AKS cluster Automate the rotation of a secret for resources that use one set of authentication credentials Automate the rotation of a secret for resources that have two sets of authentication credentials Azure template reference","title":"Azure.AKS.SecretStore"},{"location":"en/rules/Azure.AKS.SecretStore/#aks-clusters-use-key-vault-to-store-secrets","text":"Azure.AKS.SecretStore AZR-000033 Error Security \u00b7 Azure Kubernetes Service \u00b7 2021_12 Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault.","title":"AKS clusters use Key Vault to store secrets"},{"location":"en/rules/Azure.AKS.SecretStore/#description","text":"AKS clusters may need to store and retrieve secrets, keys, and certificates. The Secrets Store CSI Driver provides cluster support to integrate with Key Vault. When enabled and configured secrets, keys, and certificates can be securely accessed from a pod. The Secrets Store CSI Driver can automatically refresh secrets and keys periodically from Key Vault. To enable this feature, enable Secrets Store CSI Driver autorotation. Avoid storing secrets to access Azure resources. Use a Managed Identity when possible instead of cryptographic keys or a regular service principal.","title":"Description"},{"location":"en/rules/Azure.AKS.SecretStore/#recommendation","text":"Consider deploying AKS clusters with the Secrets Store CSI Driver and store Secrets in Key Vault.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.SecretStore/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.SecretStore/#configure-with-azure-template","text":"To deploy AKS clusters that pass this rule: Set Properties.addonProfiles.azureKeyvaultSecretsProvider.enabled to true . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-07-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.SecretStore/#configure-with-bicep","text":"To deploy AKS clusters that pass this rule: Set Properties.addonProfiles.azureKeyvaultSecretsProvider.enabled to true . For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-07-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AKS.SecretStore/#configure-with-azure-cli","text":"az aks enable-addons --addons azure-keyvault-secrets-provider -n '<name>' -g '<resource_group>'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AKS.SecretStore/#links","text":"Key and secret management considerations in Azure Operational considerations Use the Azure Key Vault Provider for Secrets Store CSI Driver in an AKS cluster Automate the rotation of a secret for resources that use one set of authentication credentials Automate the rotation of a secret for resources that have two sets of authentication credentials Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.SecretStoreRotation/","tags":["Azure.AKS.SecretStoreRotation","AZR-000034"],"text":"AKS clusters refresh secrets from Key Vault # Azure.AKS.SecretStoreRotation AZR-000034 Error Security \u00b7 Azure Kubernetes Service \u00b7 2021_12 Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Description # AKS clusters may need to store and retrieve secrets, keys, and certificates. The Secrets Store CSI Driver provides cluster support to integrate with Key Vault. When enabled and configured secrets, keys, and certificates can be securely accessed from a pod. When secrets are updated in Key Vault, pods may need to be restarted to pick up the new secrets. Enabling autorotation with the Secrets Store CSI Driver, automatically refreshed pods with new secrets. It does this by periodically polling for updates to the secrets in Key Vault. The default interval is every 2 minutes. The Secrets Store CSI Driver does not automatically change secrets in Key Vault. Updating the secrets in Key Vault must be done by an external process, such as an Azure Function. Recommendation # Consider enabling autorotation of Secrets Store CSI Driver secrets for AKS clusters. Examples # Configure with Azure template # To deploy AKS clusters that pass this rule: Set Properties.addonProfiles.azureKeyvaultSecretsProvider.config.enableSecretRotation to true . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-07-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] } Configure with Bicep # To deploy AKS clusters that pass this rule: Set Properties.addonProfiles.azureKeyvaultSecretsProvider.config.enableSecretRotation to true . For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-07-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } } tags: tags } Configure with Azure CLI # az aks update --enable-secret-rotation -n '<name>' -g '<resource_group>' Links # Key and secret management considerations in Azure Operational considerations Use the Azure Key Vault Provider for Secrets Store CSI Driver in an AKS cluster Automate the rotation of a secret for resources that use one set of authentication credentials Automate the rotation of a secret for resources that have two sets of authentication credentials Azure template reference","title":"Azure.AKS.SecretStoreRotation"},{"location":"en/rules/Azure.AKS.SecretStoreRotation/#aks-clusters-refresh-secrets-from-key-vault","text":"Azure.AKS.SecretStoreRotation AZR-000034 Error Security \u00b7 Azure Kubernetes Service \u00b7 2021_12 Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters.","title":"AKS clusters refresh secrets from Key Vault"},{"location":"en/rules/Azure.AKS.SecretStoreRotation/#description","text":"AKS clusters may need to store and retrieve secrets, keys, and certificates. The Secrets Store CSI Driver provides cluster support to integrate with Key Vault. When enabled and configured secrets, keys, and certificates can be securely accessed from a pod. When secrets are updated in Key Vault, pods may need to be restarted to pick up the new secrets. Enabling autorotation with the Secrets Store CSI Driver, automatically refreshed pods with new secrets. It does this by periodically polling for updates to the secrets in Key Vault. The default interval is every 2 minutes. The Secrets Store CSI Driver does not automatically change secrets in Key Vault. Updating the secrets in Key Vault must be done by an external process, such as an Azure Function.","title":"Description"},{"location":"en/rules/Azure.AKS.SecretStoreRotation/#recommendation","text":"Consider enabling autorotation of Secrets Store CSI Driver secrets for AKS clusters.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.SecretStoreRotation/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.SecretStoreRotation/#configure-with-azure-template","text":"To deploy AKS clusters that pass this rule: Set Properties.addonProfiles.azureKeyvaultSecretsProvider.config.enableSecretRotation to true . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-07-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"[parameters('kubernetesVersion')]\" , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.SecretStoreRotation/#configure-with-bicep","text":"To deploy AKS clusters that pass this rule: Set Properties.addonProfiles.azureKeyvaultSecretsProvider.config.enableSecretRotation to true . For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-07-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: kubernetesVersion enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AKS.SecretStoreRotation/#configure-with-azure-cli","text":"az aks update --enable-secret-rotation -n '<name>' -g '<resource_group>'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AKS.SecretStoreRotation/#links","text":"Key and secret management considerations in Azure Operational considerations Use the Azure Key Vault Provider for Secrets Store CSI Driver in an AKS cluster Automate the rotation of a secret for resources that use one set of authentication credentials Automate the rotation of a secret for resources that have two sets of authentication credentials Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.StandardLB/","tags":["Azure.AKS.StandardLB","AZR-000026"],"text":"Use the Standard load balancer SKU # Azure.AKS.StandardLB AZR-000026 Error Performance Efficiency \u00b7 Azure Kubernetes Service \u00b7 2020_06 Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Description # When deploying an AKS cluster, either a Standard or Basic load balancer SKU can be configured. A Standard load balancer SKU is required for several AKS features including: Multiple node pools Availability zones Authorized IP ranges These features improve the scalability and reliability of the cluster. Recommendation # Consider using Standard load balancer SKU during AKS cluster creation. Additionally, consider redeploying the AKS clusters with a Standard load balancer SKU configured. Notes # AKS clusters can not be updated to use a Standard load balancer SKU after deployment. Links # Use a Standard SKU load balancer in Azure Kubernetes Service (AKS) Azure template reference","title":"Azure.AKS.StandardLB"},{"location":"en/rules/Azure.AKS.StandardLB/#use-the-standard-load-balancer-sku","text":"Azure.AKS.StandardLB AZR-000026 Error Performance Efficiency \u00b7 Azure Kubernetes Service \u00b7 2020_06 Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU.","title":"Use the Standard load balancer SKU"},{"location":"en/rules/Azure.AKS.StandardLB/#description","text":"When deploying an AKS cluster, either a Standard or Basic load balancer SKU can be configured. A Standard load balancer SKU is required for several AKS features including: Multiple node pools Availability zones Authorized IP ranges These features improve the scalability and reliability of the cluster.","title":"Description"},{"location":"en/rules/Azure.AKS.StandardLB/#recommendation","text":"Consider using Standard load balancer SKU during AKS cluster creation. Additionally, consider redeploying the AKS clusters with a Standard load balancer SKU configured.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.StandardLB/#notes","text":"AKS clusters can not be updated to use a Standard load balancer SKU after deployment.","title":"Notes"},{"location":"en/rules/Azure.AKS.StandardLB/#links","text":"Use a Standard SKU load balancer in Azure Kubernetes Service (AKS) Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.UptimeSLA/","tags":["Azure.AKS.UptimeSLA","AZR-000285"],"text":"Use AKS Uptime SLA # Azure.AKS.UptimeSLA AZR-000285 Error Reliability \u00b7 Azure Kubernetes Service \u00b7 2022_09 AKS clusters should have Uptime SLA enabled to ensure availability of control plane components for production workloads. Description # Uptime SLA is a tier to enable a financially backed, higher SLA for an AKS cluster. Clusters with Uptime SLA, come with greater amount of control plane resources and automatically scaling. Uptime SLA guarantees 99.95% availability of the Kubernetes API server endpoint for clusters that use Availability Zones. Uptime SLA guarantees 99.9% of availability for clusters that don't use Availability Zones. AKS uses master node replicas across update and fault domains to ensure SLA requirements are met. AKS recommends use of Uptime SLA in production workloads to ensure availability of control plane components. Clusters on the Free SKU tier support fewer replicas and limited resources for the control plane. Recommendation # Consider enabling Uptime SLA for production deployments. Examples # Configure with Azure template # To deploy an AKS cluster that pass this rule: Set sku.tier to Paid . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2022-06-02-preview\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Basic\" , \"tier\" : \"Paid\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : [ { \"name\" : \"agentpool\" , \"osDiskSizeGB\" : \"[parameters('osDiskSizeGB')]\" , \"count\" : \"[parameters('agentCount')]\" , \"vmSize\" : \"[parameters('agentVMSize')]\" , \"osType\" : \"Linux\" , \"mode\" : \"System\" } ], \"linuxProfile\" : { \"adminUsername\" : \"[parameters('linuxAdminUsername')]\" , \"ssh\" : { \"publicKeys\" : [ { \"keyData\" : \"[parameters('sshRSAPublicKey')]\" } ] } } } } Configure with Bicep # To deploy an AKS cluster that pass this rule: Set sku.tier to Paid . For example: resource aks 'Microsoft.ContainerService/managedClusters@2022-06-02-preview' = { name: clusterName location: location sku: { name: 'Basic' tier: 'Paid' } identity: { type: 'SystemAssigned' } properties: { dnsPrefix: dnsPrefix agentPoolProfiles: [ { name: 'agentpool' osDiskSizeGB: osDiskSizeGB count: agentCount vmSize: agentVMSize osType: 'Linux' mode: 'System' } ] linuxProfile: { adminUsername: linuxAdminUsername ssh: { publicKeys: [ { keyData: sshRSAPublicKey } ] } } } } Links # Target and non-functional requirements Azure Kubernetes Service (AKS) Uptime SLA Azure template reference","title":"Azure.AKS.UptimeSLA"},{"location":"en/rules/Azure.AKS.UptimeSLA/#use-aks-uptime-sla","text":"Azure.AKS.UptimeSLA AZR-000285 Error Reliability \u00b7 Azure Kubernetes Service \u00b7 2022_09 AKS clusters should have Uptime SLA enabled to ensure availability of control plane components for production workloads.","title":"Use AKS Uptime SLA"},{"location":"en/rules/Azure.AKS.UptimeSLA/#description","text":"Uptime SLA is a tier to enable a financially backed, higher SLA for an AKS cluster. Clusters with Uptime SLA, come with greater amount of control plane resources and automatically scaling. Uptime SLA guarantees 99.95% availability of the Kubernetes API server endpoint for clusters that use Availability Zones. Uptime SLA guarantees 99.9% of availability for clusters that don't use Availability Zones. AKS uses master node replicas across update and fault domains to ensure SLA requirements are met. AKS recommends use of Uptime SLA in production workloads to ensure availability of control plane components. Clusters on the Free SKU tier support fewer replicas and limited resources for the control plane.","title":"Description"},{"location":"en/rules/Azure.AKS.UptimeSLA/#recommendation","text":"Consider enabling Uptime SLA for production deployments.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.UptimeSLA/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.UptimeSLA/#configure-with-azure-template","text":"To deploy an AKS cluster that pass this rule: Set sku.tier to Paid . For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2022-06-02-preview\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Basic\" , \"tier\" : \"Paid\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : [ { \"name\" : \"agentpool\" , \"osDiskSizeGB\" : \"[parameters('osDiskSizeGB')]\" , \"count\" : \"[parameters('agentCount')]\" , \"vmSize\" : \"[parameters('agentVMSize')]\" , \"osType\" : \"Linux\" , \"mode\" : \"System\" } ], \"linuxProfile\" : { \"adminUsername\" : \"[parameters('linuxAdminUsername')]\" , \"ssh\" : { \"publicKeys\" : [ { \"keyData\" : \"[parameters('sshRSAPublicKey')]\" } ] } } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.UptimeSLA/#configure-with-bicep","text":"To deploy an AKS cluster that pass this rule: Set sku.tier to Paid . For example: resource aks 'Microsoft.ContainerService/managedClusters@2022-06-02-preview' = { name: clusterName location: location sku: { name: 'Basic' tier: 'Paid' } identity: { type: 'SystemAssigned' } properties: { dnsPrefix: dnsPrefix agentPoolProfiles: [ { name: 'agentpool' osDiskSizeGB: osDiskSizeGB count: agentCount vmSize: agentVMSize osType: 'Linux' mode: 'System' } ] linuxProfile: { adminUsername: linuxAdminUsername ssh: { publicKeys: [ { keyData: sshRSAPublicKey } ] } } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AKS.UptimeSLA/#links","text":"Target and non-functional requirements Azure Kubernetes Service (AKS) Uptime SLA Azure template reference","title":"Links"},{"location":"en/rules/Azure.AKS.UseRBAC/","tags":["Azure.AKS.UseRBAC","AZR-000038"],"text":"AKS clusters use RBAC # Azure.AKS.UseRBAC AZR-000038 Error Security \u00b7 Azure Kubernetes Service \u00b7 2020_06 Deploy AKS cluster with role-based access control (RBAC) enabled. Description # AKS supports granting access to cluster resources using role-based access control (RBAC). Additionally Azure Active Directory (AAD) integration with AKS allows, RBAC to be granted based on AAD user or group. Recommendation # Azure AD integration with AKS provides granular access control for Kubernetes resources using RBAC. RBAC is a deployment time configuration. Consider redeploying the AKS cluster with RBAC enabled. Links # Access and identity options for Azure Kubernetes Service (AKS) Authorization with Azure AD Best practices for authentication and authorization in Azure Kubernetes Service (AKS) Using RBAC Authorization Azure template reference Use role-based access control (RBAC)","title":"Azure.AKS.UseRBAC"},{"location":"en/rules/Azure.AKS.UseRBAC/#aks-clusters-use-rbac","text":"Azure.AKS.UseRBAC AZR-000038 Error Security \u00b7 Azure Kubernetes Service \u00b7 2020_06 Deploy AKS cluster with role-based access control (RBAC) enabled.","title":"AKS clusters use RBAC"},{"location":"en/rules/Azure.AKS.UseRBAC/#description","text":"AKS supports granting access to cluster resources using role-based access control (RBAC). Additionally Azure Active Directory (AAD) integration with AKS allows, RBAC to be granted based on AAD user or group.","title":"Description"},{"location":"en/rules/Azure.AKS.UseRBAC/#recommendation","text":"Azure AD integration with AKS provides granular access control for Kubernetes resources using RBAC. RBAC is a deployment time configuration. Consider redeploying the AKS cluster with RBAC enabled.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.UseRBAC/#links","text":"Access and identity options for Azure Kubernetes Service (AKS) Authorization with Azure AD Best practices for authentication and authorization in Azure Kubernetes Service (AKS) Using RBAC Authorization Azure template reference Use role-based access control (RBAC)","title":"Links"},{"location":"en/rules/Azure.AKS.Version/","tags":["Azure.AKS.Version","AZR-000015"],"text":"Upgrade Kubernetes version # Azure.AKS.Version AZR-000015 Error Reliability \u00b7 Azure Kubernetes Service \u00b7 2020_06 AKS control plane and nodes pools should use a current stable release. Description # The AKS support policy for Kubernetes is include N-2 stable minor releases. Additionally two patch releases for each minor version are supported. Recommendation # Consider upgrading AKS control plane and nodes pools to the latest stable version of Kubernetes. Examples # Configure with Azure template # To deploy AKS clusters that pass this rule: Set Properties.kubernetesVersion to a newer stable version. For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"1.22.6\" , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } }, \"podIdentityProfile\" : { \"enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] } Configure with Bicep # To deploy AKS clusters that pass this rule: Set Properties.kubernetesVersion to a newer stable version. For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-10-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: '1.22.6' enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } podIdentityProfile: { enabled: true } } tags: tags } Configure with Azure CLI # az aks upgrade -n '<name>' -g '<resource_group>' --kubernetes-version '1.22.6' Configure with Azure PowerShell # Set-AzAksCluster -Name '<name>' -ResourceGroupName '<resource_group>' -KubernetesVersion '1.22.6' Notes # A list of available Kubernetes versions can be found using the az aks get-versions -o table --location <location> CLI command. To configure this rule: Override the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration value with the minimum Kubernetes version. Links # Target and non-functional requirements Supported Kubernetes versions in Azure Kubernetes Service Support policies for Azure Kubernetes Service Azure template reference","title":"Azure.AKS.Version"},{"location":"en/rules/Azure.AKS.Version/#upgrade-kubernetes-version","text":"Azure.AKS.Version AZR-000015 Error Reliability \u00b7 Azure Kubernetes Service \u00b7 2020_06 AKS control plane and nodes pools should use a current stable release.","title":"Upgrade Kubernetes version"},{"location":"en/rules/Azure.AKS.Version/#description","text":"The AKS support policy for Kubernetes is include N-2 stable minor releases. Additionally two patch releases for each minor version are supported.","title":"Description"},{"location":"en/rules/Azure.AKS.Version/#recommendation","text":"Consider upgrading AKS control plane and nodes pools to the latest stable version of Kubernetes.","title":"Recommendation"},{"location":"en/rules/Azure.AKS.Version/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AKS.Version/#configure-with-azure-template","text":"To deploy AKS clusters that pass this rule: Set Properties.kubernetesVersion to a newer stable version. For example: { \"type\" : \"Microsoft.ContainerService/managedClusters\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('clusterName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"UserAssigned\" , \"userAssignedIdentities\" : { \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\" : {} } }, \"properties\" : { \"kubernetesVersion\" : \"1.22.6\" , \"enableRBAC\" : true , \"dnsPrefix\" : \"[parameters('dnsPrefix')]\" , \"agentPoolProfiles\" : \"[variables('allPools')]\" , \"aadProfile\" : { \"managed\" : true , \"enableAzureRBAC\" : true , \"adminGroupObjectIDs\" : \"[parameters('clusterAdmins')]\" , \"tenantID\" : \"[subscription().tenantId]\" }, \"networkProfile\" : { \"networkPlugin\" : \"azure\" , \"networkPolicy\" : \"azure\" , \"loadBalancerSku\" : \"standard\" , \"serviceCidr\" : \"[variables('serviceCidr')]\" , \"dnsServiceIP\" : \"[variables('dnsServiceIP')]\" , \"dockerBridgeCidr\" : \"[variables('dockerBridgeCidr')]\" }, \"autoUpgradeProfile\" : { \"upgradeChannel\" : \"stable\" }, \"addonProfiles\" : { \"httpApplicationRouting\" : { \"enabled\" : false }, \"azurepolicy\" : { \"enabled\" : true , \"config\" : { \"version\" : \"v2\" } }, \"omsagent\" : { \"enabled\" : true , \"config\" : { \"logAnalyticsWorkspaceResourceID\" : \"[parameters('workspaceId')]\" } }, \"kubeDashboard\" : { \"enabled\" : false }, \"azureKeyvaultSecretsProvider\" : { \"enabled\" : true , \"config\" : { \"enableSecretRotation\" : \"true\" } } }, \"podIdentityProfile\" : { \"enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AKS.Version/#configure-with-bicep","text":"To deploy AKS clusters that pass this rule: Set Properties.kubernetesVersion to a newer stable version. For example: resource cluster 'Microsoft.ContainerService/managedClusters@2021-10-01' = { location: location name: clusterName identity: { type: 'UserAssigned' userAssignedIdentities: { '${identity.id}': {} } } properties: { kubernetesVersion: '1.22.6' enableRBAC: true dnsPrefix: dnsPrefix agentPoolProfiles: allPools aadProfile: { managed: true enableAzureRBAC: true adminGroupObjectIDs: clusterAdmins tenantID: subscription().tenantId } networkProfile: { networkPlugin: 'azure' networkPolicy: 'azure' loadBalancerSku: 'standard' serviceCidr: serviceCidr dnsServiceIP: dnsServiceIP dockerBridgeCidr: dockerBridgeCidr } autoUpgradeProfile: { upgradeChannel: 'stable' } addonProfiles: { httpApplicationRouting: { enabled: false } azurepolicy: { enabled: true config: { version: 'v2' } } omsagent: { enabled: true config: { logAnalyticsWorkspaceResourceID: workspaceId } } kubeDashboard: { enabled: false } azureKeyvaultSecretsProvider: { enabled: true config: { enableSecretRotation: 'true' } } } podIdentityProfile: { enabled: true } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AKS.Version/#configure-with-azure-cli","text":"az aks upgrade -n '<name>' -g '<resource_group>' --kubernetes-version '1.22.6'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AKS.Version/#configure-with-azure-powershell","text":"Set-AzAksCluster -Name '<name>' -ResourceGroupName '<resource_group>' -KubernetesVersion '1.22.6'","title":"Configure with Azure PowerShell"},{"location":"en/rules/Azure.AKS.Version/#notes","text":"A list of available Kubernetes versions can be found using the az aks get-versions -o table --location <location> CLI command. To configure this rule: Override the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration value with the minimum Kubernetes version.","title":"Notes"},{"location":"en/rules/Azure.AKS.Version/#links","text":"Target and non-functional requirements Supported Kubernetes versions in Azure Kubernetes Service Support policies for Azure Kubernetes Service Azure template reference","title":"Links"},{"location":"en/rules/Azure.APIM.APIDescriptors/","tags":["Azure.APIM.APIDescriptors","AZR-000043"],"text":"Use API descriptors # Azure.APIM.APIDescriptors AZR-000043 Warning Operational Excellence \u00b7 API Management \u00b7 2020_09 API Management APIs should have a display name and description. Description # Each API created in API Management can have a display name and description set. This information is visible within the developer portal and exported OpenAPI definitions. Recommendation # Consider using display name and description fields on APIs to convey intended purpose and usage. Display name and description fields should be human readable and easy to understand. Links # Import and publish your first API Azure template reference","title":"Azure.APIM.APIDescriptors"},{"location":"en/rules/Azure.APIM.APIDescriptors/#use-api-descriptors","text":"Azure.APIM.APIDescriptors AZR-000043 Warning Operational Excellence \u00b7 API Management \u00b7 2020_09 API Management APIs should have a display name and description.","title":"Use API descriptors"},{"location":"en/rules/Azure.APIM.APIDescriptors/#description","text":"Each API created in API Management can have a display name and description set. This information is visible within the developer portal and exported OpenAPI definitions.","title":"Description"},{"location":"en/rules/Azure.APIM.APIDescriptors/#recommendation","text":"Consider using display name and description fields on APIs to convey intended purpose and usage. Display name and description fields should be human readable and easy to understand.","title":"Recommendation"},{"location":"en/rules/Azure.APIM.APIDescriptors/#links","text":"Import and publish your first API Azure template reference","title":"Links"},{"location":"en/rules/Azure.APIM.AvailabilityZone/","tags":["Azure.APIM.AvailabilityZone","AZR-000052"],"text":"API management services should use Availability zones in supported regions # Azure.APIM.AvailabilityZone AZR-000052 Error Reliability \u00b7 API Management \u00b7 2021_12 API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Description # API management services using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. With zone redundancy, the gateway and the control plane of your API Management instance (Management API, developer portal, Git configuration) are replicated across data centers in physically separated zones, making it resilient to a zone failure. Recommendation # Consider using availability zones for API management services deployed with Premium SKU. Notes # This rule applies when analyzing resources deployed to Azure using pre-flight and in-flight data. This rule fails when \"zones\" is null , [] or less than two zones when API management service is deployed with Premium SKU and there are supported availability zones for the given region. Configure AZURE_APIM_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST to set additional availability zones that need to be supported which are not in the existing providers for namespace Microsoft.ApiManagement and resource type services . # YAML: The default AZURE_APIM_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option configuration : AZURE_APIM_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : [] Examples # Configure with Azure template # To set availability zones for a API management service Set zones to a minimum of two zones from [\"1\", \"2\", \"3\"] , ensuring the number of zones match sku.capacity . Set properties.additionalLocations[*].zones to a minimum of two zones from [\"1\", \"2\", \"3\"] , ensuring the number of zones match properties.additionalLocations[*].sku.capacity . Set sku.name and/or properties.additionalLocations[*].sku.name to Premium . For example: { \"type\" : \"Microsoft.ApiManagement/service\" , \"apiVersion\" : \"2021-01-01-preview\" , \"name\" : \"[parameters('service_api_mgmt_test2_name')]\" , \"location\" : \"Australia East\" , \"sku\" : { \"name\" : \"Premium\" , \"capacity\" : 3 }, \"zones\" : [ \"1\" , \"2\" , \"3\" ], \"properties\" : { \"publisherEmail\" : \"john.doe@contoso.com\" , \"publisherName\" : \"contoso\" , \"notificationSenderEmail\" : \"apimgmt-noreply@mail.windowsazure.com\" , \"hostnameConfigurations\" : [ { \"type\" : \"Proxy\" , \"hostName\" : \"[concat(parameters('service_api_mgmt_test2_name'), '.azure-api.net')]\" , \"negotiateClientCertificate\" : false , \"defaultSslBinding\" : true , \"certificateSource\" : \"BuiltIn\" } ], \"additionalLocations\" : [ { \"location\" : \"East US\" , \"sku\" : { \"name\" : \"Premium\" , \"capacity\" : 3 }, \"zones\" : [ \"1\" , \"2\" , \"3\" ], \"disableGateway\" : false } ], \"customProperties\" : { \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168\" : \"false\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11\" : \"false\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10\" : \"false\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30\" : \"false\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11\" : \"false\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10\" : \"false\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30\" : \"false\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2\" : \"false\" }, \"virtualNetworkType\" : \"None\" , \"disableGateway\" : false , \"apiVersionConstraint\" : {} } } Configure with Bicep # To set availability zones for a API management service Set zones to a minimum of two zones from [\"1\", \"2\", \"3\"] , ensuring the number of zones match sku.capacity . Set properties.additionalLocations[*].zones to a minimum of two zones from [\"1\", \"2\", \"3\"] , ensuring the number of zones match properties.additionalLocations[*].sku.capacity . Set sku.name and/or properties.additionalLocations[*].sku.name to Premium . For example: resource service_api_mgmt_test2_name_resource 'Microsoft.ApiManagement/service@2021-01-01-preview' = { name: service_api_mgmt_test2_name location: 'Australia East' sku: { name: 'Premium' capacity: 3 } zones: [ '1', '2', '3' ] properties: { publisherEmail: 'john.doe@contoso.com' publisherName: 'contoso' notificationSenderEmail: 'apimgmt-noreply@mail.windowsazure.com' hostnameConfigurations: [ { type: 'Proxy' hostName: '${service_api_mgmt_test2_name}.azure-api.net' negotiateClientCertificate: false defaultSslBinding: true certificateSource: 'BuiltIn' } ] additionalLocations: [ { location: 'East US' sku: { name: 'Premium' capacity: 1 } zones: [ '1' ] disableGateway: false } ] customProperties: { 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168': 'false' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11': 'false' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10': 'false' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30': 'false' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11': 'false' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10': 'false' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30': 'false' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2': 'false' } virtualNetworkType: 'None' disableGateway: false apiVersionConstraint: {} } } Links # Azure template reference Availability zone support for Azure API Management Use zone-aware services","title":"Azure.APIM.AvailabilityZone"},{"location":"en/rules/Azure.APIM.AvailabilityZone/#api-management-services-should-use-availability-zones-in-supported-regions","text":"Azure.APIM.AvailabilityZone AZR-000052 Error Reliability \u00b7 API Management \u00b7 2021_12 API management services deployed with Premium SKU should use availability zones in supported regions for high availability.","title":"API management services should use Availability zones in supported regions"},{"location":"en/rules/Azure.APIM.AvailabilityZone/#description","text":"API management services using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. With zone redundancy, the gateway and the control plane of your API Management instance (Management API, developer portal, Git configuration) are replicated across data centers in physically separated zones, making it resilient to a zone failure.","title":"Description"},{"location":"en/rules/Azure.APIM.AvailabilityZone/#recommendation","text":"Consider using availability zones for API management services deployed with Premium SKU.","title":"Recommendation"},{"location":"en/rules/Azure.APIM.AvailabilityZone/#notes","text":"This rule applies when analyzing resources deployed to Azure using pre-flight and in-flight data. This rule fails when \"zones\" is null , [] or less than two zones when API management service is deployed with Premium SKU and there are supported availability zones for the given region. Configure AZURE_APIM_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST to set additional availability zones that need to be supported which are not in the existing providers for namespace Microsoft.ApiManagement and resource type services . # YAML: The default AZURE_APIM_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option configuration : AZURE_APIM_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : []","title":"Notes"},{"location":"en/rules/Azure.APIM.AvailabilityZone/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.APIM.AvailabilityZone/#configure-with-azure-template","text":"To set availability zones for a API management service Set zones to a minimum of two zones from [\"1\", \"2\", \"3\"] , ensuring the number of zones match sku.capacity . Set properties.additionalLocations[*].zones to a minimum of two zones from [\"1\", \"2\", \"3\"] , ensuring the number of zones match properties.additionalLocations[*].sku.capacity . Set sku.name and/or properties.additionalLocations[*].sku.name to Premium . For example: { \"type\" : \"Microsoft.ApiManagement/service\" , \"apiVersion\" : \"2021-01-01-preview\" , \"name\" : \"[parameters('service_api_mgmt_test2_name')]\" , \"location\" : \"Australia East\" , \"sku\" : { \"name\" : \"Premium\" , \"capacity\" : 3 }, \"zones\" : [ \"1\" , \"2\" , \"3\" ], \"properties\" : { \"publisherEmail\" : \"john.doe@contoso.com\" , \"publisherName\" : \"contoso\" , \"notificationSenderEmail\" : \"apimgmt-noreply@mail.windowsazure.com\" , \"hostnameConfigurations\" : [ { \"type\" : \"Proxy\" , \"hostName\" : \"[concat(parameters('service_api_mgmt_test2_name'), '.azure-api.net')]\" , \"negotiateClientCertificate\" : false , \"defaultSslBinding\" : true , \"certificateSource\" : \"BuiltIn\" } ], \"additionalLocations\" : [ { \"location\" : \"East US\" , \"sku\" : { \"name\" : \"Premium\" , \"capacity\" : 3 }, \"zones\" : [ \"1\" , \"2\" , \"3\" ], \"disableGateway\" : false } ], \"customProperties\" : { \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168\" : \"false\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11\" : \"false\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10\" : \"false\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30\" : \"false\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11\" : \"false\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10\" : \"false\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30\" : \"false\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2\" : \"false\" }, \"virtualNetworkType\" : \"None\" , \"disableGateway\" : false , \"apiVersionConstraint\" : {} } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.APIM.AvailabilityZone/#configure-with-bicep","text":"To set availability zones for a API management service Set zones to a minimum of two zones from [\"1\", \"2\", \"3\"] , ensuring the number of zones match sku.capacity . Set properties.additionalLocations[*].zones to a minimum of two zones from [\"1\", \"2\", \"3\"] , ensuring the number of zones match properties.additionalLocations[*].sku.capacity . Set sku.name and/or properties.additionalLocations[*].sku.name to Premium . For example: resource service_api_mgmt_test2_name_resource 'Microsoft.ApiManagement/service@2021-01-01-preview' = { name: service_api_mgmt_test2_name location: 'Australia East' sku: { name: 'Premium' capacity: 3 } zones: [ '1', '2', '3' ] properties: { publisherEmail: 'john.doe@contoso.com' publisherName: 'contoso' notificationSenderEmail: 'apimgmt-noreply@mail.windowsazure.com' hostnameConfigurations: [ { type: 'Proxy' hostName: '${service_api_mgmt_test2_name}.azure-api.net' negotiateClientCertificate: false defaultSslBinding: true certificateSource: 'BuiltIn' } ] additionalLocations: [ { location: 'East US' sku: { name: 'Premium' capacity: 1 } zones: [ '1' ] disableGateway: false } ] customProperties: { 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168': 'false' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11': 'false' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10': 'false' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30': 'false' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11': 'false' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10': 'false' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30': 'false' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2': 'false' } virtualNetworkType: 'None' disableGateway: false apiVersionConstraint: {} } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.APIM.AvailabilityZone/#links","text":"Azure template reference Availability zone support for Azure API Management Use zone-aware services","title":"Links"},{"location":"en/rules/Azure.APIM.CertificateExpiry/","tags":["Azure.APIM.CertificateExpiry","AZR-000051"],"text":"API Management uses current certificates # Azure.APIM.CertificateExpiry AZR-000051 Error Operational Excellence \u00b7 API Management \u00b7 2020_06 Renew certificates used for custom domain bindings. Description # When custom domains are configured within an API Management service. A certificate must be assigned to allow traffic to be transmitted using TLS. Each certificate has an expiry date, after which the certificate is not valid. After expiry, client connections to the API Management service will reject the certificate. Recommendation # Consider renewing certificates before expiry to prevent service issues. Notes # By default, this rule fails when certificates have less than 30 days remaining before expiry. To configure this rule: Override the Azure_MinimumCertificateLifetime configuration value with the minimum number of days until expiry. Links # Configure a custom domain name Azure template reference","title":"Azure.APIM.CertificateExpiry"},{"location":"en/rules/Azure.APIM.CertificateExpiry/#api-management-uses-current-certificates","text":"Azure.APIM.CertificateExpiry AZR-000051 Error Operational Excellence \u00b7 API Management \u00b7 2020_06 Renew certificates used for custom domain bindings.","title":"API Management uses current certificates"},{"location":"en/rules/Azure.APIM.CertificateExpiry/#description","text":"When custom domains are configured within an API Management service. A certificate must be assigned to allow traffic to be transmitted using TLS. Each certificate has an expiry date, after which the certificate is not valid. After expiry, client connections to the API Management service will reject the certificate.","title":"Description"},{"location":"en/rules/Azure.APIM.CertificateExpiry/#recommendation","text":"Consider renewing certificates before expiry to prevent service issues.","title":"Recommendation"},{"location":"en/rules/Azure.APIM.CertificateExpiry/#notes","text":"By default, this rule fails when certificates have less than 30 days remaining before expiry. To configure this rule: Override the Azure_MinimumCertificateLifetime configuration value with the minimum number of days until expiry.","title":"Notes"},{"location":"en/rules/Azure.APIM.CertificateExpiry/#links","text":"Configure a custom domain name Azure template reference","title":"Links"},{"location":"en/rules/Azure.APIM.Ciphers/","tags":["Azure.APIM.Ciphers","AZR-000055"],"text":"Use secure protocols # Azure.APIM.Ciphers AZR-000055 Error Security \u00b7 API Management \u00b7 2022_03 API Management should not accept weak or deprecated ciphers. Description # API Management provides support for weak or deprecated ciphers. These older versions are provided for compatibility but are not consider secure. These Ciphers are enabled by default and need to be set to False. Recommendation # Consider disabling weak or deprecated ciphers. Links # Data encryption in Azure Manage protocols and ciphers in Azure API Management Cryptographic Recommendations","title":"Azure.APIM.Ciphers"},{"location":"en/rules/Azure.APIM.Ciphers/#use-secure-protocols","text":"Azure.APIM.Ciphers AZR-000055 Error Security \u00b7 API Management \u00b7 2022_03 API Management should not accept weak or deprecated ciphers.","title":"Use secure protocols"},{"location":"en/rules/Azure.APIM.Ciphers/#description","text":"API Management provides support for weak or deprecated ciphers. These older versions are provided for compatibility but are not consider secure. These Ciphers are enabled by default and need to be set to False.","title":"Description"},{"location":"en/rules/Azure.APIM.Ciphers/#recommendation","text":"Consider disabling weak or deprecated ciphers.","title":"Recommendation"},{"location":"en/rules/Azure.APIM.Ciphers/#links","text":"Data encryption in Azure Manage protocols and ciphers in Azure API Management Cryptographic Recommendations","title":"Links"},{"location":"en/rules/Azure.APIM.EncryptValues/","tags":["Azure.APIM.EncryptValues","AZR-000045"],"text":"Use encrypted named values # Azure.APIM.EncryptValues AZR-000045 Error Security \u00b7 API Management \u00b7 2020_06 API Management named values should be encrypted. Description # API Management allows configuration properties to be saved as named values. Named values are a key/ value pairs, which may contain sensitive information. When named values are marked as secret they are masked by default in the portal. Recommendation # Consider encrypting all API Management named values. Additionally consider, using Key Vault to store secrets. Key Vault improves security by tightly controlling access to secrets and improving management controls. Links # Manage secrets using properties","title":"Azure.APIM.EncryptValues"},{"location":"en/rules/Azure.APIM.EncryptValues/#use-encrypted-named-values","text":"Azure.APIM.EncryptValues AZR-000045 Error Security \u00b7 API Management \u00b7 2020_06 API Management named values should be encrypted.","title":"Use encrypted named values"},{"location":"en/rules/Azure.APIM.EncryptValues/#description","text":"API Management allows configuration properties to be saved as named values. Named values are a key/ value pairs, which may contain sensitive information. When named values are marked as secret they are masked by default in the portal.","title":"Description"},{"location":"en/rules/Azure.APIM.EncryptValues/#recommendation","text":"Consider encrypting all API Management named values. Additionally consider, using Key Vault to store secrets. Key Vault improves security by tightly controlling access to secrets and improving management controls.","title":"Recommendation"},{"location":"en/rules/Azure.APIM.EncryptValues/#links","text":"Manage secrets using properties","title":"Links"},{"location":"en/rules/Azure.APIM.HTTPBackend/","tags":["Azure.APIM.HTTPBackend","AZR-000044"],"text":"Use HTTPS backend connections # Azure.APIM.HTTPBackend AZR-000044 Error Security \u00b7 API Management \u00b7 2020_06 Use HTTPS for communication to backend services. Description # When API Management connects to the backend API it can use HTTP or HTTPS. When using HTTP, sensitive information may be exposed to an untrusted party. Additionally, when configuring backends: Use a newer version of TLS such as TLS 1.2. Use client certificate authentication from API Management to authenticate to the backend. Recommendation # Consider configuring only backend services configured with HTTPS-based URLs. Examples # Configure with Azure template # To deploy APIs that pass this rule: Set the properties.serviceUrl property to a URL that starts with https:// . For example: { \"type\" : \"Microsoft.ApiManagement/service/apis\" , \"apiVersion\" : \"2021-08-01\" , \"name\" : \"[format('{0}/{1}', parameters('name'), 'echo-v1')]\" , \"properties\" : { \"displayName\" : \"Echo API\" , \"description\" : \"An echo API service.\" , \"path\" : \"echo\" , \"serviceUrl\" : \"https://echo.contoso.com\" , \"protocols\" : [ \"https\" ], \"apiVersion\" : \"v1\" , \"apiVersionSetId\" : \"[resourceId('Microsoft.ApiManagement/service/apiVersionSets', parameters('name'), 'echo')]\" , \"subscriptionRequired\" : true }, \"dependsOn\" : [ \"[resourceId('Microsoft.ApiManagement/service', parameters('name'))]\" , \"[resourceId('Microsoft.ApiManagement/service/apiVersionSets', parameters('name'), 'echo')]\" ] } To deploy API backends that pass this rule: Set the properties.url property to a URL that starts with https:// . For example: { \"type\" : \"Microsoft.ApiManagement/service/backends\" , \"apiVersion\" : \"2021-08-01\" , \"name\" : \"[format('{0}/{1}', parameters('name'), 'echo')]\" , \"properties\" : { \"title\" : \"echo\" , \"description\" : \"A backend service for the Each API.\" , \"protocol\" : \"http\" , \"url\" : \"https://echo.contoso.com\" }, \"dependsOn\" : [ \"[resourceId('Microsoft.ApiManagement/service', parameters('name'))]\" ] } Configure with Bicep # To deploy APIs that pass this rule: Set the properties.serviceUrl property to a URL that starts with https:// . For example: resource api 'Microsoft.ApiManagement/service/apis@2021-08-01' = { parent: service name: 'echo-v1' properties: { displayName: 'Echo API' description: 'An echo API service.' path: 'echo' serviceUrl: 'https://echo.contoso.com' protocols: [ 'https' ] apiVersion: 'v1' apiVersionSetId: version.id subscriptionRequired: true } } To deploy API backends that pass this rule: Set the properties.url property to a URL that starts with https:// . For example: resource backend 'Microsoft.ApiManagement/service/backends@2021-08-01' = { parent: service name: 'echo' properties: { title: 'echo' description: 'A backend service for the Each API.' protocol: 'http' url: 'https://echo.contoso.com' } } Links # Data encryption in Azure Manage protocols and ciphers in Azure API Management Secure backend services using client certificate authentication in Azure API Management Azure template reference for APIs Azure template reference for backends","title":"Azure.APIM.HTTPBackend"},{"location":"en/rules/Azure.APIM.HTTPBackend/#use-https-backend-connections","text":"Azure.APIM.HTTPBackend AZR-000044 Error Security \u00b7 API Management \u00b7 2020_06 Use HTTPS for communication to backend services.","title":"Use HTTPS backend connections"},{"location":"en/rules/Azure.APIM.HTTPBackend/#description","text":"When API Management connects to the backend API it can use HTTP or HTTPS. When using HTTP, sensitive information may be exposed to an untrusted party. Additionally, when configuring backends: Use a newer version of TLS such as TLS 1.2. Use client certificate authentication from API Management to authenticate to the backend.","title":"Description"},{"location":"en/rules/Azure.APIM.HTTPBackend/#recommendation","text":"Consider configuring only backend services configured with HTTPS-based URLs.","title":"Recommendation"},{"location":"en/rules/Azure.APIM.HTTPBackend/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.APIM.HTTPBackend/#configure-with-azure-template","text":"To deploy APIs that pass this rule: Set the properties.serviceUrl property to a URL that starts with https:// . For example: { \"type\" : \"Microsoft.ApiManagement/service/apis\" , \"apiVersion\" : \"2021-08-01\" , \"name\" : \"[format('{0}/{1}', parameters('name'), 'echo-v1')]\" , \"properties\" : { \"displayName\" : \"Echo API\" , \"description\" : \"An echo API service.\" , \"path\" : \"echo\" , \"serviceUrl\" : \"https://echo.contoso.com\" , \"protocols\" : [ \"https\" ], \"apiVersion\" : \"v1\" , \"apiVersionSetId\" : \"[resourceId('Microsoft.ApiManagement/service/apiVersionSets', parameters('name'), 'echo')]\" , \"subscriptionRequired\" : true }, \"dependsOn\" : [ \"[resourceId('Microsoft.ApiManagement/service', parameters('name'))]\" , \"[resourceId('Microsoft.ApiManagement/service/apiVersionSets', parameters('name'), 'echo')]\" ] } To deploy API backends that pass this rule: Set the properties.url property to a URL that starts with https:// . For example: { \"type\" : \"Microsoft.ApiManagement/service/backends\" , \"apiVersion\" : \"2021-08-01\" , \"name\" : \"[format('{0}/{1}', parameters('name'), 'echo')]\" , \"properties\" : { \"title\" : \"echo\" , \"description\" : \"A backend service for the Each API.\" , \"protocol\" : \"http\" , \"url\" : \"https://echo.contoso.com\" }, \"dependsOn\" : [ \"[resourceId('Microsoft.ApiManagement/service', parameters('name'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.APIM.HTTPBackend/#configure-with-bicep","text":"To deploy APIs that pass this rule: Set the properties.serviceUrl property to a URL that starts with https:// . For example: resource api 'Microsoft.ApiManagement/service/apis@2021-08-01' = { parent: service name: 'echo-v1' properties: { displayName: 'Echo API' description: 'An echo API service.' path: 'echo' serviceUrl: 'https://echo.contoso.com' protocols: [ 'https' ] apiVersion: 'v1' apiVersionSetId: version.id subscriptionRequired: true } } To deploy API backends that pass this rule: Set the properties.url property to a URL that starts with https:// . For example: resource backend 'Microsoft.ApiManagement/service/backends@2021-08-01' = { parent: service name: 'echo' properties: { title: 'echo' description: 'A backend service for the Each API.' protocol: 'http' url: 'https://echo.contoso.com' } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.APIM.HTTPBackend/#links","text":"Data encryption in Azure Manage protocols and ciphers in Azure API Management Secure backend services using client certificate authentication in Azure API Management Azure template reference for APIs Azure template reference for backends","title":"Links"},{"location":"en/rules/Azure.APIM.HTTPEndpoint/","tags":["Azure.APIM.HTTPEndpoint","AZR-000042"],"text":"Publish APIs through HTTPS connections # Azure.APIM.HTTPEndpoint AZR-000042 Error Security \u00b7 API Management \u00b7 2020_06 Enforce HTTPS for communication to API clients. Description # When an client connects to API Management it can use HTTP or HTTPS. Each API can be configured to accept connection for HTTP and/ or HTTPS. When using HTTP, sensitive information may be exposed to an untrusted party. Recommendation # Consider setting the each API to only accept HTTPS connections. In the portal, this is done by configuring the HTTPS URL scheme. Links # Data encryption in Azure Import and publish a back-end API","title":"Azure.APIM.HTTPEndpoint"},{"location":"en/rules/Azure.APIM.HTTPEndpoint/#publish-apis-through-https-connections","text":"Azure.APIM.HTTPEndpoint AZR-000042 Error Security \u00b7 API Management \u00b7 2020_06 Enforce HTTPS for communication to API clients.","title":"Publish APIs through HTTPS connections"},{"location":"en/rules/Azure.APIM.HTTPEndpoint/#description","text":"When an client connects to API Management it can use HTTP or HTTPS. Each API can be configured to accept connection for HTTP and/ or HTTPS. When using HTTP, sensitive information may be exposed to an untrusted party.","title":"Description"},{"location":"en/rules/Azure.APIM.HTTPEndpoint/#recommendation","text":"Consider setting the each API to only accept HTTPS connections. In the portal, this is done by configuring the HTTPS URL scheme.","title":"Recommendation"},{"location":"en/rules/Azure.APIM.HTTPEndpoint/#links","text":"Data encryption in Azure Import and publish a back-end API","title":"Links"},{"location":"en/rules/Azure.APIM.ManagedIdentity/","tags":["Azure.APIM.ManagedIdentity","AZR-000053"],"text":"API Management uses a managed identity # Azure.APIM.ManagedIdentity AZR-000053 Error Security \u00b7 API Management \u00b7 2020_06 Configure managed identities to access Azure resources. Description # API Management must authenticate to access Azure resources such as Key Vault. Use Key Vault to store certificates and secrets used within API Management. Recommendation # Consider configuring a managed identity for each API Management instance. Also consider using managed identities to authenticate to related Azure services. Examples # Configure with Azure template # To deploy App Services that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: { \"type\" : \"Microsoft.ApiManagement/service\" , \"apiVersion\" : \"2021-08-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Premium\" , \"capacity\" : 1 }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"publisherEmail\" : \"[parameters('publisherEmail')]\" , \"publisherName\" : \"[parameters('publisherName')]\" , \"customProperties\" : { \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2\" : \"True\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256\" : \"False\" } } } Configure with Bicep # To deploy App Services that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: resource service 'Microsoft.ApiManagement/service@2021-08-01' = { name: name location: location sku: { name: 'Premium' capacity: 1 } identity: { type: 'SystemAssigned' } properties: { publisherEmail: publisherEmail publisherName: publisherName customProperties: { 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2': 'True' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256': 'False' } } } Links # Use identity-based authentication Use managed identities in Azure API Management Authenticate with managed identity Azure template reference","title":"Azure.APIM.ManagedIdentity"},{"location":"en/rules/Azure.APIM.ManagedIdentity/#api-management-uses-a-managed-identity","text":"Azure.APIM.ManagedIdentity AZR-000053 Error Security \u00b7 API Management \u00b7 2020_06 Configure managed identities to access Azure resources.","title":"API Management uses a managed identity"},{"location":"en/rules/Azure.APIM.ManagedIdentity/#description","text":"API Management must authenticate to access Azure resources such as Key Vault. Use Key Vault to store certificates and secrets used within API Management.","title":"Description"},{"location":"en/rules/Azure.APIM.ManagedIdentity/#recommendation","text":"Consider configuring a managed identity for each API Management instance. Also consider using managed identities to authenticate to related Azure services.","title":"Recommendation"},{"location":"en/rules/Azure.APIM.ManagedIdentity/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.APIM.ManagedIdentity/#configure-with-azure-template","text":"To deploy App Services that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: { \"type\" : \"Microsoft.ApiManagement/service\" , \"apiVersion\" : \"2021-08-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Premium\" , \"capacity\" : 1 }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"publisherEmail\" : \"[parameters('publisherEmail')]\" , \"publisherName\" : \"[parameters('publisherName')]\" , \"customProperties\" : { \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2\" : \"True\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA\" : \"False\" , \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256\" : \"False\" } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.APIM.ManagedIdentity/#configure-with-bicep","text":"To deploy App Services that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: resource service 'Microsoft.ApiManagement/service@2021-08-01' = { name: name location: location sku: { name: 'Premium' capacity: 1 } identity: { type: 'SystemAssigned' } properties: { publisherEmail: publisherEmail publisherName: publisherName customProperties: { 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2': 'True' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA': 'False' 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256': 'False' } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.APIM.ManagedIdentity/#links","text":"Use identity-based authentication Use managed identities in Azure API Management Authenticate with managed identity Azure template reference","title":"Links"},{"location":"en/rules/Azure.APIM.Name/","tags":["Azure.APIM.Name","AZR-000056"],"text":"Use valid API Management service names # Azure.APIM.Name AZR-000056 Error Operational Excellence \u00b7 API Management \u00b7 2020_09 API Management service names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for API Management service names are: Between 1 and 50 characters long. Alphanumerics and hyphens. Start with letter. End with letter or number. API Management service names must be globally unique. Recommendation # Consider using names that meet API Management naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if API Management service names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.APIM.Name"},{"location":"en/rules/Azure.APIM.Name/#use-valid-api-management-service-names","text":"Azure.APIM.Name AZR-000056 Error Operational Excellence \u00b7 API Management \u00b7 2020_09 API Management service names should meet naming requirements.","title":"Use valid API Management service names"},{"location":"en/rules/Azure.APIM.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for API Management service names are: Between 1 and 50 characters long. Alphanumerics and hyphens. Start with letter. End with letter or number. API Management service names must be globally unique.","title":"Description"},{"location":"en/rules/Azure.APIM.Name/#recommendation","text":"Consider using names that meet API Management naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.APIM.Name/#notes","text":"This rule does not check if API Management service names are unique.","title":"Notes"},{"location":"en/rules/Azure.APIM.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.APIM.ProductApproval/","tags":["Azure.APIM.ProductApproval","AZR-000047"],"text":"Require approval for products # Azure.APIM.ProductApproval AZR-000047 Error Security \u00b7 API Management \u00b7 2020_06 Configure products to require approval. Description # When publishing APIs through Azure API Management (APIM), APIs are assigned to products. Access to use an API is delegated through a product. When products do not require approval, users can create a subscription for a product without approval. Recommendation # Consider configuring all API Management products to require approval. Links # Create and publish a product Azure template reference","title":"Azure.APIM.ProductApproval"},{"location":"en/rules/Azure.APIM.ProductApproval/#require-approval-for-products","text":"Azure.APIM.ProductApproval AZR-000047 Error Security \u00b7 API Management \u00b7 2020_06 Configure products to require approval.","title":"Require approval for products"},{"location":"en/rules/Azure.APIM.ProductApproval/#description","text":"When publishing APIs through Azure API Management (APIM), APIs are assigned to products. Access to use an API is delegated through a product. When products do not require approval, users can create a subscription for a product without approval.","title":"Description"},{"location":"en/rules/Azure.APIM.ProductApproval/#recommendation","text":"Consider configuring all API Management products to require approval.","title":"Recommendation"},{"location":"en/rules/Azure.APIM.ProductApproval/#links","text":"Create and publish a product Azure template reference","title":"Links"},{"location":"en/rules/Azure.APIM.ProductDescriptors/","tags":["Azure.APIM.ProductDescriptors","AZR-000049"],"text":"Use product descriptors # Azure.APIM.ProductDescriptors AZR-000049 Warning Operational Excellence \u00b7 API Management \u00b7 2020_09 API Management products should have a display name and description. Description # Each product created in API Management can have a display name and description set. This information is visible within the developer portal. Recommendation # Consider using display name and description fields on products to convey intended purpose and usage. Display name and description fields should be human readable and easy to understand. Links # Create and publish a product Azure template reference","title":"Azure.APIM.ProductDescriptors"},{"location":"en/rules/Azure.APIM.ProductDescriptors/#use-product-descriptors","text":"Azure.APIM.ProductDescriptors AZR-000049 Warning Operational Excellence \u00b7 API Management \u00b7 2020_09 API Management products should have a display name and description.","title":"Use product descriptors"},{"location":"en/rules/Azure.APIM.ProductDescriptors/#description","text":"Each product created in API Management can have a display name and description set. This information is visible within the developer portal.","title":"Description"},{"location":"en/rules/Azure.APIM.ProductDescriptors/#recommendation","text":"Consider using display name and description fields on products to convey intended purpose and usage. Display name and description fields should be human readable and easy to understand.","title":"Recommendation"},{"location":"en/rules/Azure.APIM.ProductDescriptors/#links","text":"Create and publish a product Azure template reference","title":"Links"},{"location":"en/rules/Azure.APIM.ProductSubscription/","tags":["Azure.APIM.ProductSubscription","AZR-000046"],"text":"Require a subscription for products # Azure.APIM.ProductSubscription AZR-000046 Error Security \u00b7 API Management \u00b7 2020_06 Configure products to require a subscription. Description # When publishing APIs through Azure API Management (APIM), APIs can be secured using subscription keys. Client applications that consume published APIs must subscribe before making calls to those APIs. When combined with policies, subscriptions allow controls such as throttling to be implemented. Recommendation # Consider configuring all API Management products to require a subscription. Links # Subscriptions in Azure API Management Create and publish a product Azure template reference","title":"Azure.APIM.ProductSubscription"},{"location":"en/rules/Azure.APIM.ProductSubscription/#require-a-subscription-for-products","text":"Azure.APIM.ProductSubscription AZR-000046 Error Security \u00b7 API Management \u00b7 2020_06 Configure products to require a subscription.","title":"Require a subscription for products"},{"location":"en/rules/Azure.APIM.ProductSubscription/#description","text":"When publishing APIs through Azure API Management (APIM), APIs can be secured using subscription keys. Client applications that consume published APIs must subscribe before making calls to those APIs. When combined with policies, subscriptions allow controls such as throttling to be implemented.","title":"Description"},{"location":"en/rules/Azure.APIM.ProductSubscription/#recommendation","text":"Consider configuring all API Management products to require a subscription.","title":"Recommendation"},{"location":"en/rules/Azure.APIM.ProductSubscription/#links","text":"Subscriptions in Azure API Management Create and publish a product Azure template reference","title":"Links"},{"location":"en/rules/Azure.APIM.ProductTerms/","tags":["Azure.APIM.ProductTerms","AZR-000050"],"text":"Use API product legal terms # Azure.APIM.ProductTerms AZR-000050 Error Operational Excellence \u00b7 API Management \u00b7 2020_09 Set legal terms for each product registered in API Management. Description # Within API Management a product is created to publish one or more APIs. For each product legal terms can be specified. When set, developers using the developer portal are required to accept the terms to subscribe to a product. Use these terms to set expectations on acceptable use of the included APIs. Acceptance of legal terms is bypassed when an administrator creates a subscription. Recommendation # Consider configuring legal terms for all products to declare acceptable use of included APIs. Links # Create and publish a product Azure template reference","title":"Azure.APIM.ProductTerms"},{"location":"en/rules/Azure.APIM.ProductTerms/#use-api-product-legal-terms","text":"Azure.APIM.ProductTerms AZR-000050 Error Operational Excellence \u00b7 API Management \u00b7 2020_09 Set legal terms for each product registered in API Management.","title":"Use API product legal terms"},{"location":"en/rules/Azure.APIM.ProductTerms/#description","text":"Within API Management a product is created to publish one or more APIs. For each product legal terms can be specified. When set, developers using the developer portal are required to accept the terms to subscribe to a product. Use these terms to set expectations on acceptable use of the included APIs. Acceptance of legal terms is bypassed when an administrator creates a subscription.","title":"Description"},{"location":"en/rules/Azure.APIM.ProductTerms/#recommendation","text":"Consider configuring legal terms for all products to declare acceptable use of included APIs.","title":"Recommendation"},{"location":"en/rules/Azure.APIM.ProductTerms/#links","text":"Create and publish a product Azure template reference","title":"Links"},{"location":"en/rules/Azure.APIM.Protocols/","tags":["Azure.APIM.Protocols","AZR-000054"],"text":"Use secure protocols # Azure.APIM.Protocols AZR-000054 Error Security \u00b7 API Management \u00b7 2020_06 API Management should only accept a minimum of TLS 1.2. Description # API Management provides support for older TLS/ SSL protocols, which are disabled by default. These older versions are provided for compatibility but are not consider secure. Recommendation # Consider disabling SSL 3.0/ TLS 1.0/ TLS 1.1/ protocols. Links # Data encryption in Azure Manage protocols and ciphers in Azure API Management","title":"Azure.APIM.Protocols"},{"location":"en/rules/Azure.APIM.Protocols/#use-secure-protocols","text":"Azure.APIM.Protocols AZR-000054 Error Security \u00b7 API Management \u00b7 2020_06 API Management should only accept a minimum of TLS 1.2.","title":"Use secure protocols"},{"location":"en/rules/Azure.APIM.Protocols/#description","text":"API Management provides support for older TLS/ SSL protocols, which are disabled by default. These older versions are provided for compatibility but are not consider secure.","title":"Description"},{"location":"en/rules/Azure.APIM.Protocols/#recommendation","text":"Consider disabling SSL 3.0/ TLS 1.0/ TLS 1.1/ protocols.","title":"Recommendation"},{"location":"en/rules/Azure.APIM.Protocols/#links","text":"Data encryption in Azure Manage protocols and ciphers in Azure API Management","title":"Links"},{"location":"en/rules/Azure.APIM.SampleProducts/","tags":["Azure.APIM.SampleProducts","AZR-000048"],"text":"Remove default products # Azure.APIM.SampleProducts AZR-000048 Error Operational Excellence \u00b7 API Management \u00b7 2020_06 Remove starter and unlimited sample products. Description # API Management includes two sample products Starter and Unlimited . Accidentally adding APIs to these sample products may expose APIs more than intended. Recommendation # Consider removing starter and unlimited sample products from API Management. Links # Create and publish a product","title":"Azure.APIM.SampleProducts"},{"location":"en/rules/Azure.APIM.SampleProducts/#remove-default-products","text":"Azure.APIM.SampleProducts AZR-000048 Error Operational Excellence \u00b7 API Management \u00b7 2020_06 Remove starter and unlimited sample products.","title":"Remove default products"},{"location":"en/rules/Azure.APIM.SampleProducts/#description","text":"API Management includes two sample products Starter and Unlimited . Accidentally adding APIs to these sample products may expose APIs more than intended.","title":"Description"},{"location":"en/rules/Azure.APIM.SampleProducts/#recommendation","text":"Consider removing starter and unlimited sample products from API Management.","title":"Recommendation"},{"location":"en/rules/Azure.APIM.SampleProducts/#links","text":"Create and publish a product","title":"Links"},{"location":"en/rules/Azure.ASG.Name/","tags":["Azure.ASG.Name","AZR-000085"],"text":"Use valid NSG names # Azure.ASG.Name AZR-000085 Error Operational Excellence \u00b7 Application Security Group \u00b7 2021_12 Application Security Group (ASG) names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for ASG names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. ASG names must be unique within a resource group. Recommendation # Consider using names that meet Application Security Group naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if ASG names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Azure.ASG.Name"},{"location":"en/rules/Azure.ASG.Name/#use-valid-nsg-names","text":"Azure.ASG.Name AZR-000085 Error Operational Excellence \u00b7 Application Security Group \u00b7 2021_12 Application Security Group (ASG) names should meet naming requirements.","title":"Use valid NSG names"},{"location":"en/rules/Azure.ASG.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for ASG names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. ASG names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.ASG.Name/#recommendation","text":"Consider using names that meet Application Security Group naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.ASG.Name/#notes","text":"This rule does not check if ASG names are unique.","title":"Notes"},{"location":"en/rules/Azure.ASG.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Links"},{"location":"en/rules/Azure.AppConfig.Name/","tags":["Azure.AppConfig.Name","AZR-000058"],"text":"Use valid App Configuration store names # Azure.AppConfig.Name AZR-000058 Error Operational Excellence \u00b7 App Configuration \u00b7 2020_12 App Configuration store names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for App Configuration store names are: Between 5 and 50 characters long. Alphanumerics and hyphens. Start and end with a letter or number. App Configuration store names must be unique within a resource group. Recommendation # Consider using names that meet App Configuration store naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if App Configuration store names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference","title":"Azure.AppConfig.Name"},{"location":"en/rules/Azure.AppConfig.Name/#use-valid-app-configuration-store-names","text":"Azure.AppConfig.Name AZR-000058 Error Operational Excellence \u00b7 App Configuration \u00b7 2020_12 App Configuration store names should meet naming requirements.","title":"Use valid App Configuration store names"},{"location":"en/rules/Azure.AppConfig.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for App Configuration store names are: Between 5 and 50 characters long. Alphanumerics and hyphens. Start and end with a letter or number. App Configuration store names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.AppConfig.Name/#recommendation","text":"Consider using names that meet App Configuration store naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.AppConfig.Name/#notes","text":"This rule does not check if App Configuration store names are unique.","title":"Notes"},{"location":"en/rules/Azure.AppConfig.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppConfig.SKU/","tags":["Azure.AppConfig.SKU","AZR-000057"],"text":"Use production App Configuration SKU # Azure.AppConfig.SKU AZR-000057 Error Reliability \u00b7 App Configuration \u00b7 2020_12 App Configuration should use a minimum size of Standard. Description # App Configuration is offered in two different SKUs; Free, and Standard. Standard includes additional features, increases scalability, and 99.9% SLA. The Free SKU does not include a SLA. Recommendation # Consider upgrading App Configuration instances to Standard. Free instances are intended only for early development and testing scenarios. Examples # Configure with Azure template # To deploy App Configuration Stores that pass this rule: Set sku.name to standard . For example: { \"type\" : \"Microsoft.AppConfiguration/configurationStores\" , \"apiVersion\" : \"2020-06-01\" , \"name\" : \"[parameters('storeName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"standard\" } } Configure with Bicep # To deploy App Configuration Stores that pass this rule: Set sku.name to standard . For example: resource configStore 'Microsoft.AppConfiguration/configurationStores@2020-06-01' = { name: storeName location: location sku: { name: 'standard' } } Links # Target and non-functional requirements App Configuration pricing Which App Configuration tier should I use? Azure template reference","title":"Azure.AppConfig.SKU"},{"location":"en/rules/Azure.AppConfig.SKU/#use-production-app-configuration-sku","text":"Azure.AppConfig.SKU AZR-000057 Error Reliability \u00b7 App Configuration \u00b7 2020_12 App Configuration should use a minimum size of Standard.","title":"Use production App Configuration SKU"},{"location":"en/rules/Azure.AppConfig.SKU/#description","text":"App Configuration is offered in two different SKUs; Free, and Standard. Standard includes additional features, increases scalability, and 99.9% SLA. The Free SKU does not include a SLA.","title":"Description"},{"location":"en/rules/Azure.AppConfig.SKU/#recommendation","text":"Consider upgrading App Configuration instances to Standard. Free instances are intended only for early development and testing scenarios.","title":"Recommendation"},{"location":"en/rules/Azure.AppConfig.SKU/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppConfig.SKU/#configure-with-azure-template","text":"To deploy App Configuration Stores that pass this rule: Set sku.name to standard . For example: { \"type\" : \"Microsoft.AppConfiguration/configurationStores\" , \"apiVersion\" : \"2020-06-01\" , \"name\" : \"[parameters('storeName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"standard\" } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppConfig.SKU/#configure-with-bicep","text":"To deploy App Configuration Stores that pass this rule: Set sku.name to standard . For example: resource configStore 'Microsoft.AppConfiguration/configurationStores@2020-06-01' = { name: storeName location: location sku: { name: 'standard' } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppConfig.SKU/#links","text":"Target and non-functional requirements App Configuration pricing Which App Configuration tier should I use? Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppGw.AvailabilityZone/","tags":["Azure.AppGw.AvailabilityZone","AZR-000060"],"text":"Application gateways should use Availability zones in supported regions # Azure.AppGw.AvailabilityZone AZR-000060 Error Reliability \u00b7 Application Gateway \u00b7 2021_09 Application gateways deployed with should use availability zones in supported regions for high availability. Description # Application gateways using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. A zone redundant Application gateway or WAF deployment can spread across multiple availability zones, which ensures the application gateway will continue running even if another zone has gone down. Backend pools for applications can be similarly distributed across availability zones. Recommendation # Consider using availability zones for Application gateways deployed with V2 SKU(Standard_v2, WAF_v2). Notes # This rule applies when analyzing resources deployed to Azure using pre-flight and in-flight data. This rule fails when \"zones\" is null , [] or not set when the Application gateway is deployed with V2 SKU(Standard_v2, WAF_v2) and there are supported availability zones for the given region. Configure AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST to set additional availability zones that need to be supported which are not in the existing providers for namespace Microsoft.Network and resource type applicationGateways . # YAML: The default AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option configuration : AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : [] Examples # Configure with Azure template # To set availability zones for an Application gateway Set zones to any or all of [\"1\", \"2\", \"3\"] . Set properties.sku.name and properties.sku.tier to Standard_v2 or WAF_v2 . For example: { \"name\" : \"[parameters('applicationGatewayName')]\" , \"type\" : \"Microsoft.Network/applicationGateways\" , \"apiVersion\" : \"2019-09-01\" , \"location\" : \"[parameters('location')]\" , \"zones\" : [ \"1\" , \"2\" , \"3\" ], \"dependsOn\" : [ \"[concat('Microsoft.Network/virtualNetworks/', parameters('virtualNetworkName'))]\" , \"[concat('Microsoft.Network/publicIPAddresses/', parameters('publicIpAddressName'))]\" ], \"tags\" : {}, \"properties\" : { \"sku\" : { \"name\" : \"WAF_v2\" , \"tier\" : \"WAF_v2\" }, \"gatewayIPConfigurations\" : [ { \"name\" : \"appGatewayIpConfig\" , \"properties\" : { \"subnet\" : { \"id\" : \"[variables('subnetRef')]\" } } } ], \"frontendIPConfigurations\" : [ { \"name\" : \"appGwPublicFrontendIp\" , \"properties\" : { \"PublicIPAddress\" : { \"id\" : \"[variables('publicIPRef')]\" } } } ], \"frontendPorts\" : [ { \"name\" : \"port_80\" , \"properties\" : { \"Port\" : 80 } } ], \"backendAddressPools\" : [ { \"name\" : \"bepool\" , \"properties\" : { \"backendAddresses\" : [] } } ], \"backendHttpSettingsCollection\" : [ { \"name\" : \"http_settings\" , \"properties\" : { \"Port\" : 80 , \"Protocol\" : \"Http\" , \"cookieBasedAffinity\" : \"Disabled\" , \"requestTimeout\" : 20 } } ], \"httpListeners\" : [ { \"name\" : \"http-listener\" , \"properties\" : { \"frontendIPConfiguration\" : { \"id\" : \"[concat(variables('applicationGatewayId'), '/frontendIPConfigurations/appGwPublicFrontendIp')]\" }, \"frontendPort\" : { \"id\" : \"[concat(variables('applicationGatewayId'), '/frontendPorts/port_80')]\" }, \"protocol\" : \"Http\" , \"sslCertificate\" : null } } ], \"requestRoutingRules\" : [ { \"Name\" : \"http-rule\" , \"properties\" : { \"RuleType\" : \"Basic\" , \"httpListener\" : { \"id\" : \"[concat(variables('applicationGatewayId'), '/httpListeners/http-listener')]\" }, \"priority\" : null , \"backendAddressPool\" : { \"id\" : \"[concat(variables('applicationGatewayId'), '/backendAddressPools/bepool')]\" }, \"backendHttpSettings\" : { \"id\" : \"[concat(variables('applicationGatewayId'), '/backendHttpSettingsCollection/http_settings')]\" } } } ], \"enableHttp2\" : false , \"sslCertificates\" : [], \"probes\" : [], \"autoscaleConfiguration\" : { \"minCapacity\" : \"[parameters('capacity')]\" , \"maxCapacity\" : \"[parameters('autoScaleMaxCapacity')]\" }, \"webApplicationFirewallConfiguration\" : { \"enabled\" : true , \"firewallMode\" : \"Detection\" , \"ruleSetType\" : \"OWASP\" , \"ruleSetVersion\" : \"3.0\" } } } Configure with Azure CLI # Create WAFv2 Application Gateway in Zone 1, 2 and 3 # az network application-gateway create \\ --name '<application_gateway_name>' \\ --location '<location>' \\ --resource-group '<resource_group>' \\ --capacity '<capacity>' \\ --sku WAF_v2 \\ --public-ip-address '<public_ip_address>' \\ --vnet-name '<virtual_network_name>' \\ --subnet '<subnet_name>' \\ --zones 1 2 3 \\ --servers '<address_1>' '<address_2>' Links # Azure template reference Autoscaling and Zone-redundant Application Gateway v2 Use zone-aware services","title":"Azure.AppGw.AvailabilityZone"},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#application-gateways-should-use-availability-zones-in-supported-regions","text":"Azure.AppGw.AvailabilityZone AZR-000060 Error Reliability \u00b7 Application Gateway \u00b7 2021_09 Application gateways deployed with should use availability zones in supported regions for high availability.","title":"Application gateways should use Availability zones in supported regions"},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#description","text":"Application gateways using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. A zone redundant Application gateway or WAF deployment can spread across multiple availability zones, which ensures the application gateway will continue running even if another zone has gone down. Backend pools for applications can be similarly distributed across availability zones.","title":"Description"},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#recommendation","text":"Consider using availability zones for Application gateways deployed with V2 SKU(Standard_v2, WAF_v2).","title":"Recommendation"},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#notes","text":"This rule applies when analyzing resources deployed to Azure using pre-flight and in-flight data. This rule fails when \"zones\" is null , [] or not set when the Application gateway is deployed with V2 SKU(Standard_v2, WAF_v2) and there are supported availability zones for the given region. Configure AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST to set additional availability zones that need to be supported which are not in the existing providers for namespace Microsoft.Network and resource type applicationGateways . # YAML: The default AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option configuration : AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : []","title":"Notes"},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#configure-with-azure-template","text":"To set availability zones for an Application gateway Set zones to any or all of [\"1\", \"2\", \"3\"] . Set properties.sku.name and properties.sku.tier to Standard_v2 or WAF_v2 . For example: { \"name\" : \"[parameters('applicationGatewayName')]\" , \"type\" : \"Microsoft.Network/applicationGateways\" , \"apiVersion\" : \"2019-09-01\" , \"location\" : \"[parameters('location')]\" , \"zones\" : [ \"1\" , \"2\" , \"3\" ], \"dependsOn\" : [ \"[concat('Microsoft.Network/virtualNetworks/', parameters('virtualNetworkName'))]\" , \"[concat('Microsoft.Network/publicIPAddresses/', parameters('publicIpAddressName'))]\" ], \"tags\" : {}, \"properties\" : { \"sku\" : { \"name\" : \"WAF_v2\" , \"tier\" : \"WAF_v2\" }, \"gatewayIPConfigurations\" : [ { \"name\" : \"appGatewayIpConfig\" , \"properties\" : { \"subnet\" : { \"id\" : \"[variables('subnetRef')]\" } } } ], \"frontendIPConfigurations\" : [ { \"name\" : \"appGwPublicFrontendIp\" , \"properties\" : { \"PublicIPAddress\" : { \"id\" : \"[variables('publicIPRef')]\" } } } ], \"frontendPorts\" : [ { \"name\" : \"port_80\" , \"properties\" : { \"Port\" : 80 } } ], \"backendAddressPools\" : [ { \"name\" : \"bepool\" , \"properties\" : { \"backendAddresses\" : [] } } ], \"backendHttpSettingsCollection\" : [ { \"name\" : \"http_settings\" , \"properties\" : { \"Port\" : 80 , \"Protocol\" : \"Http\" , \"cookieBasedAffinity\" : \"Disabled\" , \"requestTimeout\" : 20 } } ], \"httpListeners\" : [ { \"name\" : \"http-listener\" , \"properties\" : { \"frontendIPConfiguration\" : { \"id\" : \"[concat(variables('applicationGatewayId'), '/frontendIPConfigurations/appGwPublicFrontendIp')]\" }, \"frontendPort\" : { \"id\" : \"[concat(variables('applicationGatewayId'), '/frontendPorts/port_80')]\" }, \"protocol\" : \"Http\" , \"sslCertificate\" : null } } ], \"requestRoutingRules\" : [ { \"Name\" : \"http-rule\" , \"properties\" : { \"RuleType\" : \"Basic\" , \"httpListener\" : { \"id\" : \"[concat(variables('applicationGatewayId'), '/httpListeners/http-listener')]\" }, \"priority\" : null , \"backendAddressPool\" : { \"id\" : \"[concat(variables('applicationGatewayId'), '/backendAddressPools/bepool')]\" }, \"backendHttpSettings\" : { \"id\" : \"[concat(variables('applicationGatewayId'), '/backendHttpSettingsCollection/http_settings')]\" } } } ], \"enableHttp2\" : false , \"sslCertificates\" : [], \"probes\" : [], \"autoscaleConfiguration\" : { \"minCapacity\" : \"[parameters('capacity')]\" , \"maxCapacity\" : \"[parameters('autoScaleMaxCapacity')]\" }, \"webApplicationFirewallConfiguration\" : { \"enabled\" : true , \"firewallMode\" : \"Detection\" , \"ruleSetType\" : \"OWASP\" , \"ruleSetVersion\" : \"3.0\" } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#configure-with-azure-cli","text":"","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#create-wafv2-application-gateway-in-zone-1-2-and-3","text":"az network application-gateway create \\ --name '<application_gateway_name>' \\ --location '<location>' \\ --resource-group '<resource_group>' \\ --capacity '<capacity>' \\ --sku WAF_v2 \\ --public-ip-address '<public_ip_address>' \\ --vnet-name '<virtual_network_name>' \\ --subnet '<subnet_name>' \\ --zones 1 2 3 \\ --servers '<address_1>' '<address_2>'","title":"Create WAFv2 Application Gateway in Zone 1, 2 and 3"},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#links","text":"Azure template reference Autoscaling and Zone-redundant Application Gateway v2 Use zone-aware services","title":"Links"},{"location":"en/rules/Azure.AppGw.MinInstance/","tags":["Azure.AppGw.MinInstance","AZR-000061"],"text":"Use two or more Application Gateway instances # Azure.AppGw.MinInstance AZR-000061 Error Reliability \u00b7 Application Gateway \u00b7 2020_06 Application Gateways should use a minimum of two instances. Description # Application Gateways should use two or more instances to be covered by the Service Level Agreement (SLA). Recommendation # When using Application Gateway v1 or v2 with auto-scaling disabled, specify the number of instances to be two or more. When auto-scaling is enabled with Application Gateway v2, configure the minimum number of instances to be two or more. Links # Azure Application Gateway SLA","title":"Azure.AppGw.MinInstance"},{"location":"en/rules/Azure.AppGw.MinInstance/#use-two-or-more-application-gateway-instances","text":"Azure.AppGw.MinInstance AZR-000061 Error Reliability \u00b7 Application Gateway \u00b7 2020_06 Application Gateways should use a minimum of two instances.","title":"Use two or more Application Gateway instances"},{"location":"en/rules/Azure.AppGw.MinInstance/#description","text":"Application Gateways should use two or more instances to be covered by the Service Level Agreement (SLA).","title":"Description"},{"location":"en/rules/Azure.AppGw.MinInstance/#recommendation","text":"When using Application Gateway v1 or v2 with auto-scaling disabled, specify the number of instances to be two or more. When auto-scaling is enabled with Application Gateway v2, configure the minimum number of instances to be two or more.","title":"Recommendation"},{"location":"en/rules/Azure.AppGw.MinInstance/#links","text":"Azure Application Gateway SLA","title":"Links"},{"location":"en/rules/Azure.AppGw.MinSku/","tags":["Azure.AppGw.MinSku","AZR-000062"],"text":"Use production Application Gateway SKU # Azure.AppGw.MinSku AZR-000062 Error Operational Excellence \u00b7 Application Gateway \u00b7 2020_06 Application Gateway should use a minimum instance size of Medium. Description # An Application Gateway is offered in different versions v1 and v2. When deploying an Application Gateway v1, three different instance sizes are available: Small, Medium and Large. Application Gateway v2, Standard_v2 and WAF_v2 SKUs don't offer different instance sizes. Recommendation # Application Gateways using v1 SKUs should be deployed with an instance size of Medium or Large. Small instance sizes are intended for development and testing scenarios. Links # Azure Application Gateway sizing","title":"Azure.AppGw.MinSku"},{"location":"en/rules/Azure.AppGw.MinSku/#use-production-application-gateway-sku","text":"Azure.AppGw.MinSku AZR-000062 Error Operational Excellence \u00b7 Application Gateway \u00b7 2020_06 Application Gateway should use a minimum instance size of Medium.","title":"Use production Application Gateway SKU"},{"location":"en/rules/Azure.AppGw.MinSku/#description","text":"An Application Gateway is offered in different versions v1 and v2. When deploying an Application Gateway v1, three different instance sizes are available: Small, Medium and Large. Application Gateway v2, Standard_v2 and WAF_v2 SKUs don't offer different instance sizes.","title":"Description"},{"location":"en/rules/Azure.AppGw.MinSku/#recommendation","text":"Application Gateways using v1 SKUs should be deployed with an instance size of Medium or Large. Small instance sizes are intended for development and testing scenarios.","title":"Recommendation"},{"location":"en/rules/Azure.AppGw.MinSku/#links","text":"Azure Application Gateway sizing","title":"Links"},{"location":"en/rules/Azure.AppGw.OWASP/","tags":["Azure.AppGw.OWASP","AZR-000067"],"text":"Use OWASP 3.x rules # Azure.AppGw.OWASP AZR-000067 Error Security \u00b7 Application Gateway \u00b7 2020_06 Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Description # Application Gateways deployed with WAF features support configuration of OWASP rule sets for detection and/ or prevention of malicious attacks. Two rule set versions are available; OWASP 2.x and OWASP 3.x. Recommendation # Consider configuring Application Gateways to use OWASP 3.x rules instead of 2.x rule set versions. Examples # Configure with Azure template # To deploy Application Gateways that pass this rule: Set the properties.webApplicationFirewallConfiguration.ruleSetType property to OWASP . Set the properties.webApplicationFirewallConfiguration.ruleSetVersion property to a minimum of 3.2 . For example: { \"type\" : \"Microsoft.Network/applicationGateways\" , \"apiVersion\" : \"2020-11-01\" , \"name\" : \"[parameters('appGwName')]\" , \"location\" : \"[resourceGroup().location]\" , \"properties\" : { \"sku\" : { \"name\" : \"WAF_v2\" , \"tier\" : \"WAF_v2\" }, \"webApplicationFirewallConfiguration\" : { \"enabled\" : true , \"firewallMode\" : \"Prevention\" , \"ruleSetType\" : \"OWASP\" , \"ruleSetVersion\" : \"3.2\" , \"disabledRuleGroups\" : [], \"requestBodyCheck\" : true , \"maxRequestBodySizeInKb\" : 128 , \"fileUploadLimitInMb\" : 100 } } } Configure with Bicep # To deploy Application Gateways that pass this rule: Set the properties.webApplicationFirewallConfiguration.ruleSetType property to OWASP . Set the properties.webApplicationFirewallConfiguration.ruleSetVersion property to a minimum of 3.2 . For example: resource appGw 'Microsoft.Network/applicationGateways@2021-02-01' = { name: 'appGw-001' properties: { sku: { name: 'WAF_v2' tier: 'WAF_v2' } webApplicationFirewallConfiguration: { enabled: true firewallMode: 'Prevention' ruleSetType: 'OWASP' ruleSetVersion: '3.2' } } } Configure with Azure CLI # az network application-gateway waf-config set --enabled true --rule-set-type OWASP --rule-set-version '3.2' -n '<name>' -g '<resource_group>' Configure with Azure PowerShell # $AppGw = Get-AzApplicationGateway -Name '<name>' -ResourceGroupName '<resource_group>' Set-AzApplicationGatewayWebApplicationFirewallConfiguration -ApplicationGateway $AppGw -Enabled $True -FirewallMode 'Prevention' -RuleSetType 'OWASP' -RuleSetVersion '3.2' Links # Best practices for endpoint security on Azure OWASP ModSecurity Core Rule Set Azure template reference","title":"Azure.AppGw.OWASP"},{"location":"en/rules/Azure.AppGw.OWASP/#use-owasp-3x-rules","text":"Azure.AppGw.OWASP AZR-000067 Error Security \u00b7 Application Gateway \u00b7 2020_06 Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules.","title":"Use OWASP 3.x rules"},{"location":"en/rules/Azure.AppGw.OWASP/#description","text":"Application Gateways deployed with WAF features support configuration of OWASP rule sets for detection and/ or prevention of malicious attacks. Two rule set versions are available; OWASP 2.x and OWASP 3.x.","title":"Description"},{"location":"en/rules/Azure.AppGw.OWASP/#recommendation","text":"Consider configuring Application Gateways to use OWASP 3.x rules instead of 2.x rule set versions.","title":"Recommendation"},{"location":"en/rules/Azure.AppGw.OWASP/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppGw.OWASP/#configure-with-azure-template","text":"To deploy Application Gateways that pass this rule: Set the properties.webApplicationFirewallConfiguration.ruleSetType property to OWASP . Set the properties.webApplicationFirewallConfiguration.ruleSetVersion property to a minimum of 3.2 . For example: { \"type\" : \"Microsoft.Network/applicationGateways\" , \"apiVersion\" : \"2020-11-01\" , \"name\" : \"[parameters('appGwName')]\" , \"location\" : \"[resourceGroup().location]\" , \"properties\" : { \"sku\" : { \"name\" : \"WAF_v2\" , \"tier\" : \"WAF_v2\" }, \"webApplicationFirewallConfiguration\" : { \"enabled\" : true , \"firewallMode\" : \"Prevention\" , \"ruleSetType\" : \"OWASP\" , \"ruleSetVersion\" : \"3.2\" , \"disabledRuleGroups\" : [], \"requestBodyCheck\" : true , \"maxRequestBodySizeInKb\" : 128 , \"fileUploadLimitInMb\" : 100 } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppGw.OWASP/#configure-with-bicep","text":"To deploy Application Gateways that pass this rule: Set the properties.webApplicationFirewallConfiguration.ruleSetType property to OWASP . Set the properties.webApplicationFirewallConfiguration.ruleSetVersion property to a minimum of 3.2 . For example: resource appGw 'Microsoft.Network/applicationGateways@2021-02-01' = { name: 'appGw-001' properties: { sku: { name: 'WAF_v2' tier: 'WAF_v2' } webApplicationFirewallConfiguration: { enabled: true firewallMode: 'Prevention' ruleSetType: 'OWASP' ruleSetVersion: '3.2' } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppGw.OWASP/#configure-with-azure-cli","text":"az network application-gateway waf-config set --enabled true --rule-set-type OWASP --rule-set-version '3.2' -n '<name>' -g '<resource_group>'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AppGw.OWASP/#configure-with-azure-powershell","text":"$AppGw = Get-AzApplicationGateway -Name '<name>' -ResourceGroupName '<resource_group>' Set-AzApplicationGatewayWebApplicationFirewallConfiguration -ApplicationGateway $AppGw -Enabled $True -FirewallMode 'Prevention' -RuleSetType 'OWASP' -RuleSetVersion '3.2'","title":"Configure with Azure PowerShell"},{"location":"en/rules/Azure.AppGw.OWASP/#links","text":"Best practices for endpoint security on Azure OWASP ModSecurity Core Rule Set Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppGw.Prevention/","tags":["Azure.AppGw.Prevention","AZR-000065"],"text":"Use WAF prevention mode # Azure.AppGw.Prevention AZR-000065 Error Security \u00b7 Application Gateway \u00b7 2020_06 Internet exposed Application Gateways should use prevention mode to protect backend resources. Description # Application Gateways with Web Application Firewall (WAF) enabled support two modes of operation: Detection - Monitors and logs all threat alerts. In this mode, the WAF doesn't block incoming requests that are potentially malicious. Protection - Blocks potentially malicious attack patterns that the rules detect. Recommendation # Consider switching Internet exposed Application Gateways to use prevention mode to protect backend resources. Examples # Configure with Azure template # To deploy Application Gateways that pass this rule: Set the properties.webApplicationFirewallConfiguration.firewallMode property to Prevention . For example: { \"type\" : \"Microsoft.Network/applicationGateways\" , \"apiVersion\" : \"2020-11-01\" , \"name\" : \"[parameters('appGwName')]\" , \"location\" : \"[resourceGroup().location]\" , \"properties\" : { \"sku\" : { \"name\" : \"WAF_v2\" , \"tier\" : \"WAF_v2\" }, \"webApplicationFirewallConfiguration\" : { \"enabled\" : true , \"firewallMode\" : \"Prevention\" , \"ruleSetType\" : \"OWASP\" , \"ruleSetVersion\" : \"3.2\" , \"disabledRuleGroups\" : [], \"requestBodyCheck\" : true , \"maxRequestBodySizeInKb\" : 128 , \"fileUploadLimitInMb\" : 100 } } } Configure with Bicep # To deploy Application Gateways that pass this rule: Set the properties.webApplicationFirewallConfiguration.firewallMode property to Prevention . For example: resource appGw 'Microsoft.Network/applicationGateways@2021-02-01' = { name: 'appGw-001' properties: { sku: { name: 'WAF_v2' tier: 'WAF_v2' } webApplicationFirewallConfiguration: { enabled: true firewallMode: 'Prevention' ruleSetType: 'OWASP' ruleSetVersion: '3.2' } } } Configure with Azure CLI # az network application-gateway waf-config set --enabled true --firewall-mode Prevention -n '<name>' -g '<resource_group>' Configure with Azure PowerShell # $AppGw = Get-AzApplicationGateway -Name '<name>' -ResourceGroupName '<resource_group>' Set-AzApplicationGatewayWebApplicationFirewallConfiguration -ApplicationGateway $AppGw -Enabled $True -FirewallMode 'Prevention' Links # Best practices for endpoint security on Azure Application Gateway WAF modes Azure template reference","title":"Azure.AppGw.Prevention"},{"location":"en/rules/Azure.AppGw.Prevention/#use-waf-prevention-mode","text":"Azure.AppGw.Prevention AZR-000065 Error Security \u00b7 Application Gateway \u00b7 2020_06 Internet exposed Application Gateways should use prevention mode to protect backend resources.","title":"Use WAF prevention mode"},{"location":"en/rules/Azure.AppGw.Prevention/#description","text":"Application Gateways with Web Application Firewall (WAF) enabled support two modes of operation: Detection - Monitors and logs all threat alerts. In this mode, the WAF doesn't block incoming requests that are potentially malicious. Protection - Blocks potentially malicious attack patterns that the rules detect.","title":"Description"},{"location":"en/rules/Azure.AppGw.Prevention/#recommendation","text":"Consider switching Internet exposed Application Gateways to use prevention mode to protect backend resources.","title":"Recommendation"},{"location":"en/rules/Azure.AppGw.Prevention/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppGw.Prevention/#configure-with-azure-template","text":"To deploy Application Gateways that pass this rule: Set the properties.webApplicationFirewallConfiguration.firewallMode property to Prevention . For example: { \"type\" : \"Microsoft.Network/applicationGateways\" , \"apiVersion\" : \"2020-11-01\" , \"name\" : \"[parameters('appGwName')]\" , \"location\" : \"[resourceGroup().location]\" , \"properties\" : { \"sku\" : { \"name\" : \"WAF_v2\" , \"tier\" : \"WAF_v2\" }, \"webApplicationFirewallConfiguration\" : { \"enabled\" : true , \"firewallMode\" : \"Prevention\" , \"ruleSetType\" : \"OWASP\" , \"ruleSetVersion\" : \"3.2\" , \"disabledRuleGroups\" : [], \"requestBodyCheck\" : true , \"maxRequestBodySizeInKb\" : 128 , \"fileUploadLimitInMb\" : 100 } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppGw.Prevention/#configure-with-bicep","text":"To deploy Application Gateways that pass this rule: Set the properties.webApplicationFirewallConfiguration.firewallMode property to Prevention . For example: resource appGw 'Microsoft.Network/applicationGateways@2021-02-01' = { name: 'appGw-001' properties: { sku: { name: 'WAF_v2' tier: 'WAF_v2' } webApplicationFirewallConfiguration: { enabled: true firewallMode: 'Prevention' ruleSetType: 'OWASP' ruleSetVersion: '3.2' } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppGw.Prevention/#configure-with-azure-cli","text":"az network application-gateway waf-config set --enabled true --firewall-mode Prevention -n '<name>' -g '<resource_group>'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AppGw.Prevention/#configure-with-azure-powershell","text":"$AppGw = Get-AzApplicationGateway -Name '<name>' -ResourceGroupName '<resource_group>' Set-AzApplicationGatewayWebApplicationFirewallConfiguration -ApplicationGateway $AppGw -Enabled $True -FirewallMode 'Prevention'","title":"Configure with Azure PowerShell"},{"location":"en/rules/Azure.AppGw.Prevention/#links","text":"Best practices for endpoint security on Azure Application Gateway WAF modes Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppGw.SSLPolicy/","tags":["Azure.AppGw.SSLPolicy","AZR-000064"],"text":"Application Gateways use a minimum TLS 1.2 # Azure.AppGw.SSLPolicy AZR-000064 Error Security \u00b7 Application Gateway \u00b7 2020_06 Application Gateway should only accept a minimum of TLS 1.2. Description # Application Gateway should only accept a minimum of TLS 1.2. Recommendation # Consider configuring Application Gateway to accept a minimum of TLS 1.2. Links # Data encryption in Azure Application Gateway SSL policy overview Configure SSL policy versions and cipher suites on Application Gateway Overview of TLS termination and end to end TLS with Application Gateway","title":"Azure.AppGw.SSLPolicy"},{"location":"en/rules/Azure.AppGw.SSLPolicy/#application-gateways-use-a-minimum-tls-12","text":"Azure.AppGw.SSLPolicy AZR-000064 Error Security \u00b7 Application Gateway \u00b7 2020_06 Application Gateway should only accept a minimum of TLS 1.2.","title":"Application Gateways use a minimum TLS 1.2"},{"location":"en/rules/Azure.AppGw.SSLPolicy/#description","text":"Application Gateway should only accept a minimum of TLS 1.2.","title":"Description"},{"location":"en/rules/Azure.AppGw.SSLPolicy/#recommendation","text":"Consider configuring Application Gateway to accept a minimum of TLS 1.2.","title":"Recommendation"},{"location":"en/rules/Azure.AppGw.SSLPolicy/#links","text":"Data encryption in Azure Application Gateway SSL policy overview Configure SSL policy versions and cipher suites on Application Gateway Overview of TLS termination and end to end TLS with Application Gateway","title":"Links"},{"location":"en/rules/Azure.AppGw.UseHTTPS/","tags":["Azure.AppGw.UseHTTPS","AZR-000059"],"text":"Expose frontend HTTP endpoints over HTTPS # Azure.AppGw.UseHTTPS AZR-000059 Error Security \u00b7 Application Gateway \u00b7 2021_09 Application Gateways should only expose frontend HTTP endpoints over HTTPS. Description # Application Gateways support HTTP and HTTPS endpoints for backend and frontend traffic. When using frontend HTTP (80) endpoints, traffic between client and Application Gateway is not encrypted. Unencrypted communication could allow disclosure of information to an un-trusted party. Recommendation # Consider configuring Application Gateways to only expose HTTPS endpoints. For client applications such as progressive web apps, consider redirecting HTTP traffic to HTTPS. Links # Data encryption in Azure Create an application gateway with HTTP to HTTPS redirection using the Azure portal Azure template reference","title":"Azure.AppGw.UseHTTPS"},{"location":"en/rules/Azure.AppGw.UseHTTPS/#expose-frontend-http-endpoints-over-https","text":"Azure.AppGw.UseHTTPS AZR-000059 Error Security \u00b7 Application Gateway \u00b7 2021_09 Application Gateways should only expose frontend HTTP endpoints over HTTPS.","title":"Expose frontend HTTP endpoints over HTTPS"},{"location":"en/rules/Azure.AppGw.UseHTTPS/#description","text":"Application Gateways support HTTP and HTTPS endpoints for backend and frontend traffic. When using frontend HTTP (80) endpoints, traffic between client and Application Gateway is not encrypted. Unencrypted communication could allow disclosure of information to an un-trusted party.","title":"Description"},{"location":"en/rules/Azure.AppGw.UseHTTPS/#recommendation","text":"Consider configuring Application Gateways to only expose HTTPS endpoints. For client applications such as progressive web apps, consider redirecting HTTP traffic to HTTPS.","title":"Recommendation"},{"location":"en/rules/Azure.AppGw.UseHTTPS/#links","text":"Data encryption in Azure Create an application gateway with HTTP to HTTPS redirection using the Azure portal Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppGw.UseWAF/","tags":["Azure.AppGw.UseWAF","AZR-000063"],"text":"Application Gateway uses WAF SKU # Azure.AppGw.UseWAF AZR-000063 Error Security \u00b7 Application Gateway \u00b7 2020_06 Internet accessible Application Gateways should use protect endpoints with WAF. Description # Application Gateway endpoints can optionally be configured with a Web Application Firewall (WAF) policy. When configured, every incoming request is filtered by the WAF policy. To use a WAF policy, the Application Gateway must be deployed with a Web Application Firewall SKU. Recommendation # Consider deploying Application Gateways with a WAF SKU to protect against common attacks. Examples # Configure with Azure template # To deploy Application Gateways that pass this rule: Deploy an Application Gateway with the WAF or WAF_v2 SKU. For example: { \"type\" : \"Microsoft.Network/applicationGateways\" , \"apiVersion\" : \"2020-11-01\" , \"name\" : \"[parameters('appGwName')]\" , \"location\" : \"[resourceGroup().location]\" , \"properties\" : { \"sku\" : { \"name\" : \"WAF_v2\" , \"tier\" : \"WAF_v2\" }, \"webApplicationFirewallConfiguration\" : { \"enabled\" : true , \"firewallMode\" : \"Prevention\" , \"ruleSetType\" : \"OWASP\" , \"ruleSetVersion\" : \"3.2\" , \"disabledRuleGroups\" : [], \"requestBodyCheck\" : true , \"maxRequestBodySizeInKb\" : 128 , \"fileUploadLimitInMb\" : 100 } } } Configure with Bicep # To deploy Application Gateways that pass this rule: Deploy an Application Gateway with the WAF or WAF_v2 SKU. For example: resource appGw 'Microsoft.Network/applicationGateways@2021-02-01' = { name: 'appGw-001' properties: { sku: { name: 'WAF_v2' tier: 'WAF_v2' } webApplicationFirewallConfiguration: { enabled: true firewallMode: 'Prevention' ruleSetType: 'OWASP' ruleSetVersion: '3.2' } } } Configure with Azure CLI # az network application-gateway update --sku WAF_v2 -n '<name>' -g '<resource_group>' Configure with Azure PowerShell # $AppGw = Get-AzApplicationGateway -Name '<name>' -ResourceGroupName '<resource_group>' $AppGw = Set-AzApplicationGatewaySku -ApplicationGateway $AppGw -Name 'WAF_v2' -Tier 'WAF_v2' Links # Best practices for endpoint security on Azure Securing PaaS deployments What is Azure Web Application Firewall on Azure Application Gateway? Azure deployment reference","title":"Azure.AppGw.UseWAF"},{"location":"en/rules/Azure.AppGw.UseWAF/#application-gateway-uses-waf-sku","text":"Azure.AppGw.UseWAF AZR-000063 Error Security \u00b7 Application Gateway \u00b7 2020_06 Internet accessible Application Gateways should use protect endpoints with WAF.","title":"Application Gateway uses WAF SKU"},{"location":"en/rules/Azure.AppGw.UseWAF/#description","text":"Application Gateway endpoints can optionally be configured with a Web Application Firewall (WAF) policy. When configured, every incoming request is filtered by the WAF policy. To use a WAF policy, the Application Gateway must be deployed with a Web Application Firewall SKU.","title":"Description"},{"location":"en/rules/Azure.AppGw.UseWAF/#recommendation","text":"Consider deploying Application Gateways with a WAF SKU to protect against common attacks.","title":"Recommendation"},{"location":"en/rules/Azure.AppGw.UseWAF/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppGw.UseWAF/#configure-with-azure-template","text":"To deploy Application Gateways that pass this rule: Deploy an Application Gateway with the WAF or WAF_v2 SKU. For example: { \"type\" : \"Microsoft.Network/applicationGateways\" , \"apiVersion\" : \"2020-11-01\" , \"name\" : \"[parameters('appGwName')]\" , \"location\" : \"[resourceGroup().location]\" , \"properties\" : { \"sku\" : { \"name\" : \"WAF_v2\" , \"tier\" : \"WAF_v2\" }, \"webApplicationFirewallConfiguration\" : { \"enabled\" : true , \"firewallMode\" : \"Prevention\" , \"ruleSetType\" : \"OWASP\" , \"ruleSetVersion\" : \"3.2\" , \"disabledRuleGroups\" : [], \"requestBodyCheck\" : true , \"maxRequestBodySizeInKb\" : 128 , \"fileUploadLimitInMb\" : 100 } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppGw.UseWAF/#configure-with-bicep","text":"To deploy Application Gateways that pass this rule: Deploy an Application Gateway with the WAF or WAF_v2 SKU. For example: resource appGw 'Microsoft.Network/applicationGateways@2021-02-01' = { name: 'appGw-001' properties: { sku: { name: 'WAF_v2' tier: 'WAF_v2' } webApplicationFirewallConfiguration: { enabled: true firewallMode: 'Prevention' ruleSetType: 'OWASP' ruleSetVersion: '3.2' } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppGw.UseWAF/#configure-with-azure-cli","text":"az network application-gateway update --sku WAF_v2 -n '<name>' -g '<resource_group>'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AppGw.UseWAF/#configure-with-azure-powershell","text":"$AppGw = Get-AzApplicationGateway -Name '<name>' -ResourceGroupName '<resource_group>' $AppGw = Set-AzApplicationGatewaySku -ApplicationGateway $AppGw -Name 'WAF_v2' -Tier 'WAF_v2'","title":"Configure with Azure PowerShell"},{"location":"en/rules/Azure.AppGw.UseWAF/#links","text":"Best practices for endpoint security on Azure Securing PaaS deployments What is Azure Web Application Firewall on Azure Application Gateway? Azure deployment reference","title":"Links"},{"location":"en/rules/Azure.AppGw.WAFEnabled/","tags":["Azure.AppGw.WAFEnabled","AZR-000066"],"text":"Application Gateway WAF is enabled # Azure.AppGw.WAFEnabled AZR-000066 Error Security \u00b7 Application Gateway \u00b7 2020_06 Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Description # Security features of Application Gateways deployed with WAF may be toggled on or off. When WAF is disabled network traffic is still processed by the Application Gateway however detection and/ or prevention of malicious attacks does not occur. To protect backend resources from potentially malicious network traffic, WAF must be enabled. Recommendation # Consider enabling WAF for Application Gateway instances connected to un-trusted or low-trust networks such as the Internet. Examples # Configure with Azure template # To deploy Application Gateways that pass this rule: Set the properties.webApplicationFirewallConfiguration.enabled property to true . For example: { \"type\" : \"Microsoft.Network/applicationGateways\" , \"apiVersion\" : \"2020-11-01\" , \"name\" : \"[parameters('appGwName')]\" , \"location\" : \"[resourceGroup().location]\" , \"properties\" : { \"sku\" : { \"name\" : \"WAF_v2\" , \"tier\" : \"WAF_v2\" }, \"webApplicationFirewallConfiguration\" : { \"enabled\" : true , \"firewallMode\" : \"Prevention\" , \"ruleSetType\" : \"OWASP\" , \"ruleSetVersion\" : \"3.2\" , \"disabledRuleGroups\" : [], \"requestBodyCheck\" : true , \"maxRequestBodySizeInKb\" : 128 , \"fileUploadLimitInMb\" : 100 } } } Configure with Bicep # To deploy Application Gateways that pass this rule: Set the properties.webApplicationFirewallConfiguration.enabled property to true . For example: resource appGw 'Microsoft.Network/applicationGateways@2021-02-01' = { name: 'appGw-001' properties: { sku: { name: 'WAF_v2' tier: 'WAF_v2' } webApplicationFirewallConfiguration: { enabled: true firewallMode: 'Prevention' ruleSetType: 'OWASP' ruleSetVersion: '3.2' } } } Configure with Azure CLI # az network application-gateway waf-config set --enabled true -n '<name>' -g '<resource_group>' Configure with Azure PowerShell # $AppGw = Get-AzApplicationGateway -Name '<name>' -ResourceGroupName '<resource_group>' Set-AzApplicationGatewayWebApplicationFirewallConfiguration -ApplicationGateway $AppGw -Enabled $True -FirewallMode 'Prevention' Links # Best practices for endpoint security on Azure Securing PaaS deployments What is Azure Web Application Firewall on Azure Application Gateway? Azure template reference","title":"Azure.AppGw.WAFEnabled"},{"location":"en/rules/Azure.AppGw.WAFEnabled/#application-gateway-waf-is-enabled","text":"Azure.AppGw.WAFEnabled AZR-000066 Error Security \u00b7 Application Gateway \u00b7 2020_06 Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources.","title":"Application Gateway WAF is enabled"},{"location":"en/rules/Azure.AppGw.WAFEnabled/#description","text":"Security features of Application Gateways deployed with WAF may be toggled on or off. When WAF is disabled network traffic is still processed by the Application Gateway however detection and/ or prevention of malicious attacks does not occur. To protect backend resources from potentially malicious network traffic, WAF must be enabled.","title":"Description"},{"location":"en/rules/Azure.AppGw.WAFEnabled/#recommendation","text":"Consider enabling WAF for Application Gateway instances connected to un-trusted or low-trust networks such as the Internet.","title":"Recommendation"},{"location":"en/rules/Azure.AppGw.WAFEnabled/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppGw.WAFEnabled/#configure-with-azure-template","text":"To deploy Application Gateways that pass this rule: Set the properties.webApplicationFirewallConfiguration.enabled property to true . For example: { \"type\" : \"Microsoft.Network/applicationGateways\" , \"apiVersion\" : \"2020-11-01\" , \"name\" : \"[parameters('appGwName')]\" , \"location\" : \"[resourceGroup().location]\" , \"properties\" : { \"sku\" : { \"name\" : \"WAF_v2\" , \"tier\" : \"WAF_v2\" }, \"webApplicationFirewallConfiguration\" : { \"enabled\" : true , \"firewallMode\" : \"Prevention\" , \"ruleSetType\" : \"OWASP\" , \"ruleSetVersion\" : \"3.2\" , \"disabledRuleGroups\" : [], \"requestBodyCheck\" : true , \"maxRequestBodySizeInKb\" : 128 , \"fileUploadLimitInMb\" : 100 } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppGw.WAFEnabled/#configure-with-bicep","text":"To deploy Application Gateways that pass this rule: Set the properties.webApplicationFirewallConfiguration.enabled property to true . For example: resource appGw 'Microsoft.Network/applicationGateways@2021-02-01' = { name: 'appGw-001' properties: { sku: { name: 'WAF_v2' tier: 'WAF_v2' } webApplicationFirewallConfiguration: { enabled: true firewallMode: 'Prevention' ruleSetType: 'OWASP' ruleSetVersion: '3.2' } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppGw.WAFEnabled/#configure-with-azure-cli","text":"az network application-gateway waf-config set --enabled true -n '<name>' -g '<resource_group>'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.AppGw.WAFEnabled/#configure-with-azure-powershell","text":"$AppGw = Get-AzApplicationGateway -Name '<name>' -ResourceGroupName '<resource_group>' Set-AzApplicationGatewayWebApplicationFirewallConfiguration -ApplicationGateway $AppGw -Enabled $True -FirewallMode 'Prevention'","title":"Configure with Azure PowerShell"},{"location":"en/rules/Azure.AppGw.WAFEnabled/#links","text":"Best practices for endpoint security on Azure Securing PaaS deployments What is Azure Web Application Firewall on Azure Application Gateway? Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppGw.WAFRules/","tags":["Azure.AppGw.WAFRules","AZR-000068"],"text":"Application Gateway rules are enabled # Azure.AppGw.WAFRules AZR-000068 Error Security \u00b7 Application Gateway \u00b7 2020_06 Application Gateway Web Application Firewall (WAF) should have all rules enabled. Description # Application Gateway instances with WAF allow OWASP detection/ prevention rules to be toggled on or off. All OWASP rules are turned on by default. When OWASP rules are turned off, the protection they provide is disabled. Recommendation # Consider enabling all OWASP rules within Application Gateway instances. Before disabling OWASP rules, ensure that the backend workload has alternative protections in-place. Alternatively consider updating application code to use safe web standards. Links # Best practices for endpoint security on Azure Securing PaaS deployments What is Azure Web Application Firewall on Azure Application Gateway? Web Application Firewall CRS rule groups and rules","title":"Azure.AppGw.WAFRules"},{"location":"en/rules/Azure.AppGw.WAFRules/#application-gateway-rules-are-enabled","text":"Azure.AppGw.WAFRules AZR-000068 Error Security \u00b7 Application Gateway \u00b7 2020_06 Application Gateway Web Application Firewall (WAF) should have all rules enabled.","title":"Application Gateway rules are enabled"},{"location":"en/rules/Azure.AppGw.WAFRules/#description","text":"Application Gateway instances with WAF allow OWASP detection/ prevention rules to be toggled on or off. All OWASP rules are turned on by default. When OWASP rules are turned off, the protection they provide is disabled.","title":"Description"},{"location":"en/rules/Azure.AppGw.WAFRules/#recommendation","text":"Consider enabling all OWASP rules within Application Gateway instances. Before disabling OWASP rules, ensure that the backend workload has alternative protections in-place. Alternatively consider updating application code to use safe web standards.","title":"Recommendation"},{"location":"en/rules/Azure.AppGw.WAFRules/#links","text":"Best practices for endpoint security on Azure Securing PaaS deployments What is Azure Web Application Firewall on Azure Application Gateway? Web Application Firewall CRS rule groups and rules","title":"Links"},{"location":"en/rules/Azure.AppInsights.Name/","tags":["Azure.AppInsights.Name","AZR-000070"],"text":"Use valid Application Insights resource names # Azure.AppInsights.Name AZR-000070 Error Operational Excellence \u00b7 Application Insights \u00b7 2021_06 Azure Application Insights resources names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Application Insights resource names are: Between 1 and 255 characters long. Letters, numbers, hyphens, periods, underscores, and parenthesis. Must not end in a period. Resource names must be unique within a resource group. Recommendation # Consider using names that meet Application Insights resource naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Application Insights resource names are unique. Links # Repeatable infrastructure Define your naming convention Recommended abbreviations for Azure resource types Azure template reference","title":"Azure.AppInsights.Name"},{"location":"en/rules/Azure.AppInsights.Name/#use-valid-application-insights-resource-names","text":"Azure.AppInsights.Name AZR-000070 Error Operational Excellence \u00b7 Application Insights \u00b7 2021_06 Azure Application Insights resources names should meet naming requirements.","title":"Use valid Application Insights resource names"},{"location":"en/rules/Azure.AppInsights.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Application Insights resource names are: Between 1 and 255 characters long. Letters, numbers, hyphens, periods, underscores, and parenthesis. Must not end in a period. Resource names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.AppInsights.Name/#recommendation","text":"Consider using names that meet Application Insights resource naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.AppInsights.Name/#notes","text":"This rule does not check if Application Insights resource names are unique.","title":"Notes"},{"location":"en/rules/Azure.AppInsights.Name/#links","text":"Repeatable infrastructure Define your naming convention Recommended abbreviations for Azure resource types Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppInsights.Workspace/","tags":["Azure.AppInsights.Workspace","AZR-000069"],"text":"Use workspace-based App Insights resources # Azure.AppInsights.Workspace AZR-000069 Error Operational Excellence \u00b7 Application Insights \u00b7 2021_06 Configure Application Insights resources to store data in workspaces. Description # Application Insights (App Insights) can be deployed as either classic or workspace-based resources. When configured as workspace-based, telemetry is sent from App Insights to a common Log Analytics workspace. Using a Log Analytics workspace for App Insights: Makes it easier to query across applications. Adds support for additional features of Log Analytics workspaces including: Customer-Managed Keys (CMK). Support for Azure Private Link. Capacity Reservation tiers. Faster data ingestion. App Insights resources can be configured as workspace-based either during or after initial deployment. Recommendation # Consider using workspace-based Application Insights resources to collect telemetry in shared storage. Examples # Configure with Azure template # To deploy Application Insights resources that pass this rule: Set the properties.WorkspaceResourceId property to a valid Log Analytics workspace. For example: { \"type\" : \"microsoft.insights/components\" , \"apiVersion\" : \"2020-02-02\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"kind\" : \"web\" , \"properties\" : { \"Application_Type\" : \"web\" , \"Flow_Type\" : \"Redfield\" , \"Request_Source\" : \"IbizaAIExtension\" , \"WorkspaceResourceId\" : \"[parameters('workspaceId')]\" } } Configure with Bicep # To deploy Application Insights resources that pass this rule: Set the properties.WorkspaceResourceId property to a valid Log Analytics workspace. For example: resource appInsights 'Microsoft.Insights/components@2020-02-02' = { name: name location: location kind: 'web' properties: { Application_Type: 'web' Flow_Type: 'Redfield' Request_Source: 'IbizaAIExtension' WorkspaceResourceId: workspaceId } } Links # Collection and storage Migrate to workspace-based Application Insights resources Azure resource template","title":"Azure.AppInsights.Workspace"},{"location":"en/rules/Azure.AppInsights.Workspace/#use-workspace-based-app-insights-resources","text":"Azure.AppInsights.Workspace AZR-000069 Error Operational Excellence \u00b7 Application Insights \u00b7 2021_06 Configure Application Insights resources to store data in workspaces.","title":"Use workspace-based App Insights resources"},{"location":"en/rules/Azure.AppInsights.Workspace/#description","text":"Application Insights (App Insights) can be deployed as either classic or workspace-based resources. When configured as workspace-based, telemetry is sent from App Insights to a common Log Analytics workspace. Using a Log Analytics workspace for App Insights: Makes it easier to query across applications. Adds support for additional features of Log Analytics workspaces including: Customer-Managed Keys (CMK). Support for Azure Private Link. Capacity Reservation tiers. Faster data ingestion. App Insights resources can be configured as workspace-based either during or after initial deployment.","title":"Description"},{"location":"en/rules/Azure.AppInsights.Workspace/#recommendation","text":"Consider using workspace-based Application Insights resources to collect telemetry in shared storage.","title":"Recommendation"},{"location":"en/rules/Azure.AppInsights.Workspace/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppInsights.Workspace/#configure-with-azure-template","text":"To deploy Application Insights resources that pass this rule: Set the properties.WorkspaceResourceId property to a valid Log Analytics workspace. For example: { \"type\" : \"microsoft.insights/components\" , \"apiVersion\" : \"2020-02-02\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"kind\" : \"web\" , \"properties\" : { \"Application_Type\" : \"web\" , \"Flow_Type\" : \"Redfield\" , \"Request_Source\" : \"IbizaAIExtension\" , \"WorkspaceResourceId\" : \"[parameters('workspaceId')]\" } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppInsights.Workspace/#configure-with-bicep","text":"To deploy Application Insights resources that pass this rule: Set the properties.WorkspaceResourceId property to a valid Log Analytics workspace. For example: resource appInsights 'Microsoft.Insights/components@2020-02-02' = { name: name location: location kind: 'web' properties: { Application_Type: 'web' Flow_Type: 'Redfield' Request_Source: 'IbizaAIExtension' WorkspaceResourceId: workspaceId } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppInsights.Workspace/#links","text":"Collection and storage Migrate to workspace-based Application Insights resources Azure resource template","title":"Links"},{"location":"en/rules/Azure.AppService.ARRAffinity/","tags":["Azure.AppService.ARRAffinity","AZR-000083"],"text":"Disable Application Request Routing # Azure.AppService.ARRAffinity AZR-000083 Error Performance Efficiency \u00b7 App Service \u00b7 2020_06 Disable client affinity for stateless services. Description # Azure App Service apps use Application Request Routing (ARR) by default. ARR uses a cookie to route subsequent client requests back to the same instance when an app is scaled to two or more instances. This benefits stateful applications, which may hold session information in instance memory. For stateless applications, disabling ARR allows Azure App Service more evenly distribute load. Recommendation # Azure App Service sites make use of Application Request Routing (ARR) by default. Consider disabling ARR affinity for stateless applications. Links # Configure an App Service app Overview of the performance efficiency pillar Session affinity Performance efficiency checklist","title":"Azure.AppService.ARRAffinity"},{"location":"en/rules/Azure.AppService.ARRAffinity/#disable-application-request-routing","text":"Azure.AppService.ARRAffinity AZR-000083 Error Performance Efficiency \u00b7 App Service \u00b7 2020_06 Disable client affinity for stateless services.","title":"Disable Application Request Routing"},{"location":"en/rules/Azure.AppService.ARRAffinity/#description","text":"Azure App Service apps use Application Request Routing (ARR) by default. ARR uses a cookie to route subsequent client requests back to the same instance when an app is scaled to two or more instances. This benefits stateful applications, which may hold session information in instance memory. For stateless applications, disabling ARR allows Azure App Service more evenly distribute load.","title":"Description"},{"location":"en/rules/Azure.AppService.ARRAffinity/#recommendation","text":"Azure App Service sites make use of Application Request Routing (ARR) by default. Consider disabling ARR affinity for stateless applications.","title":"Recommendation"},{"location":"en/rules/Azure.AppService.ARRAffinity/#links","text":"Configure an App Service app Overview of the performance efficiency pillar Session affinity Performance efficiency checklist","title":"Links"},{"location":"en/rules/Azure.AppService.AlwaysOn/","tags":["Azure.AppService.AlwaysOn","AZR-000077"],"text":"Use App Service Always On # Azure.AppService.AlwaysOn AZR-000077 Error Performance Efficiency \u00b7 App Service \u00b7 2020_12 Configure Always On for App Service apps. Description # Azure App Service apps are automatically unloaded when there's no traffic. Unloading apps reduces resource consumption when apps share a single App Services Plan. After an app have been unloaded, the next web request will trigger a cold start of the app. A cold start of the app can cause a noticeable performance issues and request timeouts. Continuous WebJobs or WebJobs triggered with a CRON expression must use always on to start. The Always On feature is implemented by the App Service load balancer, periodically sending requests to the application root. Recommendation # Consider enabling Always On for each App Services app. Examples # Configure with Azure template # To deploy App Services that pass this rule: Set properties.siteConfig.alwaysOn to true . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] } Configure with Bicep # To deploy App Services that pass this rule: Set properties.siteConfig.alwaysOn to true . For example: resource webApp 'Microsoft.Web/sites@2021-02-01' = { name: name location: location kind: 'web' properties: { serverFarmId: appPlan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true } } tags: tags } Links # Configure an App Service app Azure template reference","title":"Azure.AppService.AlwaysOn"},{"location":"en/rules/Azure.AppService.AlwaysOn/#use-app-service-always-on","text":"Azure.AppService.AlwaysOn AZR-000077 Error Performance Efficiency \u00b7 App Service \u00b7 2020_12 Configure Always On for App Service apps.","title":"Use App Service Always On"},{"location":"en/rules/Azure.AppService.AlwaysOn/#description","text":"Azure App Service apps are automatically unloaded when there's no traffic. Unloading apps reduces resource consumption when apps share a single App Services Plan. After an app have been unloaded, the next web request will trigger a cold start of the app. A cold start of the app can cause a noticeable performance issues and request timeouts. Continuous WebJobs or WebJobs triggered with a CRON expression must use always on to start. The Always On feature is implemented by the App Service load balancer, periodically sending requests to the application root.","title":"Description"},{"location":"en/rules/Azure.AppService.AlwaysOn/#recommendation","text":"Consider enabling Always On for each App Services app.","title":"Recommendation"},{"location":"en/rules/Azure.AppService.AlwaysOn/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppService.AlwaysOn/#configure-with-azure-template","text":"To deploy App Services that pass this rule: Set properties.siteConfig.alwaysOn to true . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppService.AlwaysOn/#configure-with-bicep","text":"To deploy App Services that pass this rule: Set properties.siteConfig.alwaysOn to true . For example: resource webApp 'Microsoft.Web/sites@2021-02-01' = { name: name location: location kind: 'web' properties: { serverFarmId: appPlan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppService.AlwaysOn/#links","text":"Configure an App Service app Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppService.HTTP2/","tags":["Azure.AppService.HTTP2","AZR-000078"],"text":"Use HTTP/2 connections for App Service apps # Azure.AppService.HTTP2 AZR-000078 Error Performance Efficiency \u00b7 App Service \u00b7 2020_12 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Description # Azure App Service has native support for HTTP/2, but by default it is disabled. HTTP/2 offers a number of improvements over HTTP/1.1, including: Connections are fully multiplexed, instead of ordered and blocking. Connections are reused, reducing connection establishment overhead. Headers are compressed to reduce overhead. Recommendation # Consider using HTTP/2 for Azure Services apps to improve protocol efficiency. Examples # Configure with Azure template # To deploy App Services that pass this rule: Set properties.siteConfig.http20Enabled to true . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] } Configure with Bicep # To deploy App Services that pass this rule: Set properties.siteConfig.http20Enabled to true . For example: resource webApp 'Microsoft.Web/sites@2021-02-01' = { name: name location: location kind: 'web' properties: { serverFarmId: appPlan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true } } tags: tags } Links # Performance efficiency checklist Configure an App Service app Azure template reference","title":"Azure.AppService.HTTP2"},{"location":"en/rules/Azure.AppService.HTTP2/#use-http2-connections-for-app-service-apps","text":"Azure.AppService.HTTP2 AZR-000078 Error Performance Efficiency \u00b7 App Service \u00b7 2020_12 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency.","title":"Use HTTP/2 connections for App Service apps"},{"location":"en/rules/Azure.AppService.HTTP2/#description","text":"Azure App Service has native support for HTTP/2, but by default it is disabled. HTTP/2 offers a number of improvements over HTTP/1.1, including: Connections are fully multiplexed, instead of ordered and blocking. Connections are reused, reducing connection establishment overhead. Headers are compressed to reduce overhead.","title":"Description"},{"location":"en/rules/Azure.AppService.HTTP2/#recommendation","text":"Consider using HTTP/2 for Azure Services apps to improve protocol efficiency.","title":"Recommendation"},{"location":"en/rules/Azure.AppService.HTTP2/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppService.HTTP2/#configure-with-azure-template","text":"To deploy App Services that pass this rule: Set properties.siteConfig.http20Enabled to true . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppService.HTTP2/#configure-with-bicep","text":"To deploy App Services that pass this rule: Set properties.siteConfig.http20Enabled to true . For example: resource webApp 'Microsoft.Web/sites@2021-02-01' = { name: name location: location kind: 'web' properties: { serverFarmId: appPlan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppService.HTTP2/#links","text":"Performance efficiency checklist Configure an App Service app Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppService.ManagedIdentity/","tags":["Azure.AppService.ManagedIdentity","AZR-000082"],"text":"App Service apps uses a managed identity # Azure.AppService.ManagedIdentity AZR-000082 Error Security \u00b7 App Service \u00b7 2020_12 Configure managed identities to access Azure resources. Description # Azure App Service apps must authenticate to Azure resources such as Azure SQL Databases. App Service can use managed identities to authenticate to Azure resource without storing credentials. Using Azure managed identities have the following benefits: You don't need to store or manage credentials. Azure automatically generates tokens and performs rotation. You can use managed identities to authenticate to any Azure service that supports Azure AD authentication. Managed identities can be used without any additional cost. Recommendation # Consider configuring a managed identity for each App Service app. Also consider using managed identities to authenticate to related Azure services. Examples # Configure with Azure template # To deploy App Services that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] } Configure with Bicep # To deploy App Services that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: resource webApp 'Microsoft.Web/sites@2021-02-01' = { name: name location: location identity: { type: 'SystemAssigned' } kind: 'web' properties: { serverFarmId: plan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true } } tags: tags } Links # Use identity-based authentication What are managed identities for Azure resources? Tutorial: Secure Azure SQL Database connection from App Service using a managed identity How to use managed identities for App Service and Azure Functions Azure template reference","title":"Azure.AppService.ManagedIdentity"},{"location":"en/rules/Azure.AppService.ManagedIdentity/#app-service-apps-uses-a-managed-identity","text":"Azure.AppService.ManagedIdentity AZR-000082 Error Security \u00b7 App Service \u00b7 2020_12 Configure managed identities to access Azure resources.","title":"App Service apps uses a managed identity"},{"location":"en/rules/Azure.AppService.ManagedIdentity/#description","text":"Azure App Service apps must authenticate to Azure resources such as Azure SQL Databases. App Service can use managed identities to authenticate to Azure resource without storing credentials. Using Azure managed identities have the following benefits: You don't need to store or manage credentials. Azure automatically generates tokens and performs rotation. You can use managed identities to authenticate to any Azure service that supports Azure AD authentication. Managed identities can be used without any additional cost.","title":"Description"},{"location":"en/rules/Azure.AppService.ManagedIdentity/#recommendation","text":"Consider configuring a managed identity for each App Service app. Also consider using managed identities to authenticate to related Azure services.","title":"Recommendation"},{"location":"en/rules/Azure.AppService.ManagedIdentity/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppService.ManagedIdentity/#configure-with-azure-template","text":"To deploy App Services that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppService.ManagedIdentity/#configure-with-bicep","text":"To deploy App Services that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: resource webApp 'Microsoft.Web/sites@2021-02-01' = { name: name location: location identity: { type: 'SystemAssigned' } kind: 'web' properties: { serverFarmId: plan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppService.ManagedIdentity/#links","text":"Use identity-based authentication What are managed identities for Azure resources? Tutorial: Secure Azure SQL Database connection from App Service using a managed identity How to use managed identities for App Service and Azure Functions Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppService.MinPlan/","tags":["Azure.AppService.MinPlan","AZR-000072"],"text":"Use App Service production SKU # Azure.AppService.MinPlan AZR-000072 Error Performance Efficiency \u00b7 App Service \u00b7 2020_06 Use at least a Standard App Service Plan. Description # Azure App Services provide a range of different plans that can be used to scale your application. Each plan provides different levels of performance and features. To get you started a number of entry level plans are available. The Free , Shared , and Basic plans can be used for limited testing and development. However these plans are not suitable for production use. Production workloads are best suited to standard and premium plans with PremiumV3 the newest plan. This rule does not apply to consumption or elastic App Services Plans used for Azure Functions. Recommendation # Consider using a standard or premium plan for hosting apps on Azure App Service. Examples # Configure with Azure template # To deploy App Services Plans that pass this rule: Set sku.tier to a plan equal to or greater than Standard . For example: PremiumV3 , PremiumV2 , Premium , Standard For example: { \"type\" : \"Microsoft.Web/serverfarms\" , \"apiVersion\" : \"2021-01-15\" , \"name\" : \"[parameters('planName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"S1\" , \"tier\" : \"Standard\" , \"capacity\" : 2 } } Configure with Bicep # To deploy App Services Plans that pass this rule: Set sku.tier to a plan equal to or greater than Standard . For example: PremiumV3 , PremiumV2 , Premium , Standard For example: resource appPlan 'Microsoft.Web/serverfarms@2021-01-15' = { name: planName location: location sku: { name: 'S1' tier: 'Standard' capacity: 2 } } Links # Choose the right resources Azure App Service plan overview Manage an App Service plan in Azure Configure PremiumV3 tier for Azure App Service App Service pricing Azure template reference","title":"Azure.AppService.MinPlan"},{"location":"en/rules/Azure.AppService.MinPlan/#use-app-service-production-sku","text":"Azure.AppService.MinPlan AZR-000072 Error Performance Efficiency \u00b7 App Service \u00b7 2020_06 Use at least a Standard App Service Plan.","title":"Use App Service production SKU"},{"location":"en/rules/Azure.AppService.MinPlan/#description","text":"Azure App Services provide a range of different plans that can be used to scale your application. Each plan provides different levels of performance and features. To get you started a number of entry level plans are available. The Free , Shared , and Basic plans can be used for limited testing and development. However these plans are not suitable for production use. Production workloads are best suited to standard and premium plans with PremiumV3 the newest plan. This rule does not apply to consumption or elastic App Services Plans used for Azure Functions.","title":"Description"},{"location":"en/rules/Azure.AppService.MinPlan/#recommendation","text":"Consider using a standard or premium plan for hosting apps on Azure App Service.","title":"Recommendation"},{"location":"en/rules/Azure.AppService.MinPlan/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppService.MinPlan/#configure-with-azure-template","text":"To deploy App Services Plans that pass this rule: Set sku.tier to a plan equal to or greater than Standard . For example: PremiumV3 , PremiumV2 , Premium , Standard For example: { \"type\" : \"Microsoft.Web/serverfarms\" , \"apiVersion\" : \"2021-01-15\" , \"name\" : \"[parameters('planName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"S1\" , \"tier\" : \"Standard\" , \"capacity\" : 2 } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppService.MinPlan/#configure-with-bicep","text":"To deploy App Services Plans that pass this rule: Set sku.tier to a plan equal to or greater than Standard . For example: PremiumV3 , PremiumV2 , Premium , Standard For example: resource appPlan 'Microsoft.Web/serverfarms@2021-01-15' = { name: planName location: location sku: { name: 'S1' tier: 'Standard' capacity: 2 } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppService.MinPlan/#links","text":"Choose the right resources Azure App Service plan overview Manage an App Service plan in Azure Configure PremiumV3 tier for Azure App Service App Service pricing Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppService.MinTLS/","tags":["Azure.AppService.MinTLS","AZR-000073"],"text":"App Service minimum TLS version # Azure.AppService.MinTLS AZR-000073 Error Security \u00b7 App Service \u00b7 2020_06 App Service should reject TLS versions older then 1.2. Description # The minimum version of TLS that Azure App Service accepts is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. App Service lets you disable outdated protocols and enforce TLS 1.2. By default, a minimum of TLS 1.2 is enforced. Recommendation # Consider configuring the minimum supported TLS version to be 1.2. Also consider using Azure Policy to audit or enforce this configuration. Examples # Configure with Azure template # To deploy App Services that pass this rule: Set properties.siteConfig.minTlsVersion to 1.2 . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] } Configure with Bicep # To deploy App Services that pass this rule: Set properties.siteConfig.minTlsVersion to 1.2 . For example: resource webApp 'Microsoft.Web/sites@2021-02-01' = { name: name location: location kind: 'web' properties: { serverFarmId: appPlan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true } } tags: tags } Links # Data encryption in Azure Enforce TLS versions Preparing for TLS 1.2 in Microsoft Azure Insecure protocols Azure Policy built-in definitions for Azure App Service Azure deployment reference","title":"Azure.AppService.MinTLS"},{"location":"en/rules/Azure.AppService.MinTLS/#app-service-minimum-tls-version","text":"Azure.AppService.MinTLS AZR-000073 Error Security \u00b7 App Service \u00b7 2020_06 App Service should reject TLS versions older then 1.2.","title":"App Service minimum TLS version"},{"location":"en/rules/Azure.AppService.MinTLS/#description","text":"The minimum version of TLS that Azure App Service accepts is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. App Service lets you disable outdated protocols and enforce TLS 1.2. By default, a minimum of TLS 1.2 is enforced.","title":"Description"},{"location":"en/rules/Azure.AppService.MinTLS/#recommendation","text":"Consider configuring the minimum supported TLS version to be 1.2. Also consider using Azure Policy to audit or enforce this configuration.","title":"Recommendation"},{"location":"en/rules/Azure.AppService.MinTLS/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppService.MinTLS/#configure-with-azure-template","text":"To deploy App Services that pass this rule: Set properties.siteConfig.minTlsVersion to 1.2 . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppService.MinTLS/#configure-with-bicep","text":"To deploy App Services that pass this rule: Set properties.siteConfig.minTlsVersion to 1.2 . For example: resource webApp 'Microsoft.Web/sites@2021-02-01' = { name: name location: location kind: 'web' properties: { serverFarmId: appPlan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppService.MinTLS/#links","text":"Data encryption in Azure Enforce TLS versions Preparing for TLS 1.2 in Microsoft Azure Insecure protocols Azure Policy built-in definitions for Azure App Service Azure deployment reference","title":"Links"},{"location":"en/rules/Azure.AppService.NETVersion/","tags":["Azure.AppService.NETVersion","AZR-000075"],"text":"Use a newer .NET version # Azure.AppService.NETVersion AZR-000075 Error Security \u00b7 App Service \u00b7 2020_12 Configure applications to use newer .NET versions. Description # Within a App Service app, the version of .NET used to run application/ site code is configurable. Older versions of .NET may not use the latest security features. Recommendation # Consider updating the site to use a newer .NET version such as v6.0 . Examples # Configure with Azure template # To deploy App Services that pass this rule: Set properties.siteConfig.netFrameworkVersion to a minimum of v4.0 . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true , \"netFrameworkVersion\" : \"v6.0\" } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] } Configure with Bicep # To deploy App Services that pass this rule: Set properties.siteConfig.netFrameworkVersion to a minimum of v4.0 . For example: resource webApp 'Microsoft.Web/sites@2021-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } kind: 'web' properties: { serverFarmId: plan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true netFrameworkVersion: 'v6.0' } } tags: tags } Links # Security design principles Set .NET Framework runtime version Azure template reference","title":"Azure.AppService.NETVersion"},{"location":"en/rules/Azure.AppService.NETVersion/#use-a-newer-net-version","text":"Azure.AppService.NETVersion AZR-000075 Error Security \u00b7 App Service \u00b7 2020_12 Configure applications to use newer .NET versions.","title":"Use a newer .NET version"},{"location":"en/rules/Azure.AppService.NETVersion/#description","text":"Within a App Service app, the version of .NET used to run application/ site code is configurable. Older versions of .NET may not use the latest security features.","title":"Description"},{"location":"en/rules/Azure.AppService.NETVersion/#recommendation","text":"Consider updating the site to use a newer .NET version such as v6.0 .","title":"Recommendation"},{"location":"en/rules/Azure.AppService.NETVersion/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppService.NETVersion/#configure-with-azure-template","text":"To deploy App Services that pass this rule: Set properties.siteConfig.netFrameworkVersion to a minimum of v4.0 . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true , \"netFrameworkVersion\" : \"v6.0\" } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppService.NETVersion/#configure-with-bicep","text":"To deploy App Services that pass this rule: Set properties.siteConfig.netFrameworkVersion to a minimum of v4.0 . For example: resource webApp 'Microsoft.Web/sites@2021-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } kind: 'web' properties: { serverFarmId: plan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true netFrameworkVersion: 'v6.0' } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppService.NETVersion/#links","text":"Security design principles Set .NET Framework runtime version Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppService.PHPVersion/","tags":["Azure.AppService.PHPVersion","AZR-000076"],"text":"Use a newer PHP runtime version # Azure.AppService.PHPVersion AZR-000076 Error Security \u00b7 App Service \u00b7 2020_12 Configure applications to use newer PHP runtime versions. Description # Within a App Service app, the version of PHP runtime used to run application/ site code is configurable. Older versions of PHP may not use the latest security features. Recommendation # Consider updating the site to use a newer PHP runtime version such as 7.4 . Examples # Configure with Azure template # To deploy App Services that pass this rule: Set properties.siteConfig.phpVersion to a minimum of 7.0 . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true , \"netFrameworkVersion\" : \"OFF\" , \"phpVersion\" : \"7.4\" } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] } Configure with Bicep # To deploy App Services that pass this rule: Set properties.siteConfig.phpVersion to a minimum of 7.0 . For example: resource webAppPHP 'Microsoft.Web/sites@2021-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } kind: 'web' properties: { serverFarmId: plan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true netFrameworkVersion: 'OFF' phpVersion: '7.4' } } tags: tags } Links # Security design principles Set PHP Version Azure template reference","title":"Azure.AppService.PHPVersion"},{"location":"en/rules/Azure.AppService.PHPVersion/#use-a-newer-php-runtime-version","text":"Azure.AppService.PHPVersion AZR-000076 Error Security \u00b7 App Service \u00b7 2020_12 Configure applications to use newer PHP runtime versions.","title":"Use a newer PHP runtime version"},{"location":"en/rules/Azure.AppService.PHPVersion/#description","text":"Within a App Service app, the version of PHP runtime used to run application/ site code is configurable. Older versions of PHP may not use the latest security features.","title":"Description"},{"location":"en/rules/Azure.AppService.PHPVersion/#recommendation","text":"Consider updating the site to use a newer PHP runtime version such as 7.4 .","title":"Recommendation"},{"location":"en/rules/Azure.AppService.PHPVersion/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppService.PHPVersion/#configure-with-azure-template","text":"To deploy App Services that pass this rule: Set properties.siteConfig.phpVersion to a minimum of 7.0 . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true , \"netFrameworkVersion\" : \"OFF\" , \"phpVersion\" : \"7.4\" } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppService.PHPVersion/#configure-with-bicep","text":"To deploy App Services that pass this rule: Set properties.siteConfig.phpVersion to a minimum of 7.0 . For example: resource webAppPHP 'Microsoft.Web/sites@2021-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } kind: 'web' properties: { serverFarmId: plan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true netFrameworkVersion: 'OFF' phpVersion: '7.4' } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppService.PHPVersion/#links","text":"Security design principles Set PHP Version Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppService.PlanInstanceCount/","tags":["Azure.AppService.PlanInstanceCount","AZR-000071"],"text":"Use two or more App Service Plan instances # Azure.AppService.PlanInstanceCount AZR-000071 Error Reliability \u00b7 App Service \u00b7 2020_06 App Service Plan should use a minimum number of instances for failover. Description # App Services Plans provides a configurable number of instances that will run apps. When a single instance is configured your app may be temporarily unavailable during unplanned interruptions. In most circumstances, Azure will self heal faulty app service instances automatically. However during this time there may interruptions to your workload. This rule does not apply to consumption or elastic App Services Plans. Recommendation # Consider using an App Service Plan with at least two (2) instances. Examples # Configure with Azure template # To deploy App Services Plans that pass this rule: Set sku.capacity to 2 or more. For example: { \"type\" : \"Microsoft.Web/serverfarms\" , \"apiVersion\" : \"2021-01-15\" , \"name\" : \"[parameters('planName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"S1\" , \"tier\" : \"Standard\" , \"capacity\" : 2 } } Configure with Bicep # To deploy App Services Plans that pass this rule: Set sku.capacity to 2 or more. For example: resource appPlan 'Microsoft.Web/serverfarms@2021-01-15' = { name: planName location: location sku: { name: 'S1' tier: 'Standard' capacity: 2 } } Links # Resiliency and dependencies Get started with Autoscale in Azure Azure template reference","title":"Azure.AppService.PlanInstanceCount"},{"location":"en/rules/Azure.AppService.PlanInstanceCount/#use-two-or-more-app-service-plan-instances","text":"Azure.AppService.PlanInstanceCount AZR-000071 Error Reliability \u00b7 App Service \u00b7 2020_06 App Service Plan should use a minimum number of instances for failover.","title":"Use two or more App Service Plan instances"},{"location":"en/rules/Azure.AppService.PlanInstanceCount/#description","text":"App Services Plans provides a configurable number of instances that will run apps. When a single instance is configured your app may be temporarily unavailable during unplanned interruptions. In most circumstances, Azure will self heal faulty app service instances automatically. However during this time there may interruptions to your workload. This rule does not apply to consumption or elastic App Services Plans.","title":"Description"},{"location":"en/rules/Azure.AppService.PlanInstanceCount/#recommendation","text":"Consider using an App Service Plan with at least two (2) instances.","title":"Recommendation"},{"location":"en/rules/Azure.AppService.PlanInstanceCount/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppService.PlanInstanceCount/#configure-with-azure-template","text":"To deploy App Services Plans that pass this rule: Set sku.capacity to 2 or more. For example: { \"type\" : \"Microsoft.Web/serverfarms\" , \"apiVersion\" : \"2021-01-15\" , \"name\" : \"[parameters('planName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"S1\" , \"tier\" : \"Standard\" , \"capacity\" : 2 } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppService.PlanInstanceCount/#configure-with-bicep","text":"To deploy App Services Plans that pass this rule: Set sku.capacity to 2 or more. For example: resource appPlan 'Microsoft.Web/serverfarms@2021-01-15' = { name: planName location: location sku: { name: 'S1' tier: 'Standard' capacity: 2 } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppService.PlanInstanceCount/#links","text":"Resiliency and dependencies Get started with Autoscale in Azure Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppService.RemoteDebug/","tags":["Azure.AppService.RemoteDebug","AZR-000074"],"text":"Disable App Service remote debugging # Azure.AppService.RemoteDebug AZR-000074 Error Security \u00b7 App Service \u00b7 2020_12 Disable remote debugging on App Service apps when not in use. Description # Remote debugging can be enabled on apps running within Azure App Services. To enable remote debugging, App Service allows connectivity to additional ports. While access to remote debugging ports is authenticated, the attack service for an app is increased. Recommendation # Consider disabling remote debugging when not in use. Examples # Configure with Azure template # To deploy App Services that pass this rule: Set properties.siteConfig.remoteDebuggingEnabled to false . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] } Configure with Bicep # To deploy App Services that pass this rule: Set properties.siteConfig.remoteDebuggingEnabled to false . For example: resource webApp 'Microsoft.Web/sites@2021-02-01' = { name: name location: location kind: 'web' properties: { serverFarmId: appPlan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true } } tags: tags } Links # Configure general settings Azure template reference","title":"Azure.AppService.RemoteDebug"},{"location":"en/rules/Azure.AppService.RemoteDebug/#disable-app-service-remote-debugging","text":"Azure.AppService.RemoteDebug AZR-000074 Error Security \u00b7 App Service \u00b7 2020_12 Disable remote debugging on App Service apps when not in use.","title":"Disable App Service remote debugging"},{"location":"en/rules/Azure.AppService.RemoteDebug/#description","text":"Remote debugging can be enabled on apps running within Azure App Services. To enable remote debugging, App Service allows connectivity to additional ports. While access to remote debugging ports is authenticated, the attack service for an app is increased.","title":"Description"},{"location":"en/rules/Azure.AppService.RemoteDebug/#recommendation","text":"Consider disabling remote debugging when not in use.","title":"Recommendation"},{"location":"en/rules/Azure.AppService.RemoteDebug/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppService.RemoteDebug/#configure-with-azure-template","text":"To deploy App Services that pass this rule: Set properties.siteConfig.remoteDebuggingEnabled to false . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppService.RemoteDebug/#configure-with-bicep","text":"To deploy App Services that pass this rule: Set properties.siteConfig.remoteDebuggingEnabled to false . For example: resource webApp 'Microsoft.Web/sites@2021-02-01' = { name: name location: location kind: 'web' properties: { serverFarmId: appPlan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppService.RemoteDebug/#links","text":"Configure general settings Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppService.UseHTTPS/","tags":["Azure.AppService.UseHTTPS","AZR-000084"],"text":"Enforce encrypted App Service connections # Azure.AppService.UseHTTPS AZR-000084 Error Security \u00b7 App Service \u00b7 2020_06 Azure App Service apps should only accept encrypted connections. Description # Azure App Service apps are configured by default to accept encrypted and unencrypted connections. HTTP connections can be automatically redirected to use HTTPS when the HTTPS Only setting is enabled. Unencrypted communication to App Service apps could allow disclosure of information to an untrusted party. Recommendation # When access using unencrypted HTTP connection is not required consider enabling HTTPS Only . Also consider using Azure Policy to audit or enforce this configuration. Examples # Configure with Azure template # To deploy App Services that pass this rule: Set properties.httpsOnly to true . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] } Configure with Bicep # To deploy App Services that pass this rule: Set properties.httpsOnly to true . For example: resource webApp 'Microsoft.Web/sites@2021-02-01' = { name: name location: location kind: 'web' properties: { serverFarmId: appPlan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true } } tags: tags } Links # Data encryption in Azure Enforce HTTPS Azure Policy built-in definitions for Azure App Service Azure template reference","title":"Azure.AppService.UseHTTPS"},{"location":"en/rules/Azure.AppService.UseHTTPS/#enforce-encrypted-app-service-connections","text":"Azure.AppService.UseHTTPS AZR-000084 Error Security \u00b7 App Service \u00b7 2020_06 Azure App Service apps should only accept encrypted connections.","title":"Enforce encrypted App Service connections"},{"location":"en/rules/Azure.AppService.UseHTTPS/#description","text":"Azure App Service apps are configured by default to accept encrypted and unencrypted connections. HTTP connections can be automatically redirected to use HTTPS when the HTTPS Only setting is enabled. Unencrypted communication to App Service apps could allow disclosure of information to an untrusted party.","title":"Description"},{"location":"en/rules/Azure.AppService.UseHTTPS/#recommendation","text":"When access using unencrypted HTTP connection is not required consider enabling HTTPS Only . Also consider using Azure Policy to audit or enforce this configuration.","title":"Recommendation"},{"location":"en/rules/Azure.AppService.UseHTTPS/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppService.UseHTTPS/#configure-with-azure-template","text":"To deploy App Services that pass this rule: Set properties.httpsOnly to true . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppService.UseHTTPS/#configure-with-bicep","text":"To deploy App Services that pass this rule: Set properties.httpsOnly to true . For example: resource webApp 'Microsoft.Web/sites@2021-02-01' = { name: name location: location kind: 'web' properties: { serverFarmId: appPlan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppService.UseHTTPS/#links","text":"Data encryption in Azure Enforce HTTPS Azure Policy built-in definitions for Azure App Service Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppService.WebProbe/","tags":["Azure.AppService.WebProbe","AZR-000079"],"text":"Web apps use health probes # Azure.AppService.WebProbe AZR-000079 Error Reliability \u00b7 App Service \u00b7 2022_06 Configure and enable instance health probes. Description # Azure App Service monitors a specific path for each web app instance to determine health status. The monitored path should implement functional checks to determine if the app is performing correctly. The checks should include dependencies including those that may not be regularly called. Regular checks of the monitored path allow Azure App Service to route traffic based on availability. Recommendation # Consider configuring a health probe to monitor instance availability. Examples # Configure with Azure template # To deploy Web Apps that pass this rule: Set properties.siteConfig.healthCheckPath to a valid application path such as /healthz . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true , \"netFrameworkVersion\" : \"v6.0\" , \"healthCheckPath\" : \"/healthz\" } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] } Configure with Bicep # To deploy Web Apps that pass this rule: Set properties.siteConfig.healthCheckPath to a valid application path such as /healthz . For example: resource webApp 'Microsoft.Web/sites@2021-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } kind: 'web' properties: { serverFarmId: plan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true netFrameworkVersion: 'v6.0' healthCheckPath: '/healthz' } } tags: tags } Links # Creating good health probes Route traffic to healthy instances (App Service) Health Check is now Generally Available Azure template reference","title":"Azure.AppService.WebProbe"},{"location":"en/rules/Azure.AppService.WebProbe/#web-apps-use-health-probes","text":"Azure.AppService.WebProbe AZR-000079 Error Reliability \u00b7 App Service \u00b7 2022_06 Configure and enable instance health probes.","title":"Web apps use health probes"},{"location":"en/rules/Azure.AppService.WebProbe/#description","text":"Azure App Service monitors a specific path for each web app instance to determine health status. The monitored path should implement functional checks to determine if the app is performing correctly. The checks should include dependencies including those that may not be regularly called. Regular checks of the monitored path allow Azure App Service to route traffic based on availability.","title":"Description"},{"location":"en/rules/Azure.AppService.WebProbe/#recommendation","text":"Consider configuring a health probe to monitor instance availability.","title":"Recommendation"},{"location":"en/rules/Azure.AppService.WebProbe/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppService.WebProbe/#configure-with-azure-template","text":"To deploy Web Apps that pass this rule: Set properties.siteConfig.healthCheckPath to a valid application path such as /healthz . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true , \"netFrameworkVersion\" : \"v6.0\" , \"healthCheckPath\" : \"/healthz\" } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppService.WebProbe/#configure-with-bicep","text":"To deploy Web Apps that pass this rule: Set properties.siteConfig.healthCheckPath to a valid application path such as /healthz . For example: resource webApp 'Microsoft.Web/sites@2021-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } kind: 'web' properties: { serverFarmId: plan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true netFrameworkVersion: 'v6.0' healthCheckPath: '/healthz' } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppService.WebProbe/#links","text":"Creating good health probes Route traffic to healthy instances (App Service) Health Check is now Generally Available Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppService.WebProbePath/","tags":["Azure.AppService.WebProbePath","AZR-000080"],"text":"Web apps use a dedicated health probe path # Azure.AppService.WebProbePath AZR-000080 Error Reliability \u00b7 App Service \u00b7 2022_06 Configure a dedicated path for health probe requests. Description # Azure App Service monitors a specific path for each web app instance to determine health status. The monitored path should implement functional checks to determine if the app is performing correctly. The checks should include dependencies including those that may not be regularly called. Regular checks of the monitored path allow Azure App Service to route traffic based on availability. Recommendation # Consider using a dedicated health probe endpoint that implements functional checks. Examples # Configure with Azure template # To deploy Web Apps that pass this rule: Set properties.siteConfig.healthCheckPath to a dedicated application path such as /healthz . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true , \"netFrameworkVersion\" : \"v6.0\" , \"healthCheckPath\" : \"/healthz\" } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] } Configure with Bicep # To deploy Web Apps that pass this rule: Set properties.siteConfig.healthCheckPath to a dedicated application path such as /healthz . For example: resource webApp 'Microsoft.Web/sites@2021-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } kind: 'web' properties: { serverFarmId: plan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true netFrameworkVersion: 'v6.0' healthCheckPath: '/healthz' } } tags: tags } Links # Creating good health probes Health check path Health Check is now Generally Available Azure template reference","title":"Azure.AppService.WebProbePath"},{"location":"en/rules/Azure.AppService.WebProbePath/#web-apps-use-a-dedicated-health-probe-path","text":"Azure.AppService.WebProbePath AZR-000080 Error Reliability \u00b7 App Service \u00b7 2022_06 Configure a dedicated path for health probe requests.","title":"Web apps use a dedicated health probe path"},{"location":"en/rules/Azure.AppService.WebProbePath/#description","text":"Azure App Service monitors a specific path for each web app instance to determine health status. The monitored path should implement functional checks to determine if the app is performing correctly. The checks should include dependencies including those that may not be regularly called. Regular checks of the monitored path allow Azure App Service to route traffic based on availability.","title":"Description"},{"location":"en/rules/Azure.AppService.WebProbePath/#recommendation","text":"Consider using a dedicated health probe endpoint that implements functional checks.","title":"Recommendation"},{"location":"en/rules/Azure.AppService.WebProbePath/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppService.WebProbePath/#configure-with-azure-template","text":"To deploy Web Apps that pass this rule: Set properties.siteConfig.healthCheckPath to a dedicated application path such as /healthz . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true , \"netFrameworkVersion\" : \"v6.0\" , \"healthCheckPath\" : \"/healthz\" } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppService.WebProbePath/#configure-with-bicep","text":"To deploy Web Apps that pass this rule: Set properties.siteConfig.healthCheckPath to a dedicated application path such as /healthz . For example: resource webApp 'Microsoft.Web/sites@2021-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } kind: 'web' properties: { serverFarmId: plan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true netFrameworkVersion: 'v6.0' healthCheckPath: '/healthz' } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppService.WebProbePath/#links","text":"Creating good health probes Health check path Health Check is now Generally Available Azure template reference","title":"Links"},{"location":"en/rules/Azure.AppService.WebSecureFtp/","tags":["Azure.AppService.WebSecureFtp","AZR-000081"],"text":"Web apps disable insecure FTP # Azure.AppService.WebSecureFtp AZR-000081 Error Security \u00b7 App Service \u00b7 2022_06 Web apps should disable insecure FTP and configure SFTP when required. Description # Azure App Service supports configuration of FTP and SFTP for uploading site content. By default, both FTP and SFTP are enabled. In many circumstances, use of FTP or SFTP is not required for automated deployments. When interactive deployments are required consider using SFTP instead of FTP. Use of FTP alone is not sufficient to prevent disclosure of sensitive information that may be transferred. Recommendation # Consider disabling insecure FTP and configure SFTP only when required. Also consider using Azure Policy to audit or enforce this configuration. Examples # Configure with Azure template # To deploy Web Apps that pass this rule: Set properties.siteConfig.ftpsState to FtpsOnly or Disabled . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true , \"netFrameworkVersion\" : \"v6.0\" , \"healthCheckPath\" : \"/healthz\" } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] } Configure with Bicep # To deploy Web Apps that pass this rule: Set properties.siteConfig.ftpsState to FtpsOnly or Disabled . For example: resource webApp 'Microsoft.Web/sites@2021-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } kind: 'web' properties: { serverFarmId: plan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true netFrameworkVersion: 'v6.0' healthCheckPath: '/healthz' } } tags: tags } Links # Data encryption in Azure Deploy your app to Azure App Service using FTP/S Azure template reference","title":"Azure.AppService.WebSecureFtp"},{"location":"en/rules/Azure.AppService.WebSecureFtp/#web-apps-disable-insecure-ftp","text":"Azure.AppService.WebSecureFtp AZR-000081 Error Security \u00b7 App Service \u00b7 2022_06 Web apps should disable insecure FTP and configure SFTP when required.","title":"Web apps disable insecure FTP"},{"location":"en/rules/Azure.AppService.WebSecureFtp/#description","text":"Azure App Service supports configuration of FTP and SFTP for uploading site content. By default, both FTP and SFTP are enabled. In many circumstances, use of FTP or SFTP is not required for automated deployments. When interactive deployments are required consider using SFTP instead of FTP. Use of FTP alone is not sufficient to prevent disclosure of sensitive information that may be transferred.","title":"Description"},{"location":"en/rules/Azure.AppService.WebSecureFtp/#recommendation","text":"Consider disabling insecure FTP and configure SFTP only when required. Also consider using Azure Policy to audit or enforce this configuration.","title":"Recommendation"},{"location":"en/rules/Azure.AppService.WebSecureFtp/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.AppService.WebSecureFtp/#configure-with-azure-template","text":"To deploy Web Apps that pass this rule: Set properties.siteConfig.ftpsState to FtpsOnly or Disabled . For example: { \"type\" : \"Microsoft.Web/sites\" , \"apiVersion\" : \"2021-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"kind\" : \"web\" , \"properties\" : { \"serverFarmId\" : \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" , \"httpsOnly\" : true , \"siteConfig\" : { \"alwaysOn\" : true , \"minTlsVersion\" : \"1.2\" , \"ftpsState\" : \"FtpsOnly\" , \"remoteDebuggingEnabled\" : false , \"http20Enabled\" : true , \"netFrameworkVersion\" : \"v6.0\" , \"healthCheckPath\" : \"/healthz\" } }, \"tags\" : \"[parameters('tags')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.AppService.WebSecureFtp/#configure-with-bicep","text":"To deploy Web Apps that pass this rule: Set properties.siteConfig.ftpsState to FtpsOnly or Disabled . For example: resource webApp 'Microsoft.Web/sites@2021-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } kind: 'web' properties: { serverFarmId: plan.id httpsOnly: true siteConfig: { alwaysOn: true minTlsVersion: '1.2' ftpsState: 'FtpsOnly' remoteDebuggingEnabled: false http20Enabled: true netFrameworkVersion: 'v6.0' healthCheckPath: '/healthz' } } tags: tags }","title":"Configure with Bicep"},{"location":"en/rules/Azure.AppService.WebSecureFtp/#links","text":"Data encryption in Azure Deploy your app to Azure App Service using FTP/S Azure template reference","title":"Links"},{"location":"en/rules/Azure.Automation.AuditLogs/","tags":["Azure.Automation.AuditLogs","AZR-000088"],"text":"Audit Automation Account data access # Azure.Automation.AuditLogs AZR-000088 Error Security \u00b7 Automation Account \u00b7 2021_12 Ensure automation account audit diagnostic logs are enabled. Description # To capture access to Automation accounts, diagnostic settings must be configured. When configuring diagnostic settings, enabled one of the following: AuditEvent category. audit category group. Management operations for Automation Account is captured automatically within Azure Activity Logs. Recommendation # Consider configuring diagnostic settings to log access for Automation Account data. Examples # Configure with Azure template # To deploy Automation accounts that pass this rule: Deploy a diagnostic settings sub-resource. Enable AuditEvent category or audit category group. For example: { \"parameters\" : { \"automationAccountName\" : { \"defaultValue\" : \"automation-account1\" , \"type\" : \"String\" }, \"location\" : { \"type\" : \"String\" }, \"workspaceId\" : { \"type\" : \"String\" } }, \"variables\" : {}, \"resources\" : [ { \"type\" : \"Microsoft.Automation/automationAccounts\" , \"apiVersion\" : \"2021-06-22\" , \"name\" : \"[parameters('automationAccountName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : false , \"sku\" : { \"name\" : \"Basic\" }, \"encryption\" : { \"keySource\" : \"Microsoft.Automation\" , \"identity\" : {} } } }, { \"comments\" : \"Enable monitoring of Automation Account operations.\" , \"type\" : \"Microsoft.Insights/diagnosticSettings\" , \"name\" : \"[concat(parameters('automationAccountName'), '/Microsoft.Insights/service')]\" , \"apiVersion\" : \"2021-05-01-preview\" , \"dependsOn\" : [ \"[concat('Microsoft.Automation/automationAccounts/', parameters('automationAccountName'))]\" ], \"properties\" : { \"workspaceId\" : \"[parameters('workspaceId')]\" , \"logs\" : [ { \"category\" : \"AuditEvent\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } } ] } } ] } Configure with Bicep # To deploy Automation accounts that pass this rule: Deploy a diagnostic settings sub-resource. Enable AuditEvent category or audit category group. For example: param automationAccountName string = 'automation-account1' param location string param workspaceId string resource automationAccountResource 'Microsoft.Automation/automationAccounts@2021-06-22' = { name: automationAccountName location: location identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: false sku: { name: 'Basic' } encryption: { keySource: 'Microsoft.Automation' identity: {} } } } resource automationAccountName_Microsoft_Insights_service 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = { name: 'diagnosticSettings' properties: { workspaceId: workspaceId logs: [ { category: 'AuditEvent' enabled: true retentionPolicy: { days: 0 enabled: false } } ] } dependsOn: [ automationAccountResource ] } Links # Security audits Template Reference","title":"Azure.Automation.AuditLogs"},{"location":"en/rules/Azure.Automation.AuditLogs/#audit-automation-account-data-access","text":"Azure.Automation.AuditLogs AZR-000088 Error Security \u00b7 Automation Account \u00b7 2021_12 Ensure automation account audit diagnostic logs are enabled.","title":"Audit Automation Account data access"},{"location":"en/rules/Azure.Automation.AuditLogs/#description","text":"To capture access to Automation accounts, diagnostic settings must be configured. When configuring diagnostic settings, enabled one of the following: AuditEvent category. audit category group. Management operations for Automation Account is captured automatically within Azure Activity Logs.","title":"Description"},{"location":"en/rules/Azure.Automation.AuditLogs/#recommendation","text":"Consider configuring diagnostic settings to log access for Automation Account data.","title":"Recommendation"},{"location":"en/rules/Azure.Automation.AuditLogs/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Automation.AuditLogs/#configure-with-azure-template","text":"To deploy Automation accounts that pass this rule: Deploy a diagnostic settings sub-resource. Enable AuditEvent category or audit category group. For example: { \"parameters\" : { \"automationAccountName\" : { \"defaultValue\" : \"automation-account1\" , \"type\" : \"String\" }, \"location\" : { \"type\" : \"String\" }, \"workspaceId\" : { \"type\" : \"String\" } }, \"variables\" : {}, \"resources\" : [ { \"type\" : \"Microsoft.Automation/automationAccounts\" , \"apiVersion\" : \"2021-06-22\" , \"name\" : \"[parameters('automationAccountName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : false , \"sku\" : { \"name\" : \"Basic\" }, \"encryption\" : { \"keySource\" : \"Microsoft.Automation\" , \"identity\" : {} } } }, { \"comments\" : \"Enable monitoring of Automation Account operations.\" , \"type\" : \"Microsoft.Insights/diagnosticSettings\" , \"name\" : \"[concat(parameters('automationAccountName'), '/Microsoft.Insights/service')]\" , \"apiVersion\" : \"2021-05-01-preview\" , \"dependsOn\" : [ \"[concat('Microsoft.Automation/automationAccounts/', parameters('automationAccountName'))]\" ], \"properties\" : { \"workspaceId\" : \"[parameters('workspaceId')]\" , \"logs\" : [ { \"category\" : \"AuditEvent\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } } ] } } ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Automation.AuditLogs/#configure-with-bicep","text":"To deploy Automation accounts that pass this rule: Deploy a diagnostic settings sub-resource. Enable AuditEvent category or audit category group. For example: param automationAccountName string = 'automation-account1' param location string param workspaceId string resource automationAccountResource 'Microsoft.Automation/automationAccounts@2021-06-22' = { name: automationAccountName location: location identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: false sku: { name: 'Basic' } encryption: { keySource: 'Microsoft.Automation' identity: {} } } } resource automationAccountName_Microsoft_Insights_service 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = { name: 'diagnosticSettings' properties: { workspaceId: workspaceId logs: [ { category: 'AuditEvent' enabled: true retentionPolicy: { days: 0 enabled: false } } ] } dependsOn: [ automationAccountResource ] }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Automation.AuditLogs/#links","text":"Security audits Template Reference","title":"Links"},{"location":"en/rules/Azure.Automation.EncryptVariables/","tags":["Azure.Automation.EncryptVariables","AZR-000086"],"text":"Encrypt automation variables # Azure.Automation.EncryptVariables AZR-000086 Error Security \u00b7 Automation Account \u00b7 2020_06 Azure Automation variables should be encrypted. Description # Azure Automation allows configuration properties to be saved as variables. Variables are a key/ value pairs, which may contain sensitive information. When variables are encrypted they can only be access from within the runbook context. Variables not encrypted are visible to anyone with read permissions. Recommendation # Consider encrypting all automation account variables. Additionally consider, using Key Vault to store secrets. Key Vault improves security by tightly controlling access to secrets and improving management controls. Links # Variable assets in Azure Automation","title":"Azure.Automation.EncryptVariables"},{"location":"en/rules/Azure.Automation.EncryptVariables/#encrypt-automation-variables","text":"Azure.Automation.EncryptVariables AZR-000086 Error Security \u00b7 Automation Account \u00b7 2020_06 Azure Automation variables should be encrypted.","title":"Encrypt automation variables"},{"location":"en/rules/Azure.Automation.EncryptVariables/#description","text":"Azure Automation allows configuration properties to be saved as variables. Variables are a key/ value pairs, which may contain sensitive information. When variables are encrypted they can only be access from within the runbook context. Variables not encrypted are visible to anyone with read permissions.","title":"Description"},{"location":"en/rules/Azure.Automation.EncryptVariables/#recommendation","text":"Consider encrypting all automation account variables. Additionally consider, using Key Vault to store secrets. Key Vault improves security by tightly controlling access to secrets and improving management controls.","title":"Recommendation"},{"location":"en/rules/Azure.Automation.EncryptVariables/#links","text":"Variable assets in Azure Automation","title":"Links"},{"location":"en/rules/Azure.Automation.ManagedIdentity/","tags":["Azure.Automation.ManagedIdentity","AZR-000090"],"text":"Use managed identity for authentication # Azure.Automation.ManagedIdentity AZR-000090 Error Security \u00b7 Automation Account \u00b7 2021_12 Ensure Managed Identity is used for authentication. Description # Azure automation can use Managed Identities to authenticate to Azure resources without storing credentials. Using managed identities have the following benefits: Using a managed identity instead of the Automation Run As account simplifies management. You don't have to renew the certificate used by a Run As account. Managed Identities can be used without any additional cost. You don't have to specify the Run As connection object in your runbook code. You can access resources using your Automation Account's Managed Identity from a runbook. Recommendation # Consider configure a managed identity for each Automation Account. Examples # Configure with Azure template # To deploy Automation Accounts that pass this rule: Set identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: { \"type\" : \"Microsoft.Automation/automationAccounts\" , \"apiVersion\" : \"2021-06-22\" , \"name\" : \"[parameters('automation_account_name')]\" , \"location\" : \"australiaeast\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : false , \"sku\" : { \"name\" : \"Basic\" }, \"encryption\" : { \"keySource\" : \"Microsoft.Automation\" , \"identity\" : {} } } } Configure with Bicep # To deploy Automation Accounts that pass this rule: Set identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: resource automation_account_name_resource 'Microsoft.Automation/automationAccounts@2021-06-22' = { name: automation_account_name location: 'australiaeast' identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: false sku: { name: 'Basic' } encryption: { keySource: 'Microsoft.Automation' identity: {} } } } Links # Use identity-based authentication Managed identities Using a system-assigned managed identity for an Azure Automation account Using a user-assigned managed identity for an Azure Automation account Azure template reference","title":"Azure.Automation.ManagedIdentity"},{"location":"en/rules/Azure.Automation.ManagedIdentity/#use-managed-identity-for-authentication","text":"Azure.Automation.ManagedIdentity AZR-000090 Error Security \u00b7 Automation Account \u00b7 2021_12 Ensure Managed Identity is used for authentication.","title":"Use managed identity for authentication"},{"location":"en/rules/Azure.Automation.ManagedIdentity/#description","text":"Azure automation can use Managed Identities to authenticate to Azure resources without storing credentials. Using managed identities have the following benefits: Using a managed identity instead of the Automation Run As account simplifies management. You don't have to renew the certificate used by a Run As account. Managed Identities can be used without any additional cost. You don't have to specify the Run As connection object in your runbook code. You can access resources using your Automation Account's Managed Identity from a runbook.","title":"Description"},{"location":"en/rules/Azure.Automation.ManagedIdentity/#recommendation","text":"Consider configure a managed identity for each Automation Account.","title":"Recommendation"},{"location":"en/rules/Azure.Automation.ManagedIdentity/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Automation.ManagedIdentity/#configure-with-azure-template","text":"To deploy Automation Accounts that pass this rule: Set identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: { \"type\" : \"Microsoft.Automation/automationAccounts\" , \"apiVersion\" : \"2021-06-22\" , \"name\" : \"[parameters('automation_account_name')]\" , \"location\" : \"australiaeast\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : false , \"sku\" : { \"name\" : \"Basic\" }, \"encryption\" : { \"keySource\" : \"Microsoft.Automation\" , \"identity\" : {} } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Automation.ManagedIdentity/#configure-with-bicep","text":"To deploy Automation Accounts that pass this rule: Set identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: resource automation_account_name_resource 'Microsoft.Automation/automationAccounts@2021-06-22' = { name: automation_account_name location: 'australiaeast' identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: false sku: { name: 'Basic' } encryption: { keySource: 'Microsoft.Automation' identity: {} } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Automation.ManagedIdentity/#links","text":"Use identity-based authentication Managed identities Using a system-assigned managed identity for an Azure Automation account Using a user-assigned managed identity for an Azure Automation account Azure template reference","title":"Links"},{"location":"en/rules/Azure.Automation.PlatformLogs/","tags":["Azure.Automation.PlatformLogs","AZR-000089"],"text":"Automation accounts should collect platform diagnostic logs # Azure.Automation.PlatformLogs AZR-000089 Error Operational Excellence \u00b7 Automation Account \u00b7 2021_12 Ensure automation account platform diagnostic logs are enabled. Description # To capture platform logs from Automation Accounts, the following diagnostic log categories should be enabled: JobLogs JobStreams DSCNodeStatus We can also enable all the above with the allLogs category group. To capture metric log categories, th following must be enabled as well: AllMetrics - Total Jobs, Total Update Deployment Machine Runs, Total Update Deployment Runs Recommendation # Consider configuring diagnostic settings to capture platform logs from Automation accounts. Notes # Configure AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST to enable selective log categories. By default all log categories are selected, as shown below. # YAML: The default AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option configuration : AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST : [ 'JobLogs' , 'JobStreams' , 'DscNodeStatus' , 'AllMetrics' ] Examples # Configure with Azure template # To deploy Automation accounts that pass this rule: Deploy a diagnostic settings sub-resource. Enable logging for the JobLogs , JobStreams , DSCNodeStatus and AllMetrics categories. For example: { \"parameters\" : { \"automationAccountName\" : { \"defaultValue\" : \"automation-account1\" , \"type\" : \"String\" }, \"location\" : { \"type\" : \"String\" }, \"workspaceId\" : { \"type\" : \"String\" } }, \"variables\" : {}, \"resources\" : [ { \"type\" : \"Microsoft.Automation/automationAccounts\" , \"apiVersion\" : \"2021-06-22\" , \"name\" : \"[parameters('automationAccountName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : false , \"sku\" : { \"name\" : \"Basic\" }, \"encryption\" : { \"keySource\" : \"Microsoft.Automation\" , \"identity\" : {} } } }, { \"comments\" : \"Enable monitoring of Automation Account operations.\" , \"type\" : \"Microsoft.Insights/diagnosticSettings\" , \"name\" : \"[concat(parameters('automationAccountName'), '/Microsoft.Insights/service')]\" , \"apiVersion\" : \"2021-05-01-preview\" , \"dependsOn\" : [ \"[concat('Microsoft.Automation/automationAccounts/', parameters('automationAccountName'))]\" ], \"properties\" : { \"workspaceId\" : \"[parameters('workspaceId')]\" , \"logs\" : [ { \"category\" : \"JobLogs\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } }, { \"category\" : \"JobStreams\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } }, { \"category\" : \"DSCNodeStatus\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } } ], \"metrics\" : [ { \"category\" : \"AllMetrics\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } } ] } } ] } Configure with Bicep # To deploy Automation accounts that pass this rule: Deploy a diagnostic settings sub-resource. Enable logging for the JobLogs , JobStreams , DSCNodeStatus and AllMetrics categories. For example: param automationAccountName string = 'automation-account1' param location string param workspaceId string resource automationAccountResource 'Microsoft.Automation/automationAccounts@2021-06-22' = { name: automationAccountName location: location identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: false sku: { name: 'Basic' } encryption: { keySource: 'Microsoft.Automation' identity: {} } } } resource automationAccountName_Microsoft_Insights_service 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = { name: 'diagnosticSettings' properties: { workspaceId: workspaceId logs: [ { category: 'JobLogs' enabled: true retentionPolicy: { days: 0 enabled: false } }, { category: 'JobStreams' enabled: true retentionPolicy: { days: 0 enabled: false } }, { category: 'DSCNodeStatus' enabled: true retentionPolicy: { days: 0 enabled: false } } ] metrics: [ { category: 'AllMetrics' enabled: true retentionPolicy: { days: 0 enabled: false } } ] } dependsOn: [ automationAccountResource ] } Links # Platform Monitoring Forward Azure Automation job data to Azure Monitor logs Template Reference","title":"Azure.Automation.PlatformLogs"},{"location":"en/rules/Azure.Automation.PlatformLogs/#automation-accounts-should-collect-platform-diagnostic-logs","text":"Azure.Automation.PlatformLogs AZR-000089 Error Operational Excellence \u00b7 Automation Account \u00b7 2021_12 Ensure automation account platform diagnostic logs are enabled.","title":"Automation accounts should collect platform diagnostic logs"},{"location":"en/rules/Azure.Automation.PlatformLogs/#description","text":"To capture platform logs from Automation Accounts, the following diagnostic log categories should be enabled: JobLogs JobStreams DSCNodeStatus We can also enable all the above with the allLogs category group. To capture metric log categories, th following must be enabled as well: AllMetrics - Total Jobs, Total Update Deployment Machine Runs, Total Update Deployment Runs","title":"Description"},{"location":"en/rules/Azure.Automation.PlatformLogs/#recommendation","text":"Consider configuring diagnostic settings to capture platform logs from Automation accounts.","title":"Recommendation"},{"location":"en/rules/Azure.Automation.PlatformLogs/#notes","text":"Configure AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST to enable selective log categories. By default all log categories are selected, as shown below. # YAML: The default AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option configuration : AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST : [ 'JobLogs' , 'JobStreams' , 'DscNodeStatus' , 'AllMetrics' ]","title":"Notes"},{"location":"en/rules/Azure.Automation.PlatformLogs/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Automation.PlatformLogs/#configure-with-azure-template","text":"To deploy Automation accounts that pass this rule: Deploy a diagnostic settings sub-resource. Enable logging for the JobLogs , JobStreams , DSCNodeStatus and AllMetrics categories. For example: { \"parameters\" : { \"automationAccountName\" : { \"defaultValue\" : \"automation-account1\" , \"type\" : \"String\" }, \"location\" : { \"type\" : \"String\" }, \"workspaceId\" : { \"type\" : \"String\" } }, \"variables\" : {}, \"resources\" : [ { \"type\" : \"Microsoft.Automation/automationAccounts\" , \"apiVersion\" : \"2021-06-22\" , \"name\" : \"[parameters('automationAccountName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : false , \"sku\" : { \"name\" : \"Basic\" }, \"encryption\" : { \"keySource\" : \"Microsoft.Automation\" , \"identity\" : {} } } }, { \"comments\" : \"Enable monitoring of Automation Account operations.\" , \"type\" : \"Microsoft.Insights/diagnosticSettings\" , \"name\" : \"[concat(parameters('automationAccountName'), '/Microsoft.Insights/service')]\" , \"apiVersion\" : \"2021-05-01-preview\" , \"dependsOn\" : [ \"[concat('Microsoft.Automation/automationAccounts/', parameters('automationAccountName'))]\" ], \"properties\" : { \"workspaceId\" : \"[parameters('workspaceId')]\" , \"logs\" : [ { \"category\" : \"JobLogs\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } }, { \"category\" : \"JobStreams\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } }, { \"category\" : \"DSCNodeStatus\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } } ], \"metrics\" : [ { \"category\" : \"AllMetrics\" , \"enabled\" : true , \"retentionPolicy\" : { \"days\" : 0 , \"enabled\" : false } } ] } } ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Automation.PlatformLogs/#configure-with-bicep","text":"To deploy Automation accounts that pass this rule: Deploy a diagnostic settings sub-resource. Enable logging for the JobLogs , JobStreams , DSCNodeStatus and AllMetrics categories. For example: param automationAccountName string = 'automation-account1' param location string param workspaceId string resource automationAccountResource 'Microsoft.Automation/automationAccounts@2021-06-22' = { name: automationAccountName location: location identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: false sku: { name: 'Basic' } encryption: { keySource: 'Microsoft.Automation' identity: {} } } } resource automationAccountName_Microsoft_Insights_service 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = { name: 'diagnosticSettings' properties: { workspaceId: workspaceId logs: [ { category: 'JobLogs' enabled: true retentionPolicy: { days: 0 enabled: false } }, { category: 'JobStreams' enabled: true retentionPolicy: { days: 0 enabled: false } }, { category: 'DSCNodeStatus' enabled: true retentionPolicy: { days: 0 enabled: false } } ] metrics: [ { category: 'AllMetrics' enabled: true retentionPolicy: { days: 0 enabled: false } } ] } dependsOn: [ automationAccountResource ] }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Automation.PlatformLogs/#links","text":"Platform Monitoring Forward Azure Automation job data to Azure Monitor logs Template Reference","title":"Links"},{"location":"en/rules/Azure.Automation.WebHookExpiry/","tags":["Azure.Automation.WebHookExpiry","AZR-000087"],"text":"Use short lived web hooks # Azure.Automation.WebHookExpiry AZR-000087 Error Security \u00b7 Automation Account \u00b7 2020_06 Do not create webhooks with an expiry time greater than 1 year (default). Description # Do not create webhooks with an expiry time greater than 1 year (default). Recommendation # An expiry time of 1 year is the default for webhook creation. Webhooks should be programmatically rotated at regular intervals - Microsoft recommends setting a shorter time than the default of 1 year. If authentication is required for a webhook consider implementing a pre-shared key in the header - or using an Azure Function.","title":"Azure.Automation.WebHookExpiry"},{"location":"en/rules/Azure.Automation.WebHookExpiry/#use-short-lived-web-hooks","text":"Azure.Automation.WebHookExpiry AZR-000087 Error Security \u00b7 Automation Account \u00b7 2020_06 Do not create webhooks with an expiry time greater than 1 year (default).","title":"Use short lived web hooks"},{"location":"en/rules/Azure.Automation.WebHookExpiry/#description","text":"Do not create webhooks with an expiry time greater than 1 year (default).","title":"Description"},{"location":"en/rules/Azure.Automation.WebHookExpiry/#recommendation","text":"An expiry time of 1 year is the default for webhook creation. Webhooks should be programmatically rotated at regular intervals - Microsoft recommends setting a shorter time than the default of 1 year. If authentication is required for a webhook consider implementing a pre-shared key in the header - or using an Azure Function.","title":"Recommendation"},{"location":"en/rules/Azure.CDN.EndpointName/","tags":["Azure.CDN.EndpointName","AZR-000091"],"text":"Use valid CDN endpoint names # Azure.CDN.EndpointName AZR-000091 Error Operational Excellence \u00b7 Content Delivery Network \u00b7 2020_09 Azure CDN Endpoint names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for CDN endpoint names are: Between 1 and 50 characters long. Alphanumerics and hyphens. Start and end with a letter or number. CDN endpoint names must be globally unique. Recommendation # Consider using names that meet CDN endpoint naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if CDN endpoint names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference","title":"Azure.CDN.EndpointName"},{"location":"en/rules/Azure.CDN.EndpointName/#use-valid-cdn-endpoint-names","text":"Azure.CDN.EndpointName AZR-000091 Error Operational Excellence \u00b7 Content Delivery Network \u00b7 2020_09 Azure CDN Endpoint names should meet naming requirements.","title":"Use valid CDN endpoint names"},{"location":"en/rules/Azure.CDN.EndpointName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for CDN endpoint names are: Between 1 and 50 characters long. Alphanumerics and hyphens. Start and end with a letter or number. CDN endpoint names must be globally unique.","title":"Description"},{"location":"en/rules/Azure.CDN.EndpointName/#recommendation","text":"Consider using names that meet CDN endpoint naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.CDN.EndpointName/#notes","text":"This rule does not check if CDN endpoint names are unique.","title":"Notes"},{"location":"en/rules/Azure.CDN.EndpointName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference","title":"Links"},{"location":"en/rules/Azure.CDN.HTTP/","tags":["Azure.CDN.HTTP","AZR-000093"],"text":"Use HTTPS client connections # Azure.CDN.HTTP AZR-000093 Error Security \u00b7 Content Delivery Network \u00b7 2020_06 Enforce HTTPS for client connections. Description # When a client connect to CDN content it can use HTTP or HTTPS. Support for both HTTP and HTTPS is enabled by default. When using HTTP, sensitive information may be exposed to an untrusted party. Recommendation # Consider disabling HTTP support on the CDN endpoint origin. Links # Data encryption in Azure Configure HTTPS on an Azure CDN custom domain","title":"Azure.CDN.HTTP"},{"location":"en/rules/Azure.CDN.HTTP/#use-https-client-connections","text":"Azure.CDN.HTTP AZR-000093 Error Security \u00b7 Content Delivery Network \u00b7 2020_06 Enforce HTTPS for client connections.","title":"Use HTTPS client connections"},{"location":"en/rules/Azure.CDN.HTTP/#description","text":"When a client connect to CDN content it can use HTTP or HTTPS. Support for both HTTP and HTTPS is enabled by default. When using HTTP, sensitive information may be exposed to an untrusted party.","title":"Description"},{"location":"en/rules/Azure.CDN.HTTP/#recommendation","text":"Consider disabling HTTP support on the CDN endpoint origin.","title":"Recommendation"},{"location":"en/rules/Azure.CDN.HTTP/#links","text":"Data encryption in Azure Configure HTTPS on an Azure CDN custom domain","title":"Links"},{"location":"en/rules/Azure.CDN.MinTLS/","tags":["Azure.CDN.MinTLS","AZR-000092"],"text":"Azure CDN endpoint minimum TLS version # Azure.CDN.MinTLS AZR-000092 Error Security \u00b7 Content Delivery Network \u00b7 2020_09 Azure CDN endpoints should reject TLS versions older than 1.2. Description # The minimum version of TLS that Azure CDN endpoints accept is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted. To configure the minimum TLS version, a custom domain must be configured. Recommendation # Consider configuring a custom domain and setting the minimum supported TLS version to be 1.2. Links # Data encryption in Azure Preparing for TLS 1.2 in Microsoft Azure REST API Custom Domains - Enable Custom Https Azure deployment reference","title":"Azure.CDN.MinTLS"},{"location":"en/rules/Azure.CDN.MinTLS/#azure-cdn-endpoint-minimum-tls-version","text":"Azure.CDN.MinTLS AZR-000092 Error Security \u00b7 Content Delivery Network \u00b7 2020_09 Azure CDN endpoints should reject TLS versions older than 1.2.","title":"Azure CDN endpoint minimum TLS version"},{"location":"en/rules/Azure.CDN.MinTLS/#description","text":"The minimum version of TLS that Azure CDN endpoints accept is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted. To configure the minimum TLS version, a custom domain must be configured.","title":"Description"},{"location":"en/rules/Azure.CDN.MinTLS/#recommendation","text":"Consider configuring a custom domain and setting the minimum supported TLS version to be 1.2.","title":"Recommendation"},{"location":"en/rules/Azure.CDN.MinTLS/#links","text":"Data encryption in Azure Preparing for TLS 1.2 in Microsoft Azure REST API Custom Domains - Enable Custom Https Azure deployment reference","title":"Links"},{"location":"en/rules/Azure.CDN.UseFrontDoor/","tags":["Azure.CDN.UseFrontDoor","AZR-000286"],"text":"Use Front Door Standard Or Premium SKU # Azure.CDN.UseFrontDoor AZR-000286 Error Performance Efficiency \u00b7 Front Door \u00b7 2022_09 Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Description # Using a CDN is a good way to minimize the load on your application, and maximize availability and performance. Standard content delivery network (CDN) capability includes the ability to cache files closer to end users to speed up delivery of static files. However, with dynamic web applications, caching that content in edge locations isn't possible because the server generates the content in response to user behavior. Speeding up the delivery of such content is more complex than traditional edge caching and requires an end-to-end solution that finely tunes each element along the entire data path from inception to delivery. With Azure CDN dynamic site acceleration (DSA) optimization, the performance of web pages with dynamic content is measurably improved. Azure Front Door Standard or Premium SKU offers modern cloud Content Delivery Network (CDN). These SKUs in particular provides fast, reliable, and secure access between users and dynamic web content across the globe. Recommendation # Consider using Front Door Standard or Premium SKU to improve performance. Examples # Configure with Azure template # To deploy an front door profile that pass this rule: Set sku.name to Standard_AzureFrontDoor or Premium_AzureFrontDoor . For example: { \"type\" : \"Microsoft.Cdn/profiles\" , \"apiVersion\" : \"2022-05-01-preview\" , \"name\" : \"myFrontDoor\" , \"location\" : \"global\" , \"sku\" : { \"name\" : \"Standard_AzureFrontDoor\" } } Configure with Bicep # To deploy an front door profile that pass this rule: Set sku.name to Standard_AzureFrontDoor or Premium_AzureFrontDoor . For example: resource frontDoorProfile 'Microsoft.Cdn/profiles@2021-06-01' = { name: 'myFrontDoor' location: 'global' sku: { name: 'Standard_AzureFrontDoor' } } Links # Performance efficiency checklist Azure Front Door tiers What are the comparisons between Azure CDN product features? Azure template reference","title":"Azure.CDN.UseFrontDoor"},{"location":"en/rules/Azure.CDN.UseFrontDoor/#use-front-door-standard-or-premium-sku","text":"Azure.CDN.UseFrontDoor AZR-000286 Error Performance Efficiency \u00b7 Front Door \u00b7 2022_09 Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities.","title":"Use Front Door Standard Or Premium SKU"},{"location":"en/rules/Azure.CDN.UseFrontDoor/#description","text":"Using a CDN is a good way to minimize the load on your application, and maximize availability and performance. Standard content delivery network (CDN) capability includes the ability to cache files closer to end users to speed up delivery of static files. However, with dynamic web applications, caching that content in edge locations isn't possible because the server generates the content in response to user behavior. Speeding up the delivery of such content is more complex than traditional edge caching and requires an end-to-end solution that finely tunes each element along the entire data path from inception to delivery. With Azure CDN dynamic site acceleration (DSA) optimization, the performance of web pages with dynamic content is measurably improved. Azure Front Door Standard or Premium SKU offers modern cloud Content Delivery Network (CDN). These SKUs in particular provides fast, reliable, and secure access between users and dynamic web content across the globe.","title":"Description"},{"location":"en/rules/Azure.CDN.UseFrontDoor/#recommendation","text":"Consider using Front Door Standard or Premium SKU to improve performance.","title":"Recommendation"},{"location":"en/rules/Azure.CDN.UseFrontDoor/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.CDN.UseFrontDoor/#configure-with-azure-template","text":"To deploy an front door profile that pass this rule: Set sku.name to Standard_AzureFrontDoor or Premium_AzureFrontDoor . For example: { \"type\" : \"Microsoft.Cdn/profiles\" , \"apiVersion\" : \"2022-05-01-preview\" , \"name\" : \"myFrontDoor\" , \"location\" : \"global\" , \"sku\" : { \"name\" : \"Standard_AzureFrontDoor\" } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.CDN.UseFrontDoor/#configure-with-bicep","text":"To deploy an front door profile that pass this rule: Set sku.name to Standard_AzureFrontDoor or Premium_AzureFrontDoor . For example: resource frontDoorProfile 'Microsoft.Cdn/profiles@2021-06-01' = { name: 'myFrontDoor' location: 'global' sku: { name: 'Standard_AzureFrontDoor' } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.CDN.UseFrontDoor/#links","text":"Performance efficiency checklist Azure Front Door tiers What are the comparisons between Azure CDN product features? Azure template reference","title":"Links"},{"location":"en/rules/Azure.Cognitive.DisableLocalAuth/","tags":["Azure.Cognitive.DisableLocalAuth","AZR-000282"],"text":"Use identity-based authentication for Cogitive Services accounts # Azure.Cognitive.DisableLocalAuth AZR-000282 Error Security \u00b7 Cognitive Services \u00b7 2022_09 Authenticate requests to Cognitive Services with Azure AD identities. Description # To send requests to Cognitive Services endpoints, each request must include an authentication header. Cognitive Services endpoints supports authentication with keys or tokens. Using an Azure AD token instead of a cryptographic key has some additional security benefits. With Azure AD authentication, the identity is validated against Azure AD identity provider. Using Azure AD identities centralizes identity management and auditing. Once you decide to use Azure AD authentication, you can disable authentication using keys. Recommendation # Consider only using Azure AD identities to authenticate requests to Cogitive Services accounts. Once configured, disable authentication based on access keys. Examples # Configure with Azure template # To deploy accounts that pass this rule: Set the properties.disableLocalAuth property to true . For example: { \"type\" : \"Microsoft.CognitiveServices/accounts\" , \"apiVersion\" : \"2022-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"S0\" }, \"kind\" : \"CognitiveServices\" , \"properties\" : { \"publicNetworkAccess\" : \"Disabled\" , \"networkAcls\" : { \"defaultAction\" : \"Deny\" }, \"disableLocalAuth\" : true } } Configure with Bicep # To deploy accounts that pass this rule: Set the properties.disableLocalAuth property to true . For example: resource account 'Microsoft.CognitiveServices/accounts@2022-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } sku: { name: 'S0' } kind: 'CognitiveServices' properties: { publicNetworkAccess: 'Disabled' networkAcls: { defaultAction: 'Deny' } disableLocalAuth: true } } Links # Use identity-based authentication Authenticate with Azure Active Directory Azure Policy built-in policy definitions for Azure Cognitive Services Azure template reference","title":"Azure.Cognitive.DisableLocalAuth"},{"location":"en/rules/Azure.Cognitive.DisableLocalAuth/#use-identity-based-authentication-for-cogitive-services-accounts","text":"Azure.Cognitive.DisableLocalAuth AZR-000282 Error Security \u00b7 Cognitive Services \u00b7 2022_09 Authenticate requests to Cognitive Services with Azure AD identities.","title":"Use identity-based authentication for Cogitive Services accounts"},{"location":"en/rules/Azure.Cognitive.DisableLocalAuth/#description","text":"To send requests to Cognitive Services endpoints, each request must include an authentication header. Cognitive Services endpoints supports authentication with keys or tokens. Using an Azure AD token instead of a cryptographic key has some additional security benefits. With Azure AD authentication, the identity is validated against Azure AD identity provider. Using Azure AD identities centralizes identity management and auditing. Once you decide to use Azure AD authentication, you can disable authentication using keys.","title":"Description"},{"location":"en/rules/Azure.Cognitive.DisableLocalAuth/#recommendation","text":"Consider only using Azure AD identities to authenticate requests to Cogitive Services accounts. Once configured, disable authentication based on access keys.","title":"Recommendation"},{"location":"en/rules/Azure.Cognitive.DisableLocalAuth/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Cognitive.DisableLocalAuth/#configure-with-azure-template","text":"To deploy accounts that pass this rule: Set the properties.disableLocalAuth property to true . For example: { \"type\" : \"Microsoft.CognitiveServices/accounts\" , \"apiVersion\" : \"2022-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"S0\" }, \"kind\" : \"CognitiveServices\" , \"properties\" : { \"publicNetworkAccess\" : \"Disabled\" , \"networkAcls\" : { \"defaultAction\" : \"Deny\" }, \"disableLocalAuth\" : true } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Cognitive.DisableLocalAuth/#configure-with-bicep","text":"To deploy accounts that pass this rule: Set the properties.disableLocalAuth property to true . For example: resource account 'Microsoft.CognitiveServices/accounts@2022-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } sku: { name: 'S0' } kind: 'CognitiveServices' properties: { publicNetworkAccess: 'Disabled' networkAcls: { defaultAction: 'Deny' } disableLocalAuth: true } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Cognitive.DisableLocalAuth/#links","text":"Use identity-based authentication Authenticate with Azure Active Directory Azure Policy built-in policy definitions for Azure Cognitive Services Azure template reference","title":"Links"},{"location":"en/rules/Azure.Cognitive.ManagedIdentity/","tags":["Azure.Cognitive.ManagedIdentity","AZR-000281"],"text":"Use Managed Identity for Cogitive Services accounts # Azure.Cognitive.ManagedIdentity AZR-000281 Error Security \u00b7 Cognitive Services \u00b7 2022_09 Configure managed identities to access Azure resources. Description # Cognitive Services must authenticate to Azure resources such storage accounts. To authenticate to Azure resources, Cognitive Services can use managed identities. Using Azure managed identities have the following benefits: You don't need to store or manage credentials. Azure automatically generates tokens and performs rotation. You can use managed identities to authenticate to any Azure service that supports Azure AD authentication. Managed identities can be used without any additional cost. Recommendation # Consider configuring a managed identity for each Cogitive Services account. Examples # Configure with Azure template # To deploy accounts that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: { \"type\" : \"Microsoft.CognitiveServices/accounts\" , \"apiVersion\" : \"2022-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"S0\" }, \"kind\" : \"CognitiveServices\" , \"properties\" : { \"publicNetworkAccess\" : \"Disabled\" , \"networkAcls\" : { \"defaultAction\" : \"Deny\" }, \"disableLocalAuth\" : true } } Configure with Bicep # To deploy accounts that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: resource account 'Microsoft.CognitiveServices/accounts@2022-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } sku: { name: 'S0' } kind: 'CognitiveServices' properties: { publicNetworkAccess: 'Disabled' networkAcls: { defaultAction: 'Deny' } disableLocalAuth: true } } Links # Use identity-based authentication Azure Policy built-in policy definitions for Azure Cognitive Services Azure template reference","title":"Azure.Cognitive.ManagedIdentity"},{"location":"en/rules/Azure.Cognitive.ManagedIdentity/#use-managed-identity-for-cogitive-services-accounts","text":"Azure.Cognitive.ManagedIdentity AZR-000281 Error Security \u00b7 Cognitive Services \u00b7 2022_09 Configure managed identities to access Azure resources.","title":"Use Managed Identity for Cogitive Services accounts"},{"location":"en/rules/Azure.Cognitive.ManagedIdentity/#description","text":"Cognitive Services must authenticate to Azure resources such storage accounts. To authenticate to Azure resources, Cognitive Services can use managed identities. Using Azure managed identities have the following benefits: You don't need to store or manage credentials. Azure automatically generates tokens and performs rotation. You can use managed identities to authenticate to any Azure service that supports Azure AD authentication. Managed identities can be used without any additional cost.","title":"Description"},{"location":"en/rules/Azure.Cognitive.ManagedIdentity/#recommendation","text":"Consider configuring a managed identity for each Cogitive Services account.","title":"Recommendation"},{"location":"en/rules/Azure.Cognitive.ManagedIdentity/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Cognitive.ManagedIdentity/#configure-with-azure-template","text":"To deploy accounts that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: { \"type\" : \"Microsoft.CognitiveServices/accounts\" , \"apiVersion\" : \"2022-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"S0\" }, \"kind\" : \"CognitiveServices\" , \"properties\" : { \"publicNetworkAccess\" : \"Disabled\" , \"networkAcls\" : { \"defaultAction\" : \"Deny\" }, \"disableLocalAuth\" : true } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Cognitive.ManagedIdentity/#configure-with-bicep","text":"To deploy accounts that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: resource account 'Microsoft.CognitiveServices/accounts@2022-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } sku: { name: 'S0' } kind: 'CognitiveServices' properties: { publicNetworkAccess: 'Disabled' networkAcls: { defaultAction: 'Deny' } disableLocalAuth: true } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Cognitive.ManagedIdentity/#links","text":"Use identity-based authentication Azure Policy built-in policy definitions for Azure Cognitive Services Azure template reference","title":"Links"},{"location":"en/rules/Azure.Cognitive.PrivateEndpoints/","tags":["Azure.Cognitive.PrivateEndpoints","AZR-000283"],"text":"Use Cognitive Service Private Endpoints # Azure.Cognitive.PrivateEndpoints AZR-000283 Error Security \u00b7 Cognitive Services \u00b7 2022_09 Use Private Endpoints to access Cognitive Services accounts. Description # By default, a public endpoint is enabled for Cognitive Services accounts. The public endpoint is used for all access except for requests that use a Private Endpoint. Access through the public endpoint can be disabled or restricted to authorized virtual networks. Data exfiltration is an attack where an malicious actor does an unauthorized data transfer. Private Endpoints help prevent data exfiltration by an internal or external malicious actor. They do this by providing clear separation between public and private endpoints. As a result, broad access to public endpoints which could be operated by a malicious actor are not required. Recommendation # Consider accessing Cognitive Services accounts by Private Endpoints and disabling public endpoints. Examples # Configure with Azure template # To deploy accounts that pass this rule: Set the properties.publicNetworkAccess property to Disabled . For example: { \"type\" : \"Microsoft.CognitiveServices/accounts\" , \"apiVersion\" : \"2022-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"S0\" }, \"kind\" : \"CognitiveServices\" , \"properties\" : { \"publicNetworkAccess\" : \"Disabled\" , \"networkAcls\" : { \"defaultAction\" : \"Deny\" }, \"disableLocalAuth\" : true } } Configure with Bicep # To deploy accounts that pass this rule: Set the properties.publicNetworkAccess property to Disabled . For example: resource account 'Microsoft.CognitiveServices/accounts@2022-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } sku: { name: 'S0' } kind: 'CognitiveServices' properties: { publicNetworkAccess: 'Disabled' networkAcls: { defaultAction: 'Deny' } disableLocalAuth: true } } Links # Traffic flow security in Azure Configure Azure Cognitive Services virtual networks Azure Policy built-in policy definitions for Azure Cognitive Services Azure template reference","title":"Azure.Cognitive.PrivateEndpoints"},{"location":"en/rules/Azure.Cognitive.PrivateEndpoints/#use-cognitive-service-private-endpoints","text":"Azure.Cognitive.PrivateEndpoints AZR-000283 Error Security \u00b7 Cognitive Services \u00b7 2022_09 Use Private Endpoints to access Cognitive Services accounts.","title":"Use Cognitive Service Private Endpoints"},{"location":"en/rules/Azure.Cognitive.PrivateEndpoints/#description","text":"By default, a public endpoint is enabled for Cognitive Services accounts. The public endpoint is used for all access except for requests that use a Private Endpoint. Access through the public endpoint can be disabled or restricted to authorized virtual networks. Data exfiltration is an attack where an malicious actor does an unauthorized data transfer. Private Endpoints help prevent data exfiltration by an internal or external malicious actor. They do this by providing clear separation between public and private endpoints. As a result, broad access to public endpoints which could be operated by a malicious actor are not required.","title":"Description"},{"location":"en/rules/Azure.Cognitive.PrivateEndpoints/#recommendation","text":"Consider accessing Cognitive Services accounts by Private Endpoints and disabling public endpoints.","title":"Recommendation"},{"location":"en/rules/Azure.Cognitive.PrivateEndpoints/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Cognitive.PrivateEndpoints/#configure-with-azure-template","text":"To deploy accounts that pass this rule: Set the properties.publicNetworkAccess property to Disabled . For example: { \"type\" : \"Microsoft.CognitiveServices/accounts\" , \"apiVersion\" : \"2022-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"S0\" }, \"kind\" : \"CognitiveServices\" , \"properties\" : { \"publicNetworkAccess\" : \"Disabled\" , \"networkAcls\" : { \"defaultAction\" : \"Deny\" }, \"disableLocalAuth\" : true } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Cognitive.PrivateEndpoints/#configure-with-bicep","text":"To deploy accounts that pass this rule: Set the properties.publicNetworkAccess property to Disabled . For example: resource account 'Microsoft.CognitiveServices/accounts@2022-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } sku: { name: 'S0' } kind: 'CognitiveServices' properties: { publicNetworkAccess: 'Disabled' networkAcls: { defaultAction: 'Deny' } disableLocalAuth: true } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Cognitive.PrivateEndpoints/#links","text":"Traffic flow security in Azure Configure Azure Cognitive Services virtual networks Azure Policy built-in policy definitions for Azure Cognitive Services Azure template reference","title":"Links"},{"location":"en/rules/Azure.Cognitive.PublicAccess/","tags":["Azure.Cognitive.PublicAccess","AZR-000280"],"text":"Restrict Cognitive Service endpoints # Azure.Cognitive.PublicAccess AZR-000280 Error Security \u00b7 Cognitive Services \u00b7 2022_09 Restrict access of Cognitive Services accounts to authorized virtual networks. Description # By default, public network access is enabled for a Cognitive Service account. Service Endpoints and Private Link can be leveraged to restrict access to PaaS endpoints. When access is restricted, access by malicious actor is from an unauthorized virtual network is mitigated. Configure service endpoints and private links where appropriate. Recommendation # Consider configuring network access restrictions for Cognitive Services accounts. Limit access to accounts so that access is permitted from authorized virtual networks only. Examples # Configure with Azure template # To deploy accounts that pass this rule: Set the properties.networkAcls.defaultAction property to Deny , or Set the properties.publicNetworkAccess property to Disabled . For example: { \"type\" : \"Microsoft.CognitiveServices/accounts\" , \"apiVersion\" : \"2022-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"S0\" }, \"kind\" : \"CognitiveServices\" , \"properties\" : { \"publicNetworkAccess\" : \"Disabled\" , \"networkAcls\" : { \"defaultAction\" : \"Deny\" }, \"disableLocalAuth\" : true } } Configure with Bicep # To deploy accounts that pass this rule: Set the properties.networkAcls.defaultAction property to Deny , or Set the properties.publicNetworkAccess property to Disabled . For example: resource account 'Microsoft.CognitiveServices/accounts@2022-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } sku: { name: 'S0' } kind: 'CognitiveServices' properties: { publicNetworkAccess: 'Disabled' networkAcls: { defaultAction: 'Deny' } disableLocalAuth: true } } Links # Best practices for endpoint security on Azure Configure Azure Cognitive Services virtual networks Azure Policy built-in policy definitions for Azure Cognitive Services Azure template reference","title":"Azure.Cognitive.PublicAccess"},{"location":"en/rules/Azure.Cognitive.PublicAccess/#restrict-cognitive-service-endpoints","text":"Azure.Cognitive.PublicAccess AZR-000280 Error Security \u00b7 Cognitive Services \u00b7 2022_09 Restrict access of Cognitive Services accounts to authorized virtual networks.","title":"Restrict Cognitive Service endpoints"},{"location":"en/rules/Azure.Cognitive.PublicAccess/#description","text":"By default, public network access is enabled for a Cognitive Service account. Service Endpoints and Private Link can be leveraged to restrict access to PaaS endpoints. When access is restricted, access by malicious actor is from an unauthorized virtual network is mitigated. Configure service endpoints and private links where appropriate.","title":"Description"},{"location":"en/rules/Azure.Cognitive.PublicAccess/#recommendation","text":"Consider configuring network access restrictions for Cognitive Services accounts. Limit access to accounts so that access is permitted from authorized virtual networks only.","title":"Recommendation"},{"location":"en/rules/Azure.Cognitive.PublicAccess/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Cognitive.PublicAccess/#configure-with-azure-template","text":"To deploy accounts that pass this rule: Set the properties.networkAcls.defaultAction property to Deny , or Set the properties.publicNetworkAccess property to Disabled . For example: { \"type\" : \"Microsoft.CognitiveServices/accounts\" , \"apiVersion\" : \"2022-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"S0\" }, \"kind\" : \"CognitiveServices\" , \"properties\" : { \"publicNetworkAccess\" : \"Disabled\" , \"networkAcls\" : { \"defaultAction\" : \"Deny\" }, \"disableLocalAuth\" : true } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Cognitive.PublicAccess/#configure-with-bicep","text":"To deploy accounts that pass this rule: Set the properties.networkAcls.defaultAction property to Deny , or Set the properties.publicNetworkAccess property to Disabled . For example: resource account 'Microsoft.CognitiveServices/accounts@2022-03-01' = { name: name location: location identity: { type: 'SystemAssigned' } sku: { name: 'S0' } kind: 'CognitiveServices' properties: { publicNetworkAccess: 'Disabled' networkAcls: { defaultAction: 'Deny' } disableLocalAuth: true } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Cognitive.PublicAccess/#links","text":"Best practices for endpoint security on Azure Configure Azure Cognitive Services virtual networks Azure Policy built-in policy definitions for Azure Cognitive Services Azure template reference","title":"Links"},{"location":"en/rules/Azure.ContainerApp.Insecure/","tags":["Azure.ContainerApp.Insecure","AZR-000094"],"text":"Disable insecure container app ingress # Azure.ContainerApp.Insecure AZR-000094 Error Security \u00b7 Container App \u00b7 Preview \u00b7 2022_03 Ensure insecure inbound traffic is not permitted to the container app. Description # Container Apps by default will automatically redirect any HTTP requests to HTTPS. In this default configuration any inbound requests will occur over a minimum of TLS 1.2. This secure by default behaviour can be overriden by allowing insecure HTTP traffic. Unencrypted communication to Container Apps could allow disclosure of information to an untrusted party. Recommendation # Consider disabling insecure traffic and require all inbound traffic to be over TLS 1.2. Examples # Configure with Azure template # To deploy resource that pass this rule: Set properties.configuration.ingress.allowInsecure to false . For example: { \"type\" : \"Microsoft.Web/containerApps\" , \"apiVersion\" : \"2021-03-01\" , \"name\" : \"[parameters('appName')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"kubeEnvironmentId\" : \"[resourceId('Microsoft.Web/kubeEnvironments', parameters('envName'))]\" , \"template\" : { \"revisionSuffix\" : \"\" , \"containers\" : \"[variables('containers')]\" }, \"configuration\" : { \"ingress\" : { \"allowInsecure\" : false } } }, \"dependsOn\" : [ \"[resourceId('Microsoft.Web/kubeEnvironments', parameters('envName'))]\" ] } Configure with Bicep # To deploy resource that pass this rule: Set properties.configuration.ingress.allowInsecure to false . For example: resource containerApp 'Microsoft.Web/containerApps@2021-03-01' = { name: appName location: location properties: { kubeEnvironmentId: kubeEnv.id template: { revisionSuffix: '' containers: containers } configuration: { ingress: { allowInsecure: false } } } } Notes # Azure Container Apps are currently in preview. Links # Data encryption in Azure Set up HTTPS ingress in Azure Container Apps Azure template reference","title":"Azure.ContainerApp.Insecure"},{"location":"en/rules/Azure.ContainerApp.Insecure/#disable-insecure-container-app-ingress","text":"Azure.ContainerApp.Insecure AZR-000094 Error Security \u00b7 Container App \u00b7 Preview \u00b7 2022_03 Ensure insecure inbound traffic is not permitted to the container app.","title":"Disable insecure container app ingress"},{"location":"en/rules/Azure.ContainerApp.Insecure/#description","text":"Container Apps by default will automatically redirect any HTTP requests to HTTPS. In this default configuration any inbound requests will occur over a minimum of TLS 1.2. This secure by default behaviour can be overriden by allowing insecure HTTP traffic. Unencrypted communication to Container Apps could allow disclosure of information to an untrusted party.","title":"Description"},{"location":"en/rules/Azure.ContainerApp.Insecure/#recommendation","text":"Consider disabling insecure traffic and require all inbound traffic to be over TLS 1.2.","title":"Recommendation"},{"location":"en/rules/Azure.ContainerApp.Insecure/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.ContainerApp.Insecure/#configure-with-azure-template","text":"To deploy resource that pass this rule: Set properties.configuration.ingress.allowInsecure to false . For example: { \"type\" : \"Microsoft.Web/containerApps\" , \"apiVersion\" : \"2021-03-01\" , \"name\" : \"[parameters('appName')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"kubeEnvironmentId\" : \"[resourceId('Microsoft.Web/kubeEnvironments', parameters('envName'))]\" , \"template\" : { \"revisionSuffix\" : \"\" , \"containers\" : \"[variables('containers')]\" }, \"configuration\" : { \"ingress\" : { \"allowInsecure\" : false } } }, \"dependsOn\" : [ \"[resourceId('Microsoft.Web/kubeEnvironments', parameters('envName'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.ContainerApp.Insecure/#configure-with-bicep","text":"To deploy resource that pass this rule: Set properties.configuration.ingress.allowInsecure to false . For example: resource containerApp 'Microsoft.Web/containerApps@2021-03-01' = { name: appName location: location properties: { kubeEnvironmentId: kubeEnv.id template: { revisionSuffix: '' containers: containers } configuration: { ingress: { allowInsecure: false } } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.ContainerApp.Insecure/#notes","text":"Azure Container Apps are currently in preview.","title":"Notes"},{"location":"en/rules/Azure.ContainerApp.Insecure/#links","text":"Data encryption in Azure Set up HTTPS ingress in Azure Container Apps Azure template reference","title":"Links"},{"location":"en/rules/Azure.Cosmos.AccountName/","tags":["Azure.Cosmos.AccountName","AZR-000096"],"text":"Use valid Cosmos DB account names # Azure.Cosmos.AccountName AZR-000096 Error Operational Excellence \u00b7 Cosmos DB \u00b7 2021_09 Cosmos DB account names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Cosmos DB account names are: Between 3 and 44 characters long. Lowercase letters, numbers, and hyphens. Start and end with letters and numbers. Cosmos DB account names must be globally unique. Recommendation # Consider using names that meet Cosmos DB account naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Cosmos DB account names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Azure.Cosmos.AccountName"},{"location":"en/rules/Azure.Cosmos.AccountName/#use-valid-cosmos-db-account-names","text":"Azure.Cosmos.AccountName AZR-000096 Error Operational Excellence \u00b7 Cosmos DB \u00b7 2021_09 Cosmos DB account names should meet naming requirements.","title":"Use valid Cosmos DB account names"},{"location":"en/rules/Azure.Cosmos.AccountName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Cosmos DB account names are: Between 3 and 44 characters long. Lowercase letters, numbers, and hyphens. Start and end with letters and numbers. Cosmos DB account names must be globally unique.","title":"Description"},{"location":"en/rules/Azure.Cosmos.AccountName/#recommendation","text":"Consider using names that meet Cosmos DB account naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.Cosmos.AccountName/#notes","text":"This rule does not check if Cosmos DB account names are unique.","title":"Notes"},{"location":"en/rules/Azure.Cosmos.AccountName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Links"},{"location":"en/rules/Azure.Cosmos.DisableMetadataWrite/","tags":["Azure.Cosmos.DisableMetadataWrite","AZR-000095"],"text":"Restrict user access to data operations in Azure Cosmos DB # Azure.Cosmos.DisableMetadataWrite AZR-000095 Error Security \u00b7 Cosmos DB \u00b7 2021_09 Use Azure AD identities for management place operations in Azure Cosmos DB. Description # Cosmos DB provides two authorization options for interacting with the database: Azure Active Directory identity (Azure AD). Can be used to authorize account and resource management operations. Keys and resource tokens. Can be used to authorize resource management and data operations. Resource management operations include management of databases, indexes, and containers. By default, keys are permitted to perform resource management operations. You can restrict these operations to Azure Resource Manager (ARM) calls only. Recommendation # Consider limiting key and resource tokens to data plane operations only. Use Azure AD identities for authorizing account and resource management operations. Examples # Configure with Azure template # To deploy Cosmos DB accounts that pass this rule: Set the Properties.disableKeyBasedMetadataWriteAccess property to true . For example: { \"type\" : \"Microsoft.DocumentDB/databaseAccounts\" , \"apiVersion\" : \"2021-06-15\" , \"name\" : \"[parameters('dbAccountName')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"consistencyPolicy\" : { \"defaultConsistencyLevel\" : \"Session\" }, \"databaseAccountOfferType\" : \"Standard\" , \"locations\" : [ { \"locationName\" : \"[parameters('location')]\" , \"failoverPriority\" : 0 , \"isZoneRedundant\" : false } ], \"disableKeyBasedMetadataWriteAccess\" : true } } Configure with Bicep # To deploy Cosmos DB accounts that pass this rule: Set the Properties.disableKeyBasedMetadataWriteAccess property to true . For example: resource dbAccount 'Microsoft.DocumentDB/databaseAccounts@2021-06-15' = { name: dbAccountName location: location properties: { consistencyPolicy: { defaultConsistencyLevel: 'Session' } databaseAccountOfferType: 'Standard' locations: [ { locationName: location failoverPriority: 0 isZoneRedundant: false } ] disableKeyBasedMetadataWriteAccess: true } } Links # Use identity-based authentication Restrict user access to data operations in Azure Cosmos DB Secure access to data in Azure Cosmos DB How does Azure Cosmos DB secure my database? Access control in the Azure Cosmos DB SQL API Azure resource template","title":"Azure.Cosmos.DisableMetadataWrite"},{"location":"en/rules/Azure.Cosmos.DisableMetadataWrite/#restrict-user-access-to-data-operations-in-azure-cosmos-db","text":"Azure.Cosmos.DisableMetadataWrite AZR-000095 Error Security \u00b7 Cosmos DB \u00b7 2021_09 Use Azure AD identities for management place operations in Azure Cosmos DB.","title":"Restrict user access to data operations in Azure Cosmos DB"},{"location":"en/rules/Azure.Cosmos.DisableMetadataWrite/#description","text":"Cosmos DB provides two authorization options for interacting with the database: Azure Active Directory identity (Azure AD). Can be used to authorize account and resource management operations. Keys and resource tokens. Can be used to authorize resource management and data operations. Resource management operations include management of databases, indexes, and containers. By default, keys are permitted to perform resource management operations. You can restrict these operations to Azure Resource Manager (ARM) calls only.","title":"Description"},{"location":"en/rules/Azure.Cosmos.DisableMetadataWrite/#recommendation","text":"Consider limiting key and resource tokens to data plane operations only. Use Azure AD identities for authorizing account and resource management operations.","title":"Recommendation"},{"location":"en/rules/Azure.Cosmos.DisableMetadataWrite/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Cosmos.DisableMetadataWrite/#configure-with-azure-template","text":"To deploy Cosmos DB accounts that pass this rule: Set the Properties.disableKeyBasedMetadataWriteAccess property to true . For example: { \"type\" : \"Microsoft.DocumentDB/databaseAccounts\" , \"apiVersion\" : \"2021-06-15\" , \"name\" : \"[parameters('dbAccountName')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"consistencyPolicy\" : { \"defaultConsistencyLevel\" : \"Session\" }, \"databaseAccountOfferType\" : \"Standard\" , \"locations\" : [ { \"locationName\" : \"[parameters('location')]\" , \"failoverPriority\" : 0 , \"isZoneRedundant\" : false } ], \"disableKeyBasedMetadataWriteAccess\" : true } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Cosmos.DisableMetadataWrite/#configure-with-bicep","text":"To deploy Cosmos DB accounts that pass this rule: Set the Properties.disableKeyBasedMetadataWriteAccess property to true . For example: resource dbAccount 'Microsoft.DocumentDB/databaseAccounts@2021-06-15' = { name: dbAccountName location: location properties: { consistencyPolicy: { defaultConsistencyLevel: 'Session' } databaseAccountOfferType: 'Standard' locations: [ { locationName: location failoverPriority: 0 isZoneRedundant: false } ] disableKeyBasedMetadataWriteAccess: true } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Cosmos.DisableMetadataWrite/#links","text":"Use identity-based authentication Restrict user access to data operations in Azure Cosmos DB Secure access to data in Azure Cosmos DB How does Azure Cosmos DB secure my database? Access control in the Azure Cosmos DB SQL API Azure resource template","title":"Links"},{"location":"en/rules/Azure.DataFactory.Version/","tags":["Azure.DataFactory.Version","AZR-000097"],"text":"Use Data Factory v2 # Azure.DataFactory.Version AZR-000097 Error Operational Excellence \u00b7 Data Factory \u00b7 2020_06 Consider migrating to DataFactory v2. Description # Consider migrating to DataFactory v2. Recommendation # Consider migrating to DataFactory v2.","title":"Azure.DataFactory.Version"},{"location":"en/rules/Azure.DataFactory.Version/#use-data-factory-v2","text":"Azure.DataFactory.Version AZR-000097 Error Operational Excellence \u00b7 Data Factory \u00b7 2020_06 Consider migrating to DataFactory v2.","title":"Use Data Factory v2"},{"location":"en/rules/Azure.DataFactory.Version/#description","text":"Consider migrating to DataFactory v2.","title":"Description"},{"location":"en/rules/Azure.DataFactory.Version/#recommendation","text":"Consider migrating to DataFactory v2.","title":"Recommendation"},{"location":"en/rules/Azure.Deployment.AdminUsername/","tags":["Azure.Deployment.AdminUsername","AZR-000284"],"text":"Administrator Username Types # Azure.Deployment.AdminUsername AZR-000284 Error Security \u00b7 All resources \u00b7 2022_09 The adminUsername or administratorUsername property should not be a string literal in nested templates. Description # In nested deployments a resource can have the adminUsername property set to a string literal value. This means that the value is passed through insecurely and is a security risk. Recommendation # Sensitive properties for nested deployments should be set by a secureString parameter. Links # Use KeyVault Secrets in Bicep Use KeyVault Secret in Parameter File Well Architected Framework - IAC","title":"Azure.Deployment.AdminUsername"},{"location":"en/rules/Azure.Deployment.AdminUsername/#administrator-username-types","text":"Azure.Deployment.AdminUsername AZR-000284 Error Security \u00b7 All resources \u00b7 2022_09 The adminUsername or administratorUsername property should not be a string literal in nested templates.","title":"Administrator Username Types"},{"location":"en/rules/Azure.Deployment.AdminUsername/#description","text":"In nested deployments a resource can have the adminUsername property set to a string literal value. This means that the value is passed through insecurely and is a security risk.","title":"Description"},{"location":"en/rules/Azure.Deployment.AdminUsername/#recommendation","text":"Sensitive properties for nested deployments should be set by a secureString parameter.","title":"Recommendation"},{"location":"en/rules/Azure.Deployment.AdminUsername/#links","text":"Use KeyVault Secrets in Bicep Use KeyVault Secret in Parameter File Well Architected Framework - IAC","title":"Links"},{"location":"en/rules/Azure.Deployment.OutputSecretValue/","tags":["Azure.Deployment.OutputSecretValue","AZR-000279"],"text":"Secret value in deployment output # Azure.Deployment.OutputSecretValue AZR-000279 Error Security \u00b7 Deployment \u00b7 2022_06 Avoid outputting sensitive deployment values. Description # Don't include any values in an ARM template or Bicep output that could potentially expose secrets. The output from a template is stored in the deployment history, so a malicious user could find that information. Examples of secrets are: Parameters using the secureString or secureObject type. Output from list* functions such as listKeys . Recommendation # Consider removing any output values that return secret values in code. Examples # Configure with Azure template # To deploy securely pass secrets within Infrastructure as Code: Define parameters with the secureString or secureObject type. Avoid returning a secret in output values. Example using secureString type: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { \"adminPassword\" : { \"type\" : \"secureString\" , \"metadata\" : { \"description\" : \"Local administrator password for virtual machine.\" } } }, \"resources\" : [] } The following example fails because it returns a secret: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { \"adminPassword\" : { \"type\" : \"secureString\" , \"metadata\" : { \"description\" : \"Local administrator password for virtual machine.\" } } }, \"resources\" : [], \"outputs\" : { \"accountPassword\" : { \"type\" : \"string\" , \"value\" : \"[parameters('adminPassword')]\" } } } Configure with Bicep # To deploy securely pass secrets within Infrastructure as Code: Mark secrets with the @secure() annotation. Avoid returning a secret in output values. Example using @secure() annotation: @secure() @description('Local administrator password for virtual machine.') param adminPassword string The following example fails because it returns a secret: output accountPassword string = adminPassword Links # Pipeline secret management Test cases for ARM templates Outputs should not contain secrets List function","title":"Azure.Deployment.OutputSecretValue"},{"location":"en/rules/Azure.Deployment.OutputSecretValue/#secret-value-in-deployment-output","text":"Azure.Deployment.OutputSecretValue AZR-000279 Error Security \u00b7 Deployment \u00b7 2022_06 Avoid outputting sensitive deployment values.","title":"Secret value in deployment output"},{"location":"en/rules/Azure.Deployment.OutputSecretValue/#description","text":"Don't include any values in an ARM template or Bicep output that could potentially expose secrets. The output from a template is stored in the deployment history, so a malicious user could find that information. Examples of secrets are: Parameters using the secureString or secureObject type. Output from list* functions such as listKeys .","title":"Description"},{"location":"en/rules/Azure.Deployment.OutputSecretValue/#recommendation","text":"Consider removing any output values that return secret values in code.","title":"Recommendation"},{"location":"en/rules/Azure.Deployment.OutputSecretValue/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Deployment.OutputSecretValue/#configure-with-azure-template","text":"To deploy securely pass secrets within Infrastructure as Code: Define parameters with the secureString or secureObject type. Avoid returning a secret in output values. Example using secureString type: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { \"adminPassword\" : { \"type\" : \"secureString\" , \"metadata\" : { \"description\" : \"Local administrator password for virtual machine.\" } } }, \"resources\" : [] } The following example fails because it returns a secret: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { \"adminPassword\" : { \"type\" : \"secureString\" , \"metadata\" : { \"description\" : \"Local administrator password for virtual machine.\" } } }, \"resources\" : [], \"outputs\" : { \"accountPassword\" : { \"type\" : \"string\" , \"value\" : \"[parameters('adminPassword')]\" } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Deployment.OutputSecretValue/#configure-with-bicep","text":"To deploy securely pass secrets within Infrastructure as Code: Mark secrets with the @secure() annotation. Avoid returning a secret in output values. Example using @secure() annotation: @secure() @description('Local administrator password for virtual machine.') param adminPassword string The following example fails because it returns a secret: output accountPassword string = adminPassword","title":"Configure with Bicep"},{"location":"en/rules/Azure.Deployment.OutputSecretValue/#links","text":"Pipeline secret management Test cases for ARM templates Outputs should not contain secrets List function","title":"Links"},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/","tags":["Azure.EventGrid.DisableLocalAuth","AZR-000100"],"text":"Use identity-based authentication for Event Grid topics # Azure.EventGrid.DisableLocalAuth AZR-000100 Error Security \u00b7 Event Grid \u00b7 Preview \u00b7 2021_12 Authenticate publishing clients with Azure AD identities. Description # To publish events to Event Grid access keys, SAS tokens, or Azure AD identities can be used. With Azure AD authentication, the identity is validated against Azure AD identity provider. Using Azure AD identities centralizes identity management and auditing. Once you decide to use Azure AD authentication, you can disable authentication using keys or SAS tokens. Recommendation # Consider only using Azure AD identities to publish events to Event Grid. Then disable authentication based on access keys or SAS tokens. Examples # Configure with Azure template # To deploy Event Grid Topics that pass this rule: Set the properties.disableLocalAuth property to true . For example: { \"type\" : \"Microsoft.EventGrid/topics\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[parameters('topicName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : true , \"publicNetworkAccess\" : \"Disabled\" , \"inputSchema\" : \"CloudEventSchemaV1_0\" } } Configure with Bicep # To deploy Event Grid Topics that pass this rule: Set the properties.disableLocalAuth property to true . For example: resource eventGrid 'Microsoft.EventGrid/topics@2021-06-01-preview' = { name: topicName location: location identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: true publicNetworkAccess: 'Disabled' inputSchema: 'CloudEventSchemaV1_0' } } Notes # This Azure feature is currently in preview. Links # Use identity-based authentication Authentication and authorization with Azure Active Directory Disable key and shared access signature authentication Azure template reference","title":"Azure.EventGrid.DisableLocalAuth"},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/#use-identity-based-authentication-for-event-grid-topics","text":"Azure.EventGrid.DisableLocalAuth AZR-000100 Error Security \u00b7 Event Grid \u00b7 Preview \u00b7 2021_12 Authenticate publishing clients with Azure AD identities.","title":"Use identity-based authentication for Event Grid topics"},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/#description","text":"To publish events to Event Grid access keys, SAS tokens, or Azure AD identities can be used. With Azure AD authentication, the identity is validated against Azure AD identity provider. Using Azure AD identities centralizes identity management and auditing. Once you decide to use Azure AD authentication, you can disable authentication using keys or SAS tokens.","title":"Description"},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/#recommendation","text":"Consider only using Azure AD identities to publish events to Event Grid. Then disable authentication based on access keys or SAS tokens.","title":"Recommendation"},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/#configure-with-azure-template","text":"To deploy Event Grid Topics that pass this rule: Set the properties.disableLocalAuth property to true . For example: { \"type\" : \"Microsoft.EventGrid/topics\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[parameters('topicName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : true , \"publicNetworkAccess\" : \"Disabled\" , \"inputSchema\" : \"CloudEventSchemaV1_0\" } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/#configure-with-bicep","text":"To deploy Event Grid Topics that pass this rule: Set the properties.disableLocalAuth property to true . For example: resource eventGrid 'Microsoft.EventGrid/topics@2021-06-01-preview' = { name: topicName location: location identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: true publicNetworkAccess: 'Disabled' inputSchema: 'CloudEventSchemaV1_0' } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/#notes","text":"This Azure feature is currently in preview.","title":"Notes"},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/#links","text":"Use identity-based authentication Authentication and authorization with Azure Active Directory Disable key and shared access signature authentication Azure template reference","title":"Links"},{"location":"en/rules/Azure.EventGrid.ManagedIdentity/","tags":["Azure.EventGrid.ManagedIdentity","AZR-000099"],"text":"Use Managed Identity for Event Grid Topics # Azure.EventGrid.ManagedIdentity AZR-000099 Error Security \u00b7 Event Grid \u00b7 2021_12 Use managed identities to deliver Event Grid Topic events. Description # When delivering events you can use Managed Identities to authenticate event delivery. You can enable either system-assigned identity or user-assigned identity but not both. You can have at most two user-assigned identities assigned to a topic or domain. Recommendation # Consider configuring a managed identity for each Event Grid Topic. Examples # Configure with Azure template # To deploy Event Grid Topics that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: { \"type\" : \"Microsoft.EventGrid/topics\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[parameters('topicName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : true , \"publicNetworkAccess\" : \"Disabled\" , \"inputSchema\" : \"CloudEventSchemaV1_0\" } } Configure with Bicep # To deploy Event Grid Topics that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: resource eventGrid 'Microsoft.EventGrid/topics@2021-06-01-preview' = { name: topicName location: location identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: true publicNetworkAccess: 'Disabled' inputSchema: 'CloudEventSchemaV1_0' } } Links # Use identity-based authentication Assign a managed identity to an Event Grid custom topic or domain Authenticate event delivery to event handlers Azure template reference","title":"Azure.EventGrid.ManagedIdentity"},{"location":"en/rules/Azure.EventGrid.ManagedIdentity/#use-managed-identity-for-event-grid-topics","text":"Azure.EventGrid.ManagedIdentity AZR-000099 Error Security \u00b7 Event Grid \u00b7 2021_12 Use managed identities to deliver Event Grid Topic events.","title":"Use Managed Identity for Event Grid Topics"},{"location":"en/rules/Azure.EventGrid.ManagedIdentity/#description","text":"When delivering events you can use Managed Identities to authenticate event delivery. You can enable either system-assigned identity or user-assigned identity but not both. You can have at most two user-assigned identities assigned to a topic or domain.","title":"Description"},{"location":"en/rules/Azure.EventGrid.ManagedIdentity/#recommendation","text":"Consider configuring a managed identity for each Event Grid Topic.","title":"Recommendation"},{"location":"en/rules/Azure.EventGrid.ManagedIdentity/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.EventGrid.ManagedIdentity/#configure-with-azure-template","text":"To deploy Event Grid Topics that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: { \"type\" : \"Microsoft.EventGrid/topics\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[parameters('topicName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : true , \"publicNetworkAccess\" : \"Disabled\" , \"inputSchema\" : \"CloudEventSchemaV1_0\" } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.EventGrid.ManagedIdentity/#configure-with-bicep","text":"To deploy Event Grid Topics that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: resource eventGrid 'Microsoft.EventGrid/topics@2021-06-01-preview' = { name: topicName location: location identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: true publicNetworkAccess: 'Disabled' inputSchema: 'CloudEventSchemaV1_0' } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.EventGrid.ManagedIdentity/#links","text":"Use identity-based authentication Assign a managed identity to an Event Grid custom topic or domain Authenticate event delivery to event handlers Azure template reference","title":"Links"},{"location":"en/rules/Azure.EventGrid.TopicPublicAccess/","tags":["Azure.EventGrid.TopicPublicAccess","AZR-000098"],"text":"Use Event Grid Private Endpoints # Azure.EventGrid.TopicPublicAccess AZR-000098 Error Security \u00b7 Event Grid \u00b7 2021_12 Use Private Endpoints to access Event Grid topics and domains. Description # By default, public network access is enabled for an Event Grid topic or domain. To allow access via private endpoints only, disable public network access. Recommendation # Consider using Private Endpoints to access Event Grid topics and domains. To limit access to Event Grid topics and domains, disable public access. Examples # Configure with Azure template # To deploy Event Grid Topics that pass this rule: Set the properties.publicNetworkAccess property to Disabled . For example: { \"type\" : \"Microsoft.EventGrid/topics\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[parameters('topicName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : true , \"publicNetworkAccess\" : \"Disabled\" , \"inputSchema\" : \"CloudEventSchemaV1_0\" } } Configure with Bicep # To deploy Event Grid Topics that pass this rule: Set the properties.publicNetworkAccess property to Disabled . For example: resource eventGrid 'Microsoft.EventGrid/topics@2021-06-01-preview' = { name: topicName location: location identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: true publicNetworkAccess: 'Disabled' inputSchema: 'CloudEventSchemaV1_0' } } Links # Traffic flow security in Azure Private Endpoints Azure template reference","title":"Azure.EventGrid.TopicPublicAccess"},{"location":"en/rules/Azure.EventGrid.TopicPublicAccess/#use-event-grid-private-endpoints","text":"Azure.EventGrid.TopicPublicAccess AZR-000098 Error Security \u00b7 Event Grid \u00b7 2021_12 Use Private Endpoints to access Event Grid topics and domains.","title":"Use Event Grid Private Endpoints"},{"location":"en/rules/Azure.EventGrid.TopicPublicAccess/#description","text":"By default, public network access is enabled for an Event Grid topic or domain. To allow access via private endpoints only, disable public network access.","title":"Description"},{"location":"en/rules/Azure.EventGrid.TopicPublicAccess/#recommendation","text":"Consider using Private Endpoints to access Event Grid topics and domains. To limit access to Event Grid topics and domains, disable public access.","title":"Recommendation"},{"location":"en/rules/Azure.EventGrid.TopicPublicAccess/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.EventGrid.TopicPublicAccess/#configure-with-azure-template","text":"To deploy Event Grid Topics that pass this rule: Set the properties.publicNetworkAccess property to Disabled . For example: { \"type\" : \"Microsoft.EventGrid/topics\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[parameters('topicName')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : true , \"publicNetworkAccess\" : \"Disabled\" , \"inputSchema\" : \"CloudEventSchemaV1_0\" } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.EventGrid.TopicPublicAccess/#configure-with-bicep","text":"To deploy Event Grid Topics that pass this rule: Set the properties.publicNetworkAccess property to Disabled . For example: resource eventGrid 'Microsoft.EventGrid/topics@2021-06-01-preview' = { name: topicName location: location identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: true publicNetworkAccess: 'Disabled' inputSchema: 'CloudEventSchemaV1_0' } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.EventGrid.TopicPublicAccess/#links","text":"Traffic flow security in Azure Private Endpoints Azure template reference","title":"Links"},{"location":"en/rules/Azure.EventHub.DisableLocalAuth/","tags":["Azure.EventHub.DisableLocalAuth","AZR-000102"],"text":"Use identity-based authentication for Event Hub namespaces # Azure.EventHub.DisableLocalAuth AZR-000102 Error Security \u00b7 Event Hub \u00b7 2022_03 Authenticate Event Hub publishers and consumers with Azure AD identities. Description # To publish or consume events from Event Hubs cryptographic keys, or Azure AD identities can be used. Cryptographic keys include Shared Access Policy keys or Shared Access Signature (SAS) tokens. With Azure AD authentication, the identity is validated against Azure AD. Using Azure AD identities centralizes identity management and auditing. Once you decide to use Azure AD authentication, you can disable authentication using keys or SAS tokens. Recommendation # Consider only using Azure AD identities to publish or consume events from Event Hub. Then disable authentication based on access keys or SAS tokens. Examples # Configure with Azure template # To deploy Event Hub namespaces that pass this rule: Set the properties.disableLocalAuth property to true . For example: { \"type\" : \"Microsoft.EventHub/namespaces\" , \"apiVersion\" : \"2021-11-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"Standard\" }, \"properties\" : { \"disableLocalAuth\" : true , \"isAutoInflateEnabled\" : true , \"maximumThroughputUnits\" : 10 , \"zoneRedundant\" : true } } Configure with Bicep # To deploy Event Hub namespaces that pass this rule: Set the properties.disableLocalAuth property to true . For example: resource ns 'Microsoft.EventHub/namespaces@2021-11-01' = { name: name location: location identity: { type: 'SystemAssigned' } sku: { name: 'Standard' } properties: { disableLocalAuth: true isAutoInflateEnabled: true maximumThroughputUnits: 10 zoneRedundant: true } } Links # Use identity-based authentication Authorize access to Event Hubs resources using Azure Active Directory Disabling Local/SAS Key authentication Azure template reference","title":"Azure.EventHub.DisableLocalAuth"},{"location":"en/rules/Azure.EventHub.DisableLocalAuth/#use-identity-based-authentication-for-event-hub-namespaces","text":"Azure.EventHub.DisableLocalAuth AZR-000102 Error Security \u00b7 Event Hub \u00b7 2022_03 Authenticate Event Hub publishers and consumers with Azure AD identities.","title":"Use identity-based authentication for Event Hub namespaces"},{"location":"en/rules/Azure.EventHub.DisableLocalAuth/#description","text":"To publish or consume events from Event Hubs cryptographic keys, or Azure AD identities can be used. Cryptographic keys include Shared Access Policy keys or Shared Access Signature (SAS) tokens. With Azure AD authentication, the identity is validated against Azure AD. Using Azure AD identities centralizes identity management and auditing. Once you decide to use Azure AD authentication, you can disable authentication using keys or SAS tokens.","title":"Description"},{"location":"en/rules/Azure.EventHub.DisableLocalAuth/#recommendation","text":"Consider only using Azure AD identities to publish or consume events from Event Hub. Then disable authentication based on access keys or SAS tokens.","title":"Recommendation"},{"location":"en/rules/Azure.EventHub.DisableLocalAuth/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.EventHub.DisableLocalAuth/#configure-with-azure-template","text":"To deploy Event Hub namespaces that pass this rule: Set the properties.disableLocalAuth property to true . For example: { \"type\" : \"Microsoft.EventHub/namespaces\" , \"apiVersion\" : \"2021-11-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"Standard\" }, \"properties\" : { \"disableLocalAuth\" : true , \"isAutoInflateEnabled\" : true , \"maximumThroughputUnits\" : 10 , \"zoneRedundant\" : true } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.EventHub.DisableLocalAuth/#configure-with-bicep","text":"To deploy Event Hub namespaces that pass this rule: Set the properties.disableLocalAuth property to true . For example: resource ns 'Microsoft.EventHub/namespaces@2021-11-01' = { name: name location: location identity: { type: 'SystemAssigned' } sku: { name: 'Standard' } properties: { disableLocalAuth: true isAutoInflateEnabled: true maximumThroughputUnits: 10 zoneRedundant: true } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.EventHub.DisableLocalAuth/#links","text":"Use identity-based authentication Authorize access to Event Hubs resources using Azure Active Directory Disabling Local/SAS Key authentication Azure template reference","title":"Links"},{"location":"en/rules/Azure.EventHub.Usage/","tags":["Azure.EventHub.Usage","AZR-000101"],"text":"Remove unused Event Hub namespaces # Azure.EventHub.Usage AZR-000101 Error Cost Optimization \u00b7 Event Hub \u00b7 2022_03 Regularly remove unused resources to reduce costs. Description # Billing starts for an Event Hub namespace after it is provisioned. To receive events in a Event Hub namespace, you must first create an Event Hub. Namespaces without any Event Hubs are considered unused. Recommendation # Consider removing Event Hub namespaces that are not used. Notes # This rule applies when analyzing resources deployed (in-flight) to Azure. Links # Generate cost reports Pricing","title":"Azure.EventHub.Usage"},{"location":"en/rules/Azure.EventHub.Usage/#remove-unused-event-hub-namespaces","text":"Azure.EventHub.Usage AZR-000101 Error Cost Optimization \u00b7 Event Hub \u00b7 2022_03 Regularly remove unused resources to reduce costs.","title":"Remove unused Event Hub namespaces"},{"location":"en/rules/Azure.EventHub.Usage/#description","text":"Billing starts for an Event Hub namespace after it is provisioned. To receive events in a Event Hub namespace, you must first create an Event Hub. Namespaces without any Event Hubs are considered unused.","title":"Description"},{"location":"en/rules/Azure.EventHub.Usage/#recommendation","text":"Consider removing Event Hub namespaces that are not used.","title":"Recommendation"},{"location":"en/rules/Azure.EventHub.Usage/#notes","text":"This rule applies when analyzing resources deployed (in-flight) to Azure.","title":"Notes"},{"location":"en/rules/Azure.EventHub.Usage/#links","text":"Generate cost reports Pricing","title":"Links"},{"location":"en/rules/Azure.Firewall.Mode/","tags":["Azure.Firewall.Mode","AZR-000105"],"text":"Configure deny on threat intel for classic managed Azure Firewalls # Azure.Firewall.Mode AZR-000105 Error Security \u00b7 Firewall \u00b7 2020_06 Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Description # Threat intelligence-based filtering can optionally be enabled on Azure Firewall. When enabled, Azure Firewall alerts and deny traffic to/ from known malicious IP addresses and domains. By default, Azure Firewall alerts on triggered threat intelligence rules. Specifically, this rule only applies using an Azure Firewall in classic management mode. If the Azure Firewall is connected to a Secured Virtual Hub this rule will not apply. Classic managed Azure Firewalls are standalone. Alternatively you can manage Azure Firewalls at scale through Firewall Manager by using policy. When using firewall policies, threat intelligence is configured centrally instead of on each firewall. Recommendation # Consider configuring Azure Firewall to alert and deny IP addresses and domains detected as malicious. Alternatively, consider using firewall policies to manage Azure Firewalls at scale. Configure with Azure template # To deploy Azure Firewalls that pass this rule: Set the properties.threatIntelMode to Deny . For example: { \"type\" : \"Microsoft.Network/azureFirewalls\" , \"apiVersion\" : \"2021-05-01\" , \"name\" : \"[format('{0}_classic', parameters('name'))]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"sku\" : { \"name\" : \"AZFW_VNet\" }, \"threatIntelMode\" : \"Deny\" } } Configure with Bicep # To deploy Azure Firewalls that pass this rule: Set the properties.threatIntelMode to Deny . For example: resource firewall_classic 'Microsoft.Network/azureFirewalls@2021-05-01' = { name: '${name}_classic' location: location properties: { sku: { name: 'AZFW_VNet' } threatIntelMode: 'Deny' } } Links # Implement network segmentation patterns on Azure Azure Firewall threat intelligence-based filtering Azure network security overview Azure template reference","title":"Azure.Firewall.Mode"},{"location":"en/rules/Azure.Firewall.Mode/#configure-deny-on-threat-intel-for-classic-managed-azure-firewalls","text":"Azure.Firewall.Mode AZR-000105 Error Security \u00b7 Firewall \u00b7 2020_06 Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls.","title":"Configure deny on threat intel for classic managed Azure Firewalls"},{"location":"en/rules/Azure.Firewall.Mode/#description","text":"Threat intelligence-based filtering can optionally be enabled on Azure Firewall. When enabled, Azure Firewall alerts and deny traffic to/ from known malicious IP addresses and domains. By default, Azure Firewall alerts on triggered threat intelligence rules. Specifically, this rule only applies using an Azure Firewall in classic management mode. If the Azure Firewall is connected to a Secured Virtual Hub this rule will not apply. Classic managed Azure Firewalls are standalone. Alternatively you can manage Azure Firewalls at scale through Firewall Manager by using policy. When using firewall policies, threat intelligence is configured centrally instead of on each firewall.","title":"Description"},{"location":"en/rules/Azure.Firewall.Mode/#recommendation","text":"Consider configuring Azure Firewall to alert and deny IP addresses and domains detected as malicious. Alternatively, consider using firewall policies to manage Azure Firewalls at scale.","title":"Recommendation"},{"location":"en/rules/Azure.Firewall.Mode/#configure-with-azure-template","text":"To deploy Azure Firewalls that pass this rule: Set the properties.threatIntelMode to Deny . For example: { \"type\" : \"Microsoft.Network/azureFirewalls\" , \"apiVersion\" : \"2021-05-01\" , \"name\" : \"[format('{0}_classic', parameters('name'))]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"sku\" : { \"name\" : \"AZFW_VNet\" }, \"threatIntelMode\" : \"Deny\" } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Firewall.Mode/#configure-with-bicep","text":"To deploy Azure Firewalls that pass this rule: Set the properties.threatIntelMode to Deny . For example: resource firewall_classic 'Microsoft.Network/azureFirewalls@2021-05-01' = { name: '${name}_classic' location: location properties: { sku: { name: 'AZFW_VNet' } threatIntelMode: 'Deny' } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Firewall.Mode/#links","text":"Implement network segmentation patterns on Azure Azure Firewall threat intelligence-based filtering Azure network security overview Azure template reference","title":"Links"},{"location":"en/rules/Azure.Firewall.Name/","tags":["Azure.Firewall.Name","AZR-000103"],"text":"Use valid Firewall names # Azure.Firewall.Name AZR-000103 Error Operational Excellence \u00b7 Firewall \u00b7 2021_12 Firewall names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Firewall names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Firewall names must be unique within a resource group. Recommendation # Consider using names that meet Firewall naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Firewall names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Azure.Firewall.Name"},{"location":"en/rules/Azure.Firewall.Name/#use-valid-firewall-names","text":"Azure.Firewall.Name AZR-000103 Error Operational Excellence \u00b7 Firewall \u00b7 2021_12 Firewall names should meet naming requirements.","title":"Use valid Firewall names"},{"location":"en/rules/Azure.Firewall.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Firewall names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Firewall names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.Firewall.Name/#recommendation","text":"Consider using names that meet Firewall naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.Firewall.Name/#notes","text":"This rule does not check if Firewall names are unique.","title":"Notes"},{"location":"en/rules/Azure.Firewall.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Links"},{"location":"en/rules/Azure.Firewall.PolicyName/","tags":["Azure.Firewall.PolicyName","AZR-000104"],"text":"Use valid Firewall policy names # Azure.Firewall.PolicyName AZR-000104 Error Operational Excellence \u00b7 Firewall \u00b7 2021_12 Firewall policy names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Firewall policy names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Firewall policy names must be unique within a resource group. Recommendation # Consider using names that meet Firewall policy naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Firewall policy names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Azure.Firewall.PolicyName"},{"location":"en/rules/Azure.Firewall.PolicyName/#use-valid-firewall-policy-names","text":"Azure.Firewall.PolicyName AZR-000104 Error Operational Excellence \u00b7 Firewall \u00b7 2021_12 Firewall policy names should meet naming requirements.","title":"Use valid Firewall policy names"},{"location":"en/rules/Azure.Firewall.PolicyName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Firewall policy names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Firewall policy names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.Firewall.PolicyName/#recommendation","text":"Consider using names that meet Firewall policy naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.Firewall.PolicyName/#notes","text":"This rule does not check if Firewall policy names are unique.","title":"Notes"},{"location":"en/rules/Azure.Firewall.PolicyName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Links"},{"location":"en/rules/Azure.FrontDoor.Logs/","tags":["Azure.FrontDoor.Logs","AZR-000107"],"text":"Audit Front Door access # Azure.FrontDoor.Logs AZR-000107 Error Security \u00b7 Front Door \u00b7 2020_06 Audit and monitor access through Front Door. Description # To capture network activity through Front Door, diagnostic settings must be configured. When configuring diagnostics settings enable FrontdoorAccessLog logs. Enable FrontdoorWebApplicationFirewallLog when web application firewall (WAF) policy is configured. Management operations for Front Door is captured automatically within Azure Activity Logs. Recommendation # Consider configuring diagnostics setting to log network activity through Front Door. Links # Monitoring metrics and logs in Azure Front Door Service","title":"Azure.FrontDoor.Logs"},{"location":"en/rules/Azure.FrontDoor.Logs/#audit-front-door-access","text":"Azure.FrontDoor.Logs AZR-000107 Error Security \u00b7 Front Door \u00b7 2020_06 Audit and monitor access through Front Door.","title":"Audit Front Door access"},{"location":"en/rules/Azure.FrontDoor.Logs/#description","text":"To capture network activity through Front Door, diagnostic settings must be configured. When configuring diagnostics settings enable FrontdoorAccessLog logs. Enable FrontdoorWebApplicationFirewallLog when web application firewall (WAF) policy is configured. Management operations for Front Door is captured automatically within Azure Activity Logs.","title":"Description"},{"location":"en/rules/Azure.FrontDoor.Logs/#recommendation","text":"Consider configuring diagnostics setting to log network activity through Front Door.","title":"Recommendation"},{"location":"en/rules/Azure.FrontDoor.Logs/#links","text":"Monitoring metrics and logs in Azure Front Door Service","title":"Links"},{"location":"en/rules/Azure.FrontDoor.MinTLS/","tags":["Azure.FrontDoor.MinTLS","AZR-000106"],"text":"Front Door minimum TLS # Azure.FrontDoor.MinTLS AZR-000106 Error Security \u00b7 Front Door \u00b7 2020_06 Front Door should reject TLS versions older then 1.2. Description # The minimum version of TLS that Azure Front Door accepts is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. Front Door lets you disable outdated protocols and enforce TLS 1.2. By default, a minimum of TLS 1.2 is enforced. Recommendation # Consider configuring the minimum supported TLS version to be 1.2. Links # Data encryption in Azure Preparing for TLS 1.2 in Microsoft Azure What TLS versions are supported by Azure Front Door Service? Azure deployment reference","title":"Azure.FrontDoor.MinTLS"},{"location":"en/rules/Azure.FrontDoor.MinTLS/#front-door-minimum-tls","text":"Azure.FrontDoor.MinTLS AZR-000106 Error Security \u00b7 Front Door \u00b7 2020_06 Front Door should reject TLS versions older then 1.2.","title":"Front Door minimum TLS"},{"location":"en/rules/Azure.FrontDoor.MinTLS/#description","text":"The minimum version of TLS that Azure Front Door accepts is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. Front Door lets you disable outdated protocols and enforce TLS 1.2. By default, a minimum of TLS 1.2 is enforced.","title":"Description"},{"location":"en/rules/Azure.FrontDoor.MinTLS/#recommendation","text":"Consider configuring the minimum supported TLS version to be 1.2.","title":"Recommendation"},{"location":"en/rules/Azure.FrontDoor.MinTLS/#links","text":"Data encryption in Azure Preparing for TLS 1.2 in Microsoft Azure What TLS versions are supported by Azure Front Door Service? Azure deployment reference","title":"Links"},{"location":"en/rules/Azure.FrontDoor.Name/","tags":["Azure.FrontDoor.Name","AZR-000113"],"text":"Use valid Front Door names # Azure.FrontDoor.Name AZR-000113 Error Operational Excellence \u00b7 Front Door \u00b7 2020_06 Front Door names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Front Door names are: Between 5 and 64 characters long. Alphanumerics and hyphens. Start and end with alphanumeric. Front Door names must be globally unique. Recommendation # Consider using names that meet Front Door naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Front Door names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Recommended abbreviations for Azure resource types Azure template reference","title":"Azure.FrontDoor.Name"},{"location":"en/rules/Azure.FrontDoor.Name/#use-valid-front-door-names","text":"Azure.FrontDoor.Name AZR-000113 Error Operational Excellence \u00b7 Front Door \u00b7 2020_06 Front Door names should meet naming requirements.","title":"Use valid Front Door names"},{"location":"en/rules/Azure.FrontDoor.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Front Door names are: Between 5 and 64 characters long. Alphanumerics and hyphens. Start and end with alphanumeric. Front Door names must be globally unique.","title":"Description"},{"location":"en/rules/Azure.FrontDoor.Name/#recommendation","text":"Consider using names that meet Front Door naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.FrontDoor.Name/#notes","text":"This rule does not check if Front Door names are unique.","title":"Notes"},{"location":"en/rules/Azure.FrontDoor.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Recommended abbreviations for Azure resource types Azure template reference","title":"Links"},{"location":"en/rules/Azure.FrontDoor.Probe/","tags":["Azure.FrontDoor.Probe","AZR-000108"],"text":"Use health probes for Front Door backends # Azure.FrontDoor.Probe AZR-000108 Error Reliability \u00b7 Front Door \u00b7 2021_03 Configure and enable health probes for each backend pool. Description # The health and performance of an application can degrade over time. Degradation might not be noticeable until the application fails. Azure Front Door can use periodic health probes against backend endpoints to determine health status. When one or more backend in a pool is healthy traffic is routed to healthy endpoints only. If all endpoints in a pool is unhealthy Front Door sends the request to any enabled endpoint. Health probes allow Front Door to select a backend endpoint able to respond to the request. Recommendation # Consider enabling a health probe for each Front Door backend endpoint. Examples # Configure with Azure CLI # az network front-door probe update --front-door-name '<front_door>' -n '<probe_name>' -g '<resource_group>' --enabled 'Enabled' Configure with Azure PowerShell # $probeSetting = New-AzFrontDoorHealthProbeSettingObject -Name '<probe_name>' -EnabledState 'Enabled' Set-AzFrontDoor -Name '<front_door>' -ResourceGroupName '<resource_group>' -HealthProbeSetting $probeSetting Links # Creating good health probes Health probes How Front Door determines backend health Health Endpoint Monitoring pattern Azure resource template","title":"Azure.FrontDoor.Probe"},{"location":"en/rules/Azure.FrontDoor.Probe/#use-health-probes-for-front-door-backends","text":"Azure.FrontDoor.Probe AZR-000108 Error Reliability \u00b7 Front Door \u00b7 2021_03 Configure and enable health probes for each backend pool.","title":"Use health probes for Front Door backends"},{"location":"en/rules/Azure.FrontDoor.Probe/#description","text":"The health and performance of an application can degrade over time. Degradation might not be noticeable until the application fails. Azure Front Door can use periodic health probes against backend endpoints to determine health status. When one or more backend in a pool is healthy traffic is routed to healthy endpoints only. If all endpoints in a pool is unhealthy Front Door sends the request to any enabled endpoint. Health probes allow Front Door to select a backend endpoint able to respond to the request.","title":"Description"},{"location":"en/rules/Azure.FrontDoor.Probe/#recommendation","text":"Consider enabling a health probe for each Front Door backend endpoint.","title":"Recommendation"},{"location":"en/rules/Azure.FrontDoor.Probe/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.FrontDoor.Probe/#configure-with-azure-cli","text":"az network front-door probe update --front-door-name '<front_door>' -n '<probe_name>' -g '<resource_group>' --enabled 'Enabled'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.FrontDoor.Probe/#configure-with-azure-powershell","text":"$probeSetting = New-AzFrontDoorHealthProbeSettingObject -Name '<probe_name>' -EnabledState 'Enabled' Set-AzFrontDoor -Name '<front_door>' -ResourceGroupName '<resource_group>' -HealthProbeSetting $probeSetting","title":"Configure with Azure PowerShell"},{"location":"en/rules/Azure.FrontDoor.Probe/#links","text":"Creating good health probes Health probes How Front Door determines backend health Health Endpoint Monitoring pattern Azure resource template","title":"Links"},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/","tags":["Azure.FrontDoor.ProbeMethod","AZR-000109"],"text":"Use HEAD health probes for Front Door backends # Azure.FrontDoor.ProbeMethod AZR-000109 Error Reliability \u00b7 Front Door \u00b7 2021_03 Configure health probes to use HEAD instead of GET requests. Description # Azure Front Door supports sending HEAD or GET requests for health probes to backend endpoints. HTTP HEAD requests are identical to GET requests except that the server does not send a response body. To lower load and performance cost against backends use HEAD requests. Recommendation # Consider configuring health probes to query backend health endpoints using HEAD requests. Examples # Configure with Azure CLI # az network front-door probe update --front-door-name '<front_door>' -n '<probe_name>' -g '<resource_group>' --probeMethod 'HEAD' Configure with Azure PowerShell # $probeSetting = New-AzFrontDoorHealthProbeSettingObject -Name '<probe_name>' -HealthProbeMethod 'HEAD' Set-AzFrontDoor -Name '<front_door>' -ResourceGroupName '<resource_group>' -HealthProbeSetting $probeSetting Links # Supported HTTP methods for health probes How Front Door determines backend health Creating good health probes Health Endpoint Monitoring pattern Azure resource template","title":"Azure.FrontDoor.ProbeMethod"},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/#use-head-health-probes-for-front-door-backends","text":"Azure.FrontDoor.ProbeMethod AZR-000109 Error Reliability \u00b7 Front Door \u00b7 2021_03 Configure health probes to use HEAD instead of GET requests.","title":"Use HEAD health probes for Front Door backends"},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/#description","text":"Azure Front Door supports sending HEAD or GET requests for health probes to backend endpoints. HTTP HEAD requests are identical to GET requests except that the server does not send a response body. To lower load and performance cost against backends use HEAD requests.","title":"Description"},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/#recommendation","text":"Consider configuring health probes to query backend health endpoints using HEAD requests.","title":"Recommendation"},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/#configure-with-azure-cli","text":"az network front-door probe update --front-door-name '<front_door>' -n '<probe_name>' -g '<resource_group>' --probeMethod 'HEAD'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/#configure-with-azure-powershell","text":"$probeSetting = New-AzFrontDoorHealthProbeSettingObject -Name '<probe_name>' -HealthProbeMethod 'HEAD' Set-AzFrontDoor -Name '<front_door>' -ResourceGroupName '<resource_group>' -HealthProbeSetting $probeSetting","title":"Configure with Azure PowerShell"},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/#links","text":"Supported HTTP methods for health probes How Front Door determines backend health Creating good health probes Health Endpoint Monitoring pattern Azure resource template","title":"Links"},{"location":"en/rules/Azure.FrontDoor.ProbePath/","tags":["Azure.FrontDoor.ProbePath","AZR-000110"],"text":"Use a dedicated health endpoint for Front Door backends # Azure.FrontDoor.ProbePath AZR-000110 Error Reliability \u00b7 Front Door \u00b7 2021_03 Configure a dedicated path for health probe requests. Description # Azure Front Door monitors a specific path for each backend to determine health status. The monitored path should implement functional checks to determine if the backend is performing correctly. The checks should include dependencies including those that may not be regularly called. Regular checks of the monitored path allow Front Door to make load balancing decisions based on status. Recommendation # Consider using a dedicated health probe endpoint that implements functional checks. Examples # Configure with Azure CLI # az network front-door probe update --front-door-name '<front_door>' -n '<probe_name>' -g '<resource_group>' --path '<path>' Configure with Azure PowerShell # $probeSetting = New-AzFrontDoorHealthProbeSettingObject -Name '<probe_name>' -Path '<path>' Set-AzFrontDoor -Name '<front_door>' -ResourceGroupName '<resource_group>' -HealthProbeSetting $probeSetting Links # Health probes How Front Door determines backend health Creating good health probes Health Endpoint Monitoring pattern Azure resource template","title":"Azure.FrontDoor.ProbePath"},{"location":"en/rules/Azure.FrontDoor.ProbePath/#use-a-dedicated-health-endpoint-for-front-door-backends","text":"Azure.FrontDoor.ProbePath AZR-000110 Error Reliability \u00b7 Front Door \u00b7 2021_03 Configure a dedicated path for health probe requests.","title":"Use a dedicated health endpoint for Front Door backends"},{"location":"en/rules/Azure.FrontDoor.ProbePath/#description","text":"Azure Front Door monitors a specific path for each backend to determine health status. The monitored path should implement functional checks to determine if the backend is performing correctly. The checks should include dependencies including those that may not be regularly called. Regular checks of the monitored path allow Front Door to make load balancing decisions based on status.","title":"Description"},{"location":"en/rules/Azure.FrontDoor.ProbePath/#recommendation","text":"Consider using a dedicated health probe endpoint that implements functional checks.","title":"Recommendation"},{"location":"en/rules/Azure.FrontDoor.ProbePath/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.FrontDoor.ProbePath/#configure-with-azure-cli","text":"az network front-door probe update --front-door-name '<front_door>' -n '<probe_name>' -g '<resource_group>' --path '<path>'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.FrontDoor.ProbePath/#configure-with-azure-powershell","text":"$probeSetting = New-AzFrontDoorHealthProbeSettingObject -Name '<probe_name>' -Path '<path>' Set-AzFrontDoor -Name '<front_door>' -ResourceGroupName '<resource_group>' -HealthProbeSetting $probeSetting","title":"Configure with Azure PowerShell"},{"location":"en/rules/Azure.FrontDoor.ProbePath/#links","text":"Health probes How Front Door determines backend health Creating good health probes Health Endpoint Monitoring pattern Azure resource template","title":"Links"},{"location":"en/rules/Azure.FrontDoor.State/","tags":["Azure.FrontDoor.State","AZR-000112"],"text":"Enable Front Door instance # Azure.FrontDoor.State AZR-000112 Error Cost Optimization \u00b7 Front Door \u00b7 2020_06 Enable Azure Front Door instance. Description # The operational state of a Front Door instance is configurable, either enabled or disabled. By default, a Front Door is enabled. Optionally, a Front Door instance may be disabled to temporarily prevent traffic being processed. Recommendation # Consider enabling Front Door service or remove the instance if it no longer required.","title":"Azure.FrontDoor.State"},{"location":"en/rules/Azure.FrontDoor.State/#enable-front-door-instance","text":"Azure.FrontDoor.State AZR-000112 Error Cost Optimization \u00b7 Front Door \u00b7 2020_06 Enable Azure Front Door instance.","title":"Enable Front Door instance"},{"location":"en/rules/Azure.FrontDoor.State/#description","text":"The operational state of a Front Door instance is configurable, either enabled or disabled. By default, a Front Door is enabled. Optionally, a Front Door instance may be disabled to temporarily prevent traffic being processed.","title":"Description"},{"location":"en/rules/Azure.FrontDoor.State/#recommendation","text":"Consider enabling Front Door service or remove the instance if it no longer required.","title":"Recommendation"},{"location":"en/rules/Azure.FrontDoor.UseWAF/","tags":["Azure.FrontDoor.UseWAF","AZR-000111"],"text":"Front Door endpoints should use WAF # Azure.FrontDoor.UseWAF AZR-000111 Error Security \u00b7 Front Door \u00b7 2020_06 Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Description # Front Door endpoints can optionally be configured with a WAF policy. When configured, every incoming request through Front Door is filtered by the WAF policy. Recommendation # Consider enabling a WAF policy on each Front Door endpoint. Links # Best practices for endpoint security on Azure Securing PaaS deployments Azure Web Application Firewall on Azure Front Door Azure deployment reference","title":"Azure.FrontDoor.UseWAF"},{"location":"en/rules/Azure.FrontDoor.UseWAF/#front-door-endpoints-should-use-waf","text":"Azure.FrontDoor.UseWAF AZR-000111 Error Security \u00b7 Front Door \u00b7 2020_06 Enable Web Application Firewall (WAF) policies on each Front Door endpoint.","title":"Front Door endpoints should use WAF"},{"location":"en/rules/Azure.FrontDoor.UseWAF/#description","text":"Front Door endpoints can optionally be configured with a WAF policy. When configured, every incoming request through Front Door is filtered by the WAF policy.","title":"Description"},{"location":"en/rules/Azure.FrontDoor.UseWAF/#recommendation","text":"Consider enabling a WAF policy on each Front Door endpoint.","title":"Recommendation"},{"location":"en/rules/Azure.FrontDoor.UseWAF/#links","text":"Best practices for endpoint security on Azure Securing PaaS deployments Azure Web Application Firewall on Azure Front Door Azure deployment reference","title":"Links"},{"location":"en/rules/Azure.FrontDoor.WAF.Enabled/","tags":["Azure.FrontDoor.WAF.Enabled","AZR-000115"],"text":"Enable Front Door WAF policy # Azure.FrontDoor.WAF.Enabled AZR-000115 Error Security \u00b7 Front Door \u00b7 2020_06 Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Description # The operational state of a Front Door WAF policy instance is configurable, either enabled or disabled. By default, a WAF policy is enabled. When disabled, incoming requests bypass the WAF policy and are sent to back ends based on routing rules. Recommendation # Consider enabling WAF policy. Links # Best practices for endpoint security on Azure Securing PaaS deployments Policy settings for Web Application Firewall on Azure Front Door Azure deployment reference","title":"Azure.FrontDoor.WAF.Enabled"},{"location":"en/rules/Azure.FrontDoor.WAF.Enabled/#enable-front-door-waf-policy","text":"Azure.FrontDoor.WAF.Enabled AZR-000115 Error Security \u00b7 Front Door \u00b7 2020_06 Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources.","title":"Enable Front Door WAF policy"},{"location":"en/rules/Azure.FrontDoor.WAF.Enabled/#description","text":"The operational state of a Front Door WAF policy instance is configurable, either enabled or disabled. By default, a WAF policy is enabled. When disabled, incoming requests bypass the WAF policy and are sent to back ends based on routing rules.","title":"Description"},{"location":"en/rules/Azure.FrontDoor.WAF.Enabled/#recommendation","text":"Consider enabling WAF policy.","title":"Recommendation"},{"location":"en/rules/Azure.FrontDoor.WAF.Enabled/#links","text":"Best practices for endpoint security on Azure Securing PaaS deployments Policy settings for Web Application Firewall on Azure Front Door Azure deployment reference","title":"Links"},{"location":"en/rules/Azure.FrontDoor.WAF.Mode/","tags":["Azure.FrontDoor.WAF.Mode","AZR-000114"],"text":"Use Front Door WAF policy in prevention mode # Azure.FrontDoor.WAF.Mode AZR-000114 Error Security \u00b7 Front Door \u00b7 2020_06 Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Description # Front Door WAF policies support two modes of operation, detection and prevention. By default, prevention is configured. Detection - monitors and logs all requests which match a WAF rule. In this mode, the WAF doesn't take action against incoming requests. To log requests, diagnostics on the Front Door instance must be configured. Protection - log and takes action against requests which match a WAF rule. The action to perform is configurable for each WAF rule. Recommendation # Consider setting Front Door WAF policy to use protection mode. Links # Best practices for endpoint security on Azure Securing PaaS deployments Policy settings for Web Application Firewall on Azure Front Door","title":"Azure.FrontDoor.WAF.Mode"},{"location":"en/rules/Azure.FrontDoor.WAF.Mode/#use-front-door-waf-policy-in-prevention-mode","text":"Azure.FrontDoor.WAF.Mode AZR-000114 Error Security \u00b7 Front Door \u00b7 2020_06 Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources.","title":"Use Front Door WAF policy in prevention mode"},{"location":"en/rules/Azure.FrontDoor.WAF.Mode/#description","text":"Front Door WAF policies support two modes of operation, detection and prevention. By default, prevention is configured. Detection - monitors and logs all requests which match a WAF rule. In this mode, the WAF doesn't take action against incoming requests. To log requests, diagnostics on the Front Door instance must be configured. Protection - log and takes action against requests which match a WAF rule. The action to perform is configurable for each WAF rule.","title":"Description"},{"location":"en/rules/Azure.FrontDoor.WAF.Mode/#recommendation","text":"Consider setting Front Door WAF policy to use protection mode.","title":"Recommendation"},{"location":"en/rules/Azure.FrontDoor.WAF.Mode/#links","text":"Best practices for endpoint security on Azure Securing PaaS deployments Policy settings for Web Application Firewall on Azure Front Door","title":"Links"},{"location":"en/rules/Azure.FrontDoor.WAF.Name/","tags":["Azure.FrontDoor.WAF.Name","AZR-000116"],"text":"Use valid Front Door WAF policy names # Azure.FrontDoor.WAF.Name AZR-000116 Error Operational Excellence \u00b7 Front Door \u00b7 2020_12 Front Door WAF policy names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Front Door Web Application Firewall (WAF) policy names are: Between 1 and 128 characters long. Letters or numbers. Start with a letter. Unique within a resource group. Recommendation # Consider using names that meet Front Door WAF policy naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Front Door WAF policy names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Tagging and resource naming","title":"Azure.FrontDoor.WAF.Name"},{"location":"en/rules/Azure.FrontDoor.WAF.Name/#use-valid-front-door-waf-policy-names","text":"Azure.FrontDoor.WAF.Name AZR-000116 Error Operational Excellence \u00b7 Front Door \u00b7 2020_12 Front Door WAF policy names should meet naming requirements.","title":"Use valid Front Door WAF policy names"},{"location":"en/rules/Azure.FrontDoor.WAF.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Front Door Web Application Firewall (WAF) policy names are: Between 1 and 128 characters long. Letters or numbers. Start with a letter. Unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.FrontDoor.WAF.Name/#recommendation","text":"Consider using names that meet Front Door WAF policy naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.FrontDoor.WAF.Name/#notes","text":"This rule does not check if Front Door WAF policy names are unique.","title":"Notes"},{"location":"en/rules/Azure.FrontDoor.WAF.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Tagging and resource naming","title":"Links"},{"location":"en/rules/Azure.Identity.UserAssignedName/","tags":["Azure.Identity.UserAssignedName","AZR-000117"],"text":"Use valid Managed Identity names # Azure.Identity.UserAssignedName AZR-000117 Error Operational Excellence \u00b7 User Assigned Managed Identity \u00b7 2021_12 Managed Identity names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Managed Identity names are: Between 3 and 128 characters long. Letters, numbers, underscores, and hyphens. Start with letters and numbers. Managed Identity names must be unique within a resource group. Recommendation # Consider using names that meet Managed Identity naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Managed Identity names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Azure.Identity.UserAssignedName"},{"location":"en/rules/Azure.Identity.UserAssignedName/#use-valid-managed-identity-names","text":"Azure.Identity.UserAssignedName AZR-000117 Error Operational Excellence \u00b7 User Assigned Managed Identity \u00b7 2021_12 Managed Identity names should meet naming requirements.","title":"Use valid Managed Identity names"},{"location":"en/rules/Azure.Identity.UserAssignedName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Managed Identity names are: Between 3 and 128 characters long. Letters, numbers, underscores, and hyphens. Start with letters and numbers. Managed Identity names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.Identity.UserAssignedName/#recommendation","text":"Consider using names that meet Managed Identity naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.Identity.UserAssignedName/#notes","text":"This rule does not check if Managed Identity names are unique.","title":"Notes"},{"location":"en/rules/Azure.Identity.UserAssignedName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Links"},{"location":"en/rules/Azure.KeyVault.AccessPolicy/","tags":["Azure.KeyVault.AccessPolicy","AZR-000118"],"text":"Limit access to Key Vault data # Azure.KeyVault.AccessPolicy AZR-000118 Error Security \u00b7 Key Vault \u00b7 2020_06 Use the principal of least privilege when assigning access to Key Vault. Description # Key Vault is a service designed to securely store sensitive items such as secrets, keys and certificates. Access Policies determine the permissions user accounts, groups or applications have to Key Vaults items. The ability for applications and administrators to get, set and list within a Key Vault is commonly required. However should only be assigned to security principals that require access. The purge permission should be rarely assigned. Recommendation # Consider assigning access to Key Vault data based on the principle of least privilege. Examples # Azure templates # To deploy key vaults access policies that pass this rule: Avoid assigning Purge and All permissions for Key Vault objects. For example: { \"comments\" : \"Create or update a Key Vault.\" , \"type\" : \"Microsoft.KeyVault/vaults\" , \"name\" : \"[parameters('vaultName')]\" , \"apiVersion\" : \"2019-09-01\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"accessPolicies\" : [ { \"objectId\" : \"<object_id>\" , \"tenantId\" : \"<tenant_id>\" , \"permissions\" : { \"secrets\" : [ \"Get\" , \"List\" , \"Set\" ] } } ], \"tenantId\" : \"[subscription().tenantId]\" , \"sku\" : { \"name\" : \"Standard\" , \"family\" : \"A\" } } } Links # Best practices to use Key Vault Azure template reference","title":"Azure.KeyVault.AccessPolicy"},{"location":"en/rules/Azure.KeyVault.AccessPolicy/#limit-access-to-key-vault-data","text":"Azure.KeyVault.AccessPolicy AZR-000118 Error Security \u00b7 Key Vault \u00b7 2020_06 Use the principal of least privilege when assigning access to Key Vault.","title":"Limit access to Key Vault data"},{"location":"en/rules/Azure.KeyVault.AccessPolicy/#description","text":"Key Vault is a service designed to securely store sensitive items such as secrets, keys and certificates. Access Policies determine the permissions user accounts, groups or applications have to Key Vaults items. The ability for applications and administrators to get, set and list within a Key Vault is commonly required. However should only be assigned to security principals that require access. The purge permission should be rarely assigned.","title":"Description"},{"location":"en/rules/Azure.KeyVault.AccessPolicy/#recommendation","text":"Consider assigning access to Key Vault data based on the principle of least privilege.","title":"Recommendation"},{"location":"en/rules/Azure.KeyVault.AccessPolicy/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.KeyVault.AccessPolicy/#azure-templates","text":"To deploy key vaults access policies that pass this rule: Avoid assigning Purge and All permissions for Key Vault objects. For example: { \"comments\" : \"Create or update a Key Vault.\" , \"type\" : \"Microsoft.KeyVault/vaults\" , \"name\" : \"[parameters('vaultName')]\" , \"apiVersion\" : \"2019-09-01\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"accessPolicies\" : [ { \"objectId\" : \"<object_id>\" , \"tenantId\" : \"<tenant_id>\" , \"permissions\" : { \"secrets\" : [ \"Get\" , \"List\" , \"Set\" ] } } ], \"tenantId\" : \"[subscription().tenantId]\" , \"sku\" : { \"name\" : \"Standard\" , \"family\" : \"A\" } } }","title":"Azure templates"},{"location":"en/rules/Azure.KeyVault.AccessPolicy/#links","text":"Best practices to use Key Vault Azure template reference","title":"Links"},{"location":"en/rules/Azure.KeyVault.AutoRotationPolicy/","tags":["Azure.KeyVault.AutoRotationPolicy","AZR-000123"],"text":"Enable Key Vault key auto-rotation # Azure.KeyVault.AutoRotationPolicy AZR-000123 Error Security \u00b7 Key Vault \u00b7 Preview \u00b7 2022_03 Key Vault keys should have auto-rotation enabled. Description # Automated key rotation in Key Vault allows users to configure Key Vault to automatically generate a new key version at a specified frequency. Key rotation is often a cause of many application outages. It's critical that the rotation of keys be scheduled and automated to ensure effectiveness. Recommendation # Consider enabling auto-rotation on keys. Examples # Configure with Azure template # To set auto-rotation for a key: Set properties.rotationPolicy.lifetimeActions[*].action.type to Rotate . Set properties.rotationPolicy.lifetimeActions[*].trigger.timeAfterCreate to the time duration after key creation to rotate. For example: { \"type\" : \"Microsoft.KeyVault/vaults/keys\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[concat(parameters('vaultName'), '/', 'key1')]\" , \"tags\" : {}, \"properties\" : { \"keyOps\" : [ \"sign\" , \"verify\" , \"wrapKey\" , \"unwrapKey\" , \"encrypt\" , \"decrypt\" ], \"keySize\" : 2048 , \"kty\" : \"RSA\" , \"rotationPolicy\" : { \"lifetimeActions\" : [ { \"action\" : { \"type\" : \"Rotate\" }, \"trigger\" : { \"timeAfterCreate\" : \"P18D\" } }, { \"action\" : { \"type\" : \"Notify\" }, \"trigger\" : { \"timeAfterCreate\" : \"P30D\" } } ] } } } Configure with Bicep # To set auto-rotation for a key: Set properties.rotationPolicy.lifetimeActions[*].action.type to Rotate . Set properties.rotationPolicy.lifetimeActions[*].trigger.timeAfterCreate to the time duration after key creation to rotate. For example: resource vaultName_key1 'Microsoft.KeyVault/vaults/keys@2021-06-01-preview' = { parent: vaultName_resource name: 'key1' tags: {} properties: { keyOps: [ 'sign' 'verify' 'wrapKey' 'unwrapKey' 'encrypt' 'decrypt' ] keySize: 2048 kty: 'RSA' rotationPolicy: { lifetimeActions: [ { action: { type: 'rotate' } trigger: { timeAfterCreate: 'P18D' } } { action: { type: 'notify' } trigger: { timeAfterCreate: 'P30D' } } ] } } } Links # Configure key auto-rotation in Azure Key Vault (preview) Operational considerations Template reference","title":"Azure.KeyVault.AutoRotationPolicy"},{"location":"en/rules/Azure.KeyVault.AutoRotationPolicy/#enable-key-vault-key-auto-rotation","text":"Azure.KeyVault.AutoRotationPolicy AZR-000123 Error Security \u00b7 Key Vault \u00b7 Preview \u00b7 2022_03 Key Vault keys should have auto-rotation enabled.","title":"Enable Key Vault key auto-rotation"},{"location":"en/rules/Azure.KeyVault.AutoRotationPolicy/#description","text":"Automated key rotation in Key Vault allows users to configure Key Vault to automatically generate a new key version at a specified frequency. Key rotation is often a cause of many application outages. It's critical that the rotation of keys be scheduled and automated to ensure effectiveness.","title":"Description"},{"location":"en/rules/Azure.KeyVault.AutoRotationPolicy/#recommendation","text":"Consider enabling auto-rotation on keys.","title":"Recommendation"},{"location":"en/rules/Azure.KeyVault.AutoRotationPolicy/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.KeyVault.AutoRotationPolicy/#configure-with-azure-template","text":"To set auto-rotation for a key: Set properties.rotationPolicy.lifetimeActions[*].action.type to Rotate . Set properties.rotationPolicy.lifetimeActions[*].trigger.timeAfterCreate to the time duration after key creation to rotate. For example: { \"type\" : \"Microsoft.KeyVault/vaults/keys\" , \"apiVersion\" : \"2021-06-01-preview\" , \"name\" : \"[concat(parameters('vaultName'), '/', 'key1')]\" , \"tags\" : {}, \"properties\" : { \"keyOps\" : [ \"sign\" , \"verify\" , \"wrapKey\" , \"unwrapKey\" , \"encrypt\" , \"decrypt\" ], \"keySize\" : 2048 , \"kty\" : \"RSA\" , \"rotationPolicy\" : { \"lifetimeActions\" : [ { \"action\" : { \"type\" : \"Rotate\" }, \"trigger\" : { \"timeAfterCreate\" : \"P18D\" } }, { \"action\" : { \"type\" : \"Notify\" }, \"trigger\" : { \"timeAfterCreate\" : \"P30D\" } } ] } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.KeyVault.AutoRotationPolicy/#configure-with-bicep","text":"To set auto-rotation for a key: Set properties.rotationPolicy.lifetimeActions[*].action.type to Rotate . Set properties.rotationPolicy.lifetimeActions[*].trigger.timeAfterCreate to the time duration after key creation to rotate. For example: resource vaultName_key1 'Microsoft.KeyVault/vaults/keys@2021-06-01-preview' = { parent: vaultName_resource name: 'key1' tags: {} properties: { keyOps: [ 'sign' 'verify' 'wrapKey' 'unwrapKey' 'encrypt' 'decrypt' ] keySize: 2048 kty: 'RSA' rotationPolicy: { lifetimeActions: [ { action: { type: 'rotate' } trigger: { timeAfterCreate: 'P18D' } } { action: { type: 'notify' } trigger: { timeAfterCreate: 'P30D' } } ] } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.KeyVault.AutoRotationPolicy/#links","text":"Configure key auto-rotation in Azure Key Vault (preview) Operational considerations Template reference","title":"Links"},{"location":"en/rules/Azure.KeyVault.KeyName/","tags":["Azure.KeyVault.KeyName","AZR-000122"],"text":"Use valid Key Vault Key names # Azure.KeyVault.KeyName AZR-000122 Error Operational Excellence \u00b7 Key Vault \u00b7 2021_03 Key Vault Key names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Key Vault Key names are: Between 1 and 127 characters long. Alphanumerics and hyphens (dash). Keys must be unique within a Key Vault. Recommendation # Consider using key names that meet Key Vault naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Key names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Tagging and resource naming","title":"Azure.KeyVault.KeyName"},{"location":"en/rules/Azure.KeyVault.KeyName/#use-valid-key-vault-key-names","text":"Azure.KeyVault.KeyName AZR-000122 Error Operational Excellence \u00b7 Key Vault \u00b7 2021_03 Key Vault Key names should meet naming requirements.","title":"Use valid Key Vault Key names"},{"location":"en/rules/Azure.KeyVault.KeyName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Key Vault Key names are: Between 1 and 127 characters long. Alphanumerics and hyphens (dash). Keys must be unique within a Key Vault.","title":"Description"},{"location":"en/rules/Azure.KeyVault.KeyName/#recommendation","text":"Consider using key names that meet Key Vault naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.KeyVault.KeyName/#notes","text":"This rule does not check if Key names are unique.","title":"Notes"},{"location":"en/rules/Azure.KeyVault.KeyName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Tagging and resource naming","title":"Links"},{"location":"en/rules/Azure.KeyVault.Logs/","tags":["Azure.KeyVault.Logs","AZR-000119"],"text":"Audit Key Vault data access # Azure.KeyVault.Logs AZR-000119 Error Security \u00b7 Key Vault \u00b7 2020_06 Audit and monitor access to Key Vault data. Description # To capture access to Key Vault data, diagnostic settings must be configured. When configuring diagnostics settings enable access logs. Management operations for Key Vault is captured automatically within Azure Activity Logs. Recommendation # Consider configuring diagnostic settings to log access for Key Vault data. Also consider, storing the access data into Azure Monitor and using Key Vault Analytics. Examples # Configure with Azure template # To deploy key vaults that pass this rule: Deploy a diagnostic settings sub-resource. Enable logging for the AuditEvent category. For example: { \"comments\" : \"Create or update a Key Vault.\" , \"type\" : \"Microsoft.KeyVault/vaults\" , \"name\" : \"[parameters('vaultName')]\" , \"apiVersion\" : \"2019-09-01\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"accessPolicies\" : [], \"tenantId\" : \"[subscription().tenantId]\" , \"sku\" : { \"name\" : \"Standard\" , \"family\" : \"A\" } }, \"resources\" : [ { \"comments\" : \"Enable monitoring of Key Vault operations.\" , \"type\" : \"Microsoft.KeyVault/vaults/providers/diagnosticSettings\" , \"name\" : \"[concat(parameters('vaultName'), '/Microsoft.Insights/service')]\" , \"apiVersion\" : \"2016-09-01\" , \"location\" : \"[parameters('location')]\" , \"dependsOn\" : [ \"[concat('Microsoft.KeyVault/vaults/', parameters('vaultName'))]\" ], \"properties\" : { \"workspaceId\" : \"[parameters('workspaceId')]\" , \"logs\" : [ { \"category\" : \"AuditEvent\" , \"enabled\" : true } ] } } ] } Links # Best practices to use Key Vault Azure Key Vault logging Azure Key Vault security Monitoring your key vault service with Azure Monitor for Key Vault","title":"Azure.KeyVault.Logs"},{"location":"en/rules/Azure.KeyVault.Logs/#audit-key-vault-data-access","text":"Azure.KeyVault.Logs AZR-000119 Error Security \u00b7 Key Vault \u00b7 2020_06 Audit and monitor access to Key Vault data.","title":"Audit Key Vault data access"},{"location":"en/rules/Azure.KeyVault.Logs/#description","text":"To capture access to Key Vault data, diagnostic settings must be configured. When configuring diagnostics settings enable access logs. Management operations for Key Vault is captured automatically within Azure Activity Logs.","title":"Description"},{"location":"en/rules/Azure.KeyVault.Logs/#recommendation","text":"Consider configuring diagnostic settings to log access for Key Vault data. Also consider, storing the access data into Azure Monitor and using Key Vault Analytics.","title":"Recommendation"},{"location":"en/rules/Azure.KeyVault.Logs/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.KeyVault.Logs/#configure-with-azure-template","text":"To deploy key vaults that pass this rule: Deploy a diagnostic settings sub-resource. Enable logging for the AuditEvent category. For example: { \"comments\" : \"Create or update a Key Vault.\" , \"type\" : \"Microsoft.KeyVault/vaults\" , \"name\" : \"[parameters('vaultName')]\" , \"apiVersion\" : \"2019-09-01\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"accessPolicies\" : [], \"tenantId\" : \"[subscription().tenantId]\" , \"sku\" : { \"name\" : \"Standard\" , \"family\" : \"A\" } }, \"resources\" : [ { \"comments\" : \"Enable monitoring of Key Vault operations.\" , \"type\" : \"Microsoft.KeyVault/vaults/providers/diagnosticSettings\" , \"name\" : \"[concat(parameters('vaultName'), '/Microsoft.Insights/service')]\" , \"apiVersion\" : \"2016-09-01\" , \"location\" : \"[parameters('location')]\" , \"dependsOn\" : [ \"[concat('Microsoft.KeyVault/vaults/', parameters('vaultName'))]\" ], \"properties\" : { \"workspaceId\" : \"[parameters('workspaceId')]\" , \"logs\" : [ { \"category\" : \"AuditEvent\" , \"enabled\" : true } ] } } ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.KeyVault.Logs/#links","text":"Best practices to use Key Vault Azure Key Vault logging Azure Key Vault security Monitoring your key vault service with Azure Monitor for Key Vault","title":"Links"},{"location":"en/rules/Azure.KeyVault.Name/","tags":["Azure.KeyVault.Name","AZR-000120"],"text":"Use valid Key Vault names # Azure.KeyVault.Name AZR-000120 Error Operational Excellence \u00b7 Key Vault \u00b7 2021_03 Key Vault names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Key Vault names are: Between 3 and 24 characters long. Alphanumerics and hyphens (dash). Start with a letter. End with a letter or digit. Can not contain consecutive hyphens. Key Vault names must be globally unique. Recommendation # Consider using names that meet Key Vault naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Key Vault names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Tagging and resource naming","title":"Azure.KeyVault.Name"},{"location":"en/rules/Azure.KeyVault.Name/#use-valid-key-vault-names","text":"Azure.KeyVault.Name AZR-000120 Error Operational Excellence \u00b7 Key Vault \u00b7 2021_03 Key Vault names should meet naming requirements.","title":"Use valid Key Vault names"},{"location":"en/rules/Azure.KeyVault.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Key Vault names are: Between 3 and 24 characters long. Alphanumerics and hyphens (dash). Start with a letter. End with a letter or digit. Can not contain consecutive hyphens. Key Vault names must be globally unique.","title":"Description"},{"location":"en/rules/Azure.KeyVault.Name/#recommendation","text":"Consider using names that meet Key Vault naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.KeyVault.Name/#notes","text":"This rule does not check if Key Vault names are unique.","title":"Notes"},{"location":"en/rules/Azure.KeyVault.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Tagging and resource naming","title":"Links"},{"location":"en/rules/Azure.KeyVault.PurgeProtect/","tags":["Azure.KeyVault.PurgeProtect","AZR-000125"],"text":"Use Key Vault Purge Protection # Azure.KeyVault.PurgeProtect AZR-000125 Error Reliability \u00b7 Key Vault \u00b7 2020_06 Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Description # Purge Protection is a feature of Key Vault that prevents purging of vaults and vault items. When soft delete is configured without purge protection, deleted vaults and vault items can be purged. Purging deletes the vault and/ or vault items immediately, and is irreversible. When purge protection is enabled, vaults and vault items can no longer be purged. Deleted vaults and vault items will be recoverable until the configured retention period. By default, the retention period is 90 days. Purge protection is not enabled by default. Recommendation # Consider enabling purge protection on Key Vaults to enforce retention of vaults and vault items for up to 90 days. Examples # Configure with Azure template # To deploy Key Vaults that pass this rule: Set the properties.enablePurgeProtection property to true . For example: { \"type\" : \"Microsoft.KeyVault/vaults\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"sku\" : { \"family\" : \"A\" , \"name\" : \"premium\" }, \"tenantId\" : \"[subscription().tenantId]\" , \"enableSoftDelete\" : true , \"softDeleteRetentionInDays\" : 90 , \"enablePurgeProtection\" : true } } Configure with Bicep # To deploy Key Vaults that pass this rule: Set the properties.enablePurgeProtection property to true . For example: resource vault 'Microsoft.KeyVault/vaults@2021-10-01' = { name: name location: location properties: { sku: { family: 'A' name: 'premium' } tenantId: subscription().tenantId enableSoftDelete: true softDeleteRetentionInDays: 90 enablePurgeProtection: true } } Links # Azure Key Vault soft-delete overview Azure Key Vault security Azure template reference","title":"Azure.KeyVault.PurgeProtect"},{"location":"en/rules/Azure.KeyVault.PurgeProtect/#use-key-vault-purge-protection","text":"Azure.KeyVault.PurgeProtect AZR-000125 Error Reliability \u00b7 Key Vault \u00b7 2020_06 Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items.","title":"Use Key Vault Purge Protection"},{"location":"en/rules/Azure.KeyVault.PurgeProtect/#description","text":"Purge Protection is a feature of Key Vault that prevents purging of vaults and vault items. When soft delete is configured without purge protection, deleted vaults and vault items can be purged. Purging deletes the vault and/ or vault items immediately, and is irreversible. When purge protection is enabled, vaults and vault items can no longer be purged. Deleted vaults and vault items will be recoverable until the configured retention period. By default, the retention period is 90 days. Purge protection is not enabled by default.","title":"Description"},{"location":"en/rules/Azure.KeyVault.PurgeProtect/#recommendation","text":"Consider enabling purge protection on Key Vaults to enforce retention of vaults and vault items for up to 90 days.","title":"Recommendation"},{"location":"en/rules/Azure.KeyVault.PurgeProtect/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.KeyVault.PurgeProtect/#configure-with-azure-template","text":"To deploy Key Vaults that pass this rule: Set the properties.enablePurgeProtection property to true . For example: { \"type\" : \"Microsoft.KeyVault/vaults\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"sku\" : { \"family\" : \"A\" , \"name\" : \"premium\" }, \"tenantId\" : \"[subscription().tenantId]\" , \"enableSoftDelete\" : true , \"softDeleteRetentionInDays\" : 90 , \"enablePurgeProtection\" : true } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.KeyVault.PurgeProtect/#configure-with-bicep","text":"To deploy Key Vaults that pass this rule: Set the properties.enablePurgeProtection property to true . For example: resource vault 'Microsoft.KeyVault/vaults@2021-10-01' = { name: name location: location properties: { sku: { family: 'A' name: 'premium' } tenantId: subscription().tenantId enableSoftDelete: true softDeleteRetentionInDays: 90 enablePurgeProtection: true } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.KeyVault.PurgeProtect/#links","text":"Azure Key Vault soft-delete overview Azure Key Vault security Azure template reference","title":"Links"},{"location":"en/rules/Azure.KeyVault.SecretName/","tags":["Azure.KeyVault.SecretName","AZR-000121"],"text":"Use valid Key Vault Secret names # Azure.KeyVault.SecretName AZR-000121 Error Operational Excellence \u00b7 Key Vault \u00b7 2021_03 Key Vault Secret names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Key Vault Secret names are: Between 1 and 127 characters long. Alphanumerics and hyphens (dash). Secrets must be unique within a Key Vault. Recommendation # Consider using secret names that meet Key Vault naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Secret names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Tagging and resource naming","title":"Azure.KeyVault.SecretName"},{"location":"en/rules/Azure.KeyVault.SecretName/#use-valid-key-vault-secret-names","text":"Azure.KeyVault.SecretName AZR-000121 Error Operational Excellence \u00b7 Key Vault \u00b7 2021_03 Key Vault Secret names should meet naming requirements.","title":"Use valid Key Vault Secret names"},{"location":"en/rules/Azure.KeyVault.SecretName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Key Vault Secret names are: Between 1 and 127 characters long. Alphanumerics and hyphens (dash). Secrets must be unique within a Key Vault.","title":"Description"},{"location":"en/rules/Azure.KeyVault.SecretName/#recommendation","text":"Consider using secret names that meet Key Vault naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.KeyVault.SecretName/#notes","text":"This rule does not check if Secret names are unique.","title":"Notes"},{"location":"en/rules/Azure.KeyVault.SecretName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Tagging and resource naming","title":"Links"},{"location":"en/rules/Azure.KeyVault.SoftDelete/","tags":["Azure.KeyVault.SoftDelete","AZR-000124"],"text":"Use Key Vault Soft Delete # Azure.KeyVault.SoftDelete AZR-000124 Error Reliability \u00b7 Key Vault \u00b7 2020_06 Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Description # Soft Delete is a feature of Key Vault that retains Key Vaults and Key Vault items after initial deletion. A soft deleted vault or vault item can be restored within the configured retention period. By default, new Key Vaults created through the portal will have soft delete for 90 days configured. Once enabled, soft delete can not be disabled. When soft delete is enabled, it is possible to purge soft deleted vaults and vault items. Recommendation # Consider enabling soft delete on Key Vaults to enable recovery of vaults and vault items. Examples # Configure with Azure template # To deploy Key Vaults that pass this rule: Set the properties.enableSoftDelete property to true . For example: { \"type\" : \"Microsoft.KeyVault/vaults\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"sku\" : { \"family\" : \"A\" , \"name\" : \"premium\" }, \"tenantId\" : \"[subscription().tenantId]\" , \"enableSoftDelete\" : true , \"softDeleteRetentionInDays\" : 90 , \"enablePurgeProtection\" : true } } Configure with Bicep # To deploy Key Vaults that pass this rule: Set the properties.enableSoftDelete property to true . For example: resource vault 'Microsoft.KeyVault/vaults@2021-10-01' = { name: name location: location properties: { sku: { family: 'A' name: 'premium' } tenantId: subscription().tenantId enableSoftDelete: true softDeleteRetentionInDays: 90 enablePurgeProtection: true } } Links # Azure Key Vault soft-delete overview Azure Key Vault security Azure template reference","title":"Azure.KeyVault.SoftDelete"},{"location":"en/rules/Azure.KeyVault.SoftDelete/#use-key-vault-soft-delete","text":"Azure.KeyVault.SoftDelete AZR-000124 Error Reliability \u00b7 Key Vault \u00b7 2020_06 Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion.","title":"Use Key Vault Soft Delete"},{"location":"en/rules/Azure.KeyVault.SoftDelete/#description","text":"Soft Delete is a feature of Key Vault that retains Key Vaults and Key Vault items after initial deletion. A soft deleted vault or vault item can be restored within the configured retention period. By default, new Key Vaults created through the portal will have soft delete for 90 days configured. Once enabled, soft delete can not be disabled. When soft delete is enabled, it is possible to purge soft deleted vaults and vault items.","title":"Description"},{"location":"en/rules/Azure.KeyVault.SoftDelete/#recommendation","text":"Consider enabling soft delete on Key Vaults to enable recovery of vaults and vault items.","title":"Recommendation"},{"location":"en/rules/Azure.KeyVault.SoftDelete/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.KeyVault.SoftDelete/#configure-with-azure-template","text":"To deploy Key Vaults that pass this rule: Set the properties.enableSoftDelete property to true . For example: { \"type\" : \"Microsoft.KeyVault/vaults\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"sku\" : { \"family\" : \"A\" , \"name\" : \"premium\" }, \"tenantId\" : \"[subscription().tenantId]\" , \"enableSoftDelete\" : true , \"softDeleteRetentionInDays\" : 90 , \"enablePurgeProtection\" : true } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.KeyVault.SoftDelete/#configure-with-bicep","text":"To deploy Key Vaults that pass this rule: Set the properties.enableSoftDelete property to true . For example: resource vault 'Microsoft.KeyVault/vaults@2021-10-01' = { name: name location: location properties: { sku: { family: 'A' name: 'premium' } tenantId: subscription().tenantId enableSoftDelete: true softDeleteRetentionInDays: 90 enablePurgeProtection: true } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.KeyVault.SoftDelete/#links","text":"Azure Key Vault soft-delete overview Azure Key Vault security Azure template reference","title":"Links"},{"location":"en/rules/Azure.LB.AvailabilityZone/","tags":["Azure.LB.AvailabilityZone","AZR-000127"],"text":"Load balancers should be zone-redundant # Azure.LB.AvailabilityZone AZR-000127 Error Reliability \u00b7 Load Balancer \u00b7 2021_09 Load balancers deployed with Standard SKU should be zone-redundant for high availability. Description # Load balancers using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. A single zone redundant frontend IP address will survive zone failure. The frontend IP may be used to reach all (non-impacted) backend pool members no matter the zone. One or more availability zones can fail and the data path survives as long as one zone in the region remains healthy. Recommendation # Consider using zone-redundant load balancers deployed with Standard SKU. Notes # This rule applies when analyzing resources deployed to Azure using pre-flight and in-flight data. This rule fails when \"zones\" is constrained to a single(zonal) zone, and passes when set to null , [] or [\"1\", \"2\", \"3\"] . Examples # Configure with Azure template # To configure zone-redundancy for a load balancer. Set sku.name to Standard . Set properties.frontendIPConfigurations[*].zones to [\"1\", \"2\", \"3\"] . For example: { \"apiVersion\" : \"2020-07-01\" , \"name\" : \"[parameters('name')]\" , \"type\" : \"Microsoft.Network/loadBalancers\" , \"location\" : \"[parameters('location')]\" , \"dependsOn\" : [], \"tags\" : {}, \"properties\" : { \"frontendIPConfigurations\" : [ { \"name\" : \"frontend-ip-config\" , \"properties\" : { \"privateIPAddress\" : null , \"privateIPAddressVersion\" : \"IPv4\" , \"privateIPAllocationMethod\" : \"Dynamic\" , \"subnet\" : { \"id\" : \"/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/lb-rg/providers/Microsoft.Network/virtualNetworks/lb-vnet/subnets/default\" } }, \"zones\" : [ \"1\" , \"2\" , \"3\" ] } ], \"backendAddressPools\" : [], \"probes\" : [], \"loadBalancingRules\" : [], \"inboundNatRules\" : [], \"outboundRules\" : [] }, \"sku\" : { \"name\" : \"[parameters('sku')]\" , \"tier\" : \"[parameters('tier')]\" } } Configure with Bicep # To configure zone-redundancy for a load balancer. Set sku.name to Standard . Set properties.frontendIPConfigurations[*].zones to ['1', '2', '3'] . For example: resource lb_001 'Microsoft.Network/loadBalancers@2021-02-01' = { name: lbName location: location sku: { name: 'Standard' } properties: { frontendIPConfigurations: [ { name: 'frontendIPConfig' properties: { privateIPAllocationMethod: 'Dynamic' subnet: { id: vnet.properties.subnets[1].id } } zones: [ '1' '2' '3' ] } ] } } Links # Azure template reference Load Balancer and Availability Zones Use zone-aware services","title":"Azure.LB.AvailabilityZone"},{"location":"en/rules/Azure.LB.AvailabilityZone/#load-balancers-should-be-zone-redundant","text":"Azure.LB.AvailabilityZone AZR-000127 Error Reliability \u00b7 Load Balancer \u00b7 2021_09 Load balancers deployed with Standard SKU should be zone-redundant for high availability.","title":"Load balancers should be zone-redundant"},{"location":"en/rules/Azure.LB.AvailabilityZone/#description","text":"Load balancers using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. A single zone redundant frontend IP address will survive zone failure. The frontend IP may be used to reach all (non-impacted) backend pool members no matter the zone. One or more availability zones can fail and the data path survives as long as one zone in the region remains healthy.","title":"Description"},{"location":"en/rules/Azure.LB.AvailabilityZone/#recommendation","text":"Consider using zone-redundant load balancers deployed with Standard SKU.","title":"Recommendation"},{"location":"en/rules/Azure.LB.AvailabilityZone/#notes","text":"This rule applies when analyzing resources deployed to Azure using pre-flight and in-flight data. This rule fails when \"zones\" is constrained to a single(zonal) zone, and passes when set to null , [] or [\"1\", \"2\", \"3\"] .","title":"Notes"},{"location":"en/rules/Azure.LB.AvailabilityZone/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.LB.AvailabilityZone/#configure-with-azure-template","text":"To configure zone-redundancy for a load balancer. Set sku.name to Standard . Set properties.frontendIPConfigurations[*].zones to [\"1\", \"2\", \"3\"] . For example: { \"apiVersion\" : \"2020-07-01\" , \"name\" : \"[parameters('name')]\" , \"type\" : \"Microsoft.Network/loadBalancers\" , \"location\" : \"[parameters('location')]\" , \"dependsOn\" : [], \"tags\" : {}, \"properties\" : { \"frontendIPConfigurations\" : [ { \"name\" : \"frontend-ip-config\" , \"properties\" : { \"privateIPAddress\" : null , \"privateIPAddressVersion\" : \"IPv4\" , \"privateIPAllocationMethod\" : \"Dynamic\" , \"subnet\" : { \"id\" : \"/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/lb-rg/providers/Microsoft.Network/virtualNetworks/lb-vnet/subnets/default\" } }, \"zones\" : [ \"1\" , \"2\" , \"3\" ] } ], \"backendAddressPools\" : [], \"probes\" : [], \"loadBalancingRules\" : [], \"inboundNatRules\" : [], \"outboundRules\" : [] }, \"sku\" : { \"name\" : \"[parameters('sku')]\" , \"tier\" : \"[parameters('tier')]\" } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.LB.AvailabilityZone/#configure-with-bicep","text":"To configure zone-redundancy for a load balancer. Set sku.name to Standard . Set properties.frontendIPConfigurations[*].zones to ['1', '2', '3'] . For example: resource lb_001 'Microsoft.Network/loadBalancers@2021-02-01' = { name: lbName location: location sku: { name: 'Standard' } properties: { frontendIPConfigurations: [ { name: 'frontendIPConfig' properties: { privateIPAllocationMethod: 'Dynamic' subnet: { id: vnet.properties.subnets[1].id } } zones: [ '1' '2' '3' ] } ] } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.LB.AvailabilityZone/#links","text":"Azure template reference Load Balancer and Availability Zones Use zone-aware services","title":"Links"},{"location":"en/rules/Azure.LB.Name/","tags":["Azure.LB.Name","AZR-000129"],"text":"Use valid Load Balancer names # Azure.LB.Name AZR-000129 Error Operational Excellence \u00b7 Load Balancer \u00b7 2020_06 Load Balancer names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Load Balancer names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Load Balancer names must be unique within a resource group. Recommendation # Consider using names that meet Load Balancer naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Load Balancer names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Azure.LB.Name"},{"location":"en/rules/Azure.LB.Name/#use-valid-load-balancer-names","text":"Azure.LB.Name AZR-000129 Error Operational Excellence \u00b7 Load Balancer \u00b7 2020_06 Load Balancer names should meet naming requirements.","title":"Use valid Load Balancer names"},{"location":"en/rules/Azure.LB.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Load Balancer names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Load Balancer names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.LB.Name/#recommendation","text":"Consider using names that meet Load Balancer naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.LB.Name/#notes","text":"This rule does not check if Load Balancer names are unique.","title":"Notes"},{"location":"en/rules/Azure.LB.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Links"},{"location":"en/rules/Azure.LB.Probe/","tags":["Azure.LB.Probe","AZR-000126"],"text":"Use specific load balancer probe # Azure.LB.Probe AZR-000126 Error Reliability \u00b7 Load Balancer \u00b7 2020_06 Use a specific probe for web protocols. Description # A load balancer probe can be configured as TCP/ HTTP or HTTPS. Recommendation # Consider using a dedicated health check endpoint for HTTP or HTTPS health probes. Links # Load Balancer health probes Creating good health probes Health Endpoint Monitoring pattern","title":"Azure.LB.Probe"},{"location":"en/rules/Azure.LB.Probe/#use-specific-load-balancer-probe","text":"Azure.LB.Probe AZR-000126 Error Reliability \u00b7 Load Balancer \u00b7 2020_06 Use a specific probe for web protocols.","title":"Use specific load balancer probe"},{"location":"en/rules/Azure.LB.Probe/#description","text":"A load balancer probe can be configured as TCP/ HTTP or HTTPS.","title":"Description"},{"location":"en/rules/Azure.LB.Probe/#recommendation","text":"Consider using a dedicated health check endpoint for HTTP or HTTPS health probes.","title":"Recommendation"},{"location":"en/rules/Azure.LB.Probe/#links","text":"Load Balancer health probes Creating good health probes Health Endpoint Monitoring pattern","title":"Links"},{"location":"en/rules/Azure.LB.StandardSKU/","tags":["Azure.LB.StandardSKU","AZR-000128"],"text":"Load balancers should use Standard SKU # Azure.LB.StandardSKU AZR-000128 Error Reliability \u00b7 Load Balancer \u00b7 2021_09 Load balancers should be deployed with Standard SKU for production workloads. Description # Standard Load Balancer enables you to scale your applications and create high availability for small scale deployments to large and complex multi-zone architectures. It supports inbound as well as outbound connections, provides low latency and high throughput, and scales up to millions of flows for all TCP and UDP applications. It enables Availability Zones with zone-redundant and zonal front ends as well as cross-zone load balancing for public and internal scenarios. You can scale Network Virtual Appliance scenarios and make them more resilient by using internal HA Ports load balancing rules. It also provides new diagnostics insights with multi-dimensional metrics in Azure Monitor. Recommendation # Consider using Standard SKU for load balancers deployed in production. Examples # Configure with Azure template # To configure Standard SKU for a load balancer. Set sku.name to Standard . For example: { \"apiVersion\" : \"2020-07-01\" , \"name\" : \"[parameters('name')]\" , \"type\" : \"Microsoft.Network/loadBalancers\" , \"location\" : \"[parameters('location')]\" , \"dependsOn\" : [], \"tags\" : {}, \"properties\" : { \"frontendIPConfigurations\" : [ { \"name\" : \"frontend-ip-config\" , \"properties\" : { \"privateIPAddress\" : null , \"privateIPAddressVersion\" : \"IPv4\" , \"privateIPAllocationMethod\" : \"Dynamic\" , \"subnet\" : { \"id\" : \"/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/lb-rg/providers/Microsoft.Network/virtualNetworks/lb-vnet/subnets/default\" } }, \"zones\" : [ \"1\" , \"2\" , \"3\" ] } ], \"backendAddressPools\" : [], \"probes\" : [], \"loadBalancingRules\" : [], \"inboundNatRules\" : [], \"outboundRules\" : [] }, \"sku\" : { \"name\" : \"Standard\" , \"tier\" : \"[parameters('tier')]\" } } Configure with Bicep # To configure Standard SKU for a load balancer. Set sku.name to Standard . For example: resource lb_001 'Microsoft.Network/loadBalancers@2021-02-01' = { name: lbName location: location sku: { name: 'Standard' } properties: { frontendIPConfigurations: [ { name: 'frontendIPConfig' properties: { privateIPAllocationMethod: 'Dynamic' subnet: { id: vnet.properties.subnets[1].id } } zones: [ '1' '2' '3' ] } ] } } Links # Azure template reference Why use Azure Load Balancer? Azure Load Balancer SKUs Meet application platform requirements","title":"Azure.LB.StandardSKU"},{"location":"en/rules/Azure.LB.StandardSKU/#load-balancers-should-use-standard-sku","text":"Azure.LB.StandardSKU AZR-000128 Error Reliability \u00b7 Load Balancer \u00b7 2021_09 Load balancers should be deployed with Standard SKU for production workloads.","title":"Load balancers should use Standard SKU"},{"location":"en/rules/Azure.LB.StandardSKU/#description","text":"Standard Load Balancer enables you to scale your applications and create high availability for small scale deployments to large and complex multi-zone architectures. It supports inbound as well as outbound connections, provides low latency and high throughput, and scales up to millions of flows for all TCP and UDP applications. It enables Availability Zones with zone-redundant and zonal front ends as well as cross-zone load balancing for public and internal scenarios. You can scale Network Virtual Appliance scenarios and make them more resilient by using internal HA Ports load balancing rules. It also provides new diagnostics insights with multi-dimensional metrics in Azure Monitor.","title":"Description"},{"location":"en/rules/Azure.LB.StandardSKU/#recommendation","text":"Consider using Standard SKU for load balancers deployed in production.","title":"Recommendation"},{"location":"en/rules/Azure.LB.StandardSKU/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.LB.StandardSKU/#configure-with-azure-template","text":"To configure Standard SKU for a load balancer. Set sku.name to Standard . For example: { \"apiVersion\" : \"2020-07-01\" , \"name\" : \"[parameters('name')]\" , \"type\" : \"Microsoft.Network/loadBalancers\" , \"location\" : \"[parameters('location')]\" , \"dependsOn\" : [], \"tags\" : {}, \"properties\" : { \"frontendIPConfigurations\" : [ { \"name\" : \"frontend-ip-config\" , \"properties\" : { \"privateIPAddress\" : null , \"privateIPAddressVersion\" : \"IPv4\" , \"privateIPAllocationMethod\" : \"Dynamic\" , \"subnet\" : { \"id\" : \"/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/lb-rg/providers/Microsoft.Network/virtualNetworks/lb-vnet/subnets/default\" } }, \"zones\" : [ \"1\" , \"2\" , \"3\" ] } ], \"backendAddressPools\" : [], \"probes\" : [], \"loadBalancingRules\" : [], \"inboundNatRules\" : [], \"outboundRules\" : [] }, \"sku\" : { \"name\" : \"Standard\" , \"tier\" : \"[parameters('tier')]\" } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.LB.StandardSKU/#configure-with-bicep","text":"To configure Standard SKU for a load balancer. Set sku.name to Standard . For example: resource lb_001 'Microsoft.Network/loadBalancers@2021-02-01' = { name: lbName location: location sku: { name: 'Standard' } properties: { frontendIPConfigurations: [ { name: 'frontendIPConfig' properties: { privateIPAllocationMethod: 'Dynamic' subnet: { id: vnet.properties.subnets[1].id } } zones: [ '1' '2' '3' ] } ] } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.LB.StandardSKU/#links","text":"Azure template reference Why use Azure Load Balancer? Azure Load Balancer SKUs Meet application platform requirements","title":"Links"},{"location":"en/rules/Azure.LogicApp.LimitHTTPTrigger/","tags":["Azure.LogicApp.LimitHTTPTrigger","AZR-000130"],"text":"Limit Logic App HTTP request triggers # Azure.LogicApp.LimitHTTPTrigger AZR-000130 Error Security \u00b7 Logic App \u00b7 2020_12 Limit HTTP request trigger access to trusted IP addresses. Description # When a Logic App uses a HTTP request trigger by default any source IP address can trigger the workflow. Logic Apps can be configured to limit the IP addresses that are accepted to trigger the workflow. Recommendation # Consider limiting Logic Apps with HTTP request triggers to trusted IP addresses. Links # Secure access and data in Azure Logic Apps Azure security baseline for Logic Apps","title":"Azure.LogicApp.LimitHTTPTrigger"},{"location":"en/rules/Azure.LogicApp.LimitHTTPTrigger/#limit-logic-app-http-request-triggers","text":"Azure.LogicApp.LimitHTTPTrigger AZR-000130 Error Security \u00b7 Logic App \u00b7 2020_12 Limit HTTP request trigger access to trusted IP addresses.","title":"Limit Logic App HTTP request triggers"},{"location":"en/rules/Azure.LogicApp.LimitHTTPTrigger/#description","text":"When a Logic App uses a HTTP request trigger by default any source IP address can trigger the workflow. Logic Apps can be configured to limit the IP addresses that are accepted to trigger the workflow.","title":"Description"},{"location":"en/rules/Azure.LogicApp.LimitHTTPTrigger/#recommendation","text":"Consider limiting Logic Apps with HTTP request triggers to trusted IP addresses.","title":"Recommendation"},{"location":"en/rules/Azure.LogicApp.LimitHTTPTrigger/#links","text":"Secure access and data in Azure Logic Apps Azure security baseline for Logic Apps","title":"Links"},{"location":"en/rules/Azure.Monitor.ServiceHealth/","tags":["Azure.Monitor.ServiceHealth","AZR-000211"],"text":"Alert on service events # Azure.Monitor.ServiceHealth AZR-000211 Error Operational Excellence \u00b7 Monitor \u00b7 2020_06 Configure Service Health alerts to notify administrators. Description # Azure provides events and can alert administrators when one of the following occurs in your subscriptions: Service issue Planned maintenance Health advisories Security advisory Recommendation # Consider configuring an alert to notify administrators when services you are using are potentially impacted. Links # Service Health overview Create activity log alerts on service notifications","title":"Azure.Monitor.ServiceHealth"},{"location":"en/rules/Azure.Monitor.ServiceHealth/#alert-on-service-events","text":"Azure.Monitor.ServiceHealth AZR-000211 Error Operational Excellence \u00b7 Monitor \u00b7 2020_06 Configure Service Health alerts to notify administrators.","title":"Alert on service events"},{"location":"en/rules/Azure.Monitor.ServiceHealth/#description","text":"Azure provides events and can alert administrators when one of the following occurs in your subscriptions: Service issue Planned maintenance Health advisories Security advisory","title":"Description"},{"location":"en/rules/Azure.Monitor.ServiceHealth/#recommendation","text":"Consider configuring an alert to notify administrators when services you are using are potentially impacted.","title":"Recommendation"},{"location":"en/rules/Azure.Monitor.ServiceHealth/#links","text":"Service Health overview Create activity log alerts on service notifications","title":"Links"},{"location":"en/rules/Azure.MySQL.AllowAzureAccess/","tags":["Azure.MySQL.AllowAzureAccess","AZR-000134"],"text":"Disable MySQL Allow Azure access firewall rule # Azure.MySQL.AllowAzureAccess AZR-000134 Error Security \u00b7 Azure Database for MySQL \u00b7 2020_06 Determine if access from Azure services is required. Description # Allow access to Azure services, permits any Azure service including other Azure customers, network based-access to databases on the same MySQL server instance. If network based access is permitted, authentication is still required. Enabling access from Azure Services is useful in certain cases for serverless PaaS workloads where configuring a stable IP address is not possible. For example Azure Functions, Container Instances and Logic Apps. Recommendation # Where a stable IP addresses are able to be configured, configure IP or virtual network based firewall rules instead of using Allow access to Azure services. Determine if access from Azure services is required for the services connecting to the hosted databases. Links # Azure Database for MySQL server firewall rules","title":"Azure.MySQL.AllowAzureAccess"},{"location":"en/rules/Azure.MySQL.AllowAzureAccess/#disable-mysql-allow-azure-access-firewall-rule","text":"Azure.MySQL.AllowAzureAccess AZR-000134 Error Security \u00b7 Azure Database for MySQL \u00b7 2020_06 Determine if access from Azure services is required.","title":"Disable MySQL Allow Azure access firewall rule"},{"location":"en/rules/Azure.MySQL.AllowAzureAccess/#description","text":"Allow access to Azure services, permits any Azure service including other Azure customers, network based-access to databases on the same MySQL server instance. If network based access is permitted, authentication is still required. Enabling access from Azure Services is useful in certain cases for serverless PaaS workloads where configuring a stable IP address is not possible. For example Azure Functions, Container Instances and Logic Apps.","title":"Description"},{"location":"en/rules/Azure.MySQL.AllowAzureAccess/#recommendation","text":"Where a stable IP addresses are able to be configured, configure IP or virtual network based firewall rules instead of using Allow access to Azure services. Determine if access from Azure services is required for the services connecting to the hosted databases.","title":"Recommendation"},{"location":"en/rules/Azure.MySQL.AllowAzureAccess/#links","text":"Azure Database for MySQL server firewall rules","title":"Links"},{"location":"en/rules/Azure.MySQL.FirewallIPRange/","tags":["Azure.MySQL.FirewallIPRange","AZR-000135"],"text":"Limit MySQL server firewall rule range # Azure.MySQL.FirewallIPRange AZR-000135 Error Security \u00b7 Azure Database for MySQL \u00b7 2020_06 Determine if there is an excessive number of permitted IP addresses. Description # Typically the number of IP address rules permitted through the firewall is minimal, with management connectivity from on-premises and cloud application connectivity the most common. Recommendation # The MySQL server has greater then ten (10) public IP addresses that are permitted network access. Some rules may not be needed or can be reduced. Links # Create and manage Azure Database for MySQL firewall rules by using the Azure portal Create and manage Azure Database for MySQL VNet service endpoints and VNet rules by using the Azure portal","title":"Azure.MySQL.FirewallIPRange"},{"location":"en/rules/Azure.MySQL.FirewallIPRange/#limit-mysql-server-firewall-rule-range","text":"Azure.MySQL.FirewallIPRange AZR-000135 Error Security \u00b7 Azure Database for MySQL \u00b7 2020_06 Determine if there is an excessive number of permitted IP addresses.","title":"Limit MySQL server firewall rule range"},{"location":"en/rules/Azure.MySQL.FirewallIPRange/#description","text":"Typically the number of IP address rules permitted through the firewall is minimal, with management connectivity from on-premises and cloud application connectivity the most common.","title":"Description"},{"location":"en/rules/Azure.MySQL.FirewallIPRange/#recommendation","text":"The MySQL server has greater then ten (10) public IP addresses that are permitted network access. Some rules may not be needed or can be reduced.","title":"Recommendation"},{"location":"en/rules/Azure.MySQL.FirewallIPRange/#links","text":"Create and manage Azure Database for MySQL firewall rules by using the Azure portal Create and manage Azure Database for MySQL VNet service endpoints and VNet rules by using the Azure portal","title":"Links"},{"location":"en/rules/Azure.MySQL.FirewallRuleCount/","tags":["Azure.MySQL.FirewallRuleCount","AZR-000133"],"text":"Cleanup MySQL server firewall rules # Azure.MySQL.FirewallRuleCount AZR-000133 Error Security \u00b7 Azure Database for MySQL \u00b7 2020_06 Determine if there is an excessive number of firewall rules. Description # Typically the number of firewall rules required is minimal, with management connectivity from on-premises and cloud application connectivity the most common. Recommendation # The MySQL server has greater then ten (10) firewall rules. Some rules may not be needed. Links # Create and manage Azure Database for MySQL firewall rules by using the Azure portal Create and manage Azure Database for MySQL VNet service endpoints and VNet rules by using the Azure portal","title":"Azure.MySQL.FirewallRuleCount"},{"location":"en/rules/Azure.MySQL.FirewallRuleCount/#cleanup-mysql-server-firewall-rules","text":"Azure.MySQL.FirewallRuleCount AZR-000133 Error Security \u00b7 Azure Database for MySQL \u00b7 2020_06 Determine if there is an excessive number of firewall rules.","title":"Cleanup MySQL server firewall rules"},{"location":"en/rules/Azure.MySQL.FirewallRuleCount/#description","text":"Typically the number of firewall rules required is minimal, with management connectivity from on-premises and cloud application connectivity the most common.","title":"Description"},{"location":"en/rules/Azure.MySQL.FirewallRuleCount/#recommendation","text":"The MySQL server has greater then ten (10) firewall rules. Some rules may not be needed.","title":"Recommendation"},{"location":"en/rules/Azure.MySQL.FirewallRuleCount/#links","text":"Create and manage Azure Database for MySQL firewall rules by using the Azure portal Create and manage Azure Database for MySQL VNet service endpoints and VNet rules by using the Azure portal","title":"Links"},{"location":"en/rules/Azure.MySQL.MinTLS/","tags":["Azure.MySQL.MinTLS","AZR-000132"],"text":"MySQL DB server minimum TLS version # Azure.MySQL.MinTLS AZR-000132 Error Security \u00b7 Azure Database for MySQL \u00b7 2020_09 MySQL DB servers should reject TLS versions older than 1.2. Description # The minimum version of TLS that MySQL DB servers accept is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted. Recommendation # Consider configuring the minimum supported TLS version to be 1.2. Links # Data encryption in Azure TLS enforcement in Azure Database for MySQL Set TLS configurations for Azure Database for MySQL Preparing for TLS 1.2 in Microsoft Azure Azure deployment reference","title":"Azure.MySQL.MinTLS"},{"location":"en/rules/Azure.MySQL.MinTLS/#mysql-db-server-minimum-tls-version","text":"Azure.MySQL.MinTLS AZR-000132 Error Security \u00b7 Azure Database for MySQL \u00b7 2020_09 MySQL DB servers should reject TLS versions older than 1.2.","title":"MySQL DB server minimum TLS version"},{"location":"en/rules/Azure.MySQL.MinTLS/#description","text":"The minimum version of TLS that MySQL DB servers accept is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted.","title":"Description"},{"location":"en/rules/Azure.MySQL.MinTLS/#recommendation","text":"Consider configuring the minimum supported TLS version to be 1.2.","title":"Recommendation"},{"location":"en/rules/Azure.MySQL.MinTLS/#links","text":"Data encryption in Azure TLS enforcement in Azure Database for MySQL Set TLS configurations for Azure Database for MySQL Preparing for TLS 1.2 in Microsoft Azure Azure deployment reference","title":"Links"},{"location":"en/rules/Azure.MySQL.ServerName/","tags":["Azure.MySQL.ServerName","AZR-000136"],"text":"Use valid MySQL DB server names # Azure.MySQL.ServerName AZR-000136 Error Operational Excellence \u00b7 Azure Database for MySQL \u00b7 2020_12 Azure MySQL DB server names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for MySQL DB server names are: Between 3 and 63 characters long. Lowercase letters, numbers, and hyphens. Can't start or end with a hyphen. MySQL DB server names must be globally unique. Recommendation # Consider using names that meet Azure MySQL DB server naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Azure MySQL DB server names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.MySQL.ServerName"},{"location":"en/rules/Azure.MySQL.ServerName/#use-valid-mysql-db-server-names","text":"Azure.MySQL.ServerName AZR-000136 Error Operational Excellence \u00b7 Azure Database for MySQL \u00b7 2020_12 Azure MySQL DB server names should meet naming requirements.","title":"Use valid MySQL DB server names"},{"location":"en/rules/Azure.MySQL.ServerName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for MySQL DB server names are: Between 3 and 63 characters long. Lowercase letters, numbers, and hyphens. Can't start or end with a hyphen. MySQL DB server names must be globally unique.","title":"Description"},{"location":"en/rules/Azure.MySQL.ServerName/#recommendation","text":"Consider using names that meet Azure MySQL DB server naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.MySQL.ServerName/#notes","text":"This rule does not check if Azure MySQL DB server names are unique.","title":"Notes"},{"location":"en/rules/Azure.MySQL.ServerName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.MySQL.UseSSL/","tags":["Azure.MySQL.UseSSL","AZR-000131"],"text":"Enforce encrypted MySQL connections # Azure.MySQL.UseSSL AZR-000131 Error Security \u00b7 Azure Database for MySQL \u00b7 2020_06 Enforce encrypted MySQL connections. Description # Azure Database for MySQL is configured to only accept encrypted connections by default. When the setting enforce SSL connections is disabled, encrypted and unencrypted connections are permitted. This does not indicate that unencrypted connections are being used. Unencrypted communication to MySQL server instances could allow disclosure of information to an untrusted party. Recommendation # Azure Database for MySQL should be configured to only accept encrypted connections. Unless explicitly required, consider enabling enforce SSL connections . Also consider using Azure Policy to audit or enforce this configuration. Links # Data encryption in Azure SSL connectivity in Azure Database for MySQL","title":"Azure.MySQL.UseSSL"},{"location":"en/rules/Azure.MySQL.UseSSL/#enforce-encrypted-mysql-connections","text":"Azure.MySQL.UseSSL AZR-000131 Error Security \u00b7 Azure Database for MySQL \u00b7 2020_06 Enforce encrypted MySQL connections.","title":"Enforce encrypted MySQL connections"},{"location":"en/rules/Azure.MySQL.UseSSL/#description","text":"Azure Database for MySQL is configured to only accept encrypted connections by default. When the setting enforce SSL connections is disabled, encrypted and unencrypted connections are permitted. This does not indicate that unencrypted connections are being used. Unencrypted communication to MySQL server instances could allow disclosure of information to an untrusted party.","title":"Description"},{"location":"en/rules/Azure.MySQL.UseSSL/#recommendation","text":"Azure Database for MySQL should be configured to only accept encrypted connections. Unless explicitly required, consider enabling enforce SSL connections . Also consider using Azure Policy to audit or enforce this configuration.","title":"Recommendation"},{"location":"en/rules/Azure.MySQL.UseSSL/#links","text":"Data encryption in Azure SSL connectivity in Azure Database for MySQL","title":"Links"},{"location":"en/rules/Azure.NSG.AnyInboundSource/","tags":["Azure.NSG.AnyInboundSource","AZR-000137"],"text":"Avoid rules that allow any inbound source # Azure.NSG.AnyInboundSource AZR-000137 Error Security \u00b7 Network Security Group \u00b7 2020_06 Network security groups (NSGs) should avoid rules that allow any inbound source. Description # NSGs filter network traffic for Azure services connected to a virtual network subnet. In addition to the built-in security rules, a number of custom rules may be defined. Custom security rules can be defined that allow or deny inbound or outbound communication. When defining custom rules, avoid using rules that allow any inbound source. The intent of custom rules that allow any inbound source may not be clearly understood by support teams. Additionally, custom rules with any inbound source may expose services if a public IP address is attached. When inbound network traffic from the Internet is intended also consider the following: Use Application Gateway in-front of any web application workloads. Use DDoS Protection Standard to protect public IP addresses. Recommendation # Consider updating inbound rules to use a specified source such as an IP range or service tag. If inbound access from Internet-based sources is intended, consider using the service tag Internet . Links # Best practices for endpoint security on Azure Network Security Groups Logically segment subnets What is Azure Application Gateway? Azure DDoS Protection Standard overview Azure template reference","title":"Azure.NSG.AnyInboundSource"},{"location":"en/rules/Azure.NSG.AnyInboundSource/#avoid-rules-that-allow-any-inbound-source","text":"Azure.NSG.AnyInboundSource AZR-000137 Error Security \u00b7 Network Security Group \u00b7 2020_06 Network security groups (NSGs) should avoid rules that allow any inbound source.","title":"Avoid rules that allow any inbound source"},{"location":"en/rules/Azure.NSG.AnyInboundSource/#description","text":"NSGs filter network traffic for Azure services connected to a virtual network subnet. In addition to the built-in security rules, a number of custom rules may be defined. Custom security rules can be defined that allow or deny inbound or outbound communication. When defining custom rules, avoid using rules that allow any inbound source. The intent of custom rules that allow any inbound source may not be clearly understood by support teams. Additionally, custom rules with any inbound source may expose services if a public IP address is attached. When inbound network traffic from the Internet is intended also consider the following: Use Application Gateway in-front of any web application workloads. Use DDoS Protection Standard to protect public IP addresses.","title":"Description"},{"location":"en/rules/Azure.NSG.AnyInboundSource/#recommendation","text":"Consider updating inbound rules to use a specified source such as an IP range or service tag. If inbound access from Internet-based sources is intended, consider using the service tag Internet .","title":"Recommendation"},{"location":"en/rules/Azure.NSG.AnyInboundSource/#links","text":"Best practices for endpoint security on Azure Network Security Groups Logically segment subnets What is Azure Application Gateway? Azure DDoS Protection Standard overview Azure template reference","title":"Links"},{"location":"en/rules/Azure.NSG.Associated/","tags":["Azure.NSG.Associated","AZR-000140"],"text":"Associate NSGs or clean up # Azure.NSG.Associated AZR-000140 Error Operational Excellence \u00b7 Network Security Group \u00b7 2020_06 Network Security Groups (NSGs) should be associated to a subnet or network interface. Description # NSGs basic stateful firewalls that are deployed as separate resources. Each NSG can be associated to one or more network interfaces or subnets. NSGs that are not associated with a network interface or subnet perform no purpose. Recommendation # Consider cleaning up NSGs that are not required to reduce technical debt. Also consider using Resource Groups to help manage the lifecycle of related resources together. Links # Operational excellence principles Azure template reference Network security groups","title":"Azure.NSG.Associated"},{"location":"en/rules/Azure.NSG.Associated/#associate-nsgs-or-clean-up","text":"Azure.NSG.Associated AZR-000140 Error Operational Excellence \u00b7 Network Security Group \u00b7 2020_06 Network Security Groups (NSGs) should be associated to a subnet or network interface.","title":"Associate NSGs or clean up"},{"location":"en/rules/Azure.NSG.Associated/#description","text":"NSGs basic stateful firewalls that are deployed as separate resources. Each NSG can be associated to one or more network interfaces or subnets. NSGs that are not associated with a network interface or subnet perform no purpose.","title":"Description"},{"location":"en/rules/Azure.NSG.Associated/#recommendation","text":"Consider cleaning up NSGs that are not required to reduce technical debt. Also consider using Resource Groups to help manage the lifecycle of related resources together.","title":"Recommendation"},{"location":"en/rules/Azure.NSG.Associated/#links","text":"Operational excellence principles Azure template reference Network security groups","title":"Links"},{"location":"en/rules/Azure.NSG.DenyAllInbound/","tags":["Azure.NSG.DenyAllInbound","AZR-000138"],"text":"Avoid denying all inbound traffic # Azure.NSG.DenyAllInbound AZR-000138 Error Operational Excellence \u00b7 Network Security Group \u00b7 2020_06 Avoid denying all inbound traffic. Description # Network Security Groups can be configured to block all inbound network traffic. Blocking all inbound traffic will fail load balancer health probes and other required traffic. When using a custom deny all inbound rule, also add rules to allow permitted traffic. To permit network traffic, add a custom allow rule with a lower priority number then the deny all rule. Rules with a lower priority number will be processed first. 100 is the lowest priority number. Recommendation # Consider using a higher priority number for deny all rules to allow permitted traffic rules to be added. Links # Network security groups Virtual network service tags Azure template reference","title":"Azure.NSG.DenyAllInbound"},{"location":"en/rules/Azure.NSG.DenyAllInbound/#avoid-denying-all-inbound-traffic","text":"Azure.NSG.DenyAllInbound AZR-000138 Error Operational Excellence \u00b7 Network Security Group \u00b7 2020_06 Avoid denying all inbound traffic.","title":"Avoid denying all inbound traffic"},{"location":"en/rules/Azure.NSG.DenyAllInbound/#description","text":"Network Security Groups can be configured to block all inbound network traffic. Blocking all inbound traffic will fail load balancer health probes and other required traffic. When using a custom deny all inbound rule, also add rules to allow permitted traffic. To permit network traffic, add a custom allow rule with a lower priority number then the deny all rule. Rules with a lower priority number will be processed first. 100 is the lowest priority number.","title":"Description"},{"location":"en/rules/Azure.NSG.DenyAllInbound/#recommendation","text":"Consider using a higher priority number for deny all rules to allow permitted traffic rules to be added.","title":"Recommendation"},{"location":"en/rules/Azure.NSG.DenyAllInbound/#links","text":"Network security groups Virtual network service tags Azure template reference","title":"Links"},{"location":"en/rules/Azure.NSG.LateralTraversal/","tags":["Azure.NSG.LateralTraversal","AZR-000139"],"text":"Limit lateral traversal within subnets # Azure.NSG.LateralTraversal AZR-000139 Error Security \u00b7 Network Security Group \u00b7 2020_06 Deny outbound management connections from non-management hosts. Description # Network Security Groups (NSGs) are basic stateful firewalls that provide network isolation and security. NSGs allow or deny traffic between virtual machines (VMs) and other supported services on a virtual network. i.e. Traffic between VMs on the same or different subnet can be restricted. NSGs do this by enforcing ordered access rules for all traffic in/ out services attached to a subnet. This micro-segmentation approach provides a control to reduce lateral movement between services. Typically, a subset of trusted hosts such as privileged access workstations (PAWs), bastion hosts, or jump boxes will be used for management. Management protocols originating from application workload hosts should be blocked. For example: An SQL Server should not be used as a management host to manage other SQL Servers, or File Servers. Configure dedicated management hosts to manage other hosts. This helps improve security in two ways: Reduces the attack surface that can be used in lateral traversal attacks. Limits the likelihood that privileged credentials will be exposed for outbound management. Recommendation # Consider configuring NSGs rules to block common outbound management traffic from non-management hosts. Notes # Specifically this rule checks if either 3389 (RDP) or 22 (SSH) has been blocked for outbound traffic. Examples # Configure with Azure template # To deploy NSGs that pass this rule: Add an outbound security rule that denies TCP port 3389 and/ or 22. For example: { \"type\" : \"Microsoft.Network/networkSecurityGroups\" , \"name\" : \"[parameters('nsgName')]\" , \"apiVersion\" : \"2019-04-01\" , \"location\" : \"[resourceGroup().location]\" , \"properties\" : { \"securityRules\" : [ { \"name\" : \"deny-hop-outbound\" , \"properties\" : { \"protocol\" : \"*\" , \"sourcePortRange\" : \"*\" , \"destinationPortRanges\" : [ \"3389\" , \"22\" ], \"access\" : \"Deny\" , \"priority\" : 200 , \"direction\" : \"Outbound\" , \"sourceAddressPrefix\" : \"VirtualNetwork\" , \"destinationAddressPrefix\" : \"*\" } } ] } } Configure with Bicep # To deploy NSGs that pass this rule: Add an outbound security rule that denies TCP port 3389 and/ or 22. For example: resource nsg 'Microsoft.Network/networkSecurityGroups@2021-02-01' = { name: 'nsg-001' properties: { securityRules: [ { name: 'deny-hop-outbound' properties: { priority: 200 access: 'Deny' protocol: 'Tcp' direction: 'Outbound' sourceAddressPrefix: 'VirtualNetwork' destinationAddressPrefix: '*' destinationPortRanges: [ '3389' '22' ] } } ] } } Links # Implement network segmentation patterns on Azure Logically segment subnets Plan virtual networks Azure template reference Network security groups","title":"Azure.NSG.LateralTraversal"},{"location":"en/rules/Azure.NSG.LateralTraversal/#limit-lateral-traversal-within-subnets","text":"Azure.NSG.LateralTraversal AZR-000139 Error Security \u00b7 Network Security Group \u00b7 2020_06 Deny outbound management connections from non-management hosts.","title":"Limit lateral traversal within subnets"},{"location":"en/rules/Azure.NSG.LateralTraversal/#description","text":"Network Security Groups (NSGs) are basic stateful firewalls that provide network isolation and security. NSGs allow or deny traffic between virtual machines (VMs) and other supported services on a virtual network. i.e. Traffic between VMs on the same or different subnet can be restricted. NSGs do this by enforcing ordered access rules for all traffic in/ out services attached to a subnet. This micro-segmentation approach provides a control to reduce lateral movement between services. Typically, a subset of trusted hosts such as privileged access workstations (PAWs), bastion hosts, or jump boxes will be used for management. Management protocols originating from application workload hosts should be blocked. For example: An SQL Server should not be used as a management host to manage other SQL Servers, or File Servers. Configure dedicated management hosts to manage other hosts. This helps improve security in two ways: Reduces the attack surface that can be used in lateral traversal attacks. Limits the likelihood that privileged credentials will be exposed for outbound management.","title":"Description"},{"location":"en/rules/Azure.NSG.LateralTraversal/#recommendation","text":"Consider configuring NSGs rules to block common outbound management traffic from non-management hosts.","title":"Recommendation"},{"location":"en/rules/Azure.NSG.LateralTraversal/#notes","text":"Specifically this rule checks if either 3389 (RDP) or 22 (SSH) has been blocked for outbound traffic.","title":"Notes"},{"location":"en/rules/Azure.NSG.LateralTraversal/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.NSG.LateralTraversal/#configure-with-azure-template","text":"To deploy NSGs that pass this rule: Add an outbound security rule that denies TCP port 3389 and/ or 22. For example: { \"type\" : \"Microsoft.Network/networkSecurityGroups\" , \"name\" : \"[parameters('nsgName')]\" , \"apiVersion\" : \"2019-04-01\" , \"location\" : \"[resourceGroup().location]\" , \"properties\" : { \"securityRules\" : [ { \"name\" : \"deny-hop-outbound\" , \"properties\" : { \"protocol\" : \"*\" , \"sourcePortRange\" : \"*\" , \"destinationPortRanges\" : [ \"3389\" , \"22\" ], \"access\" : \"Deny\" , \"priority\" : 200 , \"direction\" : \"Outbound\" , \"sourceAddressPrefix\" : \"VirtualNetwork\" , \"destinationAddressPrefix\" : \"*\" } } ] } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.NSG.LateralTraversal/#configure-with-bicep","text":"To deploy NSGs that pass this rule: Add an outbound security rule that denies TCP port 3389 and/ or 22. For example: resource nsg 'Microsoft.Network/networkSecurityGroups@2021-02-01' = { name: 'nsg-001' properties: { securityRules: [ { name: 'deny-hop-outbound' properties: { priority: 200 access: 'Deny' protocol: 'Tcp' direction: 'Outbound' sourceAddressPrefix: 'VirtualNetwork' destinationAddressPrefix: '*' destinationPortRanges: [ '3389' '22' ] } } ] } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.NSG.LateralTraversal/#links","text":"Implement network segmentation patterns on Azure Logically segment subnets Plan virtual networks Azure template reference Network security groups","title":"Links"},{"location":"en/rules/Azure.NSG.Name/","tags":["Azure.NSG.Name","AZR-000141"],"text":"Use valid NSG names # Azure.NSG.Name AZR-000141 Error Operational Excellence \u00b7 Network Security Group \u00b7 2020_06 Network Security Group (NSG) names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for NSG names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. NSG names must be unique within a resource group. Recommendation # Consider using names that meet Network Security Group naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if NSG names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Azure.NSG.Name"},{"location":"en/rules/Azure.NSG.Name/#use-valid-nsg-names","text":"Azure.NSG.Name AZR-000141 Error Operational Excellence \u00b7 Network Security Group \u00b7 2020_06 Network Security Group (NSG) names should meet naming requirements.","title":"Use valid NSG names"},{"location":"en/rules/Azure.NSG.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for NSG names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. NSG names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.NSG.Name/#recommendation","text":"Consider using names that meet Network Security Group naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.NSG.Name/#notes","text":"This rule does not check if NSG names are unique.","title":"Notes"},{"location":"en/rules/Azure.NSG.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Links"},{"location":"en/rules/Azure.Policy.AssignmentAssignedBy/","tags":["Azure.Policy.AssignmentAssignedBy","AZR-000144"],"text":"Use assigned by for policy assignments # Azure.Policy.AssignmentAssignedBy AZR-000144 Error Operational Excellence \u00b7 Policy \u00b7 2021_06 Policy assignments should use assignedBy metadata. Description # When using the Azure Portal, policy assignment automatically set the assignedBy metadata. This metadata field is intended to indicate the person or team assigning the policy to a resource scope. When automating policy management, it may be helpful to identify assignments managed by code. Recommendation # Consider setting assignedBy metadata for each policy assignment. Examples # Azure templates # To deploy policy assignments that pass this rule: Set the properties.metadata.assignedBy property with a valid value. For example: { \"comments\" : \"Initiative assignment\" , \"name\" : \"assignment-001\" , \"type\" : \"Microsoft.Authorization/policyAssignments\" , \"apiVersion\" : \"2019-06-01\" , \"properties\" : { \"displayName\" : \"Assignment 001\" , \"description\" : \"An example policy assignment.\" , \"metadata\" : { \"assignedBy\" : \"DevOps pipeline\" }, \"enforcementMode\" : \"Default\" } } Links # Azure Policy assignment structure Azure template reference Repeatable infrastructure","title":"Azure.Policy.AssignmentAssignedBy"},{"location":"en/rules/Azure.Policy.AssignmentAssignedBy/#use-assigned-by-for-policy-assignments","text":"Azure.Policy.AssignmentAssignedBy AZR-000144 Error Operational Excellence \u00b7 Policy \u00b7 2021_06 Policy assignments should use assignedBy metadata.","title":"Use assigned by for policy assignments"},{"location":"en/rules/Azure.Policy.AssignmentAssignedBy/#description","text":"When using the Azure Portal, policy assignment automatically set the assignedBy metadata. This metadata field is intended to indicate the person or team assigning the policy to a resource scope. When automating policy management, it may be helpful to identify assignments managed by code.","title":"Description"},{"location":"en/rules/Azure.Policy.AssignmentAssignedBy/#recommendation","text":"Consider setting assignedBy metadata for each policy assignment.","title":"Recommendation"},{"location":"en/rules/Azure.Policy.AssignmentAssignedBy/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Policy.AssignmentAssignedBy/#azure-templates","text":"To deploy policy assignments that pass this rule: Set the properties.metadata.assignedBy property with a valid value. For example: { \"comments\" : \"Initiative assignment\" , \"name\" : \"assignment-001\" , \"type\" : \"Microsoft.Authorization/policyAssignments\" , \"apiVersion\" : \"2019-06-01\" , \"properties\" : { \"displayName\" : \"Assignment 001\" , \"description\" : \"An example policy assignment.\" , \"metadata\" : { \"assignedBy\" : \"DevOps pipeline\" }, \"enforcementMode\" : \"Default\" } }","title":"Azure templates"},{"location":"en/rules/Azure.Policy.AssignmentAssignedBy/#links","text":"Azure Policy assignment structure Azure template reference Repeatable infrastructure","title":"Links"},{"location":"en/rules/Azure.Policy.AssignmentDescriptors/","tags":["Azure.Policy.AssignmentDescriptors","AZR-000143"],"text":"Use descriptive policy assignments # Azure.Policy.AssignmentDescriptors AZR-000143 Error Operational Excellence \u00b7 Policy \u00b7 2021_06 Policy assignments should use a display name and description. Description # Policy assignments can be configured with a display name and description. Use these additional properties to clearly convey the intent of the policy assignment. Recommendation # Consider setting a display name and description for each policy assignment. Examples # Azure templates # To deploy policy assignments that pass this rule: Set the properties.displayName property with a valid value. Set the properties.description property with a valid value. For example: { \"comments\" : \"Initiative assignment\" , \"name\" : \"assignment-001\" , \"type\" : \"Microsoft.Authorization/policyAssignments\" , \"apiVersion\" : \"2019-06-01\" , \"properties\" : { \"displayName\" : \"Assignment 001\" , \"description\" : \"An example policy assignment.\" , \"metadata\" : { \"assignedBy\" : \"DevOps pipeline\" }, \"enforcementMode\" : \"Default\" } } Links # Azure Policy assignment structure Azure template reference Repeatable infrastructure","title":"Azure.Policy.AssignmentDescriptors"},{"location":"en/rules/Azure.Policy.AssignmentDescriptors/#use-descriptive-policy-assignments","text":"Azure.Policy.AssignmentDescriptors AZR-000143 Error Operational Excellence \u00b7 Policy \u00b7 2021_06 Policy assignments should use a display name and description.","title":"Use descriptive policy assignments"},{"location":"en/rules/Azure.Policy.AssignmentDescriptors/#description","text":"Policy assignments can be configured with a display name and description. Use these additional properties to clearly convey the intent of the policy assignment.","title":"Description"},{"location":"en/rules/Azure.Policy.AssignmentDescriptors/#recommendation","text":"Consider setting a display name and description for each policy assignment.","title":"Recommendation"},{"location":"en/rules/Azure.Policy.AssignmentDescriptors/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Policy.AssignmentDescriptors/#azure-templates","text":"To deploy policy assignments that pass this rule: Set the properties.displayName property with a valid value. Set the properties.description property with a valid value. For example: { \"comments\" : \"Initiative assignment\" , \"name\" : \"assignment-001\" , \"type\" : \"Microsoft.Authorization/policyAssignments\" , \"apiVersion\" : \"2019-06-01\" , \"properties\" : { \"displayName\" : \"Assignment 001\" , \"description\" : \"An example policy assignment.\" , \"metadata\" : { \"assignedBy\" : \"DevOps pipeline\" }, \"enforcementMode\" : \"Default\" } }","title":"Azure templates"},{"location":"en/rules/Azure.Policy.AssignmentDescriptors/#links","text":"Azure Policy assignment structure Azure template reference Repeatable infrastructure","title":"Links"},{"location":"en/rules/Azure.Policy.Descriptors/","tags":["Azure.Policy.Descriptors","AZR-000142"],"text":"Use descriptive policies # Azure.Policy.Descriptors AZR-000142 Error Operational Excellence \u00b7 Policy \u00b7 2020_06 Policy and initiative definitions should use a display name, description, and category. Description # Policy and initiative definitions can be configured with a display name, description, and category. Use these additional properties to clearly convey the purpose when creating custom definitions. Recommendation # Consider setting a display name, description and category for each policy and initiatives definition. Examples # Azure templates # To deploy initiative and policy definitions that pass this rule: Set the properties.displayName property with a valid value. Set the properties.description property with a valid value. Set the properties.metadata.category property with a valid value. For example: { \"comments\" : \"Initiative definition\" , \"name\" : \"initiative-001\" , \"type\" : \"Microsoft.Authorization/policySetDefinitions\" , \"apiVersion\" : \"2019-06-01\" , \"properties\" : { \"policyType\" : \"Custom\" , \"displayName\" : \"Initiative 001\" , \"description\" : \"An example initiative.\" , \"metadata\" : { \"category\" : \"Security\" }, \"policyDefinitions\" : [] } } Links # Azure Policy definition structure Common metadata properties Policy definition template reference Initiative definition template reference Repeatable infrastructure","title":"Azure.Policy.Descriptors"},{"location":"en/rules/Azure.Policy.Descriptors/#use-descriptive-policies","text":"Azure.Policy.Descriptors AZR-000142 Error Operational Excellence \u00b7 Policy \u00b7 2020_06 Policy and initiative definitions should use a display name, description, and category.","title":"Use descriptive policies"},{"location":"en/rules/Azure.Policy.Descriptors/#description","text":"Policy and initiative definitions can be configured with a display name, description, and category. Use these additional properties to clearly convey the purpose when creating custom definitions.","title":"Description"},{"location":"en/rules/Azure.Policy.Descriptors/#recommendation","text":"Consider setting a display name, description and category for each policy and initiatives definition.","title":"Recommendation"},{"location":"en/rules/Azure.Policy.Descriptors/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Policy.Descriptors/#azure-templates","text":"To deploy initiative and policy definitions that pass this rule: Set the properties.displayName property with a valid value. Set the properties.description property with a valid value. Set the properties.metadata.category property with a valid value. For example: { \"comments\" : \"Initiative definition\" , \"name\" : \"initiative-001\" , \"type\" : \"Microsoft.Authorization/policySetDefinitions\" , \"apiVersion\" : \"2019-06-01\" , \"properties\" : { \"policyType\" : \"Custom\" , \"displayName\" : \"Initiative 001\" , \"description\" : \"An example initiative.\" , \"metadata\" : { \"category\" : \"Security\" }, \"policyDefinitions\" : [] } }","title":"Azure templates"},{"location":"en/rules/Azure.Policy.Descriptors/#links","text":"Azure Policy definition structure Common metadata properties Policy definition template reference Initiative definition template reference Repeatable infrastructure","title":"Links"},{"location":"en/rules/Azure.Policy.ExemptionDescriptors/","tags":["Azure.Policy.ExemptionDescriptors","AZR-000145"],"text":"Use descriptive policy exemptions # Azure.Policy.ExemptionDescriptors AZR-000145 Error Operational Excellence \u00b7 Policy \u00b7 2021_06 Policy exemptions should use a display name and description. Description # Policy assignments can be configured with a display name and description. Use these additional properties to clearly convey the reason for the policy exemption. Additionally, consider providing a link or reference to track exemption conditions and approval. Recommendation # Consider setting a display name and description for each policy exemption. Examples # Azure templates # To deploy policy exemptions that pass this rule: Set the properties.displayName property with a valid value. Set the properties.description property with a valid value. For example: { \"comments\" : \"An example exemption.\" , \"name\" : \"exemption-001\" , \"type\" : \"Microsoft.Authorization/policyExemptions\" , \"apiVersion\" : \"2020-07-01-preview\" , \"properties\" : { \"policyAssignmentId\" : \"<assignment_id>\" , \"policyDefinitionReferenceIds\" : [], \"exemptionCategory\" : \"Waiver\" , \"expiresOn\" : \"2021-04-27T14:00:00Z\" , \"displayName\" : \"Exemption 001\" , \"description\" : \"An example exemption.\" , \"metadata\" : { \"requestedBy\" : \"Apps team\" , \"approvedBy\" : \"Security team\" , \"createdBy\" : \"DevOps pipeline\" } } } Links # Azure Policy exemption structure Azure template reference Repeatable infrastructure","title":"Azure.Policy.ExemptionDescriptors"},{"location":"en/rules/Azure.Policy.ExemptionDescriptors/#use-descriptive-policy-exemptions","text":"Azure.Policy.ExemptionDescriptors AZR-000145 Error Operational Excellence \u00b7 Policy \u00b7 2021_06 Policy exemptions should use a display name and description.","title":"Use descriptive policy exemptions"},{"location":"en/rules/Azure.Policy.ExemptionDescriptors/#description","text":"Policy assignments can be configured with a display name and description. Use these additional properties to clearly convey the reason for the policy exemption. Additionally, consider providing a link or reference to track exemption conditions and approval.","title":"Description"},{"location":"en/rules/Azure.Policy.ExemptionDescriptors/#recommendation","text":"Consider setting a display name and description for each policy exemption.","title":"Recommendation"},{"location":"en/rules/Azure.Policy.ExemptionDescriptors/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Policy.ExemptionDescriptors/#azure-templates","text":"To deploy policy exemptions that pass this rule: Set the properties.displayName property with a valid value. Set the properties.description property with a valid value. For example: { \"comments\" : \"An example exemption.\" , \"name\" : \"exemption-001\" , \"type\" : \"Microsoft.Authorization/policyExemptions\" , \"apiVersion\" : \"2020-07-01-preview\" , \"properties\" : { \"policyAssignmentId\" : \"<assignment_id>\" , \"policyDefinitionReferenceIds\" : [], \"exemptionCategory\" : \"Waiver\" , \"expiresOn\" : \"2021-04-27T14:00:00Z\" , \"displayName\" : \"Exemption 001\" , \"description\" : \"An example exemption.\" , \"metadata\" : { \"requestedBy\" : \"Apps team\" , \"approvedBy\" : \"Security team\" , \"createdBy\" : \"DevOps pipeline\" } } }","title":"Azure templates"},{"location":"en/rules/Azure.Policy.ExemptionDescriptors/#links","text":"Azure Policy exemption structure Azure template reference Repeatable infrastructure","title":"Links"},{"location":"en/rules/Azure.Policy.WaiverExpiry/","tags":["Azure.Policy.WaiverExpiry","AZR-000146"],"text":"Policy waiver exemptions must expire # Azure.Policy.WaiverExpiry AZR-000146 Error Operational Excellence \u00b7 Policy \u00b7 2021_06 Configure policy waiver exemptions to expire. Description # Azure Policy waiver exemptions are intended to be temporary acceptance of a non-compliance state. Use the Mitigated category when the issue intent has been met through an another method. Recommendation # Consider configuring an expiry for policy exemption waivers within the maximum threshold. Examples # Azure templates # To deploy policy assignments that pass this rule: Set the properties.expiresOn property with a valid date earlier than the maximum number of days. For example: { \"comments\" : \"An example exemption.\" , \"name\" : \"exemption-001\" , \"type\" : \"Microsoft.Authorization/policyExemptions\" , \"apiVersion\" : \"2020-07-01-preview\" , \"properties\" : { \"policyAssignmentId\" : \"<assignment_id>\" , \"policyDefinitionReferenceIds\" : [], \"exemptionCategory\" : \"Waiver\" , \"expiresOn\" : \"2021-04-27T14:00:00Z\" , \"displayName\" : \"Exemption 001\" , \"description\" : \"An example exemption.\" , \"metadata\" : { \"requestedBy\" : \"Apps team\" , \"approvedBy\" : \"Security team\" , \"createdBy\" : \"DevOps pipeline\" } } } Notes # This rule fails: When the exemption is configured not to expire. The exemption expiry date is greater than the maximum threshold. Configure AZURE_POLICY_WAIVER_MAX_EXPIRY to set the maximum expiry date threshold. # YAML: The default AZURE_POLICY_WAIVER_MAX_EXPIRY configuration option configuration : AZURE_POLICY_WAIVER_MAX_EXPIRY : 366 Links # Azure Policy exemption structure Azure template reference Repeatable infrastructure","title":"Azure.Policy.WaiverExpiry"},{"location":"en/rules/Azure.Policy.WaiverExpiry/#policy-waiver-exemptions-must-expire","text":"Azure.Policy.WaiverExpiry AZR-000146 Error Operational Excellence \u00b7 Policy \u00b7 2021_06 Configure policy waiver exemptions to expire.","title":"Policy waiver exemptions must expire"},{"location":"en/rules/Azure.Policy.WaiverExpiry/#description","text":"Azure Policy waiver exemptions are intended to be temporary acceptance of a non-compliance state. Use the Mitigated category when the issue intent has been met through an another method.","title":"Description"},{"location":"en/rules/Azure.Policy.WaiverExpiry/#recommendation","text":"Consider configuring an expiry for policy exemption waivers within the maximum threshold.","title":"Recommendation"},{"location":"en/rules/Azure.Policy.WaiverExpiry/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Policy.WaiverExpiry/#azure-templates","text":"To deploy policy assignments that pass this rule: Set the properties.expiresOn property with a valid date earlier than the maximum number of days. For example: { \"comments\" : \"An example exemption.\" , \"name\" : \"exemption-001\" , \"type\" : \"Microsoft.Authorization/policyExemptions\" , \"apiVersion\" : \"2020-07-01-preview\" , \"properties\" : { \"policyAssignmentId\" : \"<assignment_id>\" , \"policyDefinitionReferenceIds\" : [], \"exemptionCategory\" : \"Waiver\" , \"expiresOn\" : \"2021-04-27T14:00:00Z\" , \"displayName\" : \"Exemption 001\" , \"description\" : \"An example exemption.\" , \"metadata\" : { \"requestedBy\" : \"Apps team\" , \"approvedBy\" : \"Security team\" , \"createdBy\" : \"DevOps pipeline\" } } }","title":"Azure templates"},{"location":"en/rules/Azure.Policy.WaiverExpiry/#notes","text":"This rule fails: When the exemption is configured not to expire. The exemption expiry date is greater than the maximum threshold. Configure AZURE_POLICY_WAIVER_MAX_EXPIRY to set the maximum expiry date threshold. # YAML: The default AZURE_POLICY_WAIVER_MAX_EXPIRY configuration option configuration : AZURE_POLICY_WAIVER_MAX_EXPIRY : 366","title":"Notes"},{"location":"en/rules/Azure.Policy.WaiverExpiry/#links","text":"Azure Policy exemption structure Azure template reference Repeatable infrastructure","title":"Links"},{"location":"en/rules/Azure.PostgreSQL.AllowAzureAccess/","tags":["Azure.PostgreSQL.AllowAzureAccess","AZR-000150"],"text":"Disable PostgreSQL Allow Azure access firewall rule # Azure.PostgreSQL.AllowAzureAccess AZR-000150 Error Security \u00b7 Azure Database for PostgreSQL \u00b7 2020_06 Determine if access from Azure services is required. Description # Allow access to Azure services, permits any Azure service including other Azure customers, network based-access to databases on the same PostgreSQL server instance. If network based access is permitted, authentication is still required. Enabling access from Azure Services is useful in certain cases for serverless PaaS workloads where configuring a stable IP address is not possible. For example Azure Functions, Container Instances and Logic Apps. Recommendation # Where a stable IP addresses are able to be configured, configure IP or virtual network based firewall rules instead of using Allow access to Azure services. Determine if access from Azure services is required for the services connecting to the hosted databases. Links # Firewall rules in Azure Database for PostgreSQL","title":"Azure.PostgreSQL.AllowAzureAccess"},{"location":"en/rules/Azure.PostgreSQL.AllowAzureAccess/#disable-postgresql-allow-azure-access-firewall-rule","text":"Azure.PostgreSQL.AllowAzureAccess AZR-000150 Error Security \u00b7 Azure Database for PostgreSQL \u00b7 2020_06 Determine if access from Azure services is required.","title":"Disable PostgreSQL Allow Azure access firewall rule"},{"location":"en/rules/Azure.PostgreSQL.AllowAzureAccess/#description","text":"Allow access to Azure services, permits any Azure service including other Azure customers, network based-access to databases on the same PostgreSQL server instance. If network based access is permitted, authentication is still required. Enabling access from Azure Services is useful in certain cases for serverless PaaS workloads where configuring a stable IP address is not possible. For example Azure Functions, Container Instances and Logic Apps.","title":"Description"},{"location":"en/rules/Azure.PostgreSQL.AllowAzureAccess/#recommendation","text":"Where a stable IP addresses are able to be configured, configure IP or virtual network based firewall rules instead of using Allow access to Azure services. Determine if access from Azure services is required for the services connecting to the hosted databases.","title":"Recommendation"},{"location":"en/rules/Azure.PostgreSQL.AllowAzureAccess/#links","text":"Firewall rules in Azure Database for PostgreSQL","title":"Links"},{"location":"en/rules/Azure.PostgreSQL.FirewallIPRange/","tags":["Azure.PostgreSQL.FirewallIPRange","AZR-000151"],"text":"Limit PostgreSQL server firewall rule range # Azure.PostgreSQL.FirewallIPRange AZR-000151 Error Security \u00b7 Azure Database for PostgreSQL \u00b7 2020_06 Determine if there is an excessive number of permitted IP addresses. Description # Typically the number of IP address rules permitted through the firewall is minimal, with management connectivity from on-premises and cloud application connectivity the most common. Recommendation # The PostgreSQL server has greater then ten (10) public IP addresses that are permitted network access. Some rules may not be needed or can be reduced. Links # Firewall rules in Azure Database for PostgreSQL - Single Server Create and manage firewall rules for Azure Database for PostgreSQL - Single Server using the Azure portal","title":"Azure.PostgreSQL.FirewallIPRange"},{"location":"en/rules/Azure.PostgreSQL.FirewallIPRange/#limit-postgresql-server-firewall-rule-range","text":"Azure.PostgreSQL.FirewallIPRange AZR-000151 Error Security \u00b7 Azure Database for PostgreSQL \u00b7 2020_06 Determine if there is an excessive number of permitted IP addresses.","title":"Limit PostgreSQL server firewall rule range"},{"location":"en/rules/Azure.PostgreSQL.FirewallIPRange/#description","text":"Typically the number of IP address rules permitted through the firewall is minimal, with management connectivity from on-premises and cloud application connectivity the most common.","title":"Description"},{"location":"en/rules/Azure.PostgreSQL.FirewallIPRange/#recommendation","text":"The PostgreSQL server has greater then ten (10) public IP addresses that are permitted network access. Some rules may not be needed or can be reduced.","title":"Recommendation"},{"location":"en/rules/Azure.PostgreSQL.FirewallIPRange/#links","text":"Firewall rules in Azure Database for PostgreSQL - Single Server Create and manage firewall rules for Azure Database for PostgreSQL - Single Server using the Azure portal","title":"Links"},{"location":"en/rules/Azure.PostgreSQL.FirewallRuleCount/","tags":["Azure.PostgreSQL.FirewallRuleCount","AZR-000149"],"text":"Cleanup PostgreSQL server firewall rules # Azure.PostgreSQL.FirewallRuleCount AZR-000149 Error Security \u00b7 Azure Database for PostgreSQL \u00b7 2020_06 Determine if there is an excessive number of firewall rules. Description # Typically the number of firewall rules required is minimal, with management connectivity from on-premises and cloud application connectivity the most common. Recommendation # The PostgreSQL server has greater then ten (10) firewall rules. Some rules may not be needed. Links # Firewall rules in Azure Database for PostgreSQL - Single Server Create and manage firewall rules for Azure Database for PostgreSQL - Single Server using the Azure portal","title":"Azure.PostgreSQL.FirewallRuleCount"},{"location":"en/rules/Azure.PostgreSQL.FirewallRuleCount/#cleanup-postgresql-server-firewall-rules","text":"Azure.PostgreSQL.FirewallRuleCount AZR-000149 Error Security \u00b7 Azure Database for PostgreSQL \u00b7 2020_06 Determine if there is an excessive number of firewall rules.","title":"Cleanup PostgreSQL server firewall rules"},{"location":"en/rules/Azure.PostgreSQL.FirewallRuleCount/#description","text":"Typically the number of firewall rules required is minimal, with management connectivity from on-premises and cloud application connectivity the most common.","title":"Description"},{"location":"en/rules/Azure.PostgreSQL.FirewallRuleCount/#recommendation","text":"The PostgreSQL server has greater then ten (10) firewall rules. Some rules may not be needed.","title":"Recommendation"},{"location":"en/rules/Azure.PostgreSQL.FirewallRuleCount/#links","text":"Firewall rules in Azure Database for PostgreSQL - Single Server Create and manage firewall rules for Azure Database for PostgreSQL - Single Server using the Azure portal","title":"Links"},{"location":"en/rules/Azure.PostgreSQL.MinTLS/","tags":["Azure.PostgreSQL.MinTLS","AZR-000148"],"text":"PostgreSQL DB server minimum TLS version # Azure.PostgreSQL.MinTLS AZR-000148 Error Security \u00b7 Azure Database for PostgreSQL \u00b7 2020_09 PostgreSQL DB servers should reject TLS versions older than 1.2. Description # The minimum version of TLS that PostgreSQL DB servers accept is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted. Recommendation # Consider configuring the minimum supported TLS version to be 1.2. Links # Data encryption in Azure TLS enforcement in Azure Database for PostgreSQL Single server Set TLS configurations for Azure Database for PostgreSQL - Single server Preparing for TLS 1.2 in Microsoft Azure Azure deployment reference","title":"Azure.PostgreSQL.MinTLS"},{"location":"en/rules/Azure.PostgreSQL.MinTLS/#postgresql-db-server-minimum-tls-version","text":"Azure.PostgreSQL.MinTLS AZR-000148 Error Security \u00b7 Azure Database for PostgreSQL \u00b7 2020_09 PostgreSQL DB servers should reject TLS versions older than 1.2.","title":"PostgreSQL DB server minimum TLS version"},{"location":"en/rules/Azure.PostgreSQL.MinTLS/#description","text":"The minimum version of TLS that PostgreSQL DB servers accept is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted.","title":"Description"},{"location":"en/rules/Azure.PostgreSQL.MinTLS/#recommendation","text":"Consider configuring the minimum supported TLS version to be 1.2.","title":"Recommendation"},{"location":"en/rules/Azure.PostgreSQL.MinTLS/#links","text":"Data encryption in Azure TLS enforcement in Azure Database for PostgreSQL Single server Set TLS configurations for Azure Database for PostgreSQL - Single server Preparing for TLS 1.2 in Microsoft Azure Azure deployment reference","title":"Links"},{"location":"en/rules/Azure.PostgreSQL.ServerName/","tags":["Azure.PostgreSQL.ServerName","AZR-000152"],"text":"Use valid PostgreSQL DB server names # Azure.PostgreSQL.ServerName AZR-000152 Error Operational Excellence \u00b7 Azure Database for PostgreSQL \u00b7 2020_12 Azure PostgreSQL DB server names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for PostgreSQL DB server names are: Between 3 and 63 characters long. Lowercase letters, numbers, and hyphens. Can't start or end with a hyphen. PostgreSQL DB server names must be globally unique. Recommendation # Consider using names that meet Azure PostgreSQL DB server naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Azure PostgreSQL DB server names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.PostgreSQL.ServerName"},{"location":"en/rules/Azure.PostgreSQL.ServerName/#use-valid-postgresql-db-server-names","text":"Azure.PostgreSQL.ServerName AZR-000152 Error Operational Excellence \u00b7 Azure Database for PostgreSQL \u00b7 2020_12 Azure PostgreSQL DB server names should meet naming requirements.","title":"Use valid PostgreSQL DB server names"},{"location":"en/rules/Azure.PostgreSQL.ServerName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for PostgreSQL DB server names are: Between 3 and 63 characters long. Lowercase letters, numbers, and hyphens. Can't start or end with a hyphen. PostgreSQL DB server names must be globally unique.","title":"Description"},{"location":"en/rules/Azure.PostgreSQL.ServerName/#recommendation","text":"Consider using names that meet Azure PostgreSQL DB server naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.PostgreSQL.ServerName/#notes","text":"This rule does not check if Azure PostgreSQL DB server names are unique.","title":"Notes"},{"location":"en/rules/Azure.PostgreSQL.ServerName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.PostgreSQL.UseSSL/","tags":["Azure.PostgreSQL.UseSSL","AZR-000147"],"text":"Enforce encrypted PostgreSQL connections # Azure.PostgreSQL.UseSSL AZR-000147 Error Security \u00b7 Azure Database for PostgreSQL \u00b7 2020_06 Enforce encrypted PostgreSQL connections. Description # Azure Database for PostgreSQL is configured to only accept encrypted connections by default. When the setting enforce SSL connections is disabled, encrypted and unencrypted connections are permitted. This does not indicate that unencrypted connections are being used. Unencrypted communication to PostgreSQL server instances could allow disclosure of information to an untrusted party. Recommendation # Azure Database for PostgreSQL should be configured to only accept encrypted connections. Unless explicitly required, consider enabling enforce SSL connections . Also consider using Azure Policy to audit or enforce this configuration. Links # Data encryption in Azure Configure SSL connectivity in Azure Database for PostgreSQL","title":"Azure.PostgreSQL.UseSSL"},{"location":"en/rules/Azure.PostgreSQL.UseSSL/#enforce-encrypted-postgresql-connections","text":"Azure.PostgreSQL.UseSSL AZR-000147 Error Security \u00b7 Azure Database for PostgreSQL \u00b7 2020_06 Enforce encrypted PostgreSQL connections.","title":"Enforce encrypted PostgreSQL connections"},{"location":"en/rules/Azure.PostgreSQL.UseSSL/#description","text":"Azure Database for PostgreSQL is configured to only accept encrypted connections by default. When the setting enforce SSL connections is disabled, encrypted and unencrypted connections are permitted. This does not indicate that unencrypted connections are being used. Unencrypted communication to PostgreSQL server instances could allow disclosure of information to an untrusted party.","title":"Description"},{"location":"en/rules/Azure.PostgreSQL.UseSSL/#recommendation","text":"Azure Database for PostgreSQL should be configured to only accept encrypted connections. Unless explicitly required, consider enabling enforce SSL connections . Also consider using Azure Policy to audit or enforce this configuration.","title":"Recommendation"},{"location":"en/rules/Azure.PostgreSQL.UseSSL/#links","text":"Data encryption in Azure Configure SSL connectivity in Azure Database for PostgreSQL","title":"Links"},{"location":"en/rules/Azure.PrivateEndpoint.Name/","tags":["Azure.PrivateEndpoint.Name","AZR-000153"],"text":"Use valid Private Endpoint names # Azure.PrivateEndpoint.Name AZR-000153 Error Operational Excellence \u00b7 Private Endpoint \u00b7 2021_12 Private Endpoint names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Private Endpoint names are: Between 2 and 64 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Private Endpoint names must be unique within a resource group. Recommendation # Consider using names that meet Private Endpoint naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Private Endpoint names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Azure.PrivateEndpoint.Name"},{"location":"en/rules/Azure.PrivateEndpoint.Name/#use-valid-private-endpoint-names","text":"Azure.PrivateEndpoint.Name AZR-000153 Error Operational Excellence \u00b7 Private Endpoint \u00b7 2021_12 Private Endpoint names should meet naming requirements.","title":"Use valid Private Endpoint names"},{"location":"en/rules/Azure.PrivateEndpoint.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Private Endpoint names are: Between 2 and 64 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Private Endpoint names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.PrivateEndpoint.Name/#recommendation","text":"Consider using names that meet Private Endpoint naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.PrivateEndpoint.Name/#notes","text":"This rule does not check if Private Endpoint names are unique.","title":"Notes"},{"location":"en/rules/Azure.PrivateEndpoint.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Links"},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/","tags":["Azure.PublicIP.AvailabilityZone","AZR-000157"],"text":"Public IP addresses should use availability zones # Azure.PublicIP.AvailabilityZone AZR-000157 Error Reliability \u00b7 Public IP address \u00b7 2021_12 Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Description # Public IP addresses using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. A zone redundant Public IP address can spread across multiple availability zones, which ensures the Public IP address will continue running even if another zone has gone down. Furthermore, this ensures Public Standard Load balancer frontend IPs using a zone-redundant Public IP address can survive zone failure. Recommendation # Consider using zone-redundant Public IP addresses deployed with Standard SKU. Notes # This rule is not applicable for public IP addresses used for Azure Bastion. Azure Bastion does not currently support Availability Zones. Public IP addresses with the following tags are automatically excluded from this rule: resource-usage tag set to azure-bastion . This rule fails when \"zones\" is constrained to a single(zonal) zone, or set to null , [] when there are supported availability zones for the given region. This rule passes if no zones exist for a given region or \"zones\" is set to [\"1\", \"2\", \"3\"] . Configure AZURE_PUBLICIP_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST to set additional availability zones that need to be supported which are not in the existing providers for namespace Microsoft.Network and resource type publicIpAddresses . # YAML: The default AZURE_PUBLICIP_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option configuration : AZURE_PUBLICIP_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : [] Examples # Configure with Azure template # To configure zone-redundancy for a Public IP address. Set sku.name to Standard . Set zones to [\"1\", \"2\", \"3\"] . For example: { \"type\" : \"Microsoft.Network/publicIPAddresses\" , \"apiVersion\" : \"2020-11-01\" , \"name\" : \"[parameters('publicIPAddresses_test_ip_name')]\" , \"location\" : \"australiaeast\" , \"sku\" : { \"name\" : \"Standard\" , \"tier\" : \"Regional\" }, \"zones\" : [ \"2\" , \"3\" , \"1\" ], \"properties\" : { \"ipAddress\" : \"[parameters('publicIPAddresses_ip_address')]\" , \"publicIPAddressVersion\" : \"IPv4\" , \"publicIPAllocationMethod\" : \"Static\" , \"idleTimeoutInMinutes\" : 4 , \"ipTags\" : [] } } Configure with Bicep # To configure zone-redundancy for a Public IP address. Set sku.name to Standard . Set zones to ['1', '2', '3'] . For example: resource publicIPAddresses_resource 'Microsoft.Network/publicIPAddresses@2020-11-01' = { name: name location: location sku: { name: 'Standard' tier: 'Regional' } zones: [ '2' '3' '1' ] properties: { ipAddress: ipAddress publicIPAddressVersion: 'IPv4' publicIPAllocationMethod: 'Static' idleTimeoutInMinutes: 4 ipTags: [] } } Links # Azure template reference Load Balancer and Availability Zones Use zone-aware services","title":"Azure.PublicIP.AvailabilityZone"},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/#public-ip-addresses-should-use-availability-zones","text":"Azure.PublicIP.AvailabilityZone AZR-000157 Error Reliability \u00b7 Public IP address \u00b7 2021_12 Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability.","title":"Public IP addresses should use availability zones"},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/#description","text":"Public IP addresses using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. A zone redundant Public IP address can spread across multiple availability zones, which ensures the Public IP address will continue running even if another zone has gone down. Furthermore, this ensures Public Standard Load balancer frontend IPs using a zone-redundant Public IP address can survive zone failure.","title":"Description"},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/#recommendation","text":"Consider using zone-redundant Public IP addresses deployed with Standard SKU.","title":"Recommendation"},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/#notes","text":"This rule is not applicable for public IP addresses used for Azure Bastion. Azure Bastion does not currently support Availability Zones. Public IP addresses with the following tags are automatically excluded from this rule: resource-usage tag set to azure-bastion . This rule fails when \"zones\" is constrained to a single(zonal) zone, or set to null , [] when there are supported availability zones for the given region. This rule passes if no zones exist for a given region or \"zones\" is set to [\"1\", \"2\", \"3\"] . Configure AZURE_PUBLICIP_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST to set additional availability zones that need to be supported which are not in the existing providers for namespace Microsoft.Network and resource type publicIpAddresses . # YAML: The default AZURE_PUBLICIP_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option configuration : AZURE_PUBLICIP_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : []","title":"Notes"},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/#configure-with-azure-template","text":"To configure zone-redundancy for a Public IP address. Set sku.name to Standard . Set zones to [\"1\", \"2\", \"3\"] . For example: { \"type\" : \"Microsoft.Network/publicIPAddresses\" , \"apiVersion\" : \"2020-11-01\" , \"name\" : \"[parameters('publicIPAddresses_test_ip_name')]\" , \"location\" : \"australiaeast\" , \"sku\" : { \"name\" : \"Standard\" , \"tier\" : \"Regional\" }, \"zones\" : [ \"2\" , \"3\" , \"1\" ], \"properties\" : { \"ipAddress\" : \"[parameters('publicIPAddresses_ip_address')]\" , \"publicIPAddressVersion\" : \"IPv4\" , \"publicIPAllocationMethod\" : \"Static\" , \"idleTimeoutInMinutes\" : 4 , \"ipTags\" : [] } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/#configure-with-bicep","text":"To configure zone-redundancy for a Public IP address. Set sku.name to Standard . Set zones to ['1', '2', '3'] . For example: resource publicIPAddresses_resource 'Microsoft.Network/publicIPAddresses@2020-11-01' = { name: name location: location sku: { name: 'Standard' tier: 'Regional' } zones: [ '2' '3' '1' ] properties: { ipAddress: ipAddress publicIPAddressVersion: 'IPv4' publicIPAllocationMethod: 'Static' idleTimeoutInMinutes: 4 ipTags: [] } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/#links","text":"Azure template reference Load Balancer and Availability Zones Use zone-aware services","title":"Links"},{"location":"en/rules/Azure.PublicIP.DNSLabel/","tags":["Azure.PublicIP.DNSLabel","AZR-000156"],"text":"Use valid Public IP DNS labels # Azure.PublicIP.DNSLabel AZR-000156 Error Operational Excellence \u00b7 Public IP address \u00b7 2020_06 Public IP domain name labels should meet naming requirements. Description # When configuring Azure Public IP addresses domain name labels must meet naming requirements. The requirements for Public IP domain name labels are: Between 3 and 63 characters long. Lowercase letters, numbers, and hyphens. Start with a letter. End a letter or number. Domain name labels must be globally unique within a region. Recommendation # Consider using domain name labels that meet Public IP naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Public IP domain name labels are unique. Links # Naming rules and restrictions for Azure resources","title":"Azure.PublicIP.DNSLabel"},{"location":"en/rules/Azure.PublicIP.DNSLabel/#use-valid-public-ip-dns-labels","text":"Azure.PublicIP.DNSLabel AZR-000156 Error Operational Excellence \u00b7 Public IP address \u00b7 2020_06 Public IP domain name labels should meet naming requirements.","title":"Use valid Public IP DNS labels"},{"location":"en/rules/Azure.PublicIP.DNSLabel/#description","text":"When configuring Azure Public IP addresses domain name labels must meet naming requirements. The requirements for Public IP domain name labels are: Between 3 and 63 characters long. Lowercase letters, numbers, and hyphens. Start with a letter. End a letter or number. Domain name labels must be globally unique within a region.","title":"Description"},{"location":"en/rules/Azure.PublicIP.DNSLabel/#recommendation","text":"Consider using domain name labels that meet Public IP naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.PublicIP.DNSLabel/#notes","text":"This rule does not check if Public IP domain name labels are unique.","title":"Notes"},{"location":"en/rules/Azure.PublicIP.DNSLabel/#links","text":"Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.PublicIP.IsAttached/","tags":["Azure.PublicIP.IsAttached","AZR-000154"],"text":"Remove unused Public IP addresses # Azure.PublicIP.IsAttached AZR-000154 Error Cost Optimization \u00b7 Public IP address \u00b7 2020_06 Public IP address should be attached or removed. Description # Unattached static Public IP address are charged when not in use. Recommendation # Consider removing Public IP addresses that are no longer required reduce complexity and costs. Links # Principles of cost optimization Public IP address pricing","title":"Azure.PublicIP.IsAttached"},{"location":"en/rules/Azure.PublicIP.IsAttached/#remove-unused-public-ip-addresses","text":"Azure.PublicIP.IsAttached AZR-000154 Error Cost Optimization \u00b7 Public IP address \u00b7 2020_06 Public IP address should be attached or removed.","title":"Remove unused Public IP addresses"},{"location":"en/rules/Azure.PublicIP.IsAttached/#description","text":"Unattached static Public IP address are charged when not in use.","title":"Description"},{"location":"en/rules/Azure.PublicIP.IsAttached/#recommendation","text":"Consider removing Public IP addresses that are no longer required reduce complexity and costs.","title":"Recommendation"},{"location":"en/rules/Azure.PublicIP.IsAttached/#links","text":"Principles of cost optimization Public IP address pricing","title":"Links"},{"location":"en/rules/Azure.PublicIP.Name/","tags":["Azure.PublicIP.Name","AZR-000155"],"text":"Use valid Public IP names # Azure.PublicIP.Name AZR-000155 Error Operational Excellence \u00b7 Public IP address \u00b7 2020_06 Public IP names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Public IP names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Public IP names must be unique within a resource group. Recommendation # Consider using names that meet Public IP naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Public IP names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.PublicIP.Name"},{"location":"en/rules/Azure.PublicIP.Name/#use-valid-public-ip-names","text":"Azure.PublicIP.Name AZR-000155 Error Operational Excellence \u00b7 Public IP address \u00b7 2020_06 Public IP names should meet naming requirements.","title":"Use valid Public IP names"},{"location":"en/rules/Azure.PublicIP.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Public IP names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Public IP names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.PublicIP.Name/#recommendation","text":"Consider using names that meet Public IP naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.PublicIP.Name/#notes","text":"This rule does not check if Public IP names are unique.","title":"Notes"},{"location":"en/rules/Azure.PublicIP.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.PublicIP.StandardSKU/","tags":["Azure.PublicIP.StandardSKU","AZR-000158"],"text":"Public IP addresses should use Standard SKU # Azure.PublicIP.StandardSKU AZR-000158 Error Reliability \u00b7 Public IP address \u00b7 2021_12 Public IP addresses should be deployed with Standard SKU for production workloads. Description # Standard Public IPs are designed with the \"secure by default\" model and are closed to inbound traffic when uses as a frontend. Network security groups are required to allow inbound traffic. For example, a network security group can be attached on the NIC of a virtual machine with a Standard Public IP address attached. It also enables zone-redundancy(all three zones), zonal(constrained to a single zone) or no-zone(no pre-selected availability zone). It can also choose routing preferences between Microsoft global network and the internet. Recommendation # Consider using Standard SKU for Public IP addresses deployed in production. Examples # Configure with Azure template # To configure Standard SKU for a Public IP address. Set sku.name to Standard . For example: { \"type\" : \"Microsoft.Network/publicIPAddresses\" , \"apiVersion\" : \"2020-11-01\" , \"name\" : \"[parameters('publicIPAddresses_test_ip_name')]\" , \"location\" : \"australiaeast\" , \"sku\" : { \"name\" : \"Standard\" , \"tier\" : \"Regional\" }, \"zones\" : [ \"2\" , \"3\" , \"1\" ], \"properties\" : { \"ipAddress\" : \"[parameters('publicIPAddresses_ip_address')]\" , \"publicIPAddressVersion\" : \"IPv4\" , \"publicIPAllocationMethod\" : \"Static\" , \"idleTimeoutInMinutes\" : 4 , \"ipTags\" : [] } } Configure with Bicep # To configure Standard SKU for a Public IP address. Set sku.name to Standard . For example: For example: resource publicIPAddresses_resource 'Microsoft.Network/publicIPAddresses@2020-11-01' = { name: name location: location sku: { name: 'Standard' tier: 'Regional' } zones: [ '2' '3' '1' ] properties: { ipAddress: ipAddress publicIPAddressVersion: 'IPv4' publicIPAllocationMethod: 'Static' idleTimeoutInMinutes: 4 ipTags: [] } } Links # Azure template reference Standard Public IP addresses Load Balancer and Availability Zones Meet application platform requirements","title":"Azure.PublicIP.StandardSKU"},{"location":"en/rules/Azure.PublicIP.StandardSKU/#public-ip-addresses-should-use-standard-sku","text":"Azure.PublicIP.StandardSKU AZR-000158 Error Reliability \u00b7 Public IP address \u00b7 2021_12 Public IP addresses should be deployed with Standard SKU for production workloads.","title":"Public IP addresses should use Standard SKU"},{"location":"en/rules/Azure.PublicIP.StandardSKU/#description","text":"Standard Public IPs are designed with the \"secure by default\" model and are closed to inbound traffic when uses as a frontend. Network security groups are required to allow inbound traffic. For example, a network security group can be attached on the NIC of a virtual machine with a Standard Public IP address attached. It also enables zone-redundancy(all three zones), zonal(constrained to a single zone) or no-zone(no pre-selected availability zone). It can also choose routing preferences between Microsoft global network and the internet.","title":"Description"},{"location":"en/rules/Azure.PublicIP.StandardSKU/#recommendation","text":"Consider using Standard SKU for Public IP addresses deployed in production.","title":"Recommendation"},{"location":"en/rules/Azure.PublicIP.StandardSKU/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.PublicIP.StandardSKU/#configure-with-azure-template","text":"To configure Standard SKU for a Public IP address. Set sku.name to Standard . For example: { \"type\" : \"Microsoft.Network/publicIPAddresses\" , \"apiVersion\" : \"2020-11-01\" , \"name\" : \"[parameters('publicIPAddresses_test_ip_name')]\" , \"location\" : \"australiaeast\" , \"sku\" : { \"name\" : \"Standard\" , \"tier\" : \"Regional\" }, \"zones\" : [ \"2\" , \"3\" , \"1\" ], \"properties\" : { \"ipAddress\" : \"[parameters('publicIPAddresses_ip_address')]\" , \"publicIPAddressVersion\" : \"IPv4\" , \"publicIPAllocationMethod\" : \"Static\" , \"idleTimeoutInMinutes\" : 4 , \"ipTags\" : [] } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.PublicIP.StandardSKU/#configure-with-bicep","text":"To configure Standard SKU for a Public IP address. Set sku.name to Standard . For example: For example: resource publicIPAddresses_resource 'Microsoft.Network/publicIPAddresses@2020-11-01' = { name: name location: location sku: { name: 'Standard' tier: 'Regional' } zones: [ '2' '3' '1' ] properties: { ipAddress: ipAddress publicIPAddressVersion: 'IPv4' publicIPAllocationMethod: 'Static' idleTimeoutInMinutes: 4 ipTags: [] } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.PublicIP.StandardSKU/#links","text":"Azure template reference Standard Public IP addresses Load Balancer and Availability Zones Meet application platform requirements","title":"Links"},{"location":"en/rules/Azure.RBAC.CoAdministrator/","tags":["Azure.RBAC.CoAdministrator","AZR-000206"],"text":"Use role-based access control # Azure.RBAC.CoAdministrator AZR-000206 Error Security \u00b7 Subscription \u00b7 2020_06 Delegate access to manage Azure resources using role-based access control (RBAC). Description # Use of Co-administrator is intended to support management of resources deployed using the Classic deployment model. Resources deployed in the Resource Manager model do not require delegation of Co-administrators. Azure RBAC provides greater flexibility and control providing over 100 built-in roles. Additionally RBAC works with advanced advanced security features like Privileged Identity Management (PIM). Recommendation # Consider delegating access to manage Azure resources using RBAC instead of classic Co-administrator roles. Limit delegation of Co-administrator roles only to subscription that contain resources deployed in the Classic deployment model. Links # Azure classic subscription administrators Classic subscription administrator roles, Azure RBAC roles, and Azure AD administrator roles What is Azure AD Privileged Identity Management?","title":"Azure.RBAC.CoAdministrator"},{"location":"en/rules/Azure.RBAC.CoAdministrator/#use-role-based-access-control","text":"Azure.RBAC.CoAdministrator AZR-000206 Error Security \u00b7 Subscription \u00b7 2020_06 Delegate access to manage Azure resources using role-based access control (RBAC).","title":"Use role-based access control"},{"location":"en/rules/Azure.RBAC.CoAdministrator/#description","text":"Use of Co-administrator is intended to support management of resources deployed using the Classic deployment model. Resources deployed in the Resource Manager model do not require delegation of Co-administrators. Azure RBAC provides greater flexibility and control providing over 100 built-in roles. Additionally RBAC works with advanced advanced security features like Privileged Identity Management (PIM).","title":"Description"},{"location":"en/rules/Azure.RBAC.CoAdministrator/#recommendation","text":"Consider delegating access to manage Azure resources using RBAC instead of classic Co-administrator roles. Limit delegation of Co-administrator roles only to subscription that contain resources deployed in the Classic deployment model.","title":"Recommendation"},{"location":"en/rules/Azure.RBAC.CoAdministrator/#links","text":"Azure classic subscription administrators Classic subscription administrator roles, Azure RBAC roles, and Azure AD administrator roles What is Azure AD Privileged Identity Management?","title":"Links"},{"location":"en/rules/Azure.RBAC.LimitMGDelegation/","tags":["Azure.RBAC.LimitMGDelegation","AZR-000205"],"text":"Limit Management Group delegation # Azure.RBAC.LimitMGDelegation AZR-000205 Error Security \u00b7 Subscription \u00b7 2020_06 Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Description # RBAC in Azure inherits from management group to subscription to resource group to resource. Management group RBAC assignments have broad impact. Recommendation # Consider limiting the number of assignment inherited from Management Groups by scoping permission to individual Resource Group. Azure Blueprints can be used to rollout standard RBAC assignments to common resources. Additionally RBAC assignments can be deployed using Azure Resource Manager templates.","title":"Azure.RBAC.LimitMGDelegation"},{"location":"en/rules/Azure.RBAC.LimitMGDelegation/#limit-management-group-delegation","text":"Azure.RBAC.LimitMGDelegation AZR-000205 Error Security \u00b7 Subscription \u00b7 2020_06 Limit Role-Base Access Control (RBAC) inheritance from Management Groups.","title":"Limit Management Group delegation"},{"location":"en/rules/Azure.RBAC.LimitMGDelegation/#description","text":"RBAC in Azure inherits from management group to subscription to resource group to resource. Management group RBAC assignments have broad impact.","title":"Description"},{"location":"en/rules/Azure.RBAC.LimitMGDelegation/#recommendation","text":"Consider limiting the number of assignment inherited from Management Groups by scoping permission to individual Resource Group. Azure Blueprints can be used to rollout standard RBAC assignments to common resources. Additionally RBAC assignments can be deployed using Azure Resource Manager templates.","title":"Recommendation"},{"location":"en/rules/Azure.RBAC.LimitOwner/","tags":["Azure.RBAC.LimitOwner","AZR-000204"],"text":"Limit use of subscription scoped Owner role # Azure.RBAC.LimitOwner AZR-000204 Error Security \u00b7 Subscription \u00b7 2020_06 Limit the number of subscription Owners. Description # Azure provides a flexible delegation model using Role-Base Access Control (RBAC). RBAC allows administrators to grant fine grained permissions using roles to Azure resources. Over 100 built-in roles exist, and custom roles can be created to perform specific tasks. Permissions can be scoped to management group, subscription, resource group or individual resources. The Owner role provides the ability to create, delete, update and configure permissions for any resource. When assigned at the subscription scope, these permissions apply to the whole subscription and all resources in the subscription. Recommendation # Consider limiting the number of subscription Owners by using a more specific role or scoping Owner permission to a Resource Group. Links # What is Azure role-based access control (Azure RBAC)? Limit the number of subscription owners","title":"Azure.RBAC.LimitOwner"},{"location":"en/rules/Azure.RBAC.LimitOwner/#limit-use-of-subscription-scoped-owner-role","text":"Azure.RBAC.LimitOwner AZR-000204 Error Security \u00b7 Subscription \u00b7 2020_06 Limit the number of subscription Owners.","title":"Limit use of subscription scoped Owner role"},{"location":"en/rules/Azure.RBAC.LimitOwner/#description","text":"Azure provides a flexible delegation model using Role-Base Access Control (RBAC). RBAC allows administrators to grant fine grained permissions using roles to Azure resources. Over 100 built-in roles exist, and custom roles can be created to perform specific tasks. Permissions can be scoped to management group, subscription, resource group or individual resources. The Owner role provides the ability to create, delete, update and configure permissions for any resource. When assigned at the subscription scope, these permissions apply to the whole subscription and all resources in the subscription.","title":"Description"},{"location":"en/rules/Azure.RBAC.LimitOwner/#recommendation","text":"Consider limiting the number of subscription Owners by using a more specific role or scoping Owner permission to a Resource Group.","title":"Recommendation"},{"location":"en/rules/Azure.RBAC.LimitOwner/#links","text":"What is Azure role-based access control (Azure RBAC)? Limit the number of subscription owners","title":"Links"},{"location":"en/rules/Azure.RBAC.PIM/","tags":["Azure.RBAC.PIM","AZR-000208"],"text":"Use JiT role activation with PIM # Azure.RBAC.PIM AZR-000208 Error Security \u00b7 Subscription \u00b7 2020_09 Use just-in-time (JiT) activation of roles instead of persistent role assignment. Description # PIM helps manage the impact of identity compromise or misuse of permissions by reducing persistent access. With PIM, eligible identities can activate time-bound role assignments on an as needed basis (just-in-time). Activation typically occurs before a schedule change or management operation. PIM is an Azure Active Directory (AD) feature included in Azure AD Premium P2. Recommendation # Consider using Privileged Identity Management (PIM) to activate privileged roles on an as needed basis. Links # What is Azure AD Privileged Identity Management? Discover Azure resources to manage in Privileged Identity Management Configure Azure resource role settings in Privileged Identity Management Lower exposure of privileged accounts No standing access / Just in Time privileges Use Azure AD Privileged Identity Management","title":"Azure.RBAC.PIM"},{"location":"en/rules/Azure.RBAC.PIM/#use-jit-role-activation-with-pim","text":"Azure.RBAC.PIM AZR-000208 Error Security \u00b7 Subscription \u00b7 2020_09 Use just-in-time (JiT) activation of roles instead of persistent role assignment.","title":"Use JiT role activation with PIM"},{"location":"en/rules/Azure.RBAC.PIM/#description","text":"PIM helps manage the impact of identity compromise or misuse of permissions by reducing persistent access. With PIM, eligible identities can activate time-bound role assignments on an as needed basis (just-in-time). Activation typically occurs before a schedule change or management operation. PIM is an Azure Active Directory (AD) feature included in Azure AD Premium P2.","title":"Description"},{"location":"en/rules/Azure.RBAC.PIM/#recommendation","text":"Consider using Privileged Identity Management (PIM) to activate privileged roles on an as needed basis.","title":"Recommendation"},{"location":"en/rules/Azure.RBAC.PIM/#links","text":"What is Azure AD Privileged Identity Management? Discover Azure resources to manage in Privileged Identity Management Configure Azure resource role settings in Privileged Identity Management Lower exposure of privileged accounts No standing access / Just in Time privileges Use Azure AD Privileged Identity Management","title":"Links"},{"location":"en/rules/Azure.RBAC.UseGroups/","tags":["Azure.RBAC.UseGroups","AZR-000203"],"text":"Use groups # Azure.RBAC.UseGroups AZR-000203 Error Security \u00b7 Subscription \u00b7 2020_06 Use groups for assigning permissions instead of individual user accounts. Description # Granting access with individual user accounts can bypass existing on-premises identity management tools and processes. Recommendation # Consider using groups for assigning permissions instead of individual user accounts. Links # Avoid granular and custom permissions What is Azure role-based access control (Azure RBAC)?","title":"Azure.RBAC.UseGroups"},{"location":"en/rules/Azure.RBAC.UseGroups/#use-groups","text":"Azure.RBAC.UseGroups AZR-000203 Error Security \u00b7 Subscription \u00b7 2020_06 Use groups for assigning permissions instead of individual user accounts.","title":"Use groups"},{"location":"en/rules/Azure.RBAC.UseGroups/#description","text":"Granting access with individual user accounts can bypass existing on-premises identity management tools and processes.","title":"Description"},{"location":"en/rules/Azure.RBAC.UseGroups/#recommendation","text":"Consider using groups for assigning permissions instead of individual user accounts.","title":"Recommendation"},{"location":"en/rules/Azure.RBAC.UseGroups/#links","text":"Avoid granular and custom permissions What is Azure role-based access control (Azure RBAC)?","title":"Links"},{"location":"en/rules/Azure.RBAC.UseRGDelegation/","tags":["Azure.RBAC.UseRGDelegation","AZR-000207"],"text":"Use Resource Group delegation # Azure.RBAC.UseRGDelegation AZR-000207 Error Security \u00b7 Subscription \u00b7 2020_06 Use RBAC assignments on resource groups instead of individual resources. Description # Azure provides a flexible delegation model using RBAC that allows administrators to grant fine grained permissions using roles to Azure resources. Permissions can be scoped to management group, subscription, resource group or individual resources. Recommendation # Consider using RBAC assignments on resource groups instead of individual resources. Links # Avoid granular and custom permissions What is Azure role-based access control (Azure RBAC)? Best practices for Azure RBAC","title":"Azure.RBAC.UseRGDelegation"},{"location":"en/rules/Azure.RBAC.UseRGDelegation/#use-resource-group-delegation","text":"Azure.RBAC.UseRGDelegation AZR-000207 Error Security \u00b7 Subscription \u00b7 2020_06 Use RBAC assignments on resource groups instead of individual resources.","title":"Use Resource Group delegation"},{"location":"en/rules/Azure.RBAC.UseRGDelegation/#description","text":"Azure provides a flexible delegation model using RBAC that allows administrators to grant fine grained permissions using roles to Azure resources. Permissions can be scoped to management group, subscription, resource group or individual resources.","title":"Description"},{"location":"en/rules/Azure.RBAC.UseRGDelegation/#recommendation","text":"Consider using RBAC assignments on resource groups instead of individual resources.","title":"Recommendation"},{"location":"en/rules/Azure.RBAC.UseRGDelegation/#links","text":"Avoid granular and custom permissions What is Azure role-based access control (Azure RBAC)? Best practices for Azure RBAC","title":"Links"},{"location":"en/rules/Azure.RSV.ReplicationAlert/","tags":["Azure.RSV.ReplicationAlert","AZR-000171"],"text":"Use geo-replicated storage # Azure.RSV.ReplicationAlert AZR-000171 Error Reliability \u00b7 Azure Recovery Services Vault (RSV) \u00b7 2022_03 Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Description # Recovery Services Vaults (RSV) can be used to replicate virtual machines between Azure Regions. Alerts can be configured to send notifications when replication issues occur. The replication alerts can be configured for: The resources owners (Based on RBAC permissions). A list of email addresses. Recommendation # Configure replication alerts for Recovery Service Vaults that are performing replication tasks. Examples # Configure with Azure template # By default a Recovery Services vaults does not have replication alerts setup. To define a replication alert via ARM templates either configure the sendToOwners or CustomerEmailAddress properties: Set properties.sendToOwners to Send . Set properties.customEmailAddresses to [ \"example@email.com\" ] For example: { \"type\" : \"Microsoft.RecoveryServices/vaults/replicationAlertSettings\" , \"apiVersion\" : \"2021-08-01\" , \"name\" : \"replicationAlert\" , \"properties\" : { \"sendToOwners\" : \"Send\" , \"customEmailAddresses\" : [ \"example@email.com\" ] } } Configure with Bicep # By default a Recovery Services vaults does not have replication alerts setup. To define a replication alert via a Bicep either configure the sendToOwners or CustomerEmailAddress properties: Set properties.sendToOwners to Send . Set properties.customEmailAddresses to [ \"example@email.com\" ] For example: resource testRecoveryServices 'Microsoft.RecoveryServices/vaults/replicationAlertSettings@2021-08-01' = { name: 'replicationAlert' location: 'string' parent: resourceSymbolicName properties: { sendToOwners: 'Sender' customEmailAddresses: [ 'example@email.com' ] } } Links # Recovery Services Vault - Overview Recovery Services Vault - Replication Alerts Azure template reference Well Architected Framework - Reliability","title":"Azure.RSV.ReplicationAlert"},{"location":"en/rules/Azure.RSV.ReplicationAlert/#use-geo-replicated-storage","text":"Azure.RSV.ReplicationAlert AZR-000171 Error Reliability \u00b7 Azure Recovery Services Vault (RSV) \u00b7 2022_03 Recovery Services Vaults (RSV) without replication alerts configured may be at risk.","title":"Use geo-replicated storage"},{"location":"en/rules/Azure.RSV.ReplicationAlert/#description","text":"Recovery Services Vaults (RSV) can be used to replicate virtual machines between Azure Regions. Alerts can be configured to send notifications when replication issues occur. The replication alerts can be configured for: The resources owners (Based on RBAC permissions). A list of email addresses.","title":"Description"},{"location":"en/rules/Azure.RSV.ReplicationAlert/#recommendation","text":"Configure replication alerts for Recovery Service Vaults that are performing replication tasks.","title":"Recommendation"},{"location":"en/rules/Azure.RSV.ReplicationAlert/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.RSV.ReplicationAlert/#configure-with-azure-template","text":"By default a Recovery Services vaults does not have replication alerts setup. To define a replication alert via ARM templates either configure the sendToOwners or CustomerEmailAddress properties: Set properties.sendToOwners to Send . Set properties.customEmailAddresses to [ \"example@email.com\" ] For example: { \"type\" : \"Microsoft.RecoveryServices/vaults/replicationAlertSettings\" , \"apiVersion\" : \"2021-08-01\" , \"name\" : \"replicationAlert\" , \"properties\" : { \"sendToOwners\" : \"Send\" , \"customEmailAddresses\" : [ \"example@email.com\" ] } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.RSV.ReplicationAlert/#configure-with-bicep","text":"By default a Recovery Services vaults does not have replication alerts setup. To define a replication alert via a Bicep either configure the sendToOwners or CustomerEmailAddress properties: Set properties.sendToOwners to Send . Set properties.customEmailAddresses to [ \"example@email.com\" ] For example: resource testRecoveryServices 'Microsoft.RecoveryServices/vaults/replicationAlertSettings@2021-08-01' = { name: 'replicationAlert' location: 'string' parent: resourceSymbolicName properties: { sendToOwners: 'Sender' customEmailAddresses: [ 'example@email.com' ] } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.RSV.ReplicationAlert/#links","text":"Recovery Services Vault - Overview Recovery Services Vault - Replication Alerts Azure template reference Well Architected Framework - Reliability","title":"Links"},{"location":"en/rules/Azure.RSV.StorageType/","tags":["Azure.RSV.StorageType","AZR-000170"],"text":"Use geo-replicated storage # Azure.RSV.StorageType AZR-000170 Error Reliability \u00b7 Azure Recovery Services Vault (RSV) \u00b7 2022_03 Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Description # Recovery Services Vaults can be configured with several different durability options. Azure provides a number of geo-replicated options for storage including; Geo-redundant storage and read access geo-zone-redundant storage. The default storage type used will be Geo-redundant Geo-zone-redundant storage is only available in supported regions. The following geo-replicated options are available for recovery services vaults: GeoRedundant ReadAccessGeoZoneRedundant Recommendation # Consider using GeoRedundant for recovery services vaults that contain data. Examples # Configure with Azure template # The default storage type used by Recovery Services vaults is Geo-redundant. However if you're defining the backup config in an ARM template: Set properties.storageType to either GeoRedundant or ReadAccessGeoZoneRedundant . For example: { \"type\" : \"Microsoft.RecoveryServices/vaults/backupconfig\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"vaultconfig-a\" , \"location\" : \"australiaeast\" , \"tags\" : {}, \"properties\" : { \"storageType\" : \"GeoRedundant\" } } Configure with Bicep # The default storage type used by Recovery Services vaults is Geo-redundant. However if you're defining the backup config via Bicep: Set properties.storageType to either GeoRedundant or ReadAccessGeoZoneRedundant . For example: resource testRecoveryServices 'Microsoft.RecoveryServices/vaults/backupconfig@2021-10-01' = { name: 'vaultconfig' location: 'string' parent: resourceSymbolicName properties: { storageType: 'GeoRedundant' } } Links # Recovery Services Vault - Overview Recovery Services Vault - Storage Settings Azure template reference Well Architected Framework - Reliability","title":"Azure.RSV.StorageType"},{"location":"en/rules/Azure.RSV.StorageType/#use-geo-replicated-storage","text":"Azure.RSV.StorageType AZR-000170 Error Reliability \u00b7 Azure Recovery Services Vault (RSV) \u00b7 2022_03 Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk.","title":"Use geo-replicated storage"},{"location":"en/rules/Azure.RSV.StorageType/#description","text":"Recovery Services Vaults can be configured with several different durability options. Azure provides a number of geo-replicated options for storage including; Geo-redundant storage and read access geo-zone-redundant storage. The default storage type used will be Geo-redundant Geo-zone-redundant storage is only available in supported regions. The following geo-replicated options are available for recovery services vaults: GeoRedundant ReadAccessGeoZoneRedundant","title":"Description"},{"location":"en/rules/Azure.RSV.StorageType/#recommendation","text":"Consider using GeoRedundant for recovery services vaults that contain data.","title":"Recommendation"},{"location":"en/rules/Azure.RSV.StorageType/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.RSV.StorageType/#configure-with-azure-template","text":"The default storage type used by Recovery Services vaults is Geo-redundant. However if you're defining the backup config in an ARM template: Set properties.storageType to either GeoRedundant or ReadAccessGeoZoneRedundant . For example: { \"type\" : \"Microsoft.RecoveryServices/vaults/backupconfig\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"vaultconfig-a\" , \"location\" : \"australiaeast\" , \"tags\" : {}, \"properties\" : { \"storageType\" : \"GeoRedundant\" } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.RSV.StorageType/#configure-with-bicep","text":"The default storage type used by Recovery Services vaults is Geo-redundant. However if you're defining the backup config via Bicep: Set properties.storageType to either GeoRedundant or ReadAccessGeoZoneRedundant . For example: resource testRecoveryServices 'Microsoft.RecoveryServices/vaults/backupconfig@2021-10-01' = { name: 'vaultconfig' location: 'string' parent: resourceSymbolicName properties: { storageType: 'GeoRedundant' } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.RSV.StorageType/#links","text":"Recovery Services Vault - Overview Recovery Services Vault - Storage Settings Azure template reference Well Architected Framework - Reliability","title":"Links"},{"location":"en/rules/Azure.Redis.AvailabilityZone/","tags":["Azure.Redis.AvailabilityZone","AZR-000161"],"text":"Redis cache should use Availability zones in supported regions # Azure.Redis.AvailabilityZone AZR-000161 Error Reliability \u00b7 Azure Cache for Redis \u00b7 2021_12 Premium Redis cache should be deployed with availability zones for high availability. Description # Redis Cache using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. Nodes in one availability zone are physically separated from nodes defined in another availability zone. By spreading node pools across multiple zones, nodes in one node pool will continue running even if another zone has gone down. Recommendation # Consider using availability zones for Premium Redis Cache deployed in supported regions. Notes # This rule applies when analyzing resources deployed to Azure using pre-flight and in-flight data. This rule fails when \"zones\" is null , [] or less than two zones are used when there are availability zones for the given region. This rule fails when cache is not zone redundant(1, 2 and 3) when there are availability zones for the given region. Configure AZURE_REDISCACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST to set additional availability zones that need to be supported which are not in the existing providers for namespace Microsoft.Cache and resource type Redis . # YAML: The default AZURE_REDISCACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option configuration : AZURE_REDISCACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : [] Examples # Configure with Azure template # To set availability zones for Premium SKU Redis Cache: Set zones to a minimum of two zones from [\"1\", \"2\", \"3\"] . Set Properties.replicasPerMaster to number of zones - 1, to ensure you have at least as many nodes as zones you are replicating to. Set Properties.sku.name to Premium . Set Properties.sku.family to P . Set Properties.sku.capacity to one of [1, 2, 3, 4, 5] , depending on the SKU you picked: P1 - 6 GB P2 - 13 GB P3 - 26 GB P4 - 53 GB P5 - 120 GB For example: { \"name\" : \"testrediscache\" , \"type\" : \"Microsoft.Cache/redis\" , \"apiVersion\" : \"2021-06-01\" , \"location\" : \"australiaeast\" , \"dependsOn\" : [], \"properties\" : { \"sku\" : { \"name\" : \"Premium\" , \"family\" : \"P\" , \"capacity\" : 1 }, \"redisConfiguration\" : {}, \"enableNonSslPort\" : false , \"redisVersion\" : \"4\" , \"replicasPerMaster\" : 2 }, \"zones\" : [ \"1\" , \"2\" , \"3\" ], \"tags\" : {} } Configure with Bicep # To set availability zones for Premium SKU Redis Cache: Set zones to a minimum of two zones from [\"1\", \"2\", \"3\"] . Set Properties.replicasPerMaster to number of zones - 1, to ensure you have at least as many nodes as zones you are replicating to. Set Properties.sku.name to Premium . Set Properties.sku.family to P . Set Properties.sku.capacity to one of [1, 2, 3, 4, 5] , depending on the SKU you picked: P1 - 6 GB P2 - 13 GB P3 - 26 GB P4 - 53 GB P5 - 120 GB For example: resource testrediscache 'Microsoft.Cache/redis@2021-06-01' = { name: 'testrediscache' location: 'australiaeast' properties: { sku: { name: 'Premium' family: 'P' capacity: 1 } redisConfiguration: {} enableNonSslPort: false redisVersion: '4' replicasPerMaster: 2 } zones: [ '1' '2' '3' ] tags: {} dependsOn: [] } Links # Use zone-aware services Enable zone redundancy for Azure Cache for Redis High availability for Azure Cache for Redis Azure Template reference","title":"Azure.Redis.AvailabilityZone"},{"location":"en/rules/Azure.Redis.AvailabilityZone/#redis-cache-should-use-availability-zones-in-supported-regions","text":"Azure.Redis.AvailabilityZone AZR-000161 Error Reliability \u00b7 Azure Cache for Redis \u00b7 2021_12 Premium Redis cache should be deployed with availability zones for high availability.","title":"Redis cache should use Availability zones in supported regions"},{"location":"en/rules/Azure.Redis.AvailabilityZone/#description","text":"Redis Cache using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. Nodes in one availability zone are physically separated from nodes defined in another availability zone. By spreading node pools across multiple zones, nodes in one node pool will continue running even if another zone has gone down.","title":"Description"},{"location":"en/rules/Azure.Redis.AvailabilityZone/#recommendation","text":"Consider using availability zones for Premium Redis Cache deployed in supported regions.","title":"Recommendation"},{"location":"en/rules/Azure.Redis.AvailabilityZone/#notes","text":"This rule applies when analyzing resources deployed to Azure using pre-flight and in-flight data. This rule fails when \"zones\" is null , [] or less than two zones are used when there are availability zones for the given region. This rule fails when cache is not zone redundant(1, 2 and 3) when there are availability zones for the given region. Configure AZURE_REDISCACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST to set additional availability zones that need to be supported which are not in the existing providers for namespace Microsoft.Cache and resource type Redis . # YAML: The default AZURE_REDISCACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option configuration : AZURE_REDISCACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : []","title":"Notes"},{"location":"en/rules/Azure.Redis.AvailabilityZone/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Redis.AvailabilityZone/#configure-with-azure-template","text":"To set availability zones for Premium SKU Redis Cache: Set zones to a minimum of two zones from [\"1\", \"2\", \"3\"] . Set Properties.replicasPerMaster to number of zones - 1, to ensure you have at least as many nodes as zones you are replicating to. Set Properties.sku.name to Premium . Set Properties.sku.family to P . Set Properties.sku.capacity to one of [1, 2, 3, 4, 5] , depending on the SKU you picked: P1 - 6 GB P2 - 13 GB P3 - 26 GB P4 - 53 GB P5 - 120 GB For example: { \"name\" : \"testrediscache\" , \"type\" : \"Microsoft.Cache/redis\" , \"apiVersion\" : \"2021-06-01\" , \"location\" : \"australiaeast\" , \"dependsOn\" : [], \"properties\" : { \"sku\" : { \"name\" : \"Premium\" , \"family\" : \"P\" , \"capacity\" : 1 }, \"redisConfiguration\" : {}, \"enableNonSslPort\" : false , \"redisVersion\" : \"4\" , \"replicasPerMaster\" : 2 }, \"zones\" : [ \"1\" , \"2\" , \"3\" ], \"tags\" : {} }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Redis.AvailabilityZone/#configure-with-bicep","text":"To set availability zones for Premium SKU Redis Cache: Set zones to a minimum of two zones from [\"1\", \"2\", \"3\"] . Set Properties.replicasPerMaster to number of zones - 1, to ensure you have at least as many nodes as zones you are replicating to. Set Properties.sku.name to Premium . Set Properties.sku.family to P . Set Properties.sku.capacity to one of [1, 2, 3, 4, 5] , depending on the SKU you picked: P1 - 6 GB P2 - 13 GB P3 - 26 GB P4 - 53 GB P5 - 120 GB For example: resource testrediscache 'Microsoft.Cache/redis@2021-06-01' = { name: 'testrediscache' location: 'australiaeast' properties: { sku: { name: 'Premium' family: 'P' capacity: 1 } redisConfiguration: {} enableNonSslPort: false redisVersion: '4' replicasPerMaster: 2 } zones: [ '1' '2' '3' ] tags: {} dependsOn: [] }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Redis.AvailabilityZone/#links","text":"Use zone-aware services Enable zone redundancy for Azure Cache for Redis High availability for Azure Cache for Redis Azure Template reference","title":"Links"},{"location":"en/rules/Azure.Redis.MaxMemoryReserved/","tags":["Azure.Redis.MaxMemoryReserved","AZR-000160"],"text":"Configure cache maxmemory-reserved setting # Azure.Redis.MaxMemoryReserved AZR-000160 Error Performance Efficiency \u00b7 Azure Cache for Redis \u00b7 2020_12 Configure maxmemory-reserved to reserve memory for non-cache operations. Description # Azure Cache for Redis supports configuration of the maxmemory-reserved setting. The maxmemory-reserved setting configures the amount of memory reserved for non-cache operations. Setting this value allows you to have a more consistent experience when your load varies. This value should be set higher for workloads that are write heavy. When memory reserved by maxmemory-reserved , it is unavailable for storage of cached data. Recommendation # Consider configuring maxmemory-reserved to at least 10% of available cache memory. Links # Best practices for Azure Cache for Redis Azure template reference Choosing the right resources","title":"Azure.Redis.MaxMemoryReserved"},{"location":"en/rules/Azure.Redis.MaxMemoryReserved/#configure-cache-maxmemory-reserved-setting","text":"Azure.Redis.MaxMemoryReserved AZR-000160 Error Performance Efficiency \u00b7 Azure Cache for Redis \u00b7 2020_12 Configure maxmemory-reserved to reserve memory for non-cache operations.","title":"Configure cache maxmemory-reserved setting"},{"location":"en/rules/Azure.Redis.MaxMemoryReserved/#description","text":"Azure Cache for Redis supports configuration of the maxmemory-reserved setting. The maxmemory-reserved setting configures the amount of memory reserved for non-cache operations. Setting this value allows you to have a more consistent experience when your load varies. This value should be set higher for workloads that are write heavy. When memory reserved by maxmemory-reserved , it is unavailable for storage of cached data.","title":"Description"},{"location":"en/rules/Azure.Redis.MaxMemoryReserved/#recommendation","text":"Consider configuring maxmemory-reserved to at least 10% of available cache memory.","title":"Recommendation"},{"location":"en/rules/Azure.Redis.MaxMemoryReserved/#links","text":"Best practices for Azure Cache for Redis Azure template reference Choosing the right resources","title":"Links"},{"location":"en/rules/Azure.Redis.MinSKU/","tags":["Azure.Redis.MinSKU","AZR-000159"],"text":"Use at least Standard C1 cache instances # Azure.Redis.MinSKU AZR-000159 Error Performance Efficiency \u00b7 Azure Cache for Redis \u00b7 2020_12 Use Azure Cache for Redis instances of at least Standard C1. Description # Azure Cache for Redis supports a range of different scale options. Basic tier or Standard C0 caches are not suitable for production workloads. Basic tier is a single node system with no data replication and no SLA. Standard C0 caches used shared resources and subject to noisy neighbor issues. Recommendation # Consider using a minimum of a Standard C1 instance for production workloads. Links # Best practices for Azure Cache for Redis Azure Cache for Redis pricing Azure template reference Choosing the right resources","title":"Azure.Redis.MinSKU"},{"location":"en/rules/Azure.Redis.MinSKU/#use-at-least-standard-c1-cache-instances","text":"Azure.Redis.MinSKU AZR-000159 Error Performance Efficiency \u00b7 Azure Cache for Redis \u00b7 2020_12 Use Azure Cache for Redis instances of at least Standard C1.","title":"Use at least Standard C1 cache instances"},{"location":"en/rules/Azure.Redis.MinSKU/#description","text":"Azure Cache for Redis supports a range of different scale options. Basic tier or Standard C0 caches are not suitable for production workloads. Basic tier is a single node system with no data replication and no SLA. Standard C0 caches used shared resources and subject to noisy neighbor issues.","title":"Description"},{"location":"en/rules/Azure.Redis.MinSKU/#recommendation","text":"Consider using a minimum of a Standard C1 instance for production workloads.","title":"Recommendation"},{"location":"en/rules/Azure.Redis.MinSKU/#links","text":"Best practices for Azure Cache for Redis Azure Cache for Redis pricing Azure template reference Choosing the right resources","title":"Links"},{"location":"en/rules/Azure.Redis.MinTLS/","tags":["Azure.Redis.MinTLS","AZR-000164"],"text":"Redis Cache minimum TLS version # Azure.Redis.MinTLS AZR-000164 Error Security \u00b7 Azure Cache for Redis \u00b7 2020_06 Redis Cache should reject TLS versions older then 1.2. Description # The minimum version of TLS that Redis Cache accepts is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted. Recommendation # Consider configuring the minimum supported TLS version to be 1.2. Support for TLS 1.0/ 1.1 version will be removed. Links # Data encryption in Azure Remove TLS 1.0 and 1.1 from use with Azure Cache for Redis Configure Azure Cache for Redis settings Preparing for TLS 1.2 in Microsoft Azure Azure template reference","title":"Azure.Redis.MinTLS"},{"location":"en/rules/Azure.Redis.MinTLS/#redis-cache-minimum-tls-version","text":"Azure.Redis.MinTLS AZR-000164 Error Security \u00b7 Azure Cache for Redis \u00b7 2020_06 Redis Cache should reject TLS versions older then 1.2.","title":"Redis Cache minimum TLS version"},{"location":"en/rules/Azure.Redis.MinTLS/#description","text":"The minimum version of TLS that Redis Cache accepts is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted.","title":"Description"},{"location":"en/rules/Azure.Redis.MinTLS/#recommendation","text":"Consider configuring the minimum supported TLS version to be 1.2. Support for TLS 1.0/ 1.1 version will be removed.","title":"Recommendation"},{"location":"en/rules/Azure.Redis.MinTLS/#links","text":"Data encryption in Azure Remove TLS 1.0 and 1.1 from use with Azure Cache for Redis Configure Azure Cache for Redis settings Preparing for TLS 1.2 in Microsoft Azure Azure template reference","title":"Links"},{"location":"en/rules/Azure.Redis.NonSslPort/","tags":["Azure.Redis.NonSslPort","AZR-000163"],"text":"Use secure connections to Redis instances # Azure.Redis.NonSslPort AZR-000163 Error Security \u00b7 Azure Cache for Redis \u00b7 2020_06 Azure Cache for Redis should only accept secure connections. Description # Azure Cache for Redis is configured to accept unencrypted connections using a non-SSL port. Unencrypted connections are disabled by default. Unencrypted communication to Redis Cache could allow disclosure of information to an untrusted party. Recommendation # Azure Cache for Redis should be configured to only accept secure connections. When the non-SSL port is enabled, encrypted and unencrypted connections are permitted. To prevent unencrypted connections, disable the non-SSL port. Unless explicitly required, consider disabling the non-SSL port. Links # Data encryption in Azure when should I enable the non-SSL port for connecting to Redis How to configure Azure Cache for Redis","title":"Azure.Redis.NonSslPort"},{"location":"en/rules/Azure.Redis.NonSslPort/#use-secure-connections-to-redis-instances","text":"Azure.Redis.NonSslPort AZR-000163 Error Security \u00b7 Azure Cache for Redis \u00b7 2020_06 Azure Cache for Redis should only accept secure connections.","title":"Use secure connections to Redis instances"},{"location":"en/rules/Azure.Redis.NonSslPort/#description","text":"Azure Cache for Redis is configured to accept unencrypted connections using a non-SSL port. Unencrypted connections are disabled by default. Unencrypted communication to Redis Cache could allow disclosure of information to an untrusted party.","title":"Description"},{"location":"en/rules/Azure.Redis.NonSslPort/#recommendation","text":"Azure Cache for Redis should be configured to only accept secure connections. When the non-SSL port is enabled, encrypted and unencrypted connections are permitted. To prevent unencrypted connections, disable the non-SSL port. Unless explicitly required, consider disabling the non-SSL port.","title":"Recommendation"},{"location":"en/rules/Azure.Redis.NonSslPort/#links","text":"Data encryption in Azure when should I enable the non-SSL port for connecting to Redis How to configure Azure Cache for Redis","title":"Links"},{"location":"en/rules/Azure.Redis.PublicNetworkAccess/","tags":["Azure.Redis.PublicNetworkAccess","AZR-000165"],"text":"Limit public network access to Redis cache instances # Azure.Redis.PublicNetworkAccess AZR-000165 Error Security \u00b7 Azure Cache for Redis \u00b7 2022_03 Redis cache should disable public network access. Description # Public access to redis instances can be disabled. This ensures secure and private connectivity to redis instances using private endpoints instead. Private endpoint is a network interface that connects you privately and securely to Azure Cache for Redis powered by Azure Private Link. Recommendation # Redis cache should disable public network access when public connectivity is not required. Examples # Configure with Azure template # To disable public network access: Set properties.publicNetworkAccess to Disabled . For example: { \"type\" : \"Microsoft.Cache/Redis\" , \"apiVersion\" : \"2021-06-01\" , \"name\" : \"[parameters('Redis_name')]\" , \"location\" : \"Australia East\" , \"properties\" : { \"redisVersion\" : \"4.1.14\" , \"sku\" : { \"name\" : \"Standard\" , \"family\" : \"C\" , \"capacity\" : 1 }, \"enableNonSslPort\" : false , \"publicNetworkAccess\" : \"Disabled\" , \"redisConfiguration\" : { \"maxmemory-reserved\" : \"50\" , \"maxfragmentationmemory-reserved\" : \"50\" , \"maxmemory-delta\" : \"50\" } } } Configure with Bicep # To disable public network access: Set properties.publicNetworkAccess to Disabled . For example: resource Redis__resource 'Microsoft.Cache/Redis@2021-06-01' = { name: Redis_name location: 'Australia East' properties: { redisVersion: '4.1.14' sku: { name: 'Standard' family: 'C' capacity: 1 } enableNonSslPort: false publicNetworkAccess: 'Disabled' redisConfiguration: { 'maxmemory-reserved': '50' 'maxfragmentationmemory-reserved': '50' 'maxmemory-delta': '50' } } Links # Azure Cache for Redis with Azure Private Link Best practices for endpoint security on Azure What is Azure Private Endpoint?","title":"Azure.Redis.PublicNetworkAccess"},{"location":"en/rules/Azure.Redis.PublicNetworkAccess/#limit-public-network-access-to-redis-cache-instances","text":"Azure.Redis.PublicNetworkAccess AZR-000165 Error Security \u00b7 Azure Cache for Redis \u00b7 2022_03 Redis cache should disable public network access.","title":"Limit public network access to Redis cache instances"},{"location":"en/rules/Azure.Redis.PublicNetworkAccess/#description","text":"Public access to redis instances can be disabled. This ensures secure and private connectivity to redis instances using private endpoints instead. Private endpoint is a network interface that connects you privately and securely to Azure Cache for Redis powered by Azure Private Link.","title":"Description"},{"location":"en/rules/Azure.Redis.PublicNetworkAccess/#recommendation","text":"Redis cache should disable public network access when public connectivity is not required.","title":"Recommendation"},{"location":"en/rules/Azure.Redis.PublicNetworkAccess/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Redis.PublicNetworkAccess/#configure-with-azure-template","text":"To disable public network access: Set properties.publicNetworkAccess to Disabled . For example: { \"type\" : \"Microsoft.Cache/Redis\" , \"apiVersion\" : \"2021-06-01\" , \"name\" : \"[parameters('Redis_name')]\" , \"location\" : \"Australia East\" , \"properties\" : { \"redisVersion\" : \"4.1.14\" , \"sku\" : { \"name\" : \"Standard\" , \"family\" : \"C\" , \"capacity\" : 1 }, \"enableNonSslPort\" : false , \"publicNetworkAccess\" : \"Disabled\" , \"redisConfiguration\" : { \"maxmemory-reserved\" : \"50\" , \"maxfragmentationmemory-reserved\" : \"50\" , \"maxmemory-delta\" : \"50\" } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Redis.PublicNetworkAccess/#configure-with-bicep","text":"To disable public network access: Set properties.publicNetworkAccess to Disabled . For example: resource Redis__resource 'Microsoft.Cache/Redis@2021-06-01' = { name: Redis_name location: 'Australia East' properties: { redisVersion: '4.1.14' sku: { name: 'Standard' family: 'C' capacity: 1 } enableNonSslPort: false publicNetworkAccess: 'Disabled' redisConfiguration: { 'maxmemory-reserved': '50' 'maxfragmentationmemory-reserved': '50' 'maxmemory-delta': '50' } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Redis.PublicNetworkAccess/#links","text":"Azure Cache for Redis with Azure Private Link Best practices for endpoint security on Azure What is Azure Private Endpoint?","title":"Links"},{"location":"en/rules/Azure.RedisEnterprise.Zones/","tags":["Azure.RedisEnterprise.Zones","AZR-000162"],"text":"Enterprise Redis cache should use Availability zones in supported regions # Azure.RedisEnterprise.Zones AZR-000162 Error Reliability \u00b7 Azure Cache for Redis Enterprise \u00b7 2021_12 Enterprise Redis cache should be zone-redundant for high availability. Description # Redis Cache using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. Nodes in one availability zone are physically separated from nodes defined in another availability zone. By spreading node pools across multiple zones, nodes in one node pool will continue running even if another zone has gone down. Recommendation # Consider using availability zones for Enterprise Redis Cache deployed in supported regions. Notes # This rule fails when cache is not zone redundant(1, 2 and 3) when there are availability zones for the given region. Configure AZURE_REDISENTERPRISECACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST to set additional availability zones that need to be supported which are not in the existing providers for namespace Microsoft.Cache and resource type redisEnterprise . # YAML: The default AZURE_REDISENTERPRISECACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option configuration : AZURE_REDISENTERPRISECACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : [] Examples # Configure with Azure template # To set availability zones for Enterprise SKU Redis Cache: Set zones to [\"1\", \"2\", \"3\"] or zone-redundancy. Set Properties.sku.name to one of: Enterprise_E10 - 12 GB Enterprise_E20 - 25 GB Enterprise_E50 - 50 GB Enterprise_E100 - 100 GB EnterpriseFlash_F300 - 345 GB EnterpriseFlash_F700 - 715 GB EnterpriseFlash_F1500 - 1455 GB Set Properties.sku.capacity to: One of [2, 4, 6, 8, 10] if using Enterprise_E10 , Enterprise_E20 , Enterprise_E50 or Enterprise_E100 . Either 3 or 9 if using EnterpriseFlash_F300 , EnterpriseFlash_F700 , EnterpriseFlash_F1500 . For example: { \"name\" : \"testrediscache\" , \"type\" : \"Microsoft.Cache/redisEnterprise\" , \"apiVersion\" : \"2021-02-01-preview\" , \"properties\" : {}, \"location\" : \"australiaeast\" , \"dependsOn\" : [], \"sku\" : { \"name\" : \"EnterpriseFlash_F700\" , \"capacity\" : 3 }, \"zones\" : [ \"1\" , \"2\" , \"3\" ], \"tags\" : {}, \"resources\" : [ { \"name\" : \"testrediscache/default\" , \"type\" : \"Microsoft.Cache/redisEnterprise/databases\" , \"apiVersion\" : \"2021-02-01-preview\" , \"properties\" : { \"clientProtocol\" : \"Encrypted\" , \"evictionPolicy\" : \"NoEviction\" , \"clusteringPolicy\" : \"OSSCluster\" , \"persistence\" : { \"aofEnabled\" : false , \"rdbEnabled\" : false } }, \"dependsOn\" : [ \"Microsoft.Cache/redisEnterprise/testrediscache\" ], \"tags\" : {} } ] } Configure with Bicep # To set availability zones for Enterprise SKU Redis Cache: Set zones to [\"1\", \"2\", \"3\"] or zone-redundancy. Set Properties.sku.name to one of: Enterprise_E10 - 12 GB Enterprise_E20 - 25 GB Enterprise_E50 - 50 GB Enterprise_E100 - 100 GB EnterpriseFlash_F300 - 345 GB EnterpriseFlash_F700 - 715 GB EnterpriseFlash_F1500 - 1455 GB Set Properties.sku.capacity to: One of [2, 4, 6, 8, 10] if using Enterprise_E10 , Enterprise_E20 , Enterprise_E50 or Enterprise_E100 . Either 3 or 9 if using EnterpriseFlash_F300 , EnterpriseFlash_F700 , EnterpriseFlash_F1500 . For example: resource testrediscache 'Microsoft.Cache/redisEnterprise@2021-02-01-preview' = { name: 'testrediscache' properties: {} location: 'australiaeast' sku: { name: 'EnterpriseFlash_F700' capacity: 3 } zones: [ '1' '2' '3' ] tags: {} dependsOn: [] } resource testrediscache_default 'Microsoft.Cache/redisEnterprise/databases@2021-02-01-preview' = { parent: testrediscache name: 'default' properties: { clientProtocol: 'Encrypted' evictionPolicy: 'NoEviction' clusteringPolicy: 'OSSCluster' persistence: { aofEnabled: false rdbEnabled: false } } tags: {} } Links # Use zone-aware services Enable zone redundancy for Azure Cache for Redis High availability for Azure Cache for Redis Azure Template reference","title":"Azure.RedisEnterprise.Zones"},{"location":"en/rules/Azure.RedisEnterprise.Zones/#enterprise-redis-cache-should-use-availability-zones-in-supported-regions","text":"Azure.RedisEnterprise.Zones AZR-000162 Error Reliability \u00b7 Azure Cache for Redis Enterprise \u00b7 2021_12 Enterprise Redis cache should be zone-redundant for high availability.","title":"Enterprise Redis cache should use Availability zones in supported regions"},{"location":"en/rules/Azure.RedisEnterprise.Zones/#description","text":"Redis Cache using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. Nodes in one availability zone are physically separated from nodes defined in another availability zone. By spreading node pools across multiple zones, nodes in one node pool will continue running even if another zone has gone down.","title":"Description"},{"location":"en/rules/Azure.RedisEnterprise.Zones/#recommendation","text":"Consider using availability zones for Enterprise Redis Cache deployed in supported regions.","title":"Recommendation"},{"location":"en/rules/Azure.RedisEnterprise.Zones/#notes","text":"This rule fails when cache is not zone redundant(1, 2 and 3) when there are availability zones for the given region. Configure AZURE_REDISENTERPRISECACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST to set additional availability zones that need to be supported which are not in the existing providers for namespace Microsoft.Cache and resource type redisEnterprise . # YAML: The default AZURE_REDISENTERPRISECACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option configuration : AZURE_REDISENTERPRISECACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : []","title":"Notes"},{"location":"en/rules/Azure.RedisEnterprise.Zones/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.RedisEnterprise.Zones/#configure-with-azure-template","text":"To set availability zones for Enterprise SKU Redis Cache: Set zones to [\"1\", \"2\", \"3\"] or zone-redundancy. Set Properties.sku.name to one of: Enterprise_E10 - 12 GB Enterprise_E20 - 25 GB Enterprise_E50 - 50 GB Enterprise_E100 - 100 GB EnterpriseFlash_F300 - 345 GB EnterpriseFlash_F700 - 715 GB EnterpriseFlash_F1500 - 1455 GB Set Properties.sku.capacity to: One of [2, 4, 6, 8, 10] if using Enterprise_E10 , Enterprise_E20 , Enterprise_E50 or Enterprise_E100 . Either 3 or 9 if using EnterpriseFlash_F300 , EnterpriseFlash_F700 , EnterpriseFlash_F1500 . For example: { \"name\" : \"testrediscache\" , \"type\" : \"Microsoft.Cache/redisEnterprise\" , \"apiVersion\" : \"2021-02-01-preview\" , \"properties\" : {}, \"location\" : \"australiaeast\" , \"dependsOn\" : [], \"sku\" : { \"name\" : \"EnterpriseFlash_F700\" , \"capacity\" : 3 }, \"zones\" : [ \"1\" , \"2\" , \"3\" ], \"tags\" : {}, \"resources\" : [ { \"name\" : \"testrediscache/default\" , \"type\" : \"Microsoft.Cache/redisEnterprise/databases\" , \"apiVersion\" : \"2021-02-01-preview\" , \"properties\" : { \"clientProtocol\" : \"Encrypted\" , \"evictionPolicy\" : \"NoEviction\" , \"clusteringPolicy\" : \"OSSCluster\" , \"persistence\" : { \"aofEnabled\" : false , \"rdbEnabled\" : false } }, \"dependsOn\" : [ \"Microsoft.Cache/redisEnterprise/testrediscache\" ], \"tags\" : {} } ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.RedisEnterprise.Zones/#configure-with-bicep","text":"To set availability zones for Enterprise SKU Redis Cache: Set zones to [\"1\", \"2\", \"3\"] or zone-redundancy. Set Properties.sku.name to one of: Enterprise_E10 - 12 GB Enterprise_E20 - 25 GB Enterprise_E50 - 50 GB Enterprise_E100 - 100 GB EnterpriseFlash_F300 - 345 GB EnterpriseFlash_F700 - 715 GB EnterpriseFlash_F1500 - 1455 GB Set Properties.sku.capacity to: One of [2, 4, 6, 8, 10] if using Enterprise_E10 , Enterprise_E20 , Enterprise_E50 or Enterprise_E100 . Either 3 or 9 if using EnterpriseFlash_F300 , EnterpriseFlash_F700 , EnterpriseFlash_F1500 . For example: resource testrediscache 'Microsoft.Cache/redisEnterprise@2021-02-01-preview' = { name: 'testrediscache' properties: {} location: 'australiaeast' sku: { name: 'EnterpriseFlash_F700' capacity: 3 } zones: [ '1' '2' '3' ] tags: {} dependsOn: [] } resource testrediscache_default 'Microsoft.Cache/redisEnterprise/databases@2021-02-01-preview' = { parent: testrediscache name: 'default' properties: { clientProtocol: 'Encrypted' evictionPolicy: 'NoEviction' clusteringPolicy: 'OSSCluster' persistence: { aofEnabled: false rdbEnabled: false } } tags: {} }","title":"Configure with Bicep"},{"location":"en/rules/Azure.RedisEnterprise.Zones/#links","text":"Use zone-aware services Enable zone redundancy for Azure Cache for Redis High availability for Azure Cache for Redis Azure Template reference","title":"Links"},{"location":"en/rules/Azure.Resource.AllowedRegions/","tags":["Azure.Resource.AllowedRegions","AZR-000167"],"text":"Use allowed regions # Azure.Resource.AllowedRegions AZR-000167 Error Security \u00b7 All resources \u00b7 2020_06 Resources should be deployed to allowed regions. Description # Resources should be deployed to allowed regions. Recommendation # Resources should be deployed to allowed regions. Notes # By default, all regions are allowed. To configure this rule: Override the Azure_AllowedRegions configuration value to set the allowed regions for validation.","title":"Azure.Resource.AllowedRegions"},{"location":"en/rules/Azure.Resource.AllowedRegions/#use-allowed-regions","text":"Azure.Resource.AllowedRegions AZR-000167 Error Security \u00b7 All resources \u00b7 2020_06 Resources should be deployed to allowed regions.","title":"Use allowed regions"},{"location":"en/rules/Azure.Resource.AllowedRegions/#description","text":"Resources should be deployed to allowed regions.","title":"Description"},{"location":"en/rules/Azure.Resource.AllowedRegions/#recommendation","text":"Resources should be deployed to allowed regions.","title":"Recommendation"},{"location":"en/rules/Azure.Resource.AllowedRegions/#notes","text":"By default, all regions are allowed. To configure this rule: Override the Azure_AllowedRegions configuration value to set the allowed regions for validation.","title":"Notes"},{"location":"en/rules/Azure.Resource.UseTags/","tags":["Azure.Resource.UseTags","AZR-000166"],"text":"Use resource tags # Azure.Resource.UseTags AZR-000166 Error Operational Excellence \u00b7 All resources \u00b7 2020_06 Azure resources should be tagged using a standard convention. Description # Azure Resource Manager (ARM) supports a flexible tagging model that allows each resource to be tagged. Tags are additional metadata that improves identification of resources and aids lifecycle management. Azure stores tags as name/ value pairs such as environment = production or costCode = 349921 . A well defined tagging approach improves the management, billing and automation operations of resources. When planning tags, identify information that is meaningful to business and technical staff. Azure provides several built-in policies to managed tags. Using these policies help enforce a tagging standard can reduce overall management Resource tags can be inherited from subscriptions or resource groups using Azure Policy. Recommendation # Consider tagging resources using a standard convention. Identify mandatory and optional tags then tag all resources and resource groups using this standard. Also consider using Azure Policy to enforce mandatory tags. Notes # Azure Policy includes the following built-in policies to enforce tagging: Require a tag on resources Require a tag on resource groups Links # Tag support for Azure resources Recommended naming and tagging conventions","title":"Azure.Resource.UseTags"},{"location":"en/rules/Azure.Resource.UseTags/#use-resource-tags","text":"Azure.Resource.UseTags AZR-000166 Error Operational Excellence \u00b7 All resources \u00b7 2020_06 Azure resources should be tagged using a standard convention.","title":"Use resource tags"},{"location":"en/rules/Azure.Resource.UseTags/#description","text":"Azure Resource Manager (ARM) supports a flexible tagging model that allows each resource to be tagged. Tags are additional metadata that improves identification of resources and aids lifecycle management. Azure stores tags as name/ value pairs such as environment = production or costCode = 349921 . A well defined tagging approach improves the management, billing and automation operations of resources. When planning tags, identify information that is meaningful to business and technical staff. Azure provides several built-in policies to managed tags. Using these policies help enforce a tagging standard can reduce overall management Resource tags can be inherited from subscriptions or resource groups using Azure Policy.","title":"Description"},{"location":"en/rules/Azure.Resource.UseTags/#recommendation","text":"Consider tagging resources using a standard convention. Identify mandatory and optional tags then tag all resources and resource groups using this standard. Also consider using Azure Policy to enforce mandatory tags.","title":"Recommendation"},{"location":"en/rules/Azure.Resource.UseTags/#notes","text":"Azure Policy includes the following built-in policies to enforce tagging: Require a tag on resources Require a tag on resource groups","title":"Notes"},{"location":"en/rules/Azure.Resource.UseTags/#links","text":"Tag support for Azure resources Recommended naming and tagging conventions","title":"Links"},{"location":"en/rules/Azure.ResourceGroup.Name/","tags":["Azure.ResourceGroup.Name","AZR-000168"],"text":"Use valid resource group names # Azure.ResourceGroup.Name AZR-000168 Error Operational Excellence \u00b7 Resource Group \u00b7 2020_06 Resource Group names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Resource Group names are: Between 1 and 90 characters long. Alphanumerics, underscores, parentheses, hyphens, periods. Can't end with period. Resource Group names must be unique within a subscription. Recommendation # Consider using names that meet Resource Group naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Resource Group names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.ResourceGroup.Name"},{"location":"en/rules/Azure.ResourceGroup.Name/#use-valid-resource-group-names","text":"Azure.ResourceGroup.Name AZR-000168 Error Operational Excellence \u00b7 Resource Group \u00b7 2020_06 Resource Group names should meet naming requirements.","title":"Use valid resource group names"},{"location":"en/rules/Azure.ResourceGroup.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Resource Group names are: Between 1 and 90 characters long. Alphanumerics, underscores, parentheses, hyphens, periods. Can't end with period. Resource Group names must be unique within a subscription.","title":"Description"},{"location":"en/rules/Azure.ResourceGroup.Name/#recommendation","text":"Consider using names that meet Resource Group naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.ResourceGroup.Name/#notes","text":"This rule does not check if Resource Group names are unique.","title":"Notes"},{"location":"en/rules/Azure.ResourceGroup.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.Route.Name/","tags":["Azure.Route.Name","AZR-000169"],"text":"Use valid Route table names # Azure.Route.Name AZR-000169 Error Operational Excellence \u00b7 Route table \u00b7 2020_06 Route table names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Route table names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Route table names must be unique within a resource group. Recommendation # Consider using names that meet Route table naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Route table names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Azure.Route.Name"},{"location":"en/rules/Azure.Route.Name/#use-valid-route-table-names","text":"Azure.Route.Name AZR-000169 Error Operational Excellence \u00b7 Route table \u00b7 2020_06 Route table names should meet naming requirements.","title":"Use valid Route table names"},{"location":"en/rules/Azure.Route.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Route table names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Route table names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.Route.Name/#recommendation","text":"Consider using names that meet Route table naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.Route.Name/#notes","text":"This rule does not check if Route table names are unique.","title":"Notes"},{"location":"en/rules/Azure.Route.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Links"},{"location":"en/rules/Azure.SQL.AAD/","tags":["Azure.SQL.AAD","AZR-000188"],"text":"Use AAD authentication with SQL databases # Azure.SQL.AAD AZR-000188 Error Security \u00b7 SQL Database \u00b7 2020_06 Use Azure Active Directory (AAD) authentication with Azure SQL databases. Description # Azure SQL Database offer two authentication models, Azure Active Directory (AAD) and SQL logins. AAD authentication supports centialized identity management in addition to modern password protections. Some of the benefits of AAD authentication over SQL authentication including: Support for Azure Multi-Factor Authentication (MFA). Conditional-based access with Conditional Access. It is also possible to disable SQL authentication entirely. Recommendation # Consider using Azure Active Directory (AAD) authentication with SQL databases. Additionally, consider disabling SQL authentication. Examples # Configure with Azure template # To deploy logical SQL Servers that pass this rule: Set the properties.administrators.administratorType to ActiveDirectory . Set the properties.administrators.login to the administrator login object name. Set the properties.administrators.sid to the object ID GUID of the administrator user, group, or application. For example: { \"type\" : \"Microsoft.Sql/servers\" , \"apiVersion\" : \"2022-02-01-preview\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"minimalTlsVersion\" : \"1.2\" , \"administrators\" : { \"administratorType\" : \"ActiveDirectory\" , \"login\" : \"[parameters('adminLogin')]\" , \"principalType\" : \"Group\" , \"sid\" : \"[parameters('adminPrincipalId')]\" , \"tenantId\" : \"[tenant().tenantId]\" } } } Alternatively, you can configure the Microsoft.Sql/servers/administrators sub-resource. To deploy Microsoft.Sql/servers/administrators sub-resources that pass this rule: Set the properties.administratorType to ActiveDirectory . Set the properties.login to the administrator login object name. Set the properties.sid to the object ID GUID of the administrator user, group, or application. For example: { \"type\" : \"Microsoft.Sql/servers/administrators\" , \"apiVersion\" : \"2022-02-01-preview\" , \"name\" : \"[format('{0}/{1}', parameters('name'), 'ActiveDirectory')]\" , \"properties\" : { \"administratorType\" : \"ActiveDirectory\" , \"login\" : \"[parameters('adminLogin')]\" , \"sid\" : \"[parameters('adminPrincipalId')]\" }, \"dependsOn\" : [ \"[resourceId('Microsoft.Sql/servers', parameters('name'))]\" ] } Configure with Bicep # To deploy logical SQL Servers that pass this rule: Set the properties.administrators.administratorType to ActiveDirectory . Set the properties.administrators.login to the administrator login object name. Set the properties.administrators.sid to the object ID GUID of the administrator user, group, or application. For example: resource server 'Microsoft.Sql/servers@2022-02-01-preview' = { name: name location: location properties: { minimalTlsVersion: '1.2' administrators: { administratorType: 'ActiveDirectory' login: adminLogin principalType: 'Group' sid: adminPrincipalId tenantId: tenant().tenantId } } } Alternatively, you can configure the Microsoft.Sql/servers/administrators sub-resource. To deploy Microsoft.Sql/servers/administrators sub-resources that pass this rule: Set the properties.administratorType to ActiveDirectory . Set the properties.login to the administrator login object name. Set the properties.sid to the object ID GUID of the administrator user, group, or application. For example: resource sqlAdministrator 'Microsoft.Sql/servers/administrators@2022-02-01-preview' = { parent: server name: 'ActiveDirectory' properties: { administratorType: 'ActiveDirectory' login: adminLogin sid: adminPrincipalId } } Configure with Azure CLI # az sql server ad-admin create -s '<server_name>' -g '<resource_group>' -u '<user_name>' -i '<object_id>' Configure with Azure PowerShell # Set-AzSqlServerActiveDirectoryAdministrator -ResourceGroupName '<resource_group>' -ServerName '<server_name>' -DisplayName '<user_name>' Notes # In newer API versions the properties.administrators property can be configured. Azure AD authentication can also be configured using the Microsoft.Sql/servers/administrators sub-resource. If both the properties.administrators property and Microsoft.Sql/servers/administrators are set, the sub-resoure will override the property. Links # Use modern password protection Configure and manage Azure AD authentication with Azure SQL Using multi-factor Azure Active Directory authentication Conditional Access with Azure SQL Database and Azure Synapse Analytics Azure AD-only authentication with Azure SQL Azure Policy for Azure Active Directory only authentication with Azure SQL Azure template reference","title":"Azure.SQL.AAD"},{"location":"en/rules/Azure.SQL.AAD/#use-aad-authentication-with-sql-databases","text":"Azure.SQL.AAD AZR-000188 Error Security \u00b7 SQL Database \u00b7 2020_06 Use Azure Active Directory (AAD) authentication with Azure SQL databases.","title":"Use AAD authentication with SQL databases"},{"location":"en/rules/Azure.SQL.AAD/#description","text":"Azure SQL Database offer two authentication models, Azure Active Directory (AAD) and SQL logins. AAD authentication supports centialized identity management in addition to modern password protections. Some of the benefits of AAD authentication over SQL authentication including: Support for Azure Multi-Factor Authentication (MFA). Conditional-based access with Conditional Access. It is also possible to disable SQL authentication entirely.","title":"Description"},{"location":"en/rules/Azure.SQL.AAD/#recommendation","text":"Consider using Azure Active Directory (AAD) authentication with SQL databases. Additionally, consider disabling SQL authentication.","title":"Recommendation"},{"location":"en/rules/Azure.SQL.AAD/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.SQL.AAD/#configure-with-azure-template","text":"To deploy logical SQL Servers that pass this rule: Set the properties.administrators.administratorType to ActiveDirectory . Set the properties.administrators.login to the administrator login object name. Set the properties.administrators.sid to the object ID GUID of the administrator user, group, or application. For example: { \"type\" : \"Microsoft.Sql/servers\" , \"apiVersion\" : \"2022-02-01-preview\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"minimalTlsVersion\" : \"1.2\" , \"administrators\" : { \"administratorType\" : \"ActiveDirectory\" , \"login\" : \"[parameters('adminLogin')]\" , \"principalType\" : \"Group\" , \"sid\" : \"[parameters('adminPrincipalId')]\" , \"tenantId\" : \"[tenant().tenantId]\" } } } Alternatively, you can configure the Microsoft.Sql/servers/administrators sub-resource. To deploy Microsoft.Sql/servers/administrators sub-resources that pass this rule: Set the properties.administratorType to ActiveDirectory . Set the properties.login to the administrator login object name. Set the properties.sid to the object ID GUID of the administrator user, group, or application. For example: { \"type\" : \"Microsoft.Sql/servers/administrators\" , \"apiVersion\" : \"2022-02-01-preview\" , \"name\" : \"[format('{0}/{1}', parameters('name'), 'ActiveDirectory')]\" , \"properties\" : { \"administratorType\" : \"ActiveDirectory\" , \"login\" : \"[parameters('adminLogin')]\" , \"sid\" : \"[parameters('adminPrincipalId')]\" }, \"dependsOn\" : [ \"[resourceId('Microsoft.Sql/servers', parameters('name'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.SQL.AAD/#configure-with-bicep","text":"To deploy logical SQL Servers that pass this rule: Set the properties.administrators.administratorType to ActiveDirectory . Set the properties.administrators.login to the administrator login object name. Set the properties.administrators.sid to the object ID GUID of the administrator user, group, or application. For example: resource server 'Microsoft.Sql/servers@2022-02-01-preview' = { name: name location: location properties: { minimalTlsVersion: '1.2' administrators: { administratorType: 'ActiveDirectory' login: adminLogin principalType: 'Group' sid: adminPrincipalId tenantId: tenant().tenantId } } } Alternatively, you can configure the Microsoft.Sql/servers/administrators sub-resource. To deploy Microsoft.Sql/servers/administrators sub-resources that pass this rule: Set the properties.administratorType to ActiveDirectory . Set the properties.login to the administrator login object name. Set the properties.sid to the object ID GUID of the administrator user, group, or application. For example: resource sqlAdministrator 'Microsoft.Sql/servers/administrators@2022-02-01-preview' = { parent: server name: 'ActiveDirectory' properties: { administratorType: 'ActiveDirectory' login: adminLogin sid: adminPrincipalId } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.SQL.AAD/#configure-with-azure-cli","text":"az sql server ad-admin create -s '<server_name>' -g '<resource_group>' -u '<user_name>' -i '<object_id>'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.SQL.AAD/#configure-with-azure-powershell","text":"Set-AzSqlServerActiveDirectoryAdministrator -ResourceGroupName '<resource_group>' -ServerName '<server_name>' -DisplayName '<user_name>'","title":"Configure with Azure PowerShell"},{"location":"en/rules/Azure.SQL.AAD/#notes","text":"In newer API versions the properties.administrators property can be configured. Azure AD authentication can also be configured using the Microsoft.Sql/servers/administrators sub-resource. If both the properties.administrators property and Microsoft.Sql/servers/administrators are set, the sub-resoure will override the property.","title":"Notes"},{"location":"en/rules/Azure.SQL.AAD/#links","text":"Use modern password protection Configure and manage Azure AD authentication with Azure SQL Using multi-factor Azure Active Directory authentication Conditional Access with Azure SQL Database and Azure Synapse Analytics Azure AD-only authentication with Azure SQL Azure Policy for Azure Active Directory only authentication with Azure SQL Azure template reference","title":"Links"},{"location":"en/rules/Azure.SQL.AllowAzureAccess/","tags":["Azure.SQL.AllowAzureAccess","AZR-000184"],"text":"Limit SQL database network access to trusted IP addresses # Azure.SQL.AllowAzureAccess AZR-000184 Error Security \u00b7 SQL Database \u00b7 2020_06 Determine if access from Azure services is required. Description # Allow access to Azure services, permits any Azure service network based access to databases. Network based access it not limited to a single customer, all Azure IP addresses are permitted. Network access can also be allowed/ blocked on individual databases, which takes precedence over server firewall rules. If network based access is permitted, authentication is still required. Enabling access from Azure Services is useful in certain cases for on demand PaaS workloads where configuring a stable IP address is not possible. For example Azure Functions, Container Instances and Logic Apps. Recommendation # Consider using a stable IP address or configure virtual network based firewall rules. Determine if access from Azure services is required for the services connecting to the hosted databases. Links # Connections from inside Azure Network security","title":"Azure.SQL.AllowAzureAccess"},{"location":"en/rules/Azure.SQL.AllowAzureAccess/#limit-sql-database-network-access-to-trusted-ip-addresses","text":"Azure.SQL.AllowAzureAccess AZR-000184 Error Security \u00b7 SQL Database \u00b7 2020_06 Determine if access from Azure services is required.","title":"Limit SQL database network access to trusted IP addresses"},{"location":"en/rules/Azure.SQL.AllowAzureAccess/#description","text":"Allow access to Azure services, permits any Azure service network based access to databases. Network based access it not limited to a single customer, all Azure IP addresses are permitted. Network access can also be allowed/ blocked on individual databases, which takes precedence over server firewall rules. If network based access is permitted, authentication is still required. Enabling access from Azure Services is useful in certain cases for on demand PaaS workloads where configuring a stable IP address is not possible. For example Azure Functions, Container Instances and Logic Apps.","title":"Description"},{"location":"en/rules/Azure.SQL.AllowAzureAccess/#recommendation","text":"Consider using a stable IP address or configure virtual network based firewall rules. Determine if access from Azure services is required for the services connecting to the hosted databases.","title":"Recommendation"},{"location":"en/rules/Azure.SQL.AllowAzureAccess/#links","text":"Connections from inside Azure Network security","title":"Links"},{"location":"en/rules/Azure.SQL.Auditing/","tags":["Azure.SQL.Auditing","AZR-000187"],"text":"Enable auditing for Azure SQL DB server # Azure.SQL.Auditing AZR-000187 Error Security \u00b7 SQL Database \u00b7 2020_06 Enable auditing for Azure SQL logical server. Description # Auditing for Azure SQL Database tracks database events and writes them to an audit log. Audit logs help you find suspicious events, unusual activity, and trends. Recommendation # Consider enabling auditing for each SQL Database logical server and review reports on a regular basis. Examples # Configure with Azure template # { \"comments\" : \"Create or update an Azure SQL logical server.\" , \"type\" : \"Microsoft.Sql/servers\" , \"apiVersion\" : \"2019-06-01-preview\" , \"name\" : \"[parameters('serverName')]\" , \"location\" : \"[parameters('location')]\" , \"tags\" : \"[parameters('tags')]\" , \"kind\" : \"v12.0\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"administratorLogin\" : \"[parameters('adminUsername')]\" , \"version\" : \"12.0\" , \"publicNetworkAccess\" : \"[if(parameters('allowPublicAccess'), 'Enabled', 'Disabled')]\" , \"administratorLoginPassword\" : \"[parameters('adminPassword')]\" , \"minimalTLSVersion\" : \"1.2\" }, \"resources\" : [ { \"type\" : \"Microsoft.Sql/servers/auditingPolicies\" , \"apiVersion\" : \"2014-04-01\" , \"name\" : \"[concat(parameters('serverName'), '/Default')]\" , \"location\" : \"[parameters('location')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Sql/servers', parameters('serverName'))]\" ], \"properties\" : { \"auditingState\" : \"Enabled\" } }, { \"type\" : \"Microsoft.Sql/servers/auditingSettings\" , \"apiVersion\" : \"2017-03-01-preview\" , \"name\" : \"[concat(parameters('serverName'), '/Default')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Sql/servers', parameters('serverName'))]\" ], \"properties\" : { \"state\" : \"Enabled\" , \"retentionDays\" : 7 , \"auditActionsAndGroups\" : [ \"SUCCESSFUL_DATABASE_AUTHENTICATION_GROUP\" , \"FAILED_DATABASE_AUTHENTICATION_GROUP\" , \"BATCH_COMPLETED_GROUP\" ], \"storageAccountSubscriptionId\" : \"[split(parameters('securityStorageAccountId'), '/')[2]]\" , \"isStorageSecondaryKeyInUse\" : false , \"isAzureMonitorTargetEnabled\" : false , \"storageEndpoint\" : \"[reference(parameters('securityStorageAccountId'),'2019-06-01').primaryendpoints.blob]\" , \"storageAccountAccessKey\" : \"[listKeys(parameters('securityStorageAccountId'),'2019-06-01').keys[0].value]\" } } ] } Configure with Azure CLI # az sql server audit-policy update -g '<resource_group>' -n '<server_name>' --state Enabled --bsts Enabled --storage-account '<storage_account_name>' Configure with Azure PowerShell # Set-AzSqlServerAudit -ResourceGroupName '<resource_group>' -ServerName '<server_name>' -BlobStorageTargetState Enabled -StorageAccountResourceId '<storage_resource_id>' Links # Auditing for Azure SQL Database and Azure Synapse Analytics Azure template reference","title":"Azure.SQL.Auditing"},{"location":"en/rules/Azure.SQL.Auditing/#enable-auditing-for-azure-sql-db-server","text":"Azure.SQL.Auditing AZR-000187 Error Security \u00b7 SQL Database \u00b7 2020_06 Enable auditing for Azure SQL logical server.","title":"Enable auditing for Azure SQL DB server"},{"location":"en/rules/Azure.SQL.Auditing/#description","text":"Auditing for Azure SQL Database tracks database events and writes them to an audit log. Audit logs help you find suspicious events, unusual activity, and trends.","title":"Description"},{"location":"en/rules/Azure.SQL.Auditing/#recommendation","text":"Consider enabling auditing for each SQL Database logical server and review reports on a regular basis.","title":"Recommendation"},{"location":"en/rules/Azure.SQL.Auditing/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.SQL.Auditing/#configure-with-azure-template","text":"{ \"comments\" : \"Create or update an Azure SQL logical server.\" , \"type\" : \"Microsoft.Sql/servers\" , \"apiVersion\" : \"2019-06-01-preview\" , \"name\" : \"[parameters('serverName')]\" , \"location\" : \"[parameters('location')]\" , \"tags\" : \"[parameters('tags')]\" , \"kind\" : \"v12.0\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"administratorLogin\" : \"[parameters('adminUsername')]\" , \"version\" : \"12.0\" , \"publicNetworkAccess\" : \"[if(parameters('allowPublicAccess'), 'Enabled', 'Disabled')]\" , \"administratorLoginPassword\" : \"[parameters('adminPassword')]\" , \"minimalTLSVersion\" : \"1.2\" }, \"resources\" : [ { \"type\" : \"Microsoft.Sql/servers/auditingPolicies\" , \"apiVersion\" : \"2014-04-01\" , \"name\" : \"[concat(parameters('serverName'), '/Default')]\" , \"location\" : \"[parameters('location')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Sql/servers', parameters('serverName'))]\" ], \"properties\" : { \"auditingState\" : \"Enabled\" } }, { \"type\" : \"Microsoft.Sql/servers/auditingSettings\" , \"apiVersion\" : \"2017-03-01-preview\" , \"name\" : \"[concat(parameters('serverName'), '/Default')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Sql/servers', parameters('serverName'))]\" ], \"properties\" : { \"state\" : \"Enabled\" , \"retentionDays\" : 7 , \"auditActionsAndGroups\" : [ \"SUCCESSFUL_DATABASE_AUTHENTICATION_GROUP\" , \"FAILED_DATABASE_AUTHENTICATION_GROUP\" , \"BATCH_COMPLETED_GROUP\" ], \"storageAccountSubscriptionId\" : \"[split(parameters('securityStorageAccountId'), '/')[2]]\" , \"isStorageSecondaryKeyInUse\" : false , \"isAzureMonitorTargetEnabled\" : false , \"storageEndpoint\" : \"[reference(parameters('securityStorageAccountId'),'2019-06-01').primaryendpoints.blob]\" , \"storageAccountAccessKey\" : \"[listKeys(parameters('securityStorageAccountId'),'2019-06-01').keys[0].value]\" } } ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.SQL.Auditing/#configure-with-azure-cli","text":"az sql server audit-policy update -g '<resource_group>' -n '<server_name>' --state Enabled --bsts Enabled --storage-account '<storage_account_name>'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.SQL.Auditing/#configure-with-azure-powershell","text":"Set-AzSqlServerAudit -ResourceGroupName '<resource_group>' -ServerName '<server_name>' -BlobStorageTargetState Enabled -StorageAccountResourceId '<storage_resource_id>'","title":"Configure with Azure PowerShell"},{"location":"en/rules/Azure.SQL.Auditing/#links","text":"Auditing for Azure SQL Database and Azure Synapse Analytics Azure template reference","title":"Links"},{"location":"en/rules/Azure.SQL.DBName/","tags":["Azure.SQL.DBName","AZR-000192"],"text":"Use valid SQL Database names # Azure.SQL.DBName AZR-000192 Error Operational Excellence \u00b7 SQL Database \u00b7 2020_12 Azure SQL Database names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for SQL Database names are: Between 1 and 128 characters long. Letters, numbers, and special characters except: <>*%&:\\/? Can't end with period or a space. Azure SQL Database names must be unique for each logical server. The following reserved database names can not be used: master model tempdb Recommendation # Consider using names that meet Azure SQL Database naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Azure SQL Database names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.SQL.DBName"},{"location":"en/rules/Azure.SQL.DBName/#use-valid-sql-database-names","text":"Azure.SQL.DBName AZR-000192 Error Operational Excellence \u00b7 SQL Database \u00b7 2020_12 Azure SQL Database names should meet naming requirements.","title":"Use valid SQL Database names"},{"location":"en/rules/Azure.SQL.DBName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for SQL Database names are: Between 1 and 128 characters long. Letters, numbers, and special characters except: <>*%&:\\/? Can't end with period or a space. Azure SQL Database names must be unique for each logical server. The following reserved database names can not be used: master model tempdb","title":"Description"},{"location":"en/rules/Azure.SQL.DBName/#recommendation","text":"Consider using names that meet Azure SQL Database naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.SQL.DBName/#notes","text":"This rule does not check if Azure SQL Database names are unique.","title":"Notes"},{"location":"en/rules/Azure.SQL.DBName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.SQL.FGName/","tags":["Azure.SQL.FGName","AZR-000193"],"text":"Use valid SQL failover group names # Azure.SQL.FGName AZR-000193 Error Operational Excellence \u00b7 SQL Database \u00b7 2020_12 Azure SQL failover group names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for SQL failover group names are: Between 1 and 63 characters long. Lowercase letters, numbers, and hyphens. Can't start or end with a hyphen. SQL failover group names must be globally unique. Recommendation # Consider using names that meet Azure SQL failover group naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Azure SQL failover group names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.SQL.FGName"},{"location":"en/rules/Azure.SQL.FGName/#use-valid-sql-failover-group-names","text":"Azure.SQL.FGName AZR-000193 Error Operational Excellence \u00b7 SQL Database \u00b7 2020_12 Azure SQL failover group names should meet naming requirements.","title":"Use valid SQL failover group names"},{"location":"en/rules/Azure.SQL.FGName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for SQL failover group names are: Between 1 and 63 characters long. Lowercase letters, numbers, and hyphens. Can't start or end with a hyphen. SQL failover group names must be globally unique.","title":"Description"},{"location":"en/rules/Azure.SQL.FGName/#recommendation","text":"Consider using names that meet Azure SQL failover group naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.SQL.FGName/#notes","text":"This rule does not check if Azure SQL failover group names are unique.","title":"Notes"},{"location":"en/rules/Azure.SQL.FGName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.SQL.FirewallIPRange/","tags":["Azure.SQL.FirewallIPRange","AZR-000185"],"text":"Limit SQL logical server firewall rule range # Azure.SQL.FirewallIPRange AZR-000185 Error Security \u00b7 SQL Database \u00b7 2020_06 Determine if there is an excessive number of permitted IP addresses. Description # Typically the number of IP address rules permitted through the firewall is minimal, with management connectivity from on-premises and cloud application connectivity the most common. Recommendation # SQL Server has greater then ten (10) public IP addresses that are permitted network access. Some rules may not be needed or can be reduced. Links # Azure SQL Database and Azure Synapse IP firewall rules Create and manage IP firewall rules","title":"Azure.SQL.FirewallIPRange"},{"location":"en/rules/Azure.SQL.FirewallIPRange/#limit-sql-logical-server-firewall-rule-range","text":"Azure.SQL.FirewallIPRange AZR-000185 Error Security \u00b7 SQL Database \u00b7 2020_06 Determine if there is an excessive number of permitted IP addresses.","title":"Limit SQL logical server firewall rule range"},{"location":"en/rules/Azure.SQL.FirewallIPRange/#description","text":"Typically the number of IP address rules permitted through the firewall is minimal, with management connectivity from on-premises and cloud application connectivity the most common.","title":"Description"},{"location":"en/rules/Azure.SQL.FirewallIPRange/#recommendation","text":"SQL Server has greater then ten (10) public IP addresses that are permitted network access. Some rules may not be needed or can be reduced.","title":"Recommendation"},{"location":"en/rules/Azure.SQL.FirewallIPRange/#links","text":"Azure SQL Database and Azure Synapse IP firewall rules Create and manage IP firewall rules","title":"Links"},{"location":"en/rules/Azure.SQL.FirewallRuleCount/","tags":["Azure.SQL.FirewallRuleCount","AZR-000183"],"text":"Cleanup SQL logical server firewall rules # Azure.SQL.FirewallRuleCount AZR-000183 Error Security \u00b7 SQL Database \u00b7 2020_06 Determine if there is an excessive number of firewall rules. Description # Typically the number of firewall rules required is minimal, with management connectivity from on-premises and cloud application connectivity the most common. Recommendation # The logical SQL Server has greater then ten (10) firewall rules. Some rules may not be needed. Links # Azure SQL Database and Azure Synapse IP firewall rules Create and manage IP firewall rules","title":"Azure.SQL.FirewallRuleCount"},{"location":"en/rules/Azure.SQL.FirewallRuleCount/#cleanup-sql-logical-server-firewall-rules","text":"Azure.SQL.FirewallRuleCount AZR-000183 Error Security \u00b7 SQL Database \u00b7 2020_06 Determine if there is an excessive number of firewall rules.","title":"Cleanup SQL logical server firewall rules"},{"location":"en/rules/Azure.SQL.FirewallRuleCount/#description","text":"Typically the number of firewall rules required is minimal, with management connectivity from on-premises and cloud application connectivity the most common.","title":"Description"},{"location":"en/rules/Azure.SQL.FirewallRuleCount/#recommendation","text":"The logical SQL Server has greater then ten (10) firewall rules. Some rules may not be needed.","title":"Recommendation"},{"location":"en/rules/Azure.SQL.FirewallRuleCount/#links","text":"Azure SQL Database and Azure Synapse IP firewall rules Create and manage IP firewall rules","title":"Links"},{"location":"en/rules/Azure.SQL.MinTLS/","tags":["Azure.SQL.MinTLS","AZR-000189"],"text":"Azure SQL DB server minimum TLS version # Azure.SQL.MinTLS AZR-000189 Error Security \u00b7 SQL Database \u00b7 2020_09 Azure SQL Database servers should reject TLS versions older than 1.2. Description # The minimum version of TLS that Azure SQL Database servers accept is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted. Recommendation # Consider configuring the minimum supported TLS version to be 1.2. Examples # Configure with Azure template # To deploy logical SQL Servers that pass this rule: Set the properties.minimalTlsVersion to 1.2 . For example: { \"type\" : \"Microsoft.Sql/servers\" , \"apiVersion\" : \"2022-02-01-preview\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"minimalTlsVersion\" : \"1.2\" , \"administrators\" : { \"administratorType\" : \"ActiveDirectory\" , \"login\" : \"[parameters('adminLogin')]\" , \"principalType\" : \"Group\" , \"sid\" : \"[parameters('adminPrincipalId')]\" , \"tenantId\" : \"[tenant().tenantId]\" } } } Configure with Bicep # To deploy logical SQL Servers that pass this rule: Set the properties.minimalTlsVersion to 1.2 . For example: resource server 'Microsoft.Sql/servers@2022-02-01-preview' = { name: name location: location properties: { minimalTlsVersion: '1.2' administrators: { administratorType: 'ActiveDirectory' login: adminLogin principalType: 'Group' sid: adminPrincipalId tenantId: tenant().tenantId } } } Links # Data encryption in Azure Minimal TLS Version Preparing for TLS 1.2 in Microsoft Azure Azure deployment reference","title":"Azure.SQL.MinTLS"},{"location":"en/rules/Azure.SQL.MinTLS/#azure-sql-db-server-minimum-tls-version","text":"Azure.SQL.MinTLS AZR-000189 Error Security \u00b7 SQL Database \u00b7 2020_09 Azure SQL Database servers should reject TLS versions older than 1.2.","title":"Azure SQL DB server minimum TLS version"},{"location":"en/rules/Azure.SQL.MinTLS/#description","text":"The minimum version of TLS that Azure SQL Database servers accept is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted.","title":"Description"},{"location":"en/rules/Azure.SQL.MinTLS/#recommendation","text":"Consider configuring the minimum supported TLS version to be 1.2.","title":"Recommendation"},{"location":"en/rules/Azure.SQL.MinTLS/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.SQL.MinTLS/#configure-with-azure-template","text":"To deploy logical SQL Servers that pass this rule: Set the properties.minimalTlsVersion to 1.2 . For example: { \"type\" : \"Microsoft.Sql/servers\" , \"apiVersion\" : \"2022-02-01-preview\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"minimalTlsVersion\" : \"1.2\" , \"administrators\" : { \"administratorType\" : \"ActiveDirectory\" , \"login\" : \"[parameters('adminLogin')]\" , \"principalType\" : \"Group\" , \"sid\" : \"[parameters('adminPrincipalId')]\" , \"tenantId\" : \"[tenant().tenantId]\" } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.SQL.MinTLS/#configure-with-bicep","text":"To deploy logical SQL Servers that pass this rule: Set the properties.minimalTlsVersion to 1.2 . For example: resource server 'Microsoft.Sql/servers@2022-02-01-preview' = { name: name location: location properties: { minimalTlsVersion: '1.2' administrators: { administratorType: 'ActiveDirectory' login: adminLogin principalType: 'Group' sid: adminPrincipalId tenantId: tenant().tenantId } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.SQL.MinTLS/#links","text":"Data encryption in Azure Minimal TLS Version Preparing for TLS 1.2 in Microsoft Azure Azure deployment reference","title":"Links"},{"location":"en/rules/Azure.SQL.ServerName/","tags":["Azure.SQL.ServerName","AZR-000190"],"text":"Use valid SQL logical server names # Azure.SQL.ServerName AZR-000190 Error Operational Excellence \u00b7 SQL Database \u00b7 2020_12 Azure SQL logical server names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for SQL logical server names are: Between 1 and 63 characters long. Lowercase letters, numbers, and hyphens. Can't start or end with a hyphen. SQL logical server names must be globally unique. Recommendation # Consider using names that meet Azure SQL logical server naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Azure SQL logical server names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.SQL.ServerName"},{"location":"en/rules/Azure.SQL.ServerName/#use-valid-sql-logical-server-names","text":"Azure.SQL.ServerName AZR-000190 Error Operational Excellence \u00b7 SQL Database \u00b7 2020_12 Azure SQL logical server names should meet naming requirements.","title":"Use valid SQL logical server names"},{"location":"en/rules/Azure.SQL.ServerName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for SQL logical server names are: Between 1 and 63 characters long. Lowercase letters, numbers, and hyphens. Can't start or end with a hyphen. SQL logical server names must be globally unique.","title":"Description"},{"location":"en/rules/Azure.SQL.ServerName/#recommendation","text":"Consider using names that meet Azure SQL logical server naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.SQL.ServerName/#notes","text":"This rule does not check if Azure SQL logical server names are unique.","title":"Notes"},{"location":"en/rules/Azure.SQL.ServerName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.SQL.TDE/","tags":["Azure.SQL.TDE","AZR-000191"],"text":"Use SQL database TDE # Azure.SQL.TDE AZR-000191 Error Security \u00b7 SQL Database \u00b7 2020_06 Use Transparent Data Encryption (TDE) with Azure SQL Database. Description # TDE helps protect Azure SQL Databases against malicious offline access by encrypting data at rest. SQL Databases perform real-time encryption and decryption of the database, backups, and log files. Encryption is perform at rest without requiring changes to the application. Recommendation # Consider enable Transparent Data Encryption (TDE) for Azure SQL Databases to perform encryption at rest. Examples # Configure with Azure template # { \"type\" : \"Microsoft.Sql/servers/databases\" , \"apiVersion\" : \"2020-08-01-preview\" , \"name\" : \"[variables('dbName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"[parameters('sku')]\" }, \"kind\" : \"v12.0,user\" , \"properties\" : { \"collation\" : \"SQL_Latin1_General_CP1_CI_AS\" , \"maxSizeBytes\" : \"[mul(parameters('maxSizeMB'), 1048576)]\" , \"catalogCollation\" : \"SQL_Latin1_General_CP1_CI_AS\" , \"zoneRedundant\" : false , \"readScale\" : \"Disabled\" , \"storageAccountType\" : \"GRS\" }, \"resources\" : [ { \"type\" : \"Microsoft.Sql/servers/databases/transparentDataEncryption\" , \"apiVersion\" : \"2014-04-01\" , \"name\" : \"[concat(variables('dbName'), '/current')]\" , \"location\" : \"[parameters('location')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Sql/servers/databases', parameters('serverName'), parameters('databaseName'))]\" ], \"properties\" : { \"status\" : \"Enabled\" } } ] } Configure with Azure CLI # az sql db tde set --status Enabled -s '<server_name>' -d '<database>' -g '<resource_group>' Configure with Azure PowerShell # Set-AzSqlDatabaseTransparentDataEncryption -ResourceGroupName '<resource_group>' -ServerName '<server_name>' -DatabaseName '<database>' -State Enabled Links # Transparent data encryption for SQL Database Azure template reference","title":"Azure.SQL.TDE"},{"location":"en/rules/Azure.SQL.TDE/#use-sql-database-tde","text":"Azure.SQL.TDE AZR-000191 Error Security \u00b7 SQL Database \u00b7 2020_06 Use Transparent Data Encryption (TDE) with Azure SQL Database.","title":"Use SQL database TDE"},{"location":"en/rules/Azure.SQL.TDE/#description","text":"TDE helps protect Azure SQL Databases against malicious offline access by encrypting data at rest. SQL Databases perform real-time encryption and decryption of the database, backups, and log files. Encryption is perform at rest without requiring changes to the application.","title":"Description"},{"location":"en/rules/Azure.SQL.TDE/#recommendation","text":"Consider enable Transparent Data Encryption (TDE) for Azure SQL Databases to perform encryption at rest.","title":"Recommendation"},{"location":"en/rules/Azure.SQL.TDE/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.SQL.TDE/#configure-with-azure-template","text":"{ \"type\" : \"Microsoft.Sql/servers/databases\" , \"apiVersion\" : \"2020-08-01-preview\" , \"name\" : \"[variables('dbName')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"[parameters('sku')]\" }, \"kind\" : \"v12.0,user\" , \"properties\" : { \"collation\" : \"SQL_Latin1_General_CP1_CI_AS\" , \"maxSizeBytes\" : \"[mul(parameters('maxSizeMB'), 1048576)]\" , \"catalogCollation\" : \"SQL_Latin1_General_CP1_CI_AS\" , \"zoneRedundant\" : false , \"readScale\" : \"Disabled\" , \"storageAccountType\" : \"GRS\" }, \"resources\" : [ { \"type\" : \"Microsoft.Sql/servers/databases/transparentDataEncryption\" , \"apiVersion\" : \"2014-04-01\" , \"name\" : \"[concat(variables('dbName'), '/current')]\" , \"location\" : \"[parameters('location')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Sql/servers/databases', parameters('serverName'), parameters('databaseName'))]\" ], \"properties\" : { \"status\" : \"Enabled\" } } ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.SQL.TDE/#configure-with-azure-cli","text":"az sql db tde set --status Enabled -s '<server_name>' -d '<database>' -g '<resource_group>'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.SQL.TDE/#configure-with-azure-powershell","text":"Set-AzSqlDatabaseTransparentDataEncryption -ResourceGroupName '<resource_group>' -ServerName '<server_name>' -DatabaseName '<database>' -State Enabled","title":"Configure with Azure PowerShell"},{"location":"en/rules/Azure.SQL.TDE/#links","text":"Transparent data encryption for SQL Database Azure template reference","title":"Links"},{"location":"en/rules/Azure.SQL.ThreatDetection/","tags":["Azure.SQL.ThreatDetection","AZR-000186"],"text":"Use Advanced Threat Protection # Azure.SQL.ThreatDetection AZR-000186 Error Security \u00b7 SQL Database \u00b7 2020_06 Enable Advanced Thread Protection for Azure SQL logical server. Description # Enable Advanced Thread Protection for Azure SQL logical server. Recommendation # Consider enabling Advanced Data Security and configuring Advanced Thread Protection for SQL logical servers. Examples # Configure with Azure template # { \"comments\" : \"Create or update an Azure SQL logical server.\" , \"type\" : \"Microsoft.Sql/servers\" , \"apiVersion\" : \"2019-06-01-preview\" , \"name\" : \"[parameters('serverName')]\" , \"location\" : \"[parameters('location')]\" , \"tags\" : \"[parameters('tags')]\" , \"kind\" : \"v12.0\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"administratorLogin\" : \"[parameters('adminUsername')]\" , \"version\" : \"12.0\" , \"publicNetworkAccess\" : \"[if(parameters('allowPublicAccess'), 'Enabled', 'Disabled')]\" , \"administratorLoginPassword\" : \"[parameters('adminPassword')]\" , \"minimalTLSVersion\" : \"1.2\" }, \"resources\" : [ { \"type\" : \"Microsoft.Sql/servers/securityAlertPolicies\" , \"apiVersion\" : \"2020-02-02-preview\" , \"name\" : \"[concat(parameters('serverName'), '/Default')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Sql/servers', parameters('serverName'))]\" ], \"properties\" : { \"state\" : \"Enabled\" } } ] } Configure with Azure PowerShell # Set-AzSqlDatabaseThreatDetectionPolicy -ResourceGroupName '<resource_group>' -ServerName '<server_name>' -DatabaseName '<database>' -StorageAccountName '<account_name>' -NotificationRecipientsEmails '<email>' -EmailAdmins $False Links # Advanced Threat Protection for Azure SQL Database Advanced data security for Azure SQL Database Azure template reference","title":"Azure.SQL.ThreatDetection"},{"location":"en/rules/Azure.SQL.ThreatDetection/#use-advanced-threat-protection","text":"Azure.SQL.ThreatDetection AZR-000186 Error Security \u00b7 SQL Database \u00b7 2020_06 Enable Advanced Thread Protection for Azure SQL logical server.","title":"Use Advanced Threat Protection"},{"location":"en/rules/Azure.SQL.ThreatDetection/#description","text":"Enable Advanced Thread Protection for Azure SQL logical server.","title":"Description"},{"location":"en/rules/Azure.SQL.ThreatDetection/#recommendation","text":"Consider enabling Advanced Data Security and configuring Advanced Thread Protection for SQL logical servers.","title":"Recommendation"},{"location":"en/rules/Azure.SQL.ThreatDetection/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.SQL.ThreatDetection/#configure-with-azure-template","text":"{ \"comments\" : \"Create or update an Azure SQL logical server.\" , \"type\" : \"Microsoft.Sql/servers\" , \"apiVersion\" : \"2019-06-01-preview\" , \"name\" : \"[parameters('serverName')]\" , \"location\" : \"[parameters('location')]\" , \"tags\" : \"[parameters('tags')]\" , \"kind\" : \"v12.0\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"administratorLogin\" : \"[parameters('adminUsername')]\" , \"version\" : \"12.0\" , \"publicNetworkAccess\" : \"[if(parameters('allowPublicAccess'), 'Enabled', 'Disabled')]\" , \"administratorLoginPassword\" : \"[parameters('adminPassword')]\" , \"minimalTLSVersion\" : \"1.2\" }, \"resources\" : [ { \"type\" : \"Microsoft.Sql/servers/securityAlertPolicies\" , \"apiVersion\" : \"2020-02-02-preview\" , \"name\" : \"[concat(parameters('serverName'), '/Default')]\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Sql/servers', parameters('serverName'))]\" ], \"properties\" : { \"state\" : \"Enabled\" } } ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.SQL.ThreatDetection/#configure-with-azure-powershell","text":"Set-AzSqlDatabaseThreatDetectionPolicy -ResourceGroupName '<resource_group>' -ServerName '<server_name>' -DatabaseName '<database>' -StorageAccountName '<account_name>' -NotificationRecipientsEmails '<email>' -EmailAdmins $False","title":"Configure with Azure PowerShell"},{"location":"en/rules/Azure.SQL.ThreatDetection/#links","text":"Advanced Threat Protection for Azure SQL Database Advanced data security for Azure SQL Database Azure template reference","title":"Links"},{"location":"en/rules/Azure.SQLMI.Name/","tags":["Azure.SQLMI.Name","AZR-000194"],"text":"Use valid SQL Managed Instance names # Azure.SQLMI.Name AZR-000194 Error Operational Excellence \u00b7 SQL Managed Instance \u00b7 2020_12 SQL Managed Instance names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for SQL Managed Instance names are: Between 1 and 63 characters long. Lowercase letters, numbers, and hyphens. Can't start or end with a hyphen. SQL Managed Instance names must be globally unique. Recommendation # Consider using names that meet SQL Managed Instance naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if SQL Managed Instance names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.SQLMI.Name"},{"location":"en/rules/Azure.SQLMI.Name/#use-valid-sql-managed-instance-names","text":"Azure.SQLMI.Name AZR-000194 Error Operational Excellence \u00b7 SQL Managed Instance \u00b7 2020_12 SQL Managed Instance names should meet naming requirements.","title":"Use valid SQL Managed Instance names"},{"location":"en/rules/Azure.SQLMI.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for SQL Managed Instance names are: Between 1 and 63 characters long. Lowercase letters, numbers, and hyphens. Can't start or end with a hyphen. SQL Managed Instance names must be globally unique.","title":"Description"},{"location":"en/rules/Azure.SQLMI.Name/#recommendation","text":"Consider using names that meet SQL Managed Instance naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.SQLMI.Name/#notes","text":"This rule does not check if SQL Managed Instance names are unique.","title":"Notes"},{"location":"en/rules/Azure.SQLMI.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.Search.IndexSLA/","tags":["Azure.Search.IndexSLA","AZR-000174"],"text":"Search index update SLA minimum replicas # Azure.Search.IndexSLA AZR-000174 Error Reliability \u00b7 Cognitive Search \u00b7 2021_06 Use a minimum of 3 replicas to receive an SLA for query and index updates. Description # Cognitive Search services support indexing and querying . Indexing is the process of loading content into the service to make it searchable. Querying is the process where a client searches for content by sending queries to the index. Cognitive Search supports a configurable number of replicas. Having multiple replicas allows queries and index updates to load balance across multiple replicas. To receive a Service Level Agreement (SLA) for Search index updates a minimum of 3 replicas is required. Recommendation # Consider increasing the number of replicas to a minimum of 3 to receive an SLA on index update requests. Examples # Configure with Azure template # To deploy Cognitive Search services that pass this rule: Set the replicaCount to a minimum of 3. For example: { \"apiVersion\" : \"2020-08-01\" , \"name\" : \"[parameters('serviceName')]\" , \"location\" : \"[parameters('location')]\" , \"type\" : \"Microsoft.Search/searchServices\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"[parameters('sku')]\" }, \"properties\" : { \"replicaCount\" : 3 , \"partitionCount\" : 1 , \"hostingMode\" : \"default\" }, \"tags\" : {}, \"dependsOn\" : [] } Links # Azure template reference SLA for Azure Cognitive Search Resiliency checklist for specific Azure services","title":"Azure.Search.IndexSLA"},{"location":"en/rules/Azure.Search.IndexSLA/#search-index-update-sla-minimum-replicas","text":"Azure.Search.IndexSLA AZR-000174 Error Reliability \u00b7 Cognitive Search \u00b7 2021_06 Use a minimum of 3 replicas to receive an SLA for query and index updates.","title":"Search index update SLA minimum replicas"},{"location":"en/rules/Azure.Search.IndexSLA/#description","text":"Cognitive Search services support indexing and querying . Indexing is the process of loading content into the service to make it searchable. Querying is the process where a client searches for content by sending queries to the index. Cognitive Search supports a configurable number of replicas. Having multiple replicas allows queries and index updates to load balance across multiple replicas. To receive a Service Level Agreement (SLA) for Search index updates a minimum of 3 replicas is required.","title":"Description"},{"location":"en/rules/Azure.Search.IndexSLA/#recommendation","text":"Consider increasing the number of replicas to a minimum of 3 to receive an SLA on index update requests.","title":"Recommendation"},{"location":"en/rules/Azure.Search.IndexSLA/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Search.IndexSLA/#configure-with-azure-template","text":"To deploy Cognitive Search services that pass this rule: Set the replicaCount to a minimum of 3. For example: { \"apiVersion\" : \"2020-08-01\" , \"name\" : \"[parameters('serviceName')]\" , \"location\" : \"[parameters('location')]\" , \"type\" : \"Microsoft.Search/searchServices\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"[parameters('sku')]\" }, \"properties\" : { \"replicaCount\" : 3 , \"partitionCount\" : 1 , \"hostingMode\" : \"default\" }, \"tags\" : {}, \"dependsOn\" : [] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Search.IndexSLA/#links","text":"Azure template reference SLA for Azure Cognitive Search Resiliency checklist for specific Azure services","title":"Links"},{"location":"en/rules/Azure.Search.ManagedIdentity/","tags":["Azure.Search.ManagedIdentity","AZR-000175"],"text":"Search services uses a managed identity # Azure.Search.ManagedIdentity AZR-000175 Error Security \u00b7 Cognitive Search \u00b7 2021_06 Configure managed identities to access Azure resources. Description # Connections to Azure resources is required to use some features including indexing and customer managed-keys. Cognitive Search can use managed identities to authenticate to Azure resource without storing credentials. Using Azure managed identities have the following benefits: You don't need to store or manage credentials. Azure automatically generates tokens and performs rotation. You can use managed identities to authenticate to any Azure service that supports Azure AD authentication. Managed identities can be used without any additional cost. Recommendation # Consider configuring a managed identity for each Cognitive Search service. Also consider using managed identities to authenticate to related Azure services. Examples # Configure with Azure template # To deploy Cognitive Search services that pass this rule: Set the identity.type to SystemAssigned . For example: { \"apiVersion\" : \"2020-08-01\" , \"name\" : \"[parameters('serviceName')]\" , \"location\" : \"[parameters('location')]\" , \"type\" : \"Microsoft.Search/searchServices\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"[parameters('sku')]\" }, \"properties\" : { \"replicaCount\" : 3 , \"partitionCount\" : 1 , \"hostingMode\" : \"default\" }, \"tags\" : {}, \"dependsOn\" : [] } Links # Use identity-based authentication What are managed identities for Azure resources? Set up an indexer connection to a data source using a managed identity Indexer access to Azure Storage using the trusted service exception (Azure Cognitive Search)","title":"Azure.Search.ManagedIdentity"},{"location":"en/rules/Azure.Search.ManagedIdentity/#search-services-uses-a-managed-identity","text":"Azure.Search.ManagedIdentity AZR-000175 Error Security \u00b7 Cognitive Search \u00b7 2021_06 Configure managed identities to access Azure resources.","title":"Search services uses a managed identity"},{"location":"en/rules/Azure.Search.ManagedIdentity/#description","text":"Connections to Azure resources is required to use some features including indexing and customer managed-keys. Cognitive Search can use managed identities to authenticate to Azure resource without storing credentials. Using Azure managed identities have the following benefits: You don't need to store or manage credentials. Azure automatically generates tokens and performs rotation. You can use managed identities to authenticate to any Azure service that supports Azure AD authentication. Managed identities can be used without any additional cost.","title":"Description"},{"location":"en/rules/Azure.Search.ManagedIdentity/#recommendation","text":"Consider configuring a managed identity for each Cognitive Search service. Also consider using managed identities to authenticate to related Azure services.","title":"Recommendation"},{"location":"en/rules/Azure.Search.ManagedIdentity/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Search.ManagedIdentity/#configure-with-azure-template","text":"To deploy Cognitive Search services that pass this rule: Set the identity.type to SystemAssigned . For example: { \"apiVersion\" : \"2020-08-01\" , \"name\" : \"[parameters('serviceName')]\" , \"location\" : \"[parameters('location')]\" , \"type\" : \"Microsoft.Search/searchServices\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"[parameters('sku')]\" }, \"properties\" : { \"replicaCount\" : 3 , \"partitionCount\" : 1 , \"hostingMode\" : \"default\" }, \"tags\" : {}, \"dependsOn\" : [] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Search.ManagedIdentity/#links","text":"Use identity-based authentication What are managed identities for Azure resources? Set up an indexer connection to a data source using a managed identity Indexer access to Azure Storage using the trusted service exception (Azure Cognitive Search)","title":"Links"},{"location":"en/rules/Azure.Search.Name/","tags":["Azure.Search.Name","AZR-000176"],"text":"Use valid Cognitive Search service names # Azure.Search.Name AZR-000176 Error Operational Excellence \u00b7 Cognitive Search \u00b7 2021_06 Azure Cognitive Search service names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Cognitive Search service names are: Between 2 and 60 characters long. Lowercase letters, numbers, and hyphens. The first two and last one character must be a letter or a number. Cognitive Search service names must be globally unique. Recommendation # Consider using names that meet Azure Cognitive Search service naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Azure Cognitive Search service names are unique. Links # Repeatable infrastructure REST API reference Define your naming convention Recommended abbreviations for Azure resource types","title":"Azure.Search.Name"},{"location":"en/rules/Azure.Search.Name/#use-valid-cognitive-search-service-names","text":"Azure.Search.Name AZR-000176 Error Operational Excellence \u00b7 Cognitive Search \u00b7 2021_06 Azure Cognitive Search service names should meet naming requirements.","title":"Use valid Cognitive Search service names"},{"location":"en/rules/Azure.Search.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Cognitive Search service names are: Between 2 and 60 characters long. Lowercase letters, numbers, and hyphens. The first two and last one character must be a letter or a number. Cognitive Search service names must be globally unique.","title":"Description"},{"location":"en/rules/Azure.Search.Name/#recommendation","text":"Consider using names that meet Azure Cognitive Search service naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.Search.Name/#notes","text":"This rule does not check if Azure Cognitive Search service names are unique.","title":"Notes"},{"location":"en/rules/Azure.Search.Name/#links","text":"Repeatable infrastructure REST API reference Define your naming convention Recommended abbreviations for Azure resource types","title":"Links"},{"location":"en/rules/Azure.Search.QuerySLA/","tags":["Azure.Search.QuerySLA","AZR-000173"],"text":"Search query SLA minimum replicas # Azure.Search.QuerySLA AZR-000173 Error Reliability \u00b7 Cognitive Search \u00b7 2021_06 Use a minimum of 2 replicas to receive an SLA for index queries. Description # Cognitive Search services support indexing and querying . Indexing is the process of loading content into the service to make it searchable. Querying is the process where a client searches for content by sending queries to the index. Cognitive Search supports a configurable number of replicas. Having multiple replicas allows queries and index updates to load balance across multiple replicas. To receive a Service Level Agreement (SLA) for Search index queries a minimum of 2 replicas is required. Recommendation # Consider increasing the number of replicas to a minimum of 2 to receive an SLA on index query requests. Examples # Configure with Azure template # To deploy Cognitive Search services that pass this rule: Set the replicaCount to a minimum of 2. For example: { \"apiVersion\" : \"2020-08-01\" , \"name\" : \"[parameters('serviceName')]\" , \"location\" : \"[parameters('location')]\" , \"type\" : \"Microsoft.Search/searchServices\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"[parameters('sku')]\" }, \"properties\" : { \"replicaCount\" : 3 , \"partitionCount\" : 1 , \"hostingMode\" : \"default\" }, \"tags\" : {}, \"dependsOn\" : [] } Links # Azure template reference SLA for Azure Cognitive Search Resiliency checklist for specific Azure services","title":"Azure.Search.QuerySLA"},{"location":"en/rules/Azure.Search.QuerySLA/#search-query-sla-minimum-replicas","text":"Azure.Search.QuerySLA AZR-000173 Error Reliability \u00b7 Cognitive Search \u00b7 2021_06 Use a minimum of 2 replicas to receive an SLA for index queries.","title":"Search query SLA minimum replicas"},{"location":"en/rules/Azure.Search.QuerySLA/#description","text":"Cognitive Search services support indexing and querying . Indexing is the process of loading content into the service to make it searchable. Querying is the process where a client searches for content by sending queries to the index. Cognitive Search supports a configurable number of replicas. Having multiple replicas allows queries and index updates to load balance across multiple replicas. To receive a Service Level Agreement (SLA) for Search index queries a minimum of 2 replicas is required.","title":"Description"},{"location":"en/rules/Azure.Search.QuerySLA/#recommendation","text":"Consider increasing the number of replicas to a minimum of 2 to receive an SLA on index query requests.","title":"Recommendation"},{"location":"en/rules/Azure.Search.QuerySLA/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Search.QuerySLA/#configure-with-azure-template","text":"To deploy Cognitive Search services that pass this rule: Set the replicaCount to a minimum of 2. For example: { \"apiVersion\" : \"2020-08-01\" , \"name\" : \"[parameters('serviceName')]\" , \"location\" : \"[parameters('location')]\" , \"type\" : \"Microsoft.Search/searchServices\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"[parameters('sku')]\" }, \"properties\" : { \"replicaCount\" : 3 , \"partitionCount\" : 1 , \"hostingMode\" : \"default\" }, \"tags\" : {}, \"dependsOn\" : [] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Search.QuerySLA/#links","text":"Azure template reference SLA for Azure Cognitive Search Resiliency checklist for specific Azure services","title":"Links"},{"location":"en/rules/Azure.Search.SKU/","tags":["Azure.Search.SKU","AZR-000172"],"text":"Cognitive Search minimum SKU # Azure.Search.SKU AZR-000172 Error Performance Efficiency \u00b7 Cognitive Search \u00b7 2021_06 Use the basic and standard tiers for entry level workloads. Description # Cognitive Search services using the Free tier run on resources shared across multiple subscribers. The Free tier is only suggested for limited small scale tests such as running code samples or tutorials. Running more demanding workloads on the Free tier may experience unpredictable performance or issues. To select a tier for your workload, estimate and test your required capacity. Recommendation # Consider deploying Cognitive Search services using basic or higher tier. Examples # Configure with Azure template # To deploy Cognitive Search services that pass this rule: Set the sku.name to a minimum of basic. For example: { \"apiVersion\" : \"2020-08-01\" , \"name\" : \"[parameters('serviceName')]\" , \"location\" : \"[parameters('location')]\" , \"type\" : \"Microsoft.Search/searchServices\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"basic\" }, \"properties\" : { \"replicaCount\" : 3 , \"partitionCount\" : 1 , \"hostingMode\" : \"default\" }, \"tags\" : {}, \"dependsOn\" : [] } Links # Azure template reference SLA for Azure Cognitive Search Estimate and manage capacity of an Azure Cognitive Search service Choosing the right resources","title":"Azure.Search.SKU"},{"location":"en/rules/Azure.Search.SKU/#cognitive-search-minimum-sku","text":"Azure.Search.SKU AZR-000172 Error Performance Efficiency \u00b7 Cognitive Search \u00b7 2021_06 Use the basic and standard tiers for entry level workloads.","title":"Cognitive Search minimum SKU"},{"location":"en/rules/Azure.Search.SKU/#description","text":"Cognitive Search services using the Free tier run on resources shared across multiple subscribers. The Free tier is only suggested for limited small scale tests such as running code samples or tutorials. Running more demanding workloads on the Free tier may experience unpredictable performance or issues. To select a tier for your workload, estimate and test your required capacity.","title":"Description"},{"location":"en/rules/Azure.Search.SKU/#recommendation","text":"Consider deploying Cognitive Search services using basic or higher tier.","title":"Recommendation"},{"location":"en/rules/Azure.Search.SKU/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Search.SKU/#configure-with-azure-template","text":"To deploy Cognitive Search services that pass this rule: Set the sku.name to a minimum of basic. For example: { \"apiVersion\" : \"2020-08-01\" , \"name\" : \"[parameters('serviceName')]\" , \"location\" : \"[parameters('location')]\" , \"type\" : \"Microsoft.Search/searchServices\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"basic\" }, \"properties\" : { \"replicaCount\" : 3 , \"partitionCount\" : 1 , \"hostingMode\" : \"default\" }, \"tags\" : {}, \"dependsOn\" : [] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Search.SKU/#links","text":"Azure template reference SLA for Azure Cognitive Search Estimate and manage capacity of an Azure Cognitive Search service Choosing the right resources","title":"Links"},{"location":"en/rules/Azure.SecurityCenter.Contact/","tags":["Azure.SecurityCenter.Contact","AZR-000209"],"text":"Set Security Center contact details # Azure.SecurityCenter.Contact AZR-000209 Error Security \u00b7 Security Center \u00b7 2020_06 Security Center email and phone contact details should be set. Description # Security contact details configured in Security Center are used by Microsoft to notify you in response to certain security events. Recommendation # Consider configuring Security Center email and phone contact details. LINK # Provide security contact details in Azure Security Center","title":"Azure.SecurityCenter.Contact"},{"location":"en/rules/Azure.SecurityCenter.Contact/#set-security-center-contact-details","text":"Azure.SecurityCenter.Contact AZR-000209 Error Security \u00b7 Security Center \u00b7 2020_06 Security Center email and phone contact details should be set.","title":"Set Security Center contact details"},{"location":"en/rules/Azure.SecurityCenter.Contact/#description","text":"Security contact details configured in Security Center are used by Microsoft to notify you in response to certain security events.","title":"Description"},{"location":"en/rules/Azure.SecurityCenter.Contact/#recommendation","text":"Consider configuring Security Center email and phone contact details.","title":"Recommendation"},{"location":"en/rules/Azure.SecurityCenter.Contact/#link","text":"Provide security contact details in Azure Security Center","title":"LINK"},{"location":"en/rules/Azure.SecurityCenter.Provisioning/","tags":["Azure.SecurityCenter.Provisioning","AZR-000210"],"text":"Enable Security Center auto-provisioning # Azure.SecurityCenter.Provisioning AZR-000210 Error Security \u00b7 Security Center \u00b7 2020_06 Enable auto-provisioning on to improve Azure Security Center insights. Description # Select resources such as virtual machines (VMs) and VM scale sets require an agent to be installed to collect additional information from the operating system (OS). This information is used to identify missing security updates and additional threats. By turning auto-provisioning on, Security Center automatically deploys an Azure Monitor agent to VMs on a regular basis. Recommendation # Consider enabling auto-provisioning to improve Azure Security Center VM insights. Links # Data collection in Azure Security Center","title":"Azure.SecurityCenter.Provisioning"},{"location":"en/rules/Azure.SecurityCenter.Provisioning/#enable-security-center-auto-provisioning","text":"Azure.SecurityCenter.Provisioning AZR-000210 Error Security \u00b7 Security Center \u00b7 2020_06 Enable auto-provisioning on to improve Azure Security Center insights.","title":"Enable Security Center auto-provisioning"},{"location":"en/rules/Azure.SecurityCenter.Provisioning/#description","text":"Select resources such as virtual machines (VMs) and VM scale sets require an agent to be installed to collect additional information from the operating system (OS). This information is used to identify missing security updates and additional threats. By turning auto-provisioning on, Security Center automatically deploys an Azure Monitor agent to VMs on a regular basis.","title":"Description"},{"location":"en/rules/Azure.SecurityCenter.Provisioning/#recommendation","text":"Consider enabling auto-provisioning to improve Azure Security Center VM insights.","title":"Recommendation"},{"location":"en/rules/Azure.SecurityCenter.Provisioning/#links","text":"Data collection in Azure Security Center","title":"Links"},{"location":"en/rules/Azure.ServiceBus.DisableLocalAuth/","tags":["Azure.ServiceBus.DisableLocalAuth","AZR-000178"],"text":"Use identity-based authentication for Service Bus namespaces # Azure.ServiceBus.DisableLocalAuth AZR-000178 Error Security \u00b7 Service Bus \u00b7 2022_03 Authenticate Service Bus publishers and consumers with Azure AD identities. Description # To publish or consume messages from Service Bus cryptographic keys, or Azure AD identities can be used. Cryptographic keys include Shared Access Policy keys or Shared Access Signature (SAS) tokens. With Azure AD authentication, the identity is validated against Azure AD. Using Azure AD identities centralizes identity management and auditing. Once you decide to use Azure AD authentication, you can disable authentication using keys or SAS tokens. Recommendation # Consider only using Azure AD identities to publish or consume messages from Service Bus. Then disable authentication based on access keys or SAS tokens. Examples # Configure with Azure template # To deploy Service Bus namespaces that pass this rule: Set the properties.disableLocalAuth property to true . For example: { \"type\" : \"Microsoft.ServiceBus/namespaces\" , \"apiVersion\" : \"2021-11-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"Standard\" }, \"properties\" : { \"disableLocalAuth\" : true } } Configure with Bicep # To deploy Service Bus namespaces that pass this rule: Set the properties.disableLocalAuth property to true . For example: resource ns 'Microsoft.ServiceBus/namespaces@2021-11-01' = { name: name location: location identity: { type: 'SystemAssigned' } sku: { name: 'Standard' } properties: { disableLocalAuth: true } } Links # Use identity-based authentication Service Bus authentication and authorization Azure template reference","title":"Azure.ServiceBus.DisableLocalAuth"},{"location":"en/rules/Azure.ServiceBus.DisableLocalAuth/#use-identity-based-authentication-for-service-bus-namespaces","text":"Azure.ServiceBus.DisableLocalAuth AZR-000178 Error Security \u00b7 Service Bus \u00b7 2022_03 Authenticate Service Bus publishers and consumers with Azure AD identities.","title":"Use identity-based authentication for Service Bus namespaces"},{"location":"en/rules/Azure.ServiceBus.DisableLocalAuth/#description","text":"To publish or consume messages from Service Bus cryptographic keys, or Azure AD identities can be used. Cryptographic keys include Shared Access Policy keys or Shared Access Signature (SAS) tokens. With Azure AD authentication, the identity is validated against Azure AD. Using Azure AD identities centralizes identity management and auditing. Once you decide to use Azure AD authentication, you can disable authentication using keys or SAS tokens.","title":"Description"},{"location":"en/rules/Azure.ServiceBus.DisableLocalAuth/#recommendation","text":"Consider only using Azure AD identities to publish or consume messages from Service Bus. Then disable authentication based on access keys or SAS tokens.","title":"Recommendation"},{"location":"en/rules/Azure.ServiceBus.DisableLocalAuth/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.ServiceBus.DisableLocalAuth/#configure-with-azure-template","text":"To deploy Service Bus namespaces that pass this rule: Set the properties.disableLocalAuth property to true . For example: { \"type\" : \"Microsoft.ServiceBus/namespaces\" , \"apiVersion\" : \"2021-11-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"identity\" : { \"type\" : \"SystemAssigned\" }, \"sku\" : { \"name\" : \"Standard\" }, \"properties\" : { \"disableLocalAuth\" : true } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.ServiceBus.DisableLocalAuth/#configure-with-bicep","text":"To deploy Service Bus namespaces that pass this rule: Set the properties.disableLocalAuth property to true . For example: resource ns 'Microsoft.ServiceBus/namespaces@2021-11-01' = { name: name location: location identity: { type: 'SystemAssigned' } sku: { name: 'Standard' } properties: { disableLocalAuth: true } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.ServiceBus.DisableLocalAuth/#links","text":"Use identity-based authentication Service Bus authentication and authorization Azure template reference","title":"Links"},{"location":"en/rules/Azure.ServiceBus.Usage/","tags":["Azure.ServiceBus.Usage","AZR-000177"],"text":"Remove unused Service Bus namespaces # Azure.ServiceBus.Usage AZR-000177 Error Cost Optimization \u00b7 Service Bus \u00b7 2022_03 Regularly remove unused resources to reduce costs. Description # Billing starts for a Standard or Premium Service Bus namespace after it is provisioned. To to receive messages you must first create at least one queue or topic. Namespaces without any queues or topics are considered unused. Recommendation # Consider removing Service Bus namespaces that are not used. Notes # This rule applies when analyzing resources deployed (in-flight) to Azure. Links # Generate cost reports Pricing","title":"Azure.ServiceBus.Usage"},{"location":"en/rules/Azure.ServiceBus.Usage/#remove-unused-service-bus-namespaces","text":"Azure.ServiceBus.Usage AZR-000177 Error Cost Optimization \u00b7 Service Bus \u00b7 2022_03 Regularly remove unused resources to reduce costs.","title":"Remove unused Service Bus namespaces"},{"location":"en/rules/Azure.ServiceBus.Usage/#description","text":"Billing starts for a Standard or Premium Service Bus namespace after it is provisioned. To to receive messages you must first create at least one queue or topic. Namespaces without any queues or topics are considered unused.","title":"Description"},{"location":"en/rules/Azure.ServiceBus.Usage/#recommendation","text":"Consider removing Service Bus namespaces that are not used.","title":"Recommendation"},{"location":"en/rules/Azure.ServiceBus.Usage/#notes","text":"This rule applies when analyzing resources deployed (in-flight) to Azure.","title":"Notes"},{"location":"en/rules/Azure.ServiceBus.Usage/#links","text":"Generate cost reports Pricing","title":"Links"},{"location":"en/rules/Azure.ServiceFabric.AAD/","tags":["Azure.ServiceFabric.AAD","AZR-000179"],"text":"Use AAD authentication with Service Fabric clusters # Azure.ServiceFabric.AAD AZR-000179 Error Security \u00b7 Service Fabric \u00b7 2021_03 Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Description # When deploying Service Fabric clusters on Azure, AAD can optionally be used to secure management endpoints. If configured, client authentication (client-to-node security) uses AAD. Additionally Azure Role-based Access Control (RBAC) can be used to delegate cluster access. For Service Fabric clusters running on Azure, AAD is recommended to secure access to management endpoints. Recommendation # Consider enabling Azure Active Directory (AAD) client authentication for Service Fabric clusters. Notes # For Linux clusters, AAD authentication must be configured at cluster creation time. Windows cluster can be updated to support AAD authentication after initial deployment. Links # Security recommendations Set up Azure Active Directory for client authentication Configure Azure Active Directory Authentication for Existing Cluster","title":"Azure.ServiceFabric.AAD"},{"location":"en/rules/Azure.ServiceFabric.AAD/#use-aad-authentication-with-service-fabric-clusters","text":"Azure.ServiceFabric.AAD AZR-000179 Error Security \u00b7 Service Fabric \u00b7 2021_03 Use Azure Active Directory (AAD) client authentication for Service Fabric clusters.","title":"Use AAD authentication with Service Fabric clusters"},{"location":"en/rules/Azure.ServiceFabric.AAD/#description","text":"When deploying Service Fabric clusters on Azure, AAD can optionally be used to secure management endpoints. If configured, client authentication (client-to-node security) uses AAD. Additionally Azure Role-based Access Control (RBAC) can be used to delegate cluster access. For Service Fabric clusters running on Azure, AAD is recommended to secure access to management endpoints.","title":"Description"},{"location":"en/rules/Azure.ServiceFabric.AAD/#recommendation","text":"Consider enabling Azure Active Directory (AAD) client authentication for Service Fabric clusters.","title":"Recommendation"},{"location":"en/rules/Azure.ServiceFabric.AAD/#notes","text":"For Linux clusters, AAD authentication must be configured at cluster creation time. Windows cluster can be updated to support AAD authentication after initial deployment.","title":"Notes"},{"location":"en/rules/Azure.ServiceFabric.AAD/#links","text":"Security recommendations Set up Azure Active Directory for client authentication Configure Azure Active Directory Authentication for Existing Cluster","title":"Links"},{"location":"en/rules/Azure.SignalR.ManagedIdentity/","tags":["Azure.SignalR.ManagedIdentity","AZR-000181"],"text":"Use managed identities for SignalR Services # Azure.SignalR.ManagedIdentity AZR-000181 Error Security \u00b7 SignalR Service \u00b7 2022_03 Configure SignalR Services to use managed identities to access Azure resources securely. Description # A managed identity allows your service to access other Azure AD-protected resources such as Azure Functions. The identity is managed by the Azure platform and doesn't require you to provision or rotate any secrets. Using Azure managed identities have the following benefits: You don't need to store or manage credentials. Azure automatically generates tokens and performs rotation. You can use managed identities to authenticate to any Azure service that supports Azure AD authentication. Managed identities can be used without any additional cost. Recommendation # Consider configuring a managed identity for each SignalR Service. Also consider using managed identities to authenticate to related Azure services. Examples # Configure with Azure template # To deploy services that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: { \"type\" : \"Microsoft.SignalRService/signalR\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"kind\" : \"SignalR\" , \"sku\" : { \"name\" : \"Standard_S1\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : true , \"features\" : [ { \"flag\" : \"ServiceMode\" , \"value\" : \"Serverless\" } ] } } Configure with Bicep # To deploy services that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: resource service 'Microsoft.SignalRService/signalR@2021-10-01' = { name: name location: location kind: 'SignalR' sku: { name: 'Standard_S1' } identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: true features: [ { flag: 'ServiceMode' value: 'Serverless' } ] } } Links # Use identity-based authentication Managed identities for Azure SignalR Service Azure template reference","title":"Azure.SignalR.ManagedIdentity"},{"location":"en/rules/Azure.SignalR.ManagedIdentity/#use-managed-identities-for-signalr-services","text":"Azure.SignalR.ManagedIdentity AZR-000181 Error Security \u00b7 SignalR Service \u00b7 2022_03 Configure SignalR Services to use managed identities to access Azure resources securely.","title":"Use managed identities for SignalR Services"},{"location":"en/rules/Azure.SignalR.ManagedIdentity/#description","text":"A managed identity allows your service to access other Azure AD-protected resources such as Azure Functions. The identity is managed by the Azure platform and doesn't require you to provision or rotate any secrets. Using Azure managed identities have the following benefits: You don't need to store or manage credentials. Azure automatically generates tokens and performs rotation. You can use managed identities to authenticate to any Azure service that supports Azure AD authentication. Managed identities can be used without any additional cost.","title":"Description"},{"location":"en/rules/Azure.SignalR.ManagedIdentity/#recommendation","text":"Consider configuring a managed identity for each SignalR Service. Also consider using managed identities to authenticate to related Azure services.","title":"Recommendation"},{"location":"en/rules/Azure.SignalR.ManagedIdentity/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.SignalR.ManagedIdentity/#configure-with-azure-template","text":"To deploy services that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: { \"type\" : \"Microsoft.SignalRService/signalR\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"kind\" : \"SignalR\" , \"sku\" : { \"name\" : \"Standard_S1\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : true , \"features\" : [ { \"flag\" : \"ServiceMode\" , \"value\" : \"Serverless\" } ] } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.SignalR.ManagedIdentity/#configure-with-bicep","text":"To deploy services that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: resource service 'Microsoft.SignalRService/signalR@2021-10-01' = { name: name location: location kind: 'SignalR' sku: { name: 'Standard_S1' } identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: true features: [ { flag: 'ServiceMode' value: 'Serverless' } ] } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.SignalR.ManagedIdentity/#links","text":"Use identity-based authentication Managed identities for Azure SignalR Service Azure template reference","title":"Links"},{"location":"en/rules/Azure.SignalR.Name/","tags":["Azure.SignalR.Name","AZR-000180"],"text":"Use valid SignalR service names # Azure.SignalR.Name AZR-000180 Error Operational Excellence \u00b7 SignalR Service \u00b7 2020_06 SignalR service instance names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for SignalR service names are: Between 3 and 63 characters long. Alphanumerics and hyphens. Start with letter. End with letter or number. SignalR service names must be globally unique. Recommendation # Consider using names that meet SignalR service naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if SignalR service names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference","title":"Azure.SignalR.Name"},{"location":"en/rules/Azure.SignalR.Name/#use-valid-signalr-service-names","text":"Azure.SignalR.Name AZR-000180 Error Operational Excellence \u00b7 SignalR Service \u00b7 2020_06 SignalR service instance names should meet naming requirements.","title":"Use valid SignalR service names"},{"location":"en/rules/Azure.SignalR.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for SignalR service names are: Between 3 and 63 characters long. Alphanumerics and hyphens. Start with letter. End with letter or number. SignalR service names must be globally unique.","title":"Description"},{"location":"en/rules/Azure.SignalR.Name/#recommendation","text":"Consider using names that meet SignalR service naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.SignalR.Name/#notes","text":"This rule does not check if SignalR service names are unique.","title":"Notes"},{"location":"en/rules/Azure.SignalR.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference","title":"Links"},{"location":"en/rules/Azure.SignalR.SLA/","tags":["Azure.SignalR.SLA","AZR-000182"],"text":"Use an SLA for SignalR Services # Azure.SignalR.SLA AZR-000182 Error Reliability \u00b7 SignalR Service \u00b7 2022_03 Use SKUs that include an SLA when configuring SignalR Services. Description # When choosing a SKU for a SignalR Service you should consider the SLA that is included in the SKU. SignalR Services offer a range of SKU offerings: Free - Are designed for early non-production use and do not include any SLA. Standard - Are designed for production use and include an SLA. Premium - Are designed for production use and include an SLA. Additional, Premium SKUs support increased resilience with Availablity Zones. Recommendation # Consider using a Standard or Premium SKU that includes an SLA. Examples # Configure with Azure template # To deploy services that pass this rule: Set sku.name to Standard_S1 or Premium_P1 . For example: { \"type\" : \"Microsoft.SignalRService/signalR\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"kind\" : \"SignalR\" , \"sku\" : { \"name\" : \"Standard_S1\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : true , \"features\" : [ { \"flag\" : \"ServiceMode\" , \"value\" : \"Serverless\" } ] } } Configure with Bicep # To deploy services that pass this rule: Set sku.name to Standard_S1 or Premium_P1 . For example: resource service 'Microsoft.SignalRService/signalR@2021-10-01' = { name: name location: location kind: 'SignalR' sku: { name: 'Standard_S1' } identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: true features: [ { flag: 'ServiceMode' value: 'Serverless' } ] } } Links # Target and non-functional requirements Azure SignalR Service pricing Azure template reference","title":"Azure.SignalR.SLA"},{"location":"en/rules/Azure.SignalR.SLA/#use-an-sla-for-signalr-services","text":"Azure.SignalR.SLA AZR-000182 Error Reliability \u00b7 SignalR Service \u00b7 2022_03 Use SKUs that include an SLA when configuring SignalR Services.","title":"Use an SLA for SignalR Services"},{"location":"en/rules/Azure.SignalR.SLA/#description","text":"When choosing a SKU for a SignalR Service you should consider the SLA that is included in the SKU. SignalR Services offer a range of SKU offerings: Free - Are designed for early non-production use and do not include any SLA. Standard - Are designed for production use and include an SLA. Premium - Are designed for production use and include an SLA. Additional, Premium SKUs support increased resilience with Availablity Zones.","title":"Description"},{"location":"en/rules/Azure.SignalR.SLA/#recommendation","text":"Consider using a Standard or Premium SKU that includes an SLA.","title":"Recommendation"},{"location":"en/rules/Azure.SignalR.SLA/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.SignalR.SLA/#configure-with-azure-template","text":"To deploy services that pass this rule: Set sku.name to Standard_S1 or Premium_P1 . For example: { \"type\" : \"Microsoft.SignalRService/signalR\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"kind\" : \"SignalR\" , \"sku\" : { \"name\" : \"Standard_S1\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : true , \"features\" : [ { \"flag\" : \"ServiceMode\" , \"value\" : \"Serverless\" } ] } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.SignalR.SLA/#configure-with-bicep","text":"To deploy services that pass this rule: Set sku.name to Standard_S1 or Premium_P1 . For example: resource service 'Microsoft.SignalRService/signalR@2021-10-01' = { name: name location: location kind: 'SignalR' sku: { name: 'Standard_S1' } identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: true features: [ { flag: 'ServiceMode' value: 'Serverless' } ] } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.SignalR.SLA/#links","text":"Target and non-functional requirements Azure SignalR Service pricing Azure template reference","title":"Links"},{"location":"en/rules/Azure.Storage.BlobAccessType/","tags":["Azure.Storage.BlobAccessType","AZR-000199"],"text":"Use private blob containers # Azure.Storage.BlobAccessType AZR-000199 Error Security \u00b7 Storage Account \u00b7 2020_06 Use containers configured with a private access type that requires authorization. Description # Azure Storage Account blob containers use the Private access type by default. Additional access types Blob and Container provide anonymous access to blobs without authorization. Blob and Container access types are not intended for access to customer data. When authorization is required, clients must use cryptographic keys or identity-based tokens to authenticate. Blob and Container access types are designed for public access scenarios. For example, storage of web assets like .css and .js files used in public websites. Recommendation # To provide secure access to data always use the Private access type (default). Also consider, disabling public access for the storage account. Examples # Configure with Azure template # To deploy Storage Account blob containers that pass this rule: Set the properties.publicAccess property to None . For example: { \"type\" : \"Microsoft.Storage/storageAccounts/blobServices/containers\" , \"apiVersion\" : \"2021-06-01\" , \"name\" : \"[format('{0}/{1}/{2}', parameters('name'), 'default', variables('containerName'))]\" , \"properties\" : { \"publicAccess\" : \"None\" }, \"dependsOn\" : [ \"[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('name'), 'default')]\" , \"[resourceId('Microsoft.Storage/storageAccounts', parameters('name'))]\" ] } Configure with Bicep # To deploy Storage Account blob containers that pass this rule: Set the properties.publicAccess property to None . For example: resource container 'Microsoft.Storage/storageAccounts/blobServices/containers@2021-06-01' = { parent: blobService name: containerName properties: { publicAccess: 'None' } } Links # Authentication with Azure AD About anonymous public read access Use Azure Policy to enforce authorized access How a shared access signature works Azure template reference","title":"Azure.Storage.BlobAccessType"},{"location":"en/rules/Azure.Storage.BlobAccessType/#use-private-blob-containers","text":"Azure.Storage.BlobAccessType AZR-000199 Error Security \u00b7 Storage Account \u00b7 2020_06 Use containers configured with a private access type that requires authorization.","title":"Use private blob containers"},{"location":"en/rules/Azure.Storage.BlobAccessType/#description","text":"Azure Storage Account blob containers use the Private access type by default. Additional access types Blob and Container provide anonymous access to blobs without authorization. Blob and Container access types are not intended for access to customer data. When authorization is required, clients must use cryptographic keys or identity-based tokens to authenticate. Blob and Container access types are designed for public access scenarios. For example, storage of web assets like .css and .js files used in public websites.","title":"Description"},{"location":"en/rules/Azure.Storage.BlobAccessType/#recommendation","text":"To provide secure access to data always use the Private access type (default). Also consider, disabling public access for the storage account.","title":"Recommendation"},{"location":"en/rules/Azure.Storage.BlobAccessType/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Storage.BlobAccessType/#configure-with-azure-template","text":"To deploy Storage Account blob containers that pass this rule: Set the properties.publicAccess property to None . For example: { \"type\" : \"Microsoft.Storage/storageAccounts/blobServices/containers\" , \"apiVersion\" : \"2021-06-01\" , \"name\" : \"[format('{0}/{1}/{2}', parameters('name'), 'default', variables('containerName'))]\" , \"properties\" : { \"publicAccess\" : \"None\" }, \"dependsOn\" : [ \"[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('name'), 'default')]\" , \"[resourceId('Microsoft.Storage/storageAccounts', parameters('name'))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Storage.BlobAccessType/#configure-with-bicep","text":"To deploy Storage Account blob containers that pass this rule: Set the properties.publicAccess property to None . For example: resource container 'Microsoft.Storage/storageAccounts/blobServices/containers@2021-06-01' = { parent: blobService name: containerName properties: { publicAccess: 'None' } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Storage.BlobAccessType/#links","text":"Authentication with Azure AD About anonymous public read access Use Azure Policy to enforce authorized access How a shared access signature works Azure template reference","title":"Links"},{"location":"en/rules/Azure.Storage.BlobPublicAccess/","tags":["Azure.Storage.BlobPublicAccess","AZR-000198"],"text":"Disallow anonymous access to blob service # Azure.Storage.BlobPublicAccess AZR-000198 Error Security \u00b7 Storage Account \u00b7 2020_09 Storage Accounts should only accept authorized requests. Description # Blob containers in Azure Storage Accounts can be configured for private or anonymous public access. By default, containers are private and only accessible with a credential or access token. When a container is configured with an access type other than private, anonymous access is permitted. Anonymous access to blobs or containers can be restricted by setting AllowBlobPublicAccess to false . This enhanced security setting for a storage account overrides the individual settings for blob containers. When you disallow public access for a storage account, blobs are no longer accessible anonymously. Recommendation # Consider disallowing anonymous access to storage account blobs unless specifically required. Also consider enforcing this setting using Azure Policy. Examples # Configure with Azure template # To deploy Storage Accounts that pass this rule: Set the properties.allowBlobPublicAccess property to false . For example: { \"comments\" : \"Storage Account\" , \"type\" : \"Microsoft.Storage/storageAccounts\" , \"apiVersion\" : \"2019-06-01\" , \"name\" : \"st0000001\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_GRS\" , \"tier\" : \"Standard\" }, \"kind\" : \"StorageV2\" , \"properties\" : { \"supportsHttpsTrafficOnly\" : true , \"minimumTlsVersion\" : \"TLS1_2\" , \"allowBlobPublicAccess\" : false , \"accessTier\" : \"Hot\" } } Configure with Bicep # To deploy Storage Accounts that pass this rule: Set the properties.allowBlobPublicAccess property to false . For example: resource st0000001 'Microsoft.Storage/storageAccounts@2021-04-01' = { name: 'st0000001' location: location sku: { name: 'Standard_GRS' } kind: 'StorageV2' properties: { supportsHttpsTrafficOnly: true accessTier: 'Hot' allowBlobPublicAccess: false minimumTlsVersion: 'TLS1_2' networkAcls: { defaultAction: 'Deny' } } } Links # Use Azure AD for storage authentication Allow or disallow public read access for a storage account Remediate anonymous public access Use Azure Policy to enforce authorized access Authorize access to blobs using Azure Active Directory Azure deployment reference","title":"Azure.Storage.BlobPublicAccess"},{"location":"en/rules/Azure.Storage.BlobPublicAccess/#disallow-anonymous-access-to-blob-service","text":"Azure.Storage.BlobPublicAccess AZR-000198 Error Security \u00b7 Storage Account \u00b7 2020_09 Storage Accounts should only accept authorized requests.","title":"Disallow anonymous access to blob service"},{"location":"en/rules/Azure.Storage.BlobPublicAccess/#description","text":"Blob containers in Azure Storage Accounts can be configured for private or anonymous public access. By default, containers are private and only accessible with a credential or access token. When a container is configured with an access type other than private, anonymous access is permitted. Anonymous access to blobs or containers can be restricted by setting AllowBlobPublicAccess to false . This enhanced security setting for a storage account overrides the individual settings for blob containers. When you disallow public access for a storage account, blobs are no longer accessible anonymously.","title":"Description"},{"location":"en/rules/Azure.Storage.BlobPublicAccess/#recommendation","text":"Consider disallowing anonymous access to storage account blobs unless specifically required. Also consider enforcing this setting using Azure Policy.","title":"Recommendation"},{"location":"en/rules/Azure.Storage.BlobPublicAccess/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Storage.BlobPublicAccess/#configure-with-azure-template","text":"To deploy Storage Accounts that pass this rule: Set the properties.allowBlobPublicAccess property to false . For example: { \"comments\" : \"Storage Account\" , \"type\" : \"Microsoft.Storage/storageAccounts\" , \"apiVersion\" : \"2019-06-01\" , \"name\" : \"st0000001\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_GRS\" , \"tier\" : \"Standard\" }, \"kind\" : \"StorageV2\" , \"properties\" : { \"supportsHttpsTrafficOnly\" : true , \"minimumTlsVersion\" : \"TLS1_2\" , \"allowBlobPublicAccess\" : false , \"accessTier\" : \"Hot\" } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Storage.BlobPublicAccess/#configure-with-bicep","text":"To deploy Storage Accounts that pass this rule: Set the properties.allowBlobPublicAccess property to false . For example: resource st0000001 'Microsoft.Storage/storageAccounts@2021-04-01' = { name: 'st0000001' location: location sku: { name: 'Standard_GRS' } kind: 'StorageV2' properties: { supportsHttpsTrafficOnly: true accessTier: 'Hot' allowBlobPublicAccess: false minimumTlsVersion: 'TLS1_2' networkAcls: { defaultAction: 'Deny' } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Storage.BlobPublicAccess/#links","text":"Use Azure AD for storage authentication Allow or disallow public read access for a storage account Remediate anonymous public access Use Azure Policy to enforce authorized access Authorize access to blobs using Azure Active Directory Azure deployment reference","title":"Links"},{"location":"en/rules/Azure.Storage.Firewall/","tags":["Azure.Storage.Firewall","AZR-000202"],"text":"Configure Azure Storage firewall # Azure.Storage.Firewall AZR-000202 Error Security \u00b7 Storage Account \u00b7 2021_09 Storage Accounts should only accept explicitly allowed traffic. Description # By default, storage accounts accept connections from clients on any network. To limit access to selected networks, you must first change the default action. After changing the default action from Allow to Deny , configure one or more rules to allow traffic. Traffic can be allowed from: Azure services on the trusted service list. IP address or CIDR range. Private endpoint connections. Azure virtual network subnets with a Service Endpoint. Recommendation # Consider configuring storage firewall to restrict network access to permitted clients only. Also consider enforcing this setting using Azure Policy. Examples # Configure with Azure template # To deploy Storage Accounts that pass this rule: Set the properties.networkAcls.defaultAction property to Deny . For example: { \"type\" : \"Microsoft.Storage/storageAccounts\" , \"apiVersion\" : \"2021-04-01\" , \"name\" : \"st0000001\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_GRS\" }, \"kind\" : \"StorageV2\" , \"properties\" : { \"supportsHttpsTrafficOnly\" : true , \"accessTier\" : \"Hot\" , \"allowBlobPublicAccess\" : false , \"minimumTlsVersion\" : \"TLS1_2\" , \"networkAcls\" : { \"defaultAction\" : \"Deny\" } } } Configure with Bicep # To deploy Storage Accounts that pass this rule: Set the properties.networkAcls.defaultAction property to Deny . For example: resource st0000001 'Microsoft.Storage/storageAccounts@2021-04-01' = { name: 'st0000001' location: location sku: { name: 'Standard_GRS' } kind: 'StorageV2' properties: { supportsHttpsTrafficOnly: true accessTier: 'Hot' allowBlobPublicAccess: false minimumTlsVersion: 'TLS1_2' networkAcls: { defaultAction: 'Deny' } } } Notes # Cloud Shell storage with the tag ms-resource-usage = 'azure-cloud-shell' is excluded. Azure storage firewall is not supported for Cloud Shell storage accounts. Links # Public endpoints Configure Azure Storage firewalls and virtual networks Use private endpoints for Azure Storage Persist files in Azure Cloud Shell Azure template reference","title":"Azure.Storage.Firewall"},{"location":"en/rules/Azure.Storage.Firewall/#configure-azure-storage-firewall","text":"Azure.Storage.Firewall AZR-000202 Error Security \u00b7 Storage Account \u00b7 2021_09 Storage Accounts should only accept explicitly allowed traffic.","title":"Configure Azure Storage firewall"},{"location":"en/rules/Azure.Storage.Firewall/#description","text":"By default, storage accounts accept connections from clients on any network. To limit access to selected networks, you must first change the default action. After changing the default action from Allow to Deny , configure one or more rules to allow traffic. Traffic can be allowed from: Azure services on the trusted service list. IP address or CIDR range. Private endpoint connections. Azure virtual network subnets with a Service Endpoint.","title":"Description"},{"location":"en/rules/Azure.Storage.Firewall/#recommendation","text":"Consider configuring storage firewall to restrict network access to permitted clients only. Also consider enforcing this setting using Azure Policy.","title":"Recommendation"},{"location":"en/rules/Azure.Storage.Firewall/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Storage.Firewall/#configure-with-azure-template","text":"To deploy Storage Accounts that pass this rule: Set the properties.networkAcls.defaultAction property to Deny . For example: { \"type\" : \"Microsoft.Storage/storageAccounts\" , \"apiVersion\" : \"2021-04-01\" , \"name\" : \"st0000001\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_GRS\" }, \"kind\" : \"StorageV2\" , \"properties\" : { \"supportsHttpsTrafficOnly\" : true , \"accessTier\" : \"Hot\" , \"allowBlobPublicAccess\" : false , \"minimumTlsVersion\" : \"TLS1_2\" , \"networkAcls\" : { \"defaultAction\" : \"Deny\" } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Storage.Firewall/#configure-with-bicep","text":"To deploy Storage Accounts that pass this rule: Set the properties.networkAcls.defaultAction property to Deny . For example: resource st0000001 'Microsoft.Storage/storageAccounts@2021-04-01' = { name: 'st0000001' location: location sku: { name: 'Standard_GRS' } kind: 'StorageV2' properties: { supportsHttpsTrafficOnly: true accessTier: 'Hot' allowBlobPublicAccess: false minimumTlsVersion: 'TLS1_2' networkAcls: { defaultAction: 'Deny' } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Storage.Firewall/#notes","text":"Cloud Shell storage with the tag ms-resource-usage = 'azure-cloud-shell' is excluded. Azure storage firewall is not supported for Cloud Shell storage accounts.","title":"Notes"},{"location":"en/rules/Azure.Storage.Firewall/#links","text":"Public endpoints Configure Azure Storage firewalls and virtual networks Use private endpoints for Azure Storage Persist files in Azure Cloud Shell Azure template reference","title":"Links"},{"location":"en/rules/Azure.Storage.MinTLS/","tags":["Azure.Storage.MinTLS","AZR-000200"],"text":"Storage Account minimum TLS version # Azure.Storage.MinTLS AZR-000200 Error Security \u00b7 Storage Account \u00b7 2020_09 Storage Accounts should reject TLS versions older than 1.2. Description # The minimum version of TLS that Azure Storage Accounts accept for blob storage is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. Storage Accounts lets you disable outdated protocols and enforce TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted. Recommendation # Consider configuring the minimum supported TLS version to be 1.2. Also consider enforcing this setting using Azure Policy. Examples # Configure with Azure template # To deploy Storage Accounts that pass this rule: Set the properties.minimumTlsVersion property to TLS1_2 or newer. For example: { \"comments\" : \"Storage Account\" , \"type\" : \"Microsoft.Storage/storageAccounts\" , \"apiVersion\" : \"2019-06-01\" , \"name\" : \"st0000001\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_GRS\" , \"tier\" : \"Standard\" }, \"kind\" : \"StorageV2\" , \"properties\" : { \"supportsHttpsTrafficOnly\" : true , \"minimumTlsVersion\" : \"TLS1_2\" , \"allowBlobPublicAccess\" : false , \"accessTier\" : \"Hot\" } } Configure with Bicep # To deploy Storage Accounts that pass this rule: Set the properties.minimumTlsVersion property to TLS1_2 or newer. For example: resource st0000001 'Microsoft.Storage/storageAccounts@2021-04-01' = { name: 'st0000001' location: location sku: { name: 'Standard_GRS' } kind: 'StorageV2' properties: { supportsHttpsTrafficOnly: true accessTier: 'Hot' allowBlobPublicAccess: false minimumTlsVersion: 'TLS1_2' networkAcls: { defaultAction: 'Deny' } } } Links # Data encryption in Azure TLS encryption in Azure Enforce a minimum required version of Transport Layer Security (TLS) for requests to a storage account Preparing for TLS 1.2 in Microsoft Azure Use Azure Policy to enforce the minimum TLS version Azure deployment reference","title":"Azure.Storage.MinTLS"},{"location":"en/rules/Azure.Storage.MinTLS/#storage-account-minimum-tls-version","text":"Azure.Storage.MinTLS AZR-000200 Error Security \u00b7 Storage Account \u00b7 2020_09 Storage Accounts should reject TLS versions older than 1.2.","title":"Storage Account minimum TLS version"},{"location":"en/rules/Azure.Storage.MinTLS/#description","text":"The minimum version of TLS that Azure Storage Accounts accept for blob storage is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. Storage Accounts lets you disable outdated protocols and enforce TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted.","title":"Description"},{"location":"en/rules/Azure.Storage.MinTLS/#recommendation","text":"Consider configuring the minimum supported TLS version to be 1.2. Also consider enforcing this setting using Azure Policy.","title":"Recommendation"},{"location":"en/rules/Azure.Storage.MinTLS/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Storage.MinTLS/#configure-with-azure-template","text":"To deploy Storage Accounts that pass this rule: Set the properties.minimumTlsVersion property to TLS1_2 or newer. For example: { \"comments\" : \"Storage Account\" , \"type\" : \"Microsoft.Storage/storageAccounts\" , \"apiVersion\" : \"2019-06-01\" , \"name\" : \"st0000001\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_GRS\" , \"tier\" : \"Standard\" }, \"kind\" : \"StorageV2\" , \"properties\" : { \"supportsHttpsTrafficOnly\" : true , \"minimumTlsVersion\" : \"TLS1_2\" , \"allowBlobPublicAccess\" : false , \"accessTier\" : \"Hot\" } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Storage.MinTLS/#configure-with-bicep","text":"To deploy Storage Accounts that pass this rule: Set the properties.minimumTlsVersion property to TLS1_2 or newer. For example: resource st0000001 'Microsoft.Storage/storageAccounts@2021-04-01' = { name: 'st0000001' location: location sku: { name: 'Standard_GRS' } kind: 'StorageV2' properties: { supportsHttpsTrafficOnly: true accessTier: 'Hot' allowBlobPublicAccess: false minimumTlsVersion: 'TLS1_2' networkAcls: { defaultAction: 'Deny' } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Storage.MinTLS/#links","text":"Data encryption in Azure TLS encryption in Azure Enforce a minimum required version of Transport Layer Security (TLS) for requests to a storage account Preparing for TLS 1.2 in Microsoft Azure Use Azure Policy to enforce the minimum TLS version Azure deployment reference","title":"Links"},{"location":"en/rules/Azure.Storage.Name/","tags":["Azure.Storage.Name","AZR-000201"],"text":"Use valid storage account names # Azure.Storage.Name AZR-000201 Error Operational Excellence \u00b7 Storage Account \u00b7 2020_06 Storage Account names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Storage Account names are: Between 3 and 24 characters long. Lowercase letters or numbers. Storage Account names must be globally unique. Recommendation # Consider using names that meet Storage Account naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Storage Account names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.Storage.Name"},{"location":"en/rules/Azure.Storage.Name/#use-valid-storage-account-names","text":"Azure.Storage.Name AZR-000201 Error Operational Excellence \u00b7 Storage Account \u00b7 2020_06 Storage Account names should meet naming requirements.","title":"Use valid storage account names"},{"location":"en/rules/Azure.Storage.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Storage Account names are: Between 3 and 24 characters long. Lowercase letters or numbers. Storage Account names must be globally unique.","title":"Description"},{"location":"en/rules/Azure.Storage.Name/#recommendation","text":"Consider using names that meet Storage Account naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.Storage.Name/#notes","text":"This rule does not check if Storage Account names are unique.","title":"Notes"},{"location":"en/rules/Azure.Storage.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.Storage.SecureTransfer/","tags":["Azure.Storage.SecureTransfer","AZR-000196"],"text":"Enforce encrypted Storage connections # Azure.Storage.SecureTransfer AZR-000196 Error Security \u00b7 Storage Account \u00b7 2020_06 Storage accounts should only accept encrypted connections. Description # Azure Storage Accounts can be configured to allow unencrypted connections. Unencrypted communication could allow disclosure of information to an un-trusted party. Storage Accounts can be configured to require encrypted connections. To do this set the Secure transfer required option. When secure transfer required is enabled, attempts to connect to storage using HTTP or unencrypted SMB connections are rejected. Recommendation # Storage accounts should only accept secure traffic. Consider only accepting encrypted connections by setting the Secure transfer required option. Also consider using Azure Policy to audit or enforce this configuration. Examples # Configure with Azure template # To deploy Storage Accounts that pass this rule: Set the properties.supportsHttpsTrafficOnly property to true . For example: { \"comments\" : \"Storage Account\" , \"type\" : \"Microsoft.Storage/storageAccounts\" , \"apiVersion\" : \"2019-06-01\" , \"name\" : \"st0000001\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_GRS\" , \"tier\" : \"Standard\" }, \"kind\" : \"StorageV2\" , \"properties\" : { \"supportsHttpsTrafficOnly\" : true , \"minimumTlsVersion\" : \"TLS1_2\" , \"allowBlobPublicAccess\" : false , \"accessTier\" : \"Hot\" } } Configure with Bicep # To deploy Storage Accounts that pass this rule: Set the properties.supportsHttpsTrafficOnly property to true . For example: resource st0000001 'Microsoft.Storage/storageAccounts@2021-04-01' = { name: 'st0000001' location: location sku: { name: 'Standard_GRS' } kind: 'StorageV2' properties: { supportsHttpsTrafficOnly: true accessTier: 'Hot' allowBlobPublicAccess: false minimumTlsVersion: 'TLS1_2' } } Links # Data encryption in Azure Require secure transfer in Azure Storage Sample policy for ensuring https traffic Azure deployment reference","title":"Azure.Storage.SecureTransfer"},{"location":"en/rules/Azure.Storage.SecureTransfer/#enforce-encrypted-storage-connections","text":"Azure.Storage.SecureTransfer AZR-000196 Error Security \u00b7 Storage Account \u00b7 2020_06 Storage accounts should only accept encrypted connections.","title":"Enforce encrypted Storage connections"},{"location":"en/rules/Azure.Storage.SecureTransfer/#description","text":"Azure Storage Accounts can be configured to allow unencrypted connections. Unencrypted communication could allow disclosure of information to an un-trusted party. Storage Accounts can be configured to require encrypted connections. To do this set the Secure transfer required option. When secure transfer required is enabled, attempts to connect to storage using HTTP or unencrypted SMB connections are rejected.","title":"Description"},{"location":"en/rules/Azure.Storage.SecureTransfer/#recommendation","text":"Storage accounts should only accept secure traffic. Consider only accepting encrypted connections by setting the Secure transfer required option. Also consider using Azure Policy to audit or enforce this configuration.","title":"Recommendation"},{"location":"en/rules/Azure.Storage.SecureTransfer/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Storage.SecureTransfer/#configure-with-azure-template","text":"To deploy Storage Accounts that pass this rule: Set the properties.supportsHttpsTrafficOnly property to true . For example: { \"comments\" : \"Storage Account\" , \"type\" : \"Microsoft.Storage/storageAccounts\" , \"apiVersion\" : \"2019-06-01\" , \"name\" : \"st0000001\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_GRS\" , \"tier\" : \"Standard\" }, \"kind\" : \"StorageV2\" , \"properties\" : { \"supportsHttpsTrafficOnly\" : true , \"minimumTlsVersion\" : \"TLS1_2\" , \"allowBlobPublicAccess\" : false , \"accessTier\" : \"Hot\" } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Storage.SecureTransfer/#configure-with-bicep","text":"To deploy Storage Accounts that pass this rule: Set the properties.supportsHttpsTrafficOnly property to true . For example: resource st0000001 'Microsoft.Storage/storageAccounts@2021-04-01' = { name: 'st0000001' location: location sku: { name: 'Standard_GRS' } kind: 'StorageV2' properties: { supportsHttpsTrafficOnly: true accessTier: 'Hot' allowBlobPublicAccess: false minimumTlsVersion: 'TLS1_2' } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Storage.SecureTransfer/#links","text":"Data encryption in Azure Require secure transfer in Azure Storage Sample policy for ensuring https traffic Azure deployment reference","title":"Links"},{"location":"en/rules/Azure.Storage.SoftDelete/","tags":["Azure.Storage.SoftDelete","AZR-000197"],"text":"Use blob soft delete # Azure.Storage.SoftDelete AZR-000197 Error Reliability \u00b7 Storage Account \u00b7 2020_06 Enable blob soft delete on Storage Accounts. Description # Soft delete provides an easy way to recover deleted or modified blob data stored within Storage Accounts. When soft delete is enabled, deleted blobs are kept and can be restored within the configured interval. Blob soft delete should be considered part of the strategy to protect and retain data. Also consider: Implementing role-based access control (RBAC). Configuring resource locks to protect against deletion. Configuring blob container soft delete. Blobs can be configured to retain deleted blobs for a period of time between 1 and 365 days. Recommendation # Consider enabling soft delete on storage accounts to protect blobs from accidental deletion or modification. Examples # Configure with Azure template # To deploy Storage Accounts that pass this rule: Set the properties.deleteRetentionPolicy.enabled property to true on the blob services sub-resource. Configure the properties.deleteRetentionPolicy.days property to the number of days to retain blobs. { \"comments\" : \"Storage Account\" , \"type\" : \"Microsoft.Storage/storageAccounts\" , \"apiVersion\" : \"2021-04-01\" , \"name\" : \"st0000001\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_GRS\" , \"tier\" : \"Standard\" }, \"kind\" : \"StorageV2\" , \"properties\" : { \"supportsHttpsTrafficOnly\" : true , \"accessTier\" : \"Hot\" , \"allowBlobPublicAccess\" : false , \"minimumTlsVersion\" : \"TLS1_2\" }, \"resources\" : [ { \"comments\" : \"Configure blob storage services\" , \"type\" : \"Microsoft.Storage/storageAccounts/blobServices\" , \"apiVersion\" : \"2019-06-01\" , \"name\" : \"st0000001/default\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Storage/storageAccounts', 'st0000001')]\" ], \"sku\" : { \"name\" : \"Standard_GRS\" }, \"properties\" : { \"cors\" : { \"corsRules\" : [] }, \"deleteRetentionPolicy\" : { \"enabled\" : true , \"days\" : 7 }, \"containerDeleteRetentionPolicy\" : { \"enabled\" : true , \"days\" : 7 } } } ] } Configure with Bicep # To deploy Storage Accounts that pass this rule: Set the properties.deleteRetentionPolicy.enabled property to true on the blob services sub-resource. Configure the properties.deleteRetentionPolicy.days property to the number of days to retain blobs. For example: resource st0000001_blob 'Microsoft.Storage/storageAccounts/blobServices@2021-04-01' = { name: 'default' parent: st0000001 properties: { deleteRetentionPolicy: { enabled: true days: 7 } containerDeleteRetentionPolicy: { enabled: true days: 7 } } } Configure with Azure CLI # az storage account blob-service-properties update --enable-delete-retention true --delete-retention-days 7 -n '<name>' -g '<resource_group>' Configure with Azure PowerShell # Enable-AzStorageBlobDeleteRetentionPolicy -ResourceGroupName '<resource_group>' -AccountName '<name>' -RetentionDays 7 Notes # Cloud Shell storage with the tag ms-resource-usage = 'azure-cloud-shell' is excluded. Storage accounts used for Cloud Shell are not intended to store data. Storage accounts with: Hierarchical namespace enabled to not support blob soft delete. Deployed as a FileStorage storage account do not support blob soft delete. Links # Soft delete for Azure Storage blobs RBAC operations for Storage Blob storage features available in Azure Data Lake Storage Gen2 Azure resource template","title":"Azure.Storage.SoftDelete"},{"location":"en/rules/Azure.Storage.SoftDelete/#use-blob-soft-delete","text":"Azure.Storage.SoftDelete AZR-000197 Error Reliability \u00b7 Storage Account \u00b7 2020_06 Enable blob soft delete on Storage Accounts.","title":"Use blob soft delete"},{"location":"en/rules/Azure.Storage.SoftDelete/#description","text":"Soft delete provides an easy way to recover deleted or modified blob data stored within Storage Accounts. When soft delete is enabled, deleted blobs are kept and can be restored within the configured interval. Blob soft delete should be considered part of the strategy to protect and retain data. Also consider: Implementing role-based access control (RBAC). Configuring resource locks to protect against deletion. Configuring blob container soft delete. Blobs can be configured to retain deleted blobs for a period of time between 1 and 365 days.","title":"Description"},{"location":"en/rules/Azure.Storage.SoftDelete/#recommendation","text":"Consider enabling soft delete on storage accounts to protect blobs from accidental deletion or modification.","title":"Recommendation"},{"location":"en/rules/Azure.Storage.SoftDelete/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Storage.SoftDelete/#configure-with-azure-template","text":"To deploy Storage Accounts that pass this rule: Set the properties.deleteRetentionPolicy.enabled property to true on the blob services sub-resource. Configure the properties.deleteRetentionPolicy.days property to the number of days to retain blobs. { \"comments\" : \"Storage Account\" , \"type\" : \"Microsoft.Storage/storageAccounts\" , \"apiVersion\" : \"2021-04-01\" , \"name\" : \"st0000001\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_GRS\" , \"tier\" : \"Standard\" }, \"kind\" : \"StorageV2\" , \"properties\" : { \"supportsHttpsTrafficOnly\" : true , \"accessTier\" : \"Hot\" , \"allowBlobPublicAccess\" : false , \"minimumTlsVersion\" : \"TLS1_2\" }, \"resources\" : [ { \"comments\" : \"Configure blob storage services\" , \"type\" : \"Microsoft.Storage/storageAccounts/blobServices\" , \"apiVersion\" : \"2019-06-01\" , \"name\" : \"st0000001/default\" , \"dependsOn\" : [ \"[resourceId('Microsoft.Storage/storageAccounts', 'st0000001')]\" ], \"sku\" : { \"name\" : \"Standard_GRS\" }, \"properties\" : { \"cors\" : { \"corsRules\" : [] }, \"deleteRetentionPolicy\" : { \"enabled\" : true , \"days\" : 7 }, \"containerDeleteRetentionPolicy\" : { \"enabled\" : true , \"days\" : 7 } } } ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Storage.SoftDelete/#configure-with-bicep","text":"To deploy Storage Accounts that pass this rule: Set the properties.deleteRetentionPolicy.enabled property to true on the blob services sub-resource. Configure the properties.deleteRetentionPolicy.days property to the number of days to retain blobs. For example: resource st0000001_blob 'Microsoft.Storage/storageAccounts/blobServices@2021-04-01' = { name: 'default' parent: st0000001 properties: { deleteRetentionPolicy: { enabled: true days: 7 } containerDeleteRetentionPolicy: { enabled: true days: 7 } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Storage.SoftDelete/#configure-with-azure-cli","text":"az storage account blob-service-properties update --enable-delete-retention true --delete-retention-days 7 -n '<name>' -g '<resource_group>'","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.Storage.SoftDelete/#configure-with-azure-powershell","text":"Enable-AzStorageBlobDeleteRetentionPolicy -ResourceGroupName '<resource_group>' -AccountName '<name>' -RetentionDays 7","title":"Configure with Azure PowerShell"},{"location":"en/rules/Azure.Storage.SoftDelete/#notes","text":"Cloud Shell storage with the tag ms-resource-usage = 'azure-cloud-shell' is excluded. Storage accounts used for Cloud Shell are not intended to store data. Storage accounts with: Hierarchical namespace enabled to not support blob soft delete. Deployed as a FileStorage storage account do not support blob soft delete.","title":"Notes"},{"location":"en/rules/Azure.Storage.SoftDelete/#links","text":"Soft delete for Azure Storage blobs RBAC operations for Storage Blob storage features available in Azure Data Lake Storage Gen2 Azure resource template","title":"Links"},{"location":"en/rules/Azure.Storage.UseReplication/","tags":["Azure.Storage.UseReplication","AZR-000195"],"text":"Use geo-replicated storage # Azure.Storage.UseReplication AZR-000195 Error Reliability \u00b7 Storage Account \u00b7 2020_06 Storage Accounts not using geo-replicated storage (GRS) may be at risk. Description # Storage Accounts can be configured with several different durability options. Azure provides a number of geo-replicated options including; Geo-redundant storage and geo-zone-redundant storage. Geo-zone-redundant storage is only available in supported regions. The following geo-replicated options are available within Azure: Standard_GRS Standard_RAGRS Standard_GZRS Standard_RAGZRS Recommendation # Consider using GRS for storage accounts that contain data. Examples # Configure with Azure template # To deploy Storage Accounts that pass this rule: Set the sku.name property to a geo-replicated SKU. Such as Standard_GRS . For example: { \"comments\" : \"Storage Account\" , \"type\" : \"Microsoft.Storage/storageAccounts\" , \"apiVersion\" : \"2019-06-01\" , \"name\" : \"st0000001\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_GRS\" , \"tier\" : \"Standard\" }, \"kind\" : \"StorageV2\" , \"properties\" : { \"supportsHttpsTrafficOnly\" : true , \"minimumTlsVersion\" : \"TLS1_2\" , \"allowBlobPublicAccess\" : false , \"accessTier\" : \"Hot\" } } Configure with Bicep # To deploy Storage Accounts that pass this rule: Set the sku.name property to a geo-replicated SKU. Such as Standard_GRS . For example: resource st0000001 'Microsoft.Storage/storageAccounts@2021-04-01' = { name: 'st0000001' location: location sku: { name: 'Standard_GRS' } kind: 'StorageV2' properties: { supportsHttpsTrafficOnly: true accessTier: 'Hot' allowBlobPublicAccess: false minimumTlsVersion: 'TLS1_2' networkAcls: { defaultAction: 'Deny' } } } Notes # This rule is not applicable for premium storage accounts. Storage Accounts with the following tags are automatically excluded from this rule: ms-resource-usage = 'azure-cloud-shell' - Storage Accounts used for Cloud Shell are not intended to store data. This tag is applied by Azure to Cloud Shell Storage Accounts by default. resource-usage = 'azure-functions' - Storage Accounts used for Azure Functions. This tag can be optionally configured. resource-usage = 'azure-monitor' - Storage Accounts used by Azure Monitor are intended for diagnostic logs. This tag can be optionally configured. Links # Multiple and paired regions Azure Storage redundancy Azure template reference","title":"Azure.Storage.UseReplication"},{"location":"en/rules/Azure.Storage.UseReplication/#use-geo-replicated-storage","text":"Azure.Storage.UseReplication AZR-000195 Error Reliability \u00b7 Storage Account \u00b7 2020_06 Storage Accounts not using geo-replicated storage (GRS) may be at risk.","title":"Use geo-replicated storage"},{"location":"en/rules/Azure.Storage.UseReplication/#description","text":"Storage Accounts can be configured with several different durability options. Azure provides a number of geo-replicated options including; Geo-redundant storage and geo-zone-redundant storage. Geo-zone-redundant storage is only available in supported regions. The following geo-replicated options are available within Azure: Standard_GRS Standard_RAGRS Standard_GZRS Standard_RAGZRS","title":"Description"},{"location":"en/rules/Azure.Storage.UseReplication/#recommendation","text":"Consider using GRS for storage accounts that contain data.","title":"Recommendation"},{"location":"en/rules/Azure.Storage.UseReplication/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Storage.UseReplication/#configure-with-azure-template","text":"To deploy Storage Accounts that pass this rule: Set the sku.name property to a geo-replicated SKU. Such as Standard_GRS . For example: { \"comments\" : \"Storage Account\" , \"type\" : \"Microsoft.Storage/storageAccounts\" , \"apiVersion\" : \"2019-06-01\" , \"name\" : \"st0000001\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_GRS\" , \"tier\" : \"Standard\" }, \"kind\" : \"StorageV2\" , \"properties\" : { \"supportsHttpsTrafficOnly\" : true , \"minimumTlsVersion\" : \"TLS1_2\" , \"allowBlobPublicAccess\" : false , \"accessTier\" : \"Hot\" } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Storage.UseReplication/#configure-with-bicep","text":"To deploy Storage Accounts that pass this rule: Set the sku.name property to a geo-replicated SKU. Such as Standard_GRS . For example: resource st0000001 'Microsoft.Storage/storageAccounts@2021-04-01' = { name: 'st0000001' location: location sku: { name: 'Standard_GRS' } kind: 'StorageV2' properties: { supportsHttpsTrafficOnly: true accessTier: 'Hot' allowBlobPublicAccess: false minimumTlsVersion: 'TLS1_2' networkAcls: { defaultAction: 'Deny' } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Storage.UseReplication/#notes","text":"This rule is not applicable for premium storage accounts. Storage Accounts with the following tags are automatically excluded from this rule: ms-resource-usage = 'azure-cloud-shell' - Storage Accounts used for Cloud Shell are not intended to store data. This tag is applied by Azure to Cloud Shell Storage Accounts by default. resource-usage = 'azure-functions' - Storage Accounts used for Azure Functions. This tag can be optionally configured. resource-usage = 'azure-monitor' - Storage Accounts used by Azure Monitor are intended for diagnostic logs. This tag can be optionally configured.","title":"Notes"},{"location":"en/rules/Azure.Storage.UseReplication/#links","text":"Multiple and paired regions Azure Storage redundancy Azure template reference","title":"Links"},{"location":"en/rules/Azure.Template.DebugDeployment/","tags":["Azure.Template.DebugDeployment","AZR-000225"],"text":"Disable debugging of nested deployments # Azure.Template.DebugDeployment AZR-000225 Error Operational Excellence \u00b7 All resources \u00b7 2021_03 Use default deployment detail level for nested deployments. Description # When creating Azure template, nested deployments can be created with debugging settings enabled. Deployment debugging detail is intended for troubleshooting deployments during development. Debugging settings may log sensitive values. Use caution when using this setting to debug of nested deployments. To reduce nested deployment detail, remove or configure the properties.debugSetting.detailLevel property to none for nested deployments. Recommendation # Consider disabling debugging of nested deployments before release. Links # Troubleshoot deployment errors DebugSetting Release deployment","title":"Azure.Template.DebugDeployment"},{"location":"en/rules/Azure.Template.DebugDeployment/#disable-debugging-of-nested-deployments","text":"Azure.Template.DebugDeployment AZR-000225 Error Operational Excellence \u00b7 All resources \u00b7 2021_03 Use default deployment detail level for nested deployments.","title":"Disable debugging of nested deployments"},{"location":"en/rules/Azure.Template.DebugDeployment/#description","text":"When creating Azure template, nested deployments can be created with debugging settings enabled. Deployment debugging detail is intended for troubleshooting deployments during development. Debugging settings may log sensitive values. Use caution when using this setting to debug of nested deployments. To reduce nested deployment detail, remove or configure the properties.debugSetting.detailLevel property to none for nested deployments.","title":"Description"},{"location":"en/rules/Azure.Template.DebugDeployment/#recommendation","text":"Consider disabling debugging of nested deployments before release.","title":"Recommendation"},{"location":"en/rules/Azure.Template.DebugDeployment/#links","text":"Troubleshoot deployment errors DebugSetting Release deployment","title":"Links"},{"location":"en/rules/Azure.Template.DefineParameters/","tags":["Azure.Template.DefineParameters","AZR-000218"],"text":"Define template parameters # Azure.Template.DefineParameters AZR-000218 Error Operational Excellence \u00b7 All resources \u00b7 2021_03 Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Description # Azure templates support parameters, which are inputs you can specify when deploying the template resources. Each template can support up to 256 parameters. When defining template parameters: Minimize the number of parameters that require input by specifying a defaultValue . Use parameters for resource names and deployment locations. Use variables or literal resource properties for values that don't change. Recommendation # Consider defining a minimal number of parameters to make the template reusable. Examples # Configure with Azure template # To author templates that pass this rule: Define at least one parameter. For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"name\" : \"Managed Identity\" , \"description\" : \"Create or update a Managed Identity.\" }, \"parameters\" : { \"identityName\" : { \"type\" : \"string\" , \"metadata\" : { \"description\" : \"The name of the Managed Identity.\" } }, \"location\" : { \"type\" : \"string\" , \"defaultValue\" : \"[resourceGroup().location]\" , \"metadata\" : { \"description\" : \"The Azure region to deploy to.\" , \"example\" : \"eastus\" } }, \"tags\" : { \"type\" : \"object\" , \"metadata\" : { \"description\" : \"Tags to apply to the resource.\" , \"example\" : { \"service\" : \"app1\" , \"env\" : \"prod\" } } } }, \"variables\" : { \"tenantId\" : \"[subscription().tenantId]\" }, \"resources\" : [ { \"comments\" : \"Create or update a Managed Identity\" , \"type\" : \"Microsoft.ManagedIdentity/userAssignedIdentities\" , \"apiVersion\" : \"2018-11-30\" , \"name\" : \"[parameters('identityName')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"tenantId\" : \"[variables('tenantId')]\" }, \"tags\" : \"[parameters('tags')]\" } ] } Notes # This rule is not applicable and ignored for templates generated with Bicep, PSArm and AzOps. Generated templates from these tools may not require any parameters to be set. Links # Parameters ARM template best practices Release deployment","title":"Azure.Template.DefineParameters"},{"location":"en/rules/Azure.Template.DefineParameters/#define-template-parameters","text":"Azure.Template.DefineParameters AZR-000218 Error Operational Excellence \u00b7 All resources \u00b7 2021_03 Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters.","title":"Define template parameters"},{"location":"en/rules/Azure.Template.DefineParameters/#description","text":"Azure templates support parameters, which are inputs you can specify when deploying the template resources. Each template can support up to 256 parameters. When defining template parameters: Minimize the number of parameters that require input by specifying a defaultValue . Use parameters for resource names and deployment locations. Use variables or literal resource properties for values that don't change.","title":"Description"},{"location":"en/rules/Azure.Template.DefineParameters/#recommendation","text":"Consider defining a minimal number of parameters to make the template reusable.","title":"Recommendation"},{"location":"en/rules/Azure.Template.DefineParameters/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Template.DefineParameters/#configure-with-azure-template","text":"To author templates that pass this rule: Define at least one parameter. For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"name\" : \"Managed Identity\" , \"description\" : \"Create or update a Managed Identity.\" }, \"parameters\" : { \"identityName\" : { \"type\" : \"string\" , \"metadata\" : { \"description\" : \"The name of the Managed Identity.\" } }, \"location\" : { \"type\" : \"string\" , \"defaultValue\" : \"[resourceGroup().location]\" , \"metadata\" : { \"description\" : \"The Azure region to deploy to.\" , \"example\" : \"eastus\" } }, \"tags\" : { \"type\" : \"object\" , \"metadata\" : { \"description\" : \"Tags to apply to the resource.\" , \"example\" : { \"service\" : \"app1\" , \"env\" : \"prod\" } } } }, \"variables\" : { \"tenantId\" : \"[subscription().tenantId]\" }, \"resources\" : [ { \"comments\" : \"Create or update a Managed Identity\" , \"type\" : \"Microsoft.ManagedIdentity/userAssignedIdentities\" , \"apiVersion\" : \"2018-11-30\" , \"name\" : \"[parameters('identityName')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"tenantId\" : \"[variables('tenantId')]\" }, \"tags\" : \"[parameters('tags')]\" } ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Template.DefineParameters/#notes","text":"This rule is not applicable and ignored for templates generated with Bicep, PSArm and AzOps. Generated templates from these tools may not require any parameters to be set.","title":"Notes"},{"location":"en/rules/Azure.Template.DefineParameters/#links","text":"Parameters ARM template best practices Release deployment","title":"Links"},{"location":"en/rules/Azure.Template.ExpressionLength/","tags":["Azure.Template.ExpressionLength","AZR-000228"],"text":"Template expressions should not exceed a maximum length # Azure.Template.ExpressionLength AZR-000228 Error Operational Excellence \u00b7 All resources \u00b7 2021_12 Template expressions should not exceed the maximum length. Description # Extremely long expressions may be difficult to read and debug. Avoid using expressions that exceed 24,576 characters in length. Recommendation # Consider updating the expression to reduce complexity and length. Notes # This rule is not applicable and ignored for templates generated with Bicep, PSArm, and AzOps. Generated templates from these tools may not require any parameters to be set. Links # Deployment considerations for DevOps Template limits","title":"Azure.Template.ExpressionLength"},{"location":"en/rules/Azure.Template.ExpressionLength/#template-expressions-should-not-exceed-a-maximum-length","text":"Azure.Template.ExpressionLength AZR-000228 Error Operational Excellence \u00b7 All resources \u00b7 2021_12 Template expressions should not exceed the maximum length.","title":"Template expressions should not exceed a maximum length"},{"location":"en/rules/Azure.Template.ExpressionLength/#description","text":"Extremely long expressions may be difficult to read and debug. Avoid using expressions that exceed 24,576 characters in length.","title":"Description"},{"location":"en/rules/Azure.Template.ExpressionLength/#recommendation","text":"Consider updating the expression to reduce complexity and length.","title":"Recommendation"},{"location":"en/rules/Azure.Template.ExpressionLength/#notes","text":"This rule is not applicable and ignored for templates generated with Bicep, PSArm, and AzOps. Generated templates from these tools may not require any parameters to be set.","title":"Notes"},{"location":"en/rules/Azure.Template.ExpressionLength/#links","text":"Deployment considerations for DevOps Template limits","title":"Links"},{"location":"en/rules/Azure.Template.LocationDefault/","tags":["Azure.Template.LocationDefault","AZR-000220"],"text":"Default to resource group location # Azure.Template.LocationDefault AZR-000220 Error Reliability \u00b7 All resources \u00b7 2021_03 Set the default value for the location parameter within an ARM template to resource group location. Description # In the event of a regional outage in the resource group location, you will be unable to control resources inside that resource group, regardless of what region those resources are actually in. Resources for regional services should be deployed into a resource group on the same region. When authoring templates, the resource group location should be the default resource location. This approach minimizes the number of times users are asked to provide location information. Recommendation # Consider updating the location parameter to use [resourceGroup().location] as the default value. Examples # Configure with Azure template # To author templates that pass this rule: If the location parameter is specified, it should be set to [resourceGroup().location] . For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { \"location\" : { \"type\" : \"string\" , \"defaultValue\" : \"[resourceGroup().location]\" , \"metadata\" : { \"description\" : \"The location resources will be deployed.\" } } }, \"resources\" : [ { \"type\" : \"Microsoft.Network/networkSecurityGroups\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"nsg-001\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"securityRules\" : [ { \"name\" : \"deny-hop-outbound\" , \"properties\" : { \"priority\" : 200 , \"access\" : \"Deny\" , \"protocol\" : \"Tcp\" , \"direction\" : \"Outbound\" , \"sourceAddressPrefix\" : \"VirtualNetwork\" , \"destinationAddressPrefix\" : \"*\" , \"destinationPortRanges\" : [ \"3389\" , \"22\" ] } } ] } } ] } Configure with Bicep # To author bicep source files that pass this rule: If the location parameter is specified, it should be set to resourceGroup().location . For example: @description('The location resources will be deployed.') param location string = resourceGroup().location Notes # This rule ignores templates using tenant, Management Group, and Subscription deployment schemas. Deployment to these scopes does not occur against a resource group. Links # ARM template best practices Operating in multiple regions Resource group","title":"Azure.Template.LocationDefault"},{"location":"en/rules/Azure.Template.LocationDefault/#default-to-resource-group-location","text":"Azure.Template.LocationDefault AZR-000220 Error Reliability \u00b7 All resources \u00b7 2021_03 Set the default value for the location parameter within an ARM template to resource group location.","title":"Default to resource group location"},{"location":"en/rules/Azure.Template.LocationDefault/#description","text":"In the event of a regional outage in the resource group location, you will be unable to control resources inside that resource group, regardless of what region those resources are actually in. Resources for regional services should be deployed into a resource group on the same region. When authoring templates, the resource group location should be the default resource location. This approach minimizes the number of times users are asked to provide location information.","title":"Description"},{"location":"en/rules/Azure.Template.LocationDefault/#recommendation","text":"Consider updating the location parameter to use [resourceGroup().location] as the default value.","title":"Recommendation"},{"location":"en/rules/Azure.Template.LocationDefault/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Template.LocationDefault/#configure-with-azure-template","text":"To author templates that pass this rule: If the location parameter is specified, it should be set to [resourceGroup().location] . For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { \"location\" : { \"type\" : \"string\" , \"defaultValue\" : \"[resourceGroup().location]\" , \"metadata\" : { \"description\" : \"The location resources will be deployed.\" } } }, \"resources\" : [ { \"type\" : \"Microsoft.Network/networkSecurityGroups\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"nsg-001\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"securityRules\" : [ { \"name\" : \"deny-hop-outbound\" , \"properties\" : { \"priority\" : 200 , \"access\" : \"Deny\" , \"protocol\" : \"Tcp\" , \"direction\" : \"Outbound\" , \"sourceAddressPrefix\" : \"VirtualNetwork\" , \"destinationAddressPrefix\" : \"*\" , \"destinationPortRanges\" : [ \"3389\" , \"22\" ] } } ] } } ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Template.LocationDefault/#configure-with-bicep","text":"To author bicep source files that pass this rule: If the location parameter is specified, it should be set to resourceGroup().location . For example: @description('The location resources will be deployed.') param location string = resourceGroup().location","title":"Configure with Bicep"},{"location":"en/rules/Azure.Template.LocationDefault/#notes","text":"This rule ignores templates using tenant, Management Group, and Subscription deployment schemas. Deployment to these scopes does not occur against a resource group.","title":"Notes"},{"location":"en/rules/Azure.Template.LocationDefault/#links","text":"ARM template best practices Operating in multiple regions Resource group","title":"Links"},{"location":"en/rules/Azure.Template.LocationType/","tags":["Azure.Template.LocationType","AZR-000221"],"text":"Use type string for location parameters # Azure.Template.LocationType AZR-000221 Error Operational Excellence \u00b7 All resources \u00b7 2021_03 Location parameters should use a string value. Description # The template parameter location is a standard parameter recommended for deployment templates. The location parameter is a intended for specifying the deployment location of the primary resource. When including location parameters in templates use the type string . Additionally, the template may include other resources. Use the location parameter value for resources that are likely to be in the same location. This approach minimizes the number of times users are asked to provide location information. Recommendation # Consider updating the location parameter to be of type string . Examples # Configure with Azure template # To author templates that pass this rule: If the location parameter is specified, it should be set to a string type. For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { \"location\" : { \"type\" : \"string\" , \"defaultValue\" : \"[resourceGroup().location]\" , \"metadata\" : { \"description\" : \"The location resources will be deployed.\" } } }, \"resources\" : [ { \"type\" : \"Microsoft.Network/networkSecurityGroups\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"nsg-001\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"securityRules\" : [ { \"name\" : \"deny-hop-outbound\" , \"properties\" : { \"priority\" : 200 , \"access\" : \"Deny\" , \"protocol\" : \"Tcp\" , \"direction\" : \"Outbound\" , \"sourceAddressPrefix\" : \"VirtualNetwork\" , \"destinationAddressPrefix\" : \"*\" , \"destinationPortRanges\" : [ \"3389\" , \"22\" ] } } ] } } ] } Configure with Bicep # To author bicep source files that pass this rule: If the location parameter is specified, it should be set to a string type. For example: @description('The location resources will be deployed.') param location string = resourceGroup().location Links # ARM template best practices Release deployment","title":"Azure.Template.LocationType"},{"location":"en/rules/Azure.Template.LocationType/#use-type-string-for-location-parameters","text":"Azure.Template.LocationType AZR-000221 Error Operational Excellence \u00b7 All resources \u00b7 2021_03 Location parameters should use a string value.","title":"Use type string for location parameters"},{"location":"en/rules/Azure.Template.LocationType/#description","text":"The template parameter location is a standard parameter recommended for deployment templates. The location parameter is a intended for specifying the deployment location of the primary resource. When including location parameters in templates use the type string . Additionally, the template may include other resources. Use the location parameter value for resources that are likely to be in the same location. This approach minimizes the number of times users are asked to provide location information.","title":"Description"},{"location":"en/rules/Azure.Template.LocationType/#recommendation","text":"Consider updating the location parameter to be of type string .","title":"Recommendation"},{"location":"en/rules/Azure.Template.LocationType/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Template.LocationType/#configure-with-azure-template","text":"To author templates that pass this rule: If the location parameter is specified, it should be set to a string type. For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { \"location\" : { \"type\" : \"string\" , \"defaultValue\" : \"[resourceGroup().location]\" , \"metadata\" : { \"description\" : \"The location resources will be deployed.\" } } }, \"resources\" : [ { \"type\" : \"Microsoft.Network/networkSecurityGroups\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"nsg-001\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"securityRules\" : [ { \"name\" : \"deny-hop-outbound\" , \"properties\" : { \"priority\" : 200 , \"access\" : \"Deny\" , \"protocol\" : \"Tcp\" , \"direction\" : \"Outbound\" , \"sourceAddressPrefix\" : \"VirtualNetwork\" , \"destinationAddressPrefix\" : \"*\" , \"destinationPortRanges\" : [ \"3389\" , \"22\" ] } } ] } } ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Template.LocationType/#configure-with-bicep","text":"To author bicep source files that pass this rule: If the location parameter is specified, it should be set to a string type. For example: @description('The location resources will be deployed.') param location string = resourceGroup().location","title":"Configure with Bicep"},{"location":"en/rules/Azure.Template.LocationType/#links","text":"ARM template best practices Release deployment","title":"Links"},{"location":"en/rules/Azure.Template.MetadataLink/","tags":["Azure.Template.MetadataLink","AZR-000231"],"text":"Use parameter file metadata link # Azure.Template.MetadataLink AZR-000231 Error Operational Excellence \u00b7 All resources \u00b7 2021_09 Configure a metadata link for each parameter file. Description # A parameter file can include an additional metadata. This metadata provides additional context for use of the parameter file. PSRule for Azure uses the metadata.template property within parameter files to store a metadata link. A metadata link, is an explicit association between a parameter file it's intended template file. This rule is disabled by default but can be enabled by configuring AZURE_PARAMETER_FILE_METADATA_LINK . Enable this rule to ensure that each parameter file has a metadata link to a valid template file. Recommendation # Consider setting metadata for each parameter file linking to the deployment template. Examples # Configure parameter file # To create parameter files that pass this rule: Set the metadata.template property to a valid template file path. For example: { \"$schema\" : \"http://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"template\" : \"templates/storage/v1/template.json\" }, \"parameters\" : { \"storageAccountName\" : { \"value\" : \"...\" } } } Notes # Enable this rule by setting the AZURE_PARAMETER_FILE_METADATA_LINK option to true . Links # Using templates","title":"Azure.Template.MetadataLink"},{"location":"en/rules/Azure.Template.MetadataLink/#use-parameter-file-metadata-link","text":"Azure.Template.MetadataLink AZR-000231 Error Operational Excellence \u00b7 All resources \u00b7 2021_09 Configure a metadata link for each parameter file.","title":"Use parameter file metadata link"},{"location":"en/rules/Azure.Template.MetadataLink/#description","text":"A parameter file can include an additional metadata. This metadata provides additional context for use of the parameter file. PSRule for Azure uses the metadata.template property within parameter files to store a metadata link. A metadata link, is an explicit association between a parameter file it's intended template file. This rule is disabled by default but can be enabled by configuring AZURE_PARAMETER_FILE_METADATA_LINK . Enable this rule to ensure that each parameter file has a metadata link to a valid template file.","title":"Description"},{"location":"en/rules/Azure.Template.MetadataLink/#recommendation","text":"Consider setting metadata for each parameter file linking to the deployment template.","title":"Recommendation"},{"location":"en/rules/Azure.Template.MetadataLink/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Template.MetadataLink/#configure-parameter-file","text":"To create parameter files that pass this rule: Set the metadata.template property to a valid template file path. For example: { \"$schema\" : \"http://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"template\" : \"templates/storage/v1/template.json\" }, \"parameters\" : { \"storageAccountName\" : { \"value\" : \"...\" } } }","title":"Configure parameter file"},{"location":"en/rules/Azure.Template.MetadataLink/#notes","text":"Enable this rule by setting the AZURE_PARAMETER_FILE_METADATA_LINK option to true .","title":"Notes"},{"location":"en/rules/Azure.Template.MetadataLink/#links","text":"Using templates","title":"Links"},{"location":"en/rules/Azure.Template.ParameterDataTypes/","tags":["Azure.Template.ParameterDataTypes","AZR-000226"],"text":"Default should match type # Azure.Template.ParameterDataTypes AZR-000226 Error Operational Excellence \u00b7 All resources \u00b7 2021_03 Set the parameter default value to a value of the same type. Description # Azure Resource Manager (ARM) template support parameters with a range of types, including: bool int string array object secureString secureObject When including a defaultValue , the default value should match the same type at the type property. For example: { \"boolParam\" : { \"type\" : \"bool\" , \"defaultValue\" : false }, \"intParam\" : { \"type\" : \"int\" , \"defaultValue\" : 5 }, \"stringParam\" : { \"type\" : \"string\" , \"defaultValue\" : \"test-rg\" }, \"arrayParam\" : { \"type\" : \"array\" , \"defaultValue\" : [ 1 , 2 , 3 ] }, \"objectParam\" : { \"type\" : \"object\" , \"defaultValue\" : { \"one\" : \"a\" , \"two\" : \"b\" } } } Recommendation # Consider updating the parameter default value to a value of the same type. Links # Data types Release deployment","title":"Azure.Template.ParameterDataTypes"},{"location":"en/rules/Azure.Template.ParameterDataTypes/#default-should-match-type","text":"Azure.Template.ParameterDataTypes AZR-000226 Error Operational Excellence \u00b7 All resources \u00b7 2021_03 Set the parameter default value to a value of the same type.","title":"Default should match type"},{"location":"en/rules/Azure.Template.ParameterDataTypes/#description","text":"Azure Resource Manager (ARM) template support parameters with a range of types, including: bool int string array object secureString secureObject When including a defaultValue , the default value should match the same type at the type property. For example: { \"boolParam\" : { \"type\" : \"bool\" , \"defaultValue\" : false }, \"intParam\" : { \"type\" : \"int\" , \"defaultValue\" : 5 }, \"stringParam\" : { \"type\" : \"string\" , \"defaultValue\" : \"test-rg\" }, \"arrayParam\" : { \"type\" : \"array\" , \"defaultValue\" : [ 1 , 2 , 3 ] }, \"objectParam\" : { \"type\" : \"object\" , \"defaultValue\" : { \"one\" : \"a\" , \"two\" : \"b\" } } }","title":"Description"},{"location":"en/rules/Azure.Template.ParameterDataTypes/#recommendation","text":"Consider updating the parameter default value to a value of the same type.","title":"Recommendation"},{"location":"en/rules/Azure.Template.ParameterDataTypes/#links","text":"Data types Release deployment","title":"Links"},{"location":"en/rules/Azure.Template.ParameterFile/","tags":["Azure.Template.ParameterFile","AZR-000229"],"text":"Use ARM parameter file structure # Azure.Template.ParameterFile AZR-000229 Error Operational Excellence \u00b7 All resources \u00b7 2020_06 Use ARM template parameter files that are valid. Description # Azure Resource Manager (ARM) template parameter files have a pre-defined structure. ARM template parameter files require $schema , contentVersion and parameters sections to be defined. If any of these sections are missing, ARM will not accept the parameter file. Recommendation # Consider reviewing the requirements for this file. Also consider using Visual Studio Code to assist with authoring these files. Links # Automate deployments with ARM Templates Test cases for parameter files Create Resource Manager parameter file Parameters in Azure Resource Manager templates","title":"Azure.Template.ParameterFile"},{"location":"en/rules/Azure.Template.ParameterFile/#use-arm-parameter-file-structure","text":"Azure.Template.ParameterFile AZR-000229 Error Operational Excellence \u00b7 All resources \u00b7 2020_06 Use ARM template parameter files that are valid.","title":"Use ARM parameter file structure"},{"location":"en/rules/Azure.Template.ParameterFile/#description","text":"Azure Resource Manager (ARM) template parameter files have a pre-defined structure. ARM template parameter files require $schema , contentVersion and parameters sections to be defined. If any of these sections are missing, ARM will not accept the parameter file.","title":"Description"},{"location":"en/rules/Azure.Template.ParameterFile/#recommendation","text":"Consider reviewing the requirements for this file. Also consider using Visual Studio Code to assist with authoring these files.","title":"Recommendation"},{"location":"en/rules/Azure.Template.ParameterFile/#links","text":"Automate deployments with ARM Templates Test cases for parameter files Create Resource Manager parameter file Parameters in Azure Resource Manager templates","title":"Links"},{"location":"en/rules/Azure.Template.ParameterMetadata/","tags":["Azure.Template.ParameterMetadata","AZR-000215"],"text":"Use template parameter descriptions # Azure.Template.ParameterMetadata AZR-000215 Error Operational Excellence \u00b7 All resources \u00b7 2020_09 Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Description # ARM templates supports an additional metadata description to be added to each parameter. The parameter description is visible in Azure when using portal deployment pages. Additionally, descriptions provide context for people editing template and parameter files. For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { \"storageAccountType\" : { \"type\" : \"string\" , \"metadata\" : { \"description\" : \"The type of the new storage account created to store the VM disks.\" } } } } Recommendation # Consider defining a metadata description for each template parameter. Links # Parameters ARM template best practices Release deployment","title":"Azure.Template.ParameterMetadata"},{"location":"en/rules/Azure.Template.ParameterMetadata/#use-template-parameter-descriptions","text":"Azure.Template.ParameterMetadata AZR-000215 Error Operational Excellence \u00b7 All resources \u00b7 2020_09 Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter.","title":"Use template parameter descriptions"},{"location":"en/rules/Azure.Template.ParameterMetadata/#description","text":"ARM templates supports an additional metadata description to be added to each parameter. The parameter description is visible in Azure when using portal deployment pages. Additionally, descriptions provide context for people editing template and parameter files. For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { \"storageAccountType\" : { \"type\" : \"string\" , \"metadata\" : { \"description\" : \"The type of the new storage account created to store the VM disks.\" } } } }","title":"Description"},{"location":"en/rules/Azure.Template.ParameterMetadata/#recommendation","text":"Consider defining a metadata description for each template parameter.","title":"Recommendation"},{"location":"en/rules/Azure.Template.ParameterMetadata/#links","text":"Parameters ARM template best practices Release deployment","title":"Links"},{"location":"en/rules/Azure.Template.ParameterMinMaxValue/","tags":["Azure.Template.ParameterMinMaxValue","AZR-000224"],"text":"Use minValue and maxValue with correct type # Azure.Template.ParameterMinMaxValue AZR-000224 Error Operational Excellence \u00b7 All resources \u00b7 2021_03 Template parameters minValue and maxValue constraints must be valid. Description # When defining Azure template parameters the minValue or maxValue constraints can be added to parameters. These constraints are only valid for parameters using the int type. When configuring minValue and maxValue an integer must be used. Recommendation # Consider updating parameter definitions using minValue or maxValue . When using minValue or maxValue these values must be integers and only apply to int parameters. Links # Parameters ARM template best practices Release deployment","title":"Azure.Template.ParameterMinMaxValue"},{"location":"en/rules/Azure.Template.ParameterMinMaxValue/#use-minvalue-and-maxvalue-with-correct-type","text":"Azure.Template.ParameterMinMaxValue AZR-000224 Error Operational Excellence \u00b7 All resources \u00b7 2021_03 Template parameters minValue and maxValue constraints must be valid.","title":"Use minValue and maxValue with correct type"},{"location":"en/rules/Azure.Template.ParameterMinMaxValue/#description","text":"When defining Azure template parameters the minValue or maxValue constraints can be added to parameters. These constraints are only valid for parameters using the int type. When configuring minValue and maxValue an integer must be used.","title":"Description"},{"location":"en/rules/Azure.Template.ParameterMinMaxValue/#recommendation","text":"Consider updating parameter definitions using minValue or maxValue . When using minValue or maxValue these values must be integers and only apply to int parameters.","title":"Recommendation"},{"location":"en/rules/Azure.Template.ParameterMinMaxValue/#links","text":"Parameters ARM template best practices Release deployment","title":"Links"},{"location":"en/rules/Azure.Template.ParameterScheme/","tags":["Azure.Template.ParameterScheme","AZR-000230"],"text":"Use a https template parameter file schema # Azure.Template.ParameterScheme AZR-000230 Error Operational Excellence \u00b7 All resources \u00b7 2021_09 Use an Azure template parameter file schema with the https scheme. Description # JSON schemas are used to validate the structure of Azure template parameter files. The JSON schema specification permits schemas to use https or http schemes. When using referencing schemas served by schema.management.azure.com the http scheme redirects to https. While http://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json# points to a file. All supported Azure template parameter schemas use the https scheme. Recommendation # Consider using a schema with the https scheme. Examples # Configure with Azure template # To define Azure template parameter files that pass this rule: Configure the template parameter schema to a supported schema with the https:// URI prefix, such as https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json# . For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { } } Links # Automate deployments with ARM Templates Test cases for parameter files Create Resource Manager parameter file","title":"Azure.Template.ParameterScheme"},{"location":"en/rules/Azure.Template.ParameterScheme/#use-a-https-template-parameter-file-schema","text":"Azure.Template.ParameterScheme AZR-000230 Error Operational Excellence \u00b7 All resources \u00b7 2021_09 Use an Azure template parameter file schema with the https scheme.","title":"Use a https template parameter file schema"},{"location":"en/rules/Azure.Template.ParameterScheme/#description","text":"JSON schemas are used to validate the structure of Azure template parameter files. The JSON schema specification permits schemas to use https or http schemes. When using referencing schemas served by schema.management.azure.com the http scheme redirects to https. While http://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json# points to a file. All supported Azure template parameter schemas use the https scheme.","title":"Description"},{"location":"en/rules/Azure.Template.ParameterScheme/#recommendation","text":"Consider using a schema with the https scheme.","title":"Recommendation"},{"location":"en/rules/Azure.Template.ParameterScheme/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Template.ParameterScheme/#configure-with-azure-template","text":"To define Azure template parameter files that pass this rule: Configure the template parameter schema to a supported schema with the https:// URI prefix, such as https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json# . For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Template.ParameterScheme/#links","text":"Automate deployments with ARM Templates Test cases for parameter files Create Resource Manager parameter file","title":"Links"},{"location":"en/rules/Azure.Template.ParameterStrongType/","tags":["Azure.Template.ParameterStrongType","AZR-000227"],"text":"Parameter value should match strong type # Azure.Template.ParameterStrongType AZR-000227 Error Operational Excellence \u00b7 All resources \u00b7 2021_12 Set the parameter value to a value that matches the specified strong type. Description # Template string parameters can optionally specify a strong type. When parameter files are expanded, if the parameter value does not match the type this rule fails. Support is provided by PSRule for Azure for the following types: Resource type - Specify a resource type. For example Microsoft.OperationalInsights/workspaces . If a resource type is specified the parameter value must be a resource id of that type. Location - Specify location as the strong type. If location is specified, the parameter value must be a valid Azure location. Recommendation # Consider updating the parameter value to a value that matches the specifed strong type. Links # Deployment considerations for DevOps Strong type","title":"Azure.Template.ParameterStrongType"},{"location":"en/rules/Azure.Template.ParameterStrongType/#parameter-value-should-match-strong-type","text":"Azure.Template.ParameterStrongType AZR-000227 Error Operational Excellence \u00b7 All resources \u00b7 2021_12 Set the parameter value to a value that matches the specified strong type.","title":"Parameter value should match strong type"},{"location":"en/rules/Azure.Template.ParameterStrongType/#description","text":"Template string parameters can optionally specify a strong type. When parameter files are expanded, if the parameter value does not match the type this rule fails. Support is provided by PSRule for Azure for the following types: Resource type - Specify a resource type. For example Microsoft.OperationalInsights/workspaces . If a resource type is specified the parameter value must be a resource id of that type. Location - Specify location as the strong type. If location is specified, the parameter value must be a valid Azure location.","title":"Description"},{"location":"en/rules/Azure.Template.ParameterStrongType/#recommendation","text":"Consider updating the parameter value to a value that matches the specifed strong type.","title":"Recommendation"},{"location":"en/rules/Azure.Template.ParameterStrongType/#links","text":"Deployment considerations for DevOps Strong type","title":"Links"},{"location":"en/rules/Azure.Template.ParameterValue/","tags":["Azure.Template.ParameterValue","AZR-000232"],"text":"Specify a value for each parameter # Azure.Template.ParameterValue AZR-000232 Error Operational Excellence \u00b7 All resources \u00b7 2021_09 Specify a value for each parameter in template parameter files. Description # When defining a template parameter file: Uou must specify a value for each parameter in the file. If the parameter is optional, you can omit the parameter from the file. If the parameter is required, you must specify a value for the parameter. Recommendation # Consider defining a value for each parameter in the template parameter file. Examples # Configure with Azure template # To define Azure template parameter files that pass this rule: Set a value for each parameter specified in the file. For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { \"parameter1\" : { \"value\" : \"value1\" }, \"parameter2\" : { \"value\" : [] } } } Links # Automate deployments with ARM Templates Test cases for parameter files Create Resource Manager parameter file Parameters in Azure Resource Manager templates","title":"Azure.Template.ParameterValue"},{"location":"en/rules/Azure.Template.ParameterValue/#specify-a-value-for-each-parameter","text":"Azure.Template.ParameterValue AZR-000232 Error Operational Excellence \u00b7 All resources \u00b7 2021_09 Specify a value for each parameter in template parameter files.","title":"Specify a value for each parameter"},{"location":"en/rules/Azure.Template.ParameterValue/#description","text":"When defining a template parameter file: Uou must specify a value for each parameter in the file. If the parameter is optional, you can omit the parameter from the file. If the parameter is required, you must specify a value for the parameter.","title":"Description"},{"location":"en/rules/Azure.Template.ParameterValue/#recommendation","text":"Consider defining a value for each parameter in the template parameter file.","title":"Recommendation"},{"location":"en/rules/Azure.Template.ParameterValue/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Template.ParameterValue/#configure-with-azure-template","text":"To define Azure template parameter files that pass this rule: Set a value for each parameter specified in the file. For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { \"parameter1\" : { \"value\" : \"value1\" }, \"parameter2\" : { \"value\" : [] } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Template.ParameterValue/#links","text":"Automate deployments with ARM Templates Test cases for parameter files Create Resource Manager parameter file Parameters in Azure Resource Manager templates","title":"Links"},{"location":"en/rules/Azure.Template.ResourceLocation/","tags":["Azure.Template.ResourceLocation","AZR-000222"],"text":"Use a location parameter for regional resources # Azure.Template.ResourceLocation AZR-000222 Error Operational Excellence \u00b7 All resources \u00b7 2021_03 Template resource location should be an expression or global . Description # The template parameter location is a standard parameter recommended for deployment templates. The location parameter is a intended for specifying the deployment location of the primary resource. When defining a resource that requires a location, use the location parameter. For example: { \"type\" : \"Microsoft.Network/virtualNetworks\" , \"name\" : \"[parameters('VNETName')]\" , \"apiVersion\" : \"2020-06-01\" , \"location\" : \"[parameters('location')]\" , \"properties\" : {} } Additionally, the template may include other resources. Use the location parameter value for resources that are likely to be in the same location. This approach minimizes the number of times users are asked to provide location information. For resources that aren't available in all locations, use a separate parameter. For non-regional resources such as Front Door and DNS Zones specify a literal location global . Recommendation # Consider updating the resource location property to use [parameters('location)] . Links # ARM template best practices Release deployment Parameters","title":"Azure.Template.ResourceLocation"},{"location":"en/rules/Azure.Template.ResourceLocation/#use-a-location-parameter-for-regional-resources","text":"Azure.Template.ResourceLocation AZR-000222 Error Operational Excellence \u00b7 All resources \u00b7 2021_03 Template resource location should be an expression or global .","title":"Use a location parameter for regional resources"},{"location":"en/rules/Azure.Template.ResourceLocation/#description","text":"The template parameter location is a standard parameter recommended for deployment templates. The location parameter is a intended for specifying the deployment location of the primary resource. When defining a resource that requires a location, use the location parameter. For example: { \"type\" : \"Microsoft.Network/virtualNetworks\" , \"name\" : \"[parameters('VNETName')]\" , \"apiVersion\" : \"2020-06-01\" , \"location\" : \"[parameters('location')]\" , \"properties\" : {} } Additionally, the template may include other resources. Use the location parameter value for resources that are likely to be in the same location. This approach minimizes the number of times users are asked to provide location information. For resources that aren't available in all locations, use a separate parameter. For non-regional resources such as Front Door and DNS Zones specify a literal location global .","title":"Description"},{"location":"en/rules/Azure.Template.ResourceLocation/#recommendation","text":"Consider updating the resource location property to use [parameters('location)] .","title":"Recommendation"},{"location":"en/rules/Azure.Template.ResourceLocation/#links","text":"ARM template best practices Release deployment Parameters","title":"Links"},{"location":"en/rules/Azure.Template.Resources/","tags":["Azure.Template.Resources","AZR-000216"],"text":"Include a template resource # Azure.Template.Resources AZR-000216 Error Operational Excellence \u00b7 All resources \u00b7 2020_09 Each Azure Resource Manager (ARM) template file should deploy at least one resource. Description # An ARM template file is used to create or update one or more Azure resources. The resources property of an ARM template includes a definition of the resources to deploy. Recommendation # Consider removing Azure template files that do not deploy any resources. Links # Resources Tutorial: Create and deploy your first ARM template Release deployment","title":"Azure.Template.Resources"},{"location":"en/rules/Azure.Template.Resources/#include-a-template-resource","text":"Azure.Template.Resources AZR-000216 Error Operational Excellence \u00b7 All resources \u00b7 2020_09 Each Azure Resource Manager (ARM) template file should deploy at least one resource.","title":"Include a template resource"},{"location":"en/rules/Azure.Template.Resources/#description","text":"An ARM template file is used to create or update one or more Azure resources. The resources property of an ARM template includes a definition of the resources to deploy.","title":"Description"},{"location":"en/rules/Azure.Template.Resources/#recommendation","text":"Consider removing Azure template files that do not deploy any resources.","title":"Recommendation"},{"location":"en/rules/Azure.Template.Resources/#links","text":"Resources Tutorial: Create and deploy your first ARM template Release deployment","title":"Links"},{"location":"en/rules/Azure.Template.TemplateFile/","tags":["Azure.Template.TemplateFile","AZR-000212"],"text":"Use ARM template file structure # Azure.Template.TemplateFile AZR-000212 Error Operational Excellence \u00b7 All resources \u00b7 2020_06 Use ARM template files that are valid. Description # Azure Resource Manager (ARM) template files have a pre-defined structure. ARM templates require $schema , contentVersion and resources sections to be defined. If any of these sections are missing, ARM will not accept the template. Recommendation # Consider reviewing the requirements for this file. Also consider using Visual Studio Code to assist with authoring these files. Links # Automate deployments with ARM Templates Template file structure Define resources in Azure Resource Manager templates","title":"Azure.Template.TemplateFile"},{"location":"en/rules/Azure.Template.TemplateFile/#use-arm-template-file-structure","text":"Azure.Template.TemplateFile AZR-000212 Error Operational Excellence \u00b7 All resources \u00b7 2020_06 Use ARM template files that are valid.","title":"Use ARM template file structure"},{"location":"en/rules/Azure.Template.TemplateFile/#description","text":"Azure Resource Manager (ARM) template files have a pre-defined structure. ARM templates require $schema , contentVersion and resources sections to be defined. If any of these sections are missing, ARM will not accept the template.","title":"Description"},{"location":"en/rules/Azure.Template.TemplateFile/#recommendation","text":"Consider reviewing the requirements for this file. Also consider using Visual Studio Code to assist with authoring these files.","title":"Recommendation"},{"location":"en/rules/Azure.Template.TemplateFile/#links","text":"Automate deployments with ARM Templates Template file structure Define resources in Azure Resource Manager templates","title":"Links"},{"location":"en/rules/Azure.Template.TemplateSchema/","tags":["Azure.Template.TemplateSchema","AZR-000213"],"text":"Use a recent template schema version # Azure.Template.TemplateSchema AZR-000213 Error Operational Excellence \u00b7 All resources \u00b7 2021_09 Use a more recent version of the Azure template schema. Description # The JSON schemas used to define Azure templates are versioned. When defining templates use templates with a supported schema. The following template schemas are deprecated: https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json# Recommendation # Consider using a more recent schema version for Azure template files. Examples # Configure with Azure template # To define Azure template files that pass this rule: Configure the template schema to one of the following: https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json# https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json# https://schema.management.azure.com/schemas/2019-08-01/tenantDeploymentTemplate.json# https://schema.management.azure.com/schemas/2019-08-01/managementGroupDeploymentTemplate.json# For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { }, \"functions\" : [], \"resources\" : [ ] } Links # Automate deployments with ARM Templates Test cases for ARM templates Template file structure","title":"Azure.Template.TemplateSchema"},{"location":"en/rules/Azure.Template.TemplateSchema/#use-a-recent-template-schema-version","text":"Azure.Template.TemplateSchema AZR-000213 Error Operational Excellence \u00b7 All resources \u00b7 2021_09 Use a more recent version of the Azure template schema.","title":"Use a recent template schema version"},{"location":"en/rules/Azure.Template.TemplateSchema/#description","text":"The JSON schemas used to define Azure templates are versioned. When defining templates use templates with a supported schema. The following template schemas are deprecated: https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#","title":"Description"},{"location":"en/rules/Azure.Template.TemplateSchema/#recommendation","text":"Consider using a more recent schema version for Azure template files.","title":"Recommendation"},{"location":"en/rules/Azure.Template.TemplateSchema/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Template.TemplateSchema/#configure-with-azure-template","text":"To define Azure template files that pass this rule: Configure the template schema to one of the following: https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json# https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json# https://schema.management.azure.com/schemas/2019-08-01/tenantDeploymentTemplate.json# https://schema.management.azure.com/schemas/2019-08-01/managementGroupDeploymentTemplate.json# For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { }, \"functions\" : [], \"resources\" : [ ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Template.TemplateSchema/#links","text":"Automate deployments with ARM Templates Test cases for ARM templates Template file structure","title":"Links"},{"location":"en/rules/Azure.Template.TemplateScheme/","tags":["Azure.Template.TemplateScheme","AZR-000214"],"text":"Use a https template file schema # Azure.Template.TemplateScheme AZR-000214 Error Operational Excellence \u00b7 All resources \u00b7 2021_09 Use an Azure template file schema with the https scheme. Description # JSON schemas are used to validate the structure of Azure template files. The JSON schema specification permits schemas to use https or http schemes. When using referencing schemas served by schema.management.azure.com the http scheme redirects to https. While http://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json# points to a file. All supported Azure template schemas use the https scheme. Recommendation # Consider using a schema with the https scheme. Examples # Configure with Azure template # To define Azure template files that pass this rule: Configure the template schema to a supported schema with the https:// URI prefix, such as https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json# . For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { }, \"functions\" : [], \"resources\" : [ ] } Links # Automate deployments with ARM Templates Test cases for ARM templates Template file structure","title":"Azure.Template.TemplateScheme"},{"location":"en/rules/Azure.Template.TemplateScheme/#use-a-https-template-file-schema","text":"Azure.Template.TemplateScheme AZR-000214 Error Operational Excellence \u00b7 All resources \u00b7 2021_09 Use an Azure template file schema with the https scheme.","title":"Use a https template file schema"},{"location":"en/rules/Azure.Template.TemplateScheme/#description","text":"JSON schemas are used to validate the structure of Azure template files. The JSON schema specification permits schemas to use https or http schemes. When using referencing schemas served by schema.management.azure.com the http scheme redirects to https. While http://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json# points to a file. All supported Azure template schemas use the https scheme.","title":"Description"},{"location":"en/rules/Azure.Template.TemplateScheme/#recommendation","text":"Consider using a schema with the https scheme.","title":"Recommendation"},{"location":"en/rules/Azure.Template.TemplateScheme/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Template.TemplateScheme/#configure-with-azure-template","text":"To define Azure template files that pass this rule: Configure the template schema to a supported schema with the https:// URI prefix, such as https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json# . For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { }, \"functions\" : [], \"resources\" : [ ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Template.TemplateScheme/#links","text":"Automate deployments with ARM Templates Test cases for ARM templates Template file structure","title":"Links"},{"location":"en/rules/Azure.Template.UseComments/","tags":["Azure.Template.UseComments","AZR-000234"],"text":"Use comments for each ARM template resource # Azure.Template.UseComments AZR-000234 Information Operational Excellence \u00b7 All resources \u00b7 2021_12 Use comments for each resource in ARM template to communicate purpose. Description # ARM templates can optionally include comments in resources. This helps other contributors understand the purpose of the resource. Recommendation # Specify comments for each resource in the template. Examples # Configure with Azure template # To define Azure template files that pass this rule: Specify comments for each resource in the template. For example: \"resources\" : [ { \"name\" : \"[variables('storageAccountName')]\" , \"type\" : \"Microsoft.Storage/storageAccounts\" , \"apiVersion\" : \"2019-06-01\" , \"location\" : \"[resourceGroup().location]\" , \"comments\" : \"This storage account is used to store the VM disks.\" , ... } ] Links # Better understand your cloud resources ARM template best practices","title":"Azure.Template.UseComments"},{"location":"en/rules/Azure.Template.UseComments/#use-comments-for-each-arm-template-resource","text":"Azure.Template.UseComments AZR-000234 Information Operational Excellence \u00b7 All resources \u00b7 2021_12 Use comments for each resource in ARM template to communicate purpose.","title":"Use comments for each ARM template resource"},{"location":"en/rules/Azure.Template.UseComments/#description","text":"ARM templates can optionally include comments in resources. This helps other contributors understand the purpose of the resource.","title":"Description"},{"location":"en/rules/Azure.Template.UseComments/#recommendation","text":"Specify comments for each resource in the template.","title":"Recommendation"},{"location":"en/rules/Azure.Template.UseComments/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Template.UseComments/#configure-with-azure-template","text":"To define Azure template files that pass this rule: Specify comments for each resource in the template. For example: \"resources\" : [ { \"name\" : \"[variables('storageAccountName')]\" , \"type\" : \"Microsoft.Storage/storageAccounts\" , \"apiVersion\" : \"2019-06-01\" , \"location\" : \"[resourceGroup().location]\" , \"comments\" : \"This storage account is used to store the VM disks.\" , ... } ]","title":"Configure with Azure template"},{"location":"en/rules/Azure.Template.UseComments/#links","text":"Better understand your cloud resources ARM template best practices","title":"Links"},{"location":"en/rules/Azure.Template.UseDescriptions/","tags":["Azure.Template.UseDescriptions","AZR-000235"],"text":"Use comments for each generated template resource # Azure.Template.UseDescriptions AZR-000235 Information Operational Excellence \u00b7 All resources \u00b7 2021_12 Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Description # Generated templates can optionally include descriptions in resources. This helps other contributors understand the purpose of the resource. Recommendation # Specify descriptions for each resource in the template. Examples # Configure with Bicep # To define Bicep template files that pass this rule: Specify the @description() decorator for each resource in the template. For example: // An example container registry @description('abc') resource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = { name: registryName location: location sku: { name: 'Premium' } identity: { type: 'SystemAssigned' } properties: { adminUserEnabled: false policies: { quarantinePolicy: { status: 'enabled' } trustPolicy: { status: 'enabled' type: 'Notary' } retentionPolicy: { status: 'enabled' days: 30 } } } } Links # Better understand your cloud resources Decorators","title":"Azure.Template.UseDescriptions"},{"location":"en/rules/Azure.Template.UseDescriptions/#use-comments-for-each-generated-template-resource","text":"Azure.Template.UseDescriptions AZR-000235 Information Operational Excellence \u00b7 All resources \u00b7 2021_12 Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose.","title":"Use comments for each generated template resource"},{"location":"en/rules/Azure.Template.UseDescriptions/#description","text":"Generated templates can optionally include descriptions in resources. This helps other contributors understand the purpose of the resource.","title":"Description"},{"location":"en/rules/Azure.Template.UseDescriptions/#recommendation","text":"Specify descriptions for each resource in the template.","title":"Recommendation"},{"location":"en/rules/Azure.Template.UseDescriptions/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Template.UseDescriptions/#configure-with-bicep","text":"To define Bicep template files that pass this rule: Specify the @description() decorator for each resource in the template. For example: // An example container registry @description('abc') resource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = { name: registryName location: location sku: { name: 'Premium' } identity: { type: 'SystemAssigned' } properties: { adminUserEnabled: false policies: { quarantinePolicy: { status: 'enabled' } trustPolicy: { status: 'enabled' type: 'Notary' } retentionPolicy: { status: 'enabled' days: 30 } } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.Template.UseDescriptions/#links","text":"Better understand your cloud resources Decorators","title":"Links"},{"location":"en/rules/Azure.Template.UseLocationParameter/","tags":["Azure.Template.UseLocationParameter","AZR-000223"],"text":"Use a location parameter to specify resource location # Azure.Template.UseLocationParameter AZR-000223 Warning Operational Excellence \u00b7 All resources \u00b7 2021_03 Template should reference a location parameter to specify resource location. Description # The template parameter location is a standard parameter recommended for deployment templates. The location parameter is a intended for specifying the deployment location of the primary resource. When defining a resource that requires a location, use the location parameter. For example: { \"type\" : \"Microsoft.Network/virtualNetworks\" , \"name\" : \"[parameters('VNETName')]\" , \"apiVersion\" : \"2020-06-01\" , \"location\" : \"[parameters('location')]\" , \"properties\" : {} } Additionally, the template may include other resources. Use the location parameter value for resources that are likely to be in the same location. This approach minimizes the number of times users are asked to provide location information. For resources that aren't available in all locations, use a separate parameter. Recommendation # Consider using parameters('location) instead of resourceGroup().location . Using a location parameter enabled users of the template to specify the location of deployed resources. Examples # Configure with Azure template # To author templates that pass this rule: Define a parameter named location . Set the location of any deployed resources to [parameters('location')] . For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"name\" : \"Managed Identity\" , \"description\" : \"Create or update a Managed Identity.\" }, \"parameters\" : { \"identityName\" : { \"type\" : \"string\" , \"metadata\" : { \"description\" : \"The name of the Managed Identity.\" } }, \"location\" : { \"type\" : \"string\" , \"defaultValue\" : \"[resourceGroup().location]\" , \"metadata\" : { \"description\" : \"The Azure region to deploy to.\" , \"example\" : \"eastus\" } }, \"tags\" : { \"type\" : \"object\" , \"metadata\" : { \"description\" : \"Tags to apply to the resource.\" , \"example\" : { \"service\" : \"app1\" , \"env\" : \"prod\" } } } }, \"variables\" : { \"tenantId\" : \"[subscription().tenantId]\" }, \"resources\" : [ { \"comments\" : \"Create or update a Managed Identity\" , \"type\" : \"Microsoft.ManagedIdentity/userAssignedIdentities\" , \"apiVersion\" : \"2018-11-30\" , \"name\" : \"[parameters('identityName')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"tenantId\" : \"[variables('tenantId')]\" }, \"tags\" : \"[parameters('tags')]\" } ] } Notes # This rule is not applicable and ignored for templates generated with Bicep, PSArm, and AzOps. Generated templates from these tools may not require any parameters to be set. Links # ARM template best practices Parameters Release deployment","title":"Azure.Template.UseLocationParameter"},{"location":"en/rules/Azure.Template.UseLocationParameter/#use-a-location-parameter-to-specify-resource-location","text":"Azure.Template.UseLocationParameter AZR-000223 Warning Operational Excellence \u00b7 All resources \u00b7 2021_03 Template should reference a location parameter to specify resource location.","title":"Use a location parameter to specify resource location"},{"location":"en/rules/Azure.Template.UseLocationParameter/#description","text":"The template parameter location is a standard parameter recommended for deployment templates. The location parameter is a intended for specifying the deployment location of the primary resource. When defining a resource that requires a location, use the location parameter. For example: { \"type\" : \"Microsoft.Network/virtualNetworks\" , \"name\" : \"[parameters('VNETName')]\" , \"apiVersion\" : \"2020-06-01\" , \"location\" : \"[parameters('location')]\" , \"properties\" : {} } Additionally, the template may include other resources. Use the location parameter value for resources that are likely to be in the same location. This approach minimizes the number of times users are asked to provide location information. For resources that aren't available in all locations, use a separate parameter.","title":"Description"},{"location":"en/rules/Azure.Template.UseLocationParameter/#recommendation","text":"Consider using parameters('location) instead of resourceGroup().location . Using a location parameter enabled users of the template to specify the location of deployed resources.","title":"Recommendation"},{"location":"en/rules/Azure.Template.UseLocationParameter/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Template.UseLocationParameter/#configure-with-azure-template","text":"To author templates that pass this rule: Define a parameter named location . Set the location of any deployed resources to [parameters('location')] . For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"name\" : \"Managed Identity\" , \"description\" : \"Create or update a Managed Identity.\" }, \"parameters\" : { \"identityName\" : { \"type\" : \"string\" , \"metadata\" : { \"description\" : \"The name of the Managed Identity.\" } }, \"location\" : { \"type\" : \"string\" , \"defaultValue\" : \"[resourceGroup().location]\" , \"metadata\" : { \"description\" : \"The Azure region to deploy to.\" , \"example\" : \"eastus\" } }, \"tags\" : { \"type\" : \"object\" , \"metadata\" : { \"description\" : \"Tags to apply to the resource.\" , \"example\" : { \"service\" : \"app1\" , \"env\" : \"prod\" } } } }, \"variables\" : { \"tenantId\" : \"[subscription().tenantId]\" }, \"resources\" : [ { \"comments\" : \"Create or update a Managed Identity\" , \"type\" : \"Microsoft.ManagedIdentity/userAssignedIdentities\" , \"apiVersion\" : \"2018-11-30\" , \"name\" : \"[parameters('identityName')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"tenantId\" : \"[variables('tenantId')]\" }, \"tags\" : \"[parameters('tags')]\" } ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Template.UseLocationParameter/#notes","text":"This rule is not applicable and ignored for templates generated with Bicep, PSArm, and AzOps. Generated templates from these tools may not require any parameters to be set.","title":"Notes"},{"location":"en/rules/Azure.Template.UseLocationParameter/#links","text":"ARM template best practices Parameters Release deployment","title":"Links"},{"location":"en/rules/Azure.Template.UseParameters/","tags":["Azure.Template.UseParameters","AZR-000217"],"text":"Remove unused template parameters # Azure.Template.UseParameters AZR-000217 Error Operational Excellence \u00b7 All resources \u00b7 2020_09 Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Description # ARM templates can optionally define parameters that can be reused throughout the template. Parameters that are not used may make template use more complex for no benefit. Recommendation # Consider removing unused parameters from Azure template files. Links # Parameters ARM template best practices Release deployment","title":"Azure.Template.UseParameters"},{"location":"en/rules/Azure.Template.UseParameters/#remove-unused-template-parameters","text":"Azure.Template.UseParameters AZR-000217 Error Operational Excellence \u00b7 All resources \u00b7 2020_09 Each Azure Resource Manager (ARM) template parameter should be used or removed from template files.","title":"Remove unused template parameters"},{"location":"en/rules/Azure.Template.UseParameters/#description","text":"ARM templates can optionally define parameters that can be reused throughout the template. Parameters that are not used may make template use more complex for no benefit.","title":"Description"},{"location":"en/rules/Azure.Template.UseParameters/#recommendation","text":"Consider removing unused parameters from Azure template files.","title":"Recommendation"},{"location":"en/rules/Azure.Template.UseParameters/#links","text":"Parameters ARM template best practices Release deployment","title":"Links"},{"location":"en/rules/Azure.Template.UseVariables/","tags":["Azure.Template.UseVariables","AZR-000219"],"text":"Remove unused template variables # Azure.Template.UseVariables AZR-000219 Error Operational Excellence \u00b7 All resources \u00b7 2020_09 Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Description # ARM templates can optionally define variables that can be reused throughout the template. Variables that are not used may add template complexity for no benefit. Recommendation # Consider removing unused variables from Azure template files. Links # Variables ARM template best practices Release deployment","title":"Azure.Template.UseVariables"},{"location":"en/rules/Azure.Template.UseVariables/#remove-unused-template-variables","text":"Azure.Template.UseVariables AZR-000219 Error Operational Excellence \u00b7 All resources \u00b7 2020_09 Each Azure Resource Manager (ARM) template variable should be used or removed from template files.","title":"Remove unused template variables"},{"location":"en/rules/Azure.Template.UseVariables/#description","text":"ARM templates can optionally define variables that can be reused throughout the template. Variables that are not used may add template complexity for no benefit.","title":"Description"},{"location":"en/rules/Azure.Template.UseVariables/#recommendation","text":"Consider removing unused variables from Azure template files.","title":"Recommendation"},{"location":"en/rules/Azure.Template.UseVariables/#links","text":"Variables ARM template best practices Release deployment","title":"Links"},{"location":"en/rules/Azure.Template.ValidSecretRef/","tags":["Azure.Template.ValidSecretRef","AZR-000233"],"text":"Use a valid secret reference # Azure.Template.ValidSecretRef AZR-000233 Error Operational Excellence \u00b7 All resources \u00b7 2021_09 Use a valid secret reference within parameter files. Description # When referencing secrets in a template parameter file: The secret reference must be a valid Azure resource ID Key Vault. A secret name must be specified. An optional secret version can be specified. Recommendation # Check the secret value Key Vault reference is valid. Examples # Configure with Azure template # To define Azure template parameter files that pass this rule: When a secret is referenced from Key Vault, provide a valid resource ID and secret name. For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { \"gatewayName\" : { \"value\" : \"gateway-A\" }, \"sku\" : { \"value\" : \"VpnGw1\" }, \"subnetId\" : { \"value\" : \"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/vnet-A/subnets/GatewaySubnet\" }, \"sharedKey\" : { \"reference\" : { \"keyVault\" : { \"id\" : \"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.KeyVault/vaults/kv-001\" }, \"secretName\" : \"valid-secret\" } } } } Links # Automate deployments with ARM Templates Reference secrets with static ID Create Resource Manager parameter file","title":"Azure.Template.ValidSecretRef"},{"location":"en/rules/Azure.Template.ValidSecretRef/#use-a-valid-secret-reference","text":"Azure.Template.ValidSecretRef AZR-000233 Error Operational Excellence \u00b7 All resources \u00b7 2021_09 Use a valid secret reference within parameter files.","title":"Use a valid secret reference"},{"location":"en/rules/Azure.Template.ValidSecretRef/#description","text":"When referencing secrets in a template parameter file: The secret reference must be a valid Azure resource ID Key Vault. A secret name must be specified. An optional secret version can be specified.","title":"Description"},{"location":"en/rules/Azure.Template.ValidSecretRef/#recommendation","text":"Check the secret value Key Vault reference is valid.","title":"Recommendation"},{"location":"en/rules/Azure.Template.ValidSecretRef/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.Template.ValidSecretRef/#configure-with-azure-template","text":"To define Azure template parameter files that pass this rule: When a secret is referenced from Key Vault, provide a valid resource ID and secret name. For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"parameters\" : { \"gatewayName\" : { \"value\" : \"gateway-A\" }, \"sku\" : { \"value\" : \"VpnGw1\" }, \"subnetId\" : { \"value\" : \"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/vnet-A/subnets/GatewaySubnet\" }, \"sharedKey\" : { \"reference\" : { \"keyVault\" : { \"id\" : \"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.KeyVault/vaults/kv-001\" }, \"secretName\" : \"valid-secret\" } } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.Template.ValidSecretRef/#links","text":"Automate deployments with ARM Templates Reference secrets with static ID Create Resource Manager parameter file","title":"Links"},{"location":"en/rules/Azure.TrafficManager.Endpoints/","tags":["Azure.TrafficManager.Endpoints","AZR-000236"],"text":"Use at least two Traffic Manager endpoints # Azure.TrafficManager.Endpoints AZR-000236 Error Reliability \u00b7 Traffic Manager \u00b7 2020_06 Traffic Manager should use at lest two enabled endpoints. Description # Traffic Manager is a DNS service that enables you to distribute traffic to improve availability and responsiveness. Traffic is distributed across endpoints, which can be located in different availability zones and regions. When only one enabled endpoint exists, routing for high availability and/ or responsiveness is not possible. Recommendation # Consider adding additional endpoints or enabling disabled endpoints. Also consider, using endpoints deployed across different regions to provide high availability. Links # What is Traffic Manager? How Traffic Manager Works","title":"Azure.TrafficManager.Endpoints"},{"location":"en/rules/Azure.TrafficManager.Endpoints/#use-at-least-two-traffic-manager-endpoints","text":"Azure.TrafficManager.Endpoints AZR-000236 Error Reliability \u00b7 Traffic Manager \u00b7 2020_06 Traffic Manager should use at lest two enabled endpoints.","title":"Use at least two Traffic Manager endpoints"},{"location":"en/rules/Azure.TrafficManager.Endpoints/#description","text":"Traffic Manager is a DNS service that enables you to distribute traffic to improve availability and responsiveness. Traffic is distributed across endpoints, which can be located in different availability zones and regions. When only one enabled endpoint exists, routing for high availability and/ or responsiveness is not possible.","title":"Description"},{"location":"en/rules/Azure.TrafficManager.Endpoints/#recommendation","text":"Consider adding additional endpoints or enabling disabled endpoints. Also consider, using endpoints deployed across different regions to provide high availability.","title":"Recommendation"},{"location":"en/rules/Azure.TrafficManager.Endpoints/#links","text":"What is Traffic Manager? How Traffic Manager Works","title":"Links"},{"location":"en/rules/Azure.TrafficManager.Protocol/","tags":["Azure.TrafficManager.Protocol","AZR-000237"],"text":"Use HTTPS to monitor web-based endpoints # Azure.TrafficManager.Protocol AZR-000237 Error Security \u00b7 Traffic Manager \u00b7 2020_06 Monitor Traffic Manager web-based endpoints with HTTPS. Description # Traffic Manager can use TCP, HTTP or HTTPS to monitor endpoint health. For web-based endpoints use HTTPS. If TCP is used, Traffic Manager only checks that it can open a TCP port on the endpoint. This alone does not indicate that the endpoint is operational and ready to receive requests. Additionally when using HTTP and HTTPS, Traffic Manager check HTTP response codes. If HTTP is used, Traffic Manager will send unencrypted health checks to the endpoint. HTTPS-based health checks additionally check if a certificate is present, but do not validate if the certificate is valid. Recommendation # Consider using HTTPS to monitor web-based endpoint health. HTTPS-based monitoring improves security and increases accuracy of health probes. Links # Data encryption in Azure Traffic Manager endpoint monitoring","title":"Azure.TrafficManager.Protocol"},{"location":"en/rules/Azure.TrafficManager.Protocol/#use-https-to-monitor-web-based-endpoints","text":"Azure.TrafficManager.Protocol AZR-000237 Error Security \u00b7 Traffic Manager \u00b7 2020_06 Monitor Traffic Manager web-based endpoints with HTTPS.","title":"Use HTTPS to monitor web-based endpoints"},{"location":"en/rules/Azure.TrafficManager.Protocol/#description","text":"Traffic Manager can use TCP, HTTP or HTTPS to monitor endpoint health. For web-based endpoints use HTTPS. If TCP is used, Traffic Manager only checks that it can open a TCP port on the endpoint. This alone does not indicate that the endpoint is operational and ready to receive requests. Additionally when using HTTP and HTTPS, Traffic Manager check HTTP response codes. If HTTP is used, Traffic Manager will send unencrypted health checks to the endpoint. HTTPS-based health checks additionally check if a certificate is present, but do not validate if the certificate is valid.","title":"Description"},{"location":"en/rules/Azure.TrafficManager.Protocol/#recommendation","text":"Consider using HTTPS to monitor web-based endpoint health. HTTPS-based monitoring improves security and increases accuracy of health probes.","title":"Recommendation"},{"location":"en/rules/Azure.TrafficManager.Protocol/#links","text":"Data encryption in Azure Traffic Manager endpoint monitoring","title":"Links"},{"location":"en/rules/Azure.VM.ADE/","tags":["Azure.VM.ADE","AZR-000252"],"text":"Use Azure Disk Encryption # Azure.VM.ADE AZR-000252 Error Security \u00b7 Virtual Machine \u00b7 2020_06 Use Azure Disk Encryption (ADE). Description # Virtual machines (VMs) can be encrypted using ADE to protect disks with full disk encryption. Storage Service Encryption (SSE) is encryption as rest for Managed Disks and Storage Accounts. SSE automatically decrypts storage as it is read. Full disk encryption varies from SSE by decrypting disks on read within the operating system. ADE protects disk decryption keys within Key Vault. Recommendation # Consider using Azure Disk Encryption (ADE) to protect VM disks from being downloaded and accessed offline. Links # Data encryption in Azure Creating and configuring a key vault for Azure Disk Encryption Azure Disk Encryption scenarios on Windows VMs","title":"Azure.VM.ADE"},{"location":"en/rules/Azure.VM.ADE/#use-azure-disk-encryption","text":"Azure.VM.ADE AZR-000252 Error Security \u00b7 Virtual Machine \u00b7 2020_06 Use Azure Disk Encryption (ADE).","title":"Use Azure Disk Encryption"},{"location":"en/rules/Azure.VM.ADE/#description","text":"Virtual machines (VMs) can be encrypted using ADE to protect disks with full disk encryption. Storage Service Encryption (SSE) is encryption as rest for Managed Disks and Storage Accounts. SSE automatically decrypts storage as it is read. Full disk encryption varies from SSE by decrypting disks on read within the operating system. ADE protects disk decryption keys within Key Vault.","title":"Description"},{"location":"en/rules/Azure.VM.ADE/#recommendation","text":"Consider using Azure Disk Encryption (ADE) to protect VM disks from being downloaded and accessed offline.","title":"Recommendation"},{"location":"en/rules/Azure.VM.ADE/#links","text":"Data encryption in Azure Creating and configuring a key vault for Azure Disk Encryption Azure Disk Encryption scenarios on Windows VMs","title":"Links"},{"location":"en/rules/Azure.VM.ASAlignment/","tags":["Azure.VM.ASAlignment","AZR-000254"],"text":"Use aligned availability sets # Azure.VM.ASAlignment AZR-000254 Error Reliability \u00b7 Virtual Machine \u00b7 2020_06 Use availability sets aligned with managed disks fault domains. Description # Availability sets can be configured to align with managed disk fault domains. When aligned, the fault domain for storage is co-located with compute. Aligned availability sets help prevent compute and storage from a single VM spanning multiple fault domains. Recommendation # Consider deploying VMs with managed disks into aligned availability sets. Links # Availability sets Managed disk integration with availability sets Reliability checklist","title":"Azure.VM.ASAlignment"},{"location":"en/rules/Azure.VM.ASAlignment/#use-aligned-availability-sets","text":"Azure.VM.ASAlignment AZR-000254 Error Reliability \u00b7 Virtual Machine \u00b7 2020_06 Use availability sets aligned with managed disks fault domains.","title":"Use aligned availability sets"},{"location":"en/rules/Azure.VM.ASAlignment/#description","text":"Availability sets can be configured to align with managed disk fault domains. When aligned, the fault domain for storage is co-located with compute. Aligned availability sets help prevent compute and storage from a single VM spanning multiple fault domains.","title":"Description"},{"location":"en/rules/Azure.VM.ASAlignment/#recommendation","text":"Consider deploying VMs with managed disks into aligned availability sets.","title":"Recommendation"},{"location":"en/rules/Azure.VM.ASAlignment/#links","text":"Availability sets Managed disk integration with availability sets Reliability checklist","title":"Links"},{"location":"en/rules/Azure.VM.ASMinMembers/","tags":["Azure.VM.ASMinMembers","AZR-000255"],"text":"Use availability sets with at least two members # Azure.VM.ASMinMembers AZR-000255 Error Reliability \u00b7 Virtual Machine \u00b7 2020_06 Availability sets should be deployed with at least two virtual machines (VMs). Description # An availability set is a logical grouping of VMs that allows Azure to optimize the placement of VMs. Azure uses this grouping to separate VMs within the availablity set across fault and update domains. Each VM in your availability set is assigned an update domain and a fault domain. VMs in different update and fault domains is mapped to different underlying physical hardware. The reason for doing this is to improve reliability by removing some single points of failure. Deploy two or more VMs within an availability set to provide for a highly available application. There is no cost for the Availability Set itself, you only pay for each VM instance that you create. Recommendation # Consider deploying at least two VMs within an availability set to gain availability benefits. Notes # This rule applies when analyzing resources deployed to Azure (in-flight). Links # Reliability checklist Availability sets overview Availability options for virtual machines in Azure Failure mode analysis Tutorial: Create and deploy highly available virtual machines with Azure PowerShell","title":"Azure.VM.ASMinMembers"},{"location":"en/rules/Azure.VM.ASMinMembers/#use-availability-sets-with-at-least-two-members","text":"Azure.VM.ASMinMembers AZR-000255 Error Reliability \u00b7 Virtual Machine \u00b7 2020_06 Availability sets should be deployed with at least two virtual machines (VMs).","title":"Use availability sets with at least two members"},{"location":"en/rules/Azure.VM.ASMinMembers/#description","text":"An availability set is a logical grouping of VMs that allows Azure to optimize the placement of VMs. Azure uses this grouping to separate VMs within the availablity set across fault and update domains. Each VM in your availability set is assigned an update domain and a fault domain. VMs in different update and fault domains is mapped to different underlying physical hardware. The reason for doing this is to improve reliability by removing some single points of failure. Deploy two or more VMs within an availability set to provide for a highly available application. There is no cost for the Availability Set itself, you only pay for each VM instance that you create.","title":"Description"},{"location":"en/rules/Azure.VM.ASMinMembers/#recommendation","text":"Consider deploying at least two VMs within an availability set to gain availability benefits.","title":"Recommendation"},{"location":"en/rules/Azure.VM.ASMinMembers/#notes","text":"This rule applies when analyzing resources deployed to Azure (in-flight).","title":"Notes"},{"location":"en/rules/Azure.VM.ASMinMembers/#links","text":"Reliability checklist Availability sets overview Availability options for virtual machines in Azure Failure mode analysis Tutorial: Create and deploy highly available virtual machines with Azure PowerShell","title":"Links"},{"location":"en/rules/Azure.VM.ASName/","tags":["Azure.VM.ASName","AZR-000256"],"text":"Use valid Availability Set names # Azure.VM.ASName AZR-000256 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Availability Set names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Availability Set names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Availability Set names must be unique within a resource group. Recommendation # Consider using names that meet Availability Set naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Availability Set names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.VM.ASName"},{"location":"en/rules/Azure.VM.ASName/#use-valid-availability-set-names","text":"Azure.VM.ASName AZR-000256 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Availability Set names should meet naming requirements.","title":"Use valid Availability Set names"},{"location":"en/rules/Azure.VM.ASName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Availability Set names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Availability Set names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.VM.ASName/#recommendation","text":"Consider using names that meet Availability Set naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.VM.ASName/#notes","text":"This rule does not check if Availability Set names are unique.","title":"Notes"},{"location":"en/rules/Azure.VM.ASName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.VM.AcceleratedNetworking/","tags":["Azure.VM.AcceleratedNetworking","AZR-000244"],"text":"Use accelerated networking # Azure.VM.AcceleratedNetworking AZR-000244 Error Performance Efficiency \u00b7 Virtual Machine \u00b7 2020_06 Use accelerated networking for supported operating systems and VM types. Description # Enabling accelerated networking for a virtual machine (VM) greatly improves networking performance. Accelerated networking work by enabling single root I/O virtualization (SR-IOV) to a VM. SR-IOV reduces latency, jitter, and CPU utilization network demanding workloads. Accelerated networking is available for supported operating systems and VM types. Recommendation # Consider enabling accelerated networking for supported operating systems and VM types. Links # Create a Linux virtual machine with Accelerated Networking using Azure CLI Create a Windows VM with accelerated networking using Azure PowerShell","title":"Azure.VM.AcceleratedNetworking"},{"location":"en/rules/Azure.VM.AcceleratedNetworking/#use-accelerated-networking","text":"Azure.VM.AcceleratedNetworking AZR-000244 Error Performance Efficiency \u00b7 Virtual Machine \u00b7 2020_06 Use accelerated networking for supported operating systems and VM types.","title":"Use accelerated networking"},{"location":"en/rules/Azure.VM.AcceleratedNetworking/#description","text":"Enabling accelerated networking for a virtual machine (VM) greatly improves networking performance. Accelerated networking work by enabling single root I/O virtualization (SR-IOV) to a VM. SR-IOV reduces latency, jitter, and CPU utilization network demanding workloads. Accelerated networking is available for supported operating systems and VM types.","title":"Description"},{"location":"en/rules/Azure.VM.AcceleratedNetworking/#recommendation","text":"Consider enabling accelerated networking for supported operating systems and VM types.","title":"Recommendation"},{"location":"en/rules/Azure.VM.AcceleratedNetworking/#links","text":"Create a Linux virtual machine with Accelerated Networking using Azure CLI Create a Windows VM with accelerated networking using Azure PowerShell","title":"Links"},{"location":"en/rules/Azure.VM.Agent/","tags":["Azure.VM.Agent","AZR-000246"],"text":"VM agent is provisioned automatically # Azure.VM.Agent AZR-000246 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Ensure the VM agent is provisioned automatically. Description # The virtual machine (VM) agent is required for most functionality that interacts with the guest operating system. VM extensions help reduce management overhead by providing an entry point to bootstrap monitoring and configuration of the guest operating system. The VM agent is required to use any VM extensions. Recommendation # Automatically provision the VM agent for all supported operating systems, this is the default.","title":"Azure.VM.Agent"},{"location":"en/rules/Azure.VM.Agent/#vm-agent-is-provisioned-automatically","text":"Azure.VM.Agent AZR-000246 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Ensure the VM agent is provisioned automatically.","title":"VM agent is provisioned automatically"},{"location":"en/rules/Azure.VM.Agent/#description","text":"The virtual machine (VM) agent is required for most functionality that interacts with the guest operating system. VM extensions help reduce management overhead by providing an entry point to bootstrap monitoring and configuration of the guest operating system. The VM agent is required to use any VM extensions.","title":"Description"},{"location":"en/rules/Azure.VM.Agent/#recommendation","text":"Automatically provision the VM agent for all supported operating systems, this is the default.","title":"Recommendation"},{"location":"en/rules/Azure.VM.BasicSku/","tags":["Azure.VM.BasicSku","AZR-000241"],"text":"Avoid Basic VM SKU # Azure.VM.BasicSku AZR-000241 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Virtual machines (VMs) should not use Basic sizes. Description # VMs can be deployed in Basic or Standard sizes. Basic VM sizes are suitable only for entry level development scenarios. Recommendation # Basic VM sizes are not suitable for production workloads or intensive development workloads. Consider migration to an alternative Standard VM size. Links # Sizes for Windows virtual machines in Azure Sizes for Linux virtual machines in Azure","title":"Azure.VM.BasicSku"},{"location":"en/rules/Azure.VM.BasicSku/#avoid-basic-vm-sku","text":"Azure.VM.BasicSku AZR-000241 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Virtual machines (VMs) should not use Basic sizes.","title":"Avoid Basic VM SKU"},{"location":"en/rules/Azure.VM.BasicSku/#description","text":"VMs can be deployed in Basic or Standard sizes. Basic VM sizes are suitable only for entry level development scenarios.","title":"Description"},{"location":"en/rules/Azure.VM.BasicSku/#recommendation","text":"Basic VM sizes are not suitable for production workloads or intensive development workloads. Consider migration to an alternative Standard VM size.","title":"Recommendation"},{"location":"en/rules/Azure.VM.BasicSku/#links","text":"Sizes for Windows virtual machines in Azure Sizes for Linux virtual machines in Azure","title":"Links"},{"location":"en/rules/Azure.VM.ComputerName/","tags":["Azure.VM.ComputerName","AZR-000249"],"text":"Use valid VM computer names # Azure.VM.ComputerName AZR-000249 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Virtual Machine (VM) computer name should meet naming requirements. Description # When configuring Azure VMs the assigned computer name must meet operation system (OS) requirements. The requirements for Windows VMs are: Between 1 and 15 characters long. Alphanumerics, and hyphens. Can not include only numbers. The requirements for Linux VMs are: Between 1 and 64 characters long. Alphanumerics, periods, and hyphens. Start with alphanumeric. Recommendation # Consider using computer names that meet OS naming requirements. Additionally, consider using computer names that match the VM resource name. Notes # VM resource names have different naming restrictions. See Azure.VM.Name for details. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.VM.ComputerName"},{"location":"en/rules/Azure.VM.ComputerName/#use-valid-vm-computer-names","text":"Azure.VM.ComputerName AZR-000249 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Virtual Machine (VM) computer name should meet naming requirements.","title":"Use valid VM computer names"},{"location":"en/rules/Azure.VM.ComputerName/#description","text":"When configuring Azure VMs the assigned computer name must meet operation system (OS) requirements. The requirements for Windows VMs are: Between 1 and 15 characters long. Alphanumerics, and hyphens. Can not include only numbers. The requirements for Linux VMs are: Between 1 and 64 characters long. Alphanumerics, periods, and hyphens. Start with alphanumeric.","title":"Description"},{"location":"en/rules/Azure.VM.ComputerName/#recommendation","text":"Consider using computer names that meet OS naming requirements. Additionally, consider using computer names that match the VM resource name.","title":"Recommendation"},{"location":"en/rules/Azure.VM.ComputerName/#notes","text":"VM resource names have different naming restrictions. See Azure.VM.Name for details.","title":"Notes"},{"location":"en/rules/Azure.VM.ComputerName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.VM.DiskAttached/","tags":["Azure.VM.DiskAttached","AZR-000250"],"text":"Remove unused managed disks # Azure.VM.DiskAttached AZR-000250 Error Cost Optimization \u00b7 Virtual Machine \u00b7 2020_06 Managed disks should be attached to virtual machines or removed. Description # Unattached managed disks are charged but not in use. Unattached managed disks still consume storage and are charged on their size. Recommendation # Consider removing managed disks that are no longer required to reduce complexity and costs. Links # Managed Disk pricing","title":"Azure.VM.DiskAttached"},{"location":"en/rules/Azure.VM.DiskAttached/#remove-unused-managed-disks","text":"Azure.VM.DiskAttached AZR-000250 Error Cost Optimization \u00b7 Virtual Machine \u00b7 2020_06 Managed disks should be attached to virtual machines or removed.","title":"Remove unused managed disks"},{"location":"en/rules/Azure.VM.DiskAttached/#description","text":"Unattached managed disks are charged but not in use. Unattached managed disks still consume storage and are charged on their size.","title":"Description"},{"location":"en/rules/Azure.VM.DiskAttached/#recommendation","text":"Consider removing managed disks that are no longer required to reduce complexity and costs.","title":"Recommendation"},{"location":"en/rules/Azure.VM.DiskAttached/#links","text":"Managed Disk pricing","title":"Links"},{"location":"en/rules/Azure.VM.DiskCaching/","tags":["Azure.VM.DiskCaching","AZR-000242"],"text":"Configure host caching # Azure.VM.DiskCaching AZR-000242 Error Performance Efficiency \u00b7 Virtual Machine \u00b7 2020_06 Check disk caching is configured correctly for the workload. Description # Check disk caching is configured correctly for the workload. Recommendation # Check disk caching is configured correctly for the workload.","title":"Azure.VM.DiskCaching"},{"location":"en/rules/Azure.VM.DiskCaching/#configure-host-caching","text":"Azure.VM.DiskCaching AZR-000242 Error Performance Efficiency \u00b7 Virtual Machine \u00b7 2020_06 Check disk caching is configured correctly for the workload.","title":"Configure host caching"},{"location":"en/rules/Azure.VM.DiskCaching/#description","text":"Check disk caching is configured correctly for the workload.","title":"Description"},{"location":"en/rules/Azure.VM.DiskCaching/#recommendation","text":"Check disk caching is configured correctly for the workload.","title":"Recommendation"},{"location":"en/rules/Azure.VM.DiskName/","tags":["Azure.VM.DiskName","AZR-000253"],"text":"Use valid Managed Disk names # Azure.VM.DiskName AZR-000253 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Managed Disk names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Managed Disk names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Managed Disk names must be unique within a resource group. Recommendation # Consider using names that meet Managed Disk naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Managed Disk names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.VM.DiskName"},{"location":"en/rules/Azure.VM.DiskName/#use-valid-managed-disk-names","text":"Azure.VM.DiskName AZR-000253 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Managed Disk names should meet naming requirements.","title":"Use valid Managed Disk names"},{"location":"en/rules/Azure.VM.DiskName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Managed Disk names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Managed Disk names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.VM.DiskName/#recommendation","text":"Consider using names that meet Managed Disk naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.VM.DiskName/#notes","text":"This rule does not check if Managed Disk names are unique.","title":"Notes"},{"location":"en/rules/Azure.VM.DiskName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.VM.DiskSizeAlignment/","tags":["Azure.VM.DiskSizeAlignment","AZR-000251"],"text":"Allocate VM disks aligned to billing model # Azure.VM.DiskSizeAlignment AZR-000251 Error Cost Optimization \u00b7 Virtual Machine \u00b7 2020_06 Align to the Managed Disk billing model to improve cost efficiency. Description # Managed disk is smaller than SKU size. Recommendation # Consider resizing or optimizing storage to reduce waste by using disk sizes that align to the billing model for Managed Disks. Also consider, sizing and striping disks to optimize performance. Links # Managed Disks pricing","title":"Azure.VM.DiskSizeAlignment"},{"location":"en/rules/Azure.VM.DiskSizeAlignment/#allocate-vm-disks-aligned-to-billing-model","text":"Azure.VM.DiskSizeAlignment AZR-000251 Error Cost Optimization \u00b7 Virtual Machine \u00b7 2020_06 Align to the Managed Disk billing model to improve cost efficiency.","title":"Allocate VM disks aligned to billing model"},{"location":"en/rules/Azure.VM.DiskSizeAlignment/#description","text":"Managed disk is smaller than SKU size.","title":"Description"},{"location":"en/rules/Azure.VM.DiskSizeAlignment/#recommendation","text":"Consider resizing or optimizing storage to reduce waste by using disk sizes that align to the billing model for Managed Disks. Also consider, sizing and striping disks to optimize performance.","title":"Recommendation"},{"location":"en/rules/Azure.VM.DiskSizeAlignment/#links","text":"Managed Disks pricing","title":"Links"},{"location":"en/rules/Azure.VM.NICAttached/","tags":["Azure.VM.NICAttached","AZR-000257"],"text":"Attach NIC or clean up # Azure.VM.NICAttached AZR-000257 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Network interfaces (NICs) should be attached. Description # Network interfaces (NICs) are used to attach services to a virtual network. Each NIC is deployed as a separate resource, however are intended to be used with a related service. A NIC that is not attached to a related service perform no purpose. Example of services that use NICs include: Virtual Machines Private Endpoints Recommendation # Consider cleaning up NICs that are not required to reduce management complexity. Also consider using Resource Groups to help manage the lifecycle of related resources together. Links # Azure template reference","title":"Azure.VM.NICAttached"},{"location":"en/rules/Azure.VM.NICAttached/#attach-nic-or-clean-up","text":"Azure.VM.NICAttached AZR-000257 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Network interfaces (NICs) should be attached.","title":"Attach NIC or clean up"},{"location":"en/rules/Azure.VM.NICAttached/#description","text":"Network interfaces (NICs) are used to attach services to a virtual network. Each NIC is deployed as a separate resource, however are intended to be used with a related service. A NIC that is not attached to a related service perform no purpose. Example of services that use NICs include: Virtual Machines Private Endpoints","title":"Description"},{"location":"en/rules/Azure.VM.NICAttached/#recommendation","text":"Consider cleaning up NICs that are not required to reduce management complexity. Also consider using Resource Groups to help manage the lifecycle of related resources together.","title":"Recommendation"},{"location":"en/rules/Azure.VM.NICAttached/#links","text":"Azure template reference","title":"Links"},{"location":"en/rules/Azure.VM.NICName/","tags":["Azure.VM.NICName","AZR-000259"],"text":"Use valid NIC names # Azure.VM.NICName AZR-000259 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Network Interface (NIC) names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Network Interface names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. NIC names must be unique within a resource group. Recommendation # Consider using names that meet Network Interface naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Network Interface names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.VM.NICName"},{"location":"en/rules/Azure.VM.NICName/#use-valid-nic-names","text":"Azure.VM.NICName AZR-000259 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Network Interface (NIC) names should meet naming requirements.","title":"Use valid NIC names"},{"location":"en/rules/Azure.VM.NICName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Network Interface names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. NIC names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.VM.NICName/#recommendation","text":"Consider using names that meet Network Interface naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.VM.NICName/#notes","text":"This rule does not check if Network Interface names are unique.","title":"Notes"},{"location":"en/rules/Azure.VM.NICName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.VM.Name/","tags":["Azure.VM.Name","AZR-000248"],"text":"Use valid VM names # Azure.VM.Name AZR-000248 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Virtual Machine (VM) names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for VM names are: Between 1 and 64 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. VM names must be unique within a resource group. Recommendation # Consider using names that meet VM resource name requirements. Additionally, consider using a resource name that meeting OS naming requirements. Notes # This rule does not check if VM names are unique. Additionally, VM computer names have additional restrictions. See Azure.VM.ComputerName for details. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.VM.Name"},{"location":"en/rules/Azure.VM.Name/#use-valid-vm-names","text":"Azure.VM.Name AZR-000248 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Virtual Machine (VM) names should meet naming requirements.","title":"Use valid VM names"},{"location":"en/rules/Azure.VM.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for VM names are: Between 1 and 64 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. VM names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.VM.Name/#recommendation","text":"Consider using names that meet VM resource name requirements. Additionally, consider using a resource name that meeting OS naming requirements.","title":"Recommendation"},{"location":"en/rules/Azure.VM.Name/#notes","text":"This rule does not check if VM names are unique. Additionally, VM computer names have additional restrictions. See Azure.VM.ComputerName for details.","title":"Notes"},{"location":"en/rules/Azure.VM.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.VM.PPGName/","tags":["Azure.VM.PPGName","AZR-000260"],"text":"Use valid PPG names # Azure.VM.PPGName AZR-000260 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Proximity Placement Group (PPG) names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for placement groups names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start and end with alphanumeric. PPG names must be unique within a resource group. Recommendation # Consider using names that meet Proximity Placement Group naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Proximity Placement Group names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.VM.PPGName"},{"location":"en/rules/Azure.VM.PPGName/#use-valid-ppg-names","text":"Azure.VM.PPGName AZR-000260 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Proximity Placement Group (PPG) names should meet naming requirements.","title":"Use valid PPG names"},{"location":"en/rules/Azure.VM.PPGName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for placement groups names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start and end with alphanumeric. PPG names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.VM.PPGName/#recommendation","text":"Consider using names that meet Proximity Placement Group naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.VM.PPGName/#notes","text":"This rule does not check if Proximity Placement Group names are unique.","title":"Notes"},{"location":"en/rules/Azure.VM.PPGName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.VM.PromoSku/","tags":["Azure.VM.PromoSku","AZR-000240"],"text":"Use current VM SKUs # Azure.VM.PromoSku AZR-000240 Error Cost Optimization \u00b7 Virtual Machine \u00b7 2020_06 Virtual machines (VMs) should not use expired promotional SKU. Description # Some VM sizes may offer promotional rates that can be used by deploying VMs with a designated SKU. Promotional rates expire, and while this does not cause interruption to running VMs, the rate that VMs are billed at returns to the original price. Promo SKUs are not eligible for savings from reserved instances. Expired promo SKUs may confuse billing reconciliation when the promotional period expires. VMs should not use expired promo SKU. Recommendation # Consider moving from promotional SKUs to SKUs eligible for reserved instances for VMs with an extended life cycle. Consider moving from promotional SKUs to the regular SKU once the promotional period has expired. Links # Virtual Machine pricing","title":"Azure.VM.PromoSku"},{"location":"en/rules/Azure.VM.PromoSku/#use-current-vm-skus","text":"Azure.VM.PromoSku AZR-000240 Error Cost Optimization \u00b7 Virtual Machine \u00b7 2020_06 Virtual machines (VMs) should not use expired promotional SKU.","title":"Use current VM SKUs"},{"location":"en/rules/Azure.VM.PromoSku/#description","text":"Some VM sizes may offer promotional rates that can be used by deploying VMs with a designated SKU. Promotional rates expire, and while this does not cause interruption to running VMs, the rate that VMs are billed at returns to the original price. Promo SKUs are not eligible for savings from reserved instances. Expired promo SKUs may confuse billing reconciliation when the promotional period expires. VMs should not use expired promo SKU.","title":"Description"},{"location":"en/rules/Azure.VM.PromoSku/#recommendation","text":"Consider moving from promotional SKUs to SKUs eligible for reserved instances for VMs with an extended life cycle. Consider moving from promotional SKUs to the regular SKU once the promotional period has expired.","title":"Recommendation"},{"location":"en/rules/Azure.VM.PromoSku/#links","text":"Virtual Machine pricing","title":"Links"},{"location":"en/rules/Azure.VM.PublicKey/","tags":["Azure.VM.PublicKey","AZR-000245"],"text":"Use public keys for Linux # Azure.VM.PublicKey AZR-000245 Error Security \u00b7 Virtual Machine \u00b7 2020_06 Linux virtual machines should use public keys. Description # Linux virtual machines support either password or public key based authentication for the default administrator account. Recommendation # Consider using public key based authentication instead of passwords.","title":"Azure.VM.PublicKey"},{"location":"en/rules/Azure.VM.PublicKey/#use-public-keys-for-linux","text":"Azure.VM.PublicKey AZR-000245 Error Security \u00b7 Virtual Machine \u00b7 2020_06 Linux virtual machines should use public keys.","title":"Use public keys for Linux"},{"location":"en/rules/Azure.VM.PublicKey/#description","text":"Linux virtual machines support either password or public key based authentication for the default administrator account.","title":"Description"},{"location":"en/rules/Azure.VM.PublicKey/#recommendation","text":"Consider using public key based authentication instead of passwords.","title":"Recommendation"},{"location":"en/rules/Azure.VM.Standalone/","tags":["Azure.VM.Standalone","AZR-000239"],"text":"Standalone Virtual Machine # Azure.VM.Standalone AZR-000239 Error Reliability \u00b7 Virtual Machine \u00b7 2020_06 Use VM features to increase reliability and improve covered SLA for VM configurations. Description # All VM configurations within Azure offer an SLA. However, the SLA provided and the overall availability of the system varies depending on the configuration. First, consider performing a Failure Mode Analysis (FMA) of the system. A FMA is the process of analyzing the system to determine the possible failure points. For Virtual Machines (VMs), running a single instance is often a single point of failure. In many but not all cases, the number of VMs can be increased to add redundancy to the system. Taking advantage of some of the features of Azure can further increase the availability of the system. Availability Zones (AZ) - is a physically separate zone, within an Azure region. Each Availability Zone has a distinct power source, network, and cooling. Availability Sets - is a logical grouping of VMs that allows Azure to understand how your application is built. By understanding the distinct tiers of the application, Azure can better organize compute and storage to improve availability. Solid State Storage (SSD) Disks - high performance block-level storage with three replicas of your data. Recommendation # Consider using availability zones/ sets or only premium/ ultra disks to improve SLA. Examples # Configure with Azure template # To deploy VMs that pass this rule with on of the following: Deploy the VM in an Availability Set by specifying properties.availabilitySet.id in code. Deploy the VM in an Availability Zone by specifying zones with 1 , 2 , or 3 in code. Deploy the VM using only premium disks for OS and data disks by specifying storageAccountType as Premium_LRS . For example: { \"type\" : \"Microsoft.Compute/virtualMachines\" , \"apiVersion\" : \"2022-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"zones\" : [ \"1\" ], \"properties\" : { \"hardwareProfile\" : { \"vmSize\" : \"Standard_D2s_v3\" }, \"osProfile\" : { \"computerName\" : \"[parameters('name')]\" , \"adminUsername\" : \"[parameters('adminUsername')]\" , \"adminPassword\" : \"[parameters('adminPassword')]\" }, \"storageProfile\" : { \"imageReference\" : { \"publisher\" : \"MicrosoftWindowsServer\" , \"offer\" : \"WindowsServer\" , \"sku\" : \"[parameters('sku')]\" , \"version\" : \"latest\" }, \"osDisk\" : { \"name\" : \"[format('{0}-disk0', parameters('name'))]\" , \"caching\" : \"ReadWrite\" , \"createOption\" : \"FromImage\" , \"managedDisk\" : { \"storageAccountType\" : \"Premium_LRS\" } } }, \"licenseType\" : \"Windows_Server\" , \"networkProfile\" : { \"networkInterfaces\" : [ { \"id\" : \"[resourceId('Microsoft.Network/networkInterfaces', format('{0}-nic0', parameters('name')))]\" } ] } }, \"dependsOn\" : [ \"[resourceId('Microsoft.Network/networkInterfaces', format('{0}-nic0', parameters('name')))]\" ] } Configure with Bicep # To deploy VMs that pass this rule with on of the following: Deploy the VM in an Availability Set by specifying properties.availabilitySet.id in code. Deploy the VM in an Availability Zone by specifying zones with 1 , 2 , or 3 in code. Deploy the VM using only premium disks for OS and data disks by specifying storageAccountType as Premium_LRS . For example: resource vm1 'Microsoft.Compute/virtualMachines@2022-03-01' = { name: name location: location zones: [ '1' ] properties: { hardwareProfile: { vmSize: 'Standard_D2s_v3' } osProfile: { computerName: name adminUsername: adminUsername adminPassword: adminPassword } storageProfile: { imageReference: { publisher: 'MicrosoftWindowsServer' offer: 'WindowsServer' sku: sku version: 'latest' } osDisk: { name: '${name}-disk0' caching: 'ReadWrite' createOption: 'FromImage' managedDisk: { storageAccountType: 'Premium_LRS' } } } licenseType: 'Windows_Server' networkProfile: { networkInterfaces: [ { id: nic.id } ] } } } Links # Meet application platform requirements Virtual Machine SLA Availability options for virtual machines in Azure Manage the availability of Windows virtual machines in Azure Manage the availability of Linux virtual machines","title":"Azure.VM.Standalone"},{"location":"en/rules/Azure.VM.Standalone/#standalone-virtual-machine","text":"Azure.VM.Standalone AZR-000239 Error Reliability \u00b7 Virtual Machine \u00b7 2020_06 Use VM features to increase reliability and improve covered SLA for VM configurations.","title":"Standalone Virtual Machine"},{"location":"en/rules/Azure.VM.Standalone/#description","text":"All VM configurations within Azure offer an SLA. However, the SLA provided and the overall availability of the system varies depending on the configuration. First, consider performing a Failure Mode Analysis (FMA) of the system. A FMA is the process of analyzing the system to determine the possible failure points. For Virtual Machines (VMs), running a single instance is often a single point of failure. In many but not all cases, the number of VMs can be increased to add redundancy to the system. Taking advantage of some of the features of Azure can further increase the availability of the system. Availability Zones (AZ) - is a physically separate zone, within an Azure region. Each Availability Zone has a distinct power source, network, and cooling. Availability Sets - is a logical grouping of VMs that allows Azure to understand how your application is built. By understanding the distinct tiers of the application, Azure can better organize compute and storage to improve availability. Solid State Storage (SSD) Disks - high performance block-level storage with three replicas of your data.","title":"Description"},{"location":"en/rules/Azure.VM.Standalone/#recommendation","text":"Consider using availability zones/ sets or only premium/ ultra disks to improve SLA.","title":"Recommendation"},{"location":"en/rules/Azure.VM.Standalone/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.VM.Standalone/#configure-with-azure-template","text":"To deploy VMs that pass this rule with on of the following: Deploy the VM in an Availability Set by specifying properties.availabilitySet.id in code. Deploy the VM in an Availability Zone by specifying zones with 1 , 2 , or 3 in code. Deploy the VM using only premium disks for OS and data disks by specifying storageAccountType as Premium_LRS . For example: { \"type\" : \"Microsoft.Compute/virtualMachines\" , \"apiVersion\" : \"2022-03-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"zones\" : [ \"1\" ], \"properties\" : { \"hardwareProfile\" : { \"vmSize\" : \"Standard_D2s_v3\" }, \"osProfile\" : { \"computerName\" : \"[parameters('name')]\" , \"adminUsername\" : \"[parameters('adminUsername')]\" , \"adminPassword\" : \"[parameters('adminPassword')]\" }, \"storageProfile\" : { \"imageReference\" : { \"publisher\" : \"MicrosoftWindowsServer\" , \"offer\" : \"WindowsServer\" , \"sku\" : \"[parameters('sku')]\" , \"version\" : \"latest\" }, \"osDisk\" : { \"name\" : \"[format('{0}-disk0', parameters('name'))]\" , \"caching\" : \"ReadWrite\" , \"createOption\" : \"FromImage\" , \"managedDisk\" : { \"storageAccountType\" : \"Premium_LRS\" } } }, \"licenseType\" : \"Windows_Server\" , \"networkProfile\" : { \"networkInterfaces\" : [ { \"id\" : \"[resourceId('Microsoft.Network/networkInterfaces', format('{0}-nic0', parameters('name')))]\" } ] } }, \"dependsOn\" : [ \"[resourceId('Microsoft.Network/networkInterfaces', format('{0}-nic0', parameters('name')))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.VM.Standalone/#configure-with-bicep","text":"To deploy VMs that pass this rule with on of the following: Deploy the VM in an Availability Set by specifying properties.availabilitySet.id in code. Deploy the VM in an Availability Zone by specifying zones with 1 , 2 , or 3 in code. Deploy the VM using only premium disks for OS and data disks by specifying storageAccountType as Premium_LRS . For example: resource vm1 'Microsoft.Compute/virtualMachines@2022-03-01' = { name: name location: location zones: [ '1' ] properties: { hardwareProfile: { vmSize: 'Standard_D2s_v3' } osProfile: { computerName: name adminUsername: adminUsername adminPassword: adminPassword } storageProfile: { imageReference: { publisher: 'MicrosoftWindowsServer' offer: 'WindowsServer' sku: sku version: 'latest' } osDisk: { name: '${name}-disk0' caching: 'ReadWrite' createOption: 'FromImage' managedDisk: { storageAccountType: 'Premium_LRS' } } } licenseType: 'Windows_Server' networkProfile: { networkInterfaces: [ { id: nic.id } ] } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.VM.Standalone/#links","text":"Meet application platform requirements Virtual Machine SLA Availability options for virtual machines in Azure Manage the availability of Windows virtual machines in Azure Manage the availability of Linux virtual machines","title":"Links"},{"location":"en/rules/Azure.VM.UniqueDns/","tags":["Azure.VM.UniqueDns","AZR-000258"],"text":"NICs with custom DNS settings # Azure.VM.UniqueDns AZR-000258 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Network interfaces (NICs) should inherit DNS from virtual networks. Description # By default Virtual machine (VM) NICs automatically use a DNS configuration inherited from the virtual network they connect to. Optionally, DNS servers can be overridden on a per NIC basis with a custom configuration. Using network interfaces with individual DNS server settings may increase management overhead and complexity. Recommendation # Consider updating NIC DNS server settings to inherit from virtual network. Links # Change DNS servers .","title":"Azure.VM.UniqueDns"},{"location":"en/rules/Azure.VM.UniqueDns/#nics-with-custom-dns-settings","text":"Azure.VM.UniqueDns AZR-000258 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Network interfaces (NICs) should inherit DNS from virtual networks.","title":"NICs with custom DNS settings"},{"location":"en/rules/Azure.VM.UniqueDns/#description","text":"By default Virtual machine (VM) NICs automatically use a DNS configuration inherited from the virtual network they connect to. Optionally, DNS servers can be overridden on a per NIC basis with a custom configuration. Using network interfaces with individual DNS server settings may increase management overhead and complexity.","title":"Description"},{"location":"en/rules/Azure.VM.UniqueDns/#recommendation","text":"Consider updating NIC DNS server settings to inherit from virtual network.","title":"Recommendation"},{"location":"en/rules/Azure.VM.UniqueDns/#links","text":"Change DNS servers .","title":"Links"},{"location":"en/rules/Azure.VM.Updates/","tags":["Azure.VM.Updates","AZR-000247"],"text":"Automatic updates are enabled # Azure.VM.Updates AZR-000247 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Ensure automatic updates are enabled at deployment. Description # Window virtual machines (VMs) have automatic updates turned on at deployment time by default. The option can be enabled/ disabled at deployment time or updated for VM scale sets. Enabling this option does not prevent automatic updates being disabled or reconfigured within the operating system after deployment. Recommendation # Enable automatic updates at deployment time, then reconfigure as required to meet patch management requirements.","title":"Azure.VM.Updates"},{"location":"en/rules/Azure.VM.Updates/#automatic-updates-are-enabled","text":"Azure.VM.Updates AZR-000247 Error Operational Excellence \u00b7 Virtual Machine \u00b7 2020_06 Ensure automatic updates are enabled at deployment.","title":"Automatic updates are enabled"},{"location":"en/rules/Azure.VM.Updates/#description","text":"Window virtual machines (VMs) have automatic updates turned on at deployment time by default. The option can be enabled/ disabled at deployment time or updated for VM scale sets. Enabling this option does not prevent automatic updates being disabled or reconfigured within the operating system after deployment.","title":"Description"},{"location":"en/rules/Azure.VM.Updates/#recommendation","text":"Enable automatic updates at deployment time, then reconfigure as required to meet patch management requirements.","title":"Recommendation"},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/","tags":["Azure.VM.UseHybridUseBenefit","AZR-000243"],"text":"Use Azure Hybrid Benefit # Azure.VM.UseHybridUseBenefit AZR-000243 Error Cost Optimization \u00b7 Virtual Machine \u00b7 2020_06 Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Description # Azure Hybrid Benefit is a licensing benefit that helps you to reduce costs of running virtual machine (VM) workloads. Recommendation # Consider using Azure Hybrid Benefit for eligible workloads. Examples # Configure with Azure template # To deploy VMs that pass this rule: Set the properties.licenseType property to one of the following: Windows_Server Windows_Client For example: { \"type\" : \"Microsoft.Compute/virtualMachines\" , \"apiVersion\" : \"2021-07-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"hardwareProfile\" : { \"vmSize\" : \"Standard_D2s_v3\" }, \"osProfile\" : { \"computerName\" : \"[parameters('name')]\" , \"adminUsername\" : \"[parameters('adminUsername')]\" , \"adminPassword\" : \"[parameters('adminPassword')]\" }, \"storageProfile\" : { \"imageReference\" : { \"publisher\" : \"MicrosoftWindowsServer\" , \"offer\" : \"WindowsServer\" , \"sku\" : \"[parameters('sku')]\" , \"version\" : \"latest\" }, \"osDisk\" : { \"name\" : \"[format('{0}-disk0', parameters('name'))]\" , \"caching\" : \"ReadWrite\" , \"createOption\" : \"FromImage\" } }, \"licenseType\" : \"Windows_Server\" , \"networkProfile\" : { \"networkInterfaces\" : [ { \"id\" : \"[resourceId('Microsoft.Network/networkInterfaces', format('{0}-nic0', parameters('name')))]\" } ] } }, \"dependsOn\" : [ \"[resourceId('Microsoft.Network/networkInterfaces', format('{0}-nic0', parameters('name')))]\" ] } Configure with Bicep # To deploy VMs that pass this rule: Set the properties.licenseType property to one of the following: Windows_Server Windows_Client For example: resource vm 'Microsoft.Compute/virtualMachines@2021-07-01' = { name: name location: location properties: { hardwareProfile: { vmSize: 'Standard_D2s_v3' } osProfile: { computerName: name adminUsername: adminUsername adminPassword: adminPassword } storageProfile: { imageReference: { publisher: 'MicrosoftWindowsServer' offer: 'WindowsServer' sku: sku version: 'latest' } osDisk: { name: '${name}-disk0' caching: 'ReadWrite' createOption: 'FromImage' } } licenseType: 'Windows_Server' networkProfile: { networkInterfaces: [ { id: nic.id } ] } } } Configure with Azure CLI # az vm update -n '<name>' -g '<resource_group>' --set licenseType = Windows_Server Links # Azure Hybrid Benefit FAQ Azure Hybrid Benefit for Windows Server","title":"Azure.VM.UseHybridUseBenefit"},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/#use-azure-hybrid-benefit","text":"Azure.VM.UseHybridUseBenefit AZR-000243 Error Cost Optimization \u00b7 Virtual Machine \u00b7 2020_06 Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads.","title":"Use Azure Hybrid Benefit"},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/#description","text":"Azure Hybrid Benefit is a licensing benefit that helps you to reduce costs of running virtual machine (VM) workloads.","title":"Description"},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/#recommendation","text":"Consider using Azure Hybrid Benefit for eligible workloads.","title":"Recommendation"},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/#configure-with-azure-template","text":"To deploy VMs that pass this rule: Set the properties.licenseType property to one of the following: Windows_Server Windows_Client For example: { \"type\" : \"Microsoft.Compute/virtualMachines\" , \"apiVersion\" : \"2021-07-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"hardwareProfile\" : { \"vmSize\" : \"Standard_D2s_v3\" }, \"osProfile\" : { \"computerName\" : \"[parameters('name')]\" , \"adminUsername\" : \"[parameters('adminUsername')]\" , \"adminPassword\" : \"[parameters('adminPassword')]\" }, \"storageProfile\" : { \"imageReference\" : { \"publisher\" : \"MicrosoftWindowsServer\" , \"offer\" : \"WindowsServer\" , \"sku\" : \"[parameters('sku')]\" , \"version\" : \"latest\" }, \"osDisk\" : { \"name\" : \"[format('{0}-disk0', parameters('name'))]\" , \"caching\" : \"ReadWrite\" , \"createOption\" : \"FromImage\" } }, \"licenseType\" : \"Windows_Server\" , \"networkProfile\" : { \"networkInterfaces\" : [ { \"id\" : \"[resourceId('Microsoft.Network/networkInterfaces', format('{0}-nic0', parameters('name')))]\" } ] } }, \"dependsOn\" : [ \"[resourceId('Microsoft.Network/networkInterfaces', format('{0}-nic0', parameters('name')))]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/#configure-with-bicep","text":"To deploy VMs that pass this rule: Set the properties.licenseType property to one of the following: Windows_Server Windows_Client For example: resource vm 'Microsoft.Compute/virtualMachines@2021-07-01' = { name: name location: location properties: { hardwareProfile: { vmSize: 'Standard_D2s_v3' } osProfile: { computerName: name adminUsername: adminUsername adminPassword: adminPassword } storageProfile: { imageReference: { publisher: 'MicrosoftWindowsServer' offer: 'WindowsServer' sku: sku version: 'latest' } osDisk: { name: '${name}-disk0' caching: 'ReadWrite' createOption: 'FromImage' } } licenseType: 'Windows_Server' networkProfile: { networkInterfaces: [ { id: nic.id } ] } } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/#configure-with-azure-cli","text":"az vm update -n '<name>' -g '<resource_group>' --set licenseType = Windows_Server","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/#links","text":"Azure Hybrid Benefit FAQ Azure Hybrid Benefit for Windows Server","title":"Links"},{"location":"en/rules/Azure.VM.UseManagedDisks/","tags":["Azure.VM.UseManagedDisks","AZR-000238"],"text":"Use Managed Disks # Azure.VM.UseManagedDisks AZR-000238 Error Reliability \u00b7 Virtual Machine \u00b7 2020_06 Virtual machines (VMs) should use managed disks. Description # VMs can be configured with un-managed or managed disks. Un-managed disks, are .vhd files stored on a Storage Account that you manage as files. Managed disks allow you to managed the VM disk and the Storage Account is managed by Microsoft. Managed disks are the successor to un-managed disks and provide an number of additional features. Using managed disks reduces management of VM storage, improves durability and availability of VMs. Recommendation # Consider using managed disks for virtual machine storage. Links # Introduction to Azure managed disks","title":"Azure.VM.UseManagedDisks"},{"location":"en/rules/Azure.VM.UseManagedDisks/#use-managed-disks","text":"Azure.VM.UseManagedDisks AZR-000238 Error Reliability \u00b7 Virtual Machine \u00b7 2020_06 Virtual machines (VMs) should use managed disks.","title":"Use Managed Disks"},{"location":"en/rules/Azure.VM.UseManagedDisks/#description","text":"VMs can be configured with un-managed or managed disks. Un-managed disks, are .vhd files stored on a Storage Account that you manage as files. Managed disks allow you to managed the VM disk and the Storage Account is managed by Microsoft. Managed disks are the successor to un-managed disks and provide an number of additional features. Using managed disks reduces management of VM storage, improves durability and availability of VMs.","title":"Description"},{"location":"en/rules/Azure.VM.UseManagedDisks/#recommendation","text":"Consider using managed disks for virtual machine storage.","title":"Recommendation"},{"location":"en/rules/Azure.VM.UseManagedDisks/#links","text":"Introduction to Azure managed disks","title":"Links"},{"location":"en/rules/Azure.VMSS.ComputerName/","tags":["Azure.VMSS.ComputerName","AZR-000262"],"text":"Use valid VMSS computer names # Azure.VMSS.ComputerName AZR-000262 Error Operational Excellence \u00b7 Virtual Machine Scale Sets \u00b7 2020_06 Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Description # When configuring Azure VMSS the assigned computer name prefix must meet operation system (OS) requirements. The requirements for Windows VM instances are: Between 1 and 15 characters long. Alphanumerics, and hyphens. Can not include only numbers. The requirements for Linux VM instances are: Between 1 and 64 characters long. Alphanumerics, periods, and hyphens. Start with alphanumeric. Recommendation # Consider using computer names that meet OS naming requirements. Additionally, consider using computer names that match the VMSS resource name. Notes # VMSS resource names have different naming restrictions. See Azure.VMSS.Name for details. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.VMSS.ComputerName"},{"location":"en/rules/Azure.VMSS.ComputerName/#use-valid-vmss-computer-names","text":"Azure.VMSS.ComputerName AZR-000262 Error Operational Excellence \u00b7 Virtual Machine Scale Sets \u00b7 2020_06 Virtual Machine Scale Set (VMSS) computer name should meet naming requirements.","title":"Use valid VMSS computer names"},{"location":"en/rules/Azure.VMSS.ComputerName/#description","text":"When configuring Azure VMSS the assigned computer name prefix must meet operation system (OS) requirements. The requirements for Windows VM instances are: Between 1 and 15 characters long. Alphanumerics, and hyphens. Can not include only numbers. The requirements for Linux VM instances are: Between 1 and 64 characters long. Alphanumerics, periods, and hyphens. Start with alphanumeric.","title":"Description"},{"location":"en/rules/Azure.VMSS.ComputerName/#recommendation","text":"Consider using computer names that meet OS naming requirements. Additionally, consider using computer names that match the VMSS resource name.","title":"Recommendation"},{"location":"en/rules/Azure.VMSS.ComputerName/#notes","text":"VMSS resource names have different naming restrictions. See Azure.VMSS.Name for details.","title":"Notes"},{"location":"en/rules/Azure.VMSS.ComputerName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.VMSS.Name/","tags":["Azure.VMSS.Name","AZR-000261"],"text":"Use valid VMSS names # Azure.VMSS.Name AZR-000261 Error Operational Excellence \u00b7 Virtual Machine Scale Sets \u00b7 2020_06 Virtual Machine Scale Set (VMSS) names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for VMSS names are: Between 1 and 64 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. VM names must be unique within a resource group. Recommendation # Consider using names that meet VMSS resource name requirements. Additionally, consider using a resource name that meeting OS naming requirements. Notes # This rule does not check if VMSS names are unique. Additionally, VMSS computer names have additional restrictions. See Azure.VMSS.ComputerName for details. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.VMSS.Name"},{"location":"en/rules/Azure.VMSS.Name/#use-valid-vmss-names","text":"Azure.VMSS.Name AZR-000261 Error Operational Excellence \u00b7 Virtual Machine Scale Sets \u00b7 2020_06 Virtual Machine Scale Set (VMSS) names should meet naming requirements.","title":"Use valid VMSS names"},{"location":"en/rules/Azure.VMSS.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for VMSS names are: Between 1 and 64 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. VM names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.VMSS.Name/#recommendation","text":"Consider using names that meet VMSS resource name requirements. Additionally, consider using a resource name that meeting OS naming requirements.","title":"Recommendation"},{"location":"en/rules/Azure.VMSS.Name/#notes","text":"This rule does not check if VMSS names are unique. Additionally, VMSS computer names have additional restrictions. See Azure.VMSS.ComputerName for details.","title":"Notes"},{"location":"en/rules/Azure.VMSS.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.VNET.LocalDNS/","tags":["Azure.VNET.LocalDNS","AZR-000265"],"text":"Use local DNS servers # Azure.VNET.LocalDNS AZR-000265 Error Reliability \u00b7 Virtual Network \u00b7 2020_06 Virtual networks (VNETs) should use Azure local DNS servers. Description # Virtual networks allow one or more custom DNS servers to be specified that are inherited by connected services such as virtual machines. When configuring custom DNS server IP addresses, these servers must be accessible for name resolution to occur. Connectivity between services may be impacted if DNS server IP addresses are temporarily or permanently unavailable. Recommendation # Consider deploying redundant DNS services within a connected Azure VNET. Where possibly consider deploying Azure Private DNS Zones, a platform-as-a-service (PaaS) DNS service for VNETs. Alternatively consider deploying redundant virtual machines (VMs) or network virtual appliances (NVA) to host DNS within Azure.","title":"Azure.VNET.LocalDNS"},{"location":"en/rules/Azure.VNET.LocalDNS/#use-local-dns-servers","text":"Azure.VNET.LocalDNS AZR-000265 Error Reliability \u00b7 Virtual Network \u00b7 2020_06 Virtual networks (VNETs) should use Azure local DNS servers.","title":"Use local DNS servers"},{"location":"en/rules/Azure.VNET.LocalDNS/#description","text":"Virtual networks allow one or more custom DNS servers to be specified that are inherited by connected services such as virtual machines. When configuring custom DNS server IP addresses, these servers must be accessible for name resolution to occur. Connectivity between services may be impacted if DNS server IP addresses are temporarily or permanently unavailable.","title":"Description"},{"location":"en/rules/Azure.VNET.LocalDNS/#recommendation","text":"Consider deploying redundant DNS services within a connected Azure VNET. Where possibly consider deploying Azure Private DNS Zones, a platform-as-a-service (PaaS) DNS service for VNETs. Alternatively consider deploying redundant virtual machines (VMs) or network virtual appliances (NVA) to host DNS within Azure.","title":"Recommendation"},{"location":"en/rules/Azure.VNET.Name/","tags":["Azure.VNET.Name","AZR-000268"],"text":"Use valid VNET names # Azure.VNET.Name AZR-000268 Error Operational Excellence \u00b7 Virtual Network \u00b7 2020_06 Virtual Network (VNET) names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Virtual Network names are: Between 2 and 64 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. VNET names must be unique within a resource group. Recommendation # Consider using names that meet Virtual Network naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if Virtual Network names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Azure.VNET.Name"},{"location":"en/rules/Azure.VNET.Name/#use-valid-vnet-names","text":"Azure.VNET.Name AZR-000268 Error Operational Excellence \u00b7 Virtual Network \u00b7 2020_06 Virtual Network (VNET) names should meet naming requirements.","title":"Use valid VNET names"},{"location":"en/rules/Azure.VNET.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Virtual Network names are: Between 2 and 64 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. VNET names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.VNET.Name/#recommendation","text":"Consider using names that meet Virtual Network naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.VNET.Name/#notes","text":"This rule does not check if Virtual Network names are unique.","title":"Notes"},{"location":"en/rules/Azure.VNET.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Links"},{"location":"en/rules/Azure.VNET.PeerState/","tags":["Azure.VNET.PeerState","AZR-000266"],"text":"VNET peer is not connected # Azure.VNET.PeerState AZR-000266 Error Operational Excellence \u00b7 Virtual Network \u00b7 2020_06 VNET peering connections must be connected. Description # When peering virtual networks, a peering connection must be established from both virtual networks. Recommendation # Consider removing peering connections that are not longer required or complete peering connections.","title":"Azure.VNET.PeerState"},{"location":"en/rules/Azure.VNET.PeerState/#vnet-peer-is-not-connected","text":"Azure.VNET.PeerState AZR-000266 Error Operational Excellence \u00b7 Virtual Network \u00b7 2020_06 VNET peering connections must be connected.","title":"VNET peer is not connected"},{"location":"en/rules/Azure.VNET.PeerState/#description","text":"When peering virtual networks, a peering connection must be established from both virtual networks.","title":"Description"},{"location":"en/rules/Azure.VNET.PeerState/#recommendation","text":"Consider removing peering connections that are not longer required or complete peering connections.","title":"Recommendation"},{"location":"en/rules/Azure.VNET.SingleDNS/","tags":["Azure.VNET.SingleDNS","AZR-000264"],"text":"Use redundant DNS servers # Azure.VNET.SingleDNS AZR-000264 Error Reliability \u00b7 Virtual Network \u00b7 2020_06 VNETs should have at least two DNS servers assigned. Description # Virtual networks (VNETs) should have at least two (2) DNS servers assigned. Recommendation # Virtual networks should have at least two (2) DNS servers set when not using Azure-provided DNS. Using a single DNS server may indicate a single point of failure where the DNS IP address is not load balanced.","title":"Azure.VNET.SingleDNS"},{"location":"en/rules/Azure.VNET.SingleDNS/#use-redundant-dns-servers","text":"Azure.VNET.SingleDNS AZR-000264 Error Reliability \u00b7 Virtual Network \u00b7 2020_06 VNETs should have at least two DNS servers assigned.","title":"Use redundant DNS servers"},{"location":"en/rules/Azure.VNET.SingleDNS/#description","text":"Virtual networks (VNETs) should have at least two (2) DNS servers assigned.","title":"Description"},{"location":"en/rules/Azure.VNET.SingleDNS/#recommendation","text":"Virtual networks should have at least two (2) DNS servers set when not using Azure-provided DNS. Using a single DNS server may indicate a single point of failure where the DNS IP address is not load balanced.","title":"Recommendation"},{"location":"en/rules/Azure.VNET.SubnetName/","tags":["Azure.VNET.SubnetName","AZR-000267"],"text":"Use valid subnet names # Azure.VNET.SubnetName AZR-000267 Error Operational Excellence \u00b7 Virtual Network \u00b7 2020_06 Subnet names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for Route table names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Subnet names must be unique within a virtual network. Recommendation # Consider using names that meet subnet naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if subnet names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Azure.VNET.SubnetName"},{"location":"en/rules/Azure.VNET.SubnetName/#use-valid-subnet-names","text":"Azure.VNET.SubnetName AZR-000267 Error Operational Excellence \u00b7 Virtual Network \u00b7 2020_06 Subnet names should meet naming requirements.","title":"Use valid subnet names"},{"location":"en/rules/Azure.VNET.SubnetName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for Route table names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Subnet names must be unique within a virtual network.","title":"Description"},{"location":"en/rules/Azure.VNET.SubnetName/#recommendation","text":"Consider using names that meet subnet naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.VNET.SubnetName/#notes","text":"This rule does not check if subnet names are unique.","title":"Notes"},{"location":"en/rules/Azure.VNET.SubnetName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources","title":"Links"},{"location":"en/rules/Azure.VNET.UseNSGs/","tags":["Azure.VNET.UseNSGs","AZR-000263"],"text":"Use NSGs on subnets # Azure.VNET.UseNSGs AZR-000263 Error Security \u00b7 Virtual Network \u00b7 2020_06 Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Description # Each VNET subnet should have a network security group (NSG) assigned. NSGs are basic stateful firewalls that provide network isolation and security within a VNET. A key benefit of NSGS is that they provide network segmentation between and within a subnet. NSGs can be assigned to a virtual machine network interface or a subnet. When assigning NSGs to a subnet, all network traffic within the subnet is subject to the NSG rules. There is a small subset of special purpose subnets that do not support NSGs. These subnets are: GatewaySubnet - used for hybrid connectivity with VPN and ExpressRoute gateways. AzureFirewallSubnet and AzureFirewallManagementSubnet - are for Azure Firewall. Azure Firewall includes an intrinsic NSG that is not directly manageable or visible. RouteServerSubnet - used by managed routing provided by Azure Route Server. Any subnet delegated to a dedicated HSM with Microsoft.HardwareSecurityModules/dedicatedHSMs . Recommendation # For virtual network subnets, ensure that a network security groups (NSGs) are assigned. Examples # Configure with Azure template # To deploy virtual networks subnets that pass this rule: Set the properties.networkSecurityGroup.id property for each supported subnet to a NSG resource id. For example: { \"type\" : \"Microsoft.Network/virtualNetworks\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"vnet-001\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"addressSpace\" : { \"addressPrefixes\" : [ \"10.0.0.0/16\" ] }, \"dhcpOptions\" : { \"dnsServers\" : [ \"10.0.1.4\" , \"10.0.1.5\" ] }, \"subnets\" : [ { \"name\" : \"GatewaySubnet\" , \"properties\" : { \"addressPrefix\" : \"10.0.0.0/24\" } }, { \"name\" : \"snet-001\" , \"properties\" : { \"addressPrefix\" : \"10.0.1.0/24\" , \"networkSecurityGroup\" : { \"id\" : \"[resourceId('Microsoft.Network/networkSecurityGroups', 'nsg-001')]\" } } } ] }, \"dependsOn\" : [ \"[resourceId('Microsoft.Network/networkSecurityGroups', 'nsg-001')]\" ] } Configure with Bicep # To deploy virtual network subnets that pass this rule: Set the properties.networkSecurityGroup.id property for each supported subnet to a NSG resource id. For example: resource vnet 'Microsoft.Network/virtualNetworks@2021-02-01' = { name: 'vnet-001' location: location properties: { addressSpace: { addressPrefixes: [ '10.0.0.0/16' ] } dhcpOptions: { dnsServers: [ '10.0.1.4' '10.0.1.5' ] } subnets: [ { name: 'GatewaySubnet' properties: { addressPrefix: '10.0.0.0/24' } } { name: 'snet-001' properties: { addressPrefix: '10.0.1.0/24' networkSecurityGroup: { id: nsg.id } } } ] } } Configure with Azure CLI # az network vnet subnet update -n '<subnet>' -g '<resource_group>' --vnet-name '<vnet_name>' --network-security-group ' <nsg_name> ` Configure with Azure PowerShell # $vnet = Get-AzVirtualNetwork -Name '<vnet_name>' -ResourceGroupName '<resource_group>' $nsg = Get-AzNetworkSecurityGroup -Name '<nsg_name>' -ResourceGroupName '<resource_group>' Set-AzVirtualNetworkSubnetConfig -Name '<subnet>' -VirtualNetwork $vnet -AddressPrefix '10.0.1.0/24' -NetworkSecurityGroup $nsg Links # Implement network segmentation patterns on Azure Network Security Best Practices Azure Firewall FAQ Forced tunneling configuration Azure Route Server FAQ Azure Dedicated HSM networking Azure deployment reference","title":"Azure.VNET.UseNSGs"},{"location":"en/rules/Azure.VNET.UseNSGs/#use-nsgs-on-subnets","text":"Azure.VNET.UseNSGs AZR-000263 Error Security \u00b7 Virtual Network \u00b7 2020_06 Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned.","title":"Use NSGs on subnets"},{"location":"en/rules/Azure.VNET.UseNSGs/#description","text":"Each VNET subnet should have a network security group (NSG) assigned. NSGs are basic stateful firewalls that provide network isolation and security within a VNET. A key benefit of NSGS is that they provide network segmentation between and within a subnet. NSGs can be assigned to a virtual machine network interface or a subnet. When assigning NSGs to a subnet, all network traffic within the subnet is subject to the NSG rules. There is a small subset of special purpose subnets that do not support NSGs. These subnets are: GatewaySubnet - used for hybrid connectivity with VPN and ExpressRoute gateways. AzureFirewallSubnet and AzureFirewallManagementSubnet - are for Azure Firewall. Azure Firewall includes an intrinsic NSG that is not directly manageable or visible. RouteServerSubnet - used by managed routing provided by Azure Route Server. Any subnet delegated to a dedicated HSM with Microsoft.HardwareSecurityModules/dedicatedHSMs .","title":"Description"},{"location":"en/rules/Azure.VNET.UseNSGs/#recommendation","text":"For virtual network subnets, ensure that a network security groups (NSGs) are assigned.","title":"Recommendation"},{"location":"en/rules/Azure.VNET.UseNSGs/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.VNET.UseNSGs/#configure-with-azure-template","text":"To deploy virtual networks subnets that pass this rule: Set the properties.networkSecurityGroup.id property for each supported subnet to a NSG resource id. For example: { \"type\" : \"Microsoft.Network/virtualNetworks\" , \"apiVersion\" : \"2021-02-01\" , \"name\" : \"vnet-001\" , \"location\" : \"[parameters('location')]\" , \"properties\" : { \"addressSpace\" : { \"addressPrefixes\" : [ \"10.0.0.0/16\" ] }, \"dhcpOptions\" : { \"dnsServers\" : [ \"10.0.1.4\" , \"10.0.1.5\" ] }, \"subnets\" : [ { \"name\" : \"GatewaySubnet\" , \"properties\" : { \"addressPrefix\" : \"10.0.0.0/24\" } }, { \"name\" : \"snet-001\" , \"properties\" : { \"addressPrefix\" : \"10.0.1.0/24\" , \"networkSecurityGroup\" : { \"id\" : \"[resourceId('Microsoft.Network/networkSecurityGroups', 'nsg-001')]\" } } } ] }, \"dependsOn\" : [ \"[resourceId('Microsoft.Network/networkSecurityGroups', 'nsg-001')]\" ] }","title":"Configure with Azure template"},{"location":"en/rules/Azure.VNET.UseNSGs/#configure-with-bicep","text":"To deploy virtual network subnets that pass this rule: Set the properties.networkSecurityGroup.id property for each supported subnet to a NSG resource id. For example: resource vnet 'Microsoft.Network/virtualNetworks@2021-02-01' = { name: 'vnet-001' location: location properties: { addressSpace: { addressPrefixes: [ '10.0.0.0/16' ] } dhcpOptions: { dnsServers: [ '10.0.1.4' '10.0.1.5' ] } subnets: [ { name: 'GatewaySubnet' properties: { addressPrefix: '10.0.0.0/24' } } { name: 'snet-001' properties: { addressPrefix: '10.0.1.0/24' networkSecurityGroup: { id: nsg.id } } } ] } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.VNET.UseNSGs/#configure-with-azure-cli","text":"az network vnet subnet update -n '<subnet>' -g '<resource_group>' --vnet-name '<vnet_name>' --network-security-group ' <nsg_name> `","title":"Configure with Azure CLI"},{"location":"en/rules/Azure.VNET.UseNSGs/#configure-with-azure-powershell","text":"$vnet = Get-AzVirtualNetwork -Name '<vnet_name>' -ResourceGroupName '<resource_group>' $nsg = Get-AzNetworkSecurityGroup -Name '<nsg_name>' -ResourceGroupName '<resource_group>' Set-AzVirtualNetworkSubnetConfig -Name '<subnet>' -VirtualNetwork $vnet -AddressPrefix '10.0.1.0/24' -NetworkSecurityGroup $nsg","title":"Configure with Azure PowerShell"},{"location":"en/rules/Azure.VNET.UseNSGs/#links","text":"Implement network segmentation patterns on Azure Network Security Best Practices Azure Firewall FAQ Forced tunneling configuration Azure Route Server FAQ Azure Dedicated HSM networking Azure deployment reference","title":"Links"},{"location":"en/rules/Azure.VNG.ConnectionName/","tags":["Azure.VNG.ConnectionName","AZR-000275"],"text":"Use valid connection names # Azure.VNG.ConnectionName AZR-000275 Error Operational Excellence \u00b7 Virtual Network Gateway \u00b7 2020_06 Virtual Network Gateway (VNG) connection names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for connection names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Connection names must be unique within a resource group. Recommendation # Consider using names that meet connection naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if connection names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Azure.VNG.ConnectionName"},{"location":"en/rules/Azure.VNG.ConnectionName/#use-valid-connection-names","text":"Azure.VNG.ConnectionName AZR-000275 Error Operational Excellence \u00b7 Virtual Network Gateway \u00b7 2020_06 Virtual Network Gateway (VNG) connection names should meet naming requirements.","title":"Use valid connection names"},{"location":"en/rules/Azure.VNG.ConnectionName/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for connection names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. Connection names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.VNG.ConnectionName/#recommendation","text":"Consider using names that meet connection naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.VNG.ConnectionName/#notes","text":"This rule does not check if connection names are unique.","title":"Notes"},{"location":"en/rules/Azure.VNG.ConnectionName/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Links"},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/","tags":["Azure.VNG.ERAvailabilityZoneSKU","AZR-000273"],"text":"Use availability zone SKU for ExpressRoute gateways # Azure.VNG.ERAvailabilityZoneSKU AZR-000273 Error Reliability \u00b7 Virtual Network Gateway \u00b7 2021_12 Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Description # ExpressRoute gateways can be deployed in Availability Zones with the following SKUs: ErGw1AZ ErGw2AZ ErGw3AZ This brings resiliency, scalability, and higher availability to ExpressRoute gateways. Deploying ExpressRoute gateways in Azure Availability Zones physically and logically separates gateways within a region, while protecting your on-premises network connectivity to Azure from zone-level failures. Recommendation # Consider deploying ExpressRoute gateways with an availability zone SKU to improve reliability of virtual network gateways. Notes # ExpressRoute gateway availability zones are managed via Public IP addresses, and are flagged separately under the Azure.PublicIP.AvailabilityZone rule. Examples # Configure with Azure template # To configure an AZ SKU for an ExpressRoute gateway: Set properties.gatewayType to 'ExpressRoute' Set properties.sku.name and properties.sku.tier to one of the following AZ SKUs: 'ErGw1AZ' 'ErGw2AZ' 'ErGw3AZ' For example: { \"apiVersion\" : \"2020-11-01\" , \"name\" : \"[parameters('name')]\" , \"type\" : \"Microsoft.Network/virtualNetworkGateways\" , \"location\" : \"[parameters('location')]\" , \"dependsOn\" : [ \"[concat('Microsoft.Network/publicIPAddresses/', parameters('newPublicIpAddressName'))]\" ], \"tags\" : {}, \"properties\" : { \"gatewayType\" : \"ExpressRoute\" , \"ipConfigurations\" : [ { \"name\" : \"default\" , \"properties\" : { \"privateIPAllocationMethod\" : \"Dynamic\" , \"subnet\" : { \"id\" : \"[parameters('subnetId')]\" }, \"publicIpAddress\" : { \"id\" : \"[resourceId('vpn-rg', 'Microsoft.Network/publicIPAddresses', parameters('newPublicIpAddressName'))]\" } } } ], \"vpnType\" : \"[parameters('vpnType')]\" , \"vpnGatewayGeneration\" : \"[parameters('vpnGatewayGeneration')]\" , \"sku\" : { \"name\" : \"ErGw1AZ\" , \"tier\" : \"ErGw1AZ\" } } } Configure with Bicep # To configure an AZ SKU for an ExpressRoute gateway: Set properties.gatewayType to 'ExpressRoute' Set properties.sku.name and properties.sku.tier to one of the following AZ SKUs: 'ErGw1AZ' 'ErGw2AZ' 'ErGw3AZ' For example: resource name_resource 'Microsoft.Network/virtualNetworkGateways@2020-11-01' = { name: name location: location tags: {} properties: { gatewayType: 'ExpressRoute' ipConfigurations: [ { name: 'default' properties: { privateIPAllocationMethod: 'Dynamic' subnet: { id: subnetId } publicIPAddress: { id: resourceId('vpn-rg', 'Microsoft.Network/publicIPAddresses', newPublicIpAddressName) } } } ] vpnType: vpnType vpnGatewayGeneration: vpnGatewayGeneration sku: { name: 'ErGw1AZ' tier: 'ErGw1AZ' } } dependsOn: [ newPublicIpAddressName_resource ] } Links # Azure template reference About zone-redundant virtual network gateways in Azure Availability Zones ExpressRoute gateway SKUs Use zone-aware services","title":"Azure.VNG.ERAvailabilityZoneSKU"},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/#use-availability-zone-sku-for-expressroute-gateways","text":"Azure.VNG.ERAvailabilityZoneSKU AZR-000273 Error Reliability \u00b7 Virtual Network Gateway \u00b7 2021_12 Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type.","title":"Use availability zone SKU for ExpressRoute gateways"},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/#description","text":"ExpressRoute gateways can be deployed in Availability Zones with the following SKUs: ErGw1AZ ErGw2AZ ErGw3AZ This brings resiliency, scalability, and higher availability to ExpressRoute gateways. Deploying ExpressRoute gateways in Azure Availability Zones physically and logically separates gateways within a region, while protecting your on-premises network connectivity to Azure from zone-level failures.","title":"Description"},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/#recommendation","text":"Consider deploying ExpressRoute gateways with an availability zone SKU to improve reliability of virtual network gateways.","title":"Recommendation"},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/#notes","text":"ExpressRoute gateway availability zones are managed via Public IP addresses, and are flagged separately under the Azure.PublicIP.AvailabilityZone rule.","title":"Notes"},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/#configure-with-azure-template","text":"To configure an AZ SKU for an ExpressRoute gateway: Set properties.gatewayType to 'ExpressRoute' Set properties.sku.name and properties.sku.tier to one of the following AZ SKUs: 'ErGw1AZ' 'ErGw2AZ' 'ErGw3AZ' For example: { \"apiVersion\" : \"2020-11-01\" , \"name\" : \"[parameters('name')]\" , \"type\" : \"Microsoft.Network/virtualNetworkGateways\" , \"location\" : \"[parameters('location')]\" , \"dependsOn\" : [ \"[concat('Microsoft.Network/publicIPAddresses/', parameters('newPublicIpAddressName'))]\" ], \"tags\" : {}, \"properties\" : { \"gatewayType\" : \"ExpressRoute\" , \"ipConfigurations\" : [ { \"name\" : \"default\" , \"properties\" : { \"privateIPAllocationMethod\" : \"Dynamic\" , \"subnet\" : { \"id\" : \"[parameters('subnetId')]\" }, \"publicIpAddress\" : { \"id\" : \"[resourceId('vpn-rg', 'Microsoft.Network/publicIPAddresses', parameters('newPublicIpAddressName'))]\" } } } ], \"vpnType\" : \"[parameters('vpnType')]\" , \"vpnGatewayGeneration\" : \"[parameters('vpnGatewayGeneration')]\" , \"sku\" : { \"name\" : \"ErGw1AZ\" , \"tier\" : \"ErGw1AZ\" } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/#configure-with-bicep","text":"To configure an AZ SKU for an ExpressRoute gateway: Set properties.gatewayType to 'ExpressRoute' Set properties.sku.name and properties.sku.tier to one of the following AZ SKUs: 'ErGw1AZ' 'ErGw2AZ' 'ErGw3AZ' For example: resource name_resource 'Microsoft.Network/virtualNetworkGateways@2020-11-01' = { name: name location: location tags: {} properties: { gatewayType: 'ExpressRoute' ipConfigurations: [ { name: 'default' properties: { privateIPAllocationMethod: 'Dynamic' subnet: { id: subnetId } publicIPAddress: { id: resourceId('vpn-rg', 'Microsoft.Network/publicIPAddresses', newPublicIpAddressName) } } } ] vpnType: vpnType vpnGatewayGeneration: vpnGatewayGeneration sku: { name: 'ErGw1AZ' tier: 'ErGw1AZ' } } dependsOn: [ newPublicIpAddressName_resource ] }","title":"Configure with Bicep"},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/#links","text":"Azure template reference About zone-redundant virtual network gateways in Azure Availability Zones ExpressRoute gateway SKUs Use zone-aware services","title":"Links"},{"location":"en/rules/Azure.VNG.ERLegacySKU/","tags":["Azure.VNG.ERLegacySKU","AZR-000271"],"text":"Migrate from legacy ER gateway SKUs # Azure.VNG.ERLegacySKU AZR-000271 Error Operational Excellence \u00b7 Virtual Network Gateway \u00b7 2020_06 Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Description # When deploying a ER gateway a number of options are available including SKU/ size. The gateway SKU affects the reliance and performance of the underlying gateway instances. Previously the following SKUs were available however have been depreciated. Basic Recommendation # Consider redeploying ER gateways using new SKUs to improve reliability and performance of gateways. Links # Estimated performances by gateway SKU Azure template reference","title":"Azure.VNG.ERLegacySKU"},{"location":"en/rules/Azure.VNG.ERLegacySKU/#migrate-from-legacy-er-gateway-skus","text":"Azure.VNG.ERLegacySKU AZR-000271 Error Operational Excellence \u00b7 Virtual Network Gateway \u00b7 2020_06 Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways.","title":"Migrate from legacy ER gateway SKUs"},{"location":"en/rules/Azure.VNG.ERLegacySKU/#description","text":"When deploying a ER gateway a number of options are available including SKU/ size. The gateway SKU affects the reliance and performance of the underlying gateway instances. Previously the following SKUs were available however have been depreciated. Basic","title":"Description"},{"location":"en/rules/Azure.VNG.ERLegacySKU/#recommendation","text":"Consider redeploying ER gateways using new SKUs to improve reliability and performance of gateways.","title":"Recommendation"},{"location":"en/rules/Azure.VNG.ERLegacySKU/#links","text":"Estimated performances by gateway SKU Azure template reference","title":"Links"},{"location":"en/rules/Azure.VNG.Name/","tags":["Azure.VNG.Name","AZR-000274"],"text":"Use valid VNG names # Azure.VNG.Name AZR-000274 Error Operational Excellence \u00b7 Virtual Network Gateway \u00b7 2020_06 Virtual Network Gateway (VNG) names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for VNG names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. VNG names must be unique within a resource group. Recommendation # Consider using names that meet Virtual Network Gateway (VNG) naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if VNG names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Azure.VNG.Name"},{"location":"en/rules/Azure.VNG.Name/#use-valid-vng-names","text":"Azure.VNG.Name AZR-000274 Error Operational Excellence \u00b7 Virtual Network Gateway \u00b7 2020_06 Virtual Network Gateway (VNG) names should meet naming requirements.","title":"Use valid VNG names"},{"location":"en/rules/Azure.VNG.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for VNG names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. VNG names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.VNG.Name/#recommendation","text":"Consider using names that meet Virtual Network Gateway (VNG) naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.VNG.Name/#notes","text":"This rule does not check if VNG names are unique.","title":"Notes"},{"location":"en/rules/Azure.VNG.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Links"},{"location":"en/rules/Azure.VNG.VPNActiveActive/","tags":["Azure.VNG.VPNActiveActive","AZR-000270"],"text":"Use Active-Active VPN gateways # Azure.VNG.VPNActiveActive AZR-000270 Error Reliability \u00b7 Virtual Network Gateway \u00b7 2020_06 Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Description # VPN Gateways can be configured as either Active-Passive or Active-Active for Site-to-Site (S2S) connections. When deploying VPN gateways, Azure deploys two instances for high-availability (HA). When using an Active-Passive configuration, one instance is designated a standby for failover. Gateways configured to use an Active-Active configuration: Establish two IPSEC tunnels, one from each instance per connection. Each instance will load balance network traffic. Recommendation # Consider using Active-Active VPN gateways to reduce connectivity downtime during HA failover. Notes # Azure provisions a single instance for Basic (legacy) VPN gateways. As a result, Basic VPN gateways do not support Active-Active connections. To use Active-Active VPN connections, migrate to a gateway configured as VpnGw1 or higher SKU. Links # Highly Available Cross-Premises and VNet-to-VNet Connectivity Update an existing VPN gateway Azure template reference","title":"Azure.VNG.VPNActiveActive"},{"location":"en/rules/Azure.VNG.VPNActiveActive/#use-active-active-vpn-gateways","text":"Azure.VNG.VPNActiveActive AZR-000270 Error Reliability \u00b7 Virtual Network Gateway \u00b7 2020_06 Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime.","title":"Use Active-Active VPN gateways"},{"location":"en/rules/Azure.VNG.VPNActiveActive/#description","text":"VPN Gateways can be configured as either Active-Passive or Active-Active for Site-to-Site (S2S) connections. When deploying VPN gateways, Azure deploys two instances for high-availability (HA). When using an Active-Passive configuration, one instance is designated a standby for failover. Gateways configured to use an Active-Active configuration: Establish two IPSEC tunnels, one from each instance per connection. Each instance will load balance network traffic.","title":"Description"},{"location":"en/rules/Azure.VNG.VPNActiveActive/#recommendation","text":"Consider using Active-Active VPN gateways to reduce connectivity downtime during HA failover.","title":"Recommendation"},{"location":"en/rules/Azure.VNG.VPNActiveActive/#notes","text":"Azure provisions a single instance for Basic (legacy) VPN gateways. As a result, Basic VPN gateways do not support Active-Active connections. To use Active-Active VPN connections, migrate to a gateway configured as VpnGw1 or higher SKU.","title":"Notes"},{"location":"en/rules/Azure.VNG.VPNActiveActive/#links","text":"Highly Available Cross-Premises and VNet-to-VNet Connectivity Update an existing VPN gateway Azure template reference","title":"Links"},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/","tags":["Azure.VNG.VPNAvailabilityZoneSKU","AZR-000272"],"text":"Use availability zone SKU for VPN gateways # Azure.VNG.VPNAvailabilityZoneSKU AZR-000272 Error Reliability \u00b7 Virtual Network Gateway \u00b7 2021_12 Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Description # VPN gateways can be deployed in Availability Zones with the following SKUs: VpnGw1AZ VpnGw2AZ VpnGw3AZ VpnGw4AZ VpnGw5AZ This brings resiliency, scalability, and higher availability to VPN gateways. Deploying VPN gateways in Azure Availability Zones physically and logically separates gateways within a region, while protecting your on-premises network connectivity to Azure from zone-level failures. Recommendation # Consider deploying VPN gateways with an availability zone SKU to improve reliability of virtual network gateways. Notes # VPN gateway availability zones are managed via Public IP addresses, and are flagged separately under the Azure.PublicIP.AvailabilityZone rule. Examples # Configure with Azure template # To configure an AZ SKU for a VPN gateway: Set properties.gatewayType to 'Vpn' Set properties.sku.name and properties.sku.tier to one of the following AZ SKUs: 'VpnGw1AZ' 'VpnGw2AZ' 'VpnGw3AZ' 'VpnGw4AZ' 'VpnGw5AZ' For example: { \"apiVersion\" : \"2020-11-01\" , \"name\" : \"[parameters('name')]\" , \"type\" : \"Microsoft.Network/virtualNetworkGateways\" , \"location\" : \"[parameters('location')]\" , \"dependsOn\" : [ \"[concat('Microsoft.Network/publicIPAddresses/', parameters('newPublicIpAddressName'))]\" ], \"tags\" : {}, \"properties\" : { \"gatewayType\" : \"Vpn\" , \"ipConfigurations\" : [ { \"name\" : \"default\" , \"properties\" : { \"privateIPAllocationMethod\" : \"Dynamic\" , \"subnet\" : { \"id\" : \"[parameters('subnetId')]\" }, \"publicIpAddress\" : { \"id\" : \"[resourceId('vpn-rg', 'Microsoft.Network/publicIPAddresses', parameters('newPublicIpAddressName'))]\" } } } ], \"vpnType\" : \"[parameters('vpnType')]\" , \"vpnGatewayGeneration\" : \"[parameters('vpnGatewayGeneration')]\" , \"sku\" : { \"name\" : \"VpnGw1AZ\" , \"tier\" : \"VpnGw1AZ\" } } } Configure with Bicep # To configure an AZ SKU for a VPN gateway: Set properties.gatewayType to 'Vpn' Set properties.sku.name and properties.sku.tier to one of the following AZ SKUs: 'VpnGw1AZ' 'VpnGw2AZ' 'VpnGw3AZ' 'VpnGw4AZ' 'VpnGw5AZ' For example: resource name_resource 'Microsoft.Network/virtualNetworkGateways@2020-11-01' = { name: name location: location tags: {} properties: { gatewayType: 'Vpn' ipConfigurations: [ { name: 'default' properties: { privateIPAllocationMethod: 'Dynamic' subnet: { id: subnetId } publicIPAddress: { id: resourceId('vpn-rg', 'Microsoft.Network/publicIPAddresses', newPublicIpAddressName) } } } ] vpnType: vpnType vpnGatewayGeneration: vpnGatewayGeneration sku: { name: 'VpnGw1AZ' tier: 'VpnGw1AZ' } } dependsOn: [ newPublicIpAddressName_resource ] } Links # Azure template reference About zone-redundant virtual network gateways in Azure Availability Zones VPN gateway SKUs Use zone-aware services","title":"Azure.VNG.VPNAvailabilityZoneSKU"},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/#use-availability-zone-sku-for-vpn-gateways","text":"Azure.VNG.VPNAvailabilityZoneSKU AZR-000272 Error Reliability \u00b7 Virtual Network Gateway \u00b7 2021_12 Use availability zone SKU for virtual network gateways deployed with VPN gateway type.","title":"Use availability zone SKU for VPN gateways"},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/#description","text":"VPN gateways can be deployed in Availability Zones with the following SKUs: VpnGw1AZ VpnGw2AZ VpnGw3AZ VpnGw4AZ VpnGw5AZ This brings resiliency, scalability, and higher availability to VPN gateways. Deploying VPN gateways in Azure Availability Zones physically and logically separates gateways within a region, while protecting your on-premises network connectivity to Azure from zone-level failures.","title":"Description"},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/#recommendation","text":"Consider deploying VPN gateways with an availability zone SKU to improve reliability of virtual network gateways.","title":"Recommendation"},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/#notes","text":"VPN gateway availability zones are managed via Public IP addresses, and are flagged separately under the Azure.PublicIP.AvailabilityZone rule.","title":"Notes"},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/#configure-with-azure-template","text":"To configure an AZ SKU for a VPN gateway: Set properties.gatewayType to 'Vpn' Set properties.sku.name and properties.sku.tier to one of the following AZ SKUs: 'VpnGw1AZ' 'VpnGw2AZ' 'VpnGw3AZ' 'VpnGw4AZ' 'VpnGw5AZ' For example: { \"apiVersion\" : \"2020-11-01\" , \"name\" : \"[parameters('name')]\" , \"type\" : \"Microsoft.Network/virtualNetworkGateways\" , \"location\" : \"[parameters('location')]\" , \"dependsOn\" : [ \"[concat('Microsoft.Network/publicIPAddresses/', parameters('newPublicIpAddressName'))]\" ], \"tags\" : {}, \"properties\" : { \"gatewayType\" : \"Vpn\" , \"ipConfigurations\" : [ { \"name\" : \"default\" , \"properties\" : { \"privateIPAllocationMethod\" : \"Dynamic\" , \"subnet\" : { \"id\" : \"[parameters('subnetId')]\" }, \"publicIpAddress\" : { \"id\" : \"[resourceId('vpn-rg', 'Microsoft.Network/publicIPAddresses', parameters('newPublicIpAddressName'))]\" } } } ], \"vpnType\" : \"[parameters('vpnType')]\" , \"vpnGatewayGeneration\" : \"[parameters('vpnGatewayGeneration')]\" , \"sku\" : { \"name\" : \"VpnGw1AZ\" , \"tier\" : \"VpnGw1AZ\" } } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/#configure-with-bicep","text":"To configure an AZ SKU for a VPN gateway: Set properties.gatewayType to 'Vpn' Set properties.sku.name and properties.sku.tier to one of the following AZ SKUs: 'VpnGw1AZ' 'VpnGw2AZ' 'VpnGw3AZ' 'VpnGw4AZ' 'VpnGw5AZ' For example: resource name_resource 'Microsoft.Network/virtualNetworkGateways@2020-11-01' = { name: name location: location tags: {} properties: { gatewayType: 'Vpn' ipConfigurations: [ { name: 'default' properties: { privateIPAllocationMethod: 'Dynamic' subnet: { id: subnetId } publicIPAddress: { id: resourceId('vpn-rg', 'Microsoft.Network/publicIPAddresses', newPublicIpAddressName) } } } ] vpnType: vpnType vpnGatewayGeneration: vpnGatewayGeneration sku: { name: 'VpnGw1AZ' tier: 'VpnGw1AZ' } } dependsOn: [ newPublicIpAddressName_resource ] }","title":"Configure with Bicep"},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/#links","text":"Azure template reference About zone-redundant virtual network gateways in Azure Availability Zones VPN gateway SKUs Use zone-aware services","title":"Links"},{"location":"en/rules/Azure.VNG.VPNLegacySKU/","tags":["Azure.VNG.VPNLegacySKU","AZR-000269"],"text":"Migrate from legacy VPN gateway SKUs # Azure.VNG.VPNLegacySKU AZR-000269 Error Operational Excellence \u00b7 Virtual Network Gateway \u00b7 2020_06 Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Description # When deploying a VPN gateway a number of options are available including SKU/ size. The gateway SKU affects the reliance and performance of the underlying gateway instances. Previously the following SKUs were available however have been depreciated. Basic Standard HighPerformance Recommendation # Consider redeploying VPN gateways using new SKUs to improve reliability and performance of gateways. Links # Change to the new gateway SKUs Azure template reference","title":"Azure.VNG.VPNLegacySKU"},{"location":"en/rules/Azure.VNG.VPNLegacySKU/#migrate-from-legacy-vpn-gateway-skus","text":"Azure.VNG.VPNLegacySKU AZR-000269 Error Operational Excellence \u00b7 Virtual Network Gateway \u00b7 2020_06 Migrate from legacy SKUs to improve reliability and performance of VPN gateways.","title":"Migrate from legacy VPN gateway SKUs"},{"location":"en/rules/Azure.VNG.VPNLegacySKU/#description","text":"When deploying a VPN gateway a number of options are available including SKU/ size. The gateway SKU affects the reliance and performance of the underlying gateway instances. Previously the following SKUs were available however have been depreciated. Basic Standard HighPerformance","title":"Description"},{"location":"en/rules/Azure.VNG.VPNLegacySKU/#recommendation","text":"Consider redeploying VPN gateways using new SKUs to improve reliability and performance of gateways.","title":"Recommendation"},{"location":"en/rules/Azure.VNG.VPNLegacySKU/#links","text":"Change to the new gateway SKUs Azure template reference","title":"Links"},{"location":"en/rules/Azure.WebPubSub.ManagedIdentity/","tags":["Azure.WebPubSub.ManagedIdentity","AZR-000277"],"text":"Use managed identities for Web PubSub Services # Azure.WebPubSub.ManagedIdentity AZR-000277 Error Security \u00b7 Web PubSub Service \u00b7 2022_03 Configure Web PubSub Services to use managed identities to access Azure resources securely. Description # A managed identity allows your service to access other Azure AD-protected resources such as Azure Functions. The identity is managed by the Azure platform and doesn't require you to provision or rotate any secrets. Using Azure managed identities have the following benefits: You don't need to store or manage credentials. Azure automatically generates tokens and performs rotation. You can use managed identities to authenticate to any Azure service that supports Azure AD authentication. Managed identities can be used without any additional cost. Recommendation # Consider configuring a managed identity for each Web PubSub Service. Also consider using managed identities to authenticate to related Azure services. Examples # Configure with Azure template # To deploy services that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: { \"type\" : \"Microsoft.SignalRService/webPubSub\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_S1\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : true } } Configure with Bicep # To deploy services that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: resource service 'Microsoft.SignalRService/webPubSub@2021-10-01' = { name: name location: location sku: { name: 'Standard_S1' } identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: true } } Links # Use identity-based authentication Managed identities for Azure Web PubSub Service Azure template reference","title":"Azure.WebPubSub.ManagedIdentity"},{"location":"en/rules/Azure.WebPubSub.ManagedIdentity/#use-managed-identities-for-web-pubsub-services","text":"Azure.WebPubSub.ManagedIdentity AZR-000277 Error Security \u00b7 Web PubSub Service \u00b7 2022_03 Configure Web PubSub Services to use managed identities to access Azure resources securely.","title":"Use managed identities for Web PubSub Services"},{"location":"en/rules/Azure.WebPubSub.ManagedIdentity/#description","text":"A managed identity allows your service to access other Azure AD-protected resources such as Azure Functions. The identity is managed by the Azure platform and doesn't require you to provision or rotate any secrets. Using Azure managed identities have the following benefits: You don't need to store or manage credentials. Azure automatically generates tokens and performs rotation. You can use managed identities to authenticate to any Azure service that supports Azure AD authentication. Managed identities can be used without any additional cost.","title":"Description"},{"location":"en/rules/Azure.WebPubSub.ManagedIdentity/#recommendation","text":"Consider configuring a managed identity for each Web PubSub Service. Also consider using managed identities to authenticate to related Azure services.","title":"Recommendation"},{"location":"en/rules/Azure.WebPubSub.ManagedIdentity/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.WebPubSub.ManagedIdentity/#configure-with-azure-template","text":"To deploy services that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: { \"type\" : \"Microsoft.SignalRService/webPubSub\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_S1\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : true } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.WebPubSub.ManagedIdentity/#configure-with-bicep","text":"To deploy services that pass this rule: Set the identity.type to SystemAssigned or UserAssigned . If identity.type is UserAssigned , reference the identity with identity.userAssignedIdentities . For example: resource service 'Microsoft.SignalRService/webPubSub@2021-10-01' = { name: name location: location sku: { name: 'Standard_S1' } identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: true } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.WebPubSub.ManagedIdentity/#links","text":"Use identity-based authentication Managed identities for Azure Web PubSub Service Azure template reference","title":"Links"},{"location":"en/rules/Azure.WebPubSub.SLA/","tags":["Azure.WebPubSub.SLA","AZR-000278"],"text":"Use an SLA for Web PubSub Services # Azure.WebPubSub.SLA AZR-000278 Error Reliability \u00b7 Web PubSub Service \u00b7 2022_03 Use SKUs that include an SLA when configuring Web PubSub Services. Description # When choosing a SKU for a Web PubSub Service you should consider the SLA that is included in the SKU. Web PubSub Services offer a range of SKU offerings: Free - Are designed for early non-production use and do not include any SLA. Standard - Are designed for production use and include an SLA. Recommendation # Consider using a Standard SKU that includes an SLA. Examples # Configure with Azure template # To deploy services that pass this rule: Set sku.name to Standard_S1 . For example: { \"type\" : \"Microsoft.SignalRService/webPubSub\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_S1\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : true } } Configure with Bicep # To deploy services that pass this rule: Set sku.name to Standard_S1 . For example: resource service 'Microsoft.SignalRService/webPubSub@2021-10-01' = { name: name location: location sku: { name: 'Standard_S1' } identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: true } } Links # Target and non-functional requirements Azure Web PubSub pricing Azure template reference","title":"Azure.WebPubSub.SLA"},{"location":"en/rules/Azure.WebPubSub.SLA/#use-an-sla-for-web-pubsub-services","text":"Azure.WebPubSub.SLA AZR-000278 Error Reliability \u00b7 Web PubSub Service \u00b7 2022_03 Use SKUs that include an SLA when configuring Web PubSub Services.","title":"Use an SLA for Web PubSub Services"},{"location":"en/rules/Azure.WebPubSub.SLA/#description","text":"When choosing a SKU for a Web PubSub Service you should consider the SLA that is included in the SKU. Web PubSub Services offer a range of SKU offerings: Free - Are designed for early non-production use and do not include any SLA. Standard - Are designed for production use and include an SLA.","title":"Description"},{"location":"en/rules/Azure.WebPubSub.SLA/#recommendation","text":"Consider using a Standard SKU that includes an SLA.","title":"Recommendation"},{"location":"en/rules/Azure.WebPubSub.SLA/#examples","text":"","title":"Examples"},{"location":"en/rules/Azure.WebPubSub.SLA/#configure-with-azure-template","text":"To deploy services that pass this rule: Set sku.name to Standard_S1 . For example: { \"type\" : \"Microsoft.SignalRService/webPubSub\" , \"apiVersion\" : \"2021-10-01\" , \"name\" : \"[parameters('name')]\" , \"location\" : \"[parameters('location')]\" , \"sku\" : { \"name\" : \"Standard_S1\" }, \"identity\" : { \"type\" : \"SystemAssigned\" }, \"properties\" : { \"disableLocalAuth\" : true } }","title":"Configure with Azure template"},{"location":"en/rules/Azure.WebPubSub.SLA/#configure-with-bicep","text":"To deploy services that pass this rule: Set sku.name to Standard_S1 . For example: resource service 'Microsoft.SignalRService/webPubSub@2021-10-01' = { name: name location: location sku: { name: 'Standard_S1' } identity: { type: 'SystemAssigned' } properties: { disableLocalAuth: true } }","title":"Configure with Bicep"},{"location":"en/rules/Azure.WebPubSub.SLA/#links","text":"Target and non-functional requirements Azure Web PubSub pricing Azure template reference","title":"Links"},{"location":"en/rules/Azure.vWAN.Name/","tags":["Azure.vWAN.Name","AZR-000276"],"text":"Use valid vWAN names # Azure.vWAN.Name AZR-000276 Error Operational Excellence \u00b7 Virtual WAN \u00b7 2021_12 Virtual WAN (vWAN) names should meet naming requirements. Description # When naming Azure resources, resource names must meet service requirements. The requirements for vWAN names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. vWAN names must be unique within a resource group. Recommendation # Consider using names that meet Virtual WAN (vWAN) naming requirements. Additionally consider naming resources with a standard naming convention. Notes # This rule does not check if vWAN names are unique. Links # Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Azure.vWAN.Name"},{"location":"en/rules/Azure.vWAN.Name/#use-valid-vwan-names","text":"Azure.vWAN.Name AZR-000276 Error Operational Excellence \u00b7 Virtual WAN \u00b7 2021_12 Virtual WAN (vWAN) names should meet naming requirements.","title":"Use valid vWAN names"},{"location":"en/rules/Azure.vWAN.Name/#description","text":"When naming Azure resources, resource names must meet service requirements. The requirements for vWAN names are: Between 1 and 80 characters long. Alphanumerics, underscores, periods, and hyphens. Start with alphanumeric. End alphanumeric or underscore. vWAN names must be unique within a resource group.","title":"Description"},{"location":"en/rules/Azure.vWAN.Name/#recommendation","text":"Consider using names that meet Virtual WAN (vWAN) naming requirements. Additionally consider naming resources with a standard naming convention.","title":"Recommendation"},{"location":"en/rules/Azure.vWAN.Name/#notes","text":"This rule does not check if vWAN names are unique.","title":"Notes"},{"location":"en/rules/Azure.vWAN.Name/#links","text":"Repeatable infrastructure Naming rules and restrictions for Azure resources Azure template reference Recommended abbreviations for Azure resource types","title":"Links"},{"location":"en/rules/module/","text":"Rules by pillar # PSRule for Azure includes the following rules across five pillars of the Microsoft Azure Well-Architected Framework. Cost Optimization # Pricing and billing model # Name Synopsis Severity Level Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Error Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Error Reports # Name Synopsis Severity Level Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Error Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Error Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Error Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Error Resource usage # Name Synopsis Severity Level Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Error Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Error Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Error Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Error Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Error Operational Excellence # Automation # Name Synopsis Severity Level Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Error Configuration # Name Synopsis Severity Level Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Error Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Error Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Error Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Error Deployment # Name Synopsis Severity Level Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Error Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Error Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Error Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Error Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Error Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Error Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Error Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Error Azure.VNET.PeerState VNET peering connections must be connected. Important Error Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Error Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important Error Monitoring # Name Synopsis Severity Level Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Error Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Error Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Error Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Error Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Error Principles # Name Synopsis Severity Level Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Error Release engineering # Name Synopsis Severity Level Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Error Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Error Azure.Template.LocationType Location parameters should use a string value. Important Error Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Error Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Error Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Error Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Error Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Error Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Error Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Warning Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Error Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Error Repeatable infrastructure # Name Synopsis Severity Level Azure.ACR.Name Container registry names should meet naming requirements. Awareness Error Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Error Azure.APIM.Name API Management service names should meet naming requirements. Awareness Error Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Error Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Error Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Error Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Error Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Error Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Error Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Error Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Error Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Error Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Error Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Error Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Error Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Error Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Error Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Error Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Error Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Error Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Error Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Error Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Error Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Error Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Error Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Error Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Error Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Error Azure.Route.Name Route table names should meet naming requirements. Awareness Error Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Error Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Error Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Error Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Error Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Error Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Error Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Error Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Error Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Error Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Error Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Error Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Error Azure.Template.TemplateFile Use ARM template files that are valid. Important Error Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Error Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Error Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Information Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Information Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Error Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Error Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Error Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Error Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Error Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Error Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Error Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Error Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Error Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Error Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Error Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Error Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Error Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Error Tagging and resource naming # Name Synopsis Severity Level Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Error Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Warning Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Warning Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Error Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Error Performance Efficiency # Application design # Name Synopsis Severity Level Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Error Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Error Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Error Capacity planning # Name Synopsis Severity Level Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Error Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Error Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Error Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Error Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Error Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Error Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Error Performance # Name Synopsis Severity Level Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Error Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Error Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Error Performance efficiency checklist # Name Synopsis Severity Level Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Error Scalability # Name Synopsis Severity Level Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Error Reliability # Availability # Name Synopsis Severity Level Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Error Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Error Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Error Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Error Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Error Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Error Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Error Data management # Name Synopsis Severity Level Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Error Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Error Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Error Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Error Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Error Design # Name Synopsis Severity Level Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Error Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Error Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Important Error Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Error Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Error Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Error Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Error Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. Important Error Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Error Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Error Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Error Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Error Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Error Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Error Load balancing and failover # Name Synopsis Severity Level Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Error Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Error Azure.AppService.WebProbe Configure and enable instance health probes. Important Error Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Error Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Error Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Error Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Error Azure.LB.Probe Use a specific probe for web protocols. Important Error Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Error Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Error Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Error Requirements # Name Synopsis Severity Level Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Error Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Error Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled to ensure availability of control plane components for production workloads. Important Error Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Error Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Error Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Error Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important Error Resiliency and dependencies # Name Synopsis Severity Level Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Error Resource deployment # Name Synopsis Severity Level Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Error Security # Application endpoints # Name Synopsis Severity Level Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Error Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Error Azure.Cognitive.PublicAccess Restrict access of Cognitive Services accounts to authorized virtual networks. Important Error Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Error Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Error Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Error Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Error Applications and services # Name Synopsis Severity Level Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Error Authentication # Name Synopsis Severity Level Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Error Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Error Azure.AKS.PodIdentity Configure AKS clusters to use AAD pod identities to access Azure resources securely. Important Error Azure.Cognitive.DisableLocalAuth Authenticate requests to Cognitive Services with Azure AD identities. Important Error Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Error Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Azure AD identities. Important Error Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Azure AD identities. Important Error Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Error Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Error Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Error Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Error Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Error Azure resources # Name Synopsis Severity Level Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Error Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Error Data flow # Name Synopsis Severity Level Azure.Cognitive.PrivateEndpoints Use Private Endpoints to access Cognitive Services accounts. Important Error Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Error Data protection # Name Synopsis Severity Level Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Error Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers. Important Error Azure.APIM.EncryptValues API Management named values should be encrypted. Important Error Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Error Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Error Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Error Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Error Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Error Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Error Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Error Azure.CDN.HTTP Enforce HTTPS for client connections. Important Error Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Error Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Error Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Error Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Error Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Error Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Error Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Error Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Error Deployment # Name Synopsis Severity Level Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Error Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Error Design # Name Synopsis Severity Level Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Error Azure.Deployment.AdminUsername The adminUsername or administratorUsername property should not be a string literal in nested templates. Awareness Error Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Error Encryption # Name Synopsis Severity Level Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Error Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Error Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Error Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Error Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Error Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Error Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Error Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Error Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Error Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Error Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Error Identity and access management # Name Synopsis Severity Level Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Error Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Error Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Error Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Error Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.APIM.ProductApproval Configure products to require approval. Important Error Azure.APIM.ProductSubscription Configure products to require a subscription. Important Error Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Error Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Error Azure.Cognitive.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Error Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Error Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Error Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Error Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Error Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Error Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Error Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Error Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Error Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Error Azure.VM.PublicKey Linux virtual machines should use public keys. Important Error Infrastructure provisioning # Name Synopsis Severity Level Azure.Deployment.OutputSecretValue Avoid outputting sensitive deployment values. Critical Error Key and secret management # Name Synopsis Severity Level Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Error Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Error Monitor # Name Synopsis Severity Level Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Error Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Error Network security and containment # Name Synopsis Severity Level Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Error Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Error Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Error Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Error Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Error Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Error Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Error Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Error Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Network segmentation # Name Synopsis Severity Level Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Error Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Error Optimize # Name Synopsis Severity Level Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Error Security configuration # Name Synopsis Severity Level Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Error Security operations # Name Synopsis Severity Level Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Error Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Error Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Error Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Error Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Error Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Error","title":"By pillar"},{"location":"en/rules/module/#rules-by-pillar","text":"PSRule for Azure includes the following rules across five pillars of the Microsoft Azure Well-Architected Framework.","title":"Rules by pillar"},{"location":"en/rules/module/#cost-optimization","text":"","title":"Cost Optimization"},{"location":"en/rules/module/#pricing-and-billing-model","text":"Name Synopsis Severity Level Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Error Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Error","title":"Pricing and billing model"},{"location":"en/rules/module/#reports","text":"Name Synopsis Severity Level Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Error Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Error Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Error Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Error","title":"Reports"},{"location":"en/rules/module/#resource-usage","text":"Name Synopsis Severity Level Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Error Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Error Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Error Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Error Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Error","title":"Resource usage"},{"location":"en/rules/module/#operational-excellence","text":"","title":"Operational Excellence"},{"location":"en/rules/module/#automation","text":"Name Synopsis Severity Level Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Error","title":"Automation"},{"location":"en/rules/module/#configuration","text":"Name Synopsis Severity Level Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Error Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Error Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Error Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Error","title":"Configuration"},{"location":"en/rules/module/#deployment","text":"Name Synopsis Severity Level Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Error Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Error Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Error Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Error Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Error Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Error Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Error Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Error Azure.VNET.PeerState VNET peering connections must be connected. Important Error Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Error Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important Error","title":"Deployment"},{"location":"en/rules/module/#monitoring","text":"Name Synopsis Severity Level Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Error Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Error Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Error Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Error Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Error","title":"Monitoring"},{"location":"en/rules/module/#principles","text":"Name Synopsis Severity Level Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Error","title":"Principles"},{"location":"en/rules/module/#release-engineering","text":"Name Synopsis Severity Level Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Error Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Error Azure.Template.LocationType Location parameters should use a string value. Important Error Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Error Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Error Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Error Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Error Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Error Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Error Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Warning Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Error Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Error","title":"Release engineering"},{"location":"en/rules/module/#repeatable-infrastructure","text":"Name Synopsis Severity Level Azure.ACR.Name Container registry names should meet naming requirements. Awareness Error Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Error Azure.APIM.Name API Management service names should meet naming requirements. Awareness Error Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Error Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Error Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Error Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Error Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Error Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Error Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Error Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Error Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Error Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Error Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Error Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Error Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Error Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Error Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Error Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Error Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Error Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Error Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Error Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Error Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Error Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Error Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Error Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Error Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Error Azure.Route.Name Route table names should meet naming requirements. Awareness Error Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Error Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Error Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Error Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Error Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Error Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Error Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Error Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Error Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Error Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Error Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Error Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Error Azure.Template.TemplateFile Use ARM template files that are valid. Important Error Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Error Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Error Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Information Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Information Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Error Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Error Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Error Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Error Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Error Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Error Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Error Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Error Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Error Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Error Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Error Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Error Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Error Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Error","title":"Repeatable infrastructure"},{"location":"en/rules/module/#tagging-and-resource-naming","text":"Name Synopsis Severity Level Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Error Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Warning Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Warning Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Error Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Error","title":"Tagging and resource naming"},{"location":"en/rules/module/#performance-efficiency","text":"","title":"Performance Efficiency"},{"location":"en/rules/module/#application-design","text":"Name Synopsis Severity Level Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Error Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Error Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Error","title":"Application design"},{"location":"en/rules/module/#capacity-planning","text":"Name Synopsis Severity Level Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Error Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Error Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Error Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Error Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Error Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Error Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Error","title":"Capacity planning"},{"location":"en/rules/module/#performance","text":"Name Synopsis Severity Level Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Error Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Error Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Error","title":"Performance"},{"location":"en/rules/module/#performance-efficiency-checklist","text":"Name Synopsis Severity Level Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Error","title":"Performance efficiency checklist"},{"location":"en/rules/module/#scalability","text":"Name Synopsis Severity Level Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Error","title":"Scalability"},{"location":"en/rules/module/#reliability","text":"","title":"Reliability"},{"location":"en/rules/module/#availability","text":"Name Synopsis Severity Level Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Error Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Error Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Error Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Error Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Error Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Error Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Error","title":"Availability"},{"location":"en/rules/module/#data-management","text":"Name Synopsis Severity Level Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Error Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Error Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Error Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Error Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Error","title":"Data management"},{"location":"en/rules/module/#design","text":"Name Synopsis Severity Level Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Error Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Error Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Important Error Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Error Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Error Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Error Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Error Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. Important Error Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Error Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Error Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Error Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Error Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Error Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Error","title":"Design"},{"location":"en/rules/module/#load-balancing-and-failover","text":"Name Synopsis Severity Level Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Error Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Error Azure.AppService.WebProbe Configure and enable instance health probes. Important Error Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Error Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Error Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Error Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Error Azure.LB.Probe Use a specific probe for web protocols. Important Error Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Error Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Error Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Error","title":"Load balancing and failover"},{"location":"en/rules/module/#requirements","text":"Name Synopsis Severity Level Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Error Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Error Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled to ensure availability of control plane components for production workloads. Important Error Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Error Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Error Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Error Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important Error","title":"Requirements"},{"location":"en/rules/module/#resiliency-and-dependencies","text":"Name Synopsis Severity Level Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Error","title":"Resiliency and dependencies"},{"location":"en/rules/module/#resource-deployment","text":"Name Synopsis Severity Level Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Error","title":"Resource deployment"},{"location":"en/rules/module/#security","text":"","title":"Security"},{"location":"en/rules/module/#application-endpoints","text":"Name Synopsis Severity Level Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Error Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Error Azure.Cognitive.PublicAccess Restrict access of Cognitive Services accounts to authorized virtual networks. Important Error Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Error Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Error Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Error Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Error","title":"Application endpoints"},{"location":"en/rules/module/#applications-and-services","text":"Name Synopsis Severity Level Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Error","title":"Applications and services"},{"location":"en/rules/module/#authentication","text":"Name Synopsis Severity Level Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Error Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Error Azure.AKS.PodIdentity Configure AKS clusters to use AAD pod identities to access Azure resources securely. Important Error Azure.Cognitive.DisableLocalAuth Authenticate requests to Cognitive Services with Azure AD identities. Important Error Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Error Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Azure AD identities. Important Error Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Azure AD identities. Important Error Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Error Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Error Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Error Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Error Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Error","title":"Authentication"},{"location":"en/rules/module/#azure-resources","text":"Name Synopsis Severity Level Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Error Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Error","title":"Azure resources"},{"location":"en/rules/module/#data-flow","text":"Name Synopsis Severity Level Azure.Cognitive.PrivateEndpoints Use Private Endpoints to access Cognitive Services accounts. Important Error Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Error","title":"Data flow"},{"location":"en/rules/module/#data-protection","text":"Name Synopsis Severity Level Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Error Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers. Important Error Azure.APIM.EncryptValues API Management named values should be encrypted. Important Error Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Error Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Error Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Error Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Error Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Error Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Error Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Error Azure.CDN.HTTP Enforce HTTPS for client connections. Important Error Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Error Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Error Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Error Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Error Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Error Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Error Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Error Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Error","title":"Data protection"},{"location":"en/rules/module/#deployment_1","text":"Name Synopsis Severity Level Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Error Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Error","title":"Deployment"},{"location":"en/rules/module/#design_1","text":"Name Synopsis Severity Level Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Error Azure.Deployment.AdminUsername The adminUsername or administratorUsername property should not be a string literal in nested templates. Awareness Error Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Error","title":"Design"},{"location":"en/rules/module/#encryption","text":"Name Synopsis Severity Level Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Error Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Error Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Error Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Error Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Error Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Error Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Error Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Error Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Error Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Error Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Error","title":"Encryption"},{"location":"en/rules/module/#identity-and-access-management","text":"Name Synopsis Severity Level Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Error Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Error Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Error Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Error Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.APIM.ProductApproval Configure products to require approval. Important Error Azure.APIM.ProductSubscription Configure products to require a subscription. Important Error Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Error Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Error Azure.Cognitive.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Error Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Error Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Error Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Error Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Error Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Error Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Error Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Error Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Error Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Error Azure.VM.PublicKey Linux virtual machines should use public keys. Important Error","title":"Identity and access management"},{"location":"en/rules/module/#infrastructure-provisioning","text":"Name Synopsis Severity Level Azure.Deployment.OutputSecretValue Avoid outputting sensitive deployment values. Critical Error","title":"Infrastructure provisioning"},{"location":"en/rules/module/#key-and-secret-management","text":"Name Synopsis Severity Level Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Error Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Error","title":"Key and secret management"},{"location":"en/rules/module/#monitor","text":"Name Synopsis Severity Level Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Error Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Error","title":"Monitor"},{"location":"en/rules/module/#network-security-and-containment","text":"Name Synopsis Severity Level Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Error Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Error Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Error Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Error Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Error Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Error Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Error Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Error Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error","title":"Network security and containment"},{"location":"en/rules/module/#network-segmentation","text":"Name Synopsis Severity Level Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Error Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Error","title":"Network segmentation"},{"location":"en/rules/module/#optimize","text":"Name Synopsis Severity Level Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Error","title":"Optimize"},{"location":"en/rules/module/#security-configuration","text":"Name Synopsis Severity Level Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Error","title":"Security configuration"},{"location":"en/rules/module/#security-operations","text":"Name Synopsis Severity Level Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Error Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Error Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Error Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Error Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Error Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Error","title":"Security operations"},{"location":"en/rules/resource/","text":"Rules by resource type # PSRule for Azure includes the following rules organized by resource type. All resources # Name Synopsis Severity Level Azure.Deployment.AdminUsername The adminUsername or administratorUsername property should not be a string literal in nested templates. Awareness Error Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Error Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Error Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Error Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Error Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Error Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Error Azure.Template.LocationType Location parameters should use a string value. Important Error Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Error Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Error Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Error Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Error Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Error Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Error Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Error Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Error Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Error Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Error Azure.Template.TemplateFile Use ARM template files that are valid. Important Error Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Error Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Error Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Information Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Information Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Warning Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Error Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Error Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Error API Management # Name Synopsis Severity Level Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Warning Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Important Error Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Error Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers. Important Error Azure.APIM.EncryptValues API Management named values should be encrypted. Important Error Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Error Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Error Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.APIM.Name API Management service names should meet naming requirements. Awareness Error Azure.APIM.ProductApproval Configure products to require approval. Important Error Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Warning Azure.APIM.ProductSubscription Configure products to require a subscription. Important Error Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Error Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Error Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Error App Configuration # Name Synopsis Severity Level Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Error Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Error App Service # Name Synopsis Severity Level Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Error Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Error Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Error Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Error Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Error Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Error Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Error Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Error Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Error Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Error Azure.AppService.WebProbe Configure and enable instance health probes. Important Error Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Error Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Error Application Gateway # Name Synopsis Severity Level Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Error Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Error Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Error Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Error Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Error Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Error Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Error Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Error Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Error Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Error Application Insights # Name Synopsis Severity Level Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Error Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Error Application Security Group # Name Synopsis Severity Level Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Error Automation Account # Name Synopsis Severity Level Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Error Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Error Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Error Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Error Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Error Azure Cache for Redis # Name Synopsis Severity Level Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Error Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Error Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Error Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Error Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Error Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Error Azure Cache for Redis Enterprise # Name Synopsis Severity Level Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Error Azure Database for MySQL # Name Synopsis Severity Level Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Error Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Error Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Error Azure Database for PostgreSQL # Name Synopsis Severity Level Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Error Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Error Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Error Azure Kubernetes Service # Name Synopsis Severity Level Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Error Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Error Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Error Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Error Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Error Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Error Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Error Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Error Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Error Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Error Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Error Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Error Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Error Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Error Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Error Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Error Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Error Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Error Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Error Azure.AKS.PodIdentity Configure AKS clusters to use AAD pod identities to access Azure resources securely. Important Error Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Error Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Error Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Error Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Error Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Error Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled to ensure availability of control plane components for production workloads. Important Error Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Error Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Error Azure Recovery Services Vault (RSV) # Name Synopsis Severity Level Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Error Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Error Cognitive Search # Name Synopsis Severity Level Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Error Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Error Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Error Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Error Cognitive Services # Name Synopsis Severity Level Azure.Cognitive.DisableLocalAuth Authenticate requests to Cognitive Services with Azure AD identities. Important Error Azure.Cognitive.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.Cognitive.PrivateEndpoints Use Private Endpoints to access Cognitive Services accounts. Important Error Azure.Cognitive.PublicAccess Restrict access of Cognitive Services accounts to authorized virtual networks. Important Error Container App # Name Synopsis Severity Level Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Error Container Registry # Name Synopsis Severity Level Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Error Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Error Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Error Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Error Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Error Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Error Azure.ACR.Name Container registry names should meet naming requirements. Awareness Error Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Error Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Error Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Error Content Delivery Network # Name Synopsis Severity Level Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Error Azure.CDN.HTTP Enforce HTTPS for client connections. Important Error Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Error Cosmos DB # Name Synopsis Severity Level Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Error Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Error Data Explorer # Name Synopsis Severity Level Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Error Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Error Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Error Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Error Data Factory # Name Synopsis Severity Level Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Error Deployment # Name Synopsis Severity Level Azure.Deployment.OutputSecretValue Avoid outputting sensitive deployment values. Critical Error Event Grid # Name Synopsis Severity Level Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Error Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Error Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Error Event Hub # Name Synopsis Severity Level Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Azure AD identities. Important Error Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Error Firewall # Name Synopsis Severity Level Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Error Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Error Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Error Front Door # Name Synopsis Severity Level Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Error Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Error Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Error Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Error Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Error Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Error Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Error Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Error Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Error Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Error Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Error Key Vault # Name Synopsis Severity Level Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Error Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Error Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Error Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Error Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Error Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Error Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Error Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Error Load Balancer # Name Synopsis Severity Level Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Error Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Error Azure.LB.Probe Use a specific probe for web protocols. Important Error Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Error Logic App # Name Synopsis Severity Level Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Error Monitor # Name Synopsis Severity Level Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Error Network Security Group # Name Synopsis Severity Level Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Error Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Error Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Error Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Error Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Error Policy # Name Synopsis Severity Level Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Error Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Error Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Error Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Error Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Error Private Endpoint # Name Synopsis Severity Level Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Error Public IP address # Name Synopsis Severity Level Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Error Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Error Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Error Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Error Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. Important Error Resource Group # Name Synopsis Severity Level Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Error Route table # Name Synopsis Severity Level Azure.Route.Name Route table names should meet naming requirements. Awareness Error Security Center # Name Synopsis Severity Level Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Error Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Error Service Bus # Name Synopsis Severity Level Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Azure AD identities. Important Error Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Error Service Fabric # Name Synopsis Severity Level Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Error SignalR Service # Name Synopsis Severity Level Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Error Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Error Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Error SQL Database # Name Synopsis Severity Level Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Error Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Error Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Error Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Error Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Error Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Error Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Error Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Error SQL Managed Instance # Name Synopsis Severity Level Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Error Storage Account # Name Synopsis Severity Level Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Error Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Error Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Error Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Error Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Error Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Error Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Error Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Error Subscription # Name Synopsis Severity Level Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Error Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Error Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Error Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Error Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Error Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Error Traffic Manager # Name Synopsis Severity Level Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Error Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Error User Assigned Managed Identity # Name Synopsis Severity Level Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Error Virtual Machine # Name Synopsis Severity Level Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Error Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Error Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Error Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Error Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Error Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Error Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Error Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Error Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Error Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Error Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Error Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Error Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Error Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Error Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Error Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Error Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Error Azure.VM.PublicKey Linux virtual machines should use public keys. Important Error Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Error Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Error Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Error Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Error Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Error Virtual Machine Scale Sets # Name Synopsis Severity Level Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Error Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Error Virtual Network # Name Synopsis Severity Level Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Error Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Error Azure.VNET.PeerState VNET peering connections must be connected. Important Error Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Error Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Error Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Error Virtual Network Gateway # Name Synopsis Severity Level Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Error Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Error Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Error Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Error Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Error Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Error Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important Error Virtual WAN # Name Synopsis Severity Level Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Error Web PubSub Service # Name Synopsis Severity Level Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Error Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important Error","title":"By resource"},{"location":"en/rules/resource/#rules-by-resource-type","text":"PSRule for Azure includes the following rules organized by resource type.","title":"Rules by resource type"},{"location":"en/rules/resource/#all-resources","text":"Name Synopsis Severity Level Azure.Deployment.AdminUsername The adminUsername or administratorUsername property should not be a string literal in nested templates. Awareness Error Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Awareness Error Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Error Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Error Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Error Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Error Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Error Azure.Template.LocationType Location parameters should use a string value. Important Error Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Error Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Error Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Error Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Error Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Error Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Error Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Error Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Error Azure.Template.ResourceLocation Template resource location should be an expression or global. Awareness Error Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Error Azure.Template.TemplateFile Use ARM template files that are valid. Important Error Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Error Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Error Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Information Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Information Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Warning Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Error Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Error Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Error","title":"All resources"},{"location":"en/rules/resource/#api-management","text":"Name Synopsis Severity Level Azure.APIM.APIDescriptors API Management APIs should have a display name and description. Awareness Warning Azure.APIM.AvailabilityZone API management services deployed with Premium SKU should use availability zones in supported regions for high availability. Important Error Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Error Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers. Important Error Azure.APIM.EncryptValues API Management named values should be encrypted. Important Error Azure.APIM.HTTPBackend Use HTTPS for communication to backend services. Critical Error Azure.APIM.HTTPEndpoint Enforce HTTPS for communication to API clients. Important Error Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.APIM.Name API Management service names should meet naming requirements. Awareness Error Azure.APIM.ProductApproval Configure products to require approval. Important Error Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Warning Azure.APIM.ProductSubscription Configure products to require a subscription. Important Error Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Error Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2. Important Error Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Error","title":"API Management"},{"location":"en/rules/resource/#app-configuration","text":"Name Synopsis Severity Level Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Error Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Error","title":"App Configuration"},{"location":"en/rules/resource/#app-service","text":"Name Synopsis Severity Level Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Error Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Error Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Error Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Error Azure.AppService.MinTLS App Service should reject TLS versions older then 1.2. Critical Error Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Error Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Error Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Error Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Error Azure.AppService.UseHTTPS Azure App Service apps should only accept encrypted connections. Important Error Azure.AppService.WebProbe Configure and enable instance health probes. Important Error Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Error Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Error","title":"App Service"},{"location":"en/rules/resource/#application-gateway","text":"Name Synopsis Severity Level Azure.AppGw.AvailabilityZone Application gateways deployed with should use availability zones in supported regions for high availability. Important Error Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Error Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Error Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Error Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Error Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Error Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Error Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Error Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Error Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Error","title":"Application Gateway"},{"location":"en/rules/resource/#application-insights","text":"Name Synopsis Severity Level Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Error Azure.AppInsights.Workspace Configure Application Insights resources to store data in workspaces. Important Error","title":"Application Insights"},{"location":"en/rules/resource/#application-security-group","text":"Name Synopsis Severity Level Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Error","title":"Application Security Group"},{"location":"en/rules/resource/#automation-account","text":"Name Synopsis Severity Level Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Error Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Error Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Error Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Error Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Error","title":"Automation Account"},{"location":"en/rules/resource/#azure-cache-for-redis","text":"Name Synopsis Severity Level Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Error Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Error Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Error Azure.Redis.MinTLS Redis Cache should reject TLS versions older then 1.2. Critical Error Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Error Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Error","title":"Azure Cache for Redis"},{"location":"en/rules/resource/#azure-cache-for-redis-enterprise","text":"Name Synopsis Severity Level Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Error","title":"Azure Cache for Redis Enterprise"},{"location":"en/rules/resource/#azure-database-for-mysql","text":"Name Synopsis Severity Level Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Error Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Error Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Error","title":"Azure Database for MySQL"},{"location":"en/rules/resource/#azure-database-for-postgresql","text":"Name Synopsis Severity Level Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Error Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Error Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Error","title":"Azure Database for PostgreSQL"},{"location":"en/rules/resource/#azure-kubernetes-service","text":"Name Synopsis Severity Level Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Error Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Error Azure.AKS.AutoScaling Use Autoscaling to ensure AKS clusters deployed with virtual machine scale sets are running efficiently with the right number of nodes for the workloads present. Important Error Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Error Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Error Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Error Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Error Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Error Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Error Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Error Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Error Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Error Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Error Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Error Azure.AKS.MinNodeCount AKS clusters should have minimum number of nodes for failover and updates. Important Error Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Error Azure.AKS.NetworkPolicy Deploy AKS clusters with Network Policies enabled. Important Error Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Error Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Error Azure.AKS.PodIdentity Configure AKS clusters to use AAD pod identities to access Azure resources securely. Important Error Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Error Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Error Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Error Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Error Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Error Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled to ensure availability of control plane components for production workloads. Important Error Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Error Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Error","title":"Azure Kubernetes Service"},{"location":"en/rules/resource/#azure-recovery-services-vault-rsv","text":"Name Synopsis Severity Level Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Error Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Error","title":"Azure Recovery Services Vault (RSV)"},{"location":"en/rules/resource/#cognitive-search","text":"Name Synopsis Severity Level Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Error Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.Search.Name Azure Cognitive Search service names should meet naming requirements. Awareness Error Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Error Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Error","title":"Cognitive Search"},{"location":"en/rules/resource/#cognitive-services","text":"Name Synopsis Severity Level Azure.Cognitive.DisableLocalAuth Authenticate requests to Cognitive Services with Azure AD identities. Important Error Azure.Cognitive.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.Cognitive.PrivateEndpoints Use Private Endpoints to access Cognitive Services accounts. Important Error Azure.Cognitive.PublicAccess Restrict access of Cognitive Services accounts to authorized virtual networks. Important Error","title":"Cognitive Services"},{"location":"en/rules/resource/#container-app","text":"Name Synopsis Severity Level Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Error","title":"Container App"},{"location":"en/rules/resource/#container-registry","text":"Name Synopsis Severity Level Azure.ACR.AdminUser Use Azure AD identities instead of using the registry admin user. Critical Error Azure.ACR.ContainerScan Enable vulnerability scanning for container images. Critical Error Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Error Azure.ACR.GeoReplica Use geo-replicated container registries to compliment a multi-region container deployments. Important Error Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Error Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Error Azure.ACR.Name Container registry names should meet naming requirements. Awareness Error Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Error Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Error Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Error","title":"Container Registry"},{"location":"en/rules/resource/#content-delivery-network","text":"Name Synopsis Severity Level Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Error Azure.CDN.HTTP Enforce HTTPS for client connections. Important Error Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Error","title":"Content Delivery Network"},{"location":"en/rules/resource/#cosmos-db","text":"Name Synopsis Severity Level Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Error Azure.Cosmos.DisableMetadataWrite Use Azure AD identities for management place operations in Azure Cosmos DB. Important Error","title":"Cosmos DB"},{"location":"en/rules/resource/#data-explorer","text":"Name Synopsis Severity Level Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Error Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Error Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Error Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Error","title":"Data Explorer"},{"location":"en/rules/resource/#data-factory","text":"Name Synopsis Severity Level Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Error","title":"Data Factory"},{"location":"en/rules/resource/#deployment","text":"Name Synopsis Severity Level Azure.Deployment.OutputSecretValue Avoid outputting sensitive deployment values. Critical Error","title":"Deployment"},{"location":"en/rules/resource/#event-grid","text":"Name Synopsis Severity Level Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Error Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Error Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Error","title":"Event Grid"},{"location":"en/rules/resource/#event-hub","text":"Name Synopsis Severity Level Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Azure AD identities. Important Error Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Error","title":"Event Hub"},{"location":"en/rules/resource/#firewall","text":"Name Synopsis Severity Level Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Error Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Error Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Error","title":"Firewall"},{"location":"en/rules/resource/#front-door","text":"Name Synopsis Severity Level Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Error Azure.FrontDoor.Logs Audit and monitor access through Front Door. Important Error Azure.FrontDoor.MinTLS Front Door should reject TLS versions older then 1.2. Critical Error Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Error Azure.FrontDoor.Probe Configure and enable health probes for each backend pool. Important Error Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD instead of GET requests. Important Error Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Error Azure.FrontDoor.State Enable Azure Front Door instance. Awareness Error Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Error Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Error Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Error","title":"Front Door"},{"location":"en/rules/resource/#key-vault","text":"Name Synopsis Severity Level Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Error Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Error Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Error Azure.KeyVault.Logs Audit and monitor access to Key Vault data. Important Error Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Error Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Error Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Error Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Error","title":"Key Vault"},{"location":"en/rules/resource/#load-balancer","text":"Name Synopsis Severity Level Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Error Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Error Azure.LB.Probe Use a specific probe for web protocols. Important Error Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Error","title":"Load Balancer"},{"location":"en/rules/resource/#logic-app","text":"Name Synopsis Severity Level Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Error","title":"Logic App"},{"location":"en/rules/resource/#monitor","text":"Name Synopsis Severity Level Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Error","title":"Monitor"},{"location":"en/rules/resource/#network-security-group","text":"Name Synopsis Severity Level Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow any inbound source. Critical Error Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Error Azure.NSG.DenyAllInbound Avoid denying all inbound traffic. Important Error Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Error Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Error","title":"Network Security Group"},{"location":"en/rules/resource/#policy","text":"Name Synopsis Severity Level Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Error Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Error Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Error Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Error Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Error","title":"Policy"},{"location":"en/rules/resource/#private-endpoint","text":"Name Synopsis Severity Level Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Error","title":"Private Endpoint"},{"location":"en/rules/resource/#public-ip-address","text":"Name Synopsis Severity Level Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Error Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Error Azure.PublicIP.IsAttached Public IP address should be attached or removed. Important Error Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Error Azure.PublicIP.StandardSKU Public IP addresses should be deployed with Standard SKU for production workloads. Important Error","title":"Public IP address"},{"location":"en/rules/resource/#resource-group","text":"Name Synopsis Severity Level Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Error","title":"Resource Group"},{"location":"en/rules/resource/#route-table","text":"Name Synopsis Severity Level Azure.Route.Name Route table names should meet naming requirements. Awareness Error","title":"Route table"},{"location":"en/rules/resource/#security-center","text":"Name Synopsis Severity Level Azure.SecurityCenter.Contact Security Center email and phone contact details should be set. Important Error Azure.SecurityCenter.Provisioning Enable auto-provisioning on to improve Azure Security Center insights. Important Error","title":"Security Center"},{"location":"en/rules/resource/#service-bus","text":"Name Synopsis Severity Level Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Azure AD identities. Important Error Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Error","title":"Service Bus"},{"location":"en/rules/resource/#service-fabric","text":"Name Synopsis Severity Level Azure.ServiceFabric.AAD Use Azure Active Directory (AAD) client authentication for Service Fabric clusters. Critical Error","title":"Service Fabric"},{"location":"en/rules/resource/#signalr-service","text":"Name Synopsis Severity Level Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Error Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Error Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Error","title":"SignalR Service"},{"location":"en/rules/resource/#sql-database","text":"Name Synopsis Severity Level Azure.SQL.AAD Use Azure Active Directory (AAD) authentication with Azure SQL databases. Critical Error Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Error Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Error Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Error Azure.SQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Error Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Error Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Error Azure.SQL.ThreatDetection Enable Advanced Thread Protection for Azure SQL logical server. Important Error","title":"SQL Database"},{"location":"en/rules/resource/#sql-managed-instance","text":"Name Synopsis Severity Level Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Error","title":"SQL Managed Instance"},{"location":"en/rules/resource/#storage-account","text":"Name Synopsis Severity Level Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Error Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Error Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Error Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Error Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Error Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Error Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Error Azure.Storage.UseReplication Storage Accounts not using geo-replicated storage (GRS) may be at risk. Important Error","title":"Storage Account"},{"location":"en/rules/resource/#subscription","text":"Name Synopsis Severity Level Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Error Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Error Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Error Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Error Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Error Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Error","title":"Subscription"},{"location":"en/rules/resource/#traffic-manager","text":"Name Synopsis Severity Level Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Error Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Error","title":"Traffic Manager"},{"location":"en/rules/resource/#user-assigned-managed-identity","text":"Name Synopsis Severity Level Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Error","title":"User Assigned Managed Identity"},{"location":"en/rules/resource/#virtual-machine","text":"Name Synopsis Severity Level Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Error Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Error Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Error Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Error Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Error Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Error Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Error Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Error Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Error Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Error Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Error Azure.VM.DiskSizeAlignment Align to the Managed Disk billing model to improve cost efficiency. Awareness Error Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Error Azure.VM.NICAttached Network interfaces (NICs) should be attached. Awareness Error Azure.VM.NICName Network Interface (NIC) names should meet naming requirements. Awareness Error Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Error Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Error Azure.VM.PublicKey Linux virtual machines should use public keys. Important Error Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Error Azure.VM.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Error Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Error Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Error Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Error","title":"Virtual Machine"},{"location":"en/rules/resource/#virtual-machine-scale-sets","text":"Name Synopsis Severity Level Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Error Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Error","title":"Virtual Machine Scale Sets"},{"location":"en/rules/resource/#virtual-network","text":"Name Synopsis Severity Level Azure.VNET.LocalDNS Virtual networks (VNETs) should use Azure local DNS servers. Important Error Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Error Azure.VNET.PeerState VNET peering connections must be connected. Important Error Azure.VNET.SingleDNS VNETs should have at least two DNS servers assigned. Important Error Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Error Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Error","title":"Virtual Network"},{"location":"en/rules/resource/#virtual-network-gateway","text":"Name Synopsis Severity Level Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Error Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Error Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Important Error Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Error Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Error Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Error Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Important Error","title":"Virtual Network Gateway"},{"location":"en/rules/resource/#virtual-wan","text":"Name Synopsis Severity Level Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Error","title":"Virtual WAN"},{"location":"en/rules/resource/#web-pubsub-service","text":"Name Synopsis Severity Level Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Error Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important Error","title":"Web PubSub Service"},{"location":"en/selectors/Azure.AppService.IsAPIApp/","text":"Azure.AppService.IsAPIApp # Azure App Services API apps. Description # Use this selector to filter rules to only run against API apps. Examples # Configure with YAML-based rules # Use the with property to set PSRule.Rules.Azure\\Azure.AppService.IsAPIApp . --- # Synopsis: An example rule. apiVersion : github.com/microsoft/PSRule/v1 kind : Rule metadata : name : Local.MyRule spec : with : - PSRule.Rules.Azure\\Azure.AppService.IsAPIApp condition : # Rule logic goes here Configure with JSON-based rules # Use the with property to set PSRule.Rules.Azure\\Azure.AppService.IsAPIApp . { // Synopsis: An example rule. \"apiVersion\" : \"github.com/microsoft/PSRule/v1\" , \"kind\" : \"Rule\" , \"metadata\" : { \"name\" : \"Local.MyRule\" }, \"spec\" : { \"with\" : [ \"PSRule.Rules.Azure\\\\Azure.AppService.IsAPIApp\" ], \"condition\" : { // Rule logic goes here } } } Configure with PowerShell-based rules # Use the -With parameter to set PSRule.Rules.Azure\\Azure.AppService.IsAPIApp . # Synopsis: An example rule. Rule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.AppService.IsAPIApp' { # Rule logic goes here }","title":"Azure.AppService.IsAPIApp"},{"location":"en/selectors/Azure.AppService.IsAPIApp/#azureappserviceisapiapp","text":"Azure App Services API apps.","title":"Azure.AppService.IsAPIApp"},{"location":"en/selectors/Azure.AppService.IsAPIApp/#description","text":"Use this selector to filter rules to only run against API apps.","title":"Description"},{"location":"en/selectors/Azure.AppService.IsAPIApp/#examples","text":"","title":"Examples"},{"location":"en/selectors/Azure.AppService.IsAPIApp/#configure-with-yaml-based-rules","text":"Use the with property to set PSRule.Rules.Azure\\Azure.AppService.IsAPIApp . --- # Synopsis: An example rule. apiVersion : github.com/microsoft/PSRule/v1 kind : Rule metadata : name : Local.MyRule spec : with : - PSRule.Rules.Azure\\Azure.AppService.IsAPIApp condition : # Rule logic goes here","title":"Configure with YAML-based rules"},{"location":"en/selectors/Azure.AppService.IsAPIApp/#configure-with-json-based-rules","text":"Use the with property to set PSRule.Rules.Azure\\Azure.AppService.IsAPIApp . { // Synopsis: An example rule. \"apiVersion\" : \"github.com/microsoft/PSRule/v1\" , \"kind\" : \"Rule\" , \"metadata\" : { \"name\" : \"Local.MyRule\" }, \"spec\" : { \"with\" : [ \"PSRule.Rules.Azure\\\\Azure.AppService.IsAPIApp\" ], \"condition\" : { // Rule logic goes here } } }","title":"Configure with JSON-based rules"},{"location":"en/selectors/Azure.AppService.IsAPIApp/#configure-with-powershell-based-rules","text":"Use the -With parameter to set PSRule.Rules.Azure\\Azure.AppService.IsAPIApp . # Synopsis: An example rule. Rule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.AppService.IsAPIApp' { # Rule logic goes here }","title":"Configure with PowerShell-based rules"},{"location":"en/selectors/Azure.AppService.IsFunctionApp/","text":"Azure.AppService.IsFunctionApp # Azure App Services function apps. Description # Use this selector to filter rules to only run against Azure Functions apps. Examples # Configure with YAML-based rules # Use the with property to set PSRule.Rules.Azure\\Azure.AppService.IsFunctionApp . --- # Synopsis: An example rule. apiVersion : github.com/microsoft/PSRule/v1 kind : Rule metadata : name : Local.MyRule spec : with : - PSRule.Rules.Azure\\Azure.AppService.IsFunctionApp condition : # Rule logic goes here Configure with JSON-based rules # Use the with property to set PSRule.Rules.Azure\\Azure.AppService.IsFunctionApp . { // Synopsis: An example rule. \"apiVersion\" : \"github.com/microsoft/PSRule/v1\" , \"kind\" : \"Rule\" , \"metadata\" : { \"name\" : \"Local.MyRule\" }, \"spec\" : { \"with\" : [ \"PSRule.Rules.Azure\\\\Azure.AppService.IsFunctionApp\" ], \"condition\" : { // Rule logic goes here } } } Configure with PowerShell-based rules # Use the -With parameter to set PSRule.Rules.Azure\\Azure.AppService.IsFunctionApp . # Synopsis: An example rule. Rule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.AppService.IsFunctionApp' { # Rule logic goes here }","title":"Azure.AppService.IsFunctionApp"},{"location":"en/selectors/Azure.AppService.IsFunctionApp/#azureappserviceisfunctionapp","text":"Azure App Services function apps.","title":"Azure.AppService.IsFunctionApp"},{"location":"en/selectors/Azure.AppService.IsFunctionApp/#description","text":"Use this selector to filter rules to only run against Azure Functions apps.","title":"Description"},{"location":"en/selectors/Azure.AppService.IsFunctionApp/#examples","text":"","title":"Examples"},{"location":"en/selectors/Azure.AppService.IsFunctionApp/#configure-with-yaml-based-rules","text":"Use the with property to set PSRule.Rules.Azure\\Azure.AppService.IsFunctionApp . --- # Synopsis: An example rule. apiVersion : github.com/microsoft/PSRule/v1 kind : Rule metadata : name : Local.MyRule spec : with : - PSRule.Rules.Azure\\Azure.AppService.IsFunctionApp condition : # Rule logic goes here","title":"Configure with YAML-based rules"},{"location":"en/selectors/Azure.AppService.IsFunctionApp/#configure-with-json-based-rules","text":"Use the with property to set PSRule.Rules.Azure\\Azure.AppService.IsFunctionApp . { // Synopsis: An example rule. \"apiVersion\" : \"github.com/microsoft/PSRule/v1\" , \"kind\" : \"Rule\" , \"metadata\" : { \"name\" : \"Local.MyRule\" }, \"spec\" : { \"with\" : [ \"PSRule.Rules.Azure\\\\Azure.AppService.IsFunctionApp\" ], \"condition\" : { // Rule logic goes here } } }","title":"Configure with JSON-based rules"},{"location":"en/selectors/Azure.AppService.IsFunctionApp/#configure-with-powershell-based-rules","text":"Use the -With parameter to set PSRule.Rules.Azure\\Azure.AppService.IsFunctionApp . # Synopsis: An example rule. Rule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.AppService.IsFunctionApp' { # Rule logic goes here }","title":"Configure with PowerShell-based rules"},{"location":"en/selectors/Azure.AppService.IsLogicApp/","text":"Azure.AppService.IsLogicApp # Single tenanted Logic Apps. Description # Use this selector to filter rules to only run against Logic Apps with the Standard SKU. Examples # Configure with YAML-based rules # Use the with property to set PSRule.Rules.Azure\\Azure.AppService.IsLogicApp . --- # Synopsis: An example rule. apiVersion : github.com/microsoft/PSRule/v1 kind : Rule metadata : name : Local.MyRule spec : with : - PSRule.Rules.Azure\\Azure.AppService.IsLogicApp condition : # Rule logic goes here Configure with JSON-based rules # Use the with property to set PSRule.Rules.Azure\\Azure.AppService.IsLogicApp . { // Synopsis: An example rule. \"apiVersion\" : \"github.com/microsoft/PSRule/v1\" , \"kind\" : \"Rule\" , \"metadata\" : { \"name\" : \"Local.MyRule\" }, \"spec\" : { \"with\" : [ \"PSRule.Rules.Azure\\\\Azure.AppService.IsLogicApp\" ], \"condition\" : { // Rule logic goes here } } } Configure with PowerShell-based rules # Use the -With parameter to set PSRule.Rules.Azure\\Azure.AppService.IsLogicApp . # Synopsis: An example rule. Rule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.AppService.IsLogicApp' { # Rule logic goes here }","title":"Azure.AppService.IsLogicApp"},{"location":"en/selectors/Azure.AppService.IsLogicApp/#azureappserviceislogicapp","text":"Single tenanted Logic Apps.","title":"Azure.AppService.IsLogicApp"},{"location":"en/selectors/Azure.AppService.IsLogicApp/#description","text":"Use this selector to filter rules to only run against Logic Apps with the Standard SKU.","title":"Description"},{"location":"en/selectors/Azure.AppService.IsLogicApp/#examples","text":"","title":"Examples"},{"location":"en/selectors/Azure.AppService.IsLogicApp/#configure-with-yaml-based-rules","text":"Use the with property to set PSRule.Rules.Azure\\Azure.AppService.IsLogicApp . --- # Synopsis: An example rule. apiVersion : github.com/microsoft/PSRule/v1 kind : Rule metadata : name : Local.MyRule spec : with : - PSRule.Rules.Azure\\Azure.AppService.IsLogicApp condition : # Rule logic goes here","title":"Configure with YAML-based rules"},{"location":"en/selectors/Azure.AppService.IsLogicApp/#configure-with-json-based-rules","text":"Use the with property to set PSRule.Rules.Azure\\Azure.AppService.IsLogicApp . { // Synopsis: An example rule. \"apiVersion\" : \"github.com/microsoft/PSRule/v1\" , \"kind\" : \"Rule\" , \"metadata\" : { \"name\" : \"Local.MyRule\" }, \"spec\" : { \"with\" : [ \"PSRule.Rules.Azure\\\\Azure.AppService.IsLogicApp\" ], \"condition\" : { // Rule logic goes here } } }","title":"Configure with JSON-based rules"},{"location":"en/selectors/Azure.AppService.IsLogicApp/#configure-with-powershell-based-rules","text":"Use the -With parameter to set PSRule.Rules.Azure\\Azure.AppService.IsLogicApp . # Synopsis: An example rule. Rule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.AppService.IsLogicApp' { # Rule logic goes here }","title":"Configure with PowerShell-based rules"},{"location":"en/selectors/Azure.AppService.IsWebApp/","text":"Azure.AppService.IsWebApp # Azure App Services web apps. Description # Use this selector to filter rules to only run against web apps. Examples # Configure with YAML-based rules # Use the with property to set PSRule.Rules.Azure\\Azure.AppService.IsWebApp . --- # Synopsis: An example rule. apiVersion : github.com/microsoft/PSRule/v1 kind : Rule metadata : name : Local.MyRule spec : with : - PSRule.Rules.Azure\\Azure.AppService.IsWebApp condition : # Rule logic goes here Configure with JSON-based rules # Use the with property to set PSRule.Rules.Azure\\Azure.AppService.IsWebApp . { // Synopsis: An example rule. \"apiVersion\" : \"github.com/microsoft/PSRule/v1\" , \"kind\" : \"Rule\" , \"metadata\" : { \"name\" : \"Local.MyRule\" }, \"spec\" : { \"with\" : [ \"PSRule.Rules.Azure\\\\Azure.AppService.IsWebApp\" ], \"condition\" : { // Rule logic goes here } } } Configure with PowerShell-based rules # Use the -With parameter to set PSRule.Rules.Azure\\Azure.AppService.IsWebApp . # Synopsis: An example rule. Rule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.AppService.IsWebApp' { # Rule logic goes here }","title":"Azure.AppService.IsWebApp"},{"location":"en/selectors/Azure.AppService.IsWebApp/#azureappserviceiswebapp","text":"Azure App Services web apps.","title":"Azure.AppService.IsWebApp"},{"location":"en/selectors/Azure.AppService.IsWebApp/#description","text":"Use this selector to filter rules to only run against web apps.","title":"Description"},{"location":"en/selectors/Azure.AppService.IsWebApp/#examples","text":"","title":"Examples"},{"location":"en/selectors/Azure.AppService.IsWebApp/#configure-with-yaml-based-rules","text":"Use the with property to set PSRule.Rules.Azure\\Azure.AppService.IsWebApp . --- # Synopsis: An example rule. apiVersion : github.com/microsoft/PSRule/v1 kind : Rule metadata : name : Local.MyRule spec : with : - PSRule.Rules.Azure\\Azure.AppService.IsWebApp condition : # Rule logic goes here","title":"Configure with YAML-based rules"},{"location":"en/selectors/Azure.AppService.IsWebApp/#configure-with-json-based-rules","text":"Use the with property to set PSRule.Rules.Azure\\Azure.AppService.IsWebApp . { // Synopsis: An example rule. \"apiVersion\" : \"github.com/microsoft/PSRule/v1\" , \"kind\" : \"Rule\" , \"metadata\" : { \"name\" : \"Local.MyRule\" }, \"spec\" : { \"with\" : [ \"PSRule.Rules.Azure\\\\Azure.AppService.IsWebApp\" ], \"condition\" : { // Rule logic goes here } } }","title":"Configure with JSON-based rules"},{"location":"en/selectors/Azure.AppService.IsWebApp/#configure-with-powershell-based-rules","text":"Use the -With parameter to set PSRule.Rules.Azure\\Azure.AppService.IsWebApp . # Synopsis: An example rule. Rule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.AppService.IsWebApp' { # Rule logic goes here }","title":"Configure with PowerShell-based rules"},{"location":"en/selectors/Azure.Resource.SupportsTags/","text":"Azure.Resource.SupportsTags # Resources that supports tags. Description # Use this selector to filter rules to only run against resources that support tags. Examples # Configure with YAML-based rules # Use the with property to set PSRule.Rules.Azure\\Azure.Resource.SupportsTags . --- # Synopsis: An example rule. apiVersion : github.com/microsoft/PSRule/v1 kind : Rule metadata : name : Local.MyRule spec : with : - PSRule.Rules.Azure\\Azure.Resource.SupportsTags condition : # Rule logic goes here Configure with JSON-based rules # Use the with property to set PSRule.Rules.Azure\\Azure.Resource.SupportsTags . { // Synopsis: An example rule. \"apiVersion\" : \"github.com/microsoft/PSRule/v1\" , \"kind\" : \"Rule\" , \"metadata\" : { \"name\" : \"Local.MyRule\" }, \"spec\" : { \"with\" : [ \"PSRule.Rules.Azure\\\\Azure.Resource.SupportsTags\" ], \"condition\" : { // Rule logic goes here } } } Configure with PowerShell-based rules # Use the -With parameter to set PSRule.Rules.Azure\\Azure.Resource.SupportsTags . # Synopsis: An example rule. Rule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.Resource.SupportsTags' { # Rule logic goes here }","title":"Azure.Resource.SupportsTags"},{"location":"en/selectors/Azure.Resource.SupportsTags/#azureresourcesupportstags","text":"Resources that supports tags.","title":"Azure.Resource.SupportsTags"},{"location":"en/selectors/Azure.Resource.SupportsTags/#description","text":"Use this selector to filter rules to only run against resources that support tags.","title":"Description"},{"location":"en/selectors/Azure.Resource.SupportsTags/#examples","text":"","title":"Examples"},{"location":"en/selectors/Azure.Resource.SupportsTags/#configure-with-yaml-based-rules","text":"Use the with property to set PSRule.Rules.Azure\\Azure.Resource.SupportsTags . --- # Synopsis: An example rule. apiVersion : github.com/microsoft/PSRule/v1 kind : Rule metadata : name : Local.MyRule spec : with : - PSRule.Rules.Azure\\Azure.Resource.SupportsTags condition : # Rule logic goes here","title":"Configure with YAML-based rules"},{"location":"en/selectors/Azure.Resource.SupportsTags/#configure-with-json-based-rules","text":"Use the with property to set PSRule.Rules.Azure\\Azure.Resource.SupportsTags . { // Synopsis: An example rule. \"apiVersion\" : \"github.com/microsoft/PSRule/v1\" , \"kind\" : \"Rule\" , \"metadata\" : { \"name\" : \"Local.MyRule\" }, \"spec\" : { \"with\" : [ \"PSRule.Rules.Azure\\\\Azure.Resource.SupportsTags\" ], \"condition\" : { // Rule logic goes here } } }","title":"Configure with JSON-based rules"},{"location":"en/selectors/Azure.Resource.SupportsTags/#configure-with-powershell-based-rules","text":"Use the -With parameter to set PSRule.Rules.Azure\\Azure.Resource.SupportsTags . # Synopsis: An example rule. Rule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.Resource.SupportsTags' { # Rule logic goes here }","title":"Configure with PowerShell-based rules"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/","text":"Validate Azure resources from templates with Azure Pipelines # Azure Resource Manager (ARM) templates are a JSON-based file structure. ARM templates are typically not static, they include parameters, functions and conditions. Depending on the parameters provided to a template, resources may differ significantly. Important resource properties that should be validated are often variables, parameters or deployed conditionally. Under these circumstances, to correctly validate resources in a template, parameters must be resolved. The following scenario shows how PSRule can be used to validate Azure resource templates within an Azure Pipeline. This scenario covers the following: Installing PSRule extension Linking parameter files to templates Creating a YAML pipeline Installing Azure rules Exporting resource data for analysis Validating exported resources Generating NUnit output Complete example Installing PSRule extension # PSRule includes an extension that can be installed from the Visual Studio Marketplace . Once installed, Azure Pipelines tasks are available to install PSRule modules and run analysis. Linking parameter files to templates # ARM template parameter files allows parameters for a deployment to be saved and checked into source control. PSRule can automatically resolve ARM templates from parameter files by using a metadata link. To link a parameter file to an ARM template add the metadata.template property within a parameter file. For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"template\" : \"./azuredeploy.json\" }, \"parameters\" : { \"vnetName\" : { \"value\" : \"vnet-001\" }, \"addressPrefix\" : { \"value\" : [ \"10.1.0.0/24\" ] } } } In the example parameter file azuredeploy.parameters.json is linked to the template azuredeploy.json . The prefix of ./ indicates that the template file is in a relative path to the parameter file. If ./ is not included, PSRule will look for the template relative to the working directory. For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"template\" : \"templates/vnet-hub/v1/template.json\" }, \"parameters\" : { \"vnetName\" : { \"value\" : \"vnet-001\" }, \"addressPrefix\" : { \"value\" : [ \"10.1.0.0/24\" ] } } } Creating a YAML pipeline # Azure Pipelines supports defining pipelines in YAML. PSRule uses a number of configurable task steps to install modules, export data and perform analysis. Installing Azure rules # To install the module containing Azure rules use the ps-rule-install YAML task. # Install PSRule.Rules.Azure from the PowerShell Gallery. - task : ps-rule-install@2 inputs : module : PSRule.Rules.Azure # Install PSRule.Rules.Azure from the PowerShell Gallery. Exporting resource data for analysis # PSRule provides a pre-built cmdlets for finding template files within a path and exporting resource data. Get-AzRuleTemplateLink finds linked templates from parameter files. By default, parameter files with the *.parameters.json extension are discovered. Files are found recursively from the current working path. Export-AzRuleTemplateData exports resource data from template files. To generate data for analysis use a PowerShell YAML task to export resource data from linked templates. # Export resource data from parameter files within the current working directory. - powershell : Get-AzRuleTemplateLink | Export-AzRuleTemplateData -OutputPath out/templates/; displayName : 'Export template data' If parameter files are located in a specific sub-directory the path can be updated as follows. # Export resource data from parameter files in the deployments/ sub-directory. - powershell : Get-AzRuleTemplateLink ./deployments/ | Export-AzRuleTemplateData -OutputPath out/templates/; displayName : 'Export template data' If parameter files do not use the file extension .parameters.json input path can be set. # Export resource data from parameter files ending in *.json instead of default *.parameters.json. - powershell : Get-AzRuleTemplateLink -InputPath *.json | Export-AzRuleTemplateData -OutputPath out/templates/; displayName : 'Export template data' In both cases, resource data for analysis is exported to out/templates/ . Validating exported resources # To validate exported resources use the ps-rule-assert YAML task. The following task uses previously exported resource data for analysis. # Run analysis from JSON files using the `PSRule.Rules.Azure` module and custom rules from `.ps-rule/`. - task : ps-rule-assert@2 inputs : inputType : inputPath inputPath : 'out/templates/*.json' # Read exported resource data from 'out/templates/'. modules : 'PSRule.Rules.Azure' # Analyze objects using the rules within the PSRule.Rules.Azure PowerShell module. # Optionally, also analyze objects using custom rules from '.ps-rule/'. source : '.ps-rule/' # Optionally, save results to an NUnit report. outputFormat : NUnit3 outputPath : reports/ps-rule-resources.xml In the example: Resource data is read from out/templates/ . If custom rules are defined in the .ps-rule/ these are also evaluated. Validation results are saved as an NUnit report. Generating NUnit output # NUnit is a popular unit test framework for .NET. PSRule supports publishing validation results in the NUnit format. With Azure DevOps, an NUnit report can be published using Publish Test Results task . An example YAML snippet is included below: # Publish NUnit report as test results - task : PublishTestResults@2 displayName : 'Publish PSRule results' inputs : testRunTitle : 'PSRule' # The title to use for the test run. testRunner : NUnit # Import report using the NUnit format. testResultsFiles : 'reports/ps-rule-results.xml' # The previously saved NUnit report. condition : succeededOrFailed() # Run this task if previous steps succeeded of failed. Complete example # Putting each of these steps together. Azure DevOps Pipeline # # # PSRule with Azure Pipelines # trigger : - main pool : vmImage : 'ubuntu-latest' steps : # Install PSRule.Rules.Azure from the PowerShell Gallery - task : ps-rule-install@2 inputs : module : PSRule.Rules.Azure # Install PSRule.Rules.Azure from the PowerShell Gallery. # Export resource data from parameter files within the current working directory. - powershell : Get-AzRuleTemplateLink | Export-AzRuleTemplateData -OutputPath out/templates/; displayName : 'Export template data' # Run analysis from JSON files using the `PSRule.Rules.Azure` module and custom rules from `.ps-rule/`. - task : ps-rule-assert@2 inputs : inputType : inputPath inputPath : 'out/templates/*.json' # Read exported resource data from 'out/templates/'. modules : 'PSRule.Rules.Azure' # Analyze objects using the rules within the PSRule.Rules.Azure PowerShell module. # Optionally, also analyze objects using custom rules from '.ps-rule/'. source : '.ps-rule/' # Optionally, save results to an NUnit report. outputFormat : NUnit3 outputPath : reports/ps-rule-resources.xml # Publish NUnit report as test results - task : PublishTestResults@2 displayName : 'Publish PSRule results' inputs : testRunTitle : 'PSRule' # The title to use for the test run. testRunner : NUnit # Import report using the NUnit format. testResultsFiles : 'reports/ps-rule-*.xml' # Use previously saved NUnit reports. mergeTestResults : true # Merge multiple reports. condition : succeededOrFailed() # Run this task if previous steps succeeded of failed. More information # azure-pipelines.yaml - An example Azure DevOps Pipeline. azuredeploy.json - An example template file. azuredeploy.parameters.json - An example parameters file.","title":"Validate Azure resources from templates with Azure Pipelines"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#validate-azure-resources-from-templates-with-azure-pipelines","text":"Azure Resource Manager (ARM) templates are a JSON-based file structure. ARM templates are typically not static, they include parameters, functions and conditions. Depending on the parameters provided to a template, resources may differ significantly. Important resource properties that should be validated are often variables, parameters or deployed conditionally. Under these circumstances, to correctly validate resources in a template, parameters must be resolved. The following scenario shows how PSRule can be used to validate Azure resource templates within an Azure Pipeline. This scenario covers the following: Installing PSRule extension Linking parameter files to templates Creating a YAML pipeline Installing Azure rules Exporting resource data for analysis Validating exported resources Generating NUnit output Complete example","title":"Validate Azure resources from templates with Azure Pipelines"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#installing-psrule-extension","text":"PSRule includes an extension that can be installed from the Visual Studio Marketplace . Once installed, Azure Pipelines tasks are available to install PSRule modules and run analysis.","title":"Installing PSRule extension"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#linking-parameter-files-to-templates","text":"ARM template parameter files allows parameters for a deployment to be saved and checked into source control. PSRule can automatically resolve ARM templates from parameter files by using a metadata link. To link a parameter file to an ARM template add the metadata.template property within a parameter file. For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"template\" : \"./azuredeploy.json\" }, \"parameters\" : { \"vnetName\" : { \"value\" : \"vnet-001\" }, \"addressPrefix\" : { \"value\" : [ \"10.1.0.0/24\" ] } } } In the example parameter file azuredeploy.parameters.json is linked to the template azuredeploy.json . The prefix of ./ indicates that the template file is in a relative path to the parameter file. If ./ is not included, PSRule will look for the template relative to the working directory. For example: { \"$schema\" : \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\" , \"contentVersion\" : \"1.0.0.0\" , \"metadata\" : { \"template\" : \"templates/vnet-hub/v1/template.json\" }, \"parameters\" : { \"vnetName\" : { \"value\" : \"vnet-001\" }, \"addressPrefix\" : { \"value\" : [ \"10.1.0.0/24\" ] } } }","title":"Linking parameter files to templates"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#creating-a-yaml-pipeline","text":"Azure Pipelines supports defining pipelines in YAML. PSRule uses a number of configurable task steps to install modules, export data and perform analysis.","title":"Creating a YAML pipeline"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#installing-azure-rules","text":"To install the module containing Azure rules use the ps-rule-install YAML task. # Install PSRule.Rules.Azure from the PowerShell Gallery. - task : ps-rule-install@2 inputs : module : PSRule.Rules.Azure # Install PSRule.Rules.Azure from the PowerShell Gallery.","title":"Installing Azure rules"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#exporting-resource-data-for-analysis","text":"PSRule provides a pre-built cmdlets for finding template files within a path and exporting resource data. Get-AzRuleTemplateLink finds linked templates from parameter files. By default, parameter files with the *.parameters.json extension are discovered. Files are found recursively from the current working path. Export-AzRuleTemplateData exports resource data from template files. To generate data for analysis use a PowerShell YAML task to export resource data from linked templates. # Export resource data from parameter files within the current working directory. - powershell : Get-AzRuleTemplateLink | Export-AzRuleTemplateData -OutputPath out/templates/; displayName : 'Export template data' If parameter files are located in a specific sub-directory the path can be updated as follows. # Export resource data from parameter files in the deployments/ sub-directory. - powershell : Get-AzRuleTemplateLink ./deployments/ | Export-AzRuleTemplateData -OutputPath out/templates/; displayName : 'Export template data' If parameter files do not use the file extension .parameters.json input path can be set. # Export resource data from parameter files ending in *.json instead of default *.parameters.json. - powershell : Get-AzRuleTemplateLink -InputPath *.json | Export-AzRuleTemplateData -OutputPath out/templates/; displayName : 'Export template data' In both cases, resource data for analysis is exported to out/templates/ .","title":"Exporting resource data for analysis"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#validating-exported-resources","text":"To validate exported resources use the ps-rule-assert YAML task. The following task uses previously exported resource data for analysis. # Run analysis from JSON files using the `PSRule.Rules.Azure` module and custom rules from `.ps-rule/`. - task : ps-rule-assert@2 inputs : inputType : inputPath inputPath : 'out/templates/*.json' # Read exported resource data from 'out/templates/'. modules : 'PSRule.Rules.Azure' # Analyze objects using the rules within the PSRule.Rules.Azure PowerShell module. # Optionally, also analyze objects using custom rules from '.ps-rule/'. source : '.ps-rule/' # Optionally, save results to an NUnit report. outputFormat : NUnit3 outputPath : reports/ps-rule-resources.xml In the example: Resource data is read from out/templates/ . If custom rules are defined in the .ps-rule/ these are also evaluated. Validation results are saved as an NUnit report.","title":"Validating exported resources"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#generating-nunit-output","text":"NUnit is a popular unit test framework for .NET. PSRule supports publishing validation results in the NUnit format. With Azure DevOps, an NUnit report can be published using Publish Test Results task . An example YAML snippet is included below: # Publish NUnit report as test results - task : PublishTestResults@2 displayName : 'Publish PSRule results' inputs : testRunTitle : 'PSRule' # The title to use for the test run. testRunner : NUnit # Import report using the NUnit format. testResultsFiles : 'reports/ps-rule-results.xml' # The previously saved NUnit report. condition : succeededOrFailed() # Run this task if previous steps succeeded of failed.","title":"Generating NUnit output"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#complete-example","text":"Putting each of these steps together.","title":"Complete example"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#azure-devops-pipeline","text":"# # PSRule with Azure Pipelines # trigger : - main pool : vmImage : 'ubuntu-latest' steps : # Install PSRule.Rules.Azure from the PowerShell Gallery - task : ps-rule-install@2 inputs : module : PSRule.Rules.Azure # Install PSRule.Rules.Azure from the PowerShell Gallery. # Export resource data from parameter files within the current working directory. - powershell : Get-AzRuleTemplateLink | Export-AzRuleTemplateData -OutputPath out/templates/; displayName : 'Export template data' # Run analysis from JSON files using the `PSRule.Rules.Azure` module and custom rules from `.ps-rule/`. - task : ps-rule-assert@2 inputs : inputType : inputPath inputPath : 'out/templates/*.json' # Read exported resource data from 'out/templates/'. modules : 'PSRule.Rules.Azure' # Analyze objects using the rules within the PSRule.Rules.Azure PowerShell module. # Optionally, also analyze objects using custom rules from '.ps-rule/'. source : '.ps-rule/' # Optionally, save results to an NUnit report. outputFormat : NUnit3 outputPath : reports/ps-rule-resources.xml # Publish NUnit report as test results - task : PublishTestResults@2 displayName : 'Publish PSRule results' inputs : testRunTitle : 'PSRule' # The title to use for the test run. testRunner : NUnit # Import report using the NUnit format. testResultsFiles : 'reports/ps-rule-*.xml' # Use previously saved NUnit reports. mergeTestResults : true # Merge multiple reports. condition : succeededOrFailed() # Run this task if previous steps succeeded of failed.","title":"Azure DevOps Pipeline"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#more-information","text":"azure-pipelines.yaml - An example Azure DevOps Pipeline. azuredeploy.json - An example template file. azuredeploy.parameters.json - An example parameters file.","title":"More information"},{"location":"scenarios/azure-template-ci/azure-template-ci/","text":"Validate Azure resources from templates with continuous integration (CI) # Azure Resource Manager (ARM) templates are a JSON-based file structure. ARM templates are typically not static, they include parameters, functions and conditions. Depending on the parameters provided to a template, resources may differ significantly. Important resource properties that should be validated are often variables, parameters or deployed conditionally. Under these circumstances, to correctly validate resources in a template, parameters must be resolved. The following scenario shows how to validate Azure resources from templates using a generic pipeline. The examples provided can be integrated into a continuous integration (CI) pipeline able to run PowerShell. For integrating into Azure DevOps see Validate Azure resources from templates with Azure Pipelines . This scenario covers the following: Installing PSRule within a CI pipeline Exporting rule data for analysis Validating exported resources Formatting output Failing the pipeline Generating NUnit output Complete example Additional options Installing PSRule within a CI pipeline # Typically, PSRule is not pre-installed on CI worker nodes and must be installed within the pipeline. PSRule PowerShell modules need to be installed prior to calling PSRule cmdlets. If your CI pipeline runs on a persistent virtual machine that you control, consider pre-installing PSRule. The following examples focus on installing PSRule dynamically during execution of the pipeline. Which is suitable for cloud-based CI worker nodes. To install PSRule within a CI pipeline, execute the Install-Module PowerShell cmdlet. Depending on your environment, the CI worker process may not have administrative permissions. To install modules into the current context running the CI pipeline use -Scope CurrentUser . The PowerShell Gallery is not a trusted source by default. Use the -Force switch to suppress a prompt to install modules from PowerShell Gallery. For example: $Null = Install-Module -Name PSRule . Rules . Azure -Scope CurrentUser -Force ; Installing PSRule.Rules.Azure also installs the base PSRule module and associated Azure dependencies. The PSRule.Rules.Azure module includes cmdlets and pre-built rules for validating Azure resources. Using the pre-built rules is completely optional. In some cases, installing NuGet and PowerShellGet may be required to connect to the PowerShell Gallery. The NuGet package provider can be installed using the Install-PackageProvider PowerShell cmdlet. $Null = Install-PackageProvider -Name NuGet -Scope CurrentUser -Force ; The example below includes both steps together with checks: if ( $Null -eq ( Get-PackageProvider -Name NuGet -ErrorAction SilentlyContinue )) { $Null = Install-PackageProvider -Name NuGet -Scope CurrentUser -Force ; } if ( $Null -eq ( Get-InstalledModule -Name PowerShellGet -MinimumVersion 2 . 2 . 1 -ErrorAction Ignore )) { Install-Module PowerShellGet -MinimumVersion 2 . 2 . 1 -Scope CurrentUser -Force -AllowClobber ; } if ( $Null -eq ( Get-InstalledModule -Name PSRule . Rules . Azure -MinimumVersion '0.12.1' -ErrorAction SilentlyContinue )) { $Null = Install-Module -Name PSRule . Rules . Azure -Scope CurrentUser -MinimumVersion '0.12.1' -Force ; } Add -AllowPrerelease to install pre-release versions. See the change log for the latest version. Exporting rule data for analysis # In PSRule, the Export-AzRuleTemplateData cmdlet resolves a template and returns a resultant set of resources. The resultant set of resources can then be validated. No connectivity to Azure is required by default when calling Export-AzRuleTemplateData . Export cmdlet parameters # To run Export-AzRuleTemplateData two key parameters are required: -TemplateFile - An absolute or relative path to the template JSON file. -ParameterFile - An absolute or relative path to one or more parameter JSON files. The -ParameterFile parameter is optional when all parameters defined in the template have defaultValue set. Optionally the following parameters can be used: -Name - The name of the deployment. If not specified a default name of export-<xxxxxxxx> will be used. -OutputPath - An absolute or relative path where the resultant resources will be written to JSON. If not specified the current working path be used. -ResourceGroup - The name of a resource group where the deployment is intended to be run. If not specified placeholder values will be used. -Subscription - The name or subscription Id of a subscription where the deployment is intended to be run. If not specified placeholder values will be used. See cmdlet help for a full list of parameters. If -OutputPath is a directory or is not set, the output file will be automatically named resources-<name>.json . For example: Export-AzRuleTemplateData -TemplateFile .\\ template . json -ParameterFile .\\ parameters . json ; Multiple parameter files that map to the same template can be supplied in a single cmdlet call. Additional templates can be exported by calling Export-AzRuleTemplateData multiple times. Use of placeholder values # A number of functions that can be used within Azure templates retrieve information from Azure. Some examples include reference , subscription , resourceGroup , list* . The default for Export-AzRuleTemplateData is to operate without requiring authenticated connectivity to Azure. As a result, functions that retrieve information from Azure use placeholders such as {{Subscription.SubscriptionId}} . To provide a real value for subscription and resourceGroup use the -Subscription and -ResourceGroup parameters. When using -Subscription and -ResourceGroup the subscription and resource group must already exist. Additionally the context running the cmdlet must have at least read access (i.e. Reader ). It is currently not possible to provide a real value for reference and list* , only placeholders will be used. Key Vault references in parameter files use placeholders instead of the real value to prevent accidental exposure of secrets. Validating exported resources # To validate exported resources use Invoke-PSRule , Assert-PSRule or Test-PSRuleTarget . In a CI pipeline, Assert-PSRule is recommended. Assert-PSRule outputs preformatted results ideal for use within a CI pipeline. Use Assert-PSRule with the resolved resource output as an input using -InputPath . In the following example, resources from .\\resources.json are validated against pre-built rules: Assert-PSRule -InputPath .\\ resources-export -*. json -Module PSRule . Rules . Azure ; Example output: -> vnet-001 : Microsoft.Network/virtualNetworks [PASS] Azure.Resource.UseTags [PASS] Azure.VirtualNetwork.UseNSGs [PASS] Azure.VirtualNetwork.SingleDNS [PASS] Azure.VirtualNetwork.LocalDNS -> vnet-001/subnet2 : Microsoft.Network/virtualNetworks/subnets [FAIL] Azure.Resource.UseTags To process multiple input files a wildcard * can be used. Assert-PSRule -InputPath .\\ out \\*. json -Module PSRule . Rules . Azure ; Formatting output # When executing a CI pipeline, feedback on any validation failures is important. The Assert-PSRule cmdlet provides easy to read formatted output instead of PowerShell objects. Additionally, Assert-PSRule supports styling formatted output for Azure Pipelines and GitHub Actions. Use the -Style AzurePipelines or -Style GitHubActions parameter to style output. For example: Assert-PSRule -InputPath .\\ out \\*. json -Style AzurePipelines -Module PSRule . Rules . Azure ; Failing the pipeline # When using PSRule within a CI pipeline, a failed rule should stop the pipeline. When using Assert-PSRule if any rules fail, an error will be generated. Assert-PSRule : One or more rules reported failure. At line:1 char:1 + Assert-PSRule -Module PSRule.Rules.Azure -InputPath .\\out\\tests\\Resou ... + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ + CategoryInfo : InvalidData: (:) [Assert-PSRule], FailPipelineException + FullyQualifiedErrorId : PSRule.Fail,Assert-PSRule A single PowerShell error is typically enough to stop a CI pipeline. If you are using a different configuration additionally -ErrorAction Stop can be used. For example: Assert-PSRule -Module PSRule . Rules . Azure -InputPath .\\ out \\*. json -ErrorAction Stop ; Generating NUnit output # NUnit is a popular unit test framework for .NET. NUnit generates a test report format that is widely interpreted by CI systems. While PSRule does not use NUnit directly, it support outputting validation results in the NUnit3 format. Using a common format allows integration with any system that supports the NUnit3 for publishing test results. To generate an NUnit report: Use the -OutputFormat NUnit3 parameter. Use the -OutputPath parameter to specify the path of the report file to write. Assert-PSRule -OutputFormat NUnit3 -OutputPath .\\ reports \\ rule-report . xml -Module PSRule . Rules . Azure -InputPath .\\ out \\*. json ; The output path will be created if it does not exist. Complete example # Putting each of these steps together. Install dependencies # # Install dependencies for connecting to PowerShell Gallery if ( $Null -eq ( Get-PackageProvider -Name NuGet -ErrorAction Ignore )) { Install-PackageProvider -Name NuGet -Force -Scope CurrentUser ; } if ( $Null -eq ( Get-InstalledModule -Name PowerShellGet -MinimumVersion 2 . 2 . 1 -ErrorAction Ignore )) { Install-Module PowerShellGet -MinimumVersion 2 . 2 . 1 -Scope CurrentUser -Force -AllowClobber ; } Validate templates # # Install PSRule.Rules.Azure module if ( $Null -eq ( Get-InstalledModule -Name PSRule . Rules . Azure -MinimumVersion '0.12.1' -ErrorAction SilentlyContinue )) { $Null = Install-Module -Name PSRule . Rules . Azure -Scope CurrentUser -MinimumVersion '0.12.1' -Force ; } # Resolve resources Export-AzRuleTemplateData -TemplateFile .\\ template . json -ParameterFile .\\ parameters . json -OutputPath out /; # Validate resources $assertParams = @{ InputPath = 'out/*.json' Module = 'PSRule.Rules.Azure' Style = 'AzurePipelines' OutputFormat = 'NUnit3' OutputPath = 'reports/rule-report.xml' } Assert-PSRule @assertParams ; Additional options # Using Invoke-Build # Invoke-Build is a build automation cmdlet that can be installed from the PowerShell Gallery by installing the InvokeBuild module. Within Invoke-Build, each build process is broken into tasks. The following example shows an example of using PSRule.Rules.Azure with InvokeBuild tasks. # Synopsis: Install PSRule modules task InstallPSRule { if ( $Null -eq ( Get-InstalledModule -Name PSRule . Rules . Azure -MinimumVersion '0.12.1' -ErrorAction SilentlyContinue )) { $Null = Install-Module -Name PSRule . Rules . Azure -Scope CurrentUser -MinimumVersion '0.12.1' -Force ; } } # Synopsis: Run validation task ValidateTemplate InstallPSRule , { # Resolve resources Export-AzRuleTemplateData -TemplateFile .\\ template . json -ParameterFile .\\ parameters . json -OutputPath out /; # Validate resources $assertParams = @{ InputPath = 'out/*.json' Module = 'PSRule.Rules.Azure' Style = 'AzurePipelines' OutputFormat = 'NUnit3' OutputPath = 'reports/rule-report.xml' } Assert-PSRule @assertParams ; } # Synopsis: Run all build tasks task Build ValidateTemplate Invoke-Build Build ; Calling from Pester # Pester is a unit test framework for PowerShell that can be installed from the PowerShell Gallery. Typically, Pester unit tests are built for a particular pipeline. PSRule can complement Pester unit tests by providing dynamic and sharable rules that are easy to reuse. By using -If or -Type pre-conditions, rules can dynamically provide validation for a range of use cases. When calling PSRule from Pester use Invoke-PSRule instead of Assert-PSRule . Invoke-PSRule returns validation result objects that can be tested by Pester Should conditions. Additionally, the Logging.RuleFail option can be included to generate an error message for each failing rule. For example: Describe 'Azure' { Context 'Resource templates' { It 'Use content rules' { Export-AzRuleTemplateData -TemplateFile .\\ template . json -ParameterFile .\\ parameters . json -OutputPath .\\ out \\ resources . json ; # Validate resources $invokeParams = @{ InputPath = 'out/*.json' Module = 'PSRule.Rules.Azure' OutputFormat = 'NUnit3' OutputPath = 'reports/rule-report.xml' Option = ( New-PSRuleOption -LoggingRuleFail Error ) } Invoke-PSRule @invokeParams -Outcome Fail , Error | Should -BeNullOrEmpty ; } } } More information # pipeline-deps.ps1 - Example script installing pipeline dependencies. validate-template.ps1 - Example script for running template validation. template.json - Example template file. parameters.json - Example parameters file.","title":"Validate Azure resources from templates with continuous integration (CI)"},{"location":"scenarios/azure-template-ci/azure-template-ci/#validate-azure-resources-from-templates-with-continuous-integration-ci","text":"Azure Resource Manager (ARM) templates are a JSON-based file structure. ARM templates are typically not static, they include parameters, functions and conditions. Depending on the parameters provided to a template, resources may differ significantly. Important resource properties that should be validated are often variables, parameters or deployed conditionally. Under these circumstances, to correctly validate resources in a template, parameters must be resolved. The following scenario shows how to validate Azure resources from templates using a generic pipeline. The examples provided can be integrated into a continuous integration (CI) pipeline able to run PowerShell. For integrating into Azure DevOps see Validate Azure resources from templates with Azure Pipelines . This scenario covers the following: Installing PSRule within a CI pipeline Exporting rule data for analysis Validating exported resources Formatting output Failing the pipeline Generating NUnit output Complete example Additional options","title":"Validate Azure resources from templates with continuous integration (CI)"},{"location":"scenarios/azure-template-ci/azure-template-ci/#installing-psrule-within-a-ci-pipeline","text":"Typically, PSRule is not pre-installed on CI worker nodes and must be installed within the pipeline. PSRule PowerShell modules need to be installed prior to calling PSRule cmdlets. If your CI pipeline runs on a persistent virtual machine that you control, consider pre-installing PSRule. The following examples focus on installing PSRule dynamically during execution of the pipeline. Which is suitable for cloud-based CI worker nodes. To install PSRule within a CI pipeline, execute the Install-Module PowerShell cmdlet. Depending on your environment, the CI worker process may not have administrative permissions. To install modules into the current context running the CI pipeline use -Scope CurrentUser . The PowerShell Gallery is not a trusted source by default. Use the -Force switch to suppress a prompt to install modules from PowerShell Gallery. For example: $Null = Install-Module -Name PSRule . Rules . Azure -Scope CurrentUser -Force ; Installing PSRule.Rules.Azure also installs the base PSRule module and associated Azure dependencies. The PSRule.Rules.Azure module includes cmdlets and pre-built rules for validating Azure resources. Using the pre-built rules is completely optional. In some cases, installing NuGet and PowerShellGet may be required to connect to the PowerShell Gallery. The NuGet package provider can be installed using the Install-PackageProvider PowerShell cmdlet. $Null = Install-PackageProvider -Name NuGet -Scope CurrentUser -Force ; The example below includes both steps together with checks: if ( $Null -eq ( Get-PackageProvider -Name NuGet -ErrorAction SilentlyContinue )) { $Null = Install-PackageProvider -Name NuGet -Scope CurrentUser -Force ; } if ( $Null -eq ( Get-InstalledModule -Name PowerShellGet -MinimumVersion 2 . 2 . 1 -ErrorAction Ignore )) { Install-Module PowerShellGet -MinimumVersion 2 . 2 . 1 -Scope CurrentUser -Force -AllowClobber ; } if ( $Null -eq ( Get-InstalledModule -Name PSRule . Rules . Azure -MinimumVersion '0.12.1' -ErrorAction SilentlyContinue )) { $Null = Install-Module -Name PSRule . Rules . Azure -Scope CurrentUser -MinimumVersion '0.12.1' -Force ; } Add -AllowPrerelease to install pre-release versions. See the change log for the latest version.","title":"Installing PSRule within a CI pipeline"},{"location":"scenarios/azure-template-ci/azure-template-ci/#exporting-rule-data-for-analysis","text":"In PSRule, the Export-AzRuleTemplateData cmdlet resolves a template and returns a resultant set of resources. The resultant set of resources can then be validated. No connectivity to Azure is required by default when calling Export-AzRuleTemplateData .","title":"Exporting rule data for analysis"},{"location":"scenarios/azure-template-ci/azure-template-ci/#export-cmdlet-parameters","text":"To run Export-AzRuleTemplateData two key parameters are required: -TemplateFile - An absolute or relative path to the template JSON file. -ParameterFile - An absolute or relative path to one or more parameter JSON files. The -ParameterFile parameter is optional when all parameters defined in the template have defaultValue set. Optionally the following parameters can be used: -Name - The name of the deployment. If not specified a default name of export-<xxxxxxxx> will be used. -OutputPath - An absolute or relative path where the resultant resources will be written to JSON. If not specified the current working path be used. -ResourceGroup - The name of a resource group where the deployment is intended to be run. If not specified placeholder values will be used. -Subscription - The name or subscription Id of a subscription where the deployment is intended to be run. If not specified placeholder values will be used. See cmdlet help for a full list of parameters. If -OutputPath is a directory or is not set, the output file will be automatically named resources-<name>.json . For example: Export-AzRuleTemplateData -TemplateFile .\\ template . json -ParameterFile .\\ parameters . json ; Multiple parameter files that map to the same template can be supplied in a single cmdlet call. Additional templates can be exported by calling Export-AzRuleTemplateData multiple times.","title":"Export cmdlet parameters"},{"location":"scenarios/azure-template-ci/azure-template-ci/#use-of-placeholder-values","text":"A number of functions that can be used within Azure templates retrieve information from Azure. Some examples include reference , subscription , resourceGroup , list* . The default for Export-AzRuleTemplateData is to operate without requiring authenticated connectivity to Azure. As a result, functions that retrieve information from Azure use placeholders such as {{Subscription.SubscriptionId}} . To provide a real value for subscription and resourceGroup use the -Subscription and -ResourceGroup parameters. When using -Subscription and -ResourceGroup the subscription and resource group must already exist. Additionally the context running the cmdlet must have at least read access (i.e. Reader ). It is currently not possible to provide a real value for reference and list* , only placeholders will be used. Key Vault references in parameter files use placeholders instead of the real value to prevent accidental exposure of secrets.","title":"Use of placeholder values"},{"location":"scenarios/azure-template-ci/azure-template-ci/#validating-exported-resources","text":"To validate exported resources use Invoke-PSRule , Assert-PSRule or Test-PSRuleTarget . In a CI pipeline, Assert-PSRule is recommended. Assert-PSRule outputs preformatted results ideal for use within a CI pipeline. Use Assert-PSRule with the resolved resource output as an input using -InputPath . In the following example, resources from .\\resources.json are validated against pre-built rules: Assert-PSRule -InputPath .\\ resources-export -*. json -Module PSRule . Rules . Azure ; Example output: -> vnet-001 : Microsoft.Network/virtualNetworks [PASS] Azure.Resource.UseTags [PASS] Azure.VirtualNetwork.UseNSGs [PASS] Azure.VirtualNetwork.SingleDNS [PASS] Azure.VirtualNetwork.LocalDNS -> vnet-001/subnet2 : Microsoft.Network/virtualNetworks/subnets [FAIL] Azure.Resource.UseTags To process multiple input files a wildcard * can be used. Assert-PSRule -InputPath .\\ out \\*. json -Module PSRule . Rules . Azure ;","title":"Validating exported resources"},{"location":"scenarios/azure-template-ci/azure-template-ci/#formatting-output","text":"When executing a CI pipeline, feedback on any validation failures is important. The Assert-PSRule cmdlet provides easy to read formatted output instead of PowerShell objects. Additionally, Assert-PSRule supports styling formatted output for Azure Pipelines and GitHub Actions. Use the -Style AzurePipelines or -Style GitHubActions parameter to style output. For example: Assert-PSRule -InputPath .\\ out \\*. json -Style AzurePipelines -Module PSRule . Rules . Azure ;","title":"Formatting output"},{"location":"scenarios/azure-template-ci/azure-template-ci/#failing-the-pipeline","text":"When using PSRule within a CI pipeline, a failed rule should stop the pipeline. When using Assert-PSRule if any rules fail, an error will be generated. Assert-PSRule : One or more rules reported failure. At line:1 char:1 + Assert-PSRule -Module PSRule.Rules.Azure -InputPath .\\out\\tests\\Resou ... + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ + CategoryInfo : InvalidData: (:) [Assert-PSRule], FailPipelineException + FullyQualifiedErrorId : PSRule.Fail,Assert-PSRule A single PowerShell error is typically enough to stop a CI pipeline. If you are using a different configuration additionally -ErrorAction Stop can be used. For example: Assert-PSRule -Module PSRule . Rules . Azure -InputPath .\\ out \\*. json -ErrorAction Stop ;","title":"Failing the pipeline"},{"location":"scenarios/azure-template-ci/azure-template-ci/#generating-nunit-output","text":"NUnit is a popular unit test framework for .NET. NUnit generates a test report format that is widely interpreted by CI systems. While PSRule does not use NUnit directly, it support outputting validation results in the NUnit3 format. Using a common format allows integration with any system that supports the NUnit3 for publishing test results. To generate an NUnit report: Use the -OutputFormat NUnit3 parameter. Use the -OutputPath parameter to specify the path of the report file to write. Assert-PSRule -OutputFormat NUnit3 -OutputPath .\\ reports \\ rule-report . xml -Module PSRule . Rules . Azure -InputPath .\\ out \\*. json ; The output path will be created if it does not exist.","title":"Generating NUnit output"},{"location":"scenarios/azure-template-ci/azure-template-ci/#complete-example","text":"Putting each of these steps together.","title":"Complete example"},{"location":"scenarios/azure-template-ci/azure-template-ci/#install-dependencies","text":"# Install dependencies for connecting to PowerShell Gallery if ( $Null -eq ( Get-PackageProvider -Name NuGet -ErrorAction Ignore )) { Install-PackageProvider -Name NuGet -Force -Scope CurrentUser ; } if ( $Null -eq ( Get-InstalledModule -Name PowerShellGet -MinimumVersion 2 . 2 . 1 -ErrorAction Ignore )) { Install-Module PowerShellGet -MinimumVersion 2 . 2 . 1 -Scope CurrentUser -Force -AllowClobber ; }","title":"Install dependencies"},{"location":"scenarios/azure-template-ci/azure-template-ci/#validate-templates","text":"# Install PSRule.Rules.Azure module if ( $Null -eq ( Get-InstalledModule -Name PSRule . Rules . Azure -MinimumVersion '0.12.1' -ErrorAction SilentlyContinue )) { $Null = Install-Module -Name PSRule . Rules . Azure -Scope CurrentUser -MinimumVersion '0.12.1' -Force ; } # Resolve resources Export-AzRuleTemplateData -TemplateFile .\\ template . json -ParameterFile .\\ parameters . json -OutputPath out /; # Validate resources $assertParams = @{ InputPath = 'out/*.json' Module = 'PSRule.Rules.Azure' Style = 'AzurePipelines' OutputFormat = 'NUnit3' OutputPath = 'reports/rule-report.xml' } Assert-PSRule @assertParams ;","title":"Validate templates"},{"location":"scenarios/azure-template-ci/azure-template-ci/#additional-options","text":"","title":"Additional options"},{"location":"scenarios/azure-template-ci/azure-template-ci/#using-invoke-build","text":"Invoke-Build is a build automation cmdlet that can be installed from the PowerShell Gallery by installing the InvokeBuild module. Within Invoke-Build, each build process is broken into tasks. The following example shows an example of using PSRule.Rules.Azure with InvokeBuild tasks. # Synopsis: Install PSRule modules task InstallPSRule { if ( $Null -eq ( Get-InstalledModule -Name PSRule . Rules . Azure -MinimumVersion '0.12.1' -ErrorAction SilentlyContinue )) { $Null = Install-Module -Name PSRule . Rules . Azure -Scope CurrentUser -MinimumVersion '0.12.1' -Force ; } } # Synopsis: Run validation task ValidateTemplate InstallPSRule , { # Resolve resources Export-AzRuleTemplateData -TemplateFile .\\ template . json -ParameterFile .\\ parameters . json -OutputPath out /; # Validate resources $assertParams = @{ InputPath = 'out/*.json' Module = 'PSRule.Rules.Azure' Style = 'AzurePipelines' OutputFormat = 'NUnit3' OutputPath = 'reports/rule-report.xml' } Assert-PSRule @assertParams ; } # Synopsis: Run all build tasks task Build ValidateTemplate Invoke-Build Build ;","title":"Using Invoke-Build"},{"location":"scenarios/azure-template-ci/azure-template-ci/#calling-from-pester","text":"Pester is a unit test framework for PowerShell that can be installed from the PowerShell Gallery. Typically, Pester unit tests are built for a particular pipeline. PSRule can complement Pester unit tests by providing dynamic and sharable rules that are easy to reuse. By using -If or -Type pre-conditions, rules can dynamically provide validation for a range of use cases. When calling PSRule from Pester use Invoke-PSRule instead of Assert-PSRule . Invoke-PSRule returns validation result objects that can be tested by Pester Should conditions. Additionally, the Logging.RuleFail option can be included to generate an error message for each failing rule. For example: Describe 'Azure' { Context 'Resource templates' { It 'Use content rules' { Export-AzRuleTemplateData -TemplateFile .\\ template . json -ParameterFile .\\ parameters . json -OutputPath .\\ out \\ resources . json ; # Validate resources $invokeParams = @{ InputPath = 'out/*.json' Module = 'PSRule.Rules.Azure' OutputFormat = 'NUnit3' OutputPath = 'reports/rule-report.xml' Option = ( New-PSRuleOption -LoggingRuleFail Error ) } Invoke-PSRule @invokeParams -Outcome Fail , Error | Should -BeNullOrEmpty ; } } }","title":"Calling from Pester"},{"location":"scenarios/azure-template-ci/azure-template-ci/#more-information","text":"pipeline-deps.ps1 - Example script installing pipeline dependencies. validate-template.ps1 - Example script for running template validation. template.json - Example template file. parameters.json - Example parameters file.","title":"More information"},{"location":"setup/configuring-expansion/","text":"Configuring expansion # PSRule for Azure can automatically resolve Azure resource context at runtime from infrastructure code. This feature can be enabled by using the following configuration options. Configuration # Tip Each of these configuration options are set within the ps-rule.yaml file. To learn how to set configuration options see Configuring options . Parameter file expansion # v1.4.1 This configuration option determines if Azure template parameter files will automatically be expanded. By default, parameter files will not be automatically expanded. When enabled, PSRule will discover and expand JSON parameter files for Azure templates or Bicep modules. Parameter files are expanded when PSRule cmdlets with the -Format File parameter are used. Syntax: configuration : AZURE_PARAMETER_FILE_EXPANSION : bool Default: # YAML: The default AZURE_PARAMETER_FILE_EXPANSION configuration option configuration : AZURE_PARAMETER_FILE_EXPANSION : false Example: # YAML: Set the AZURE_PARAMETER_FILE_EXPANSION configuration option to enable expansion configuration : AZURE_PARAMETER_FILE_EXPANSION : true Bicep source expansion # v1.11.0 This configuration option determines if Azure Bicep source files will automatically be expanded. By default, Bicep files will not be automatically expanded. Bicep files are expanded when PSRule cmdlets with the -Format File parameter are used. Syntax: configuration : AZURE_BICEP_FILE_EXPANSION : bool Default: # YAML: The default AZURE_BICEP_FILE_EXPANSION configuration option configuration : AZURE_BICEP_FILE_EXPANSION : false Example: # YAML: Set the AZURE_BICEP_FILE_EXPANSION configuration option to enable expansion configuration : AZURE_BICEP_FILE_EXPANSION : true Bicep compilation timeout # v1.13.3 This configuration option determines the maximum time to spend building a single Bicep source file. The timeout is configured in seconds. When a timeout occurs, PSRule for Azure stops the build and returns an error. Any resources contained within Bicep source files that exceeded the timeout are not analyzed. The default timeout is 5 seconds, however the timeout can be set to an integer between 1 and 120 . Syntax: configuration : AZURE_BICEP_FILE_EXPANSION_TIMEOUT : int Default: # YAML: The default AZURE_BICEP_FILE_EXPANSION_TIMEOUT configuration option configuration : AZURE_BICEP_FILE_EXPANSION_TIMEOUT : 5 Example: # YAML: Set the AZURE_BICEP_FILE_EXPANSION_TIMEOUT configuration option to enable expansion configuration : AZURE_BICEP_FILE_EXPANSION_TIMEOUT : 15 Require template metadata link # v1.7.0 This configuration option determines if Azure template parameter files require a metadata link. When configured to true , the Azure.Template.MetadataLink rule is enabled. Any Azure template parameter files that do not include a metadata link will report a fail for this rule. The rule Azure.Template.MetadataLink is not enabled by default. Additionally, when enabled this rule can still be excluded or suppressed like all other rules. Syntax: configuration : AZURE_PARAMETER_FILE_METADATA_LINK : bool Default: # YAML: The default AZURE_PARAMETER_FILE_METADATA_LINK configuration option configuration : AZURE_PARAMETER_FILE_METADATA_LINK : false Example: # YAML: Set the AZURE_PARAMETER_FILE_METADATA_LINK configuration option to enable expansion configuration : AZURE_PARAMETER_FILE_METADATA_LINK : true Deployment properties # v1.17.0 This configuration option sets the deployment object use by the deployment() function. Configure this option to change the details of the deployment when exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below. This configuration option applies to the parent deployment. Nested deployments will use any properties configured within code. Additionally, this configuration option will be ignore when -Name is used with Export-AzRuleTemplateData . Syntax: configuration : AZURE_DEPLOYMENT : name : string Default: # YAML: The default AZURE_DEPLOYMENT configuration option configuration : AZURE_DEPLOYMENT : name : 'ps-rule-test-deployment' Example: # YAML: Override the name of the deployment object. configuration : AZURE_DEPLOYMENT : name : 'deploy-web-application' Deployment resource group # v1.1.0 This configuration option sets the resource group object used by the resourceGroup() function. Configure this option to change the resource group object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below. This configuration option will be ignored when -ResourceGroup is used with Export-AzRuleTemplateData . Syntax: configuration : AZURE_RESOURCE_GROUP : name : string location : string tags : object properties : provisioningState : string Default: # YAML: The default AZURE_RESOURCE_GROUP configuration option configuration : AZURE_RESOURCE_GROUP : name : 'ps-rule-test-rg' location : 'eastus' tags : { } properties : provisioningState : 'Succeeded' Example: # YAML: Override the location of the resource group object. configuration : AZURE_RESOURCE_GROUP : location : 'australiasoutheast' Deployment subscription # v1.1.0 This configuration option sets the subscription object used by the subscription() function. Configure this option to change the subscription object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below. This configuration option will be ignored when -Subscription is used with Export-AzRuleTemplateData . Syntax: configuration : AZURE_SUBSCRIPTION : subscriptionId : string displayName : string state : string Default: # YAML: The default AZURE_SUBSCRIPTION configuration option configuration : AZURE_SUBSCRIPTION : subscriptionId : 'ffffffff-ffff-ffff-ffff-ffffffffffff' displayName : 'PSRule Test Subscription' state : 'NotDefined' Example: # YAML: Override the display name of the subscription object configuration : AZURE_SUBSCRIPTION : displayName : 'My test subscription' Deployment tenant # v1.11.0 This configuration option sets the tenant object used by the tenant() function. Configure this option to change the tenant object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below. Syntax: configuration : AZURE_TENANT : countryCode : string tenantId : string displayName : string Default: # YAML: The default AZURE_TENANT configuration option configuration : AZURE_TENANT : countryCode : 'US' tenantId : 'ffffffff-ffff-ffff-ffff-ffffffffffff' displayName : 'PSRule' Example: # YAML: Override the display name of the tenant object configuration : AZURE_TENANT : displayName : 'Contoso' Deployment management group # v1.11.0 This configuration option sets the management group object used by the managementGroup() function. Configure this option to change the management group object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below. Syntax: configuration : AZURE_MANAGEMENT_GROUP : name : string properties : displayName : string Default: # YAML: The default AZURE_MANAGEMENT_GROUP configuration option configuration : AZURE_MANAGEMENT_GROUP : name : 'psrule-test' properties : displyName : 'PSRule Test Management Group' Example: # YAML: Override the display name of the management group object configuration : AZURE_MANAGEMENT_GROUP : properties : displayName : 'My test management group' Required parameter defaults # v1.13.0 This configuration option allows a fallback value to be configured for required parameters. When a parameter value is not provided and a default is not set, the fallback value will be used. Configure this option when you are providing a set of common parameters dynamically during a pipeline. In this scenario, it may not make sense to add the parameters to a parameter file or Bicep deployment. Syntax: configuration : AZURE_PARAMETER_DEFAULTS : <parameter> : <value> Default: # YAML: The default AZURE_PARAMETER_DEFAULTS configuration option configuration : AZURE_PARAMETER_DEFAULTS : { } Example: # YAML: Set fallback values for adminPassword and workspaceId parameters. configuration : AZURE_PARAMETER_DEFAULTS : adminPassword : $CREDENTIAL_PLACEHOLDER$ workspaceId : /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.OperationalInsights/workspaces/{workspaceName} Excluding files # Template or Bicep source files can be excluded from being processed by PSRule and expansion. To exclude a file, configure the input.pathIgnore option by providing a path spec to ignore. Syntax: input : pathIgnore : - string - string Default: # YAML: The default input.pathIgnore option input : pathIgnore : [] Example: # YAML: Exclude a file from being processed by PSRule and expansion input : pathIgnore : - 'out/' - 'modules/**/*.bicep'","title":"Configuring expansion"},{"location":"setup/configuring-expansion/#configuring-expansion","text":"PSRule for Azure can automatically resolve Azure resource context at runtime from infrastructure code. This feature can be enabled by using the following configuration options.","title":"Configuring expansion"},{"location":"setup/configuring-expansion/#configuration","text":"Tip Each of these configuration options are set within the ps-rule.yaml file. To learn how to set configuration options see Configuring options .","title":"Configuration"},{"location":"setup/configuring-expansion/#parameter-file-expansion","text":"v1.4.1 This configuration option determines if Azure template parameter files will automatically be expanded. By default, parameter files will not be automatically expanded. When enabled, PSRule will discover and expand JSON parameter files for Azure templates or Bicep modules. Parameter files are expanded when PSRule cmdlets with the -Format File parameter are used. Syntax: configuration : AZURE_PARAMETER_FILE_EXPANSION : bool Default: # YAML: The default AZURE_PARAMETER_FILE_EXPANSION configuration option configuration : AZURE_PARAMETER_FILE_EXPANSION : false Example: # YAML: Set the AZURE_PARAMETER_FILE_EXPANSION configuration option to enable expansion configuration : AZURE_PARAMETER_FILE_EXPANSION : true","title":"Parameter file expansion"},{"location":"setup/configuring-expansion/#bicep-source-expansion","text":"v1.11.0 This configuration option determines if Azure Bicep source files will automatically be expanded. By default, Bicep files will not be automatically expanded. Bicep files are expanded when PSRule cmdlets with the -Format File parameter are used. Syntax: configuration : AZURE_BICEP_FILE_EXPANSION : bool Default: # YAML: The default AZURE_BICEP_FILE_EXPANSION configuration option configuration : AZURE_BICEP_FILE_EXPANSION : false Example: # YAML: Set the AZURE_BICEP_FILE_EXPANSION configuration option to enable expansion configuration : AZURE_BICEP_FILE_EXPANSION : true","title":"Bicep source expansion"},{"location":"setup/configuring-expansion/#bicep-compilation-timeout","text":"v1.13.3 This configuration option determines the maximum time to spend building a single Bicep source file. The timeout is configured in seconds. When a timeout occurs, PSRule for Azure stops the build and returns an error. Any resources contained within Bicep source files that exceeded the timeout are not analyzed. The default timeout is 5 seconds, however the timeout can be set to an integer between 1 and 120 . Syntax: configuration : AZURE_BICEP_FILE_EXPANSION_TIMEOUT : int Default: # YAML: The default AZURE_BICEP_FILE_EXPANSION_TIMEOUT configuration option configuration : AZURE_BICEP_FILE_EXPANSION_TIMEOUT : 5 Example: # YAML: Set the AZURE_BICEP_FILE_EXPANSION_TIMEOUT configuration option to enable expansion configuration : AZURE_BICEP_FILE_EXPANSION_TIMEOUT : 15","title":"Bicep compilation timeout"},{"location":"setup/configuring-expansion/#require-template-metadata-link","text":"v1.7.0 This configuration option determines if Azure template parameter files require a metadata link. When configured to true , the Azure.Template.MetadataLink rule is enabled. Any Azure template parameter files that do not include a metadata link will report a fail for this rule. The rule Azure.Template.MetadataLink is not enabled by default. Additionally, when enabled this rule can still be excluded or suppressed like all other rules. Syntax: configuration : AZURE_PARAMETER_FILE_METADATA_LINK : bool Default: # YAML: The default AZURE_PARAMETER_FILE_METADATA_LINK configuration option configuration : AZURE_PARAMETER_FILE_METADATA_LINK : false Example: # YAML: Set the AZURE_PARAMETER_FILE_METADATA_LINK configuration option to enable expansion configuration : AZURE_PARAMETER_FILE_METADATA_LINK : true","title":"Require template metadata link"},{"location":"setup/configuring-expansion/#deployment-properties","text":"v1.17.0 This configuration option sets the deployment object use by the deployment() function. Configure this option to change the details of the deployment when exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below. This configuration option applies to the parent deployment. Nested deployments will use any properties configured within code. Additionally, this configuration option will be ignore when -Name is used with Export-AzRuleTemplateData . Syntax: configuration : AZURE_DEPLOYMENT : name : string Default: # YAML: The default AZURE_DEPLOYMENT configuration option configuration : AZURE_DEPLOYMENT : name : 'ps-rule-test-deployment' Example: # YAML: Override the name of the deployment object. configuration : AZURE_DEPLOYMENT : name : 'deploy-web-application'","title":"Deployment properties"},{"location":"setup/configuring-expansion/#deployment-resource-group","text":"v1.1.0 This configuration option sets the resource group object used by the resourceGroup() function. Configure this option to change the resource group object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below. This configuration option will be ignored when -ResourceGroup is used with Export-AzRuleTemplateData . Syntax: configuration : AZURE_RESOURCE_GROUP : name : string location : string tags : object properties : provisioningState : string Default: # YAML: The default AZURE_RESOURCE_GROUP configuration option configuration : AZURE_RESOURCE_GROUP : name : 'ps-rule-test-rg' location : 'eastus' tags : { } properties : provisioningState : 'Succeeded' Example: # YAML: Override the location of the resource group object. configuration : AZURE_RESOURCE_GROUP : location : 'australiasoutheast'","title":"Deployment resource group"},{"location":"setup/configuring-expansion/#deployment-subscription","text":"v1.1.0 This configuration option sets the subscription object used by the subscription() function. Configure this option to change the subscription object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below. This configuration option will be ignored when -Subscription is used with Export-AzRuleTemplateData . Syntax: configuration : AZURE_SUBSCRIPTION : subscriptionId : string displayName : string state : string Default: # YAML: The default AZURE_SUBSCRIPTION configuration option configuration : AZURE_SUBSCRIPTION : subscriptionId : 'ffffffff-ffff-ffff-ffff-ffffffffffff' displayName : 'PSRule Test Subscription' state : 'NotDefined' Example: # YAML: Override the display name of the subscription object configuration : AZURE_SUBSCRIPTION : displayName : 'My test subscription'","title":"Deployment subscription"},{"location":"setup/configuring-expansion/#deployment-tenant","text":"v1.11.0 This configuration option sets the tenant object used by the tenant() function. Configure this option to change the tenant object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below. Syntax: configuration : AZURE_TENANT : countryCode : string tenantId : string displayName : string Default: # YAML: The default AZURE_TENANT configuration option configuration : AZURE_TENANT : countryCode : 'US' tenantId : 'ffffffff-ffff-ffff-ffff-ffffffffffff' displayName : 'PSRule' Example: # YAML: Override the display name of the tenant object configuration : AZURE_TENANT : displayName : 'Contoso'","title":"Deployment tenant"},{"location":"setup/configuring-expansion/#deployment-management-group","text":"v1.11.0 This configuration option sets the management group object used by the managementGroup() function. Configure this option to change the management group object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below. Syntax: configuration : AZURE_MANAGEMENT_GROUP : name : string properties : displayName : string Default: # YAML: The default AZURE_MANAGEMENT_GROUP configuration option configuration : AZURE_MANAGEMENT_GROUP : name : 'psrule-test' properties : displyName : 'PSRule Test Management Group' Example: # YAML: Override the display name of the management group object configuration : AZURE_MANAGEMENT_GROUP : properties : displayName : 'My test management group'","title":"Deployment management group"},{"location":"setup/configuring-expansion/#required-parameter-defaults","text":"v1.13.0 This configuration option allows a fallback value to be configured for required parameters. When a parameter value is not provided and a default is not set, the fallback value will be used. Configure this option when you are providing a set of common parameters dynamically during a pipeline. In this scenario, it may not make sense to add the parameters to a parameter file or Bicep deployment. Syntax: configuration : AZURE_PARAMETER_DEFAULTS : <parameter> : <value> Default: # YAML: The default AZURE_PARAMETER_DEFAULTS configuration option configuration : AZURE_PARAMETER_DEFAULTS : { } Example: # YAML: Set fallback values for adminPassword and workspaceId parameters. configuration : AZURE_PARAMETER_DEFAULTS : adminPassword : $CREDENTIAL_PLACEHOLDER$ workspaceId : /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.OperationalInsights/workspaces/{workspaceName}","title":"Required parameter defaults"},{"location":"setup/configuring-expansion/#excluding-files","text":"Template or Bicep source files can be excluded from being processed by PSRule and expansion. To exclude a file, configure the input.pathIgnore option by providing a path spec to ignore. Syntax: input : pathIgnore : - string - string Default: # YAML: The default input.pathIgnore option input : pathIgnore : [] Example: # YAML: Exclude a file from being processed by PSRule and expansion input : pathIgnore : - 'out/' - 'modules/**/*.bicep'","title":"Excluding files"},{"location":"setup/configuring-options/","text":"Configuring options # PSRule for Azure comes with many configuration options. Additionally, the PSRule engine includes several options that apply to all rules. You can visit the about_PSRule_Options topic to read about general PSRule options. Setting options # Configuration options are set within the ps-rule.yaml file. PSRule will automatically find this file within the current working directory. To set options, create a new file named ps-rule.yaml in the root directory of your repository. For configuring in-flight analysis, create a ps-rule.yaml in your current working directory. Tip This file should be committed to your repository so it is available when your pipeline runs. Note Use all lowercase characters ps-rule.yaml to name the file. On case-sensitive file systems, a file with uppercase characters may not be found. Configuration can be combined as indented keys. Use comments to add context. Example ps-rule.yaml requires : # Require a minimum of PSRule for Azure v1.10.2 PSRule.Rules.Azure : '>=1.10.2' configuration : # Enable expansion of Azure Template files. AZURE_PARAMETER_FILE_EXPANSION : true # Enable expansion of Azure Bicep files. AZURE_BICEP_FILE_EXPANSION : true # Configure the timeout for bicep build to 15 seconds. AZURE_BICEP_FILE_EXPANSION_TIMEOUT : 15 # Configure the minimum AKS cluster version. AZURE_AKS_CLUSTER_MINIMUM_VERSION : 1.22.4 rule : # Enable custom rules that don't exist in the baseline includeLocal : true exclude : # Ignore the following rules for all resources - Azure.VM.UseHybridUseBenefit - Azure.VM.Standalone suppression : Azure.AKS.AuthorizedIPs : # Exclude the following externally managed AKS clusters - aks-cluster-prod-eus-001 Azure.Storage.SoftDelete : # Exclude the following non-production storage accounts - storagedeveus6jo36t - storagedeveus1df278 Tip YAML can be a bit particular about indenting. If something is not working, double check that you have consistent spacing in your options file. We recommend using two (2) spaces to indent. Setting environment variables # In addition to ps-rule.yaml , most options can be set using environment variables. When configuring environment variables we recommend that all capital letters are used. This is because environment variables are case-sensitive on some operating systems. PSRule environment variables use a consistent naming pattern of PSRULE_<PARENT>_<NAME> . Where <PARENT> is the parent class and <NAME> is the specific option. When setting environment variables: Enum values are set by string and are not case-sensitive. For example PSRULE_OUTPUT_FORMAT could be set to Yaml . Boolean values are set by true , false , 1 , or 0 and are not case-sensitive. For example PSRULE_CONFIGURATION_AZURE_BICEP_FILE_EXPANSION could be set to true . String array values can specify multiple items by using a semi-colon separator. For example PSRULE_RULE_EXCLUDE could be set to 'Azure.VM.UseHybridUseBenefit;Azure.VM.Standalone' . GitHub Actions Azure Pipelines PowerShell Bash env : PSRULE_CONFIGURATION_AZURE_BICEP_FILE_EXPANSION : true PSRULE_OUTPUT_FORMAT : Yaml PSRULE_RULE_EXCLUDE : 'Azure.VM.UseHybridUseBenefit;Azure.VM.Standalone' variables : - name : PSRULE_CONFIGURATION_AZURE_BICEP_FILE_EXPANSION value : true - name : PSRULE_OUTPUT_FORMAT value : Yaml - name : PSRULE_RULE_EXCLUDE value : 'Azure.VM.UseHybridUseBenefit;Azure.VM.Standalone' $Env:PSRULE_CONFIGURATION_AZURE_BICEP_FILE_EXPANSION = 'true' $Env:PSRULE_OUTPUT_FORMAT = 'Yaml' $Env:PSRULE_RULE_EXCLUDE = 'Azure.VM.UseHybridUseBenefit;Azure.VM.Standalone' export PSRULE_CONFIGURATION_AZURE_BICEP_FILE_EXPANSION = true export PSRULE_OUTPUT_FORMAT = Yaml export PSRULE_RULE_EXCLUDE = 'Azure.VM.UseHybridUseBenefit;Azure.VM.Standalone'","title":"Configuring options"},{"location":"setup/configuring-options/#configuring-options","text":"PSRule for Azure comes with many configuration options. Additionally, the PSRule engine includes several options that apply to all rules. You can visit the about_PSRule_Options topic to read about general PSRule options.","title":"Configuring options"},{"location":"setup/configuring-options/#setting-options","text":"Configuration options are set within the ps-rule.yaml file. PSRule will automatically find this file within the current working directory. To set options, create a new file named ps-rule.yaml in the root directory of your repository. For configuring in-flight analysis, create a ps-rule.yaml in your current working directory. Tip This file should be committed to your repository so it is available when your pipeline runs. Note Use all lowercase characters ps-rule.yaml to name the file. On case-sensitive file systems, a file with uppercase characters may not be found. Configuration can be combined as indented keys. Use comments to add context. Example ps-rule.yaml requires : # Require a minimum of PSRule for Azure v1.10.2 PSRule.Rules.Azure : '>=1.10.2' configuration : # Enable expansion of Azure Template files. AZURE_PARAMETER_FILE_EXPANSION : true # Enable expansion of Azure Bicep files. AZURE_BICEP_FILE_EXPANSION : true # Configure the timeout for bicep build to 15 seconds. AZURE_BICEP_FILE_EXPANSION_TIMEOUT : 15 # Configure the minimum AKS cluster version. AZURE_AKS_CLUSTER_MINIMUM_VERSION : 1.22.4 rule : # Enable custom rules that don't exist in the baseline includeLocal : true exclude : # Ignore the following rules for all resources - Azure.VM.UseHybridUseBenefit - Azure.VM.Standalone suppression : Azure.AKS.AuthorizedIPs : # Exclude the following externally managed AKS clusters - aks-cluster-prod-eus-001 Azure.Storage.SoftDelete : # Exclude the following non-production storage accounts - storagedeveus6jo36t - storagedeveus1df278 Tip YAML can be a bit particular about indenting. If something is not working, double check that you have consistent spacing in your options file. We recommend using two (2) spaces to indent.","title":"Setting options"},{"location":"setup/configuring-options/#setting-environment-variables","text":"In addition to ps-rule.yaml , most options can be set using environment variables. When configuring environment variables we recommend that all capital letters are used. This is because environment variables are case-sensitive on some operating systems. PSRule environment variables use a consistent naming pattern of PSRULE_<PARENT>_<NAME> . Where <PARENT> is the parent class and <NAME> is the specific option. When setting environment variables: Enum values are set by string and are not case-sensitive. For example PSRULE_OUTPUT_FORMAT could be set to Yaml . Boolean values are set by true , false , 1 , or 0 and are not case-sensitive. For example PSRULE_CONFIGURATION_AZURE_BICEP_FILE_EXPANSION could be set to true . String array values can specify multiple items by using a semi-colon separator. For example PSRULE_RULE_EXCLUDE could be set to 'Azure.VM.UseHybridUseBenefit;Azure.VM.Standalone' . GitHub Actions Azure Pipelines PowerShell Bash env : PSRULE_CONFIGURATION_AZURE_BICEP_FILE_EXPANSION : true PSRULE_OUTPUT_FORMAT : Yaml PSRULE_RULE_EXCLUDE : 'Azure.VM.UseHybridUseBenefit;Azure.VM.Standalone' variables : - name : PSRULE_CONFIGURATION_AZURE_BICEP_FILE_EXPANSION value : true - name : PSRULE_OUTPUT_FORMAT value : Yaml - name : PSRULE_RULE_EXCLUDE value : 'Azure.VM.UseHybridUseBenefit;Azure.VM.Standalone' $Env:PSRULE_CONFIGURATION_AZURE_BICEP_FILE_EXPANSION = 'true' $Env:PSRULE_OUTPUT_FORMAT = 'Yaml' $Env:PSRULE_RULE_EXCLUDE = 'Azure.VM.UseHybridUseBenefit;Azure.VM.Standalone' export PSRULE_CONFIGURATION_AZURE_BICEP_FILE_EXPANSION = true export PSRULE_OUTPUT_FORMAT = Yaml export PSRULE_RULE_EXCLUDE = 'Azure.VM.UseHybridUseBenefit;Azure.VM.Standalone'","title":"Setting environment variables"},{"location":"setup/configuring-rules/","text":"Configuring rule defaults # PSRule for Azure include several rules that can be configured. Setting these values overrides the default configuration with organization specific values. Configuration # Tip Each of these configuration options are set within the ps-rule.yaml file. To learn how to set configuration options see Configuring options . AKS minimum Kubernetes version # v1.12.0 This configuration option determines the minimum version of Kubernetes for AKS clusters and node pools. Rules that check the Kubernetes version fail when the version is older than the version specified. Syntax: configuration : AZURE_AKS_CLUSTER_MINIMUM_VERSION : string # A version string Default: # YAML: The default AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option configuration : AZURE_AKS_CLUSTER_MINIMUM_VERSION : 1.21.9 Example: # YAML: Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option to 1.22.4 configuration : AZURE_AKS_CLUSTER_MINIMUM_VERSION : 1.22.4 AKS minimum max pods # This configuration option determines the minimum allowed max pods setting per node pool. When an AKS cluster node pool is created, a maxPods option is used to determine the maximum number of pods for each node in the node pool. Depending on your workloads it may make sense to change this option: Micro-services/ web applications: 50+ Data movement/ processing: 20-30 Syntax: configuration : Azure_AKSNodeMinimumMaxPods : integer Default: # YAML: The default Azure_AKSNodeMinimumMaxPods configuration option configuration : Azure_AKSNodeMinimumMaxPods : 50 Example: # YAML: Set the Azure_AKSNodeMinimumMaxPods configuration option to 30 configuration : Azure_AKSNodeMinimumMaxPods : 30 Allowed resource regions # This configuration option specifies a list of allowed locations that resources can be deployed to. Rules that check the location of Azure resources fail when a resource or resource group is created in a different region. By default, Azure_AllowedRegions is not configured. The rule Azure.Resource.AllowedRegions is skipped when no allowed locations are configured. Syntax: configuration : Azure_AllowedRegions : array # An array of regions Default: # YAML: The default Azure_AllowedRegions configuration option configuration : Azure_AllowedRegions : [] Example: # YAML: Set the Azure_AllowedRegions configuration option to Australia East, Australia South East configuration : Azure_AllowedRegions : - 'australiaeast' - 'australiasoutheast' Minimum certificate lifetime # This configuration option determines the minimum number of days allowed before certificate expiry. Rules that check certificate lifetime fail when the days remaining before expiry drop below this number. Syntax: configuration : Azure_MinimumCertificateLifetime : integer Default: # YAML: The default Azure_MinimumCertificateLifetime configuration option configuration : Azure_MinimumCertificateLifetime : 30 Example: # YAML: Set the Azure_MinimumCertificateLifetime configuration option to 90 configuration : Azure_MinimumCertificateLifetime : 90 Azure Policy maximum wavier # This configuration option determines the maximum number of days in the future for a waiver policy exemption. Syntax: configuration : AZURE_POLICY_WAIVER_MAX_EXPIRY : integer Default: # YAML: The default AZURE_POLICY_WAIVER_MAX_EXPIRY configuration option configuration : AZURE_POLICY_WAIVER_MAX_EXPIRY : 366 Example: # YAML: Set the AZURE_POLICY_WAIVER_MAX_EXPIRY configuration option to 90 configuration : AZURE_POLICY_WAIVER_MAX_EXPIRY : 90 Azure AKS CNI minimum cluster subnet size # This configuration option determines the minimum subnet size for Azure AKS CNI. Syntax: configuration : AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE : integer Default: # YAML: The default AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE configuration option configuration : AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE : 23 Example: # YAML: Set the AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE configuration option to 26 configuration : AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE : 26 Additional region availability zone list # This configuration option adds availability zones that are not included in the existing providers . You can use this option to add availability zones that are not included in the default list. The following providers are supported: Microsoft.Compute/virtualMachineScaleSets Microsoft.Network/applicationGateways Microsoft.Network/publicIPAddresses Microsoft.ApiManagement/service Microsoft.Cache/Redis Microsoft.Cache/redisEnterprise The following rules and configuration options are supported: Azure.AKS.AvailabilityZone - AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST Azure.AppGw.AvailabilityZone - AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST Azure.PublicIP.AvailabilityZone - AZURE_PUBLICIP_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST Azure.APIM.AvailabilityZone - AZURE_APIM_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST Azure.Redis.AvailabilityZone - AZURE_REDISCACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST Azure.RedisEnterprise.Zones - AZURE_REDISENTERPRISECACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST Syntax: configuration : AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : array Default: # YAML: The default AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option configuration : AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : [] Example: # YAML: Set the AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option to Antarctica North and Antarctica South, with zones 1, 2, 3. configuration : AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : - location : 'Antarctica North' zones : - \"1\" - \"2\" - \"3\" - location : 'Antarctica South' zones : - \"1\" - \"2\" - \"3\" The above example, both these forms of location are accepted: Antarctica North or antarcticanorth Antarctica South or antarcticasouth The rules normalize these location formats so either is accepted in the configuration. Note The above are examples for illustration purpose only. At the time of writing, Antarctica North and Antarctica South are fictional locations. If they do in the future exist, use this option add them prior to PSRule for Azure support. The above shows examples specific to Azure.AKS.AvailabilityZone , but behavior is consistent across all supported rules. Azure AKS enabled platform log categories list # This configuration option sets selective platform diagnostic categories to report on being enabled. Syntax: configuration : AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST : array Default: # YAML: The default AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option configuration : AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST : [ 'cluster-autoscaler' , 'kube-apiserver' , 'kube-controller-manager' , 'kube-scheduler' , 'AllMetrics' ] Example: # YAML: Set the AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option to cluster-autoscaler and AllMetrics categories only. configuration : AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST : [ 'cluster-autoscaler' , 'AllMetrics' ] Azure Automation Account enabled platform log categories list # This configuration option sets selective platform diagnostic categories to report on being enabled. Syntax: configuration : AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST : array Default: # YAML: The default AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option configuration : AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST : [ 'JobLogs' , 'JobStreams' , 'DscNodeStatus' , 'AllMetrics' ] Example: # YAML: Set the AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option to JobLogs and AllMetrics categories only. configuration : AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST : [ 'JobLogs' , 'AllMetrics' ]","title":"Configuring rule defaults"},{"location":"setup/configuring-rules/#configuring-rule-defaults","text":"PSRule for Azure include several rules that can be configured. Setting these values overrides the default configuration with organization specific values.","title":"Configuring rule defaults"},{"location":"setup/configuring-rules/#configuration","text":"Tip Each of these configuration options are set within the ps-rule.yaml file. To learn how to set configuration options see Configuring options .","title":"Configuration"},{"location":"setup/configuring-rules/#aks-minimum-kubernetes-version","text":"v1.12.0 This configuration option determines the minimum version of Kubernetes for AKS clusters and node pools. Rules that check the Kubernetes version fail when the version is older than the version specified. Syntax: configuration : AZURE_AKS_CLUSTER_MINIMUM_VERSION : string # A version string Default: # YAML: The default AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option configuration : AZURE_AKS_CLUSTER_MINIMUM_VERSION : 1.21.9 Example: # YAML: Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option to 1.22.4 configuration : AZURE_AKS_CLUSTER_MINIMUM_VERSION : 1.22.4","title":"AKS minimum Kubernetes version"},{"location":"setup/configuring-rules/#aks-minimum-max-pods","text":"This configuration option determines the minimum allowed max pods setting per node pool. When an AKS cluster node pool is created, a maxPods option is used to determine the maximum number of pods for each node in the node pool. Depending on your workloads it may make sense to change this option: Micro-services/ web applications: 50+ Data movement/ processing: 20-30 Syntax: configuration : Azure_AKSNodeMinimumMaxPods : integer Default: # YAML: The default Azure_AKSNodeMinimumMaxPods configuration option configuration : Azure_AKSNodeMinimumMaxPods : 50 Example: # YAML: Set the Azure_AKSNodeMinimumMaxPods configuration option to 30 configuration : Azure_AKSNodeMinimumMaxPods : 30","title":"AKS minimum max pods"},{"location":"setup/configuring-rules/#allowed-resource-regions","text":"This configuration option specifies a list of allowed locations that resources can be deployed to. Rules that check the location of Azure resources fail when a resource or resource group is created in a different region. By default, Azure_AllowedRegions is not configured. The rule Azure.Resource.AllowedRegions is skipped when no allowed locations are configured. Syntax: configuration : Azure_AllowedRegions : array # An array of regions Default: # YAML: The default Azure_AllowedRegions configuration option configuration : Azure_AllowedRegions : [] Example: # YAML: Set the Azure_AllowedRegions configuration option to Australia East, Australia South East configuration : Azure_AllowedRegions : - 'australiaeast' - 'australiasoutheast'","title":"Allowed resource regions"},{"location":"setup/configuring-rules/#minimum-certificate-lifetime","text":"This configuration option determines the minimum number of days allowed before certificate expiry. Rules that check certificate lifetime fail when the days remaining before expiry drop below this number. Syntax: configuration : Azure_MinimumCertificateLifetime : integer Default: # YAML: The default Azure_MinimumCertificateLifetime configuration option configuration : Azure_MinimumCertificateLifetime : 30 Example: # YAML: Set the Azure_MinimumCertificateLifetime configuration option to 90 configuration : Azure_MinimumCertificateLifetime : 90","title":"Minimum certificate lifetime"},{"location":"setup/configuring-rules/#azure-policy-maximum-wavier","text":"This configuration option determines the maximum number of days in the future for a waiver policy exemption. Syntax: configuration : AZURE_POLICY_WAIVER_MAX_EXPIRY : integer Default: # YAML: The default AZURE_POLICY_WAIVER_MAX_EXPIRY configuration option configuration : AZURE_POLICY_WAIVER_MAX_EXPIRY : 366 Example: # YAML: Set the AZURE_POLICY_WAIVER_MAX_EXPIRY configuration option to 90 configuration : AZURE_POLICY_WAIVER_MAX_EXPIRY : 90","title":"Azure Policy maximum wavier"},{"location":"setup/configuring-rules/#azure-aks-cni-minimum-cluster-subnet-size","text":"This configuration option determines the minimum subnet size for Azure AKS CNI. Syntax: configuration : AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE : integer Default: # YAML: The default AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE configuration option configuration : AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE : 23 Example: # YAML: Set the AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE configuration option to 26 configuration : AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE : 26","title":"Azure AKS CNI minimum cluster subnet size"},{"location":"setup/configuring-rules/#additional-region-availability-zone-list","text":"This configuration option adds availability zones that are not included in the existing providers . You can use this option to add availability zones that are not included in the default list. The following providers are supported: Microsoft.Compute/virtualMachineScaleSets Microsoft.Network/applicationGateways Microsoft.Network/publicIPAddresses Microsoft.ApiManagement/service Microsoft.Cache/Redis Microsoft.Cache/redisEnterprise The following rules and configuration options are supported: Azure.AKS.AvailabilityZone - AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST Azure.AppGw.AvailabilityZone - AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST Azure.PublicIP.AvailabilityZone - AZURE_PUBLICIP_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST Azure.APIM.AvailabilityZone - AZURE_APIM_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST Azure.Redis.AvailabilityZone - AZURE_REDISCACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST Azure.RedisEnterprise.Zones - AZURE_REDISENTERPRISECACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST Syntax: configuration : AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : array Default: # YAML: The default AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option configuration : AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : [] Example: # YAML: Set the AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option to Antarctica North and Antarctica South, with zones 1, 2, 3. configuration : AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST : - location : 'Antarctica North' zones : - \"1\" - \"2\" - \"3\" - location : 'Antarctica South' zones : - \"1\" - \"2\" - \"3\" The above example, both these forms of location are accepted: Antarctica North or antarcticanorth Antarctica South or antarcticasouth The rules normalize these location formats so either is accepted in the configuration. Note The above are examples for illustration purpose only. At the time of writing, Antarctica North and Antarctica South are fictional locations. If they do in the future exist, use this option add them prior to PSRule for Azure support. The above shows examples specific to Azure.AKS.AvailabilityZone , but behavior is consistent across all supported rules.","title":"Additional region availability zone list"},{"location":"setup/configuring-rules/#azure-aks-enabled-platform-log-categories-list","text":"This configuration option sets selective platform diagnostic categories to report on being enabled. Syntax: configuration : AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST : array Default: # YAML: The default AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option configuration : AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST : [ 'cluster-autoscaler' , 'kube-apiserver' , 'kube-controller-manager' , 'kube-scheduler' , 'AllMetrics' ] Example: # YAML: Set the AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option to cluster-autoscaler and AllMetrics categories only. configuration : AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST : [ 'cluster-autoscaler' , 'AllMetrics' ]","title":"Azure AKS enabled platform log categories list"},{"location":"setup/configuring-rules/#azure-automation-account-enabled-platform-log-categories-list","text":"This configuration option sets selective platform diagnostic categories to report on being enabled. Syntax: configuration : AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST : array Default: # YAML: The default AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option configuration : AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST : [ 'JobLogs' , 'JobStreams' , 'DscNodeStatus' , 'AllMetrics' ] Example: # YAML: Set the AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option to JobLogs and AllMetrics categories only. configuration : AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST : [ 'JobLogs' , 'AllMetrics' ]","title":"Azure Automation Account enabled platform log categories list"},{"location":"setup/setup-azure-monitor-logs/","text":"Setup Azure Monitor logs # When analyzing Azure resources, you may want to capture the results of each analysis run. Azure Monitor provides a central storage location for log data through Log Analytics workspaces. Centrally storing PSRule results enables the following scenarios: Auditing and reporting \u2014 Report on analysis pass or failures. Use Azure Monitor workbooks or custom queries to perform analysis and display results. Perform security analysis within Microsoft Azure Sentinel your a scalable, cloud-native SIEM . Alternatively, export log data from Log Analytics for ingestion into a third-party SIEM . Send notifications using alerts \u2014 Trigger alerts to send notifications. Integration with other workflows \u2014 Configure alerts and action groups to trigger integration . Abstract This topic covers setting up PSRule to log rule results into a Log Analytics workspace. Logging into a Log Analytics workspace # Logging of PSRule results into a workspace is done using the PSRule for Azure Monitor module. PSRule for Azure Monitor extends the PSRule pipeline to import results into the specified workspace. Once configured, PSRule will log results into the PSRule_CL custom log table of the chosen workspace. Info Integration between PSRule and Azure Monitor is done by means of a convention. Conventions extend the pipeline to be able to upload results after rules have run. Setting environment variables # PSRule for Azure Monitor requires a Log Analytics workspace to import results into. To configure the workspace to import results to the following environment variables must be set. PSRULE_CONFIGURATION_MONITOR_WORKSPACE_ID - The unique ID (GUID) for the workspace to import results. PSRULE_CONFIGURATION_MONITOR_WORKSPACE_KEY - Either the primary or secondary key of the workspace. How to set these environment variables is covered in the next section for GitHub Actions and Azure Pipelines. Tip Both the workspace ID and keys can be found under the Agents management settings of the workspace. Configuring your pipeline # The convention that imports PSRule analysis results is not executed by default. To enable, reference the Monitor.LogAnalytics.Import convention in your analysis pipeline. With GitHub Actions # GitHub Action Import analysis results into Azure Monitor with GitHub Actions by: Using the PSRule.Monitor module. Referencing the Monitor.LogAnalytics.Import convention. Configure secrets for MONITOR_WORKSPACE_ID and MONITOR_WORKSPACE_KEY . Stable Pre-release Install the latest stable module versions. - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : PSRule.Rules.Azure,PSRule.Monitor conventions : Monitor.LogAnalytics.Import env : # Define environment variables using GitHub encrypted secrets PSRULE_CONFIGURATION_MONITOR_WORKSPACE_ID : ${{ secrets.MONITOR_WORKSPACE_ID }} PSRULE_CONFIGURATION_MONITOR_WORKSPACE_KEY : ${{ secrets.MONITOR_WORKSPACE_KEY }} Install the latest stable or pre-release module versions. - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : PSRule.Rules.Azure,PSRule.Monitor conventions : Monitor.LogAnalytics.Import prerelease : true env : # Define environment variables using GitHub encrypted secrets PSRULE_CONFIGURATION_MONITOR_WORKSPACE_ID : ${{ secrets.MONITOR_WORKSPACE_ID }} PSRULE_CONFIGURATION_MONITOR_WORKSPACE_KEY : ${{ secrets.MONITOR_WORKSPACE_KEY }} Important Environment variables can be configured in the workflow or from a secret. To keep MONITOR_WORKSPACE_KEY secure, use an encrypted secret . With Azure Pipelines # Extension Import analysis results into Azure Monitor with Azure Pipelines by: Installing the PSRule extension , then using the ps-rule-assert task in pipeline steps. Using the PSRule.Monitor module. Referencing the Monitor.LogAnalytics.Import convention. Configure variables for MONITORWORKSPACEID and MONITORWORKSPACEKEY . Stable Pre-release Install the latest stable module versions. - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : PSRule.Rules.Azure,PSRule.Monitor conventions : Monitor.LogAnalytics.Import env : # Define environment variables within Azure Pipelines PSRULE_CONFIGURATION_MONITOR_WORKSPACE_ID : $(MONITORWORKSPACEID) PSRULE_CONFIGURATION_MONITOR_WORKSPACE_KEY : $(MONITORWORKSPACEKEY) Install the latest stable or pre-release module versions. - task : ps-rule-install@2 displayName : Install PSRule for Azure (pre-release) inputs : module : PSRule.Rules.Azure prerelease : true - task : ps-rule-install@2 displayName : Install PSRule for Azure Monitor (pre-release) inputs : module : PSRule.Monitor prerelease : true - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : PSRule.Rules.Azure,PSRule.Monitor conventions : Monitor.LogAnalytics.Import env : # Define environment variables within Azure Pipelines PSRULE_CONFIGURATION_MONITOR_WORKSPACE_ID : $(MONITORWORKSPACEID) PSRULE_CONFIGURATION_MONITOR_WORKSPACE_KEY : $(MONITORWORKSPACEKEY) Important Variables can be configured in YAML, on the pipeline, or referenced from a defined variable group. To keep MONITORWORKSPACEKEY secure, use a variable group linked to an Azure Key Vault. Sample queries # Continue reading for some sample queries you can try out Azure Monitor integration. Results with annotations # // Show extended info PSRule_CL | where TimeGenerated > ago(30d) | extend Pillar = tostring(parse_json(Annotations_s).pillar) | extend Link = tostring(parse_json(Annotations_s).[\"online version\"]) Summarize results by run # // Group by run PSRule_CL | where TimeGenerated > ago(30d) | summarize Pass=countif(Outcome_s == \"Pass\"), Fail=countif(Outcome_s == \"Fail\") by RunId_s Querying The Data # Once the results have been published to the Log Analytics workspace, they can be queried by executing results against the PSRule_CL table (under Custom Logs). For more information on how to write Log Analytics querys, review the Log Analytics tutortial","title":"Setup Azure Monitor logs"},{"location":"setup/setup-azure-monitor-logs/#setup-azure-monitor-logs","text":"When analyzing Azure resources, you may want to capture the results of each analysis run. Azure Monitor provides a central storage location for log data through Log Analytics workspaces. Centrally storing PSRule results enables the following scenarios: Auditing and reporting \u2014 Report on analysis pass or failures. Use Azure Monitor workbooks or custom queries to perform analysis and display results. Perform security analysis within Microsoft Azure Sentinel your a scalable, cloud-native SIEM . Alternatively, export log data from Log Analytics for ingestion into a third-party SIEM . Send notifications using alerts \u2014 Trigger alerts to send notifications. Integration with other workflows \u2014 Configure alerts and action groups to trigger integration . Abstract This topic covers setting up PSRule to log rule results into a Log Analytics workspace.","title":"Setup Azure Monitor logs"},{"location":"setup/setup-azure-monitor-logs/#logging-into-a-log-analytics-workspace","text":"Logging of PSRule results into a workspace is done using the PSRule for Azure Monitor module. PSRule for Azure Monitor extends the PSRule pipeline to import results into the specified workspace. Once configured, PSRule will log results into the PSRule_CL custom log table of the chosen workspace. Info Integration between PSRule and Azure Monitor is done by means of a convention. Conventions extend the pipeline to be able to upload results after rules have run.","title":"Logging into a Log Analytics workspace"},{"location":"setup/setup-azure-monitor-logs/#setting-environment-variables","text":"PSRule for Azure Monitor requires a Log Analytics workspace to import results into. To configure the workspace to import results to the following environment variables must be set. PSRULE_CONFIGURATION_MONITOR_WORKSPACE_ID - The unique ID (GUID) for the workspace to import results. PSRULE_CONFIGURATION_MONITOR_WORKSPACE_KEY - Either the primary or secondary key of the workspace. How to set these environment variables is covered in the next section for GitHub Actions and Azure Pipelines. Tip Both the workspace ID and keys can be found under the Agents management settings of the workspace.","title":"Setting environment variables"},{"location":"setup/setup-azure-monitor-logs/#configuring-your-pipeline","text":"The convention that imports PSRule analysis results is not executed by default. To enable, reference the Monitor.LogAnalytics.Import convention in your analysis pipeline.","title":"Configuring your pipeline"},{"location":"setup/setup-azure-monitor-logs/#with-github-actions","text":"GitHub Action Import analysis results into Azure Monitor with GitHub Actions by: Using the PSRule.Monitor module. Referencing the Monitor.LogAnalytics.Import convention. Configure secrets for MONITOR_WORKSPACE_ID and MONITOR_WORKSPACE_KEY . Stable Pre-release Install the latest stable module versions. - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : PSRule.Rules.Azure,PSRule.Monitor conventions : Monitor.LogAnalytics.Import env : # Define environment variables using GitHub encrypted secrets PSRULE_CONFIGURATION_MONITOR_WORKSPACE_ID : ${{ secrets.MONITOR_WORKSPACE_ID }} PSRULE_CONFIGURATION_MONITOR_WORKSPACE_KEY : ${{ secrets.MONITOR_WORKSPACE_KEY }} Install the latest stable or pre-release module versions. - name : Analyze Azure template files uses : microsoft/ps-rule@v2.3.2 with : modules : PSRule.Rules.Azure,PSRule.Monitor conventions : Monitor.LogAnalytics.Import prerelease : true env : # Define environment variables using GitHub encrypted secrets PSRULE_CONFIGURATION_MONITOR_WORKSPACE_ID : ${{ secrets.MONITOR_WORKSPACE_ID }} PSRULE_CONFIGURATION_MONITOR_WORKSPACE_KEY : ${{ secrets.MONITOR_WORKSPACE_KEY }} Important Environment variables can be configured in the workflow or from a secret. To keep MONITOR_WORKSPACE_KEY secure, use an encrypted secret .","title":"With GitHub Actions"},{"location":"setup/setup-azure-monitor-logs/#with-azure-pipelines","text":"Extension Import analysis results into Azure Monitor with Azure Pipelines by: Installing the PSRule extension , then using the ps-rule-assert task in pipeline steps. Using the PSRule.Monitor module. Referencing the Monitor.LogAnalytics.Import convention. Configure variables for MONITORWORKSPACEID and MONITORWORKSPACEKEY . Stable Pre-release Install the latest stable module versions. - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : PSRule.Rules.Azure,PSRule.Monitor conventions : Monitor.LogAnalytics.Import env : # Define environment variables within Azure Pipelines PSRULE_CONFIGURATION_MONITOR_WORKSPACE_ID : $(MONITORWORKSPACEID) PSRULE_CONFIGURATION_MONITOR_WORKSPACE_KEY : $(MONITORWORKSPACEKEY) Install the latest stable or pre-release module versions. - task : ps-rule-install@2 displayName : Install PSRule for Azure (pre-release) inputs : module : PSRule.Rules.Azure prerelease : true - task : ps-rule-install@2 displayName : Install PSRule for Azure Monitor (pre-release) inputs : module : PSRule.Monitor prerelease : true - task : ps-rule-assert@2 displayName : Analyze Azure template files inputs : modules : PSRule.Rules.Azure,PSRule.Monitor conventions : Monitor.LogAnalytics.Import env : # Define environment variables within Azure Pipelines PSRULE_CONFIGURATION_MONITOR_WORKSPACE_ID : $(MONITORWORKSPACEID) PSRULE_CONFIGURATION_MONITOR_WORKSPACE_KEY : $(MONITORWORKSPACEKEY) Important Variables can be configured in YAML, on the pipeline, or referenced from a defined variable group. To keep MONITORWORKSPACEKEY secure, use a variable group linked to an Azure Key Vault.","title":"With Azure Pipelines"},{"location":"setup/setup-azure-monitor-logs/#sample-queries","text":"Continue reading for some sample queries you can try out Azure Monitor integration.","title":"Sample queries"},{"location":"setup/setup-azure-monitor-logs/#results-with-annotations","text":"// Show extended info PSRule_CL | where TimeGenerated > ago(30d) | extend Pillar = tostring(parse_json(Annotations_s).pillar) | extend Link = tostring(parse_json(Annotations_s).[\"online version\"])","title":"Results with annotations"},{"location":"setup/setup-azure-monitor-logs/#summarize-results-by-run","text":"// Group by run PSRule_CL | where TimeGenerated > ago(30d) | summarize Pass=countif(Outcome_s == \"Pass\"), Fail=countif(Outcome_s == \"Fail\") by RunId_s","title":"Summarize results by run"},{"location":"setup/setup-azure-monitor-logs/#querying-the-data","text":"Once the results have been published to the Log Analytics workspace, they can be queried by executing results against the PSRule_CL table (under Custom Logs). For more information on how to write Log Analytics querys, review the Log Analytics tutortial","title":"Querying The Data"},{"location":"setup/setup-bicep/","text":"Setup Bicep # To expand Azure resources for analysis from Bicep source files the Bicep CLI is required. The Bicep CLI is already installed on hosted runners and agents used by GitHub Actions and Azure Pipelines. Abstract This topic covers setting up support for analyzing Azure resources within Bicep source files. Installing Bicep CLI # PSRule for Azure requires a minimum of Bicep CLI version 0.4.451 . You may need to install or upgrade the Bicep CLI in the following scenarios: Your Bicep source files require a newer version of the CLI then supported by hosted agents. The Bicep CLI version can be found in the included software list for each supported platform. You are using self-hosted runners with your GitHub Actions workflow. You are using self-hosted agents with Azure Pipelines. You are performing local validation or using a different CI platform. The Bicep CLI can be installed on MacOS, Linux, and Windows. For installation instructions see Setup your Bicep development environment . Tip When installing Bicep using the Azure CLI, Bicep is not added to the PATH environment variable. To use PSRule for Azure with the Azure CLI set the PSRULE_AZURE_BICEP_USE_AZURE_CLI to true . Setting this environment variable is explained in the next section. Setting environment variables # When expanding Bicep files, the path to the Bicep CLI binary is required. By default, the PATH environment variable will be used to discover the binary path. When using this option, add the sub-directory containing the Bicep binary to the environment variable. Alternatively, the path can be overridden by setting the PSRULE_AZURE_BICEP_PATH environment variable. When setting PSRULE_AZURE_BICEP_PATH specify the full path to the Bicep binary including the file name. File names used for Bicep binaries include bicep , or bicep.exe . Example Bash export PSRULE_AZURE_BICEP_PATH = '/usr/local/bin/bicep' PowerShell $Env:PSRULE_AZURE_BICEP_PATH = '/usr/local/bin/bicep' ; GitHub Actions env : PSRULE_AZURE_BICEP_PATH : '/usr/local/bin/bicep' Azure Pipelines variables : - name : PSRULE_AZURE_BICEP_PATH value : '/usr/local/bin/bicep' Using Azure CLI # By default, PSRule for Azure uses the Bicep CLI directly. An additional option is to use the Azure CLI to invoke the Bicep CLI. When using this option the required version of the CLI must be installed prior to using PSRule for Azure. This is explained in Setup your Bicep development environment . To enable this option, set the PSRULE_AZURE_BICEP_USE_AZURE_CLI environment variable to true . Example Bash export PSRULE_AZURE_BICEP_USE_AZURE_CLI = true PowerShell $Env:PSRULE_AZURE_BICEP_USE_AZURE_CLI = 'true' GitHub Actions env : PSRULE_AZURE_BICEP_USE_AZURE_CLI : true Azure Pipelines variables : - name : PSRULE_AZURE_BICEP_USE_AZURE_CLI value : true Additional arguments # For configuration, additional arguments can be passed to the Bicep CLI. This is intended to improve forward compatibility with Bicep CLI. To configure additional arguments, set the PSRULE_AZURE_BICEP_ARGS environment variable. Configuring expansion # Docs PSRule for Azure can automatically expand Bicep source files. When enabled, PSRule for Azure automatically expands and analyzes Azure resource from .bicep files. To enabled this feature, set the Configuration.AZURE_BICEP_FILE_EXPANSION to true . This option can be set within the ps-rule.yaml file. configuration : # Enable automatic expansion of bicep source files. AZURE_BICEP_FILE_EXPANSION : true Tip If you deploy Bicep code using JSON parameter files this option does not need to be set. Set Configuration.AZURE_PARAMETER_FILE_EXPANSION to true instead. See Using parameter files and By metadata for more information. Configuring timeout # Docs In certain environments it may be necessary to increase the default timeout for building Bicep files. This can occur if your Bicep deployments are: Large and complex. Use nested modules. Use modules restored from a registry. If you are experincing timeout errors you can increase the default timeout of 5 seconds. To configure the timeout, set Configuration.AZURE_BICEP_FILE_EXPANSION_TIMEOUT to the timeout in seconds. configuration : # Enable automatic expansion of bicep source files. AZURE_BICEP_FILE_EXPANSION : true # Configure the timeout for bicep build to 15 seconds. AZURE_BICEP_FILE_EXPANSION_TIMEOUT : 15","title":"Setup Bicep"},{"location":"setup/setup-bicep/#setup-bicep","text":"To expand Azure resources for analysis from Bicep source files the Bicep CLI is required. The Bicep CLI is already installed on hosted runners and agents used by GitHub Actions and Azure Pipelines. Abstract This topic covers setting up support for analyzing Azure resources within Bicep source files.","title":"Setup Bicep"},{"location":"setup/setup-bicep/#installing-bicep-cli","text":"PSRule for Azure requires a minimum of Bicep CLI version 0.4.451 . You may need to install or upgrade the Bicep CLI in the following scenarios: Your Bicep source files require a newer version of the CLI then supported by hosted agents. The Bicep CLI version can be found in the included software list for each supported platform. You are using self-hosted runners with your GitHub Actions workflow. You are using self-hosted agents with Azure Pipelines. You are performing local validation or using a different CI platform. The Bicep CLI can be installed on MacOS, Linux, and Windows. For installation instructions see Setup your Bicep development environment . Tip When installing Bicep using the Azure CLI, Bicep is not added to the PATH environment variable. To use PSRule for Azure with the Azure CLI set the PSRULE_AZURE_BICEP_USE_AZURE_CLI to true . Setting this environment variable is explained in the next section.","title":"Installing Bicep CLI"},{"location":"setup/setup-bicep/#setting-environment-variables","text":"When expanding Bicep files, the path to the Bicep CLI binary is required. By default, the PATH environment variable will be used to discover the binary path. When using this option, add the sub-directory containing the Bicep binary to the environment variable. Alternatively, the path can be overridden by setting the PSRULE_AZURE_BICEP_PATH environment variable. When setting PSRULE_AZURE_BICEP_PATH specify the full path to the Bicep binary including the file name. File names used for Bicep binaries include bicep , or bicep.exe . Example Bash export PSRULE_AZURE_BICEP_PATH = '/usr/local/bin/bicep' PowerShell $Env:PSRULE_AZURE_BICEP_PATH = '/usr/local/bin/bicep' ; GitHub Actions env : PSRULE_AZURE_BICEP_PATH : '/usr/local/bin/bicep' Azure Pipelines variables : - name : PSRULE_AZURE_BICEP_PATH value : '/usr/local/bin/bicep'","title":"Setting environment variables"},{"location":"setup/setup-bicep/#using-azure-cli","text":"By default, PSRule for Azure uses the Bicep CLI directly. An additional option is to use the Azure CLI to invoke the Bicep CLI. When using this option the required version of the CLI must be installed prior to using PSRule for Azure. This is explained in Setup your Bicep development environment . To enable this option, set the PSRULE_AZURE_BICEP_USE_AZURE_CLI environment variable to true . Example Bash export PSRULE_AZURE_BICEP_USE_AZURE_CLI = true PowerShell $Env:PSRULE_AZURE_BICEP_USE_AZURE_CLI = 'true' GitHub Actions env : PSRULE_AZURE_BICEP_USE_AZURE_CLI : true Azure Pipelines variables : - name : PSRULE_AZURE_BICEP_USE_AZURE_CLI value : true","title":"Using Azure CLI"},{"location":"setup/setup-bicep/#additional-arguments","text":"For configuration, additional arguments can be passed to the Bicep CLI. This is intended to improve forward compatibility with Bicep CLI. To configure additional arguments, set the PSRULE_AZURE_BICEP_ARGS environment variable.","title":"Additional arguments"},{"location":"setup/setup-bicep/#configuring-expansion","text":"Docs PSRule for Azure can automatically expand Bicep source files. When enabled, PSRule for Azure automatically expands and analyzes Azure resource from .bicep files. To enabled this feature, set the Configuration.AZURE_BICEP_FILE_EXPANSION to true . This option can be set within the ps-rule.yaml file. configuration : # Enable automatic expansion of bicep source files. AZURE_BICEP_FILE_EXPANSION : true Tip If you deploy Bicep code using JSON parameter files this option does not need to be set. Set Configuration.AZURE_PARAMETER_FILE_EXPANSION to true instead. See Using parameter files and By metadata for more information.","title":"Configuring expansion"},{"location":"setup/setup-bicep/#configuring-timeout","text":"Docs In certain environments it may be necessary to increase the default timeout for building Bicep files. This can occur if your Bicep deployments are: Large and complex. Use nested modules. Use modules restored from a registry. If you are experincing timeout errors you can increase the default timeout of 5 seconds. To configure the timeout, set Configuration.AZURE_BICEP_FILE_EXPANSION_TIMEOUT to the timeout in seconds. configuration : # Enable automatic expansion of bicep source files. AZURE_BICEP_FILE_EXPANSION : true # Configure the timeout for bicep build to 15 seconds. AZURE_BICEP_FILE_EXPANSION_TIMEOUT : 15","title":"Configuring timeout"}]}