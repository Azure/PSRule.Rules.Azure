{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"CHANGELOG-v0/","title":"Change log","text":""},{"location":"CHANGELOG-v0/#v0190","title":"v0.19.0","text":"<p>What's changed since v0.18.0:</p> <ul> <li>New features:<ul> <li>Added <code>Azure.GA_2020_12</code> baseline. #593<ul> <li>Includes rules released before or during December 2020 for Azure GA features.</li> <li>Marked baseline <code>Azure.GA_2020_09</code> as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Database for MySQL:<ul> <li>Check database servers meet name requirements. #583</li> </ul> </li> <li>Database for PostgreSQL:<ul> <li>Check database servers meet name requirements. #583</li> </ul> </li> <li>SQL Database:<ul> <li>Check SQL logical servers meet name requirements. #583</li> <li>Check SQL failover groups meet name requirements. #583</li> <li>Check SQL databases meet name requirements. #583</li> </ul> </li> <li>SQL Managed Instance:<ul> <li>Check SQL Managed Instances meet name requirements. #583</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.19.3. #590</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for <code>true</code>, <code>false</code>, and <code>null</code> template functions. #579</li> <li>Added support for <code>createObject</code> template function. #580</li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.0.0. #588</li> </ul> </li> </ul> <p>What's changed since pre-release v0.19.0-B2012008:</p> <ul> <li>New features:<ul> <li>Added <code>Azure.GA_2020_12</code> baseline. #593<ul> <li>Includes rules released before or during December 2020 for Azure GA features.</li> <li>Marked baseline <code>Azure.GA_2020_09</code> as obsolete.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0190-b2012008-pre-release","title":"v0.19.0-B2012008 (pre-release)","text":"<p>What's changed since pre-release v0.19.0-B2011008:</p> <ul> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.19.3. #590</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.0.0. #588</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0190-b2011008-pre-release","title":"v0.19.0-B2011008 (pre-release)","text":"<p>What's changed since v0.18.0:</p> <ul> <li>New rules:<ul> <li>Database for MySQL:<ul> <li>Check database servers meet name requirements. #583</li> </ul> </li> <li>Database for PostgreSQL:<ul> <li>Check database servers meet name requirements. #583</li> </ul> </li> <li>SQL Database:<ul> <li>Check SQL logical servers meet name requirements. #583</li> <li>Check SQL failover groups meet name requirements. #583</li> <li>Check SQL databases meet name requirements. #583</li> </ul> </li> <li>SQL Managed Instance:<ul> <li>Check SQL Managed Instances meet name requirements. #583</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for <code>true</code>, <code>false</code>, and <code>null</code> template functions. #579</li> <li>Added support for <code>createObject</code> template function. #580</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0180","title":"v0.18.0","text":"<p>What's changed since v0.17.0:</p> <ul> <li>New rules:<ul> <li>Container Registry:<ul> <li>Check registries use container image scanning. #558</li> <li>Check registries image scanning results are healthy. #558</li> <li>Check registries use content trust. #558</li> <li>Check registries are geo-replicated. #558</li> <li>Check registries uses storage space less than included storage. #558</li> <li>Check registries have a retention set of untagged manifests (preview). #558</li> <li>Check registries use image quarantine pattern (preview). #558</li> </ul> </li> <li>Front Door:<ul> <li>Check Front Door WAF policy name requirements. #552</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed HNS storage accounts so they are excluded from blob soft delete rule. #554</li> <li>Fixed reason typo on template parameter metadata. #567</li> <li>Fixed <code>Get-AzRuleTemplateLink</code> reports incorrect parameter with file path. #568</li> <li>Fixed variable property not resolved with copy peer. #571</li> <li>Fixed blob soft delete for FileStorage storage accounts. #573</li> <li>Fixed top level variable copy detected as unused variable.#569</li> <li>Fixed ResourceGroupName property cannot be found on this object. #561</li> </ul> </li> </ul> <p>What's changed since pre-release v0.18.0-B2011023:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v0/#v0180-b2011023-pre-release","title":"v0.18.0-B2011023 (pre-release)","text":"<p>What's changed since pre-release v0.18.0-B2011005:</p> <ul> <li>Bug fixes:<ul> <li>Fixed reason typo on template parameter metadata. #567</li> <li>Fixed <code>Get-AzRuleTemplateLink</code> reports incorrect parameter with file path. #568</li> <li>Fixed variable property not resolved with copy peer. #571</li> <li>Fixed blob soft delete for FileStorage storage accounts. #573</li> <li>Fixed top level variable copy detected as unused variable.#569</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0180-b2011005-pre-release","title":"v0.18.0-B2011005 (pre-release)","text":"<p>What's changed since pre-release v0.18.0-B2010016:</p> <ul> <li>Bug fixes:<ul> <li>Fixed ResourceGroupName property cannot be found on this object. #561</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0180-b2010016-pre-release","title":"v0.18.0-B2010016 (pre-release)","text":"<p>What's changed since v0.17.0:</p> <ul> <li>New rules:<ul> <li>Container Registry:<ul> <li>Check registries use container image scanning. #558</li> <li>Check registries image scanning results are healthy. #558</li> <li>Check registries use content trust. #558</li> <li>Check registries are geo-replicated. #558</li> <li>Check registries uses storage space less than included storage. #558</li> <li>Check registries have a retention set of untagged manifests (preview). #558</li> <li>Check registries use image quarantine pattern (preview). #558</li> </ul> </li> <li>Front Door:<ul> <li>Check Front Door WAF policy name requirements. #552</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed HNS storage accounts so they are excluded from blob soft delete rule. #554</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0170","title":"v0.17.0","text":"<p>What's changed since v0.16.0:</p> <ul> <li>New rules:<ul> <li>Azure Cache for Redis:<ul> <li>Check cache instances use Standard C1 or greater SKU. #501</li> <li>Cache cache instances configure <code>maxmemory-reserved</code> setting. #502</li> </ul> </li> <li>App Configuration:<ul> <li>Check App Configuration stores meet name requirements. #528</li> <li>Check App Configuration stores use standard SKU. #528</li> </ul> </li> <li>App Service:<ul> <li>Check App Service apps use HTTP/2. #538</li> <li>Check App Service apps use managed identities. #537</li> <li>Check App Service apps use Always On. #521</li> <li>Check App Service apps have remote debugging disabled. #521</li> <li>Check App Service apps use newer .NET Framework versions. #521</li> <li>Check App Service apps use newer PHP runtime versions. #521</li> </ul> </li> <li>Logic App:<ul> <li>Check Logic App apps limit IP range for HTTP triggers. #526</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Storage:<ul> <li>Updated <code>Azure.Storage.UseReplication</code> for additional use cases.<ul> <li>Added support for geo-zone-redundant storage. #535</li> <li>Exclude storage tagged with <code>resource-usage = 'azure-functions'</code> or <code>resource-usage = 'azure-monitor'</code>. #534</li> </ul> </li> </ul> </li> <li>Azure Kubernetes Service:<ul> <li>Promote <code>Azure.AKS.AzurePolicyAddOn</code> to GA rule set. #524</li> </ul> </li> </ul> </li> <li>Removed rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Remove <code>Azure.AKS.PodSecurityPolicy</code> as this AKS feature is replaced by Azure Policy. #523</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for <code>providers</code> template function. #177</li> <li>Added support for <code>dateTimeAdd</code> template function. #516</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed expansion of templates with multiple variables copy blocks. #541</li> <li>Fixed App Service rule site config false positives in templates. #533</li> </ul> </li> </ul> <p>What's changed since pre-release v0.17.0-B2010028:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v0/#v0170-b2010028-pre-release","title":"v0.17.0-B2010028 (pre-release)","text":"<p>What's changed since pre-release v0.17.0-B2010022:</p> <ul> <li>New rules:<ul> <li>Azure Cache for Redis:<ul> <li>Check cache instances use Standard C1 or greater SKU. #501</li> <li>Cache cache instances configure <code>maxmemory-reserved</code> setting. #502</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0170-b2010022-pre-release","title":"v0.17.0-B2010022 (pre-release)","text":"<p>What's changed since pre-release v0.17.0-B2010017:</p> <ul> <li>Bug fixes:<ul> <li>Fixed expansion of templates with multiple variables copy blocks. #541</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0170-b2010017-pre-release","title":"v0.17.0-B2010017 (pre-release)","text":"<p>What's changed since pre-release v0.17.0-B2010006:</p> <ul> <li>New rules:<ul> <li>App Service:<ul> <li>Check App Service apps use HTTP/2. #538</li> <li>Check App Service apps use managed identities. #537</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Storage:<ul> <li>Updated <code>Azure.Storage.UseReplication</code> for additional use cases.<ul> <li>Added support for geo-zone-redundant storage. #535</li> <li>Exclude storage tagged with <code>resource-usage = 'azure-functions'</code> or <code>resource-usage = 'azure-monitor'</code>. #534</li> </ul> </li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed App Service rule site config false positives in templates. #533</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0170-b2010006-pre-release","title":"v0.17.0-B2010006 (pre-release)","text":"<p>What's changed since pre-release v0.17.0-B2009009:</p> <ul> <li>New rules:<ul> <li>App Configuration:<ul> <li>Check App Configuration stores meet name requirements. #528</li> <li>Check App Configuration stores use standard SKU. #528</li> </ul> </li> <li>App Service:<ul> <li>Check App Service apps use Always On. #521</li> <li>Check App Service apps have remote debugging disabled. #521</li> <li>Check App Service apps use newer .NET Framework versions. #521</li> <li>Check App Service apps use newer PHP runtime versions. #521</li> </ul> </li> <li>Logic App:<ul> <li>Check Logic App apps limit IP range for HTTP triggers. #526</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Promote <code>Azure.AKS.AzurePolicyAddOn</code> to GA rule set. #524</li> </ul> </li> </ul> </li> <li>Removed rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Remove <code>Azure.AKS.PodSecurityPolicy</code> as this AKS feature is replaced by Azure Policy. #523</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0170-b2009009-pre-release","title":"v0.17.0-B2009009 (pre-release)","text":"<p>What's changed since v0.16.0:</p> <ul> <li>General improvements:<ul> <li>Added support for <code>providers</code> template function. #177</li> <li>Added support for <code>dateTimeAdd</code> template function. #516</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0160","title":"v0.16.0","text":"<p>What's changed since v0.15.0:</p> <ul> <li>New features:<ul> <li>Added <code>Azure.GA_2020_09</code> baseline. #488<ul> <li>Includes rules released before or during September 2020 for Azure GA features.</li> <li>Marked baseline <code>Azure.GA_2020_06</code> as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>CDN:<ul> <li>Check CDN endpoint naming requirements. #486</li> <li>Check CDN endpoints use TLS 1.2. #487</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.18.8. #504</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Updated rule content to align with Microsoft Azure Well-Architected Framework pillars. #481</li> <li>Improve output of template processing exceptions. #484</li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v0.20.0.</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed Data Factory version not detected with template. #498</li> <li>Fixed parameter file detection with <code>2019-04-01</code> schema. #495</li> <li>Fixed deprecated <code>$Rule</code> properties. #491</li> </ul> </li> </ul> <p>What's changed since pre-release v0.16.0-B2009033:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v0/#v0160-b2009033-pre-release","title":"v0.16.0-B2009033 (pre-release)","text":"<p>What's changed since pre-release v0.16.0-B2009024:</p> <ul> <li>New features:<ul> <li>Added <code>Azure.GA_2020_09</code> baseline. #488<ul> <li>Includes rules released before or during September 2020 for Azure GA features.</li> <li>Marked baseline <code>Azure.GA_2020_06</code> as obsolete.</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.18.8. #504</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v0.20.0.</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0160-b2009024-pre-release","title":"v0.16.0-B2009024 (pre-release)","text":"<p>What's changed since pre-release v0.16.0-B2009019:</p> <ul> <li>Bug fixes:<ul> <li>Fixed Data Factory version not detected with template. #498</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0160-b2009019-pre-release","title":"v0.16.0-B2009019 (pre-release)","text":"<p>What's changed since pre-release v0.16.0-B2009011:</p> <ul> <li>Bug fixes:<ul> <li>Fixed parameter file detection with <code>2019-04-01</code> schema. #495</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0160-b2009011-pre-release","title":"v0.16.0-B2009011 (pre-release)","text":"<p>What's changed since pre-release v0.16.0-B2009004:</p> <ul> <li>Bug fixes:<ul> <li>Fixed deprecated <code>$Rule</code> properties. #491</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0160-b2009004-pre-release","title":"v0.16.0-B2009004 (pre-release)","text":"<p>What's changed since v0.15.0:</p> <ul> <li>New rules:<ul> <li>CDN:<ul> <li>Check CDN endpoint naming requirements. #486</li> <li>Check CDN endpoints use TLS 1.2. #487</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Updated rule content to align with Microsoft Azure Well-Architected Framework pillars. #481</li> <li>Improve output of template processing exceptions. #484</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0150","title":"v0.15.0","text":"<p>What's changed since v0.14.1:</p> <ul> <li>New rules:<ul> <li>All resources:<ul> <li>Check ARM template parameters are used. #232</li> <li>Check ARM template variables are used. #233</li> <li>Check ARM template parameters include a metadata description. #360</li> <li>Check ARM templates define at least one resource. #359</li> </ul> </li> <li>Database for MySQL:<ul> <li>Check database servers reject TLS versions older than 1.2. #469</li> </ul> </li> <li>Database for PostgreSQL:<ul> <li>Check database servers reject TLS versions older than 1.2. #470</li> </ul> </li> <li>SQL Database:<ul> <li>Check database servers reject TLS versions older than 1.2. #471</li> </ul> </li> <li>Storage Account:<ul> <li>Check Storage Accounts reject TLS versions older than 1.2. #455</li> <li>Check Storage Accounts only accept authorized requests. #456</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.17.9. #452</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v0.19.0.</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed export of non-blob Storage Accounts. #464</li> <li>Fixed export of subscription Security Center data based on API version. #465</li> <li>Fixed masking of sharedKey when property does not exist. #466</li> </ul> </li> </ul> <p>What's changed since pre-release v0.15.0-B2008034:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v0/#v0150-b2008043-pre-release","title":"v0.15.0-B2008043 (pre-release)","text":"<p>What's changed since pre-release v0.15.0-B2008034:</p> <ul> <li>New rules:<ul> <li>Database for MySQL:<ul> <li>Check database servers reject TLS versions older than 1.2. #469</li> </ul> </li> <li>Database for PostgreSQL:<ul> <li>Check database servers reject TLS versions older than 1.2. #470</li> </ul> </li> <li>SQL Database:<ul> <li>Check database servers reject TLS versions older than 1.2. #471</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed use variables check when no variables are defined. #462</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0150-b2008034-pre-release","title":"v0.15.0-B2008034 (pre-release)","text":"<p>What's changed since pre-release v0.15.0-B2008026:</p> <ul> <li>Bug fixes:<ul> <li>Fixed export of non-blob Storage Accounts. #464</li> <li>Fixed export of subscription Security Center data based on API version. #465</li> <li>Fixed masking of sharedKey when property does not exist. #466</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0150-b2008026-pre-release","title":"v0.15.0-B2008026 (pre-release)","text":"<p>What's changed since v0.14.1:</p> <ul> <li>New rules:<ul> <li>All resources:<ul> <li>Check ARM template parameters are used. #232</li> <li>Check ARM template variables are used. #233</li> <li>Check ARM template parameters include a metadata description. #360</li> <li>Check ARM templates define at least one resource. #359</li> </ul> </li> <li>Storage Account:<ul> <li>Check Storage Accounts reject TLS versions older than 1.2. #455</li> <li>Check Storage Accounts only accept authorized requests. #456</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.17.9. #452</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0141","title":"v0.14.1","text":"<p>What's changed since v0.14.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed resource tags rule to exclude diagnostic settings. #448</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0140","title":"v0.14.0","text":"<p>What's changed since v0.13.0:</p> <ul> <li>New rules:<ul> <li>API Management:<ul> <li>Check API Management service name requirements. #437</li> <li>Check API Management products have legal terms. #438</li> <li>Check API Management products have a display name and description. #439</li> <li>Check API Management APIs have a display name and description. #440</li> </ul> </li> <li>Subscriptions:<ul> <li>Check subscription is managed by PIM. #422</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.17.7. #427</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Updated rule reasons and logic. #424</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed masking for network connection resource configuration. #434</li> <li>Fixed hybrid use benefit rule to exclude Windows client OSs. #433</li> <li>Fixed VM standalone rule to exclude Windows client OSs. #442</li> </ul> </li> </ul> <p>What's changed since pre-release v0.14.0-B2007031:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v0/#v0140-b2007031-pre-release","title":"v0.14.0-B2007031 (pre-release)","text":"<p>What's changed since pre-release v0.14.0-B2007020:</p> <ul> <li>New rules:<ul> <li>API Management:<ul> <li>Check API Management service name requirements. #437</li> <li>Check API Management products have legal terms. #438</li> <li>Check API Management products have a display name and description. #439</li> <li>Check API Management APIs have a display name and description. #440</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed masking for network connection resource configuration. #434</li> <li>Fixed hybrid use benefit rule to exclude Windows client OSs. #433</li> <li>Fixed VM standalone rule to exclude Windows client OSs. #442</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0140-b2007020-pre-release","title":"v0.14.0-B2007020 (pre-release)","text":"<p>What's changed since v0.13.0:</p> <ul> <li>New rules:<ul> <li>Subscriptions:<ul> <li>Check subscription is managed by PIM. #422</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.17.7. #427</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Updated rule reasons and logic. #424</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0130","title":"v0.13.0","text":"<p>What's changed since v0.12.1:</p> <ul> <li>New features:<ul> <li>Added <code>Azure.GA_2020_06</code> baseline. #399<ul> <li>Includes rules released before or during June 2020 for Azure GA features.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check AKS clusters use a Standard load balancer SKU. #334</li> <li>Check AKS clusters use Managed Identities for cluster infrastructure. #333</li> <li>Check AKS clusters use Azure Policy add-on (preview). #405</li> </ul> </li> <li>Public IP:<ul> <li>Check Public IP domain name label requirements. #389</li> </ul> </li> <li>Virtual Machines:<ul> <li>Check Availability Set name requirements. #387</li> <li>Check Computer name requirements. #387</li> <li>Check Managed Disk name requirements. #387</li> <li>Check Network Interface name requirements. #387</li> <li>Check Virtual Machine name requirements. #387</li> <li>Check Proximity Placement Group name requirements. #387</li> </ul> </li> <li>Virtual Machine Scale Sets:<ul> <li>Check Computer name requirements. #387</li> <li>Check Virtual Machine Scale Set name requirements. #387</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.16.9. #394</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed module default culture. #390</li> <li>Fixed exception message for object property that does not exist. #362</li> <li>Fixed substring raises an exception processing sub expressions. #413</li> </ul> </li> </ul> <p>What's changed since pre-release v0.13.0-B2006032:</p> <ul> <li>Bug fixes:<ul> <li>Fixed substring raises an exception processing sub expressions. #413</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0130-b2006032-pre-release","title":"v0.13.0-B2006032 (pre-release)","text":"<ul> <li>New features:<ul> <li>Added <code>Azure.GA_2020_06</code> baseline. #399<ul> <li>Includes rules released before or during June 2020 for Azure GA features.</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed exception message for object property that does not exist. #362</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0130-b2006023-pre-release","title":"v0.13.0-B2006023 (pre-release)","text":"<ul> <li>New rules:<ul> <li>Public IP:<ul> <li>Check Public IP domain name label requirements. #389</li> </ul> </li> <li>Virtual Machines:<ul> <li>Check Availability Set name requirements. #387</li> <li>Check Computer name requirements. #387</li> <li>Check Managed Disk name requirements. #387</li> <li>Check Network Interface name requirements. #387</li> <li>Check Virtual Machine name requirements. #387</li> <li>Check Proximity Placement Group name requirements. #387</li> </ul> </li> <li>Virtual Machine Scale Sets:<ul> <li>Check Computer name requirements. #387</li> <li>Check Virtual Machine Scale Set name requirements. #387</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0130-b2006017-pre-release","title":"v0.13.0-B2006017 (pre-release)","text":"<ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check AKS clusters use a Standard load balancer SKU. #334</li> <li>Check AKS clusters use Managed Identities for cluster infrastructure. #333</li> <li>Check AKS clusters use Azure Policy add-on (preview). #405</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0130-b2006003-pre-release","title":"v0.13.0-B2006003 (pre-release)","text":"<ul> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.16.9. #394</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed module default culture. #390</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0121","title":"v0.12.1","text":"<p>What's changed since v0.12.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed subnet name check for VNET with no subnets. #386</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0120","title":"v0.12.0","text":"<p>What's changed since v0.11.0:</p> <ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check AKS cluster name requirements. #373</li> <li>Check AKS cluster DNS prefix requirements. #373</li> </ul> </li> <li>Container Registry:<ul> <li>Check registry name requirements. #373</li> </ul> </li> <li>Front Door:<ul> <li>Check Front Door name requirements. #373</li> </ul> </li> <li>Load Balancer:<ul> <li>Check Load Balancer name requirements. #373</li> </ul> </li> <li>Network Security Group:<ul> <li>Check NSG name requirements. #373</li> </ul> </li> <li>Public IP:<ul> <li>Check Public IP name requirements. #373</li> </ul> </li> <li>Policy:<ul> <li>Check Policy definitions use descriptive fields. #364</li> </ul> </li> <li>Resource Group:<ul> <li>Check Resource Group name requirements. #373</li> </ul> </li> <li>Route table<ul> <li>Check Route table name requirements. #373</li> </ul> </li> <li>SignalR Service:<ul> <li>Check SignalR Service name requirements. #373</li> </ul> </li> <li>SQL Database:<ul> <li>Check SQL Database uses TDE. #379</li> <li>Check SQL Database uses AAD authentication. #378</li> </ul> </li> <li>Storage Account:<ul> <li>Check Storage Account name requirements. #373</li> <li>Check Storage blob containers use private access type. #365</li> </ul> </li> <li>Virtual Network:<ul> <li>Check VNET name requirements. #373</li> <li>Check VNET subnet name requirements. #373</li> </ul> </li> <li>Virtual Network Gateway:<ul> <li>Check VNG name requirements. #373</li> <li>Check VNG connection name requirements. #373</li> <li>Check ExpressRoute Gateway uses current SKU. #369</li> <li>Check VPN Gateway uses current SKU. #370</li> <li>Check VPN Gateway uses active-active configuration. #371</li> </ul> </li> </ul> </li> </ul> <p>What's changed since pre-release v0.12.0-B2005026:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v0/#v0120-b2005026-pre-release","title":"v0.12.0-B2005026 (pre-release)","text":"<ul> <li>New rules:<ul> <li>SQL Database:<ul> <li>Check SQL Database uses TDE. #379</li> <li>Check SQL Database uses AAD authentication. #378</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed handling of subnet sub-resource name with slash. #381</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0120-b2005019-pre-release","title":"v0.12.0-B2005019 (pre-release)","text":"<ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check AKS cluster name requirements. #373</li> <li>Check AKS cluster DNS prefix requirements. #373</li> </ul> </li> <li>Container Registry:<ul> <li>Check registry name requirements. #373</li> </ul> </li> <li>Front Door:<ul> <li>Check Front Door name requirements. #373</li> </ul> </li> <li>Load Balancer:<ul> <li>Check Load Balancer name requirements. #373</li> </ul> </li> <li>Network Security Group:<ul> <li>Check NSG name requirements. #373</li> </ul> </li> <li>Public IP:<ul> <li>Check Public IP name requirements. #373</li> </ul> </li> <li>Resource Group:<ul> <li>Check Resource Group name requirements. #373</li> </ul> </li> <li>Route table<ul> <li>Check Route table name requirements. #373</li> </ul> </li> <li>SignalR Service:<ul> <li>Check SignalR Service name requirements. #373</li> </ul> </li> <li>Storage Account:<ul> <li>Check Storage Account name requirements. #373</li> </ul> </li> <li>Virtual Network:<ul> <li>Check VNET name requirements. #373</li> <li>Check VNET subnet name requirements. #373</li> </ul> </li> <li>Virtual Network Gateway:<ul> <li>Check VNG name requirements. #373</li> <li>Check VNG connection name requirements. #373</li> <li>Check ExpressRoute Gateway uses current SKU. #369</li> <li>Check VPN Gateway uses current SKU. #370</li> <li>Check VPN Gateway uses active-active configuration. #371</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0120-b2005005-pre-release","title":"v0.12.0-B2005005 (pre-release)","text":"<ul> <li>New rules:<ul> <li>Storage Account:<ul> <li>Check Storage blob containers use private access type. #365</li> </ul> </li> <li>Policy:<ul> <li>Check Policy definitions use descriptive fields. #364</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0110","title":"v0.11.0","text":"<p>What's changed since v0.10.1:</p> <ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check AKS nodes use a minimum number of pods. #274</li> </ul> </li> <li>API Management:<ul> <li>Check API Management products require a subscription. #342</li> <li>Check API Management products require approval. #343</li> <li>Check API Management sample products have been removed. #344</li> <li>Check API Management uses a managed identity. #345</li> <li>Check API Management certificates are not expired. #346</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added name and type bindings for template files. #353</li> <li>Breaking change: Renamed configuration options to use a standard prefix. #327<ul> <li>Configuration options use the <code>Azure_</code> prefix.</li> <li>Update configuration settings to use the new name, old configuration names are ignored.</li> <li>Renamed <code>minAKSVersion</code> to <code>Azure_AKSMinimumVersion</code>.</li> <li>Renamed <code>azureAllowedRegions</code> to <code>Azure_AllowedRegions</code>.</li> <li>Added configuration option documentation. See about_PSRule_Azure_Configuration for details.</li> </ul> </li> </ul> </li> </ul> <p>What's changed since pre-release v0.11.0-B2004012:</p> <ul> <li>General improvements:<ul> <li>Added name and type bindings for template files. #353</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0110-b2004012-pre-release","title":"v0.11.0-B2004012 (pre-release)","text":"<ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check AKS nodes use a minimum number of pods. #274</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Breaking change: Renamed configuration options to use a standard prefix. #327<ul> <li>Configuration options use the <code>Azure_</code> prefix.</li> <li>Update configuration settings to use the new name, old configuration names are ignored.</li> <li>Renamed <code>minAKSVersion</code> to <code>Azure_AKSMinimumVersion</code>.</li> <li>Renamed <code>azureAllowedRegions</code> to <code>Azure_AllowedRegions</code>.</li> <li>Added configuration option documentation. See about_PSRule_Azure_Configuration for details.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0110-b2004005-pre-release","title":"v0.11.0-B2004005 (pre-release)","text":"<ul> <li>New rules:<ul> <li>API Management:<ul> <li>Check API Management products require a subscription. #342</li> <li>Check API Management products require approval. #343</li> <li>Check API Management sample products have been removed. #344</li> <li>Check API Management uses a managed identity. #345</li> <li>Check API Management certificates are not expired. #346</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0101","title":"v0.10.1","text":"<p>What's changed since v0.10.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed false positive for unused public IP in templates. #336</li> <li>Fixed false positive for use of managed disks in templates. #337</li> <li>Fixed false positive for disk caching when no VM data disks is null in templates. #338</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0100","title":"v0.10.0","text":"<p>What's changed since v0.9.0:</p> <ul> <li>New features:<ul> <li>Added support for linking parameter and template files for analysis with metadata. #324<ul> <li>Added <code>Get-AzRuleTemplateLink</code> cmdlet to get metadata link to template files.</li> <li>See cmdlet help for usage.</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.16.7. #330</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Removed warning message for <code>azureAllowedRegions</code> option. #328</li> <li>Improvements to verbose logging of <code>Export-AzRuleData</code>. #301</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed unused VM resource false positives in templates. #312</li> <li>Fixed handling SKU for accelerated networking. #314</li> <li>Fixed detection of hybrid use benefit in templates. #313</li> <li>Fixed exception message when a template or parameter file is not found. #316</li> <li>Fixed detection of diagnostic logging for Front Door. #307</li> <li>Fixed Front Door WAF Policy export. #308</li> <li>Fixed union of object properties in templates. #303</li> </ul> </li> </ul> <p>What's changed since pre-release v0.10.0-B2003051:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v0/#v0100-b2003051-pre-release","title":"v0.10.0-B2003051 (pre-release)","text":"<ul> <li>New features:<ul> <li>Added support for linking parameter and template files for analysis with metadata. #324<ul> <li>Added <code>Get-AzRuleTemplateLink</code> cmdlet to get metadata link to template files.</li> <li>See cmdlet help for usage.</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Removed warning message for <code>azureAllowedRegions</code> option. #328</li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.16.7. #330</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0100-b2003032-pre-release","title":"v0.10.0-B2003032 (pre-release)","text":"<ul> <li>Bug fixes:<ul> <li>Fixed unused VM resource false positives in templates. #312</li> <li>Fixed handling SKU for accelerated networking. #314</li> <li>Fixed detection of hybrid use benefit in templates. #313</li> <li>Fixed exception message when a template or parameter file is not found. #316</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0100-b2003004-pre-release","title":"v0.10.0-B2003004 (pre-release)","text":"<ul> <li>Bug fixes:<ul> <li>Fixed detection of diagnostic logging for Front Door. #307</li> <li>Fixed Front Door WAF Policy export. #308</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v0100-b2002023-pre-release","title":"v0.10.0-B2002023 (pre-release)","text":"<ul> <li>General improvements:<ul> <li>Improvements to verbose logging of <code>Export-AzRuleData</code>. #301</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed union of object properties in templates. #303</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v090","title":"v0.9.0","text":"<p>What's changed since v0.8.0:</p> <ul> <li>New rules:<ul> <li>Azure Firewall:<ul> <li>Check threat intelligence is configured as deny. #266</li> </ul> </li> <li>Front Door:<ul> <li>Check Front Door is enabled. #267</li> <li>Check Front Door uses TLS 1.2. #268</li> <li>Check Front Door has a configured WAF policy. #269</li> <li>Check Front Door WAF policy is configured in prevention mode. #271</li> <li>Check Front Door WAF policy is enabled. #270</li> <li>Check if diagnostic logs are configured. #289</li> </ul> </li> <li>Traffic Manager:<ul> <li>Check web-based endpoints are monitored with HTTPS. #240</li> <li>Check at least two endpoints are enabled. #241</li> </ul> </li> <li>Key Vault:<ul> <li>Check soft delete is enabled. #277</li> <li>Check purge protection is enabled. #280</li> <li>Check least privileges permissions assigned in access policy. #281</li> <li>Check if diagnostic logs are configured. #288</li> </ul> </li> <li>Subscriptions:<ul> <li>Check if service health alerts are configured. #290</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Exclude cloud shell storage accounts from data rules. #278<ul> <li><code>Azure.Storage.UseReplication</code> and <code>Azure.Storage.SoftDelete</code> ignore cloud shell storage accounts.</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Removed module dependency on <code>Az.Security</code>. #105</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed incorrect string formatting in POSIX culture.  #262</li> <li>Fixed <code>Azure.VNET.UseNSGs</code> to exclude <code>AzureFirewallSubnet</code>. #261</li> </ul> </li> </ul> <p>What's changed since pre-release v0.9.0-B2002036:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v0/#v090-b2002036-pre-release","title":"v0.9.0-B2002036 (pre-release)","text":"<ul> <li>Exclude cloud shell storage accounts from data rules. #278</li> <li>Added new rule for Subscriptions:<ul> <li>Check if service health alerts are configured. #290</li> </ul> </li> <li>Added new rule for Key Vault:<ul> <li>Check if diagnostic logs are configured. #288</li> </ul> </li> <li>Added new rule for Front Door:<ul> <li>Check if diagnostic logs are configured. #289</li> </ul> </li> <li>Removed module dependency on <code>Az.Security</code>. #105</li> </ul>"},{"location":"CHANGELOG-v0/#v090-b2002026-pre-release","title":"v0.9.0-B2002026 (pre-release)","text":"<ul> <li>Added new rules for Traffic Manager:<ul> <li>Check web-based endpoints are monitored with HTTPS. #240</li> <li>Check at least two endpoints are enabled. #241</li> </ul> </li> <li>Added new rules for Key Vault:<ul> <li>Check soft delete is enabled. #277</li> <li>Check purge protection is enabled. #280</li> <li>Check least privileges permissions assigned in access policy. #281</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v090-b2002019-pre-release","title":"v0.9.0-B2002019 (pre-release)","text":"<ul> <li>Added new rule to check Azure Firewall threat intelligence is configured as deny. #266</li> <li>Added new rules for Front Door:<ul> <li>Check Front Door is enabled. #267</li> <li>Check Front Door uses TLS 1.2. #268</li> <li>Check Front Door has a configured WAF policy. #269</li> <li>Check Front Door WAF policy is configured in prevention mode. #271</li> <li>Check Front Door WAF policy is enabled. #270</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v090-b2002011-pre-release","title":"v0.9.0-B2002011 (pre-release)","text":"<ul> <li>Fixed incorrect string formatting in POSIX culture.  #262</li> <li>Fixed <code>Azure.VNET.UseNSGs</code> to exclude <code>AzureFirewallSubnet</code>. #261</li> </ul>"},{"location":"CHANGELOG-v0/#v080","title":"v0.8.0","text":"<p>What's changed since v0.7.0:</p> <ul> <li>New rules:<ul> <li>API Management:<ul> <li>Check API Management uses secure protocol versions. #237</li> <li>Check API Management published APIs use HTTPS. #236</li> <li>Check API Management backend connections use HTTPS. #238</li> <li>Check API Management named values are encrypted. #239</li> </ul> </li> <li>Automation Accounts:<ul> <li>Check automation accounts use encrypted variables. #211</li> <li>Check automation account webhook expiry interval. #212</li> </ul> </li> <li>CDN:<ul> <li>Check Azure CDN connections use HTTPS. #242</li> </ul> </li> <li>Resource Manager Templates:<ul> <li>Check ARM template and parameter file structure. #225</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.15.7. #247</li> </ul> </li> <li>Virtual networks:<ul> <li>Updated <code>Azure.VNET.UseNSGs</code> to apply to subnet resources from templates. #246</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Improvements to rule help wording and usage of links section. #220 #224 #257<ul> <li>Documentation and reasons messages are now available for all <code>en</code> cultures.</li> </ul> </li> <li>Various updates to rule implementation to take advantage of PSRule v0.12.0 language features. #220</li> <li>Breaking change: Shorten rule names to improve output display. #119<ul> <li>Application Gateway rules have been renamed from <code>Azure.VirtualNetwork.*</code> to <code>Azure.AppGW.*</code>.</li> <li>Load balancer rules have been renamed from <code>Azure.VirtualNetwork.*</code> to <code>Azure.LB.*</code>.</li> <li>NSG rules have been renamed from <code>Azure.VirtualNetwork.*</code> to <code>Azure.NSG.*</code>.</li> <li>VNET rules have been renamed from <code>Azure.VirtualNetwork.*</code> to <code>Azure.VNET.*</code>.</li> <li>NIC rules have been renamed from <code>Azure.VirtualNetwork.*</code> to <code>Azure.VM.*</code>.</li> <li>Renamed storage account rule <code>Azure.Storage.SecureTransferRequired</code> to <code>Azure.Storage.SecureTransfer</code>.</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fix <code>Azure.Resource.UseTags</code> applying to template and parameter files. #230</li> </ul> </li> </ul> <p>What's changed since pre-release v0.8.0-B2001029:</p> <ul> <li>Fixed <code>Azure.VNET.UseNSGs</code> not populating subnet name in reason message. #256</li> <li>Updated reason strings to use parent culture <code>en</code>. #257</li> </ul>"},{"location":"CHANGELOG-v0/#v080-b2001029-pre-release","title":"v0.8.0-B2001029 (pre-release)","text":"<ul> <li>Updated <code>Azure.VNET.UseNSGs</code> to apply to subnet resources from templates. #246</li> <li>Updated <code>Azure.AKS.Version</code> to 1.15.7. #247</li> <li>Breaking change: Renamed <code>Azure.File.*</code> rules to <code>Azure.Template.*</code>. #252</li> </ul>"},{"location":"CHANGELOG-v0/#v080-b2001018-pre-release","title":"v0.8.0-B2001018 (pre-release)","text":"<ul> <li>Fixed <code>Azure.Resource.UseTags</code> applying to template and parameter files. #230</li> <li>Fixed ARM template and parameter schemas used to detect files. #234</li> <li>Added new rule to check API Management uses secure protocol versions. #237</li> <li>Added new rule to check API Management published APIs use HTTPS. #236</li> <li>Added new rule to check API Management backend connections use HTTPS. #238</li> <li>Added new rule to check API Management named values are encrypted. #239</li> <li>Added new rule to check Azure CDN connections use HTTPS. #242</li> </ul>"},{"location":"CHANGELOG-v0/#v080-b2001006-pre-release","title":"v0.8.0-B2001006 (pre-release)","text":"<ul> <li>Updated documentation to use parent culture <code>en</code>. #224</li> <li>Added rules for ARM template and parameter file structure. #225</li> <li>Breaking change: Application Gateway rules have been renamed from <code>Azure.VirtualNetwork.*</code> to <code>Azure.AppGW.*</code>. #119</li> <li>Breaking change: Load balancer rules have been renamed from <code>Azure.VirtualNetwork.*</code> to <code>Azure.LB.*</code>. #119</li> <li>Breaking change: NSG rules have been renamed from <code>Azure.VirtualNetwork.*</code> to <code>Azure.NSG.*</code>. #119</li> <li>Breaking change: VNET rules have been renamed from <code>Azure.VirtualNetwork.*</code> to <code>Azure.VNET.*</code>. #119</li> <li>Breaking change: NIC rules have been renamed from <code>Azure.VirtualNetwork.*</code> to <code>Azure.VM.*</code>. #119</li> <li>Breaking change: Renamed storage account rule <code>Azure.Storage.SecureTransferRequired</code> to <code>Azure.Storage.SecureTransfer</code>. #119</li> </ul>"},{"location":"CHANGELOG-v0/#v080-b1912026-pre-release","title":"v0.8.0-B1912026 (pre-release)","text":"<ul> <li>Fixed Automation account handling with no webhooks or variables. #219</li> <li>Rule improvements from PSRule v0.12.0. #220</li> <li>Updated <code>Azure.AKS.Version</code> to 1.15.5. #217</li> </ul>"},{"location":"CHANGELOG-v0/#v080-b1912012-pre-release","title":"v0.8.0-B1912012 (pre-release)","text":"<ul> <li>Added new rule to check automation accounts use encrypted variables. #211</li> <li>Added new rule to check automation account webhook expiry interval. #212</li> </ul>"},{"location":"CHANGELOG-v0/#v070","title":"v0.7.0","text":"<p>What's changed since v0.6.0:</p> <ul> <li>New rules:<ul> <li>Role assignment:<ul> <li>Check presence of classic Co-Administrators. #188</li> </ul> </li> <li>Azure Kubernetes Service:<ul> <li>Check AKS node pool version matches cluster version. #186</li> <li>Check AKS clusters use pod security policies. #142</li> <li>Check AKS clusters use network policies. #143</li> <li>Check AKS node pools use scale sets. #187</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to check for node pool version. #191</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added custom bindings for common resource properties. #202</li> <li>Added new baseline to include rules for preview features. #190</li> <li>Breaking change: Shorten rule names to improve output display. #119<ul> <li>RBAC rules have been renamed from <code>Azure.Subscription.*</code> to <code>Azure.RBAC.*</code>.</li> <li>Security Center rules have been renamed from <code>Azure.Subscription.*</code> to <code>Azure.SecureCenter.*</code>.</li> </ul> </li> <li>Breaking change: Renamed default baseline from <code>Azure.SubscriptionDefault</code> to <code>Azure.Default</code>. #190</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed handling of tags for sub-resources. #203</li> <li>Fixed missing cmdlet help. #196</li> <li>Fixed AKS templates without node pool orchestratorVersion fail. #198</li> <li>Fixed null reference without parameters file. #189</li> </ul> </li> </ul> <p>What's changed since pre-release v0.7.0-B1912024:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v0/#v070-b1912024-pre-release","title":"v0.7.0-B1912024 (pre-release)","text":"<ul> <li>Fixed handling of tags for sub-resources. #203</li> <li>Added custom bindings for common resource properties. #202</li> </ul>"},{"location":"CHANGELOG-v0/#v070-b1912017-pre-release","title":"v0.7.0-B1912017 (pre-release)","text":"<ul> <li>Fixed missing cmdlet help. #196</li> <li>Fixed AKS templates without node pool orchestratorVersion fail. #198</li> </ul>"},{"location":"CHANGELOG-v0/#v070-b1912008-pre-release","title":"v0.7.0-B1912008 (pre-release)","text":"<ul> <li>Fixed null reference without parameters file. #189</li> <li>Added new rule to check presence of classic Co-Administrators. #188</li> <li>Added new rule to check AKS node pool version matches cluster version. #186</li> <li>Added new rule to check AKS clusters use pod security policies. #142</li> <li>Added new rule to check AKS clusters use network policies. #143</li> <li>Added new rule to check AKS node pools use scale sets. #187</li> <li>Added new baseline to include rules for preview features. #190</li> <li>Updated <code>Azure.AKS.Version</code> to check for node pool version. #191</li> <li>Breaking change: RBAC rules have been renamed from <code>Azure.Subscription.*</code> to <code>Azure.RBAC.*</code>. #119</li> <li>Breaking change: Security Center rules have been renamed from <code>Azure.Subscription.*</code> to <code>Azure.SecureCenter.*</code>. #119</li> <li>Breaking change: Renamed default baseline from <code>Azure.SubscriptionDefault</code> to <code>Azure.Default</code>. #190</li> </ul>"},{"location":"CHANGELOG-v0/#v060","title":"v0.6.0","text":"<p>What's changed since v0.5.0:</p> <ul> <li>New features:<ul> <li>Added support for exporting rule data from templates. #145<ul> <li>Added <code>Export-AzTemplateRuleData</code> cmdlet to export templates. See cmdlet help for limitations.</li> <li>Template and parameters are merged, resolving functions, copy loops and conditions.</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Services:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.14.8. #140</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Updated rules to use type pre-conditions. #144</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed processing of <code>Azure.Resource.UseTags</code> to exclude <code>*/providers/roleAssignments</code>. #155<ul> <li>Provider role assignments do not support tags.</li> </ul> </li> <li>Fixed processing of <code>Azure.Resource.AllowedRegions</code>. #156<ul> <li>Exclude <code>*/providers/roleAssignments</code>, <code>Microsoft.Authorization/*</code> and <code>Microsoft.Consumption/*</code>.</li> </ul> </li> <li>Fixed processing of <code>Azure.VirtualNetwork.NSGAssociated</code> for templates. #150</li> <li>Fixed processing of <code>Azure.VirtualNetwork.LateralTraversal</code> when <code>destinationPortRanges</code> is used. #149</li> </ul> </li> </ul> <p>What's changed since pre-release v0.6.0-B1911046:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v0/#v060-b1911046-pre-release","title":"v0.6.0-B1911046 (pre-release)","text":"<ul> <li>Improved template support of <code>Export-AzTemplateRuleData</code> cmdlet. #145<ul> <li>Added support for <code>deployment</code> function.</li> <li>Fixed property copy loop.</li> </ul> </li> <li>Fixed <code>Export-AzTemplateRuleData</code> does not return FileInfo objects. #162</li> <li>Fixed automatically name outputs from <code>Export-AzTemplateRuleData</code>. #163</li> <li>Fixed resource segmentation issue when ResourceType includes trailing slash. #165</li> <li>Fixed expand resource template property as null fails. #167</li> <li>Fixed case-sensitivity of variables, parameters and functions. #168</li> <li>Fixed out of order parameter and variables cross reference. #170</li> <li>Fixed expression parser race condition. #171</li> <li>Fixed handling of padding spaces in expressions. #173</li> <li>Fixed property of property is parsed incorrectly. #174</li> <li>Fixed root variable copy loop handling. #175</li> </ul>"},{"location":"CHANGELOG-v0/#v060-b1911027-pre-release","title":"v0.6.0-B1911027 (pre-release)","text":"<ul> <li>Fixed processing of <code>Azure.Resource.UseTags</code> to exclude <code>*/providers/roleAssignments</code>. #155<ul> <li>Provider role assignments do not support tags.</li> </ul> </li> <li>Fixed processing of <code>Azure.Resource.AllowedRegions</code>. #156<ul> <li>Exclude <code>*/providers/roleAssignments</code>, <code>Microsoft.Authorization/*</code> and <code>Microsoft.Consumption/*</code>.</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v060-b1911020-pre-release","title":"v0.6.0-B1911020 (pre-release)","text":"<ul> <li>Fixed processing of <code>Azure.VirtualNetwork.NSGAssociated</code> for templates. #150</li> <li>Fixed processing of <code>Azure.VirtualNetwork.LateralTraversal</code> when <code>destinationPortRanges</code> is used. #149</li> <li>Improved template support of <code>Export-AzTemplateRuleData</code> cmdlet. #145<ul> <li>Added support for nested templates.</li> <li>Added support for <code>array</code>, <code>createArray</code>, <code>coalesce</code>, <code>intersection</code>, <code>dataUri</code> and <code>dataUriToString</code> functions.</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v060-b1911011-pre-release","title":"v0.6.0-B1911011 (pre-release)","text":"<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.14.8. #140</li> <li>Updated rules to use type pre-conditions. #144</li> <li>Experimental: Added support for exporting rule data from templates. #145<ul> <li>Added <code>Export-AzTemplateRuleData</code> cmdlet to export templates. See cmdlet help for limitations.</li> <li>Template and parameters are merged, resolving functions, copy loops and conditions.</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v050","title":"v0.5.0","text":"<p>What's changed since v0.4.0:</p> <ul> <li>New rules:<ul> <li>Virtual machines:<ul> <li>Check Windows automatic updates are enabled. #132</li> <li>Check VM agent is automatically provisioned. #131</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Services:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.14.6. #130</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Shorten rule names for virtual machined to <code>Azure.VM.*</code> to improve output display. #119<ul> <li>Breaking change: Rules have been renamed from <code>Azure.VirtualMachine.*</code> to <code>Azure.VM.*</code>.</li> </ul> </li> </ul> </li> </ul> <p>What's changed since pre-release v0.5.0-B1910004:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v0/#v050-b1910004-pre-release","title":"v0.5.0-B1910004 (pre-release)","text":"<ul> <li>Added rule to verify Windows automatic updates are enabled. #132</li> <li>Added rule to verify VM agent is automatically provisioned. #131</li> <li>Updated <code>Azure.AKS.Version</code> to 1.14.6. #130</li> <li>Breaking change: Renamed <code>Azure.VirtualMachine.*</code> rules to <code>Azure.VM.*</code>. #119</li> </ul>"},{"location":"CHANGELOG-v0/#v040","title":"v0.4.0","text":"<p>What's changed since v0.3.0:</p> <ul> <li>New rules:<ul> <li>Virtual machines:<ul> <li>Added rule to verify Azure Disk Encryption. #122</li> <li>Added rule to check if public key is used for Linux. #123</li> </ul> </li> <li>Virtual networking:<ul> <li>Added rule to verify connectivity of VNET peers. #120</li> <li>Added rule to check configuration of HTTP/ HTTPS load balancer probes. #121</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Removed dependency on Az.Storage module. #105</li> <li>Added default baseline to module. #126</li> </ul> </li> </ul> <p>What's changed since pre-release v0.4.0-B190902:</p> <ul> <li>Added default baseline to module. #126</li> </ul>"},{"location":"CHANGELOG-v0/#v040-b190902-pre-release","title":"v0.4.0-B190902 (pre-release)","text":"<ul> <li>Added rule to verify connectivity of VNET peers. #120</li> <li>Added rule to check configuration of HTTP/ HTTPS load balancer probes. #121</li> <li>Added rule to verify Azure Disk Encryption. #122</li> <li>Added rule to check if public key is used for Linux. #123</li> <li>Removed dependency on Az.Storage module. #105</li> </ul>"},{"location":"CHANGELOG-v0/#v030","title":"v0.3.0","text":"<p>What's changed since v0.2.0:</p> <ul> <li>New rules:<ul> <li>App Services:<ul> <li>Enforce minimum TLS version for App Service. #99</li> </ul> </li> <li>Resource clean up:<ul> <li>Network security groups that are not associated. #93</li> <li>Unattached network interfaces. #92</li> </ul> </li> <li>Role assignment:<ul> <li>Added subscription RBAC delegation rules. #107<ul> <li>Check for number of subscription owners.</li> <li>Check for RBAC inheritance from management groups.</li> <li>Check for user RBAC assignments.</li> <li>Check for RBAC delegation on individual resources.</li> </ul> </li> </ul> </li> <li>Virtual machines:<ul> <li>VMs should avoid using expired promo SKUs. #87</li> <li>VMs should avoid using basic SKUs. #69</li> </ul> </li> <li>Virtual networking:<ul> <li>Added NSG rule to check for lateral traversal security rules. #103</li> <li>Added rule to detect deny all inbound NSG rule. #94</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>App Services:<ul> <li>Updated App Service site rules to include slots. #100</li> <li><code>Azure.AppService.ARRAffinity</code> and <code>Azure.AppService.UseHTTPS</code> now run against slots.</li> </ul> </li> <li>Azure Kubernetes Services:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.14.5. #109</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fix handling of empty DNS servers in <code>Azure.VirtualNetwork.LocalDNS</code>. #84</li> <li>Fix handling of no peering connections in <code>Azure.VirtualNetwork.LocalDNS</code>. #89</li> <li>Fix export of additional properties for <code>Microsoft.Sql/servers</code>. #114</li> <li>Excluded global services from Azure.Resource.AllowedRegions. #96</li> </ul> </li> </ul> <p>What's changed since pre-release v0.3.0-B190807:</p> <ul> <li>Fix export of additional properties for <code>Microsoft.Sql/servers</code>. #114</li> </ul>"},{"location":"CHANGELOG-v0/#v030-b190807-pre-release","title":"v0.3.0-B190807 (pre-release)","text":"<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.14.5. #109</li> <li>Added subscription RBAC delegation rules. #107<ul> <li>Check for number of subscription owners.</li> <li>Check for RBAC inheritance from management groups.</li> <li>Check for user RBAC assignments.</li> <li>Check for RBAC delegation on individual resources.</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v030-b190723-pre-release","title":"v0.3.0-B190723 (pre-release)","text":"<ul> <li>Excluded global services from Azure.Resource.AllowedRegions. #96</li> <li>Enforce minimum TLS version for App Service. #99</li> <li>Updated App Service site rules to include slots. #100<ul> <li><code>Azure.AppService.ARRAffinity</code> and <code>Azure.AppService.UseHTTPS</code> now run against slots.</li> </ul> </li> <li>Added rule to detect deny all inbound NSG rule. #94</li> <li>Added unused resource rules.<ul> <li>Network security groups that are not associated. #93</li> <li>Unattached network interfaces. #92</li> </ul> </li> <li>Added NSG rule to check for lateral traversal security rules. #103</li> </ul>"},{"location":"CHANGELOG-v0/#v030-b190710-pre-release","title":"v0.3.0-B190710 (pre-release)","text":"<ul> <li>Fix handling of empty DNS servers in <code>Azure.VirtualNetwork.LocalDNS</code>. #84</li> <li>Fix handling of no peering connections in <code>Azure.VirtualNetwork.LocalDNS</code>. #89</li> <li>Updated AKS version in <code>Azure.AKS.Version</code> to 1.13.7. #83</li> <li>Added VM SKU rules:<ul> <li>VMs should avoid using expired promo SKUs. #87</li> <li>VMs should avoid using basic SKUs. #69</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v020","title":"v0.2.0","text":"<p>What's changed since v0.1.0:</p> <ul> <li>Fix rule <code>Azure.AKS.UseRBAC</code> returns null. #60</li> <li>Fix rule <code>Azure.Storage.SoftDelete</code> and <code>Azure.Storage.SecureTransferRequired</code> returns null. #64</li> <li>Fix collection of ASR vault configuration for cmdlet deprecation. #63</li> <li>Updated rules to use <code>Recommend</code> keyword instead of <code>Hint</code> alias. #71</li> <li>Added SQL firewall rule range check to determine an excessive number of permitted IP addresses. #3 #10 #54<ul> <li>The rules <code>Azure.SQL.FirewallIPRange</code>, <code>Azure.MySQL.FirewallIPRange</code> and <code>Azure.PostgreSQL.FirewallIPRange</code> were added to check SQL, MySQL and PostgreSQL.</li> </ul> </li> <li>Added parameters to filter resource export by resource group and/ or tag. #59<ul> <li>Added <code>-ResourceGroupName</code> and <code>-Tag</code> parameters to <code>Export-AzRuleData</code> cmdlet.</li> </ul> </li> <li>Added support for Application Gateway v2. #75</li> <li>Added VNET rule to check for local DNS. #68</li> <li>Added WAF hardening rules for Application Gateway. #78<ul> <li>Application Gateways use OWASP 3.x rules.</li> <li>Application Gateways have WAF enabled.</li> <li>Application Gateways have all OWASP rules enabled.</li> </ul> </li> </ul> <p>What's changed since pre-release v0.2.0-B190715:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v0/#v020-b190715-pre-release","title":"v0.2.0-B190715 (pre-release)","text":"<ul> <li>Added support for Application Gateway v2. #75</li> <li>Added VNET rule to check for local DNS. #68</li> <li>Added WAF hardening rules for Application Gateway. #78<ul> <li>Application Gateways use OWASP 3.x rules.</li> <li>Application Gateways have WAF enabled.</li> <li>Application Gateways have all OWASP rules enabled.</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v020-b190706-pre-release","title":"v0.2.0-B190706 (pre-release)","text":"<ul> <li>Fix rule <code>Azure.AKS.UseRBAC</code> returns null. #60</li> <li>Fix rule <code>Azure.Storage.SoftDelete</code> and <code>Azure.Storage.SecureTransferRequired</code> returns null. #64</li> <li>Fix collection of ASR vault configuration for cmdlet deprecation. #63</li> <li>Added SQL firewall rule range check to determine an excessive number of permitted IP addresses. #3 #10 #54<ul> <li>The rules <code>Azure.SQL.FirewallIPRange</code>, <code>Azure.MySQL.FirewallIPRange</code> and <code>Azure.PostgreSQL.FirewallIPRange</code> were added to check SQL, MySQL and PostgreSQL.</li> </ul> </li> <li>Updated rules to use <code>Recommend</code> keyword instead of <code>Hint</code> alias. #71</li> <li>Added parameters to filter resource export by resource group and/ or tag. #59<ul> <li>Added <code>-ResourceGroupName</code> and <code>-Tag</code> parameters to <code>Export-AzRuleData</code> cmdlet.</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v010","title":"v0.1.0","text":"<ul> <li>Initial release.</li> </ul> <p>What's changed since pre-release v0.1.0-B190624:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v0/#v010-b190624-pre-release","title":"v0.1.0-B190624 (pre-release)","text":"<ul> <li>Added rule to check if allow access to Azure services enabled for MySQL. #4</li> <li>Added rule to count the number of database server firewall rules for MySQL. #2</li> <li>Added rule to check if allow access to Azure services enabled for PostgreSQL. #50</li> <li>Added rule to count the number of database server firewall rules for PostgreSQL. #51</li> <li>Added rule to check if SSL is enforced for PostgreSQL. #49</li> </ul>"},{"location":"CHANGELOG-v0/#v010-b190607-pre-release","title":"v0.1.0-B190607 (pre-release)","text":"<ul> <li>Added rule documentation. #40</li> </ul>"},{"location":"CHANGELOG-v0/#v010-b190569-pre-release","title":"v0.1.0-B190569 (pre-release)","text":"<ul> <li>Fix exported resource data overwritten. #34</li> </ul>"},{"location":"CHANGELOG-v0/#v010-b190562-pre-release","title":"v0.1.0-B190562 (pre-release)","text":"<ul> <li>Add units tests for <code>Export-AzRuleData</code> and update filters. #28</li> <li><code>Export-AzRuleData</code> returns files generated by default. #27</li> <li><code>Export-AzRuleData</code> passes through objects resource objects to the pipeline. #25</li> <li>Breaking change - <code>Export-AzRuleData</code> only exports data from current subscription context by default. #24<ul> <li>Data can be exported from all subscription contexts by using the <code>-All</code> switch, or specifying specific subscriptions with the <code>-Subscription</code> or <code>-Tenant</code> parameters.</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v0/#v010-b190543-pre-release","title":"v0.1.0-B190543 (pre-release)","text":"<ul> <li>Fix cannot find the type for custom attribute error. #21</li> </ul>"},{"location":"CHANGELOG-v0/#v010-b190536-pre-release","title":"v0.1.0-B190536 (pre-release)","text":"<ul> <li>Initial pre-release.</li> </ul>"},{"location":"CHANGELOG-v1/","title":"Change log","text":"<p>See upgrade notes for helpful information when upgrading from previous versions.</p> <p>Important notes:</p> <ul> <li>Issue #741: <code>Could not load file or assembly YamlDotNet</code>.   See troubleshooting guide for a workaround to this issue.</li> <li>The following configuration options are deprecated and have been replaced with alternative options.   If you have these options configured, please update them to the replacement.   Support for the old names will be removed in v2.   See upgrade notes for more information.<ul> <li><code>Azure_AKSMinimumVersion</code> is replaced with <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code>.</li> <li><code>Azure_AKSNodeMinimumMaxPods</code> is replaced with <code>AZURE_AKS_POOL_MINIMUM_MAXPODS</code>.</li> <li><code>Azure_AllowedRegions</code> is replaced with <code>AZURE_RESOURCE_ALLOWED_LOCATIONS</code>.</li> <li><code>Azure_MinimumCertificateLifetime</code> is replaced with <code>AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME</code>.</li> </ul> </li> <li>The <code>SupportsTag</code> PowerShell function has been replaced with the <code>Azure.Resource.SupportsTags</code> selector.   Update PowerShell rules to use the <code>Azure.Resource.SupportsTags</code> selector instead.   Support for the <code>SupportsTag</code> function will be removed in v2.   See upgrade notes for more information.</li> </ul>"},{"location":"CHANGELOG-v1/#unreleased","title":"Unreleased","text":""},{"location":"CHANGELOG-v1/#v1400","title":"v1.40.0","text":"<p>What's changed since v1.39.3:</p> <ul> <li>New features:<ul> <li>Added support for expanding from <code>.jsonc</code> parameter files by @BernieWhite.   #2053<ul> <li>Previously only parameter files with the <code>.json</code> extension where automatically expanded.</li> <li>This feature adds support so that JSON parameter files with the <code>.jsonc</code> extension are also discovered and expanded.</li> <li>No additional configuration is required if expansion of JSON parameter files is enabled.</li> <li>To enable parameter file expansion set the <code>AZURE_PARAMETER_FILE_EXPANSION</code> configuration option to <code>true</code>.</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Deployment:<ul> <li>Updated <code>Azure.Deployment.SecureValue</code> to check additional resource types by @BernieWhite.   #2650 #2651<ul> <li>Added support for container apps secret properties.</li> <li>Added support for deployment script secret properties.</li> <li>Bumped rule set to <code>2024_12</code>.</li> </ul> </li> <li>Updated <code>Azure.Deployment.SecureParameter</code> to reduce false positives by @BernieWhite.   #3149<ul> <li>Parameters named ending with <code>name</code>, <code>uri</code>, <code>url</code>, <code>path</code>, <code>type</code>, <code>id</code>, or <code>options</code> are ignored.</li> <li>The <code>customerManagedKey</code> parameter is ignored.</li> </ul> </li> </ul> </li> <li>Microsoft Defender for Cloud:<ul> <li>Updated <code>Azure.DefenderCloud.Contact</code> to use <code>emails</code> property and removed <code>phone</code> by @BernieWhite.   #3117<ul> <li>Renamed rule to <code>Azure.Defender.SecurityContact</code> to better align with naming for defender rules.</li> <li>Bumped rule set to <code>2024_12</code>.</li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added first time contributor guide in docs by @that-ar-guy.   #3097</li> <li>Additional quality updates to documentation by @BernieWhite.   #3102</li> </ul> </li> <li>Engineering:<ul> <li>Quality updates to rule documentation by @BernieWhite.   #3102</li> <li>Migrated Azure samples into PSRule for Azure by @BernieWhite.   #3085</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed evaluation of APIM policies when using embedded C# with quotes by @BernieWhite.   #3184</li> <li>Fixed resource group ID is incorrect under subscription scope by @BernieWhite.   #3198</li> <li>Fixed object to hashtable conversion for default parameter values by @BernieWhite.   #3033</li> <li>Fixed deployments with more than one module at tenant scope by @BernieWhite.   #3167</li> <li>Fixed projection of default role authorization property <code>principalType</code> by @BernieWhite.   #3163</li> <li>Fixed user defined function not found when used as parameter default by @BernieWhite.   #3169</li> <li>Fixed evaluation of <code>Azure.NSG.LateralTraversal</code> with empty string properties by @BernieWhite.   #3130</li> <li>Fixed evaluation of <code>Azure.Deployment.AdminUsername</code> with symbolic references by @BernieWhite.   #3146</li> <li>Fixed output map expansion with resource IDs by @BernieWhite.   #3153</li> </ul> </li> </ul> <p>What's changed since pre-release v1.40.0-B0206:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1400-b0206-pre-release","title":"v1.40.0-B0206 (pre-release)","text":"<p>What's changed since pre-release v1.40.0-B0147:</p> <ul> <li>General improvements:<ul> <li>Added first time contributor guide in docs by @that-ar-guy.   #3097</li> </ul> </li> <li>Engineering:<ul> <li>Quality updates to rule documentation by @BernieWhite.   #3102</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed evaluation of APIM policies when using embedded C# with quotes by @BernieWhite.   #3184</li> <li>Fixed resource group ID is incorrect under subscription scope by @BernieWhite.   #3198</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1400-b0147-pre-release","title":"v1.40.0-B0147 (pre-release)","text":"<p>What's changed since pre-release v1.40.0-B0103:</p> <ul> <li>Bug fixes:<ul> <li>Fixed object to hashtable conversion for default parameter values by @BernieWhite.   #3033</li> <li>Fixed deployments with more than one module at tenant scope by @BernieWhite.   #3167</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1400-b0103-pre-release","title":"v1.40.0-B0103 (pre-release)","text":"<p>What's changed since pre-release v1.40.0-B0063:</p> <ul> <li>New features:<ul> <li>Added support for expanding from <code>.jsonc</code> parameter files by @BernieWhite.   #2053<ul> <li>Previously only parameter files with the <code>.json</code> extension where automatically expanded.</li> <li>This feature adds support so that JSON parameter files with the <code>.jsonc</code> extension are also discovered and expanded.</li> <li>No additional configuration is required if expansion of JSON parameter files is enabled.</li> <li>To enable parameter file expansion set the <code>AZURE_PARAMETER_FILE_EXPANSION</code> configuration option to <code>true</code>.</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Additional quality updates to documentation by @BernieWhite.   #3102</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed projection of default role authorization property <code>principalType</code> by @BernieWhite.   #3163</li> <li>Fixed user defined function not found when used as parameter default by @BernieWhite.   #3169</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1400-b0063-pre-release","title":"v1.40.0-B0063 (pre-release)","text":"<p>What's changed since pre-release v1.40.0-B0029:</p> <ul> <li>Updated rules:<ul> <li>Microsoft Defender for Cloud:<ul> <li>Updated <code>Azure.DefenderCloud.Contact</code> to use <code>emails</code> property and removed <code>phone</code> by @BernieWhite.   #3117<ul> <li>Renamed rule to <code>Azure.Defender.SecurityContact</code> to better align with naming for defender rules.</li> <li>Bumped rule set to <code>2024_12</code>.</li> </ul> </li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed evaluation of <code>Azure.NSG.LateralTraversal</code> with empty string properties by @BernieWhite.   #3130</li> <li>Fixed evaluation of <code>Azure.Deployment.AdminUsername</code> with symbolic references by @BernieWhite.   #3146</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1400-b0029-pre-release","title":"v1.40.0-B0029 (pre-release)","text":"<p>What's changed since v1.39.3:</p> <ul> <li>Updated rules:<ul> <li>Deployment:<ul> <li>Updated <code>Azure.Deployment.SecureValue</code> to check additional resource types by @BernieWhite.   #2650 #2651<ul> <li>Added support for container apps secret properties.</li> <li>Added support for deployment script secret properties.</li> <li>Bumped rule set to <code>2024_12</code>.</li> </ul> </li> <li>Updated <code>Azure.Deployment.SecureParameter</code> to reduce false positives by @BernieWhite.   #3149<ul> <li>Parameters named ending with <code>name</code>, <code>uri</code>, <code>url</code>, <code>path</code>, <code>type</code>, <code>id</code>, or <code>options</code> are ignored.</li> <li>The <code>customerManagedKey</code> parameter is ignored.</li> </ul> </li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Migrated Azure samples into PSRule for Azure by @BernieWhite.   #3085</li> <li>Quality updates to rule documentation by @BernieWhite.   #3102</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed output map expansion with resource IDs by @BernieWhite.   #3153</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1393","title":"v1.39.3","text":"<p>What's changed since v1.39.2:</p> <ul> <li>Bug fixes:<ul> <li>Fixed index out of bounds for existing symbolic name reference by @BernieWhite.   #3129</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1392","title":"v1.39.2","text":"<p>What's changed since v1.39.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed user-defined function reference to exported variable by @BernieWhite.   #3120</li> <li>Fixed name expand of existing resource references by @BernieWhite.   #3123</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1391","title":"v1.39.1","text":"<p>What's changed since v1.39.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed <code>GetBicepParamResources</code> exception when expanding <code>Microsoft.Graph/groups</code> resource by @BernieWhite.   #3062</li> <li>Fixed <code>Azure.AppGw.AvailabilityZone</code> passes when a zonal configuration is used by @BernieWhite.   #3061</li> <li>Fixed conditional secret as parameter or placeholder by @BernieWhite.   #2054</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1390","title":"v1.39.0","text":"<p>What's changed since v1.38.0:</p> <ul> <li>New features:<ul> <li>Added September 2024 baselines <code>Azure.GA_2024_09</code> and <code>Azure.Preview_2024_09</code> by @BernieWhite.   #3048<ul> <li>Includes rules released before or during September 2024.</li> <li>Marked <code>Azure.GA_2024_06</code> and <code>Azure.Preview_2024_06</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Verify that clusters have kube-audit logging disabled when not required by @BenjaminEngeset.   #2450</li> <li>Verify that clusters have the customer-controlled maintenance windows <code>aksManagedAutoUpgradeSchedule</code> and <code>aksManagedNodeOSUpgradeSchedule</code> configured by @BenjaminEngeset.   #2444</li> </ul> </li> <li>App Service:<ul> <li>Verify that app service plans have availability zones configured by @BenjaminEngeset.   #2964</li> </ul> </li> <li>App Service Environment:<ul> <li>Verify that app service environments have availability zones configured by @BenjaminEngeset.   #2964</li> </ul> </li> <li>Azure SQL Database:<ul> <li>Verify that Azure SQL databases have a customer-controlled maintenance window configured by @BenjaminEngeset.   #2956</li> </ul> </li> <li>Azure SQL Managed Instance:<ul> <li>Verify that Azure SQL Managed Instances have a customer-controlled maintenance window configured by @BenjaminEngeset.   #2979</li> </ul> </li> <li>Service Bus:<ul> <li>Verify that service bus namespaces have geo-replication configured by @BenjaminEngeset.   #2988</li> </ul> </li> <li>Virtual Machine:<ul> <li>Verify that virtual machines does not have public IPs attached by @BenjaminEngeset.   #11</li> <li>Verify that multi-tenant Hosting Rights are used for Windows client VMs by @BenjaminEngeset.   #432</li> <li>Verify that availability set members are in a backend pool by @BenjaminEngeset.   #67</li> </ul> </li> <li>Virtual Machine Scale Sets:<ul> <li>Verify that virtual machine scale set instances does not have public IPs attached by @BenjaminEngeset.   #3014</li> </ul> </li> <li>Virtual Network:<ul> <li>Verify that zonal-deployed Azure firewalls uses Azure NAT Gateway for outbound access by @BenjaminEngeset.   ##3005</li> <li>Verify that subnets have disabled default outbound access for virtual machines by @BenjaminEngeset.   #3001</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.AuditLogs</code> documentation to call out important specific of the <code>kube-audit</code> log by @BernieWhite.   #2449</li> <li>Updated <code>Azure.AKS.Version</code> to use <code>1.29.7</code> as the minimum version by @BernieWhite.   #3042</li> </ul> </li> <li>Container Apps:<ul> <li>Updated <code>Azure.ContainerApp.AvailabilityZone</code> to check for infrastructure subnet by @BernieWhite.   #3068<ul> <li>Configuring an infrastructure subnet is a requirement for enabling zone redundancy.   Both rule and documentation have been updated to clearly call this out.</li> </ul> </li> </ul> </li> <li>Virtual Network:<ul> <li>Updated <code>Azure.VNET.UseNSGs</code> to correctly handle cases for special purpose and customer-excluded subnets by @BenjaminEngeset.   #3007</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Important change: Replaced the <code>Azure_AKSNodeMinimumMaxPods</code> option with <code>AZURE_AKS_POOL_MINIMUM_MAXPODS</code> by @BernieWhite.   #941<ul> <li>For compatibility, if <code>Azure_AKSNodeMinimumMaxPods</code> is set it will be used instead of <code>AZURE_AKS_POOL_MINIMUM_MAXPODS</code>.</li> <li>If only <code>AZURE_AKS_POOL_MINIMUM_MAXPODS</code> is set, this value will be used.</li> <li>The default will be used neither options are configured.</li> <li>If <code>Azure_AKSNodeMinimumMaxPods</code> is set a warning will be generated until the configuration is removed.</li> <li>Support for <code>Azure_AKSNodeMinimumMaxPods</code> is deprecated and will be removed in v2.</li> <li>See upgrade notes for details.</li> </ul> </li> <li>Important change: Replaced the <code>Azure_MinimumCertificateLifetime</code> option with <code>AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME</code> by @BernieWhite.   #941<ul> <li>For compatibility, if <code>Azure_MinimumCertificateLifetime</code> is set it will be used instead of <code>AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME</code>.</li> <li>If only <code>AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME</code> is set, this value will be used.</li> <li>The default will be used neither options are configured.</li> <li>If <code>Azure_MinimumCertificateLifetime</code> is set a warning will be generated until the configuration is removed.</li> <li>Support for <code>Azure_MinimumCertificateLifetime</code> is deprecated and will be removed in v2.</li> <li>See upgrade notes for details.</li> </ul> </li> <li>Add binding configuration to policy as rules docs by @BernieWhite.   #2995</li> <li>Updated resource providers and policy aliases.   #3074</li> </ul> </li> <li>Engineering:<ul> <li>Bump development tools to .NET 8.0 SDK by @BernieWhite.   #3017</li> <li>Quality updates to rule documentation by @BernieWhite.   #2570</li> <li>Bump xunit to v2.9.0.   #2982</li> <li>Bump xunit.runner.visualstudio to v2.8.2.   #2982</li> </ul> </li> <li>Bug fixed:<ul> <li>Fixed expansion with deployments by resource ID at management group by @BernieWhite #3013</li> <li>Fixed subscription aliases don't support tags by @BernieWhite.   #3021</li> <li>Fixed <code>Azure.AppService.AvailabilityZone</code> only detects premium by tier property @BenjaminEngeset.   #3034</li> <li>Fixed loading of expansion options from non-default options file @BernieWhite.   #3033</li> <li>Fixed TLS defaults for <code>Azure.Redis.MinTLS</code> and <code>Azure.RedisEnterprise.MinTLS</code> by @BernieWhite.   #3066</li> <li>Fixed symbolic expand for existing with conditional cases by @BernieWhite.   #2917</li> </ul> </li> </ul> <p>What's changed since pre-release v1.39.0-B0249:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1390-b0249-pre-release","title":"v1.39.0-B0249 (pre-release)","text":"<p>What's changed since pre-release v1.39.0-B0182:</p> <ul> <li>Bug fixes:<ul> <li>Fixed symbolic expand for existing with conditional cases by @BernieWhite.   #2917</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1390-b0182-pre-release","title":"v1.39.0-B0182 (pre-release)","text":"<p>What's changed since pre-release v1.39.0-B0118:</p> <ul> <li>Updated rules:<ul> <li>Container Apps:<ul> <li>Updated <code>Azure.ContainerApp.AvailabilityZone</code> to check for infrastructure subnet by @BernieWhite.   #3068<ul> <li>Configuring an infrastructure subnet is a requirement for enabling zone redundancy.   Both rule and documentation have been updated to clearly call this out.</li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Updated resource providers and policy aliases.   #3074</li> </ul> </li> <li>Engineering:<ul> <li>Quality updates to rule documentation by @BernieWhite.   #2570</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed TLS defaults for <code>Azure.Redis.MinTLS</code> and <code>Azure.RedisEnterprise.MinTLS</code> by @BernieWhite.   #3066</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1390-b0118-pre-release","title":"v1.39.0-B0118 (pre-release)","text":"<p>What's changed since pre-release v1.39.0-B0072:</p> <ul> <li>New features:<ul> <li>Added September 2024 baselines <code>Azure.GA_2024_09</code> and <code>Azure.Preview_2024_09</code> by @BernieWhite.   #3048<ul> <li>Includes rules released before or during September 2024.</li> <li>Marked <code>Azure.GA_2024_06</code> and <code>Azure.Preview_2024_06</code> baselines as obsolete.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1390-b0072-pre-release","title":"v1.39.0-B0072 (pre-release)","text":"<p>What's changed since pre-release v1.39.0-B0029:</p> <ul> <li>New rules:<ul> <li>Virtual Machine:<ul> <li>Verify that virtual machines does not have public IPs attached by @BenjaminEngeset.   #11</li> <li>Verify that multi-tenant Hosting Rights are used for Windows client VMs by @BenjaminEngeset.   #432</li> <li>Verify that availability set members are in a backend pool by @BenjaminEngeset.   #67</li> </ul> </li> <li>Virtual Machine Scale Sets:<ul> <li>Verify that virtual machine scale set instances does not have public IPs attached by @BenjaminEngeset.   #3014</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.AuditLogs</code> documentation to call out important specific of the <code>kube-audit</code> log by @BernieWhite.   #2449</li> <li>Updated <code>Azure.AKS.Version</code> to use <code>1.29.7</code> as the minimum version by @BernieWhite.   #3042</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Important change: Replaced the <code>Azure_AKSNodeMinimumMaxPods</code> option with <code>AZURE_AKS_POOL_MINIMUM_MAXPODS</code> by @BernieWhite.   #941<ul> <li>For compatibility, if <code>Azure_AKSNodeMinimumMaxPods</code> is set it will be used instead of <code>AZURE_AKS_POOL_MINIMUM_MAXPODS</code>.</li> <li>If only <code>AZURE_AKS_POOL_MINIMUM_MAXPODS</code> is set, this value will be used.</li> <li>The default will be used neither options are configured.</li> <li>If <code>Azure_AKSNodeMinimumMaxPods</code> is set a warning will be generated until the configuration is removed.</li> <li>Support for <code>Azure_AKSNodeMinimumMaxPods</code> is deprecated and will be removed in v2.</li> <li>See upgrade notes for details.</li> </ul> </li> <li>Important change: Replaced the <code>Azure_MinimumCertificateLifetime</code> option with <code>AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME</code> by @BernieWhite.   #941<ul> <li>For compatibility, if <code>Azure_MinimumCertificateLifetime</code> is set it will be used instead of <code>AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME</code>.</li> <li>If only <code>AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME</code> is set, this value will be used.</li> <li>The default will be used neither options are configured.</li> <li>If <code>Azure_MinimumCertificateLifetime</code> is set a warning will be generated until the configuration is removed.</li> <li>Support for <code>Azure_MinimumCertificateLifetime</code> is deprecated and will be removed in v2.</li> <li>See upgrade notes for details.</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump development tools to .NET 8.0 SDK by @BernieWhite.   #3017</li> </ul> </li> <li>Bug fixed:<ul> <li>Fixed expansion with deployments by resource ID at management group by @BernieWhite #3013</li> <li>Fixed subscription aliases don't support tags by @BernieWhite.   #3021</li> <li>Fixed <code>Azure.AppService.AvailabilityZone</code> only detects premium by tier property @BenjaminEngeset.   #3034</li> <li>Fixed loading of expansion options from non-default options file @BernieWhite.   #3033</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1390-b0029-pre-release","title":"v1.39.0-B0029 (pre-release)","text":"<p>What's changed since pre-release v1.39.0-B0009:</p> <ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Verify that clusters have kube-audit logging disabled when not required by @BenjaminEngeset.   #2450</li> <li>Verify that clusters have the customer-controlled maintenance windows <code>aksManagedAutoUpgradeSchedule</code> and <code>aksManagedNodeOSUpgradeSchedule</code> configured by @BenjaminEngeset.   #2444</li> </ul> </li> <li>Virtual Network:<ul> <li>Verify that zonal-deployed Azure firewalls uses Azure NAT Gateway for outbound access by @BenjaminEngeset.   ##3005</li> <li>Verify that subnets have disabled default outbound access for virtual machines by @BenjaminEngeset.   #3001</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Virtual Network:<ul> <li>Updated <code>Azure.VNET.UseNSGs</code> to correctly handle cases for special purpose and customer-excluded subnets by @BenjaminEngeset.   #3007</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Add binding configuration to policy as rules docs by @BernieWhite.   #2995</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1390-b0009-pre-release","title":"v1.39.0-B0009 (pre-release)","text":"<p>What's changed since v1.38.0:</p> <ul> <li>New rules:<ul> <li>App Service:<ul> <li>Verify that app service plans have availability zones configured by @BenjaminEngeset.   #2964</li> </ul> </li> <li>App Service Environment:<ul> <li>Verify that app service environments have availability zones configured by @BenjaminEngeset.   #2964</li> </ul> </li> <li>Azure SQL Database:<ul> <li>Verify that Azure SQL databases have a customer-controlled maintenance window configured by @BenjaminEngeset.   #2956</li> </ul> </li> <li>Azure SQL Managed Instance:<ul> <li>Verify that Azure SQL Managed Instances have a customer-controlled maintenance window configured by @BenjaminEngeset.   #2979</li> </ul> </li> <li>Service Bus:<ul> <li>Verify that service bus namespaces have geo-replication configured by @BenjaminEngeset.   #2988</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump xunit to v2.9.0.   #2982</li> <li>Bump xunit.runner.visualstudio to v2.8.2.   #2982</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1380","title":"v1.38.0","text":"<p>What's changed since v1.37.0:</p> <ul> <li>New features:<ul> <li>Added June 2024 baselines <code>Azure.GA_2024_06</code> and <code>Azure.Preview_2024_06</code> by @BernieWhite.   #2961<ul> <li>Includes rules released before or during June 2024.</li> <li>Marked <code>Azure.GA_2024_03</code> and <code>Azure.Preview_2024_03</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Azure Database for MySQL:<ul> <li>Verify that Azure Database for MySQL servers have a customer-controlled maintenance window configured by @BenjaminEngeset.   #2916</li> <li>Verify that servers have zone-redundant high availability (HA) configured by @BenjaminEngeset.   #2914</li> </ul> </li> <li>Azure Database for PostgreSQL:<ul> <li>Verify that Azure Database for PostgreSQL servers have a customer-controlled maintenance window configured by @BenjaminEngeset.   #2927</li> <li>Verify that servers have zone-redundant high availability (HA) configured by @BenjaminEngeset.   #2932</li> </ul> </li> <li>Azure Firewall:<ul> <li>Verify that firewalls have availability zones configured by @BenjaminEngeset.   #2909</li> </ul> </li> <li>Azure Kubernetes Service:<ul> <li>Added check to automatically upgrade AKS cluster node image by @sharmilamusunuru.   #2445</li> </ul> </li> <li>Azure Virtual Desktop:<ul> <li>Added check for scheduled agent updates on host pools by @BernieWhite.   #2946</li> </ul> </li> <li>Cosmos DB:<ul> <li>Verify that Cosmos DB accounts have continuous backup configured by @BenjaminEngeset.   #2954</li> </ul> </li> <li>Virtual Network Gateway:<ul> <li>Verify that VPN/ExpressRoute gateways have a customer-controlled maintenance configuration configured by @BenjaminEngeset.   #2910</li> </ul> </li> <li>Virtual Machine Scale Sets:<ul> <li>Verify that virtual machine scale sets have best-effort zone balance configured by @BenjaminEngeset.   #2901</li> <li>Verify that virtual machine scale sets have availability zones configured by @BenjaminEngeset.   #2902</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use <code>1.28.9</code> as the minimum version by @BernieWhite.   #2930</li> </ul> </li> <li>Virtual Machine:<ul> <li>Updated <code>Azure.VM.MaintenanceConfig</code> to align to the reliability pillar by @BernieWhite.   #2925<ul> <li>Promoted to GA and bumped rule set to <code>2024_06</code>.</li> </ul> </li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Quality updates to rule documentation by @BernieWhite.   #2570</li> <li>Bump Pester to v5.6.0.   #2934</li> <li>Bump PSScriptAnalyzer to v1.22.0.   #2934</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed handling of multi-line descriptions for policy definition and assignment exports by @BernieWhite.   #2973</li> <li>Fixed support for <code>references</code> function by @BernieWhite.   #2922</li> <li>Fixed group by subscription casing when exporting in-flight resources by @BernieWhite.   #2957</li> <li>Fixed install Az.Resources warning by @BernieWhite.   #2887<ul> <li>Added new configuration option set by environment variable to suppress the warning.</li> <li>Set <code>PSRULE_AZURE_RESOURCE_MODULE_NOWARN</code> to <code>true</code> to suppress the warning.</li> </ul> </li> <li>Fixed <code>filter</code> on unknown runtime property by @BernieWhite.   #2966</li> <li>Fixed failed to expand with direct outputs reference by @BernieWhite.   #2935</li> <li>Fixed identification of <code>list*</code> function false positive with resource by @BernieWhite.   #2919</li> <li>Fixed documentation bugs for container apps by @BernieWhite.   #2876</li> </ul> </li> </ul> <p>What's changed since pre-release v1.38.0-B0068:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1380-b0106-pre-release","title":"v1.38.0-B0106 (pre-release)","text":"<p>What's changed since pre-release v1.38.0-B0068:</p> <ul> <li>New rules:<ul> <li>Cosmos DB:<ul> <li>Verify that Cosmos DB accounts have continuous backup configured by @BenjaminEngeset.   #2954</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Rollback Az.Resources to v6.7.0 by @BernieWhite.   #2970</li> <li>Fixed handling of multi-line descriptions for policy definition and assignment exports by @BernieWhite.   #2973</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1380-b0068-pre-release","title":"v1.38.0-B0068 (pre-release)","text":"<p>What's changed since pre-release v1.38.0-B0034:</p> <ul> <li>New features:<ul> <li>Added March 2024 baselines <code>Azure.GA_2024_06</code> and <code>Azure.Preview_2024_06</code> by @BernieWhite.   #2961<ul> <li>Includes rules released before or during June 2024.</li> <li>Marked <code>Azure.GA_2024_03</code> and <code>Azure.Preview_2024_03</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Quality updates to rule documentation by @BernieWhite.   #2570</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed support for <code>references</code> function by @BernieWhite.   #2922</li> <li>Fixed group by subscription casing when exporting in-flight resources by @BernieWhite.   #2957</li> <li>Fixed install Az.Resources warning by @BernieWhite.   #2887<ul> <li>Added new configuration option set by environment variable to suppress the warning.</li> <li>Set <code>PSRULE_AZURE_RESOURCE_MODULE_NOWARN</code> to <code>true</code> to suppress the warning.</li> </ul> </li> <li>Fixed <code>filter</code> on unknown runtime property by @BernieWhite.   #2966</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1380-b0034-pre-release","title":"v1.38.0-B0034 (pre-release)","text":"<p>What's changed since pre-release v1.38.0-B0011:</p> <ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Added check to automatically upgrade AKS cluster node image by @sharmilamusunuru.   #2445</li> </ul> </li> <li>Azure Virtual Desktop:<ul> <li>Added check for scheduled agent updates on host pools by @BernieWhite.   #2946</li> </ul> </li> <li>Virtual Machine Scale Sets:<ul> <li>Verify that virtual machine scale sets have best-effort zone balance configured by @BenjaminEngeset.   #2901</li> <li>Verify that virtual machine scale sets have availability zones configured by @BenjaminEngeset.   #2902</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Quality updates to rule documentation by @BernieWhite.   #2570</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed failed to expand with direct outputs reference by @BernieWhite.   #2935</li> <li>Fixed identification of <code>list*</code> function false positive with resource by @BernieWhite.   #2919</li> <li>Fixed documentation bugs for container apps by @BernieWhite.   #2876</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1380-b0011-pre-release","title":"v1.38.0-B0011 (pre-release)","text":"<p>What's changed since v1.37.0:</p> <ul> <li>New rules:<ul> <li>Azure Database for MySQL:<ul> <li>Verify that Azure Database for MySQL servers have a customer-controlled maintenance window configured by @BenjaminEngeset.   #2916</li> <li>Verify that servers have zone-redundant high availability (HA) configured by @BenjaminEngeset.   #2914</li> </ul> </li> <li>Azure Database for PostgreSQL:<ul> <li>Verify that Azure Database for PostgreSQL servers have a customer-controlled maintenance window configured by @BenjaminEngeset.   #2927</li> <li>Verify that servers have zone-redundant high availability (HA) configured by @BenjaminEngeset.   #2932</li> </ul> </li> <li>Azure Firewall:<ul> <li>Verify that firewalls have availability zones configured by @BenjaminEngeset.   #2909</li> </ul> </li> <li>Virtual Network Gateway:<ul> <li>Verify that VPN/ExpressRoute gateways have a customer-controlled maintenance configuration configured by @BenjaminEngeset.   #2910</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Virtual Machine:<ul> <li>Updated <code>Azure.VM.MaintenanceConfig</code> to align to the reliability pillar by @BernieWhite.   #2925<ul> <li>Promoted to GA and bumped rule set to <code>2024_06</code>.</li> </ul> </li> </ul> </li> <li>Updated <code>Azure.AKS.Version</code> to use <code>1.28.9</code> as the minimum version by @BernieWhite.   #2930</li> </ul> </li> <li>Engineering:<ul> <li>Bump Pester to v5.6.0.   #2934</li> <li>Bump Az.Resources to v7.1.0.   #2934</li> <li>Bump PSScriptAnalyzer to v1.22.0.   #2934</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1370","title":"v1.37.0","text":"<p>What's changed since v1.36.0:</p> <ul> <li>New features:<ul> <li>Added support for new Bicep language features introduced in v0.27.1 by @BernieWhite.   #2860 #2859<ul> <li>Added support for <code>shallowMerge</code>, <code>groupBy</code>, <code>objectKeys</code>, and <code>mapValues</code>.</li> <li>Updated syntax for Bicep lambda usage of <code>map</code>, <code>reduce</code>, and <code>filter</code> which now support indices.</li> <li>Added support for spread operator.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>App Service:<ul> <li>Check that applications uses supported Node.js runtime versions by @BenjaminEngeset.   #2879</li> </ul> </li> <li>Application Gateway:<ul> <li>Check that WAF v2 doesn't use legacy WAF configuration by @BenjaminEngeset.   #2877</li> </ul> </li> <li>Azure Cache for Redis:<ul> <li>Verify that cache instances have Entra ID authentication enabled by @BenjaminEngeset.   #2899</li> </ul> </li> <li>Azure Managed Grafana:<ul> <li>Check that Azure Managed Grafana workspaces uses Grafana version 10 by @BenjaminEngeset.   #2878</li> </ul> </li> <li>Cosmos DB:<ul> <li>Check that database accounts use a paid tier by @BernieWhite.   #2845</li> <li>Check that database accounts have local authentication disabled by @BenjaminEngeset.   #2846</li> <li>Check that database accounts have public network access disabled by @BenjaminEngeset.   #2702</li> </ul> </li> <li>Event Hub:<ul> <li>Check that access to the namespace endpoints is restricted to only allowed sources by @BenjaminEngeset.   #2701</li> </ul> </li> <li>Log Analytics:<ul> <li>Check that workspaces have workspace replication enabled by @BenjaminEngeset.   #2893</li> </ul> </li> <li>Virtual Machine Scale Sets:<ul> <li>Check that automatic instance repairs are enabled by @BenjaminEngeset.   #2895</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>API Management:<ul> <li>Important change: Updated <code>Azure.APIM.AvailabilityZone</code> to improve accuracy with non-premium SKUs by @BenjaminEngeset.   #2788<ul> <li>Removed the <code>If</code> Premium SKU.</li> <li>Added check for Premium SKU.</li> <li>Bumped rule set to <code>2024_06</code>.</li> </ul> </li> <li>Important change: Updated <code>Azure.APIM.MultiRegion</code> to improve accuracy with non-premium SKUs by @BenjaminEngeset.   #2787<ul> <li>Removed the <code>If</code> Premium SKU.</li> <li>Added check for Premium SKU.</li> <li>Bumped rule set to <code>2024_06</code>.</li> </ul> </li> </ul> </li> <li>Deployment:<ul> <li>Add additional exclusions for <code>Azure.Deployment.SecureParameter</code> by @BernieWhite.   #2857</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Quality updates to documentation by @BernieWhite.   #2570</li> <li>Updated resource providers and policy aliases.   #2880</li> <li>Added support for <code>split</code> and <code>concat</code> functions during policy export by @BernieWhite.   #2851</li> </ul> </li> <li>Engineering:<ul> <li>Bump xunit to v2.8.1.   #2892</li> <li>Bump xunit.runner.visualstudio to v2.8.1.   #2891</li> <li>Bump System.Management.Automation to 7.3.12.   #2868</li> <li>Bump Microsoft.NET.Test.Sdk to v17.10.0.   #2884</li> </ul> </li> <li>Bug fixed:<ul> <li>Fixed <code>union</code> does not perform deep merge or keep property order by @BernieWhite.   #2885</li> <li>Fixed dependency ordering for cross scope deployments by @BernieWhite.   #2850</li> </ul> </li> </ul> <p>What's changed since pre-release v1.37.0-B0071:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1370-b0071-pre-release","title":"v1.37.0-B0071 (pre-release)","text":"<p>What's changed since pre-release v1.37.0-B0034:</p> <ul> <li>New rules:<ul> <li>App Service:<ul> <li>Check that applications uses supported Node.js runtime versions by @BenjaminEngeset.   #2879</li> </ul> </li> <li>Azure Cache for Redis:<ul> <li>Verify that cache instances have Entra ID authentication enabled by @BenjaminEngeset.   #2899</li> </ul> </li> <li>Log Analytics:<ul> <li>Check that workspaces have workspace replication enabled by @BenjaminEngeset.   #2893</li> </ul> </li> <li>Virtual Machine Scale Sets:<ul> <li>Check that automatic instance repairs are enabled by @BenjaminEngeset.   #2895</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>API Management:<ul> <li>Important change: Updated <code>Azure.APIM.MultiRegion</code> to improve accuracy with non-premium SKUs by @BenjaminEngeset.   #2787<ul> <li>Removed the <code>If</code> Premium SKU.</li> <li>Added check for Premium SKU.</li> <li>Bumped rule set to <code>2024_06</code>.</li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for <code>split</code> and <code>concat</code> functions during policy export by @BernieWhite.   #2851</li> </ul> </li> <li>Engineering:<ul> <li>Bump xunit to v2.8.1.   #2892</li> <li>Bump xunit.runner.visualstudio to v2.8.1.   #2891</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1370-b0034-pre-release","title":"v1.37.0-B0034 (pre-release)","text":"<p>What's changed since pre-release v1.37.0-B0009:</p> <ul> <li>New features:<ul> <li>Added support for new Bicep language features introduced in v0.27.1 by @BernieWhite.   #2860 #2859<ul> <li>Added support for <code>shallowMerge</code>, <code>groupBy</code>, <code>objectKeys</code>, and <code>mapValues</code>.</li> <li>Updated syntax for Bicep lambda usage of <code>map</code>, <code>reduce</code>, and <code>filter</code> which now support indices.</li> <li>Added support for spread operator.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Application Gateway:<ul> <li>Check that WAF v2 doesn't use legacy WAF configuration by @BenjaminEngeset.   #2877</li> </ul> </li> <li>Azure Managed Grafana:<ul> <li>Check that Azure Managed Grafana workspaces uses Grafana version 10 by @BenjaminEngeset.   #2878</li> </ul> </li> <li>Cosmos DB:<ul> <li>Check that database accounts have local authentication disabled by @BenjaminEngeset.   #2846</li> <li>Check that database accounts have public network access disabled by @BenjaminEngeset.   #2702</li> </ul> </li> <li>Event Hub:<ul> <li>Check that access to the namespace endpoints is restricted to only allowed sources by @BenjaminEngeset.   #2701</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>API Management:<ul> <li>Important change: Updated <code>Azure.APIM.AvailabilityZone</code> to improve accuracy with non-premium SKUs by @BenjaminEngeset.   #2788<ul> <li>Removed the <code>If</code> Premium SKU.</li> <li>Added check for Premium SKU.</li> <li>Bumped rule set to <code>2024_06</code>.</li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Updated resource providers and policy aliases.   #2880</li> </ul> </li> <li>Engineering:<ul> <li>Bump xunit to v2.8.0.   #2870</li> <li>Bump xunit.runner.visualstudio to v2.8.0.   #2871</li> <li>Bump System.Management.Automation to 7.3.12.   #2868</li> <li>Bump Microsoft.NET.Test.Sdk to v17.10.0.   #2884</li> </ul> </li> <li>Bug fixed:<ul> <li>Fixed <code>union</code> does not perform deep merge or keep property order by @BernieWhite.   #2885</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1370-b0009-pre-release","title":"v1.37.0-B0009 (pre-release)","text":"<p>What's changed since v1.36.0:</p> <ul> <li>New rules:<ul> <li>Cosmos DB:<ul> <li>Check that database accounts use a paid tier by @BernieWhite.   #2845</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Deployment:<ul> <li>Add additional exclusions for <code>Azure.Deployment.SecureParameter</code> by @BernieWhite.   #2857</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Quality updates to documentation by @BernieWhite.   #2570</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed dependency ordering for cross scope deployments by @BernieWhite.   #2850</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1360","title":"v1.36.0","text":"<p>What's changed since v1.35.3:</p> <ul> <li>New rules:<ul> <li>Container App:<ul> <li>Check that Container Apps have a minimum number of replicas by @BernieWhite.   #2790</li> <li>Check that Container App environments are zone redundant by @BernieWhite.   #2791</li> </ul> </li> <li>Cosmos DB:<ul> <li>Check that database accounts only accept a minimum of TLS 1.2 by @BernieWhite.   #2809</li> </ul> </li> <li>Entra Domain Services:<ul> <li>Check that instances use a minimum version of NTLM by @BernieWhite.   #2837</li> <li>Check that instances use a minimum version of TLS by @BernieWhite.   #2837</li> <li>Check that instances do not use RC4 encryption by @BernieWhite.   #2837</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Important change: Deprecated rules with no clear WAF alignment by @BernieWhite.   #2493<ul> <li>The following rules are deprecated:<ul> <li><code>Azure.Template.UseParameters</code></li> <li><code>Azure.Template.UseVariables</code></li> <li><code>Azure.Template.DefineParameters</code></li> <li><code>Azure.Template.ValidSecretRef</code></li> </ul> </li> <li>These rules have been deprecated and will be removed in v2.</li> <li>See deprecations for more information.</li> </ul> </li> <li>Quality updates to documentation by @lukemurraynz @BernieWhite.   #2789 #2570</li> <li>Additional policies added to default ignore list by @BernieWhite.   #1731</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed not found warning when exporting firewall policy <code>signatureOverrides</code> by @BernieWhite.   #2806</li> <li>Fixed <code>Azure.Storage.UseReplication</code> to allow for zone-redundant replication by @sebassem.   #2827</li> <li>Fixed nested usage of <code>listKeys</code> mocks by @BernieWhite.   #2829</li> </ul> </li> </ul> <p>What's changed since pre-release v1.36.0-B0077:</p> <ul> <li>General improvements:<ul> <li>Quality updates to documentation by @BernieWhite.   #2570</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1360-b0077-pre-release","title":"v1.36.0-B0077 (pre-release)","text":"<p>What's changed since pre-release v1.36.0-B0046:</p> <ul> <li>New rules:<ul> <li>Entra Domain Services:<ul> <li>Check that instances use a minimum version of NTLM by @BernieWhite.   #2837</li> <li>Check that instances use a minimum version of TLS by @BernieWhite.   #2837</li> <li>Check that instances do not use RC4 encryption by @BernieWhite.   #2837</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Important change: Deprecated rules with no clear WAF alignment by @BernieWhite.   #2493<ul> <li>The following rules are deprecated:<ul> <li><code>Azure.Template.UseParameters</code></li> <li><code>Azure.Template.UseVariables</code></li> <li><code>Azure.Template.DefineParameters</code></li> <li><code>Azure.Template.ValidSecretRef</code></li> </ul> </li> <li>These rules have been deprecated and will be removed in v2.</li> <li>See deprecations for more information.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1360-b0046-pre-release","title":"v1.36.0-B0046 (pre-release)","text":"<p>What's changed since pre-release v1.36.0-B0020:</p> <ul> <li>Bug fixes:<ul> <li>Fixed <code>Azure.Storage.UseReplication</code> to allow for zone-redundant replication by @sebassem.   #2827</li> <li>Fixed nested usage of <code>listKeys</code> mocks by @BernieWhite.   #2829</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1360-b0020-pre-release","title":"v1.36.0-B0020 (pre-release)","text":"<p>What's changed since v1.35.3:</p> <ul> <li>New rules:<ul> <li>Container App:<ul> <li>Check that Container Apps have a minimum number of replicas by @BernieWhite.   #2790</li> <li>Check that Container App environments are zone redundant by @BernieWhite.   #2791</li> </ul> </li> <li>Cosmos DB:<ul> <li>Check that database accounts only accept a minimum of TLS 1.2 by @BernieWhite.   #2809</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Quality updates to documentation by @lukemurraynz @BernieWhite.   #2789 #2570</li> <li>Additional policies added to default ignore list by @BernieWhite.   #1731</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed not found warning when exporting firewall policy <code>signatureOverrides</code> by @BernieWhite.   #2806</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1353","title":"v1.35.3","text":"<p>What's changed since v1.35.2:</p> <ul> <li>Bug fixes:<ul> <li>Fixed false positive with load balancers that use a public IP by @BernieWhite.   #2814</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1352","title":"v1.35.2","text":"<p>What's changed since v1.35.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed regression when handing ambiguous mock array outputs by @BernieWhite.   #2801</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1351","title":"v1.35.1","text":"<p>What's changed since v1.35.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed null parameter overrides default value by @BernieWhite.   #2795</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1350","title":"v1.35.0","text":"<p>What's changed since v1.34.2:</p> <ul> <li>New features:<ul> <li>Added WAF pillar specific baselines by @BernieWhite.   #1633 #2752<ul> <li>Use pillar specific baselines to target a specific area of the Azure Well-Architected Framework.</li> <li>The following baselines have been added:<ul> <li><code>Azure.Pillar.CostOptimization</code></li> <li><code>Azure.Pillar.OperationalExcellence</code></li> <li><code>Azure.Pillar.PerformanceEfficiency</code></li> <li><code>Azure.Pillar.Reliability</code></li> <li><code>Azure.Pillar.Security</code></li> </ul> </li> </ul> </li> <li>Added March 2024 baselines <code>Azure.GA_2024_03</code> and <code>Azure.Preview_2024_03</code> by @BernieWhite.   #2781<ul> <li>Includes rules released before or during March 2024.</li> <li>Marked <code>Azure.GA_2023_12</code> and <code>Azure.Preview_2023_12</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Updated <code>Azure.AppService.NETVersion</code> to detect out of date .NET versions including .NET 5/6/7 by @BernieWhite.   #2766<ul> <li>Bumped rule set to <code>2024_03</code>.</li> </ul> </li> <li>Updated <code>Azure.AppService.PHPVersion</code> to detect out of date PHP versions before 8.2 by @BernieWhite.   #2768<ul> <li>Fixed <code>Azure.AppService.PHPVersion</code> check fails when phpVersion is null.</li> <li>Bumped rule set to <code>2024_03</code>.</li> </ul> </li> <li>Updated <code>Azure.AKS.Version</code> to use <code>1.27.9</code> as the minimum version by @BernieWhite.   #2771</li> </ul> </li> <li>General improvements:<ul> <li>Renamed Cognitive Services rules to Azure AI by @BernieWhite.   #2776<ul> <li>Rules that were previously named <code>Azure.Cognitive.*</code> have been renamed to <code>Azure.AI.*</code>.</li> <li>For each rule that has been renamed, an alias has been added to reference the old name.</li> </ul> </li> <li>Improved export of in-flight data for Event Grid and Azure Firewall Policies by @BernieWhite.   #2774</li> <li>Additional policies added to default ignore list by @BernieWhite.   #1731</li> <li>Quality updates to rule documentation by @BernieWhite.   #2570 #1243 #2757<ul> <li>Add rule severity to rule documentation pages.</li> <li>Add documentation redirects for renamed rules.</li> </ul> </li> <li>Updated links to learn.microsoft.com (from docs.microsoft.com) by @lukemurraynz.   #2785</li> </ul> </li> <li>Engineering:<ul> <li>Bump coverlet.collector to v6.0.2.   #2754</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed false negative from <code>Azure.LB.AvailabilityZone</code> when zone list is empty or null by @jtracey93.   #2759</li> <li>Fixed failed to expand JObject value with invalid key by @BernieWhite.   #2751</li> </ul> </li> </ul> <p>What's changed since pre-release v1.35.0-B0116:</p> <ul> <li>General improvements:<ul> <li>Updated links to learn.microsoft.com (from docs.microsoft.com) by @lukemurraynz.   #2785</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1350-b0116-pre-release","title":"v1.35.0-B0116 (pre-release)","text":"<p>What's changed since pre-release v1.35.0-B0084:</p> <ul> <li>New features:<ul> <li>Added March 2024 baselines <code>Azure.GA_2024_03</code> and <code>Azure.Preview_2024_03</code> by @BernieWhite.   #2781<ul> <li>Includes rules released before or during March 2024.</li> <li>Marked <code>Azure.GA_2023_12</code> and <code>Azure.Preview_2023_12</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Renamed Cognitive Services rules to Azure AI by @BernieWhite.   #2776<ul> <li>Rules that were previously named <code>Azure.Cognitive.*</code> have been renamed to <code>Azure.AI.*</code>.</li> <li>For each rule that has been renamed, an alias has been added to reference the old name.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1350-b0084-pre-release","title":"v1.35.0-B0084 (pre-release)","text":"<p>What's changed since pre-release v1.35.0-B0055:</p> <ul> <li>General improvements:<ul> <li>Improved export of in-flight data for Event Grid and Azure Firewall Policies by @BernieWhite.   #2774</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1350-b0055-pre-release","title":"v1.35.0-B0055 (pre-release)","text":"<p>What's changed since pre-release v1.35.0-B0030:</p> <ul> <li>Updated rules:<ul> <li>Updated <code>Azure.AppService.NETVersion</code> to detect out of date .NET versions including .NET 5/6/7 by @BernieWhite.   #2766<ul> <li>Bumped rule set to <code>2024_03</code>.</li> </ul> </li> <li>Updated <code>Azure.AppService.PHPVersion</code> to detect out of date PHP versions before 8.2 by @BernieWhite.   #2768<ul> <li>Fixed <code>Azure.AppService.PHPVersion</code> check fails when phpVersion is null.</li> <li>Bumped rule set to <code>2024_03</code>.</li> </ul> </li> <li>Updated <code>Azure.AKS.Version</code> to use <code>1.27.9</code> as the minimum version by @BernieWhite.   #2771</li> </ul> </li> <li>General improvements:<ul> <li>Quality updates to rule documentation by @BernieWhite.   #2570</li> <li>Additional policies added to default ignore list by @BernieWhite.   #1731</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed failed to expand JObject value with invalid key by @BernieWhite.   #2751</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1350-b0030-pre-release","title":"v1.35.0-B0030 (pre-release)","text":"<p>What's changed since pre-release v1.35.0-B0012:</p> <ul> <li>General improvements:<ul> <li>Add rule severity to rule documentation pages by @BernieWhite.   #1243</li> <li>Add documentation redirects for renamed rules by @BernieWhite.   #2757</li> </ul> </li> <li>Engineering:<ul> <li>Bump coverlet.collector to v6.0.2.   #2754</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed false negative from <code>Azure.LB.AvailabilityZone</code> when zone list is empty or null by @jtracey93.   #2759</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1350-b0012-pre-release","title":"v1.35.0-B0012 (pre-release)","text":"<p>What's changed since v1.34.2:</p> <ul> <li>New features:<ul> <li>Added WAF pillar specific baselines by @BernieWhite.   #1633 #2752<ul> <li>Use pillar specific baselines to target a specific area of the Azure Well-Architected Framework.</li> <li>The following baselines have been added:<ul> <li><code>Azure.Pillar.CostOptimization</code></li> <li><code>Azure.Pillar.OperationalExcellence</code></li> <li><code>Azure.Pillar.PerformanceEfficiency</code></li> <li><code>Azure.Pillar.Reliability</code></li> <li><code>Azure.Pillar.Security</code></li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Documentation improvements by @BernieWhite.   #2570</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1342","title":"v1.34.2","text":"<p>What's changed since v1.34.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed export of in-flight data for flexible PostgreSQL servers by @BernieWhite.   #2744</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1341","title":"v1.34.1","text":"<p>What's changed since v1.34.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed policy as rules export issues by @BernieWhite.   #2724 #2725 #2726 #2727</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1340","title":"v1.34.0","text":"<p>What's changed since v1.33.2:</p> <ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check that user mode pools have a minimum number of nodes by @BernieWhite.   #2683<ul> <li>Added configuration to support changing the minimum number of node and to exclude node pools.</li> <li>Set <code>AZURE_AKS_CLUSTER_USER_POOL_MINIMUM_NODES</code> to set the minimum number of user nodes.</li> <li>Set <code>AZURE_AKS_CLUSTER_USER_POOL_EXCLUDED_FROM_MINIMUM_NODES</code> to exclude a specific node pool by name.</li> </ul> </li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.MinNodeCount</code> the count nodes system node pools by @BernieWhite.   #2683<ul> <li>Improved guidance and examples specifically for system node pools.</li> <li>Added configuration to support changing the minimum number of node.</li> <li>Set <code>AZURE_AKS_CLUSTER_MINIMUM_SYSTEM_NODES</code> to set the minimum number of system nodes.</li> </ul> </li> </ul> </li> <li>Front Door:<ul> <li>Updated <code>Azure.FrontDoor.Logs</code> to cover premium and standard profiles instead of just classic by @BernieWhite.   #2704<ul> <li>Added a selector for premium and standard profiles <code>Azure.FrontDoor.IsStandardOrPremium</code>.</li> <li>Added a selector for classic profiles <code>Azure.FrontDoor.IsClassic</code>.</li> <li>Updated rule set to <code>2024_03</code>.</li> </ul> </li> </ul> </li> <li>Microsoft Defender for Cloud:<ul> <li>Renamed rules to align with recommended naming length by @BernieWhite.   #2718<ul> <li>Renamed <code>Azure.Defender.Storage.SensitiveData</code> to <code>Azure.Defender.Storage.DataScan</code>.</li> </ul> </li> <li>Promoted <code>Azure.Defender.Storage.MalwareScan</code> to GA rule set by @BernieWhite.   #2590</li> </ul> </li> <li>Storage Account:<ul> <li>Renamed rules to align with recommended naming length by @BernieWhite.   #2718<ul> <li>Renamed <code>Azure.Storage.DefenderCloud.MalwareScan</code> to <code>Azure.Storage.Defender.MalwareScan</code>.</li> <li>Renamed <code>Azure.Storage.DefenderCloud.SensitiveData</code> to <code>Azure.Storage.Defender.DataScan</code>.</li> </ul> </li> <li>Promoted <code>Azure.Storage.Defender.MalwareScan</code> to GA rule set by @BernieWhite.   #2590</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Moved <code>.bicepparam</code> file support to stable by @BernieWhite.   #2682<ul> <li>Bicep param files are now automatically expanded when found.</li> <li>To disable expansion, set the configuration option <code>AZURE_BICEP_PARAMS_FILE_EXPANSION</code> to <code>false</code>.</li> </ul> </li> <li>Added support for type/ variable/ and function imports from Bicep files by @BernieWhite.   #2537</li> <li>Added duplicate policies to default ignore list by @BernieWhite.   #1731</li> <li>Documentation and metadata improvements by @BernieWhite.   #1772 #2570</li> </ul> </li> <li>Engineering:<ul> <li>Updated resource providers and policy aliases.   #2717</li> <li>Improved debugging experience by providing symbols for .NET code by @BernieWhite.   #2712</li> <li>Bump Microsoft.NET.Test.Sdk to v17.9.0.   #2680</li> <li>Bump xunit to v2.7.0.   #2688</li> <li>Bump xunit.runner.visualstudio to v2.5.7.   #2689</li> <li>Bump coverlet.collector to v6.0.1.   #2699</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed missing zones property for public IP addresses by @BernieWhite.   #2698</li> <li>Fixes for policy as rules by @BernieWhite.   #181 #1323</li> </ul> </li> </ul> <p>What's changed since pre-release v1.34.0-B0077:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1340-b0077-pre-release","title":"v1.34.0-B0077 (pre-release)","text":"<p>What's changed since pre-release v1.34.0-B0047:</p> <ul> <li>Updated rules:<ul> <li>Microsoft Defender for Cloud:<ul> <li>Renamed rules to align with recommended naming length by @BernieWhite.   #2718<ul> <li>Renamed <code>Azure.Defender.Storage.SensitiveData</code> to <code>Azure.Defender.Storage.DataScan</code>.</li> </ul> </li> <li>Promoted <code>Azure.Defender.Storage.MalwareScan</code> to GA rule set by @BernieWhite.   #2590</li> </ul> </li> <li>Storage Account:<ul> <li>Renamed rules to align with recommended naming length by @BernieWhite.   #2718<ul> <li>Renamed <code>Azure.Storage.DefenderCloud.MalwareScan</code> to <code>Azure.Storage.Defender.MalwareScan</code>.</li> <li>Renamed <code>Azure.Storage.DefenderCloud.SensitiveData</code> to <code>Azure.Storage.Defender.DataScan</code>.</li> </ul> </li> <li>Promoted <code>Azure.Storage.Defender.MalwareScan</code> to GA rule set by @BernieWhite.   #2590</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added duplicate policies to default ignore list by @BernieWhite.   #1731</li> </ul> </li> <li>Engineering:<ul> <li>Updated resource providers and policy aliases.   #2717</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixes for policy as rules by @BernieWhite.   #181 #1323</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1340-b0047-pre-release","title":"v1.34.0-B0047 (pre-release)","text":"<p>What's changed since pre-release v1.34.0-B0022:</p> <ul> <li>General improvements:<ul> <li>Added support for type/ variable/ and function imports from Bicep files by @BernieWhite.   #2537</li> </ul> </li> <li>Engineering:<ul> <li>Improved debugging experience by providing symbols for .NET code by @BernieWhite.   #2712</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1340-b0022-pre-release","title":"v1.34.0-B0022 (pre-release)","text":"<p>What's changed since v1.33.2:</p> <ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check that user mode pools have a minimum number of nodes by @BernieWhite.   #2683<ul> <li>Added configuration to support changing the minimum number of node and to exclude node pools.</li> <li>Set <code>AZURE_AKS_CLUSTER_USER_POOL_MINIMUM_NODES</code> to set the minimum number of user nodes.</li> <li>Set <code>AZURE_AKS_CLUSTER_USER_POOL_EXCLUDED_FROM_MINIMUM_NODES</code> to exclude a specific node pool by name.</li> </ul> </li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.MinNodeCount</code> the count nodes system node pools by @BernieWhite.   #2683<ul> <li>Improved guidance and examples specifically for system node pools.</li> <li>Added configuration to support changing the minimum number of node.</li> <li>Set <code>AZURE_AKS_CLUSTER_MINIMUM_SYSTEM_NODES</code> to set the minimum number of system nodes.</li> </ul> </li> </ul> </li> <li>Front Door:<ul> <li>Updated <code>Azure.FrontDoor.Logs</code> to cover premium and standard profiles instead of just classic by @BernieWhite.   #2704<ul> <li>Added a selector for premium and standard profiles <code>Azure.FrontDoor.IsStandardOrPremium</code>.</li> <li>Added a selector for classic profiles <code>Azure.FrontDoor.IsClassic</code>.</li> <li>Updated rule set to <code>2024_03</code>.</li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Moved <code>.bicepparam</code> file support to stable by @BernieWhite.   #2682<ul> <li>Bicep param files are now automatically expanded when found.</li> <li>To disable expansion, set the configuration option <code>AZURE_BICEP_PARAMS_FILE_EXPANSION</code> to <code>false</code>.</li> </ul> </li> <li>Documentation and metadata improvements by @BernieWhite.   #1772 #2570</li> </ul> </li> <li>Engineering:<ul> <li>Bump Microsoft.NET.Test.Sdk to v17.9.0.   #2680</li> <li>Bump xunit to v2.7.0.   #2688</li> <li>Bump xunit.runner.visualstudio to v2.5.7.   #2689</li> <li>Bump coverlet.collector to v6.0.1.   #2699</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed missing zones property for public IP addresses by @BernieWhite.   #2698</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1332","title":"v1.33.2","text":"<p>What's changed since v1.33.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed false positive of <code>Azure.Resource.AllowedRegions</code> raised during assertion call by @BernieWhite.   #2687</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1331","title":"v1.33.1","text":"<p>What's changed since v1.33.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed <code>Azure.AKS.AuthorizedIPs</code> is not valid for a private cluster by @BernieWhite.   #2677</li> <li>Fixed generating rule for VM extensions from policy is incorrect by @BernieWhite.   #2608</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1330","title":"v1.33.0","text":"<p>What's changed since v1.32.1:</p> <ul> <li>New features:<ul> <li>Exporting policy as rules also generates a baseline by @BernieWhite.   #2482<ul> <li>A baseline is automatically generated that includes for all rules exported.   If a policy rule has been replaced by a built-in rule, the baseline will include the built-in rule instead.</li> <li>The baseline is named <code>&lt;Prefix&gt;.PolicyBaseline.All</code>. i.e. <code>Azure.PolicyBaseline.All</code> by default.</li> <li>For details see Policy as rules.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Databricks:<ul> <li>Check that Databricks workspaces use a non-trial SKU by @batemansogq.   #2646</li> <li>Check that Databricks workspaces require use of private endpoints by @batemansogq.   #2646</li> </ul> </li> <li>Dev Box:<ul> <li>Check that projects limit the number of Dev Boxes per user by @BernieWhite.   #2654</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Application Gateway:<ul> <li>Updated <code>Azure.AppGwWAF.RuleGroups</code> to use the rule sets by @BenjaminEngeset.   #2629<ul> <li>The latest Bot Manager rule set is now <code>1.0</code>.</li> <li>The latest OWASP rule set is now <code>3.2</code>.</li> </ul> </li> </ul> </li> <li>Cognitive Services:<ul> <li>Relaxed <code>Azure.Cognitive.ManagedIdentity</code> to configurations that require managed identities by @BernieWhite.   #2559</li> </ul> </li> <li>Virtual Machine:<ul> <li>Checks for Azure Hybrid Benefit <code>Azure.VM.UseHybridUseBenefit</code> are not enabled by default by @BernieWhite.   #2493<ul> <li>To enable, set the <code>AZURE_VM_USE_HYBRID_USE_BENEFIT</code> option to <code>true</code>.</li> </ul> </li> </ul> </li> <li>Virtual Network:<ul> <li>Added option for excluding subnets to <code>Azure.VNET.UseNSGs</code> by @BernieWhite.   #2572<ul> <li>To add a subnet exclusion, set the <code>AZURE_VNET_SUBNET_EXCLUDED_FROM_NSG</code> option.</li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Rules that are ignored during exporting policy as rules are now generate a verbose logs by @BernieWhite.   #2482<ul> <li>This is to improve transparency of why rules are not exported.</li> <li>To see details on why a rule is ignored, enable verbose logging with <code>-Verbose</code>.</li> </ul> </li> <li>Policies that duplicate built-in rules can now be exported by using the <code>-KeepDuplicates</code> parameter by @BernieWhite.   #2482<ul> <li>For details see Policy as rules.</li> </ul> </li> <li>Quality updates to rules and documentation by @BernieWhite.   #1772 #2570</li> </ul> </li> <li>Engineering:<ul> <li>Bump xunit to v2.6.6.   #2645</li> <li>Bump xunit.runner.visualstudio to v2.5.6.   #2619</li> <li>Bump BenchmarkDotNet to v0.13.12.   #2636</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.12.   #2636</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>dateTimeAdd</code> may fail with different localization by @BernieWhite.   #2631</li> <li>Fixed inconclusive result reported for <code>Azure.ACR.Usage</code> by @BernieWhite.   #2494</li> <li>Fixed export of Front Door resource data is incomplete by @BernieWhite.   #2668</li> <li>Fixed <code>Azure.Template.TemplateFile</code> to support with <code>languageVersion</code> 2.0 template properties by @MrRoundRobin.   #2660</li> <li>Fixed <code>Azure.VM.DiskSizeAlignment</code> does not handle smaller sizes and ultra disks by @BernieWhite.   #2656</li> </ul> </li> </ul> <p>What's changed since pre-release v1.33.0-B0169:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1330-b0169-pre-release","title":"v1.33.0-B0169 (pre-release)","text":"<p>What's changed since pre-release v1.33.0-B0126:</p> <ul> <li>New features:<ul> <li>Exporting policy as rules also generates a baseline by @BernieWhite.   #2482<ul> <li>A baseline is automatically generated that includes for all rules exported.   If a policy rule has been replaced by a built-in rule, the baseline will include the built-in rule instead.</li> <li>The baseline is named <code>&lt;Prefix&gt;.PolicyBaseline.All</code>. i.e. <code>Azure.PolicyBaseline.All</code> by default.</li> <li>For details see Policy as rules.</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Rules that are ignored during exporting policy as rules are now generate a verbose logs by @BernieWhite.   #2482<ul> <li>This is to improve transparency of why rules are not exported.</li> <li>To see details on why a rule is ignored, enable verbose logging with <code>-Verbose</code>.</li> </ul> </li> <li>Policies that duplicate built-in rules can now be exported by using the <code>-KeepDuplicates</code> parameter by @BernieWhite.   #2482<ul> <li>For details see Policy as rules.</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed inconclusive result reported for <code>Azure.ACR.Usage</code> by @BernieWhite.   #2494</li> <li>Fixed export of Front Door resource data is incomplete by @BernieWhite.   #2668</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1330-b0126-pre-release","title":"v1.33.0-B0126 (pre-release)","text":"<p>What's changed since pre-release v1.33.0-B0088:</p> <ul> <li>Bug fixes:<ul> <li>Fixed <code>Azure.Template.TemplateFile</code> to support with <code>languageVersion</code> 2.0 template properties by @MrRoundRobin.   #2660</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1330-b0088-pre-release","title":"v1.33.0-B0088 (pre-release)","text":"<p>What's changed since pre-release v1.33.0-B0053:</p> <ul> <li>New rules:<ul> <li>Dev Box:<ul> <li>Check that projects limit the number of Dev Boxes per user by @BernieWhite.   #2654</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Azure.VM.DiskSizeAlignment</code> does not handle smaller sizes and ultra disks by @BernieWhite.   #2656</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1330-b0053-pre-release","title":"v1.33.0-B0053 (pre-release)","text":"<p>What's changed since pre-release v1.33.0-B0023:</p> <ul> <li>New rules:<ul> <li>Databricks:<ul> <li>Check that Databricks workspaces use a non-trial SKU by @batemansogq.   #2646</li> <li>Check that Databricks workspaces require use of private endpoints by @batemansogq.   #2646</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump xunit to v2.6.6.   #2645</li> <li>Bump BenchmarkDotNet to v0.13.12.   #2636</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.12.   #2636</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1330-b0023-pre-release","title":"v1.33.0-B0023 (pre-release)","text":"<p>What's changed since v1.32.1:</p> <ul> <li>Updated rules:<ul> <li>Application Gateway:<ul> <li>Updated <code>Azure.AppGwWAF.RuleGroups</code> to use the rule sets by @BenjaminEngeset.   #2629<ul> <li>The latest Bot Manager rule set is now <code>1.0</code>.</li> <li>The latest OWASP rule set is now <code>3.2</code>.</li> </ul> </li> </ul> </li> <li>Cognitive Services:<ul> <li>Relaxed <code>Azure.Cognitive.ManagedIdentity</code> to configurations that require managed identities by @BernieWhite.   #2559</li> </ul> </li> <li>Virtual Machine:<ul> <li>Checks for Azure Hybrid Benefit <code>Azure.VM.UseHybridUseBenefit</code> are not enabled by default by @BernieWhite.   #2493<ul> <li>To enable, set the <code>AZURE_VM_USE_HYBRID_USE_BENEFIT</code> option to <code>true</code>.</li> </ul> </li> </ul> </li> <li>Virtual Network:<ul> <li>Added option for excluding subnets to <code>Azure.VNET.UseNSGs</code> by @BernieWhite.   #2572<ul> <li>To add a subnet exclusion, set the <code>AZURE_VNET_SUBNET_EXCLUDED_FROM_NSG</code> option.</li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Quality updates to rules and documentation by @BernieWhite.   #1772 #2570</li> </ul> </li> <li>Engineering:<ul> <li>Bump xunit to v2.6.4.   #2618</li> <li>Bump xunit.runner.visualstudio to v2.5.6.   #2619</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>dateTimeAdd</code> may fail with different localization by @BernieWhite.   #2631</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1321","title":"v1.32.1","text":"<p>What's changed since v1.32.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed quotes get incorrectly duplicated by @BernieWhite.   #2593</li> <li>Fixed failure to expand copy loop in a Azure Policy deployment by @BernieWhite.   #2605</li> <li>Fixed cast exception when expanding the union of an array and mock by @BernieWhite.   #2614</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1320","title":"v1.32.0","text":"<p>What's changed since v1.31.3:</p> <ul> <li>New features:<ul> <li>Added December 2023 baselines <code>Azure.GA_2023_12</code> and <code>Azure.Preview_2023_12</code> by @BernieWhite.   #2580<ul> <li>Includes rules released before or during December 2023.</li> <li>Marked <code>Azure.GA_2023_09</code> and <code>Azure.Preview_2023_09</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>App Configuration:<ul> <li>Promoted <code>Azure.AppConfig.GeoReplica</code> to GA rule set by @BernieWhite.   #2592</li> </ul> </li> <li>API Management:<ul> <li>Promoted <code>Azure.APIM.DefenderCloud</code> to GA rule set by @BernieWhite.   #2591</li> </ul> </li> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use latest stable version <code>1.27.7</code> by @BernieWhite.   #2581</li> </ul> </li> <li>Defender for Cloud:<ul> <li>Promoted <code>Azure.Defender.Api</code> to GA rule set by @BernieWhite.   #2591</li> </ul> </li> <li>Network Interface:<ul> <li>Renamed NIC rules to reflect current usage by @BernieWhite.   #2574<ul> <li>Rename <code>Azure.VM.NICAttached</code> to <code>Azure.NIC.Attached</code>.</li> <li>Rename <code>Azure.VM.NICName</code> to <code>Azure.NIC.Name</code>.</li> <li>Rename <code>Azure.VM.UniqueDns</code> to <code>Azure.NIC.UniqueDns</code>.</li> <li>Added aliases to reference the old names for suppression and exclusion.</li> </ul> </li> <li>Added support for private link services to <code>Azure.VM.NICAttached</code> by @BernieWhite.   #2563</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Improved reporting of null argument in length function by @BernieWhite.   #2597</li> <li>Quality updates to documentation by @BernieWhite.   #2557 #2570 #1772</li> </ul> </li> <li>Engineering:<ul> <li>Updated resource providers and policy aliases.   #2579</li> <li>Bump xunit to v2.6.2.   #2544</li> <li>Bump xunit.runner.visualstudio to v2.5.4.   #2567</li> <li>Bump Microsoft.SourceLink.GitHub to v8.0.0.   #2538</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows and BenchmarkDotNet to v0.13.11.   #2575</li> <li>Bump Microsoft.CodeAnalysis.NetAnalyzers to v8.0.0.   #2568</li> <li>Bump Microsoft.NET.Test.Sdk to v17.8.0.   #2527</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed additional false positives of <code>Azure.Deployment.SecureParameter</code> by @BernieWhite.   #2556</li> <li>Fixed expansion with sub-resource handling of deployments with duplicate resources by @BernieWhite.   #2564</li> <li>Fixed dependency ordered is incorrect by @BernieWhite.   #2578</li> </ul> </li> </ul> <p>What's changed since pre-release v1.32.0-B0099:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1320-b0099-pre-release","title":"v1.32.0-B0099 (pre-release)","text":"<p>What's changed since pre-release v1.32.0-B0053:</p> <ul> <li>New features:<ul> <li>Added December 2023 baselines <code>Azure.GA_2023_12</code> and <code>Azure.Preview_2023_12</code> by @BernieWhite.   #2580<ul> <li>Includes rules released before or during December 2023.</li> <li>Marked <code>Azure.GA_2023_09</code> and <code>Azure.Preview_2023_09</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>App Configuration:<ul> <li>Promoted <code>Azure.AppConfig.GeoReplica</code> to GA rule set by @BernieWhite.   #2592</li> </ul> </li> <li>API Management:<ul> <li>Promoted <code>Azure.APIM.DefenderCloud</code> to GA rule set by @BernieWhite.   #2591</li> </ul> </li> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use latest stable version <code>1.27.7</code> by @BernieWhite.   #2581</li> </ul> </li> <li>Defender for Cloud:<ul> <li>Promoted <code>Azure.Defender.Api</code> to GA rule set by @BernieWhite.   #2591</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Improved reporting of null argument in length function by @BernieWhite.   #2597</li> </ul> </li> <li>Engineering:<ul> <li>Updated resource providers and policy aliases.   #2579</li> <li>Bump Microsoft.SourceLink.GitHub to v8.0.0.   #2538</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows and BenchmarkDotNet to v0.13.11.   #2575</li> <li>Bump Microsoft.CodeAnalysis.NetAnalyzers to v8.0.0.   #2568</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1320-b0053-pre-release","title":"v1.32.0-B0053 (pre-release)","text":"<p>What's changed since pre-release v1.32.0-B0021:</p> <ul> <li>Updated rules:<ul> <li>Network Interface:<ul> <li>Renamed NIC rules to reflect current usage by @BernieWhite.   #2574<ul> <li>Rename <code>Azure.VM.NICAttached</code> to <code>Azure.NIC.Attached</code>.</li> <li>Rename <code>Azure.VM.NICName</code> to <code>Azure.NIC.Name</code>.</li> <li>Rename <code>Azure.VM.UniqueDns</code> to <code>Azure.NIC.UniqueDns</code>.</li> <li>Added aliases to reference the old names for suppression and exclusion.</li> </ul> </li> <li>Added support for private link services to <code>Azure.VM.NICAttached</code> by @BernieWhite.   #2563</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Quality updates to documentation by @BernieWhite.   #2570 #1772</li> </ul> </li> <li>Engineering:<ul> <li>Bump xunit.runner.visualstudio to v2.5.4.   #2567</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed dependency ordered is incorrect by @BernieWhite.   #2578</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1320-b0021-pre-release","title":"v1.32.0-B0021 (pre-release)","text":"<p>What's changed since v1.31.3:</p> <ul> <li>General improvements:<ul> <li>Quality updates to documentation by @BernieWhite.   #2557</li> </ul> </li> <li>Engineering:<ul> <li>Bump Microsoft.NET.Test.Sdk to v17.8.0.   #2527</li> <li>Bump xunit to v2.6.2.   #2544</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed additional false positives of <code>Azure.Deployment.SecureParameter</code> by @BernieWhite.   #2556</li> <li>Fixed expansion with sub-resource handling of deployments with duplicate resources by @BernieWhite.   #2564</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1313","title":"v1.31.3","text":"<p>What's changed since v1.31.2:</p> <ul> <li>Bug fixes:<ul> <li>Fixed incorrect scope generated for subscription aliases by @BernieWhite.   #2545</li> <li>Fixed null dereferenced properties in map lambda by @BernieWhite.   #2535</li> <li>Fixed handling of for array index symbols by @BernieWhite.   #2548</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1312","title":"v1.31.2","text":"<p>What's changed since v1.31.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed nullable parameters with JValue null by @BernieWhite.   #2535</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1311","title":"v1.31.1","text":"<p>What's changed since v1.31.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed additional non-sensitive parameter name patterns by <code>Azure.Deployment.SecureParameter</code> by @BernieWhite.   #2528<ul> <li>Added support for configuration of the rule by setting <code>AZURE_DEPLOYMENT_NONSENSITIVE_PARAMETER_NAMES</code>.</li> </ul> </li> <li>Fixed incorrect handling of expressions with contains with JValue string by @BernieWhite.   #2531</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1310","title":"v1.31.0","text":"<p>What's changed since v1.30.3:</p> <ul> <li>New rules:<ul> <li>Deployment:<ul> <li>Check parameters potentially containing secure values by @BernieWhite.   #1476</li> </ul> </li> <li>Machine Learning:<ul> <li>Check compute instances are configured for an idle shutdown by @batemansogq.   #2484</li> <li>Check workspace compute has local authentication disabled by @batemansogq.   #2484</li> <li>Check workspace compute is connected to a VNET by @batemansogq.   #2484</li> <li>Check public access to a workspace is disabled by @batemansogq.   #2484</li> <li>Check workspaces use a user-assigned identity by @batemansogq.   #2484</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump development tools to .NET 7.0 SDK by @BernieWhite.   #1870</li> <li>Bump BenchmarkDotNet to v0.13.10.   #2518</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.10.   #2508</li> <li>Bump xunit to v2.6.1.   #2514</li> <li>Bump xunit.runner.visualstudio to v2.5.3.   #2486</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed dependency ordering with symbolic name by @BernieWhite.   #2505</li> <li>Fixed nullable parameters for custom types by @BernieWhite.   #2489</li> <li>Fixed API Connection might be missing dynamic properties by @BernieWhite.   #2424</li> </ul> </li> </ul> <p>What's changed since pre-release v1.31.0-B0048:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1310-b0048-pre-release","title":"v1.31.0-B0048 (pre-release)","text":"<p>What's changed since pre-release v1.31.0-B0020:</p> <ul> <li>Engineering:<ul> <li>Bump BenchmarkDotNet to v0.13.10.   #2518</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.10.   #2508</li> <li>Bump xunit to v2.6.1.   #2514</li> <li>Bump xunit.runner.visualstudio to v2.5.3.   #2486</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed dependency ordering with symbolic name by @BernieWhite.   #2505</li> <li>Fixed nullable parameters for custom types by @BernieWhite.   #2489</li> <li>Fixed API Connection might be missing dynamic properties by @BernieWhite.   #2424</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1310-b0020-pre-release","title":"v1.31.0-B0020 (pre-release)","text":"<p>What's changed since v1.30.3:</p> <ul> <li>New rules:<ul> <li>Deployment:<ul> <li>Check parameters potentially containing secure values by @BernieWhite.   #1476</li> </ul> </li> <li>Machine Learning:<ul> <li>Check compute instances are configured for an idle shutdown by @batemansogq.   #2484</li> <li>Check workspace compute has local authentication disabled by @batemansogq.   #2484</li> <li>Check workspace compute is connected to a VNET by @batemansogq.   #2484</li> <li>Check public access to a workspace is disabled by @batemansogq.   #2484</li> <li>Check workspaces use a user-assigned identity by @batemansogq.   #2484</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump development tools to .NET 7.0 SDK by @BernieWhite.   #1870</li> <li>Bump BenchmarkDotNet to v0.13.9.   #2469</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.9.   #2470</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1303","title":"v1.30.3","text":"<p>What's changed since v1.30.2:</p> <ul> <li>Bug fixes:<ul> <li>Fixed nullable parameters for built-in types by @BernieWhite.   #2488</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1302","title":"v1.30.2","text":"<p>What's changed since v1.30.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed binding of results resourceId and resourceGroupName by @BernieWhite.   #2460</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1301","title":"v1.30.1","text":"<p>What's changed since v1.30.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed <code>Azure.Resource.AllowedRegions</code> which was failing when no allowed regions were configured by @BernieWhite.   #2461</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1300","title":"v1.30.0","text":"<p>What's changed since v1.29.0:</p> <ul> <li>New features:<ul> <li>Added September 2023 baselines <code>Azure.GA_2023_09</code> and <code>Azure.Preview_2023_09</code> by @BernieWhite.   #2451<ul> <li>Includes rules released before or during September 2023.</li> <li>Marked <code>Azure.GA_2023_06</code> and <code>Azure.Preview_2023_06</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Azure Database for MySQL:<ul> <li>Check that Azure AD-only authentication is configured for Azure Database for MySQL databases by @BenjaminEngeset.   #2227</li> </ul> </li> <li>Azure Firewall:<ul> <li>Check that Azure Firewall polices has configured threat intelligence-based filtering in <code>alert and deny</code> mode by @BenjaminEngeset.   #2354</li> </ul> </li> <li>Backup vault:<ul> <li>Check that immutability is configured for Backup vaults by @BenjaminEngeset.   #2387</li> </ul> </li> <li>Container App:<ul> <li>Check that Container Apps uses a supported API version by @BenjaminEngeset.   #2398</li> </ul> </li> <li>Container Registry:<ul> <li>Check that Container Registries restricts network access by @BenjaminEngeset.   #2423</li> <li>Check that Container Registries disables anonymous pull access by @BenjaminEngeset.   #2422</li> </ul> </li> <li>Front Door:<ul> <li>Check that managed identity for Azure Front Door instances are configured by @BenjaminEngeset.   #2378</li> </ul> </li> <li>Public IP address:<ul> <li>Check that Public IP addresses uses Standard SKU by @BenjaminEngeset.   #2376</li> </ul> </li> <li>Recovery Services vault:<ul> <li>Check that immutability is configured for Recovery Services vaults by @BenjaminEngeset.   #2386</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use latest stable version <code>1.26.6</code> by @BernieWhite.   #2404<ul> <li>Use <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> to configure the minimum version of the cluster.</li> </ul> </li> <li>Promoted <code>Azure.AKS.LocalAccounts</code> to GA rule set by @BernieWhite.   #2448</li> </ul> </li> <li>Container App:<ul> <li>Promoted <code>Azure.ContainerApp.DisableAffinity</code> to GA rule set by @BernieWhite.   #2455</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Important change: Replaced the <code>Azure_AllowedRegions</code> option with <code>AZURE_RESOURCE_ALLOWED_LOCATIONS</code> by @BernieWhite.   #941<ul> <li>For compatibility, if <code>Azure_AllowedRegions</code> is set it will be used instead of <code>AZURE_RESOURCE_ALLOWED_LOCATIONS</code>.</li> <li>If only <code>AZURE_RESOURCE_ALLOWED_LOCATIONS</code> is set, this value will be used.</li> <li>The default will be used neither options are configured.</li> <li>If <code>Azure_AllowedRegions</code> is set a warning will be generated until the configuration is removed.</li> <li>Support for <code>Azure_AllowedRegions</code> is deprecated and will be removed in v2.</li> <li>See upgrade notes for details.</li> </ul> </li> <li>Add source link for rule in docs by @BernieWhite.   #2115</li> </ul> </li> <li>Engineering:<ul> <li>Updated resource providers and policy aliases.   #2442</li> <li>Bump xunit to v2.5.1.   #2436</li> <li>Bump xunit.runner.visualstudio to v2.5.1.   #2435</li> <li>Bump Microsoft.NET.Test.Sdk to v17.7.2.   #2407</li> <li>Bump BenchmarkDotNet to v0.13.8.   #2425</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.8.   #2425</li> <li>Bump Microsoft.CodeAnalysis.NetAnalyzers to v7.0.4.   #2405</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed false positive with <code>Azure.Storage.SecureTransfer</code> on new API versions by @BernieWhite.   #2414</li> <li>Fixed false positive with <code>Azure.VNET.LocalDNS</code> for DNS server addresses out of local scope by @BernieWhite.   #2370<ul> <li>This bug fix introduces a configuration option to flag when DNS from an Identity subscription is used.</li> <li>Set <code>AZURE_VNET_DNS_WITH_IDENTITY</code> to <code>true</code> when using an Identity subscription for DNS.</li> </ul> </li> <li>Fixed non-resource group rule triggering for a resource group by @BernieWhite.   #2401</li> <li>Fixed lambda map in map variable by @BernieWhite.   #2410</li> <li>Fixed <code>Azure.AKS.Version</code> by excluding <code>node-image</code> channel by @BernieWhite.   #2446</li> </ul> </li> </ul> <p>What's changed since pre-release v1.30.0-B0127:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1300-b0127-pre-release","title":"v1.30.0-B0127 (pre-release)","text":"<p>What's changed since pre-release v1.30.0-B0080:</p> <ul> <li>New features:<ul> <li>Added September 2023 baselines <code>Azure.GA_2023_09</code> and <code>Azure.Preview_2023_09</code> by @BernieWhite.   #2451<ul> <li>Includes rules released before or during September 2023.</li> <li>Marked <code>Azure.GA_2023_06</code> and <code>Azure.Preview_2023_06</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Azure Container Registry:<ul> <li>Check that Container Registries restricts network access by @BenjaminEngeset.   #2423</li> <li>Check that Container Registries disables anonymous pull access by @BenjaminEngeset.   #2422</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use latest stable version <code>1.26.6</code> by @BernieWhite.   #2404<ul> <li>Use <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> to configure the minimum version of the cluster.</li> </ul> </li> <li>Promoted <code>Azure.AKS.LocalAccounts</code> to GA rule set by @BernieWhite.   #2448</li> </ul> </li> <li>Container App:<ul> <li>Promoted <code>Azure.ContainerApp.DisableAffinity</code> to GA rule set by @BernieWhite.   #2455</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Add source link for rule in docs by @BernieWhite.   #2115</li> </ul> </li> <li>Engineering:<ul> <li>Updated resource providers and policy aliases.   #2442</li> <li>Bump xunit to v2.5.1.   #2436</li> <li>Bump xunit.runner.visualstudio to v2.5.1.   #2435</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Azure.AKS.Version</code> by excluding <code>node-image</code> channel by @BernieWhite.   #2446</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1300-b0080-pre-release","title":"v1.30.0-B0080 (pre-release)","text":"<p>What's changed since pre-release v1.30.0-B0047:</p> <ul> <li>General improvements:<ul> <li>Important change: Replaced the <code>Azure_AllowedRegions</code> option with <code>AZURE_RESOURCE_ALLOWED_LOCATIONS</code> by @BernieWhite.   #941<ul> <li>For compatibility, if <code>Azure_AllowedRegions</code> is set it will be used instead of <code>AZURE_RESOURCE_ALLOWED_LOCATIONS</code>.</li> <li>If only <code>AZURE_RESOURCE_ALLOWED_LOCATIONS</code> is set, this value will be used.</li> <li>The default will be used neither options are configured.</li> <li>If <code>Azure_AllowedRegions</code> is set a warning will be generated until the configuration is removed.</li> <li>Support for <code>Azure_AllowedRegions</code> is deprecated and will be removed in v2.</li> <li>See upgrade notes for details.</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump Microsoft.NET.Test.Sdk to v17.7.2.   #2407</li> <li>Bump BenchmarkDotNet to v0.13.8.   #2425</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.8.   #2425</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed false positive with <code>Azure.Storage.SecureTransfer</code> on new API versions by @BernieWhite.   #2414</li> <li>Fixed false positive with <code>Azure.VNET.LocalDNS</code> for DNS server addresses out of local scope by @BernieWhite.   #2370<ul> <li>This bug fix introduces a configuration option to flag when DNS from an Identity subscription is used.</li> <li>Set <code>AZURE_VNET_DNS_WITH_IDENTITY</code> to <code>true</code> when using an Identity subscription for DNS.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1300-b0047-pre-release","title":"v1.30.0-B0047 (pre-release)","text":"<p>What's changed since pre-release v1.30.0-B0026:</p> <ul> <li>Engineering:<ul> <li>Bump Microsoft.CodeAnalysis.NetAnalyzers to v7.0.4.   #2405</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed lambda map in map variable by @BernieWhite.   #2410</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1300-b0026-pre-release","title":"v1.30.0-B0026 (pre-release)","text":"<p>What's changed since pre-release v1.30.0-B0011:</p> <ul> <li>New rules:<ul> <li>Container App:<ul> <li>Check that Container Apps uses a supported API version by @BenjaminEngeset.   #2398</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed non-resource group rule triggering for a resource group by @BernieWhite.   #2401</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1300-b0011-pre-release","title":"v1.30.0-B0011 (pre-release)","text":"<p>What's changed since v1.29.0:</p> <ul> <li>New rules:<ul> <li>Azure Database for MySQL:<ul> <li>Check that Azure AD-only authentication is configured for Azure Database for MySQL databases by @BenjaminEngeset.   #2227</li> </ul> </li> <li>Azure Firewall:<ul> <li>Check that Azure Firewall polices has configured threat intelligence-based filtering in <code>alert and deny</code> mode by @BenjaminEngeset.   #2354</li> </ul> </li> <li>Backup vault:<ul> <li>Check that immutability is configured for Backup vaults by @BenjaminEngeset.   #2387</li> </ul> </li> <li>Front Door:<ul> <li>Check that managed identity for Azure Front Door instances are configured by @BenjaminEngeset.   #2378</li> </ul> </li> <li>Public IP address:<ul> <li>Check that Public IP addresses uses Standard SKU by @BenjaminEngeset.   #2376</li> </ul> </li> <li>Recovery Services vault:<ul> <li>Check that immutability is configured for Recovery Services vaults by @BenjaminEngeset.   #2386</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump BenchmarkDotNet to v0.13.7.   #2385</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.7.   #2382</li> <li>Bump Microsoft.NET.Test.Sdk to v17.7.1.   #2393</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1290","title":"v1.29.0","text":"<p>What's changed since v1.28.2:</p> <ul> <li>New rules:<ul> <li>Databricks:<ul> <li>Check that workspaces use secure cluster connectivity by @BernieWhite.   #2334</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Use policy definition name when generating a rule from it by @BernieWhite.   #1959</li> <li>Added export in-flight data for Defender for Storage from Storage Accounts by @BernieWhite.   #2248</li> <li>Added export in-flight data for Defender for APIs from API Management by @BernieWhite.   #2247</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed policy expansion with unquoted field property by @BernieWhite.   #2352</li> <li>Fixed array contains with JArray by @BernieWhite.   #2368</li> <li>Fixed index out of bounds of array with first function on empty array by @BernieWhite.   #2372</li> </ul> </li> </ul> <p>What's changed since pre-release v1.29.0-B0062:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1290-b0062-pre-release","title":"v1.29.0-B0062 (pre-release)","text":"<p>What's changed since pre-release v1.29.0-B0036:</p> <ul> <li>Bug fixes:<ul> <li>Fixed array contains with JArray by @BernieWhite.   #2368</li> <li>Fixed index out of bounds of array with first function on empty array by @BernieWhite.   #2372</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1290-b0036-pre-release","title":"v1.29.0-B0036 (pre-release)","text":"<p>What's changed since pre-release v1.29.0-B0015:</p> <ul> <li>General improvements:<ul> <li>Added export in-flight data for Defender for Storage from Storage Accounts by @BernieWhite.   #2248</li> <li>Added export in-flight data for Defender for APIs from API Management by @BernieWhite.   #2247</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1290-b0015-pre-release","title":"v1.29.0-B0015 (pre-release)","text":"<p>What's changed since v1.28.2:</p> <ul> <li>New rules:<ul> <li>Databricks:<ul> <li>Check that workspaces use secure cluster connectivity by @BernieWhite.   #2334</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Use policy definition name when generating a rule from it by @BernieWhite.   #1959</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed policy expansion with unquoted field property by @BernieWhite.   #2352</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1282","title":"v1.28.2","text":"<p>What's changed since v1.28.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed policy rules with no effect conditions are evaluated incorrectly by @BernieWhite.   #2346</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1281","title":"v1.28.1","text":"<p>What's changed since v1.28.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed <code>parseCidr</code> with <code>/32</code> is not valid by @BernieWhite.   #2336</li> <li>Fixed mismatch of resource group type on policy as code rules by @BernieWhite.   #2338</li> <li>Fixed length cannot be less than zero when converting policy to rules by @BernieWhite.   #1802</li> <li>Fixed naming rules for MariaDB by @BernieWhite.   #2335<ul> <li>Updated <code>Azure.MariaDB.VNETRuleName</code> to allow for parent resources.</li> <li>Updated <code>Azure.MariaDB.FirewallRuleName</code> to allow for parent resources.</li> </ul> </li> <li>Fixed network watcher existence check by @BernieWhite.   #2342</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1280","title":"v1.28.0","text":"<p>What's changed since v1.27.3:</p> <ul> <li>New features:<ul> <li>Added June 2023 baselines <code>Azure.GA_2023_06</code> and <code>Azure.Preview_2023_06</code> by @BernieWhite.   #2310<ul> <li>Includes rules released before or during June 2023.</li> <li>Marked <code>Azure.GA_2023_03</code> and <code>Azure.Preview_2023_03</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Azure Database for MySQL:<ul> <li>Check that Azure AD authentication is configured for Azure Database for MySQL databases by @BenjaminEngeset.   #2226</li> </ul> </li> <li>Azure Database for PostgreSQL:<ul> <li>Check that Azure AD-only authentication is configured for Azure Database for PostgreSQL databases by @BenjaminEngeset.   #2250</li> <li>Check that Azure AD authentication is configured for Azure Database for PostgreSQL databases by @BenjaminEngeset.   #2249</li> </ul> </li> </ul> </li> <li>Removed rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Removed <code>Azure.AKS.PodIdentity</code> as pod identities has been replaced by workload identities by @BernieWhite.   #2273</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for safe dereference operator by @BernieWhite.   #2322<ul> <li>Added support for <code>tryGet</code> Bicep function.</li> </ul> </li> <li>Added support for Bicep CIDR functions by @BernieWhite.   #2279<ul> <li>Added support for <code>parseCidr</code>, <code>cidrSubnet</code>, and <code>cidrHost</code>.</li> </ul> </li> <li>Added support for <code>managementGroupResourceId</code> Bicep function by @BernieWhite.   #2294</li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule to v2.9.0.   #2293</li> <li>Updated resource providers and policy aliases.   #2261</li> <li>Bump Microsoft.CodeAnalysis.NetAnalyzers to v7.0.3.   #2281</li> <li>Bump Microsoft.NET.Test.Sdk to v17.6.3.   #2290</li> <li>Bump coverlet.collector to v6.0.0.   #2232</li> <li>Bump Az.Resources to v6.7.0.   #2274</li> <li>Bump xunit to v2.5.0.   #2306</li> <li>Bump xunit.runner.visualstudio to v2.5.0.   #2307</li> <li>Bump BenchmarkDotNet to v0.13.6.   #2317</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.6.   #2318</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed Redis firewall rules can not bind to start by @BernieWhite.   #2303</li> <li>Fixed null condition handling by @BernieWhite.   #2316</li> <li>Fixed reference expression in property name by @BernieWhite.   #2321</li> <li>Fixed handling of nested mock objects by @BernieWhite.   #2325</li> <li>Fixed late binding of <code>coalesce</code> function by @BernieWhite.   #2328</li> <li>Fixed handling of JArray outputs with runtime values by @BernieWhite.   #2159</li> </ul> </li> </ul> <p>What's changed since pre-release v1.28.0-B0213:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1280-b0213-pre-release","title":"v1.28.0-B0213 (pre-release)","text":"<p>What's changed since pre-release v1.28.0-B0159:</p> <ul> <li>General improvements:<ul> <li>Added support for safe dereference operator by @BernieWhite.   #2322<ul> <li>Added support for <code>tryGet</code> Bicep function.</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump BenchmarkDotNet to v0.13.6.   #2317</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.6.   #2318</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed null condition handling by @BernieWhite.   #2316</li> <li>Fixed reference expression in property name by @BernieWhite.   #2321</li> <li>Fixed handling of nested mock objects by @BernieWhite.   #2325</li> <li>Fixed late binding of <code>coalesce</code> function by @BernieWhite.   #2328</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1280-b0159-pre-release","title":"v1.28.0-B0159 (pre-release)","text":"<p>What's changed since pre-release v1.28.0-B0115:</p> <ul> <li>New features:<ul> <li>Added June 2023 baselines <code>Azure.GA_2023_06</code> and <code>Azure.Preview_2023_06</code> by @BernieWhite.   #2310<ul> <li>Includes rules released before or during June 2023.</li> <li>Marked <code>Azure.GA_2023_03</code> and <code>Azure.Preview_2023_03</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump xunit to v2.5.0.   #2306</li> <li>Bump xunit.runner.visualstudio to v2.5.0.   #2307</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed Redis firewall rules can not bind to start by @BernieWhite.   #2303</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1280-b0115-pre-release","title":"v1.28.0-B0115 (pre-release)","text":"<p>What's changed since pre-release v1.28.0-B0079:</p> <ul> <li>General improvements:<ul> <li>Added support for Bicep CIDR functions by @BernieWhite.   #2279<ul> <li>Added support for <code>parseCidr</code>, <code>cidrSubnet</code>, and <code>cidrHost</code>.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1280-b0079-pre-release","title":"v1.28.0-B0079 (pre-release)","text":"<p>What's changed since pre-release v1.28.0-B0045:</p> <ul> <li>General improvements:<ul> <li>Added support for <code>managementGroupResourceId</code> Bicep function by @BernieWhite.   #2294</li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule to v2.9.0.   #2293</li> <li>Bump Microsoft.CodeAnalysis.NetAnalyzers to v7.0.3.   #2281</li> <li>Bump Microsoft.NET.Test.Sdk to v17.6.3.   #2290</li> <li>Bump coverlet.collector to v6.0.0.   #2232</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed handling of JArray outputs with runtime values by @BernieWhite.   #2159</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1280-b0045-pre-release","title":"v1.28.0-B0045 (pre-release)","text":"<p>What's changed since pre-release v1.28.0-B0024:</p> <ul> <li>Removed rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Removed <code>Azure.AKS.PodIdentity</code> as pod identities has been replaced by workload identities by @BernieWhite.   #2273</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump Microsoft.NET.Test.Sdk to v17.6.2.   #2266</li> <li>Bump Az.Resources to v6.7.0.   #2274</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed false positive of <code>IsolatedV2</code> with <code>Azure.AppService.MinPlan</code> by @BernieWhite.   #2277</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1280-b0024-pre-release","title":"v1.28.0-B0024 (pre-release)","text":"<p>What's changed since pre-release v1.28.0-B0010:</p> <ul> <li>Bug fixes:<ul> <li>Fixed union function for merge of object properties by @BernieWhite.   #2264</li> <li>Fixed length function counting properties in object by @BernieWhite.   #2263</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1280-b0010-pre-release","title":"v1.28.0-B0010 (pre-release)","text":"<p>What's changed since v1.27.1:</p> <ul> <li>New rules:<ul> <li>Azure Database for MySQL:<ul> <li>Check that Azure AD authentication is configured for Azure Database for MySQL databases by @BenjaminEngeset.   #2226</li> </ul> </li> <li>Azure Database for PostgreSQL:<ul> <li>Check that Azure AD-only authentication is configured for Azure Database for PostgreSQL databases by @BenjaminEngeset.   #2250</li> <li>Check that Azure AD authentication is configured for Azure Database for PostgreSQL databases by @BenjaminEngeset.   #2249</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Updated resource providers and policy aliases.   #2261</li> <li>Bump Microsoft.NET.Test.Sdk to v17.6.1.   #2256</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1273","title":"v1.27.3","text":"<p>What's changed since v1.27.2:</p> <ul> <li>Bug fixes:<ul> <li>Fixed false positive of <code>IsolatedV2</code> with <code>Azure.AppService.MinPlan</code> by @BernieWhite.   #2277</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1272","title":"v1.27.2","text":"<p>What's changed since v1.27.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed union function for merge of object properties by @BernieWhite.   #2264</li> <li>Fixed length function counting properties in object by @BernieWhite.   #2263</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1271","title":"v1.27.1","text":"<p>What's changed since v1.27.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed depends on ordering fails to expand deployment by @BernieWhite.   #2255</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1270","title":"v1.27.0","text":"<p>What's changed since v1.26.1:</p> <ul> <li>New features:<ul> <li>Experimental: Added support for expanding deployments from <code>.bicepparam</code> files by @BernieWhite.   #2132<ul> <li>See Using Bicep source for details.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Application Gateway:<ul> <li>Check that Application Gateways uses a v2 SKU by @BenjaminEngeset.   #2185</li> </ul> </li> <li>API Management:<ul> <li>Check that APIs published in Azure API Management are on-boarded to Microsoft Defender for APIs by @BenjaminEngeset.   #2187</li> <li>Check that base element for any policy element in a section is configured by @BenjaminEngeset.   #2072</li> </ul> </li> <li>Arc-enabled Kubernetes cluster:<ul> <li>Check that Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters is configured by @BenjaminEngeset.   #2124</li> </ul> </li> <li>Arc-enabled server:<ul> <li>Check that a maintenance configuration for Arc-enabled servers is associated by @BenjaminEngeset.   #2122</li> </ul> </li> <li>Container App:<ul> <li>Check that container apps has disabled session affinity to prevent unbalanced distribution by @BenjaminEngeset.   #2188</li> <li>Check that container apps with IP ingress restrictions mode configured is set to allow for all rules defined by @BenjaminEngeset.   #2189</li> </ul> </li> <li>Cosmos DB:<ul> <li>Check that Cosmos DB accounts has enabled Microsoft Defender by @BenjaminEngeset.   #2203</li> </ul> </li> <li>Defender for Cloud:<ul> <li>Check that sensitive data threat detection in Microsoft Defender for Storage is enabled by @BenjaminEngeset.   #2207</li> <li>Check that Malware Scanning in Microsoft Defender for Storage is enabled by @BenjaminEngeset.   #2206</li> <li>Check that Microsoft Defender for APIs is enabled by @BenjaminEngeset.   #2186</li> <li>Check that Microsoft Defender for Azure Cosmos DB is enabled by @BenjaminEngeset.   #2204</li> <li>Check that Microsoft Defender for open-source relational databases is enabled by @BenjaminEngeset.   #1632</li> <li>Check that Microsoft Defender Cloud Security Posture Management is using <code>Standard</code> plan by @BenjaminEngeset.   #2151</li> </ul> </li> <li>Key Vault:<ul> <li>Check that key vaults uses Azure RBAC as the authorization system for the data plane by @BenjaminEngeset.   #1916</li> </ul> </li> <li>Storage Account:<ul> <li>Check that Microsoft Defender for Storage is enabled for storage accounts by @BenjaminEngeset.   #2225</li> <li>Check that sensitive data threat detection in Microsoft Defender for Storage is enabled for storage accounts by @BenjaminEngeset.   #2207</li> <li>Check that Malware Scanning in Microsoft Defender for Storage is enabled for storage accounts by @BenjaminEngeset.   #2206</li> </ul> </li> <li>Virtual Machine:<ul> <li>Check that a maintenance configuration for virtual machines is associated by @BenjaminEngeset.   #2121</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for Bicep symbolic names by @BernieWhite.   #2238</li> </ul> </li> <li>Updated rules:<ul> <li>API Management:<ul> <li>Updated <code>Azure.APIM.EncryptValues</code> to check all API Management named values are encrypted with Key Vault secrets @BenjaminEngeset.   #2146</li> </ul> </li> <li>Container App:<ul> <li>Promoted <code>Azure.ContainerApp.Insecure</code> to GA rule set by @BernieWhite.   #2174</li> </ul> </li> <li>Defender for Cloud:<ul> <li>Check that Microsoft Defender for Storage v2 is enabled by @BenjaminEngeset.   #2205</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump Microsoft.NET.Test.Sdk to v17.6.0.   #2216</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed ignoring Redis firewall rules when Redis is configured to allow private connectivity by @BenjaminEngeset.   #2171</li> <li>Fixed left-side <code>or</code> function evaluation by @BernieWhite.   #2220</li> <li>Fixed interdependent variable copy loop count by @BernieWhite.   #2221</li> <li>Fixed handling of database name in <code>Azure.MariaDB.Database</code> by @BernieWhite.   #2191</li> <li>Fixed typing error in <code>Azure.Defender.Api</code> documentation by @BenjaminEngeset.   #2209</li> <li>Fixed <code>Azure.AKS.UptimeSLA</code> with new pricing by @BenjaminEngeset.   #2065 #2202</li> <li>Fixed false positive on managed identity without space by @BernieWhite.   #2235</li> <li>Fixed reference for runtime subnet ID property by @BernieWhite.   #2159</li> </ul> </li> </ul> <p>What's changed since pre-release v1.27.0-B0186:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1270-b0186-pre-release","title":"v1.27.0-B0186 (pre-release)","text":"<p>What's changed since pre-release v1.27.0-B0136:</p> <ul> <li>New rules:<ul> <li>API Management:<ul> <li>Check that APIs published in Azure API Management are on-boarded to Microsoft Defender for APIs by @BenjaminEngeset.   #2187</li> </ul> </li> <li>Key Vault:<ul> <li>Check that key vaults uses Azure RBAC as the authorization system for the data plane by @BenjaminEngeset.   #1916</li> </ul> </li> <li>Storage Account:<ul> <li>Check that Microsoft Defender for Storage is enabled for storage accounts by @BenjaminEngeset.   #2225</li> <li>Check that sensitive data threat detection in Microsoft Defender for Storage is enabled for storage accounts by @BenjaminEngeset.   #2207</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1270-b0136-pre-release","title":"v1.27.0-B0136 (pre-release)","text":"<p>What's changed since pre-release v1.27.0-B0091:</p> <ul> <li>New rules:<ul> <li>Defender for Cloud:<ul> <li>Check that sensitive data threat detection in Microsoft Defender for Storage is enabled by @BenjaminEngeset.   #2207</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for Bicep symbolic names by @BernieWhite.   #2238</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed false positive on managed identity without space by @BernieWhite.   #2235</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1270-b0091-pre-release","title":"v1.27.0-B0091 (pre-release)","text":"<p>What's changed since pre-release v1.27.0-B0050:</p> <ul> <li>New features:<ul> <li>Experimental: Added support for expanding deployments from <code>.bicepparam</code> files by @BernieWhite.   #2132<ul> <li>See Using Bicep source for details.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Storage Account:<ul> <li>Check that Malware Scanning in Microsoft Defender for Storage is enabled for storage accounts by @BenjaminEngeset.</li> </ul> </li> <li>Defender for Cloud:<ul> <li>Check that Malware Scanning in Microsoft Defender for Storage is enabled by @BenjaminEngeset.   #2206</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed left-side <code>or</code> function evaluation by @BernieWhite.   #2220</li> <li>Fixed interdependent variable copy loop count by @BernieWhite.   #2221</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1270-b0050-pre-release","title":"v1.27.0-B0050 (pre-release)","text":"<p>What's changed since pre-release v1.27.0-B0015:</p> <ul> <li>New rules:<ul> <li>Application Gateway:<ul> <li>Check that Application Gateways uses a v2 SKU by @BenjaminEngeset.   #2185</li> </ul> </li> <li>Arc-enabled Kubernetes cluster:<ul> <li>Check that Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters is configured by @BenjaminEngeset.   #2124</li> </ul> </li> <li>Arc-enabled server:<ul> <li>Check that a maintenance configuration for Arc-enabled servers is associated by @BenjaminEngeset.   #2122</li> </ul> </li> <li>Container App:<ul> <li>Check that container apps has disabled session affinity to prevent unbalanced distribution by @BenjaminEngeset.   #2188</li> <li>Check that container apps with IP ingress restrictions mode configured is set to allow for all rules defined by @BenjaminEngeset.   #2189</li> </ul> </li> <li>Cosmos DB:<ul> <li>Check that Cosmos DB accounts has enabled Microsoft Defender by @BenjaminEngeset.   #2203</li> </ul> </li> <li>Defender for Cloud:<ul> <li>Check that Microsoft Defender for APIs is enabled by @BenjaminEngeset.   #2186</li> <li>Check that Microsoft Defender for Azure Cosmos DB is enabled by @BenjaminEngeset.   #2204</li> <li>Check that Microsoft Defender for open-source relational databases is enabled by @BenjaminEngeset.   #1632</li> </ul> </li> <li>Virtual Machine:<ul> <li>Check that a maintenance configuration for virtual machines is associated by @BenjaminEngeset.   #2121</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Defender for Cloud:<ul> <li>Check that Microsoft Defender for Storage v2 is enabled by @BenjaminEngeset.   #2205</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump Microsoft.NET.Test.Sdk to v17.6.0.   #2216</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed handling of database name in <code>Azure.MariaDB.Database</code> by @BernieWhite.   #2191</li> <li>Fixed typing error in <code>Azure.Defender.Api</code> documentation by @BenjaminEngeset.   #2209</li> <li>Fixed <code>Azure.AKS.UptimeSLA</code> with new pricing by @BenjaminEngeset.   #2065 #2202</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1270-b0015-pre-release","title":"v1.27.0-B0015 (pre-release)","text":"<p>What's changed since pre-release v1.27.0-B0003:</p> <ul> <li>New rules:<ul> <li>API Management:<ul> <li>Check that base element for any policy element in a section is configured by @BenjaminEngeset.   #2072</li> </ul> </li> <li>Defender for Cloud:<ul> <li>Check that Microsoft Defender Cloud Security Posture Management is using <code>Standard</code> plan by @BenjaminEngeset.   #2151</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Container App:<ul> <li>Promoted <code>Azure.ContainerApp.Insecure</code> to GA rule set by @BernieWhite.   #2174</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed ignoring Redis firewall rules when Redis is configured to allow private connectivity by @BenjaminEngeset.   #2171</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1270-b0003-pre-release","title":"v1.27.0-B0003 (pre-release)","text":"<p>What's changed since v1.26.1:</p> <ul> <li>Updated rules:<ul> <li>API Management:<ul> <li>Updated <code>Azure.APIM.EncryptValues</code> to check all API Management named values are encrypted with Key Vault secrets @BenjaminEngeset.   #2146</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed reference for runtime subnet ID property by @BernieWhite.   #2159</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1261","title":"v1.26.1","text":"<p>What's changed since v1.26.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed null union with first value being null by @BernieWhite.   #2075</li> <li>Fixed <code>Azure.Resource.UseTags</code> for additional resources that don't support tags by @BernieWhite.   #2129</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1260","title":"v1.26.0","text":"<p>What's changed since v1.25.0:</p> <ul> <li>New features:<ul> <li>Added March 2023 baselines <code>Azure.GA_2023_03</code> and <code>Azure.Preview_2023_03</code> by @BernieWhite.   #2138<ul> <li>Includes rules released before or during March 2023.</li> <li>Marked <code>Azure.GA_2022_12</code> and <code>Azure.Preview_2022_12</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>API Management:<ul> <li>Check that wildcard <code>*</code> for any configuration option in CORS policies settings is not in use by @BenjaminEngeset.   #2073</li> </ul> </li> <li>Azure Kubernetes Service:<ul> <li>Check that the Defender profile with Azure Kubernetes Service clusters are enabled by @BenjaminEngeset.   #2123</li> </ul> </li> <li>Container App:<ul> <li>Check that internal-only ingress for container apps are configured by @BenjaminEngeset.   #2098</li> <li>Check that Azure File volumes for container apps are configured by @BenjaminEngeset.   #2101</li> <li>Check that the names of container apps meets the naming requirements by @BenjaminEngeset.   #2094</li> <li>Check that managed identity for container apps are configured by @BenjaminEngeset.   #2096</li> <li>Check that public network access for container apps environments are disabled by @BenjaminEngeset.   #2098</li> </ul> </li> <li>Deployment:<ul> <li>Check that the names of nested deployments meets the naming requirements of deployments by @BenjaminEngeset.   #1915</li> </ul> </li> <li>IoT Hub:<ul> <li>Check IoT Hubs in supported regions only uses TLS 1.2 version by @BenjaminEngeset.   #1996</li> </ul> </li> <li>Service Bus:<ul> <li>Check namespaces audit diagnostic logs are enabled by @BenjaminEngeset.   #1862</li> </ul> </li> <li>SQL Database:<ul> <li>Check that Azure AD-only authentication is enabled by @BenjaminEngeset.   #2119</li> <li>Check that Azure AD authentication is configured for SQL Managed Instances by @BenjaminEngeset.   #2117</li> </ul> </li> <li>SQL Managed Instance:<ul> <li>Check that managed identity for SQL Managed Instances are configured by @BenjaminEngeset.   #2120</li> <li>Check that Azure AD-only authentication is enabled by @BenjaminEngeset.   #2118</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use latest stable version <code>1.25.6</code> by @BernieWhite.   #2136<ul> <li>Use <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> to configure the minimum version of the cluster.</li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added a selector for premium Service Bus namespaces by @BernieWhite.   #2091</li> <li>Improved export of in-flight deeply nested API Management policies by @BernieWhite.   #2153</li> </ul> </li> <li>Engineering:<ul> <li>Bump Microsoft.CodeAnalysis.NetAnalyzers to v7.0.1.   #2082</li> <li>Bump Newtonsoft.Json to v13.0.3.   #2080</li> <li>Updated resource providers and policy aliases.   #2144</li> <li>Bump PSRule to v2.8.1.   #2155</li> <li>Bump Az.Resources to v6.6.0.   #2155</li> <li>Bump Pester to v5.4.1.   #2155</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed dependency issue of deployments across resource group scopes by @BernieWhite.   #2111</li> <li>Fixed false positive with <code>Azure.Deployment.Name</code> by @BernieWhite.   #2109</li> <li>Fixed false positives for <code>Azure.AppService.AlwaysOn</code> with Functions and Workflows by @BernieWhite.   #943</li> </ul> </li> </ul> <p>What's changed since pre-release v1.26.0-B0078:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1260-b0078-pre-release","title":"v1.26.0-B0078 (pre-release)","text":"<p>What's changed since pre-release v1.26.0-B0040:</p> <ul> <li>General improvements:<ul> <li>Improved export of in-flight deeply nested API Management policies by @BernieWhite.   #2153</li> </ul> </li> <li>Engineering:<ul> <li>Updated resource providers and policy aliases.   #2144</li> <li>Bump PSRule to v2.8.1.   #2155</li> <li>Bump Az.Resources to v6.6.0.   #2155</li> <li>Bump Pester to v5.4.1.   #2155</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed false positives for <code>Azure.AppService.AlwaysOn</code> with Functions and Workflows by @BernieWhite.   #943</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1260-b0040-pre-release","title":"v1.26.0-B0040 (pre-release)","text":"<p>What's changed since pre-release v1.26.0-B0011:</p> <ul> <li>New features:<ul> <li>Added March 2023 baselines <code>Azure.GA_2023_03</code> and <code>Azure.Preview_2023_03</code> by @BernieWhite.   #2138<ul> <li>Includes rules released before or during March 2023.</li> <li>Marked <code>Azure.GA_2022_12</code> and <code>Azure.Preview_2022_12</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>API Management:<ul> <li>Check that wildcard <code>*</code> for any configuration option in CORS policies settings is not in use by @BenjaminEngeset.   #2073</li> </ul> </li> <li>Azure Kubernetes Service:<ul> <li>Check that the Defender profile with Azure Kubernetes Service clusters are enabled by @BenjaminEngeset.   #2123</li> </ul> </li> <li>Container App:<ul> <li>Check that internal-only ingress for container apps are configured by @BenjaminEngeset.   #2098</li> <li>Check that Azure File volumes for container apps are configured by @BenjaminEngeset.   #2101</li> </ul> </li> <li>SQL Database:<ul> <li>Check that Azure AD-only authentication is enabled by @BenjaminEngeset.   #2119</li> <li>Check that Azure AD authentication is configured for SQL Managed Instances by @BenjaminEngeset.   #2117</li> </ul> </li> <li>SQL Managed Instance:<ul> <li>Check that managed identity for SQL Managed Instances are configured by @BenjaminEngeset.   #2120</li> <li>Check that Azure AD-only authentication is enabled by @BenjaminEngeset.   #2118</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use latest stable version <code>1.25.6</code> by @BernieWhite.   #2136<ul> <li>Use <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> to configure the minimum version of the cluster.</li> </ul> </li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed dependency issue of deployments across resource group scopes by @BernieWhite.   #2111</li> <li>Fixed false positive with <code>Azure.Deployment.Name</code> by @BernieWhite.   #2109</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1260-b0011-pre-release","title":"v1.26.0-B0011 (pre-release)","text":"<p>What's changed since v1.25.0:</p> <ul> <li>New rules:<ul> <li>Container App:<ul> <li>Check that the names of container apps meets the naming requirements by @BenjaminEngeset.   #2094</li> <li>Check that managed identity for container apps are configured by @BenjaminEngeset.   #2096</li> <li>Check that public network access for container apps environments are disabled by @BenjaminEngeset.   #2098</li> </ul> </li> <li>Deployment:<ul> <li>Check that the names of nested deployments meets the naming requirements of deployments by @BenjaminEngeset.   #1915</li> </ul> </li> <li>IoT Hub:<ul> <li>Check IoT Hubs in supported regions only uses TLS 1.2 version by @BenjaminEngeset.   #1996</li> </ul> </li> <li>Service Bus:<ul> <li>Check namespaces audit diagnostic logs are enabled by @BenjaminEngeset.   #1862</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added a selector for premium Service Bus namespaces by @BernieWhite.   #2091</li> </ul> </li> <li>Engineering:<ul> <li>Bump Microsoft.CodeAnalysis.NetAnalyzers to v7.0.1.   #2082</li> <li>Bump Newtonsoft.Json to v13.0.3.   #2080</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1251","title":"v1.25.1","text":"<p>What's changed since v1.25.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed dependency issue of deployments across resource group scopes by @BernieWhite.   #2111</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1250","title":"v1.25.0","text":"<p>What's changed since v1.24.2:</p> <ul> <li>New features:<ul> <li>Experimental: Added <code>Azure.MCSB.v1</code> which include rules aligned to the Microsoft Cloud Security Benchmark by @BernieWhite.   #1634</li> </ul> </li> <li>New rules:<ul> <li>Defender for Cloud:<ul> <li>Check Microsoft Defender for Key Vault is enabled by @BernieWhite.   #1632</li> <li>Check Microsoft Defender for DNS is enabled by @BernieWhite.   #1632</li> <li>Check Microsoft Defender for ARM is enabled by @BernieWhite.   #1632</li> </ul> </li> <li>Event Hub:<ul> <li>Check Event Hub namespaces only uses TLS 1.2 version by @BenjaminEngeset.   #1995</li> </ul> </li> <li>Key Vault:<ul> <li>Check if firewall is set to deny by @zilberd.   #2067</li> </ul> </li> <li>Virtual Machine:<ul> <li>Virtual machines should be fully deallocated and not stopped by @dcrreynolds.   #88</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for Bicep <code>toObject</code> function by @BernieWhite.   #2014</li> <li>Added support for configuring a minimum version of Bicep by @BernieWhite.   #1935<ul> <li>Configure this option to increase the visibility of the version of the Bicep CLI used by PSRule for Azure.</li> <li>Set <code>AZURE_BICEP_CHECK_TOOL</code> to <code>true</code> to check the Bicep CLI.</li> <li>Set <code>AZURE_BICEP_MINIMUM_VERSION</code> to configure the minimum version.</li> <li>If the Bicep CLI is not installed or the version is less than the minimum version an error will be reported.</li> <li>By default, the minimum Bicep version defaults to <code>0.4.451</code>.</li> </ul> </li> <li>Added support for Bicep custom types by @BernieWhite.   #2026</li> </ul> </li> <li>Engineering:<ul> <li>Bump BenchmarkDotNet to v0.13.5.   #2052</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.5.   #2052</li> <li>Bump Microsoft.NET.Test.Sdk to v17.5.0.   #2055</li> <li>Bump Az.Resources to v6.5.2.   #2037</li> <li>Updated build to use GitHub Actions by @BernieWhite.   #1696</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed SQL transparent data Encryption (TDE) works properly on all resources including exported resources by @zilberd.   #2059</li> <li>Fixed cases of exit code 5 with path probing by @BernieWhite.   #1901</li> </ul> </li> </ul> <p>What's changed since pre-release v1.25.0-B0100:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1250-b0138-pre-release","title":"v1.25.0-B0138 (pre-release)","text":"<p>What's changed since pre-release v1.25.0-B0100:</p> <ul> <li>New rules:<ul> <li>Event Hub:<ul> <li>Check Event Hub namespaces only uses TLS 1.2 version by @BenjaminEngeset.   #1995</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1250-b0100-pre-release","title":"v1.25.0-B0100 (pre-release)","text":"<p>What's changed since pre-release v1.25.0-B0065:</p> <ul> <li>New rules:<ul> <li>Key Vault:<ul> <li>Check if firewall is set to deny by @zilberd.   #2067</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1250-b0065-pre-release","title":"v1.25.0-B0065 (pre-release)","text":"<p>What's changed since pre-release v1.25.0-B0035:</p> <ul> <li>General improvements:<ul> <li>Added support for Bicep <code>toObject</code> function by @BernieWhite.   #2014</li> </ul> </li> <li>Engineering:<ul> <li>Bump BenchmarkDotNet to v0.13.5.   #2052</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.5.   #2052</li> <li>Bump Microsoft.NET.Test.Sdk to v17.5.0.   #2055</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed SQL transparent data Encryption (TDE) works properly on all resources including exported resources by @zilberd.   #2059</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1250-b0035-pre-release","title":"v1.25.0-B0035 (pre-release)","text":"<p>What's changed since pre-release v1.25.0-B0013:</p> <ul> <li>New rules:<ul> <li>Defender for Cloud:<ul> <li>Check Microsoft Defender for Key Vault is enabled by @BernieWhite.   #1632</li> <li>Check Microsoft Defender for DNS is enabled by @BernieWhite.   #1632</li> <li>Check Microsoft Defender for ARM is enabled by @BernieWhite.   #1632</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for configuring a minimum version of Bicep by @BernieWhite.   #1935<ul> <li>Configure this option to increase the visibility of the version of the Bicep CLI used by PSRule for Azure.</li> <li>Set <code>AZURE_BICEP_CHECK_TOOL</code> to <code>true</code> to check the Bicep CLI.</li> <li>Set <code>AZURE_BICEP_MINIMUM_VERSION</code> to configure the minimum version.</li> <li>If the Bicep CLI is not installed or the version is less than the minimum version an error will be reported.</li> <li>By default, the minimum Bicep version defaults to <code>0.4.451</code>.</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump Az.Resources to v6.5.2.   #2037</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed cases of exit code 5 with path probing by @BernieWhite.   #1901</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1250-b0013-pre-release","title":"v1.25.0-B0013 (pre-release)","text":"<p>What's changed since v1.24.2:</p> <ul> <li>New features:<ul> <li>Experimental: Added <code>Azure.MCSB.v1</code> which include rules aligned to the Microsoft Cloud Security Benchmark by @BernieWhite.   #1634</li> </ul> </li> <li>New rules:<ul> <li>Virtual Machine:<ul> <li>Virtual machines should be fully deallocated and not stopped by @dcrreynolds.   #88</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for Bicep custom types by @BernieWhite.   #2026</li> </ul> </li> <li>Engineering:<ul> <li>Updated build to use GitHub Actions by @BernieWhite.   #1696</li> <li>Bump BenchmarkDotNet to v0.13.4.   #1992</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.4.   #1992</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1242","title":"v1.24.2","text":"<p>This is a republish of v1.24.1 to fix a release issue. What's changed since v1.24.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed Bicep expand object or null by @BernieWhite.   #2021</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1241","title":"v1.24.1","text":"<p>What's changed since v1.24.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed Bicep expand object or null by @BernieWhite.   #2021</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1240","title":"v1.24.0","text":"<p>What's changed since v1.23.0:</p> <ul> <li>General improvements:<ul> <li>Updated <code>Export-AzRuleData</code> to improve export performance by @BernieWhite.   #1341<ul> <li>Removed <code>Az.Resources</code> dependency.</li> <li>Added async threading for export concurrency.</li> <li>Improved performance by using automatic look up of API versions by using provider cache.</li> </ul> </li> <li>Added support for Bicep lambda functions by @BernieWhite.   #1536<ul> <li>Bicep <code>filter</code>, <code>map</code>, <code>reduce</code>, and <code>sort</code> are supported.</li> <li>Support for <code>flatten</code> was previously added in v1.23.0.</li> </ul> </li> <li>Added optimization for policy type conditions by @BernieWhite.   #1966</li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule to v2.7.0.   #1973</li> <li>Updated resource providers and policy aliases.   #1736</li> <li>Bump Az.Resources to v6.5.1.   #1973</li> <li>Bump Newtonsoft.Json to v13.0.2.   #1903</li> <li>Bump Pester to v5.4.0.   #1994</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Export-AzRuleData</code> may not export all data if throttled by @BernieWhite.   #1341</li> <li>Fixed failed to expand nested deployment with runtime shallow parameter by @BernieWhite.   #2004</li> <li>Fixed <code>apiVersion</code> comparison of <code>requestContext</code> by @BernieWhite.   #1654</li> <li>Fixed simple cases for field type expressions by @BernieWhite.   #1323</li> </ul> </li> </ul> <p>What's changed since pre-release v1.24.0-B0035:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1240-b0035-pre-release","title":"v1.24.0-B0035 (pre-release)","text":"<p>What's changed since pre-release v1.24.0-B0013:</p> <ul> <li>General improvements:<ul> <li>Added support for Bicep lambda functions by @BernieWhite.   #1536<ul> <li>Bicep <code>filter</code>, <code>map</code>, <code>reduce</code>, and <code>sort</code> are supported.</li> <li>Support for <code>flatten</code> was previously added in v1.23.0.</li> </ul> </li> <li>Added optimization for policy type conditions by @BernieWhite.   #1966</li> </ul> </li> <li>Engineering:<ul> <li>Updated resource providers and policy aliases.   #1736</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed failed to expand nested deployment with runtime shallow parameter by @BernieWhite.   #2004</li> <li>Fixed <code>apiVersion</code> comparison of <code>requestContext</code> by @BernieWhite.   #1654</li> <li>Fixed simple cases for field type expressions by @BernieWhite.   #1323</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1240-b0013-pre-release","title":"v1.24.0-B0013 (pre-release)","text":"<p>What's changed since v1.23.0:</p> <ul> <li>General improvements:<ul> <li>Updated <code>Export-AzRuleData</code> to improve export performance by @BernieWhite.   #1341<ul> <li>Removed <code>Az.Resources</code> dependency.</li> <li>Added async threading for export concurrency.</li> <li>Improved performance by using automatic look up of API versions by using provider cache.</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule to v2.7.0.   #1973</li> <li>Bump Az.Resources to v6.5.1.   #1973</li> <li>Bump Newtonsoft.Json to v13.0.2.   #1903</li> <li>Bump Pester to v5.4.0.   #1994</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Export-AzRuleData</code> may not export all data if throttled by @BernieWhite.   #1341</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1230","title":"v1.23.0","text":"<p>What's changed since v1.22.2:</p> <ul> <li>New features:<ul> <li>Added December 2022 baselines <code>Azure.GA_2022_12</code> and <code>Azure.Preview_2022_12</code> by @BernieWhite.   #1961<ul> <li>Includes rules released before or during December 2022.</li> <li>Marked <code>Azure.GA_2022_09</code> and <code>Azure.Preview_2022_09</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>API Management:<ul> <li>Check API management instances has multi-region deployment gateways enabled by @BenjaminEngeset.   #1910</li> </ul> </li> <li>Application Gateway:<ul> <li>Check Application Gateways names meet naming requirements by @BenjaminEngeset.   #1943</li> </ul> </li> <li>Azure Cache for Redis:<ul> <li>Check Azure Cache for Redis instances uses Redis 6 by @BenjaminEngeset.   #1077</li> </ul> </li> <li>Azure Database for MariaDB:<ul> <li>Check Azure Database for MariaDB servers limits the amount of firewall permitted IP addresses by @BenjaminEngeset.   #1856</li> <li>Check Azure Database for MariaDB servers limits the amount of firewall rules allowed by @BenjaminEngeset.   #1855</li> <li>Check Azure Database for MariaDB servers does not have Azure services bypassed on firewall by @BenjaminEngeset.   #1857</li> </ul> </li> <li>Bastion:<ul> <li>Check Bastion hosts names meet naming requirements by @BenjaminEngeset.   #1950</li> </ul> </li> <li>Recovery Services Vault:<ul> <li>Check Recovery Services vaults names meet naming requirements by @BenjaminEngeset.   #1953</li> </ul> </li> <li>Virtual Machine:<ul> <li>Check virtual machines has Azure Monitor Agent installed by @BenjaminEngeset.   #1868</li> </ul> </li> <li>Virtual Machine Scale Sets:<ul> <li>Check virtual machine scale sets has Azure Monitor Agent installed by @BenjaminEngeset.   #1867</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use latest stable version <code>1.25.4</code> by @BernieWhite.   #1960<ul> <li>Use <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> to configure the minimum version of the cluster.</li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Improves handling for policy definition modes by using support tags selector by @BernieWhite.   #1946</li> <li>Added support to export exemptions related to policy assignments by @BernieWhite.   #1888</li> <li>Added support for Bicep <code>flatten</code> function by @BernieWhite.   #1536</li> </ul> </li> <li>Engineering:<ul> <li>Bump Az.Resources to v6.5.0.   #1945</li> <li>Bump Microsoft.NET.Test.Sdk v17.4.1.   #1964</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed Azure.AKS.Version ignore clusters with auto-upgrade enabled by @BenjaminEngeset.   #1926</li> </ul> </li> </ul> <p>What's changed since pre-release v1.23.0-B0072:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1230-b0072-pre-release","title":"v1.23.0-B0072 (pre-release)","text":"<p>What's changed since pre-release v1.23.0-B0046:</p> <ul> <li>New features:<ul> <li>Added December 2022 baselines <code>Azure.GA_2022_12</code> and <code>Azure.Preview_2022_12</code> by @BernieWhite.   #1961<ul> <li>Includes rules released before or during December 2022.</li> <li>Marked <code>Azure.GA_2022_09</code> and <code>Azure.Preview_2022_09</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use latest stable version <code>1.25.4</code> by @BernieWhite.   #1960<ul> <li>Use <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> to configure the minimum version of the cluster.</li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Improves handling for policy definition modes by using support tags selector by @BernieWhite.   #1946</li> </ul> </li> <li>Engineering:<ul> <li>Bump Microsoft.NET.Test.Sdk v17.4.1.   #1964</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1230-b0046-pre-release","title":"v1.23.0-B0046 (pre-release)","text":"<p>What's changed since pre-release v1.23.0-B0025:</p> <ul> <li>New rules:<ul> <li>Bastion:<ul> <li>Check Bastion hosts names meet naming requirements by @BenjaminEngeset.   #1950</li> </ul> </li> <li>Recovery Services Vault:<ul> <li>Check Recovery Services vaults names meet naming requirements by @BenjaminEngeset.   #1953</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Azure.Deployment.SecureValue</code> with <code>reference</code> function expression by @BernieWhite.   #1882</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1230-b0025-pre-release","title":"v1.23.0-B0025 (pre-release)","text":"<p>What's changed since pre-release v1.23.0-B0009:</p> <ul> <li>New rules:<ul> <li>Application Gateway:<ul> <li>Check Application Gateways names meet naming requirements by @BenjaminEngeset.   #1943</li> </ul> </li> <li>Azure Cache for Redis:<ul> <li>Check Azure Cache for Redis instances uses Redis 6 by @BenjaminEngeset.   #1077</li> </ul> </li> <li>Virtual Machine Scale Sets:<ul> <li>Check virtual machine scale sets has Azure Monitor Agent installed by @BenjaminEngeset.   #1867</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support to export exemptions related to policy assignments by @BernieWhite.   #1888</li> <li>Added support for Bicep <code>flatten</code> function by @BernieWhite.   #1536</li> </ul> </li> <li>Engineering:<ul> <li>Bump Az.Resources to v6.5.0.   #1945</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1230-b0009-pre-release","title":"v1.23.0-B0009 (pre-release)","text":"<p>What's changed since v1.22.1:</p> <ul> <li>New rules:<ul> <li>API Management:<ul> <li>Check API management instances has multi-region deployment gateways enabled by @BenjaminEngeset.   #1910</li> </ul> </li> <li>Azure Database for MariaDB:<ul> <li>Check Azure Database for MariaDB servers limits the amount of firewall permitted IP addresses by @BenjaminEngeset.   #1856</li> <li>Check Azure Database for MariaDB servers limits the amount of firewall rules allowed by @BenjaminEngeset.   #1855</li> <li>Check Azure Database for MariaDB servers does not have Azure services bypassed on firewall by @BenjaminEngeset.   #1857</li> </ul> </li> <li>Virtual Machine:<ul> <li>Check virtual machines has Azure Monitor Agent installed by @BenjaminEngeset.   #1868</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed Azure.AKS.Version ignore clusters with auto-upgrade enabled by @BenjaminEngeset.   #1926</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1222","title":"v1.22.2","text":"<p>What's changed since v1.22.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed <code>Azure.Deployment.SecureValue</code> with <code>reference</code> function expression by @BernieWhite.   #1882</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1221","title":"v1.22.1","text":"<p>What's changed since v1.22.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed template parameter does not use the required format by @BernieWhite.   #1930</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1220","title":"v1.22.0","text":"<p>What's changed since v1.21.2:</p> <ul> <li>New rules:<ul> <li>API Management:<ul> <li>Check API management instances uses multi-region deployment by @BenjaminEngeset.   #1030</li> <li>Check api management instances limits control plane API calls to apim with version <code>'2021-08-01'</code> or newer by @BenjaminEngeset.   #1819</li> </ul> </li> <li>App Service Environment:<ul> <li>Check app service environments uses version 3 (ASEv3) instead of classic version 1 (ASEv1) and version 2 (ASEv2) by @BenjaminEngeset.   #1805</li> </ul> </li> <li>Azure Database for MariaDB:<ul> <li>Check Azure Database for MariaDB servers, databases, firewall rules and VNET rules names meet naming requirements by @BenjaminEngeset.   #1854</li> <li>Check Azure Database for MariaDB servers only uses TLS 1.2 version by @BenjaminEngeset.   #1853</li> <li>Check Azure Database for MariaDB servers only accept encrypted connections by @BenjaminEngeset.   #1852</li> <li>Check Azure Database for MariaDB servers have Microsoft Defender configured by @BenjaminEngeset.   #1850</li> <li>Check Azure Database for MariaDB servers have geo-redundant backup configured by @BenjaminEngeset.   #1848</li> </ul> </li> <li>Azure Database for PostgreSQL:<ul> <li>Check Azure Database for PostgreSQL servers have Microsoft Defender configured by @BenjaminEngeset.   #286</li> <li>Check Azure Database for PostgreSQL servers have geo-redundant backup configured by @BenjaminEngeset.   #285</li> </ul> </li> <li>Azure Database for MySQL:<ul> <li>Check Azure Database for MySQL servers have Microsoft Defender configured by @BenjaminEngeset.   #287</li> <li>Check Azure Database for MySQL servers uses the flexible deployment model by @BenjaminEngeset.   #1841</li> <li>Check Azure Database for MySQL Flexible Servers have geo-redundant backup configured by @BenjaminEngeset.   #1840</li> <li>Check Azure Database for MySQL servers have geo-redundant backup configured by @BenjaminEngeset.   #284</li> </ul> </li> <li>Azure Resource Deployments:<ul> <li>Check for nested deployment that are scoped to <code>outer</code> and passing secure values by @ms-sambell.   #1475</li> <li>Check custom script extension uses protected settings for secure values by @ms-sambell.   #1478</li> </ul> </li> <li>Front Door:<ul> <li>Check front door uses caching by @BenjaminEngeset.   #548</li> </ul> </li> <li>Virtual Machine:<ul> <li>Check virtual machines running SQL Server uses Premium disks or above by @BenjaminEngeset.   #9</li> </ul> </li> <li>Virtual Network:<ul> <li>Check VNETs with a GatewaySubnet also has an AzureFirewallSubnet by @BernieWhite.   #875</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added debug logging improvements for Bicep expansion by @BernieWhite.   #1901</li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule to v2.6.0.   #1883</li> <li>Bump Az.Resources to v6.4.1.   #1883</li> <li>Bump Microsoft.NET.Test.Sdk to v17.4.0   #1838</li> <li>Bump coverlet.collector to v3.2.0.   #1814</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed ref and name duplicated by @BernieWhite.   #1876</li> <li>Fixed an item with the same key for parameters by @BernieWhite #1871</li> <li>Fixed policy parse of <code>requestContext</code> function by @BernieWhite.   #1654</li> <li>Fixed handling of policy type field by @BernieWhite.   #1323</li> <li>Fixed <code>Azure.AppService.WebProbe</code> with non-boolean value set by @BernieWhite.   #1906</li> <li>Fixed managed identity flagged as secret by <code>Azure.Deployment.OutputSecretValue</code> by @BernieWhite.   #1826 #1886</li> <li>Fixed missing support for diagnostic settings category groups by @BenjaminEngeset.   #1873</li> </ul> </li> </ul> <p>What's changed since pre-release v1.22.0-B0203:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1220-b0203-pre-release","title":"v1.22.0-B0203 (pre-release)","text":"<p>What's changed since pre-release v1.22.0-B0153:</p> <ul> <li>General improvements:<ul> <li>Added debug logging improvements for Bicep expansion by @BernieWhite.   #1901</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Azure.AppService.WebProbe</code> with non-boolean value set by @BernieWhite.   #1906</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1220-b0153-pre-release","title":"v1.22.0-B0153 (pre-release)","text":"<p>What's changed since pre-release v1.22.0-B0106:</p> <ul> <li>Bug fixes:<ul> <li>Fixed managed identity flagged as secret by <code>Azure.Deployment.OutputSecretValue</code> by @BernieWhite.   #1826 #1886</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1220-b0106-pre-release","title":"v1.22.0-B0106 (pre-release)","text":"<p>What's changed since pre-release v1.22.0-B0062:</p> <ul> <li>New rules:<ul> <li>API Management:<ul> <li>Check API management instances uses multi-region deployment by @BenjaminEngeset.   #1030</li> </ul> </li> <li>Azure Database for MariaDB:<ul> <li>Check Azure Database for MariaDB servers, databases, firewall rules and VNET rules names meet naming requirements by @BenjaminEngeset.   #1854</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule to v2.6.0.   #1883</li> <li>Bump Az.Resources to v6.4.1.   #1883</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed ref and name duplicated by @BernieWhite.   #1876</li> <li>Fixed an item with the same key for parameters by @BernieWhite #1871</li> <li>Fixed policy parse of <code>requestContext</code> function by @BernieWhite.   #1654</li> <li>Fixed handling of policy type field by @BernieWhite.   #1323</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1220-b0062-pre-release","title":"v1.22.0-B0062 (pre-release)","text":"<p>What's changed since pre-release v1.22.0-B0026:</p> <ul> <li>New rules:<ul> <li>Azure Database for MariaDB:<ul> <li>Check Azure Database for MariaDB servers only uses TLS 1.2 version by @BenjaminEngeset.   #1853</li> <li>Check Azure Database for MariaDB servers only accept encrypted connections by @BenjaminEngeset.   #1852</li> <li>Check Azure Database for MariaDB servers have Microsoft Defender configured by @BenjaminEngeset.   #1850</li> <li>Check Azure Database for MariaDB servers have geo-redundant backup configured by @BenjaminEngeset.   #1848</li> </ul> </li> <li>Azure Database for PostgreSQL:<ul> <li>Check Azure Database for PostgreSQL servers have Microsoft Defender configured by @BenjaminEngeset.   #286</li> <li>Check Azure Database for PostgreSQL servers have geo-redundant backup configured by @BenjaminEngeset.   #285</li> </ul> </li> <li>Azure Database for MySQL:<ul> <li>Check Azure Database for MySQL servers have Microsoft Defender configured by @BenjaminEngeset.   #287</li> <li>Check Azure Database for MySQL servers uses the flexible deployment model by @BenjaminEngeset.   #1841</li> <li>Check Azure Database for MySQL Flexible Servers have geo-redundant backup configured by @BenjaminEngeset.   #1840</li> <li>Check Azure Database for MySQL servers have geo-redundant backup configured by @BenjaminEngeset.   #284</li> </ul> </li> <li>Azure Resource Deployments:<ul> <li>Check for nested deployment that are scoped to <code>outer</code> and passing secure values by @ms-sambell.   #1475</li> <li>Check custom script extension uses protected settings for secure values by @ms-sambell.   #1478</li> </ul> </li> <li>Virtual Machine:<ul> <li>Check virtual machines running SQL Server uses Premium disks or above by @BenjaminEngeset.   #9</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump Microsoft.NET.Test.Sdk to v17.4.0   #1838</li> <li>Bump coverlet.collector to v3.2.0.   #1814</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed missing support for diagnostic settings category groups by @BenjaminEngeset.   #1873</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1220-b0026-pre-release","title":"v1.22.0-B0026 (pre-release)","text":"<p>What's changed since pre-release v1.22.0-B0011:</p> <ul> <li>New rules:<ul> <li>API Management:<ul> <li>Check api management instances limits control plane API calls to apim with version <code>'2021-08-01'</code> or newer by @BenjaminEngeset.   #1819</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump Az.Resources to v6.4.0.   #1829</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed non-Linux VM images flagged as Linux by @BernieWhite.   #1825</li> <li>Fixed failed to expand with last function on runtime property by @BernieWhite.   #1830</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1220-b0011-pre-release","title":"v1.22.0-B0011 (pre-release)","text":"<p>What's changed since v1.21.0:</p> <ul> <li>New rules:<ul> <li>App Service Environment:<ul> <li>Check app service environments uses version 3 (ASEv3) instead of classic version 1 (ASEv1) and version 2 (ASEv2) by @BenjaminEngeset.   #1805</li> </ul> </li> <li>Front Door:<ul> <li>Check front door uses caching by @BenjaminEngeset.   #548</li> </ul> </li> <li>Virtual Network:<ul> <li>Check VNETs with a GatewaySubnet also has an AzureFirewallSubnet by @BernieWhite.   #875</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1212","title":"v1.21.2","text":"<p>What's changed since v1.21.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed non-Linux VM images flagged as Linux by @BernieWhite.   #1825</li> <li>Fixed failed to expand with last function on runtime property by @BernieWhite.   #1830</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1211","title":"v1.21.1","text":"<p>What's changed since v1.21.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed multiple nested parameter loops returns stack empty exception by @BernieWhite.   #1811</li> <li>Fixed <code>Azure.ACR.ContentTrust</code> when customer managed keys are enabled by @BernieWhite.   #1810</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1210","title":"v1.21.0","text":"<p>What's changed since v1.20.2:</p> <ul> <li>New features:<ul> <li>Mapping of Azure Security Benchmark v3 to security rules by @jagoodwin.   #1610</li> </ul> </li> <li>New rules:<ul> <li>Deployment:<ul> <li>Check sensitive resource values use secure parameters by @VeraBE @BernieWhite.   #1773</li> </ul> </li> <li>Service Bus:<ul> <li>Check service bus namespaces uses TLS 1.2 version by @BenjaminEngeset.   #1777</li> </ul> </li> <li>Virtual Machine:<ul> <li>Check virtual machines uses Azure Monitor Agent instead of old legacy Log Analytics Agent by @BenjaminEngeset.   #1792</li> </ul> </li> <li>Virtual Machine Scale Sets:<ul> <li>Check virtual machine scale sets uses Azure Monitor Agent instead of old legacy Log Analytics Agent by @BenjaminEngeset.   #1792</li> </ul> </li> <li>Virtual Network:<ul> <li>Check VNETs with a GatewaySubnet also has a AzureBastionSubnet by @BenjaminEngeset.   #1761</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added built-in list of ignored policy definitions by @BernieWhite.   #1730<ul> <li>To ignore additional policy definitions, use the <code>AZURE_POLICY_IGNORE_LIST</code> configuration option.</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule to v2.5.3.   #1800</li> <li>Bump Az.Resources to v6.3.1.   #1800</li> </ul> </li> </ul> <p>What's changed since pre-release v1.21.0-B0050:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1210-b0050-pre-release","title":"v1.21.0-B0050 (pre-release)","text":"<p>What's changed since pre-release v1.21.0-B0027:</p> <ul> <li>New rules:<ul> <li>Virtual Machine:<ul> <li>Check virtual machines uses Azure Monitor Agent instead of old legacy Log Analytics Agent by @BenjaminEngeset.   #1792</li> </ul> </li> <li>Virtual Machine Scale Sets:<ul> <li>Check virtual machine scale sets uses Azure Monitor Agent instead of old legacy Log Analytics Agent by @BenjaminEngeset.   #1792</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule to v2.5.3.   #1800</li> <li>Bump Az.Resources to v6.3.1.   #1800</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed contains function unable to match array by @BernieWhite.   #1793</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1210-b0027-pre-release","title":"v1.21.0-B0027 (pre-release)","text":"<p>What's changed since pre-release v1.21.0-B0011:</p> <ul> <li>New rules:<ul> <li>Deployment:<ul> <li>Check sensitive resource values use secure parameters by @VeraBE @BernieWhite.   #1773</li> </ul> </li> <li>Service Bus:<ul> <li>Check service bus namespaces uses TLS 1.2 version by @BenjaminEngeset.   #1777</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1210-b0011-pre-release","title":"v1.21.0-B0011 (pre-release)","text":"<p>What's changed since v1.20.1:</p> <ul> <li>New features:<ul> <li>Mapping of Azure Security Benchmark v3 to security rules by @jagoodwin.   #1610</li> </ul> </li> <li>New rules:<ul> <li>Virtual Network:<ul> <li>Check VNETs with a GatewaySubnet also has a AzureBastionSubnet by @BenjaminEngeset.   #1761</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added built-in list of ignored policy definitions by @BernieWhite.   #1730<ul> <li>To ignore additional policy definitions, use the <code>AZURE_POLICY_IGNORE_LIST</code> configuration option.</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule to v2.5.1.   #1782</li> <li>Bump Az.Resources to v6.3.0.   #1782</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1202","title":"v1.20.2","text":"<p>What's changed since v1.20.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed contains function unable to match array by @BernieWhite.   #1793</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1201","title":"v1.20.1","text":"<p>What's changed since v1.20.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed expand bicep source when reading JsonContent into a parameter by @BernieWhite.   #1780</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1200","title":"v1.20.0","text":"<p>What's changed since v1.19.2:</p> <ul> <li>New features:<ul> <li>Added September 2022 baselines <code>Azure.GA_2022_09</code> and <code>Azure.Preview_2022_09</code> by @BernieWhite.   #1738<ul> <li>Includes rules released before or during September 2022.</li> <li>Marked <code>Azure.GA_2022_06</code> and <code>Azure.Preview_2022_06</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>AKS:<ul> <li>Check clusters use Ephemeral OS disk by @BenjaminEngeset.   #1618</li> </ul> </li> <li>App Configuration:<ul> <li>Check app configuration store has purge protection enabled by @BenjaminEngeset.   #1689</li> <li>Check app configuration store has one or more replicas by @BenjaminEngeset.   #1688</li> <li>Check app configuration store audit diagnostic logs are enabled by @BenjaminEngeset.   #1690</li> <li>Check identity-based authentication is used for configuration stores by @pazdedav.   #1691</li> </ul> </li> <li>Application Gateway WAF:<ul> <li>Check policy is enabled by @fbinotto.   #1470</li> <li>Check policy uses prevention mode by @fbinotto.   #1470</li> <li>Check policy uses managed rule sets by @fbinotto.   #1470</li> <li>Check policy does not have any exclusions defined by @fbinotto.   #1470</li> </ul> </li> <li>Azure Cache for Redis:<ul> <li>Check the number of firewall rules for caches by @jonathanruiz.   #544</li> <li>Check the number of IP addresses in firewall rules for caches by @jonathanruiz.   #544</li> </ul> </li> <li>CDN:<ul> <li>Check CDN profile uses Front Door Standard or Premium tier by @BenjaminEngeset.   #1612</li> </ul> </li> <li>Container Registry:<ul> <li>Check soft delete policy is enabled by @BenjaminEngeset.   #1674</li> </ul> </li> <li>Defender for Cloud:<ul> <li>Check Microsoft Defender for Containers is enable by @jdewisscher.   #1632</li> <li>Check Microsoft Defender for Servers is enabled by @jdewisscher.   #1632</li> <li>Check Microsoft Defender for SQL is enabled by @jdewisscher.   #1632</li> <li>Check Microsoft Defender for App Services is enabled by @jdewisscher.   #1632</li> <li>Check Microsoft Defender for Storage is enabled by @jdewisscher.   #1632</li> <li>Check Microsoft Defender for SQL Servers on VMs is enabled by @jdewisscher.   #1632</li> </ul> </li> <li>Deployment:<ul> <li>Check that nested deployments securely pass through administrator usernames by @ms-sambell.   #1479</li> </ul> </li> <li>Front Door WAF:<ul> <li>Check policy is enabled by @fbinotto.   #1470</li> <li>Check policy uses prevention mode by @fbinotto.   #1470</li> <li>Check policy uses managed rule sets by @fbinotto.   #1470</li> <li>Check policy does not have any exclusions defined by @fbinotto.   #1470</li> </ul> </li> <li>Network Security Group:<ul> <li>Check AKS managed NSGs don't contain custom rules by @ms-sambell.   #8</li> </ul> </li> <li>Storage Account:<ul> <li>Check blob container soft delete is enabled by @pazdedav.   #1671</li> <li>Check file share soft delete is enabled by @jonathanruiz.   #966</li> </ul> </li> <li>VMSS:<ul> <li>Check Linux VMSS has disabled password authentication by @BenjaminEngeset.   #1635</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Important change: Updated rules, tests and docs with Microsoft Defender for Cloud by @jonathanruiz.   #545<ul> <li>The following rules have been renamed with aliases:<ul> <li>Renamed <code>Azure.SQL.ThreatDetection</code> to <code>Azure.SQL.DefenderCloud</code>.</li> <li>Renamed <code>Azure.SecurityCenter.Contact</code> to <code>Azure.DefenderCloud.Contact</code>.</li> <li>Renamed <code>Azure.SecurityCenter.Provisioning</code> to <code>Azure.DefenderCloud.Provisioning</code>.</li> </ul> </li> <li>If you are referencing the old names please consider updating to the new names.</li> </ul> </li> <li>Updated documentation examples for Front Door and Key Vault rules by @lluppesms.   #1667</li> <li>Improved the way we check that VM or VMSS has Linux by @verabe.   #1704</li> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use latest stable version <code>1.23.8</code> by @BernieWhite.   #1627<ul> <li>Use <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> to configure the minimum version of the cluster.</li> </ul> </li> </ul> </li> <li>Event Grid:<ul> <li>Promoted <code>Azure.EventGrid.DisableLocalAuth</code> to GA rule set by @BernieWhite.   #1628</li> </ul> </li> <li>Key Vault:<ul> <li>Promoted <code>Azure.KeyVault.AutoRotationPolicy</code> to GA rule set by @BernieWhite.   #1629</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Updated NSG documentation with code snippets and links by @simone-bennett.   #1607</li> <li>Updated Application Gateway documentation with code snippets by @ms-sambell.   #1608</li> <li>Updated SQL firewall rules documentation by @ms-sambell.   #1569</li> <li>Updated Container Apps documentation and rule to new resource type by @marie-schmidt.   #1672</li> <li>Updated KeyVault and FrontDoor documentation with code snippets by @lluppesms.   #1667</li> <li>Added tag and annotation metadata from policy for rules generation by @BernieWhite.   #1652</li> <li>Added hash to <code>name</code> and <code>ref</code> properties for policy rules by @ArmaanMcleod.   #1653<ul> <li>Use <code>AZURE_POLICY_RULE_PREFIX</code> or <code>Export-AzPolicyAssignmentRuleData -RulePrefix</code> to override rule prefix.</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule to v2.4.2.   #1753 #1748</li> <li>Bump Microsoft.NET.Test.Sdk to v17.3.2.   #1719</li> <li>Updated provider data for analysis.   #1605</li> <li>Bump Az.Resources to v6.2.0.   #1636</li> <li>Bump PSScriptAnalyzer to v1.21.0.   #1636</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed continue processing policy assignments on error by @BernieWhite.   #1651</li> <li>Fixed handling of runtime assessment data by @BernieWhite.   #1707</li> <li>Fixed conversion of type conditions to pre-conditions by @BernieWhite.   #1708</li> <li>Fixed inconclusive failure of <code>Azure.Deployment.AdminUsername</code> by @BernieWhite.   #1631</li> <li>Fixed error expanding with <code>json()</code> and single quotes by @BernieWhite.   #1656</li> <li>Fixed handling key collision with duplicate definitions using same parameters by @ArmaanMcleod.   #1653</li> <li>Fixed bug requiring all diagnostic logs settings to have auditing enabled by @BenjaminEngeset.   #1726</li> <li>Fixed <code>Azure.Deployment.AdminUsername</code> incorrectly fails with nested deployments by @BernieWhite.   #1762</li> <li>Fixed <code>Azure.FrontDoorWAF.Exclusions</code> reports exclusions when none are specified by @BernieWhite.   #1751</li> <li>Fixed <code>Azure.Deployment.AdminUsername</code> does not match the pattern by @BernieWhite.   #1758</li> <li>Consider private offerings when checking that a VM or VMSS has Linux by @verabe.   #1725</li> </ul> </li> </ul> <p>What's changed since pre-release v1.20.0-B0477:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1200-b0477-pre-release","title":"v1.20.0-B0477 (pre-release)","text":"<p>What's changed since pre-release v1.20.0-B0389:</p> <ul> <li>General improvements:<ul> <li>Added hash to <code>name</code> and <code>ref</code> properties for policy rules by @ArmaanMcleod.   #1653<ul> <li>Use <code>AZURE_POLICY_RULE_PREFIX</code> or <code>Export-AzPolicyAssignmentRuleData -RulePrefix</code> to override rule prefix.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1200-b0389-pre-release","title":"v1.20.0-B0389 (pre-release)","text":"<p>What's changed since pre-release v1.20.0-B0304:</p> <ul> <li>New rules:<ul> <li>App Configuration:<ul> <li>Check app configuration store has purge protection enabled by @BenjaminEngeset.   #1689</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Azure.Deployment.AdminUsername</code> incorrectly fails with nested deployments by @BernieWhite.   #1762</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1200-b0304-pre-release","title":"v1.20.0-B0304 (pre-release)","text":"<p>What's changed since pre-release v1.20.0-B0223:</p> <ul> <li>Engineering:<ul> <li>Bump PSRule to v2.4.2.   #1753 #1748</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Azure.FrontDoorWAF.Exclusions</code> reports exclusions when none are specified by @BernieWhite.   #1751</li> <li>Fixed <code>Azure.Deployment.AdminUsername</code> does not match the pattern by @BernieWhite.   #1758</li> <li>Consider private offerings when checking that a VM or VMSS has Linux by @verabe.   #1725</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1200-b0223-pre-release","title":"v1.20.0-B0223 (pre-release)","text":"<p>What's changed since pre-release v1.20.0-B0148:</p> <ul> <li>New features:<ul> <li>Added September 2022 baselines <code>Azure.GA_2022_09</code> and <code>Azure.Preview_2022_09</code> by @BernieWhite.   #1738<ul> <li>Includes rules released before or during September 2022.</li> <li>Marked <code>Azure.GA_2022_06</code> and <code>Azure.Preview_2022_06</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>App Configuration:<ul> <li>Check app configuration store has one or more replicas by @BenjaminEngeset.   #1688</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule to v2.4.1.   #1636</li> <li>Bump Az.Resources to v6.2.0.   #1636</li> <li>Bump PSScriptAnalyzer to v1.21.0.   #1636</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed handling key collision with duplicate definitions using same parameters by @ArmaanMcleod.   #1653</li> <li>Fixed bug requiring all diagnostic logs settings to have auditing enabled by @BenjaminEngeset.   #1726</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1200-b0148-pre-release","title":"v1.20.0-B0148 (pre-release)","text":"<p>What's changed since pre-release v1.20.0-B0085:</p> <ul> <li>New rules:<ul> <li>App Configuration:<ul> <li>Check app configuration store audit diagnostic logs are enabled by @BenjaminEngeset.   #1690</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump Microsoft.NET.Test.Sdk to v17.3.2.   #1719</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed error expanding with <code>json()</code> and single quotes by @BernieWhite.   #1656</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1200-b0085-pre-release","title":"v1.20.0-B0085 (pre-release)","text":"<p>What's changed since pre-release v1.20.0-B0028:</p> <ul> <li>New rules:<ul> <li>Azure Cache for Redis:<ul> <li>Check the number of firewall rules for caches by @jonathanruiz.   #544</li> <li>Check the number of IP addresses in firewall rules for caches by @jonathanruiz.   #544</li> </ul> </li> <li>App Configuration:<ul> <li>Check identity-based authentication is used for configuration stores by @pazdedav.   #1691</li> </ul> </li> <li>Container Registry:<ul> <li>Check soft delete policy is enabled by @BenjaminEngeset.   #1674</li> </ul> </li> <li>Defender for Cloud:<ul> <li>Check Microsoft Defender for Cloud is enabled for Containers by @jdewisscher.   #1632</li> <li>Check Microsoft Defender for Cloud is enabled for Virtual Machines by @jdewisscher.   #1632</li> <li>Check Microsoft Defender for Cloud is enabled for SQL Servers by @jdewisscher.   #1632</li> <li>Check Microsoft Defender for Cloud is enabled for App Services by @jdewisscher.   #1632</li> <li>Check Microsoft Defender for Cloud is enabled for Storage Accounts by @jdewisscher.   #1632</li> <li>Check Microsoft Defender for Cloud is enabled for SQL Servers on machines by @jdewisscher.   #1632</li> </ul> </li> <li>Network Security Group:<ul> <li>Check AKS managed NSGs don't contain custom rules by @ms-sambell.   #8</li> </ul> </li> <li>Storage Account:<ul> <li>Check blob container soft delete is enabled by @pazdedav.   #1671</li> <li>Check file share soft delete is enabled by @jonathanruiz.   #966</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Important change: Updated rules, tests and docs with Microsoft Defender for Cloud by @jonathanruiz.   #545<ul> <li>The following rules have been renamed with aliases:<ul> <li>Renamed <code>Azure.SQL.ThreatDetection</code> to <code>Azure.SQL.DefenderCloud</code>.</li> <li>Renamed <code>Azure.SecurityCenter.Contact</code> to <code>Azure.DefenderCloud.Contact</code>.</li> <li>Renamed <code>Azure.SecurityCenter.Provisioning</code> to <code>Azure.DefenderCloud.Provisioning</code>.</li> </ul> </li> <li>If you are referencing the old names please consider updating to the new names.</li> </ul> </li> <li>Updated documentation examples for Front Door and Key Vault rules by @lluppesms.   #1667</li> <li>Improved the way we check that VM or VMSS has Linux by @verabe.   #1704</li> </ul> </li> <li>General improvements:<ul> <li>Updated NSG documentation with code snippets and links by @simone-bennett.   #1607</li> <li>Updated Application Gateway documentation with code snippets by @ms-sambell.   #1608</li> <li>Updated SQL firewall rules documentation by @ms-sambell.   #1569</li> <li>Updated Container Apps documentation and rule to new resource type by @marie-schmidt.   #1672</li> <li>Updated KeyVault and FrontDoor documentation with code snippets by @lluppesms.   #1667</li> <li>Added tag and annotation metadata from policy for rules generation by @BernieWhite.   #1652</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed continue processing policy assignments on error by @BernieWhite.   #1651</li> <li>Fixed handling of runtime assessment data by @BernieWhite.   #1707</li> <li>Fixed conversion of type conditions to pre-conditions by @BernieWhite.   #1708</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1200-b0028-pre-release","title":"v1.20.0-B0028 (pre-release)","text":"<p>What's changed since pre-release v1.20.0-B0004:</p> <ul> <li>New rules:<ul> <li>AKS:<ul> <li>Check clusters use Ephemeral OS disk by @BenjaminEngeset.   #1618</li> </ul> </li> <li>CDN:<ul> <li>Check CDN profile uses Front Door Standard or Premium tier by @BenjaminEngeset.   #1612</li> </ul> </li> <li>VMSS:<ul> <li>Check Linux VMSS has disabled password authentication by @BenjaminEngeset.   #1635</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use latest stable version <code>1.23.8</code> by @BernieWhite.   #1627<ul> <li>Use <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> to configure the minimum version of the cluster.</li> </ul> </li> </ul> </li> <li>Event Grid:<ul> <li>Promoted <code>Azure.EventGrid.DisableLocalAuth</code> to GA rule set by @BernieWhite.   #1628</li> </ul> </li> <li>Key Vault:<ul> <li>Promoted <code>Azure.KeyVault.AutoRotationPolicy</code> to GA rule set by @BernieWhite.   #1629</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule to v2.4.0.   #1620</li> <li>Updated provider data for analysis.   #1605</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed function <code>dateTimeAdd</code> errors handling <code>utcNow</code> output by @BernieWhite.   #1637</li> <li>Fixed inconclusive failure of <code>Azure.Deployment.AdminUsername</code> by @BernieWhite.   #1631</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1200-b0004-pre-release","title":"v1.20.0-B0004 (pre-release)","text":"<p>What's changed since v1.19.1:</p> <ul> <li>New rules:<ul> <li>Azure Resources:<ul> <li>Check that nested deployments securely pass through administrator usernames by @ms-sambell.   #1479</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump Microsoft.NET.Test.Sdk to v17.3.1.   #1603</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1192","title":"v1.19.2","text":"<p>What's changed since v1.19.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed function <code>dateTimeAdd</code> errors handling <code>utcNow</code> output by @BernieWhite.   #1637</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1191","title":"v1.19.1","text":"<p>What's changed since v1.19.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed <code>Azure.VNET.UseNSGs</code> is missing exceptions by @BernieWhite.   #1609<ul> <li>Added exclusions for <code>RouteServerSubnet</code> and any subnet with a dedicated HSM delegation.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1190","title":"v1.19.0","text":"<p>What's changed since v1.18.1:</p> <ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check clusters use uptime SLA by @BenjaminEngeset.   #1601</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Updated rule level for the following rules by @BernieWhite.   #1551<ul> <li>Set <code>Azure.APIM.APIDescriptors</code> to warning from error.</li> <li>Set <code>Azure.APIM.ProductDescriptors</code> to warning from error.</li> <li>Set <code>Azure.Template.UseLocationParameter</code> to warning from error.</li> <li>Set <code>Azure.Template.UseComments</code> to information from error.</li> <li>Set <code>Azure.Template.UseDescriptions</code> to information from error.</li> </ul> </li> <li>Improve reporting of failing resource property for rules by @BernieWhite.   #1429</li> </ul> </li> <li>Engineering:<ul> <li>Added publishing of symbols for NuGet packages by @BernieWhite.   #1549</li> <li>Bump Az.Resources to v6.1.0.   #1557</li> <li>Bump Microsoft.NET.Test.Sdk to v17.3.0.   #1563</li> <li>Bump PSRule to v2.3.2.   #1574</li> <li>Bump support projects to .NET 6 by @BernieWhite.   #1560</li> <li>Bump BenchmarkDotNet to v0.13.2.   #1593</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.2.   #1594</li> <li>Updated provider data for analysis.   #1598</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed parameter files linked to bicep code via naming convention is not working by @BernieWhite.   #1582</li> <li>Fixed handling of storage accounts sub-resources with CMK by @BernieWhite.   #1575</li> </ul> </li> </ul> <p>What's changed since pre-release v1.19.0-B0077:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1190-b0077-pre-release","title":"v1.19.0-B0077 (pre-release)","text":"<p>What's changed since pre-release v1.19.0-B0042:</p> <ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check clusters use uptime SLA by @BenjaminEngeset.   #1601</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1190-b0042-pre-release","title":"v1.19.0-B0042 (pre-release)","text":"<p>What's changed since pre-release v1.19.0-B0010:</p> <ul> <li>General improvements:<ul> <li>Improve reporting of failing resource property for rules by @BernieWhite.   #1429</li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule to v2.3.2.   #1574</li> <li>Bump support projects to .NET 6 by @BernieWhite.   #1560</li> <li>Bump BenchmarkDotNet to v0.13.2.   #1593</li> <li>Bump BenchmarkDotNet.Diagnostics.Windows to v0.13.2.   #1594</li> <li>Updated provider data for analysis.   #1598</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed parameter files linked to bicep code via naming convention is not working by @BernieWhite.   #1582</li> <li>Fixed handling of storage accounts sub-resources with CMK by @BernieWhite.   #1575</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1190-b0010-pre-release","title":"v1.19.0-B0010 (pre-release)","text":"<p>What's changed since v1.18.1:</p> <ul> <li>General improvements:<ul> <li>Updated rule level for the following rules by @BernieWhite.   #1551<ul> <li>Set <code>Azure.APIM.APIDescriptors</code> to warning from error.</li> <li>Set <code>Azure.APIM.ProductDescriptors</code> to warning from error.</li> <li>Set <code>Azure.Template.UseLocationParameter</code> to warning from error.</li> <li>Set <code>Azure.Template.UseComments</code> to information from error.</li> <li>Set <code>Azure.Template.UseDescriptions</code> to information from error.</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Added publishing of symbols for NuGet packages by @BernieWhite.   #1549</li> <li>Bump PSRule to v2.3.1.   #1561</li> <li>Bump Az.Resources to v6.1.0.   #1557</li> <li>Bump Microsoft.NET.Test.Sdk to v17.3.0.   #1563</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1181","title":"v1.18.1","text":"<p>What's changed since v1.18.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed <code>Azure.APIM.HTTPBackend</code> reports failure when service URL is not defined by @BernieWhite.   #1555</li> <li>Fixed <code>Azure.SQL.AAD</code> failure with newer API by @BernieWhite.   #1302</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1180","title":"v1.18.0","text":"<p>What's changed since v1.17.1:</p> <ul> <li>New rules:<ul> <li>Cognitive Services:<ul> <li>Check accounts use network access restrictions by @BernieWhite.   #1532</li> <li>Check accounts use managed identities to access Azure resources by @BernieWhite.   #1532</li> <li>Check accounts only accept requests using Azure AD identities by @BernieWhite.   #1532</li> <li>Check accounts disable access using public endpoints by @BernieWhite.   #1532</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for array <code>indexOf</code>, <code>lastIndexOf</code>, and <code>items</code> ARM functions by @BernieWhite.   #1440</li> <li>Added support for <code>join</code> ARM function by @BernieWhite.   #1535</li> <li>Improved output of full path to emitted resources by @BernieWhite.   #1523</li> </ul> </li> <li>Engineering:<ul> <li>Bump Az.Resources to v6.0.1.   #1521</li> <li>Updated provider data for analysis.   #1540</li> <li>Bump xunit to v2.4.2.   #1542</li> <li>Added readme and tags to NuGet by @BernieWhite.   #1513</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Azure.SQL.TDE</code> is not required to enable Transparent Data Encryption for IaC by @BernieWhite.   #1530</li> </ul> </li> </ul> <p>What's changed since pre-release v1.18.0-B0027:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1180-b0027-pre-release","title":"v1.18.0-B0027 (pre-release)","text":"<p>What's changed since pre-release v1.18.0-B0010:</p> <ul> <li>New rules:<ul> <li>Cognitive Services:<ul> <li>Check accounts use network access restrictions by @BernieWhite.   #1532</li> <li>Check accounts use managed identities to access Azure resources by @BernieWhite.   #1532</li> <li>Check accounts only accept requests using Azure AD identities by @BernieWhite.   #1532</li> <li>Check accounts disable access using public endpoints by @BernieWhite.   #1532</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for array <code>indexOf</code>, <code>lastIndexOf</code>, and <code>items</code> ARM functions by @BernieWhite.   #1440</li> <li>Added support for <code>join</code> ARM function by @BernieWhite.   #1535</li> </ul> </li> <li>Engineering:<ul> <li>Updated provider data for analysis.   #1540</li> <li>Bump xunit to v2.4.2.   #1542</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Azure.SQL.TDE</code> is not required to enable Transparent Data Encryption for IaC by @BernieWhite.   #1530</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1180-b0010-pre-release","title":"v1.18.0-B0010 (pre-release)","text":"<p>What's changed since pre-release v1.18.0-B0002:</p> <ul> <li>General improvements:<ul> <li>Improved output of full path to emitted resources by @BernieWhite.   #1523</li> </ul> </li> <li>Engineering:<ul> <li>Bump Az.Resources to v6.0.1.   #1521</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1180-b0002-pre-release","title":"v1.18.0-B0002 (pre-release)","text":"<p>What's changed since v1.17.1:</p> <ul> <li>Engineering:<ul> <li>Added readme and tags to NuGet by @BernieWhite.   #1513</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1171","title":"v1.17.1","text":"<p>What's changed since v1.17.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed union returns null when merged with built-in expansion objects by @BernieWhite.   #1515</li> <li>Fixed missing zones in test for standalone VM by @BernieWhite.   #1506</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1170","title":"v1.17.0","text":"<p>What's changed since v1.16.1:</p> <ul> <li>New features:<ul> <li>Added more field count expression support for Azure Policy JSON rules by @ArmaanMcleod.   #181</li> <li>Added June 2022 baselines <code>Azure.GA_2022_06</code> and <code>Azure.Preview_2022_06</code> by @BernieWhite.   #1499<ul> <li>Includes rules released before or during June 2022.</li> <li>Marked <code>Azure.GA_2022_03</code> and <code>Azure.Preview_2022_03</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Deployment:<ul> <li>Check for secure values in outputs by @BernieWhite.   #297</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump Newtonsoft.Json to v13.0.1.   #1494</li> <li>Updated NuGet packaging metadata by @BernieWhite.   #1428</li> <li>Updated provider data for analysis.   #1502</li> <li>Bump PSRule to v2.2.0.   #1444</li> <li>Updated NuGet packaging metadata by @BernieWhite.   #1428</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed TDE property status to state by @Dylan-Prins.   #1505</li> <li>Fixed the language expression value fails in outputs by @BernieWhite.   #1485</li> </ul> </li> </ul> <p>What's changed since pre-release v1.17.0-B0064:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1170-b0064-pre-release","title":"v1.17.0-B0064 (pre-release)","text":"<p>What's changed since pre-release v1.17.0-B0035:</p> <ul> <li>Engineering:<ul> <li>Updated provider data for analysis.   #1502</li> <li>Bump PSRule to v2.2.0.   #1444</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed TDE property status to state by @Dylan-Prins.   #1505</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1170-b0035-pre-release","title":"v1.17.0-B0035 (pre-release)","text":"<p>What's changed since pre-release v1.17.0-B0014:</p> <ul> <li>New features:<ul> <li>Added June 2022 baselines <code>Azure.GA_2022_06</code> and <code>Azure.Preview_2022_06</code> by @BernieWhite.   #1499<ul> <li>Includes rules released before or during June 2022.</li> <li>Marked <code>Azure.GA_2022_03</code> and <code>Azure.Preview_2022_03</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump Newtonsoft.Json to v13.0.1.   #1494</li> <li>Updated NuGet packaging metadata by @BernieWhite.   #1428</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1170-b0014-pre-release","title":"v1.17.0-B0014 (pre-release)","text":"<p>What's changed since v1.16.1:</p> <ul> <li>New features:<ul> <li>Added more field count expression support for Azure Policy JSON rules by @ArmaanMcleod.   #181</li> </ul> </li> <li>New rules:<ul> <li>Deployment:<ul> <li>Check for secure values in outputs by @BernieWhite.   #297</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Updated NuGet packaging metadata by @BernieWhite.   #1428</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed the language expression value fails in outputs by @BernieWhite.   #1485</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1161","title":"v1.16.1","text":"<p>What's changed since v1.16.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed TLS 1.3 support in <code>Azure.AppGw.SSLPolicy</code> by @BernieWhite.   #1469</li> <li>Fixed Application Gateway referencing a WAF policy by @BernieWhite.   #1466</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1160","title":"v1.16.0","text":"<p>What's changed since v1.15.2:</p> <ul> <li>New rules:<ul> <li>App Service:<ul> <li>Check web apps have insecure FTP disabled by @BernieWhite.   #1436</li> <li>Check web apps use a dedicated health probe by @BernieWhite.   #1437</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Public IP:<ul> <li>Updated <code>Azure.PublicIP.AvailabilityZone</code> to exclude IP addresses for Azure Bastion by @BernieWhite.   #1442<ul> <li>Public IP addresses with the <code>resource-usage</code> tag set to <code>azure-bastion</code> are excluded.</li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for <code>dateTimeFromEpoch</code> and <code>dateTimeToEpoch</code> ARM functions by @BernieWhite.   #1451</li> </ul> </li> <li>Engineering:<ul> <li>Updated built documentation to include rule ref and metadata by @BernieWhite.   #1432</li> <li>Added ref properties for several rules by @BernieWhite.   #1430</li> <li>Updated provider data for analysis.   #1453</li> <li>Bump Microsoft.NET.Test.Sdk to v17.2.0.   #1410</li> <li>Update CI checks to include required ref property by @BernieWhite.   #1431</li> <li>Added ref properties for rules by @BernieWhite.   #1430</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Azure.Template.UseVariables</code> does not accept function variables names by @BernieWhite.   #1427</li> <li>Fixed dependency issue within Azure Pipelines <code>AzurePowerShell</code> task by @BernieWhite.   #1447<ul> <li>Removed dependency on <code>Az.Accounts</code> and <code>Az.Resources</code> from manifest.   Pre-install these modules to use export cmdlets.</li> </ul> </li> </ul> </li> </ul> <p>What's changed since pre-release v1.16.0-B0072:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1160-b0072-pre-release","title":"v1.16.0-B0072 (pre-release)","text":"<p>What's changed since pre-release v1.16.0-B0041:</p> <ul> <li>Engineering:<ul> <li>Update CI checks to include required ref property by @BernieWhite.   #1431</li> <li>Added ref properties for rules by @BernieWhite.   #1430</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed dependency issue within Azure Pipelines <code>AzurePowerShell</code> task by @BernieWhite.   #1447<ul> <li>Removed dependency on <code>Az.Accounts</code> and <code>Az.Resources</code> from manifest.   Pre-install these modules to use export cmdlets.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1160-b0041-pre-release","title":"v1.16.0-B0041 (pre-release)","text":"<p>What's changed since pre-release v1.16.0-B0017:</p> <ul> <li>Updated rules:<ul> <li>Public IP:<ul> <li>Updated <code>Azure.PublicIP.AvailabilityZone</code> to exclude IP addresses for Azure Bastion by @BernieWhite.   #1442<ul> <li>Public IP addresses with the <code>resource-usage</code> tag set to <code>azure-bastion</code> are excluded.</li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for <code>dateTimeFromEpoch</code> and <code>dateTimeToEpoch</code> ARM functions by @BernieWhite.   #1451</li> </ul> </li> <li>Engineering:<ul> <li>Updated built documentation to include rule ref and metadata by @BernieWhite.   #1432</li> <li>Added ref properties for several rules by @BernieWhite.   #1430</li> <li>Updated provider data for analysis.   #1453</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1160-b0017-pre-release","title":"v1.16.0-B0017 (pre-release)","text":"<p>What's changed since v1.15.2:</p> <ul> <li>New rules:<ul> <li>App Service:<ul> <li>Check web apps have insecure FTP disabled by @BernieWhite.   #1436</li> <li>Check web apps use a dedicated health probe by @BernieWhite.   #1437</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump Microsoft.NET.Test.Sdk to v17.2.0.   #1410</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Azure.Template.UseVariables</code> does not accept function variables names by @BernieWhite.   #1427</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1152","title":"v1.15.2","text":"<p>What's changed since v1.15.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed <code>Azure.AppService.ManagedIdentity</code> does not accept both system and user assigned by @BernieWhite.   #1415<ul> <li>This also applies to:<ul> <li><code>Azure.ADX.ManagedIdentity</code></li> <li><code>Azure.APIM.ManagedIdentity</code></li> <li><code>Azure.EventGrid.ManagedIdentity</code></li> <li><code>Azure.Automation.ManagedIdentity</code></li> </ul> </li> </ul> </li> <li>Fixed Web apps with .NET 6 do not meet version constraint of <code>Azure.AppService.NETVersion</code> by @BernieWhite.   #1414<ul> <li>This also applies to <code>Azure.AppService.PHPVersion</code>.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1151","title":"v1.15.1","text":"<p>What's changed since v1.15.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed exclusion of <code>dataCollectionRuleAssociations</code> from <code>Azure.Resource.UseTags</code> by @BernieWhite.   #1400</li> <li>Fixed could not determine JSON object type for MockObject using CreateObject by @BernieWhite.   #1411</li> <li>Fixed cannot bind argument to parameter 'Sku' because it is an empty string by @BernieWhite.   #1407</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1150","title":"v1.15.0","text":"<p>What's changed since v1.14.3:</p> <ul> <li>New features:<ul> <li>Important change: Added <code>Azure.Resource.SupportsTags</code> selector by @BernieWhite.   #1339<ul> <li>Use this selector in custom rules to filter rules to only run against resources that support tags.</li> <li>This selector replaces the <code>SupportsTags</code> PowerShell function.</li> <li>Using the <code>SupportsTag</code> function will now result in a warning.</li> <li>The <code>SupportsTags</code> function will be removed in v2.</li> <li>See upgrade notes for more information.</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use latest stable version <code>1.22.6</code> by @BernieWhite.   #1386<ul> <li>Use <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> to configure the minimum version of the cluster.</li> </ul> </li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Added code signing of module by @BernieWhite.   #1379</li> <li>Added SBOM manifests to module by @BernieWhite.   #1380</li> <li>Embedded provider and alias information as manifest resources by @BernieWhite.   #1383<ul> <li>Resources are minified and compressed to improve size and speed.</li> </ul> </li> <li>Added additional <code>nodeps</code> manifest that does not include dependencies for Az modules by @BernieWhite.   #1392</li> <li>Bump Az.Accounts to 2.7.6. #1338</li> <li>Bump Az.Resources to 5.6.0. #1338</li> <li>Bump PSRule to 2.1.0. #1338</li> <li>Bump Pester to 5.3.3. #1338</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed dependency chain order when dependsOn copy by @BernieWhite.   #1381</li> <li>Fixed error calling SupportsTags function by @BernieWhite.   #1401</li> </ul> </li> </ul> <p>What's changed since pre-release v1.15.0-B0053:</p> <ul> <li>Bug fixes:<ul> <li>Fixed error calling SupportsTags function by @BernieWhite.   #1401</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1150-b0053-pre-release","title":"v1.15.0-B0053 (pre-release)","text":"<p>What's changed since pre-release v1.15.0-B0022:</p> <ul> <li>New features:<ul> <li>Important change: Added <code>Azure.Resource.SupportsTags</code> selector. #1339<ul> <li>Use this selector in custom rules to filter rules to only run against resources that support tags.</li> <li>This selector replaces the <code>SupportsTags</code> PowerShell function.</li> <li>Using the <code>SupportsTag</code> function will now result in a warning.</li> <li>The <code>SupportsTags</code> function will be removed in v2.</li> <li>See upgrade notes for more information.</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Embedded provider and alias information as manifest resources. #1383<ul> <li>Resources are minified and compressed to improve size and speed.</li> </ul> </li> <li>Added additional <code>nodeps</code> manifest that does not include dependencies for Az modules. #1392</li> <li>Bump Az.Accounts to 2.7.6. #1338</li> <li>Bump Az.Resources to 5.6.0. #1338</li> <li>Bump PSRule to 2.1.0. #1338</li> <li>Bump Pester to 5.3.3. #1338</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1150-b0022-pre-release","title":"v1.15.0-B0022 (pre-release)","text":"<p>What's changed since v1.14.3:</p> <ul> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use latest stable version <code>1.22.6</code>. #1386<ul> <li>Use <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> to configure the minimum version of the cluster.</li> </ul> </li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Added code signing of module. #1379</li> <li>Added SBOM manifests to module. #1380</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed dependency chain order when dependsOn copy. #1381</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1143","title":"v1.14.3","text":"<p>What's changed since v1.14.2:</p> <ul> <li>Bug fixes:<ul> <li>Fixed Azure Firewall threat intel mode reported for Secure VNET hubs. #1365</li> <li>Fixed array function handling with mock objects. #1367</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1142","title":"v1.14.2","text":"<p>What's changed since v1.14.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed handling of parent resources when sub resource is in a separate deployment. #1360</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1141","title":"v1.14.1","text":"<p>What's changed since v1.14.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed unable to set parameter defaults option with type object. #1355</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1140","title":"v1.14.0","text":"<p>What's changed since v1.13.4:</p> <ul> <li>New features:<ul> <li>Added support for referencing resources in template. #1315<ul> <li>The <code>reference()</code> function can be used to reference resources in template.</li> <li>A placeholder value is still used for resources outside of the template.</li> </ul> </li> <li>Added March 2022 baselines <code>Azure.GA_2022_03</code> and <code>Azure.Preview_2022_03</code>. #1334<ul> <li>Includes rules released before or during March 2022.</li> <li>Marked <code>Azure.GA_2021_12</code> and <code>Azure.Preview_2021_12</code> baselines as obsolete.</li> </ul> </li> <li>Experimental: Cmdlets to validate objects with Azure policy conditions:<ul> <li><code>Export-AzPolicyAssignmentData</code> - Exports policy assignment data. #1266</li> <li><code>Export-AzPolicyAssignmentRuleData</code> - Exports JSON rules from policy assignment data. #1278</li> <li><code>Get-AzPolicyAssignmentDataSource</code> - Discovers policy assignment data. #1340</li> <li>See cmdlet help for limitations and usage.</li> <li>Additional information will be posted as this feature evolves here.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>SignalR Service:<ul> <li>Check services use Managed Identities. #1306</li> <li>Check services use a SKU with an SLA. #1307</li> </ul> </li> <li>Web PubSub Service:<ul> <li>Check services use Managed Identities. #1308</li> <li>Check services use a SKU with an SLA. #1309</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use latest stable version <code>1.21.9</code>. #1318<ul> <li>Use <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> to configure the minimum version of the cluster.</li> </ul> </li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Cache Azure Policy Aliases. #1277</li> <li>Cleanup of additional alias metadata. #1351</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed index was out of range with split on mock properties. #1327</li> <li>Fixed mock objects with no properties. #1347</li> <li>Fixed sub-resources nesting by scope regression. #1348</li> <li>Fixed expand of runtime properties on reference objects. #1324</li> <li>Fixed processing of deployment outputs. #1316</li> </ul> </li> </ul> <p>What's changed since pre-release v1.14.0-B2204013:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1140-b2204013-pre-release","title":"v1.14.0-B2204013 (pre-release)","text":"<p>What's changed since pre-release v1.14.0-B2204007:</p> <ul> <li>Engineering:<ul> <li>Cleanup of additional alias metadata. #1351</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1140-b2204007-pre-release","title":"v1.14.0-B2204007 (pre-release)","text":"<p>What's changed since pre-release v1.14.0-B2203117:</p> <ul> <li>Bug fixes:<ul> <li>Fixed mock objects with no properties. #1347</li> <li>Fixed sub-resources nesting by scope regression. #1348</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1140-b2203117-pre-release","title":"v1.14.0-B2203117 (pre-release)","text":"<p>What's changed since pre-release v1.14.0-B2203088:</p> <ul> <li>New features:<ul> <li>Experimental: Cmdlets to validate objects with Azure policy conditions:<ul> <li><code>Export-AzPolicyAssignmentData</code> - Exports policy assignment data. #1266</li> <li><code>Export-AzPolicyAssignmentRuleData</code> - Exports JSON rules from policy assignment data. #1278</li> <li><code>Get-AzPolicyAssignmentDataSource</code> - Discovers policy assignment data. #1340</li> <li>See cmdlet help for limitations and usage.</li> <li>Additional information will be posted as this feature evolves here.</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Cache Azure Policy Aliases. #1277</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed index was out of range with split on mock properties. #1327</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1140-b2203088-pre-release","title":"v1.14.0-B2203088 (pre-release)","text":"<p>What's changed since pre-release v1.14.0-B2203066:</p> <ul> <li>New features:<ul> <li>Added March 2022 baselines <code>Azure.GA_2022_03</code> and <code>Azure.Preview_2022_03</code>. #1334<ul> <li>Includes rules released before or during March 2022.</li> <li>Marked <code>Azure.GA_2021_12</code> and <code>Azure.Preview_2021_12</code> baselines as obsolete.</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed expand of runtime properties on reference objects. #1324</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1140-b2203066-pre-release","title":"v1.14.0-B2203066 (pre-release)","text":"<p>What's changed since v1.13.4:</p> <ul> <li>New features:<ul> <li>Added support for referencing resources in template. #1315<ul> <li>The <code>reference()</code> function can be used to reference resources in template.</li> <li>A placeholder value is still used for resources outside of the template.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>SignalR Service:<ul> <li>Check services use Managed Identities. #1306</li> <li>Check services use a SKU with an SLA. #1307</li> </ul> </li> <li>Web PubSub Service:<ul> <li>Check services use Managed Identities. #1308</li> <li>Check services use a SKU with an SLA. #1309</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use latest stable version <code>1.21.9</code>. #1318<ul> <li>Use <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> to configure the minimum version of the cluster.</li> </ul> </li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed processing of deployment outputs. #1316</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1134","title":"v1.13.4","text":"<p>What's changed since v1.13.3:</p> <ul> <li>Bug fixes:<ul> <li>Fixed virtual network without any subnets is invalid. #1303</li> <li>Fixed container registry rules that require a premium tier. #1304<ul> <li>Rules <code>Azure.ACR.Retention</code> and <code>Azure.ACR.ContentTrust</code> are now only run against premium instances.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1133","title":"v1.13.3","text":"<p>What's changed since v1.13.2:</p> <ul> <li>Bug fixes:<ul> <li>Fixed bicep build timeout for complex deployments. #1299</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1132","title":"v1.13.2","text":"<p>What's changed since v1.13.1:</p> <ul> <li>Engineering:<ul> <li>Bump PowerShellStandard.Library to 5.1.1. #1295</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed nested resource loops. #1293</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1131","title":"v1.13.1","text":"<p>What's changed since v1.13.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed parsing of nested quote pairs within JSON function. #1288</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1130","title":"v1.13.0","text":"<p>What's changed since v1.12.2:</p> <ul> <li>New features:<ul> <li>Added support for setting defaults for required parameters. #1065<ul> <li>When specified, the value will be used when a parameter value is not provided.</li> </ul> </li> <li>Added support expanding Bicep from parameter files. #1160</li> </ul> </li> <li>New rules:<ul> <li>Azure Cache for Redis:<ul> <li>Limit public access for Azure Cache for Redis instances. #935</li> </ul> </li> <li>Container App:<ul> <li>Check insecure ingress is not enabled (preview). #1252</li> </ul> </li> <li>Key Vault:<ul> <li>Check key auto-rotation is enabled (preview). #1159</li> </ul> </li> <li>Recovery Services Vault:<ul> <li>Check vaults have replication alerts configured. #7</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Automatically build baseline docs. #1242</li> <li>Bump PSRule dependency to v1.11.1. #1269</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed empty value with strong type. #1258</li> <li>Fixed error with empty logic app trigger. #1249</li> <li>Fixed out of order parameters. #1257</li> <li>Fixed mapping default configuration causes cast exception. #1274</li> <li>Fixed resource id is incorrectly built for sub resource types. #1279</li> </ul> </li> </ul> <p>What's changed since pre-release v1.13.0-B2202113:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1130-b2202113-pre-release","title":"v1.13.0-B2202113 (pre-release)","text":"<p>What's changed since pre-release v1.13.0-B2202108:</p> <ul> <li>Bug fixes:<ul> <li>Fixed resource id is incorrectly built for sub resource types. #1279</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1130-b2202108-pre-release","title":"v1.13.0-B2202108 (pre-release)","text":"<p>What's changed since pre-release v1.13.0-B2202103:</p> <ul> <li>Bug fixes:<ul> <li>Fixed mapping default configuration causes cast exception. #1274</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1130-b2202103-pre-release","title":"v1.13.0-B2202103 (pre-release)","text":"<p>What's changed since pre-release v1.13.0-B2202090:</p> <ul> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.11.1. #1269</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed out of order parameters. #1257</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1130-b2202090-pre-release","title":"v1.13.0-B2202090 (pre-release)","text":"<p>What's changed since pre-release v1.13.0-B2202063:</p> <ul> <li>New rules:<ul> <li>Azure Cache for Redis:<ul> <li>Limit public access for Azure Cache for Redis instances. #935</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Automatically build baseline docs. #1242</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed empty value with strong type. #1258</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1130-b2202063-pre-release","title":"v1.13.0-B2202063 (pre-release)","text":"<p>What's changed since v1.12.2:</p> <ul> <li>New features:<ul> <li>Added support for setting defaults for required parameters. #1065<ul> <li>When specified, the value will be used when a parameter value is not provided.</li> </ul> </li> <li>Added support expanding Bicep from parameter files. #1160</li> </ul> </li> <li>New rules:<ul> <li>Container App:<ul> <li>Check insecure ingress is not enabled (preview). #1252</li> </ul> </li> <li>Key Vault:<ul> <li>Check key auto-rotation is enabled (preview). #1159</li> </ul> </li> <li>Recovery Services Vault:<ul> <li>Check vaults have replication alerts configured. #7</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed error with empty logic app trigger. #1249</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1122","title":"v1.12.2","text":"<p>What's changed since v1.12.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed detect strong type requirements for nested deployments. #1235</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1121","title":"v1.12.1","text":"<p>What's changed since v1.12.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed Bicep already exists with PSRule v2. #1232</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1120","title":"v1.12.0","text":"<p>What's changed since v1.11.1:</p> <ul> <li>New rules:<ul> <li>Data Explorer:<ul> <li>Check clusters use Managed Identities. #1207</li> <li>Check clusters use a SKU with a SLA. #1208</li> <li>Check clusters use disk encryption. #1209</li> <li>Check clusters are in use with databases. #1215</li> </ul> </li> <li>Event Hub:<ul> <li>Check namespaces are in use with event hubs. #1216</li> <li>Check namespaces only accept identity-based authentication. #1217</li> </ul> </li> <li>Azure Recovery Services Vault:<ul> <li>Check vaults use geo-redundant storage. #5</li> </ul> </li> <li>Service Bus:<ul> <li>Check namespaces are in use with queues and topics. #1218</li> <li>Check namespaces only accept identity-based authentication. #1219</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use latest stable version <code>1.21.7</code>. #1188<ul> <li>Pinned latest GA baseline <code>Azure.GA_2021_12</code> to previous version <code>1.20.5</code>.</li> <li>Use <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> to configure the minimum version of the cluster.</li> </ul> </li> </ul> </li> <li>Azure API Management:<ul> <li>Check service disabled insecure ciphers.   #1128</li> <li>Refactored the cipher and protocol rule into individual rules.<ul> <li><code>Azure.APIM.Protocols</code></li> <li><code>Azure.APIM.Ciphers</code></li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Important change: Replaced <code>Azure_AKSMinimumVersion</code> option with <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code>. #941<ul> <li>For compatibility, if <code>Azure_AKSMinimumVersion</code> is set it will be used instead of <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code>.</li> <li>If only <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> is set, this value will be used.</li> <li>The default will be used neither options are configured.</li> <li>If <code>Azure_AKSMinimumVersion</code> is set a warning will be generated until the configuration is removed.</li> <li>Support for <code>Azure_AKSMinimumVersion</code> is deprecated and will be removed in v2.</li> <li>See upgrade notes for details.</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed false positive of blob container with access unspecified. #1212</li> </ul> </li> </ul> <p>What's changed since pre-release v1.12.0-B2201086:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1120-b2201086-pre-release","title":"v1.12.0-B2201086 (pre-release)","text":"<p>What's changed since pre-release v1.12.0-B2201067:</p> <ul> <li>New rules:<ul> <li>Data Explorer:<ul> <li>Check clusters are in use with databases. #1215</li> </ul> </li> <li>Event Hub:<ul> <li>Check namespaces are in use with event hubs. #1216</li> <li>Check namespaces only accept identity-based authentication. #1217</li> </ul> </li> <li>Azure Recovery Services Vault:<ul> <li>Check vaults use geo-redundant storage. #5</li> </ul> </li> <li>Service Bus:<ul> <li>Check namespaces are in use with queues and topics. #1218</li> <li>Check namespaces only accept identity-based authentication. #1219</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1120-b2201067-pre-release","title":"v1.12.0-B2201067 (pre-release)","text":"<p>What's changed since pre-release v1.12.0-B2201054:</p> <ul> <li>New rules:<ul> <li>Data Explorer:<ul> <li>Check clusters use Managed Identities. #1207</li> <li>Check clusters use a SKU with a SLA. #1208</li> <li>Check clusters use disk encryption. #1209</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed false positive of blob container with access unspecified. #1212</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1120-b2201054-pre-release","title":"v1.12.0-B2201054 (pre-release)","text":"<p>What's changed since v1.11.1:</p> <ul> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to use latest stable version <code>1.21.7</code>. #1188<ul> <li>Pinned latest GA baseline <code>Azure.GA_2021_12</code> to previous version <code>1.20.5</code>.</li> <li>Use <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> to configure the minimum version of the cluster.</li> </ul> </li> </ul> </li> <li>Azure API Management:<ul> <li>Check service disabled insecure ciphers.   #1128</li> <li>Refactored the cipher and protocol rule into individual rules.<ul> <li><code>Azure.APIM.Protocols</code></li> <li><code>Azure.APIM.Ciphers</code></li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Important change: Replaced <code>Azure_AKSMinimumVersion</code> option with <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code>. #941<ul> <li>For compatibility, if <code>Azure_AKSMinimumVersion</code> is set it will be used instead of <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code>.</li> <li>If only <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> is set, this value will be used.</li> <li>The default will be used neither options are configured.</li> <li>If <code>Azure_AKSMinimumVersion</code> is set a warning will be generated until the configuration is removed.</li> <li>Support for <code>Azure_AKSMinimumVersion</code> is deprecated and will be removed in v2.</li> <li>See upgrade notes for details.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1111","title":"v1.11.1","text":"<p>What's changed since v1.11.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed <code>Azure.AKS.CNISubnetSize</code> rule to use CNI selector. #1178</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1110","title":"v1.11.0","text":"<p>What's changed since v1.10.4:</p> <ul> <li>New features:<ul> <li>Added baselines containing only Azure preview features. #1129<ul> <li>Added baseline <code>Azure.Preview_2021_09</code>.</li> <li>Added baseline <code>Azure.Preview_2021_12</code>.</li> </ul> </li> <li>Added <code>Azure.GA_2021_12</code> baseline. #1146<ul> <li>Includes rules released before or during December 2021 for Azure GA features.</li> <li>Marked baseline <code>Azure.GA_2021_09</code> as obsolete.</li> </ul> </li> <li>Bicep support promoted from experimental to generally available (GA). #1176</li> </ul> </li> <li>New rules:<ul> <li>All resources:<ul> <li>Check comments for each template resource. #969</li> </ul> </li> <li>Automation Account:<ul> <li>Automation accounts should enable diagnostic logs. #1075</li> </ul> </li> <li>Azure Kubernetes Service:<ul> <li>Check clusters have the HTTP application routing add-on disabled. #1131</li> <li>Check clusters use the Secrets Store CSI Driver add-on. #992</li> <li>Check clusters autorotation with the Secrets Store CSI Driver add-on. #993</li> <li>Check clusters use Azure AD Pod Managed Identities (preview). #991</li> </ul> </li> <li>Azure Redis Cache:<ul> <li>Use availability zones for Azure Cache for Redis for regions that support it. #1078<ul> <li><code>Azure.Redis.AvailabilityZone</code></li> <li><code>Azure.RedisEnterprise.Zones</code></li> </ul> </li> </ul> </li> <li>Application Security Group:<ul> <li>Check Application Security Groups meet naming requirements. #1110</li> </ul> </li> <li>Firewall:<ul> <li>Check Firewalls meet naming requirements. #1110</li> <li>Check Firewall policies meet naming requirements. #1110</li> </ul> </li> <li>Private Endpoint:<ul> <li>Check Private Endpoints meet naming requirements. #1110</li> </ul> </li> <li>Virtual WAN:<ul> <li>Check Virtual WANs meet naming requirements. #1110</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Promoted <code>Azure.AKS.AutoUpgrade</code> to GA rule set. #1130</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for template function <code>tenant()</code>. #1124</li> <li>Added support for template function <code>managementGroup()</code>. #1125</li> <li>Added support for template function <code>pickZones()</code>. #518</li> </ul> </li> <li>Engineering:<ul> <li>Rule refactoring of rules from PowerShell to YAML. #1109<ul> <li>The following rules were refactored:<ul> <li><code>Azure.LB.Name</code></li> <li><code>Azure.NSG.Name</code></li> <li><code>Azure.Firewall.Mode</code></li> <li><code>Azure.Route.Name</code></li> <li><code>Azure.VNET.Name</code></li> <li><code>Azure.VNG.Name</code></li> <li><code>Azure.VNG.ConnectionName</code></li> <li><code>Azure.AppConfig.SKU</code></li> <li><code>Azure.AppConfig.Name</code></li> <li><code>Azure.AppInsights.Workspace</code></li> <li><code>Azure.AppInsights.Name</code></li> <li><code>Azure.Cosmos.AccountName</code></li> <li><code>Azure.FrontDoor.State</code></li> <li><code>Azure.FrontDoor.Name</code></li> <li><code>Azure.FrontDoor.WAF.Mode</code></li> <li><code>Azure.FrontDoor.WAF.Enabled</code></li> <li><code>Azure.FrontDoor.WAF.Name</code></li> <li><code>Azure.AKS.MinNodeCount</code></li> <li><code>Azure.AKS.ManagedIdentity</code></li> <li><code>Azure.AKS.StandardLB</code></li> <li><code>Azure.AKS.AzurePolicyAddOn</code></li> <li><code>Azure.AKS.ManagedAAD</code></li> <li><code>Azure.AKS.AuthorizedIPs</code></li> <li><code>Azure.AKS.LocalAccounts</code></li> <li><code>Azure.AKS.AzureRBAC</code></li> </ul> </li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed output of Bicep informational and warning messages in error stream. #1157</li> </ul> </li> </ul> <p>What's changed since pre-release v1.11.0-B2112112:</p> <ul> <li>New features:<ul> <li>Bicep support promoted from experimental to generally available (GA). #1176</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1110-b2112112-pre-release","title":"v1.11.0-B2112112 (pre-release)","text":"<p>What's changed since pre-release v1.11.0-B2112104:</p> <ul> <li>New rules:<ul> <li>Azure Redis Cache:<ul> <li>Use availability zones for Azure Cache for Redis for regions that support it. #1078<ul> <li><code>Azure.Redis.AvailabilityZone</code></li> <li><code>Azure.RedisEnterprise.Zones</code></li> </ul> </li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1110-b2112104-pre-release","title":"v1.11.0-B2112104 (pre-release)","text":"<p>What's changed since pre-release v1.11.0-B2112073:</p> <ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check clusters use Azure AD Pod Managed Identities (preview). #991</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Rule refactoring of rules from PowerShell to YAML. #1109<ul> <li>The following rules were refactored:<ul> <li><code>Azure.AppConfig.SKU</code></li> <li><code>Azure.AppConfig.Name</code></li> <li><code>Azure.AppInsights.Workspace</code></li> <li><code>Azure.AppInsights.Name</code></li> <li><code>Azure.Cosmos.AccountName</code></li> <li><code>Azure.FrontDoor.State</code></li> <li><code>Azure.FrontDoor.Name</code></li> <li><code>Azure.FrontDoor.WAF.Mode</code></li> <li><code>Azure.FrontDoor.WAF.Enabled</code></li> <li><code>Azure.FrontDoor.WAF.Name</code></li> <li><code>Azure.AKS.MinNodeCount</code></li> <li><code>Azure.AKS.ManagedIdentity</code></li> <li><code>Azure.AKS.StandardLB</code></li> <li><code>Azure.AKS.AzurePolicyAddOn</code></li> <li><code>Azure.AKS.ManagedAAD</code></li> <li><code>Azure.AKS.AuthorizedIPs</code></li> <li><code>Azure.AKS.LocalAccounts</code></li> <li><code>Azure.AKS.AzureRBAC</code></li> </ul> </li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed output of Bicep informational and warning messages in error stream. #1157</li> <li>Fixed obsolete flag for baseline <code>Azure.Preview_2021_12</code>. #1166</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1110-b2112073-pre-release","title":"v1.11.0-B2112073 (pre-release)","text":"<p>What's changed since pre-release v1.11.0-B2112024:</p> <ul> <li>New features:<ul> <li>Added baselines containing only Azure preview features. #1129<ul> <li>Added baseline <code>Azure.Preview_2021_09</code>.</li> <li>Added baseline <code>Azure.Preview_2021_12</code>.</li> </ul> </li> <li>Added <code>Azure.GA_2021_12</code> baseline. #1146<ul> <li>Includes rules released before or during December 2021 for Azure GA features.</li> <li>Marked baseline <code>Azure.GA_2021_09</code> as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>All resources:<ul> <li>Check comments for each template resource. #969</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed template function <code>equals</code> parameter count mismatch. #1137</li> <li>Fixed copy loop on nested deployment parameters is not handled. #1144</li> <li>Fixed outer copy loop of nested deployment. #1154</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1110-b2112024-pre-release","title":"v1.11.0-B2112024 (pre-release)","text":"<p>What's changed since pre-release v1.11.0-B2111014:</p> <ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check clusters have the HTTP application routing add-on disabled. #1131</li> <li>Check clusters use the Secrets Store CSI Driver add-on. #992</li> <li>Check clusters autorotation with the Secrets Store CSI Driver add-on. #993</li> </ul> </li> <li>Automation Account:<ul> <li>Automation accounts should enable diagnostic logs. #1075</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Promoted <code>Azure.AKS.AutoUpgrade</code> to GA rule set. #1130</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for template function <code>tenant()</code>. #1124</li> <li>Added support for template function <code>managementGroup()</code>. #1125</li> <li>Added support for template function <code>pickZones()</code>. #518</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Azure.Policy.WaiverExpiry</code> date conversion. #1118</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1110-b2111014-pre-release","title":"v1.11.0-B2111014 (pre-release)","text":"<p>What's changed since v1.10.0:</p> <ul> <li>New rules:<ul> <li>Application Security Group:<ul> <li>Check Application Security Groups meet naming requirements. #1110</li> </ul> </li> <li>Firewall:<ul> <li>Check Firewalls meet naming requirements. #1110</li> <li>Check Firewall policies meet naming requirements. #1110</li> </ul> </li> <li>Private Endpoint:<ul> <li>Check Private Endpoints meet naming requirements. #1110</li> </ul> </li> <li>Virtual WAN:<ul> <li>Check Virtual WANs meet naming requirements. #1110</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Rule refactoring of rules from PowerShell to YAML. #1109<ul> <li>The following rules were refactored:<ul> <li><code>Azure.LB.Name</code></li> <li><code>Azure.NSG.Name</code></li> <li><code>Azure.Firewall.Mode</code></li> <li><code>Azure.Route.Name</code></li> <li><code>Azure.VNET.Name</code></li> <li><code>Azure.VNG.Name</code></li> <li><code>Azure.VNG.ConnectionName</code></li> </ul> </li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1104","title":"v1.10.4","text":"<p>What's changed since v1.10.3:</p> <ul> <li>Bug fixes:<ul> <li>Fixed outer copy loop of nested deployment. #1154</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1103","title":"v1.10.3","text":"<p>What's changed since v1.10.2:</p> <ul> <li>Bug fixes:<ul> <li>Fixed copy loop on nested deployment parameters is not handled. #1144</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1102","title":"v1.10.2","text":"<p>What's changed since v1.10.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed template function <code>equals</code> parameter count mismatch. #1137</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1101","title":"v1.10.1","text":"<p>What's changed since v1.10.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed <code>Azure.Policy.WaiverExpiry</code> date conversion. #1118</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1100","title":"v1.10.0","text":"<p>What's changed since v1.9.1:</p> <ul> <li>New features:<ul> <li>Added support for parameter strong types. #1083<ul> <li>The value of string parameters can be tested against the expected type.</li> <li>When configuring a location strong type, the parameter value must be a valid Azure location.</li> <li>When configuring a resource type strong type, the parameter value must be a matching resource Id.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>All resources:<ul> <li>Check template expressions do not exceed a maximum length. #1006</li> </ul> </li> <li>Automation Service:<ul> <li>Check automation accounts should use managed identities for authentication. #1074</li> </ul> </li> <li>Event Grid:<ul> <li>Check topics and domains use managed identities. #1091</li> <li>Check topics and domains use private endpoints. #1092</li> <li>Check topics and domains use identity-based authentication. #1093</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Updated default baseline to use module configuration. #1089</li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.9.0. #1081</li> <li>Bump Microsoft.CodeAnalysis.NetAnalyzers to v6.0.0. #1080</li> <li>Bump Microsoft.SourceLink.GitHub to 1.1.1. #1085</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed expansion of secret references. #1098</li> <li>Fixed handling of tagging for deployments. #1099</li> <li>Fixed strong type issue flagged with empty defaultValue string. #1100</li> </ul> </li> </ul> <p>What's changed since pre-release v1.10.0-B2111081:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v1100-b2111081-pre-release","title":"v1.10.0-B2111081 (pre-release)","text":"<p>What's changed since pre-release v1.10.0-B2111072:</p> <ul> <li>New rules:<ul> <li>Automation Service:<ul> <li>Automation accounts should use managed identities for authentication. #1074</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1100-b2111072-pre-release","title":"v1.10.0-B2111072 (pre-release)","text":"<p>What's changed since pre-release v1.10.0-B2111058:</p> <ul> <li>New rules:<ul> <li>All resources:<ul> <li>Check template expressions do not exceed a maximum length. #1006</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed expansion of secret references. #1098</li> <li>Fixed handling of tagging for deployments. #1099</li> <li>Fixed strong type issue flagged with empty defaultValue string. #1100</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1100-b2111058-pre-release","title":"v1.10.0-B2111058 (pre-release)","text":"<p>What's changed since pre-release v1.10.0-B2111040:</p> <ul> <li>New rules:<ul> <li>Event Grid:<ul> <li>Check topics and domains use managed identities. #1091</li> <li>Check topics and domains use private endpoints. #1092</li> <li>Check topics and domains use identity-based authentication. #1093</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Updated default baseline to use module configuration. #1089</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v1100-b2111040-pre-release","title":"v1.10.0-B2111040 (pre-release)","text":"<p>What's changed since v1.9.1:</p> <ul> <li>New features:<ul> <li>Added support for parameter strong types. #1083<ul> <li>The value of string parameters can be tested against the expected type.</li> <li>When configuring a location strong type, the parameter value must be a valid Azure location.</li> <li>When configuring a resource type strong type, the parameter value must be a matching resource Id.</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.9.0. #1081</li> <li>Bump Microsoft.CodeAnalysis.NetAnalyzers to v6.0.0. #1080</li> <li>Bump Microsoft.SourceLink.GitHub to 1.1.1. #1085</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v191","title":"v1.9.1","text":"<p>What's changed since v1.9.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed can not index into resource group tags. #1066</li> <li>Fixed <code>Azure.VM.ASMinMembers</code> for template deployments. #1064</li> <li>Fixed zones property not found on public IP resource. #1070</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v190","title":"v1.9.0","text":"<p>What's changed since v1.8.1:</p> <ul> <li>New rules:<ul> <li>API Management Service:<ul> <li>Check API management services are using availability zones when available. #1017</li> </ul> </li> <li>Public IP Address:<ul> <li>Check Public IP addresses are configured with zone-redundancy. #958</li> <li>Check Public IP addresses are using Standard SKU. #979</li> </ul> </li> <li>User Assigned Managed Identity:<ul> <li>Check identities meet naming requirements. #1021</li> </ul> </li> <li>Virtual Network Gateway:<ul> <li>Check VPN/ExpressRoute gateways are configured with availability zone SKU. #926</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Improved processing of AzOps generated templates. #799<ul> <li><code>Azure.Template.DefineParameters</code> is ignored for AzOps generated templates.</li> <li><code>Azure.Template.UseLocationParameter</code> is ignored for AzOps generated templates.</li> </ul> </li> <li>Bicep is now installed when using PSRule GitHub Action. #1050</li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.8.0. #1018</li> <li>Added automated PR workflow to bump <code>providers.json</code> monthly. #1041</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed AKS Network Policy should accept calico. #1046</li> <li>Fixed <code>Azure.ACR.AdminUser</code> fails when <code>adminUserEnabled</code> not set. #1014</li> <li>Fixed <code>Azure.KeyVault.Logs</code> reports cannot index into a null array. #1024</li> <li>Fixed template function empty returns object reference not set exception. #1025</li> <li>Fixed delayed binding of <code>and</code> template function. #1026</li> <li>Fixed template function array nests array with array parameters. #1027</li> <li>Fixed property used by <code>Azure.ACR.MinSKU</code> to work more reliably with templates. #1034</li> <li>Fixed could not determine JSON object type for MockMember using CreateObject. #1035</li> <li>Fixed Bicep convention ordering. #1053</li> </ul> </li> </ul> <p>What's changed since pre-release v1.9.0-B2110087:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v190-b2110087-pre-release","title":"v1.9.0-B2110087 (pre-release)","text":"<p>What's changed since pre-release v1.9.0-B2110082:</p> <ul> <li>Bug fixes:<ul> <li>Fixed Bicep convention ordering. #1053</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v190-b2110082-pre-release","title":"v1.9.0-B2110082 (pre-release)","text":"<p>What's changed since pre-release v1.9.0-B2110059:</p> <ul> <li>General improvements:<ul> <li>Bicep is now installed when using PSRule GitHub Action. #1050</li> </ul> </li> <li>Engineering:<ul> <li>Added automated PR workflow to bump <code>providers.json</code> monthly. #1041</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed AKS Network Policy should accept calico. #1046</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v190-b2110059-pre-release","title":"v1.9.0-B2110059 (pre-release)","text":"<p>What's changed since pre-release v1.9.0-B2110040:</p> <ul> <li>New rules:<ul> <li>API Management Service:<ul> <li>Check API management services are using availability zones when available. #1017</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed property used by <code>Azure.ACR.MinSKU</code> to work more reliably with templates. #1034</li> <li>Fixed could not determine JSON object type for MockMember using CreateObject. #1035</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v190-b2110040-pre-release","title":"v1.9.0-B2110040 (pre-release)","text":"<p>What's changed since pre-release v1.9.0-B2110025:</p> <ul> <li>New rules:<ul> <li>User Assigned Managed Identity:<ul> <li>Check identities meet naming requirements. #1021</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Azure.KeyVault.Logs</code> reports cannot index into a null array. #1024</li> <li>Fixed template function empty returns object reference not set exception. #1025</li> <li>Fixed delayed binding of <code>and</code> template function. #1026</li> <li>Fixed template function array nests array with array parameters. #1027</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v190-b2110025-pre-release","title":"v1.9.0-B2110025 (pre-release)","text":"<p>What's changed since pre-release v1.9.0-B2110014:</p> <ul> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.8.0. #1018</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Azure.ACR.AdminUser</code> fails when <code>adminUserEnabled</code> not set. #1014</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v190-b2110014-pre-release","title":"v1.9.0-B2110014 (pre-release)","text":"<p>What's changed since pre-release v1.9.0-B2110009:</p> <ul> <li>Bug fixes:<ul> <li>Fixed expression out of range of valid values. #1005</li> <li>Fixed template expand fails in nested reference expansion. #1007</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v190-b2110009-pre-release","title":"v1.9.0-B2110009 (pre-release)","text":"<p>What's changed since pre-release v1.9.0-B2109027:</p> <ul> <li>Bug fixes:<ul> <li>Fixed handling of comments with template and parameter file rules. #996</li> <li>Fixed <code>Azure.Template.UseLocationParameter</code> to only apply to templates deployed as RG scope #995</li> <li>Fixed expand template fails with <code>createObject</code> when no parameters are specified. #1000</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v190-b2109027-pre-release","title":"v1.9.0-B2109027 (pre-release)","text":"<p>What's changed since v1.8.0:</p> <ul> <li>New rules:<ul> <li>Public IP Address:<ul> <li>Check Public IP addresses are configured with zone-redundancy. #958</li> <li>Check Public IP addresses are using Standard SKU. #979</li> </ul> </li> <li>Virtual Network Gateway:<ul> <li>Check VPN/ExpressRoute gateways are configured with availability zone SKU. #926</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Improved processing of AzOps generated templates. #799<ul> <li><code>Azure.Template.DefineParameters</code> is ignored for AzOps generated templates.</li> <li><code>Azure.Template.UseLocationParameter</code> is ignored for AzOps generated templates.</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>ToUpper</code> fails to convert character. #986</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v181","title":"v1.8.1","text":"<p>What's changed since v1.8.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed handling of comments with template and parameter file rules. #996</li> <li>Fixed <code>Azure.Template.UseLocationParameter</code> to only apply to templates deployed as RG scope #995</li> <li>Fixed expand template fails with <code>createObject</code> when no parameters are specified. #1000</li> <li>Fixed <code>ToUpper</code> fails to convert character. #986</li> <li>Fixed expression out of range of valid values. #1005</li> <li>Fixed template expand fails in nested reference expansion. #1007</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v180","title":"v1.8.0","text":"<p>What's changed since v1.7.0:</p> <ul> <li>New features:<ul> <li>Added <code>Azure.GA_2021_09</code> baseline.   #961<ul> <li>Includes rules released before or during September 2021 for Azure GA features.</li> <li>Marked baseline <code>Azure.GA_2021_06</code> as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Application Gateway:<ul> <li>Check App Gateways should use availability zones when available by @ArmaanMcleod.   #928</li> </ul> </li> <li>Azure Kubernetes Service:<ul> <li>Check clusters have control plane audit logs enabled by @ArmaanMcleod.   #882</li> <li>Check clusters have control plane diagnostics enabled by @ArmaanMcleod.   #922</li> <li>Check clusters use Container Insights for monitoring workloads by @ArmaanMcleod.   #881</li> <li>Check clusters use availability zones when available by @ArmaanMcleod.   #880</li> </ul> </li> <li>Cosmos DB:<ul> <li>Check DB account names meet naming requirements.   #954</li> <li>Check DB accounts use Azure AD identities for resource management operations.   #953</li> </ul> </li> <li>Load Balancer:<ul> <li>Check Load balancers are using Standard SKU by @ArmaanMcleod.   #957</li> <li>Check Load Balancers are configured with zone-redundancy by @ArmaanMcleod.   #927</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.7.2.   #951</li> <li>Automated update of availability zone information in providers.json.   #907</li> <li>Increased test coverage of rule reasons by @ArmaanMcleod.   #960</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed export of in-flight AKS related subnets for kubenet clusters by @ArmaanMcleod.   #920</li> <li>Fixed plan instance count is not applicable to Elastic Premium plans.   #946</li> <li>Fixed minimum App Service Plan fails Elastic Premium plans.   #945</li> <li>Fixed App Service Plan should include PremiumV3 plan.   #944</li> <li>Fixed Azure.VM.NICAttached with private endpoints.   #932</li> <li>Fixed Bicep CLI fails with unexpected end of content.   #889</li> <li>Fixed incomplete reason message for <code>Azure.Storage.MinTLS</code>.   #971</li> <li>Fixed false positive of <code>Azure.Storage.UseReplication</code> with large file storage.   #965</li> </ul> </li> </ul> <p>What's changed since pre-release v1.8.0-B2109060:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v180-b2109086-pre-release","title":"v1.8.0-B2109086 (pre-release)","text":"<p>What's changed since pre-release v1.8.0-B2109060:</p> <ul> <li>New rules:<ul> <li>Load Balancer:<ul> <li>Check Load balancers are using Standard SKU. by @ArmaanMcleod.   #957</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Increased test coverage of rule reasons. by @ArmaanMcleod.   #960</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed Bicep CLI fails with unexpected end of content.   #889</li> <li>Fixed incomplete reason message for <code>Azure.Storage.MinTLS</code>.   #971</li> <li>Fixed false positive of <code>Azure.Storage.UseReplication</code> with large file storage.   #965</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v180-b2109060-pre-release","title":"v1.8.0-B2109060 (pre-release)","text":"<p>What's changed since pre-release v1.8.0-B2109046:</p> <ul> <li>New features:<ul> <li>Added <code>Azure.GA_2021_09</code> baseline.   #961<ul> <li>Includes rules released before or during September 2021 for Azure GA features.</li> <li>Marked baseline <code>Azure.GA_2021_06</code> as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Load Balancer:<ul> <li>Check Load Balancers are configured with zone-redundancy by @ArmaanMcleod.   #927</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v180-b2109046-pre-release","title":"v1.8.0-B2109046 (pre-release)","text":"<p>What's changed since pre-release v1.8.0-B2109020:</p> <ul> <li>New rules:<ul> <li>Application Gateway:<ul> <li>Check App Gateways should use availability zones when available by @ArmaanMcleod #928</li> </ul> </li> <li>Cosmos DB:<ul> <li>Check DB account names meet naming requirements.   #954</li> <li>Check DB accounts use Azure AD identities for resource management operations.   #953</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed plan instance count is not applicable to Elastic Premium plans.   #946</li> <li>Fixed minimum App Service Plan fails Elastic Premium plans.   #945</li> <li>Fixed App Service Plan should include PremiumV3 plan.   #944</li> <li>Fixed Azure.VM.NICAttached with private endpoints.   #932</li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.7.2.   #951</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v180-b2109020-pre-release","title":"v1.8.0-B2109020 (pre-release)","text":"<p>What's changed since pre-release v1.8.0-B2108026:</p> <ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check clusters have control plane audit logs enabled by @ArmaanMcleod.   #882</li> <li>Check clusters have control plane diagnostics enabled by @ArmaanMcleod.   #922</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.7.0.   #938</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v180-b2108026-pre-release","title":"v1.8.0-B2108026 (pre-release)","text":"<p>What's changed since pre-release v1.8.0-B2108013:</p> <ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check clusters use Container Insights for monitoring workloads by @ArmaanMcleod.   #881</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed export of in-flight AKS related subnets for kubenet clusters by @ArmaanMcleod.   #920</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v180-b2108013-pre-release","title":"v1.8.0-B2108013 (pre-release)","text":"<p>What's changed since v1.7.0:</p> <ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check clusters use availability zones when available by @ArmaanMcleod.   #880</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.6.1.   #913</li> <li>Automated update of availability zone information in providers.json.   #907</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v170","title":"v1.7.0","text":"<p>What's changed since v1.6.0:</p> <ul> <li>New rules:<ul> <li>All resources:<ul> <li>Check template parameter files use metadata links. #846<ul> <li>Configure the <code>AZURE_PARAMETER_FILE_METADATA_LINK</code> option to enable this rule.</li> </ul> </li> <li>Check template files use a recent schema. #845</li> <li>Check template files use a https schema scheme. #894</li> <li>Check template parameter files use a https schema scheme. #894</li> <li>Check template parameters set a value. #896</li> <li>Check template parameters use a valid secret reference. #897</li> </ul> </li> <li>Azure Kubernetes Service:<ul> <li>Check clusters using Azure CNI should use large subnets by @ArmaanMcleod. #273</li> <li>Check clusters use auto-scale node pools by @ArmaanMcleod. #218<ul> <li>By default, a minimum of a <code>/23</code> subnet is required.</li> <li>Configure <code>AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE</code> to change the default minimum subnet size.</li> </ul> </li> </ul> </li> <li>Storage Account:<ul> <li>Check Storage Accounts only accept explicitly allowed network traffic. #884</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Virtual Network:<ul> <li>Excluded <code>AzureFirewallManagementSubnet</code> from <code>Azure.VNET.UseNSGs</code>. #869</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added version information to bicep compilation exceptions. #903</li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.6.0. #871</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed DateTimeAdd function and tests within timezones with DST. #891</li> <li>Fixed <code>Azure.Template.ParameterValue</code> failing on empty value. #901</li> </ul> </li> </ul> <p>What's changed since pre-release v1.7.0-B2108059:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v170-b2108059-pre-release","title":"v1.7.0-B2108059 (pre-release)","text":"<p>What's changed since pre-release v1.7.0-B2108049:</p> <ul> <li>General improvements:<ul> <li>Added version information to bicep compilation exceptions. #903</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Azure.Template.ParameterValue</code> failing on empty value. #901</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v170-b2108049-pre-release","title":"v1.7.0-B2108049 (pre-release)","text":"<p>What's changed since pre-release v1.7.0-B2108040:</p> <ul> <li>New rules:<ul> <li>All resources:<ul> <li>Check template files use a recent schema. #845</li> <li>Check template files use a https schema scheme. #894</li> <li>Check template parameter files use a https schema scheme. #894</li> <li>Check template parameters set a value. #896</li> <li>Check template parameters use a valid secret reference. #897</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed DateTimeAdd function and tests within timezones with DST. #891</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v170-b2108040-pre-release","title":"v1.7.0-B2108040 (pre-release)","text":"<p>What's changed since pre-release v1.7.0-B2108020:</p> <ul> <li>New rules:<ul> <li>All resources:<ul> <li>Check template parameter files use metadata links. #846<ul> <li>Configure the <code>AZURE_PARAMETER_FILE_METADATA_LINK</code> option to enable this rule.</li> </ul> </li> </ul> </li> <li>Azure Kubernetes Service:<ul> <li>Check clusters using Azure CNI should use large subnets by @ArmaanMcleod. #273<ul> <li>By default, a minimum of a <code>/23</code> subnet is required.</li> <li>Configure <code>AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE</code> to change the default minimum subnet size.</li> </ul> </li> </ul> </li> <li>Storage Account:<ul> <li>Check Storage Accounts only accept explicitly allowed network traffic. #884</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v170-b2108020-pre-release","title":"v1.7.0-B2108020 (pre-release)","text":"<p>What's changed since v1.6.0:</p> <ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check clusters use auto-scale node pools by @ArmaanMcleod. #218</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Virtual Network:<ul> <li>Excluded <code>AzureFirewallManagementSubnet</code> from <code>Azure.VNET.UseNSGs</code>. #869</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.6.0. #871</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v160","title":"v1.6.0","text":"<p>What's changed since v1.5.1:</p> <ul> <li>New features:<ul> <li>Experimental: Added support for expansion from Bicep source files.   #848 #670 #858<ul> <li>Bicep support is currently experimental.</li> <li>To opt-in set the <code>AZURE_BICEP_FILE_EXPANSION</code> configuration to <code>true</code>.</li> <li>For more information see Using Bicep.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Application Gateways:<ul> <li>Check Application Gateways publish endpoints by HTTPS.   #841</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.5.0.   #832</li> <li>Migration of Pester v4 tests to Pester v5 by @ArmaanMcleod.   #395</li> </ul> </li> </ul> <p>What's changed since pre-release v1.6.0-B2108038:</p> <ul> <li>Bug fixes:<ul> <li>Fixed Bicep expand creates deadlock and times out.   #863</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v160-b2108038-pre-release","title":"v1.6.0-B2108038 (pre-release)","text":"<p>What's changed since pre-release v1.6.0-B2108023:</p> <ul> <li>Bug fixes:<ul> <li>Fixed Bicep expand hangs analysis.   #858</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v160-b2108023-pre-release","title":"v1.6.0-B2108023 (pre-release)","text":"<p>What's changed since pre-release v1.6.0-B2107028:</p> <ul> <li>New features:<ul> <li>Experimental: Added support for expansion from Bicep source files.   #848 #670<ul> <li>Bicep support is currently experimental.</li> <li>To opt-in set the <code>AZURE_BICEP_FILE_EXPANSION</code> configuration to <code>true</code>.</li> <li>For more information see Using Bicep.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v160-b2107028-pre-release","title":"v1.6.0-B2107028 (pre-release)","text":"<p>What's changed since v1.5.1:</p> <ul> <li>New rules:<ul> <li>Application Gateways:<ul> <li>Check Application Gateways publish endpoints by HTTPS. #841</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.5.0. #832</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v151","title":"v1.5.1","text":"<p>What's changed since v1.5.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed rule does not detect more restrictive NSG rules. #831</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v150","title":"v1.5.0","text":"<p>What's changed since v1.4.1:</p> <ul> <li>New features:<ul> <li>Added <code>Azure.GA_2021_06</code> baseline. #822<ul> <li>Includes rules released before or during June 2021 for Azure GA features.</li> <li>Marked baseline <code>Azure.GA_2021_03</code> as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Application Insights:<ul> <li>Check App Insights resources use workspace-based configuration. #813</li> <li>Check App Insights resources meet naming requirements. #814</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Exclude not applicable rules for templates generated with Bicep and PSArm. #815</li> <li>Updated rule help to use docs pages for online version. #824</li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.4.0. #823</li> <li>Bump YamlDotNet dependency to v11.2.1. #821</li> <li>Migrate project to Azure GitHub organization and updated links. #800</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed detection of parameters and variables with line breaks. #811</li> </ul> </li> </ul> <p>What's changed since pre-release v1.5.0-B2107002:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v150-b2107002-pre-release","title":"v1.5.0-B2107002 (pre-release)","text":"<p>What's changed since pre-release v1.5.0-B2106018:</p> <ul> <li>New features:<ul> <li>Added <code>Azure.GA_2021_06</code> baseline. #822<ul> <li>Includes rules released before or during June 2021 for Azure GA features.</li> <li>Marked baseline <code>Azure.GA_2021_03</code> as obsolete.</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Updated rule help to use docs pages for online version. #824</li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.4.0. #823</li> <li>Bump YamlDotNet dependency to v11.2.1. #821</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v150-b2106018-pre-release","title":"v1.5.0-B2106018 (pre-release)","text":"<p>What's changed since v1.4.1:</p> <ul> <li>New rules:<ul> <li>Application Insights:<ul> <li>Check App Insights resources use workspace-based configuration. #813</li> <li>Check App Insights resources meet naming requirements. #814</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Exclude not applicable rules for templates generated with Bicep and PSArm. #815</li> </ul> </li> <li>Engineering:<ul> <li>Bump YamlDotNet dependency to v11.2.0. #801</li> <li>Migrate project to Azure GitHub organization and updated links. #800</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed detection of parameters and variables with line breaks. #811</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v141","title":"v1.4.1","text":"<p>What's changed since v1.4.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed boolean string conversion case. #793</li> <li>Fixed case sensitive property matching. #794</li> <li>Fixed automatic expansion of template parameter files. #796<ul> <li>Template parameter files are not automatically expanded by default.</li> <li>To enable this, set the <code>AZURE_PARAMETER_FILE_EXPANSION</code> configuration option.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v140","title":"v1.4.0","text":"<p>What's changed since v1.3.2:</p> <ul> <li>New features:<ul> <li>Automatically expand template from parameter files for analysis. #772<ul> <li>Previously templates needed to be exported with <code>Export-AzRuleTemplateData</code>.</li> <li>To export template data automatically use PSRule cmdlets with <code>-Format File</code>.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Cognitive Search:<ul> <li>Check search services meet index SLA replica requirement. #761</li> <li>Check search services meet query SLA replica requirement. #762</li> <li>Check search services meet naming requirements. #763</li> <li>Check search services use a minimum SKU. #764</li> <li>Check search services use managed identities. #765</li> </ul> </li> <li>Azure Kubernetes Service:<ul> <li>Check clusters use AKS-managed Azure AD integration. #436</li> <li>Check clusters have local account disabled (preview). #786</li> <li>Check clusters have an auto-upgrade channel set (preview). #787</li> <li>Check clusters limit access network access to the API server. #788</li> <li>Check clusters used Azure RBAC for Kubernetes authorization. #789</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.20.5. #767</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Automatically nest template sub-resources for analysis. #746<ul> <li>Sub-resources such as diagnostic logs or configurations are automatically nested.</li> <li>Automatic nesting a resource requires:<ul> <li>The parent resource is defined in the same template.</li> <li>The sub-resource depends on the parent resource.</li> </ul> </li> </ul> </li> <li>Added support for source location references to template files. #781<ul> <li>Output includes source location to resources exported from a templates.</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed string index parsing in expressions with whitespace. #775</li> <li>Fixed base for DateTimeAdd is not a valid string. #777</li> </ul> </li> <li>Engineering:<ul> <li>Added source link to project. #783</li> </ul> </li> </ul> <p>What's changed since pre-release v1.4.0-B2105057:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v140-b2105057-pre-release","title":"v1.4.0-B2105057 (pre-release)","text":"<p>What's changed since pre-release v1.4.0-B2105050:</p> <ul> <li>New rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Check clusters use AKS-managed Azure AD integration. #436</li> <li>Check clusters have local account disabled (preview). #786</li> <li>Check clusters have an auto-upgrade channel set (preview). #787</li> <li>Check clusters limit access network access to the API server. #788</li> <li>Check clusters used Azure RBAC for Kubernetes authorization. #789</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.20.5. #767</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Added source link to project. #783</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v140-b2105050-pre-release","title":"v1.4.0-B2105050 (pre-release)","text":"<p>What's changed since pre-release v1.4.0-B2105044:</p> <ul> <li>General improvements:<ul> <li>Added support for source location references to template files. #781<ul> <li>Output includes source location to resources exported from a templates.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v140-b2105044-pre-release","title":"v1.4.0-B2105044 (pre-release)","text":"<p>What's changed since pre-release v1.4.0-B2105027:</p> <ul> <li>New features:<ul> <li>Automatically expand template from parameter files for analysis. #772<ul> <li>Previously templates needed to be exported with <code>Export-AzRuleTemplateData</code>.</li> <li>To export template data automatically use PSRule cmdlets with <code>-Format File</code>.</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed string index parsing in expressions with whitespace. #775</li> <li>Fixed base for DateTimeAdd is not a valid string. #777</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v140-b2105027-pre-release","title":"v1.4.0-B2105027 (pre-release)","text":"<p>What's changed since pre-release v1.4.0-B2105020:</p> <ul> <li>New rules:<ul> <li>Cognitive Search:<ul> <li>Check search services meet index SLA replica requirement. #761</li> <li>Check search services meet query SLA replica requirement. #762</li> <li>Check search services meet naming requirements. #763</li> <li>Check search services use a minimum SKU. #764</li> <li>Check search services use managed identities. #765</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v140-b2105020-pre-release","title":"v1.4.0-B2105020 (pre-release)","text":"<p>What's changed since v1.3.2:</p> <ul> <li>General improvements:<ul> <li>Automatically nest template sub-resources for analysis. #746<ul> <li>Sub-resources such as diagnostic logs or configurations are automatically nested.</li> <li>Automatic nesting a resource requires:<ul> <li>The parent resource is defined in the same template.</li> <li>The sub-resource depends on the parent resource.</li> </ul> </li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v132","title":"v1.3.2","text":"<p>What's changed since v1.3.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed rule reason reported the parameter inputObject is null. #753</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v131","title":"v1.3.1","text":"<p>What's changed since v1.3.0:</p> <ul> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.3.0. #749</li> <li>Bump YamlDotNet dependency to v11.1.1. #742</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v130","title":"v1.3.0","text":"<p>What's changed since v1.2.1:</p> <ul> <li>New rules:<ul> <li>Policy:<ul> <li>Check policy assignment display name and description are set. #725</li> <li>Check policy assignment assigned by metadata is set. #726</li> <li>Check policy exemption display name and description are set. #723</li> <li>Check policy waiver exemptions have an expiry date set. #724</li> </ul> </li> </ul> </li> <li>Removed rules:<ul> <li>Storage:<ul> <li>Remove <code>Azure.Storage.UseEncryption</code> as Storage Service Encryption (SSE) is always on. #630<ul> <li>SSE is on by default and can not be disabled.</li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Additional metadata added in parameter files is passed through with <code>Get-AzRuleTemplateLink</code>. #706</li> <li>Improved binding support for File inputs. #480<ul> <li>Template and parameter file names now return a relative path instead of full path.</li> </ul> </li> <li>Added API version for each module resource. #729</li> </ul> </li> <li>Engineering:<ul> <li>Clean up depreciated warning message for configuration option <code>azureAllowedRegions</code>. #737</li> <li>Clean up depreciated warning message for configuration option <code>minAKSVersion</code>. #738</li> <li>Bump PSRule dependency to v1.2.0. #713</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed could not load file or assembly YamlDotNet. #741<ul> <li>This fix pins the PSRule version to v1.2.0 until the next stable release of PSRule for Azure.</li> </ul> </li> </ul> </li> </ul> <p>What's changed since pre-release v1.3.0-B2104040:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v130-b2104040-pre-release","title":"v1.3.0-B2104040 (pre-release)","text":"<p>What's changed since pre-release v1.3.0-B2104034:</p> <ul> <li>Bug fixes:<ul> <li>Fixed could not load file or assembly YamlDotNet. #741<ul> <li>This fix pins the PSRule version to v1.2.0 until the next stable release of PSRule for Azure.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v130-b2104034-pre-release","title":"v1.3.0-B2104034 (pre-release)","text":"<p>What's changed since pre-release v1.3.0-B2104023:</p> <ul> <li>New rules:<ul> <li>Policy:<ul> <li>Check policy assignment display name and description are set. #725</li> <li>Check policy assignment assigned by metadata is set. #726</li> <li>Check policy exemption display name and description are set. #723</li> <li>Check policy waiver exemptions have an expiry date set. #724</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Clean up depreciated warning message for configuration option <code>azureAllowedRegions</code>. #737</li> <li>Clean up depreciated warning message for configuration option <code>minAKSVersion</code>. #738</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v130-b2104023-pre-release","title":"v1.3.0-B2104023 (pre-release)","text":"<p>What's changed since pre-release v1.3.0-B2104013:</p> <ul> <li>General improvements:<ul> <li>Improved binding support for File inputs. #480<ul> <li>Template and parameter file names now return a relative path instead of full path.</li> </ul> </li> <li>Added API version for each module resource. #729</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v130-b2104013-pre-release","title":"v1.3.0-B2104013 (pre-release)","text":"<p>What's changed since pre-release v1.3.0-B2103007:</p> <ul> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.2.0. #713</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed export not expanding nested deployments. #715</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v130-b2103007-pre-release","title":"v1.3.0-B2103007 (pre-release)","text":"<p>What's changed since v1.2.0:</p> <ul> <li>Removed rules:<ul> <li>Storage:<ul> <li>Remove <code>Azure.Storage.UseEncryption</code> as Storage Service Encryption (SSE) is always on. #630<ul> <li>SSE is on by default and can not be disabled.</li> </ul> </li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Additional metadata added in parameter files is passed through with <code>Get-AzRuleTemplateLink</code>. #706</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v121","title":"v1.2.1","text":"<p>What's changed since v1.2.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed export not expanding nested deployments. #715</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v120","title":"v1.2.0","text":"<p>What's changed since v1.1.4:</p> <ul> <li>New features:<ul> <li>Added <code>Azure.GA_2021_03</code> baseline. #673<ul> <li>Includes rules released before or during March 2021 for Azure GA features.</li> <li>Marked baseline <code>Azure.GA_2020_12</code> as obsolete.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>Key Vault:<ul> <li>Check vaults, keys, and secrets meet name requirements. #646</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.19.7. #696</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for user defined functions in templates. #682</li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.1.0. #692</li> </ul> </li> </ul> <p>What's changed since pre-release v1.2.0-B2103044:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v120-b2103044-pre-release","title":"v1.2.0-B2103044 (pre-release)","text":"<p>What's changed since pre-release v1.2.0-B2103032:</p> <ul> <li>New features:<ul> <li>Added <code>Azure.GA_2021_03</code> baseline. #673<ul> <li>Includes rules released before or during March 2021 for Azure GA features.</li> <li>Marked baseline <code>Azure.GA_2020_12</code> as obsolete.</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.19.7. #696</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v120-b2103032-pre-release","title":"v1.2.0-B2103032 (pre-release)","text":"<p>What's changed since pre-release v1.2.0-B2103024:</p> <ul> <li>New rules:<ul> <li>Key Vault:<ul> <li>Check vaults, keys, and secrets meet name requirements. #646</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.1.0. #692</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v120-b2103024-pre-release","title":"v1.2.0-B2103024 (pre-release)","text":"<p>What's changed since v1.1.4:</p> <ul> <li>General improvements:<ul> <li>Added support for user defined functions in templates. #682</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v114","title":"v1.1.4","text":"<p>What's changed since v1.1.3:</p> <ul> <li>Bug fixes:<ul> <li>Fixed handling of literal index with copyIndex function. #686</li> <li>Fixed handling of inner scoped nested deployments. #687</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v113","title":"v1.1.3","text":"<p>What's changed since v1.1.2:</p> <ul> <li>Bug fixes:<ul> <li>Fixed parsing of property names for functions across multiple lines. #683</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v112","title":"v1.1.2","text":"<p>What's changed since v1.1.1:</p> <ul> <li>Bug fixes:<ul> <li>Fixed copy peer property resolve. #677</li> <li>Fixed partial resource group or subscription object not populating. #678</li> <li>Fixed lazy loading of environment and resource providers. #679</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v111","title":"v1.1.1","text":"<p>What's changed since v1.1.0:</p> <ul> <li>Bug fixes:<ul> <li>Fixed support for parameter file schemas. #674</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v110","title":"v1.1.0","text":"<p>What's changed since v1.0.0:</p> <ul> <li>New features:<ul> <li>Exporting template with <code>Export-AzRuleTemplateData</code> supports custom resource group and subscription. #651<ul> <li>Subscription and resource group used for deployment can be specified instead of using defaults.</li> <li><code>ResourceGroupName</code> parameter of <code>Export-AzRuleTemplateData</code> has been renamed to <code>ResourceGroup</code>.</li> <li>Added a parameter alias for <code>ResourceGroupName</code> on <code>Export-AzRuleTemplateData</code>.</li> </ul> </li> </ul> </li> <li>New rules:<ul> <li>All resources:<ul> <li>Check template parameters are defined. #631</li> <li>Check location parameter is type string. #632</li> <li>Check template parameter <code>minValue</code> and <code>maxValue</code> constraints are valid. #637</li> <li>Check template resources do not use hard coded locations. #633</li> <li>Check resource group location not referenced instead of location parameter. #634</li> <li>Check increased debug detail is disabled for nested deployments. #638</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for matching template by name. #661<ul> <li><code>Get-AzRuleTemplateLink</code> discovers <code>&lt;templateName&gt;.json</code> from <code>&lt;templateName&gt;.parameters.json</code>.</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.0.3. #648</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Azure.VM.ADE</code> to limit rule to exports only. #644</li> <li>Fixed <code>if</code> condition values evaluation order. #652</li> <li>Fixed handling of <code>int</code> parameters with large values. #653</li> <li>Fixed handling of expressions split over multiple lines. #654</li> <li>Fixed handling of bool parameter values within logical expressions. #655</li> <li>Fixed copy loop value does not fall within the expected range. #664</li> <li>Fixed template comparison functions handling of large integer values. #666</li> <li>Fixed handling of <code>createArray</code> function with no arguments. #667</li> </ul> </li> </ul> <p>What's changed since pre-release v1.1.0-B2102034:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v110-b2102034-pre-release","title":"v1.1.0-B2102034 (pre-release)","text":"<p>What's changed since pre-release v1.1.0-B2102023:</p> <ul> <li>General improvements:<ul> <li>Added support for matching template by name. #661<ul> <li><code>Get-AzRuleTemplateLink</code> discovers <code>&lt;templateName&gt;.json</code> from <code>&lt;templateName&gt;.parameters.json</code>.</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed copy loop value does not fall within the expected range. #664</li> <li>Fixed template comparison functions handling of large integer values. #666</li> <li>Fixed handling of <code>createArray</code> function with no arguments. #667</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v110-b2102023-pre-release","title":"v1.1.0-B2102023 (pre-release)","text":"<p>What's changed since pre-release v1.1.0-B2102015:</p> <ul> <li>New features:<ul> <li>Exporting template with <code>Export-AzRuleTemplateData</code> supports custom resource group and subscription. #651<ul> <li>Subscription and resource group used for deployment can be specified instead of using defaults.</li> <li><code>ResourceGroupName</code> parameter of <code>Export-AzRuleTemplateData</code> has been renamed to <code>ResourceGroup</code>.</li> <li>Added a parameter alias for <code>ResourceGroupName</code> on <code>Export-AzRuleTemplateData</code>.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v110-b2102015-pre-release","title":"v1.1.0-B2102015 (pre-release)","text":"<p>What's changed since pre-release v1.1.0-B2102010:</p> <ul> <li>Bug fixes:<ul> <li>Fixed <code>if</code> condition values evaluation order. #652</li> <li>Fixed handling of <code>int</code> parameters with large values. #653</li> <li>Fixed handling of expressions split over multiple lines. #654</li> <li>Fixed handling of bool parameter values within logical expressions. #655</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v110-b2102010-pre-release","title":"v1.1.0-B2102010 (pre-release)","text":"<p>What's changed since pre-release v1.1.0-B2102001:</p> <ul> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.0.3. #648</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed <code>Azure.VM.ADE</code> to limit rule to exports only. #644</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v110-b2102001-pre-release","title":"v1.1.0-B2102001 (pre-release)","text":"<p>What's changed since v1.0.0:</p> <ul> <li>New rules:<ul> <li>All resources:<ul> <li>Check template parameters are defined. #631</li> <li>Check location parameter is type string. #632</li> <li>Check template parameter <code>minValue</code> and <code>maxValue</code> constraints are valid. #637</li> <li>Check template resources do not use hard coded locations. #633</li> <li>Check resource group location not referenced instead of location parameter. #634</li> <li>Check increased debug detail is disabled for nested deployments. #638</li> </ul> </li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.0.2. #635</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v100","title":"v1.0.0","text":"<p>What's changed since v0.19.0:</p> <ul> <li>New rules:<ul> <li>All resources:<ul> <li>Check parameter default value type matches type. #311</li> <li>Check location parameter defaults to resource group. #361</li> </ul> </li> <li>Front Door:<ul> <li>Check Front Door uses a health probe for each backend pool. #546</li> <li>Check Front Door uses a dedicated health probe path backend pools. #547</li> <li>Check Front Door uses HEAD requests for backend health probes. #613</li> </ul> </li> <li>Service Fabric:<ul> <li>Check Service Fabric clusters use AAD client authentication. #619</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.19.6. #603</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Renamed <code>Export-AzTemplateRuleData</code> to <code>Export-AzRuleTemplateData</code>. #596<ul> <li>New name <code>Export-AzRuleTemplateData</code> aligns with prefix of other cmdlets.</li> <li>Use of <code>Export-AzTemplateRuleData</code> is now deprecated and will be removed in the next major version.</li> <li>Added alias to allow <code>Export-AzTemplateRuleData</code> to continue to be used.</li> <li>Using <code>Export-AzTemplateRuleData</code> returns a deprecation warning.</li> </ul> </li> <li>Added support for <code>environment</code> template function. #517</li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.0.1. #611</li> </ul> </li> </ul> <p>What's changed since pre-release v1.0.0-B2101028:</p> <ul> <li>No additional changes.</li> </ul>"},{"location":"CHANGELOG-v1/#v100-b2101028-pre-release","title":"v1.0.0-B2101028 (pre-release)","text":"<p>What's changed since pre-release v1.0.0-B2101016:</p> <ul> <li>New rules:<ul> <li>All resources:<ul> <li>Check parameter default value type matches type. #311</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Renamed <code>Export-AzTemplateRuleData</code> to <code>Export-AzRuleTemplateData</code>. #596<ul> <li>New name <code>Export-AzRuleTemplateData</code> aligns with prefix of other cmdlets.</li> <li>Use of <code>Export-AzTemplateRuleData</code> is now deprecated and will be removed in the next major version.</li> <li>Added alias to allow <code>Export-AzTemplateRuleData</code> to continue to be used.</li> <li>Using <code>Export-AzTemplateRuleData</code> returns a deprecation warning.</li> </ul> </li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v100-b2101016-pre-release","title":"v1.0.0-B2101016 (pre-release)","text":"<p>What's changed since pre-release v1.0.0-B2101006:</p> <ul> <li>New rules:<ul> <li>Service Fabric:<ul> <li>Check Service Fabric clusters use AAD client authentication. #619</li> </ul> </li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed reason <code>Azure.FrontDoor.ProbePath</code> so the probe name is included. #617</li> </ul> </li> </ul>"},{"location":"CHANGELOG-v1/#v100-b2101006-pre-release","title":"v1.0.0-B2101006 (pre-release)","text":"<p>What's changed since v0.19.0:</p> <ul> <li>New rules:<ul> <li>All resources:<ul> <li>Check location parameter defaults to resource group. #361</li> </ul> </li> <li>Front Door:<ul> <li>Check Front Door uses a health probe for each backend pool. #546</li> <li>Check Front Door uses a dedicated health probe path backend pools. #547</li> <li>Check Front Door uses HEAD requests for backend health probes. #613</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Azure Kubernetes Service:<ul> <li>Updated <code>Azure.AKS.Version</code> to 1.19.6. #603</li> </ul> </li> </ul> </li> <li>General improvements:<ul> <li>Added support for <code>environment</code> template function. #517</li> </ul> </li> <li>Engineering:<ul> <li>Bump PSRule dependency to v1.0.1. #611</li> </ul> </li> <li>Redis Cache Enterprise<ul> <li>Check Redis Cache Enterprise uses minimum TLS 1.2 1179</li> </ul> </li> </ul>"},{"location":"about/","title":"What is PSRule for Azure?","text":"<p>PSRule for Azure is a pre-built set of tests and documentation to help you configure Azure solutions. These tests allow you to check your Infrastructure as Code (IaC) before or after deployment to Azure. PSRule for Azure includes unit tests that check how Azure resources defined in ARM templates or Bicep code are configured.</p>"},{"location":"about/#why-use-psrule-for-azure","title":"Why use PSRule for Azure?","text":"<p>PSRule for Azure helps you identify changes to improve the quality of solutions deployed on Azure. PSRule for Azure uses the principles of the Azure Well-Architected Framework (WAF) to:</p> <ul> <li>Suggest changes \u2014 you can use to improve the quality of your solution.</li> <li>Link to documentation \u2014 to learn how this applies to your environment.</li> <li>Demonstrate \u2014 how you can implement the change with examples.   Examples are provided in Azure Bicep and ARM templates syntax.</li> </ul> <p>If you want to write your own tests, you can do that too in your choice of YAML, JSON, or PowerShell. However with over 400 tests already built, you can identify and fix issues day one.</p> <p>Get started with a sample repository</p> <p>To get started with a sample repository, see PSRule for Azure Quick Start on GitHub.</p>"},{"location":"about/#introducing-psrule-for-azure","title":"Introducing PSRule for Azure","text":"<p>An introduction to PSRule for Azure and how it relates to the Azure Well-Architected Framework. We also give an quick overview of baselines, handling exceptions, and reporting options.</p>"},{"location":"about/#who-uses-psrule-for-azure","title":"Who uses PSRule for Azure?","text":"<p>Several first-party repositories use PSRule for Azure. Here's a few you may be familiar with:</p> <ul> <li>Azure/bicep-registry-modules - Azure Verified Modules (AVM) (Bicep)</li> <li>Azure/ResourceModules - Common Azure Resource Modules Library</li> <li>Azure/ALZ-Bicep - Azure Landing Zones (ALZ)</li> <li>Azure/AKS-Construction - AKS Construction</li> </ul>"},{"location":"analyzing-resources/","title":"Analyzing resources","text":"<p>The current state of Azure resources can be tested with PSRule for Azure, referred to as in-flight analysis. This is a two step process that works in high security environments with separation of roles.</p> <p>Abstract</p> <p>This topics covers how you can test the state of deployed Azure resources that have been exported.</p> <p>Important</p> <p>This step requires that you have already exported the state of deployed Azure resources. Before continuing, complete Exporting rule data for the resources that will be tested.</p>"},{"location":"analyzing-resources/#analyzing-exported-state","title":"Analyzing exported state","text":"<p>The state of resources can be analyzed for exported state by using the <code>Invoke-PSRule</code> PowerShell cmdlet.</p> <p>For example:</p> <pre><code>Invoke-PSRule -InputPath 'out/' -Module 'PSRule.Rules.Azure';\n</code></pre> <p>To filter results to only failed rules, use <code>Invoke-PSRule -Outcome Fail</code>. Passed, failed and error results are shown by default.</p> <p>For example:</p> <pre><code># Only show failed results\nInvoke-PSRule -InputPath 'out/' -Module 'PSRule.Rules.Azure' -Outcome Fail;\n</code></pre> <p>The output of this example is:</p> <pre><code>   TargetName: storage\n\nRuleName                            Outcome    Recommendation\n--------                            -------    --------------\nAzure.Storage.UseReplication        Fail       Storage accounts not using GRS may be at risk\nAzure.Storage.SecureTransferRequ... Fail       Storage accounts should only accept secure traffic\nAzure.Storage.SoftDelete            Fail       Enable soft delete on Storage Accounts\n</code></pre> <p>A summary of results can be displayed by using <code>Invoke-PSRule -As Summary</code>.</p> <p>For example:</p> <pre><code># Display as summary results\nInvoke-PSRule -InputPath 'out/' -Module 'PSRule.Rules.Azure' -As Summary;\n</code></pre> <p>The output of this example is:</p> <pre><code>RuleName                            Pass  Fail  Outcome\n--------                            ----  ----  -------\nAzure.ACR.MinSku                    0     1     Fail\nAzure.AppService.PlanInstanceCount  0     1     Fail\nAzure.AppService.UseHTTPS           0     2     Fail\nAzure.Resource.UseTags              73    36    Fail\nAzure.SQL.ThreatDetection           0     1     Fail\nAzure.SQL.Auditing                  0     1     Fail\nAzure.Storage.UseReplication        1     7     Fail\nAzure.Storage.SecureTransferRequ... 2     6     Fail\nAzure.Storage.SoftDelete            0     8     Fail\n</code></pre>"},{"location":"analyzing-resources/#ignoring-rules","title":"Ignoring rules","text":"<p>To prevent a rule executing you can either:</p> <ul> <li>Exclude \u2014 The rule is not executed for any resource.</li> <li>Suppress \u2014 The rule is not executed for a specific resource by name.</li> </ul> <p>To exclude a rule, set <code>Rule.Exclude</code> option within the <code>ps-rule.yaml</code> file.</p> <p> Docs</p> <pre><code>rule:\n  exclude:\n  # Ignore the following rules for all resources\n  - Azure.VM.UseHybridUseBenefit\n  - Azure.VM.Standalone\n</code></pre> <p>To suppress a rule, set <code>Suppression</code> option within the <code>ps-rule.yaml</code> file.</p> <p> Docs</p> <pre><code>suppression:\n  Azure.AKS.AuthorizedIPs:\n  # Exclude the following externally managed AKS clusters\n  - aks-cluster-prod-eus-001\n  Azure.Storage.SoftDelete:\n  # Exclude the following non-production storage accounts\n  - storagedeveus6jo36t\n  - storagedeveus1df278\n</code></pre> <p>Tip</p> <p>Use comments within <code>ps-rule.yaml</code> to describe the reason why rules are excluded or suppressed. Meaningful comments help during peer review within a Pull Request (PR). Also consider including a date if the exclusions or suppressions are temporary.</p>"},{"location":"analyzing-resources/#advanced-configuration","title":"Advanced configuration","text":"<p> Docs</p> <p>PSRule for Azure comes with many configuration options. The setup section explains in detail how to configure each option.</p>"},{"location":"creating-your-pipeline/","title":"Creating your pipeline","text":"<p>Abstract</p> <p>This topic covers how you can configuration continuous integration (CI) pipelines to tests Bicep and ARM templates automatically.</p> <p>You can use PSRule for Azure to validate Azure resources throughout their lifecycle. By using validation within a continuous integration (CI) pipeline, any issues provide fast feedback.</p> <p>Within the root directory of your infrastructure as code repository:</p> GitHub ActionsAzure PipelinesGeneric with PowerShell <p>Create a new GitHub Actions workflow by creating <code>.github/workflows/analyze-arm.yaml</code>.</p> <pre><code>name: Analyze templates\non:\n  push:\n    branches:\n    - main\n  pull_request:\n    branches:\n    - main\njobs:\n  analyze_arm:\n    name: Analyze templates\n    runs-on: ubuntu-latest\n    steps:\n    - name: Checkout\n      uses: actions/checkout@v3\n\n    # Analyze Azure resources using PSRule for Azure\n    - name: Analyze Azure template files\n      uses: microsoft/ps-rule@v2.9.0\n      with:\n        modules: 'PSRule.Rules.Azure'\n</code></pre> <p>Create a new Azure DevOps YAML pipeline by creating <code>.azure-pipelines/analyze-arm.yaml</code>.</p> <pre><code>steps:\n\n# Analyze Azure resources using PSRule for Azure\n- task: ps-rule-assert@2\n  displayName: Analyze Azure template files\n  inputs:\n    modules: 'PSRule.Rules.Azure'\n</code></pre> <p>Create a pipeline in any CI environment by using PowerShell.</p> <pre><code># Analyze Azure resources using PSRule for Azure\n$modules = @('PSRule.Rules.Azure')\nInstall-Module -Name $modules -Scope CurrentUser -Force -ErrorAction Stop;\nAssert-PSRule -InputPath '.' -Module $modules -Format File -ErrorAction Stop;\n</code></pre> <p>This will automatically install compatible versions of all dependencies.</p> <p>Tip</p> <p>If this is your first time implementing PSRule for Azure on a live repository, you may want to consider setting continue on error. This will allow you to try out PSRule without preventing pull requests (PRs) from being merged.</p>"},{"location":"creating-your-pipeline/#parameters","title":"Parameters","text":"<p>Several parameters are available to customize the behavior of the pipeline. In addition, many of these parameters are also available as configuration options configurable within <code>ps-rule.yaml</code>.</p> <p>Some of the most common parameters are listed below. For a full list of parameters see the readme for GitHub Actions or Azure Pipelines.</p>"},{"location":"creating-your-pipeline/#limiting-input-to-a-specific-path","title":"Limiting input to a specific path","text":"<p>By default, PSRule will scan all files and folders within the repository or current working path. You can use the <code>inputPath</code> parameter to limit the analysis to a specific file or directory path.</p> <p>Tip</p> <p>The <code>inputPath</code> parameter only accepts a relative path. Both file and directory paths are supported. For example: <code>azure/modules/</code> if you have a <code>azure/modules/</code> directory in the root of your repository. Be careful not to specify a leading <code>/</code> such as <code>/azure/modules/</code>. On Linux <code>/</code> is the root directory, which makes this a fully qualified path instead of a relative path.</p> GitHub ActionsAzure PipelinesGeneric with PowerShell <pre><code># Analyze Azure resources using PSRule for Azure\n- name: Analyze Azure template files\n  uses: microsoft/ps-rule@v2.9.0\n  with:\n    modules: 'PSRule.Rules.Azure'\n    inputPath: azure/modules/\n</code></pre> <pre><code># Analyze Azure resources using PSRule for Azure\n- task: ps-rule-assert@2\n  displayName: Analyze Azure template files\n  inputs:\n    modules: 'PSRule.Rules.Azure'\n    inputPath: azure/modules/\n</code></pre> <pre><code># Analyze Azure resources using PSRule for Azure\n$modules = @('PSRule.Rules.Azure')\nInstall-Module -Name $modules -Scope CurrentUser -Force -ErrorAction Stop;\nAssert-PSRule -InputPath 'azure/modules/' -Module $modules -Format File -ErrorAction Stop;\n</code></pre>"},{"location":"creating-your-pipeline/#configuring-a-baseline","title":"Configuring a baseline","text":"<p>You can set the <code>baseline</code> parameter to specify the name of a baseline to use. A baseline is a set of rules and configuration. PSRule for Azure ships with multiple baselines to choose from. See working with baselines for more information.</p> GitHub ActionsAzure PipelinesGeneric with PowerShell <pre><code># Analyze Azure resources using PSRule for Azure\n- name: Analyze Azure template files\n  uses: microsoft/ps-rule@v2.9.0\n  with:\n    modules: 'PSRule.Rules.Azure'\n    baseline: Azure.GA_2023_09\n</code></pre> <pre><code># Analyze Azure resources using PSRule for Azure\n- task: ps-rule-assert@2\n  displayName: Analyze Azure template files\n  inputs:\n    modules: 'PSRule.Rules.Azure'\n    baseline: Azure.GA_2023_09\n</code></pre> <pre><code># Analyze Azure resources using PSRule for Azure\n$modules = @('PSRule.Rules.Azure')\nInstall-Module -Name $modules -Scope CurrentUser -Force -ErrorAction Stop;\nAssert-PSRule -InputPath '.' -Baseline 'Azure.GA_2023_09' -Module $modules -Format File -ErrorAction Stop;\n</code></pre>"},{"location":"creating-your-pipeline/#continue-on-error","title":"Continue on error","text":"<p>By default, PSRule breaks or stops the pipeline if any rules fail or errors occur. When adopting PSRule for Azure or a new baseline you may want to run PSRule without stopping the pipeline.</p> <p>To do this, configure the PSRule for Azure step to continue on error.</p> GitHub ActionsAzure PipelinesGeneric with PowerShell <p>Set the <code>continue-on-error</code> property to <code>true</code>.</p> <pre><code># Analyze Azure resources using PSRule for Azure\n- name: Analyze Azure template files\n  uses: microsoft/ps-rule@v2.9.0\n  continue-on-error: true\n  with:\n    modules: 'PSRule.Rules.Azure'\n</code></pre> <p>Set the <code>continueOnError</code> property to <code>true</code>.</p> <pre><code># Analyze Azure resources using PSRule for Azure\n- task: ps-rule-assert@2\n  displayName: Analyze Azure template files\n  continueOnError: true\n  inputs:\n    modules: 'PSRule.Rules.Azure'\n</code></pre> <p>Set the <code>ErrorAction</code> parameter of <code>Assert-PSRule</code> to <code>Continue</code>.</p> <pre><code># Analyze Azure resources using PSRule for Azure\n$modules = @('PSRule.Rules.Azure')\nInstall-Module -Name $modules -Scope CurrentUser -Force -ErrorAction Stop;\nAssert-PSRule -InputPath '.' -Module $modules -Format File -ErrorAction Continue;\n</code></pre>"},{"location":"creating-your-pipeline/#adding-additional-modules","title":"Adding additional modules","text":"<p>You can add additional modules to the <code>modules</code> parameter by using comma (<code>,</code>) separating each module name.</p> GitHub ActionsAzure PipelinesGeneric with PowerShell <pre><code># Analyze Azure resources using PSRule for Azure\n- name: Analyze Azure template files\n  uses: microsoft/ps-rule@v2.9.0\n  with:\n    modules: 'PSRule.Rules.Azure,PSRule.Monitor'\n</code></pre> <pre><code># Analyze Azure resources using PSRule for Azure\n- task: ps-rule-assert@2\n  displayName: Analyze Azure template files\n  inputs:\n    modules: 'PSRule.Rules.Azure,PSRule.Monitor'\n</code></pre> <pre><code># Analyze Azure resources using PSRule for Azure\n$modules = @('PSRule.Rules.Azure', 'PSRule.Monitor')\nInstall-Module -Name $modules -Scope CurrentUser -Force -ErrorAction Stop;\nAssert-PSRule -InputPath '.' -Module $modules -Format File -ErrorAction Stop;\n</code></pre>"},{"location":"creating-your-pipeline/#outputting-results","title":"Outputting results","text":"<p>You can configure PSRule to output results into a file by using the <code>outputFormat</code> and <code>outputPath</code> parameters. For details on the formats that are supported see analysis output.</p> GitHub ActionsAzure PipelinesGeneric with PowerShell <pre><code># Analyze Azure resources using PSRule for Azure\n- name: Analyze Azure template files\n  uses: microsoft/ps-rule@v2.9.0\n  with:\n    modules: 'PSRule.Rules.Azure'\n    outputFormat: Sarif\n    outputPath: reports/ps-rule-results.sarif\n</code></pre> <pre><code># Analyze Azure resources using PSRule for Azure\n- task: ps-rule-assert@2\n  displayName: Analyze Azure template files\n  inputs:\n    modules: 'PSRule.Rules.Azure'\n    outputFormat: Sarif\n    outputPath: reports/ps-rule-results.sarif\n</code></pre> <pre><code># Analyze Azure resources using PSRule for Azure\n$modules = @('PSRule.Rules.Azure')\nInstall-Module -Name $modules -Scope CurrentUser -Force -ErrorAction Stop;\nAssert-PSRule -InputPath '.' -OutputFormat 'Sarif' -OutputPath 'reports/ps-rule-results.sarif' -Module $modules -Format File -ErrorAction Stop;\n</code></pre>"},{"location":"creating-your-pipeline/#configuration","title":"Configuration","text":"<p>Configuration options for PSRule for Azure are set within the <code>ps-rule.yaml</code> file. To set options, create a new file named <code>ps-rule.yaml</code> in the root directory of your repository.</p> <p>Tip</p> <p>This file should be committed to your repository so it is available when your pipeline runs.</p>"},{"location":"creating-your-pipeline/#expand-template-parameter-files","title":"Expand template parameter files","text":"<p> Docs</p> <p>PSRule for Azure can automatically expand Azure template parameter files. When enabled, PSRule for Azure automatically resolves parameter and template file context at runtime.</p> <p>To enabled this feature, set the <code>Configuration.AZURE_PARAMETER_FILE_EXPANSION</code> option to <code>true</code>. This option can be set within the <code>ps-rule.yaml</code> file.</p> ps-rule.yaml<pre><code>configuration:\n  # Enable automatic expansion of Azure parameter files\n  AZURE_PARAMETER_FILE_EXPANSION: true\n</code></pre>"},{"location":"creating-your-pipeline/#expand-bicep-source-files","title":"Expand Bicep source files","text":"<p> Docs</p> <p>PSRule for Azure can automatically expand Bicep source files. When enabled, PSRule for Azure automatically expands and analyzes Azure resource from <code>.bicep</code> files.</p> <p>To enabled this feature, set the <code>Configuration.AZURE_BICEP_FILE_EXPANSION</code> option to <code>true</code>. This option can be set within the <code>ps-rule.yaml</code> file.</p> ps-rule.yaml<pre><code>configuration:\n  # Enable automatic expansion of bicep source files\n  AZURE_BICEP_FILE_EXPANSION: true\n</code></pre>"},{"location":"creating-your-pipeline/#advanced-configuration","title":"Advanced configuration","text":"<p> Docs</p> <p>PSRule for Azure comes with many configuration options. The setup section explains in detail how to configure each option.</p>"},{"location":"creating-your-pipeline/#recommended-content","title":"Recommended content","text":"<ul> <li>Suppression and excluding rules</li> <li> <p>Using Bicep source</p> </li> </ul>"},{"location":"deprecations/","title":"Deprecations","text":""},{"location":"deprecations/#deprecations-for-v200","title":"Deprecations for v2.0.0","text":""},{"location":"deprecations/#realigned-configuration-option-names","title":"Realigned configuration option names","text":"<p>The following configuration options will be renamed in upcoming releases of PSRule for Azure. This is part of a ongoing effort to align the naming of configuration options across PSRule for Azure.</p> <p>We plan to have all the old option names renamed and they will not longer work from v2. To upgrade use the new names instead. Until v2, the old option names are still work and will take precedence if new and old are configured.</p> New name Old name Available from <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> <code>Azure_AKSMinimumVersion</code>  v1.12.0 <code>AZURE_AKS_POOL_MINIMUM_MAXPODS</code> <code>Azure_AKSNodeMinimumMaxPods</code>  v1.39.0 <code>AZURE_RESOURCE_ALLOWED_LOCATIONS</code> <code>Azure_AllowedRegions</code>  v1.30.0 <code>AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME</code> <code>Azure_MinimumCertificateLifetime</code>  v1.39.0 <p>Important</p> <p>New option names will work from the release specified by Available from. Configuring these options prior to that release will have no affect. For details on configuring these options see upgrade notes for details.</p>"},{"location":"deprecations/#realignment-of-rules","title":"Realignment of rules","text":"<p>The Well-Architected Framework and PSRule are regularly updated. As a result, some rules may not have a clear linkage with the latest guidance or practices.</p> <p>To ensure that PSRule for Azure continues to provide clear guidance, examples, and references some rules will be removed. The following rules are deprecated and will be removed in v2:</p> Reference ID Name Deprecated from Reason AZR-000217 Azure.Template.UseParameters v1.36.0 Linting already handled by Bicep linter. No clear linkage to WAF. AZR-000219 Azure.Template.UseVariables v1.36.0 Linting already handled by Bicep linter. No clear linkage to WAF. AZR-000218 Azure.Template.DefineParameters v1.36.0 No applicable to Bicep. No clear linkage to WAF. AZR-000233 Azure.Template.ValidSecretRef v1.36.0 Linting already handled by Bicep linter. No clear linkage to WAF. <p>Deprecated rules will not be run by default, but can be enabled by:</p> <ul> <li>Explicitly configuring the rule name or ID in the <code>Rule.Include</code> option, when a baseline not used.</li> <li>Adding the rule name or ID to the <code>Rule.Include</code> option in a custom baseline.</li> </ul> <p>From v2, the deprecated rules will be removed and will no longer be available in new releases.</p>"},{"location":"expanding-source-files/","title":"Expanding source files","text":"<p>PSRule for Azure supports analyzing resources contained within Azure Infrastructure as Code.</p> <p>Abstract</p> <p>This topic covers what source expansion is, why it's important, and how to use it within PSRule for Azure.</p>"},{"location":"expanding-source-files/#source-expansion","title":"Source expansion","text":"<p>PSRule for Azure goes beyond linting Azure Bicep and template files for syntax. Source expansion performs context specific static analysis on Azure resources. Azure resources are analyzed before deployment as if they are deployed.</p> <p>This provides some unique benefits such as:</p> <ul> <li>Improve success \u2014 Azure resources are resolved before deployment,   increasing success by finding errors earlier such as within a PR.<ul> <li>Detect common templates issues such as missing parameters and JSON structure.</li> <li>Identify deployment issues such as invalid resource names and incorrect resource identifiers.</li> </ul> </li> <li>As deployed \u2014 Analysis of Azure resources against Azure WAF as if they are deployed.<ul> <li>Parameters, conditional resources, functions (built-in and user defined), variables,   and copy loops are resolved.</li> <li>Azure resource names are shown in passing and failing results.   Resolving issues with resource configurations can be targeted by resource.</li> <li>Resource file locations for template and parameter files are included in results.</li> </ul> </li> <li>Suppression by resource name \u2014 Azure resource names can be used to apply exceptions.<ul> <li>Suppression allows for individual resources to be excluded from rules by name.</li> </ul> </li> <li>Offline support \u2014 Static analysis is performed against source files instead of deployed resources.<ul> <li>Some functions that may be included in templates dynamically query Azure for current state.   For these functions standard placeholder values are used by default.   Functions that use placeholders include <code>reference</code>, <code>list*</code>.</li> </ul> </li> </ul>"},{"location":"expanding-source-files/#feature-support","title":"Feature support","text":"<p>Source expansion is supported with:</p> <ul> <li>Azure template and parameter files \u2014 Azure templates are expanded from parameter files.   Link parameter files to templates by metadata or naming convention.   See Using templates for a detailed explanation of how to do this.</li> <li>Azure Bicep deployments \u2014 Files with the <code>.bicep</code> extension are detected and expanded.   See Using Bicep source for a detailed explanation of how to do this.</li> <li> <p>Azure Bicep modules with tests \u2014 Reusable Bicep modules can be expanded with tests.   See Using Bicep source for a detailed explanation of how to do this.</p> </li> </ul>"},{"location":"expanding-source-files/#limitations","title":"Limitations","text":"<p>Currently the following limitations apply:</p> <ul> <li>Required parameters in must be provided in parameter files or Bicep deployments.</li> <li>Nested templates are expanded, external templates are not.<ul> <li>Deployment resources that link to an external template are returned as a resource.</li> </ul> </li> <li>Sub-resources such as diagnostic logs or configurations are automatically nested. Automatic nesting a sub-resource requires:<ul> <li>The parent resource is defined in the same template.</li> <li>The sub-resource depends on the parent resource.</li> </ul> </li> <li>The <code>environment()</code> template function always returns values for Azure public cloud.</li> <li>References to Key Vault secrets are not expanded.   A placeholder value is used instead.</li> <li>The <code>reference()</code> function will return objects for resources within the same template.   For resources that are not in the same template, a placeholder value is used instead.</li> <li>Multi-line strings are not supported.</li> <li>Template expressions up to a maximum of 100,000 characters are supported.</li> </ul> <p>In addition, currently the following limitation apply to using Bicep source files:</p> <ul> <li>The Bicep CLI must be installed.   When using GitHub Actions or Azure Pipelines the Bicep CLI is pre-installed.</li> <li>Location of issues in Bicep source files is not supported.</li> <li> <p>Expansion of Bicep source files times out after 5 seconds by default.   The timeout can be overridden by setting the AZURE_BICEP_FILE_EXPANSION_TIMEOUT option.</p> </li> </ul>"},{"location":"expanding-source-files/#strong-type","title":"Strong type","text":"<p>String parameters are commonly used to pass values such as a resource Id or location. PSRule for Azure provides additional support to allow parameters to be strongly typed. When a parameter is strongly typed, the value is checked against the type during expansion.</p> <p>To configure a strong type for a parameter set the <code>strongType</code> metadata property on the parameter. The strong type will be set to the resource type that the parameter will accept, such as <code>Microsoft.OperationalInsights/workspaces</code>.</p> TemplateBicep <pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": {\n        \"workspaceId\": {\n            \"type\": \"string\",\n            \"metadata\": {\n                \"description\": \"The resource identifier for a Log Analytics workspace.\",\n                \"strongType\": \"Microsoft.OperationalInsights/workspaces\"\n            }\n        }\n    }\n}\n</code></pre> <pre><code>@metadata({\n  strongType: 'Microsoft.OperationalInsights/workspaces'\n})\n@description('The resource identifier for a Log Analytics workspace.')\nparam workspaceId string\n</code></pre> <p>Strong type also supports the following non-resource type values:</p> <ul> <li><code>location</code> - Specifies the parameter must contain any valid Azure location.</li> </ul>"},{"location":"expanding-source-files/#scope-functions","title":"Scope functions","text":"<p>Azure deployments support a number of scope functions can be used within Infrastructure as Code. When using PSRule for Azure, these functions have a default meaning that can be configured.</p> <p>When configuring scope functions, only the properties you want to override has to be specified. Unspecified properties will inherit from the defaults.</p>"},{"location":"expanding-source-files/#subscription","title":"Subscription","text":"<p>The <code>subscription()</code> function will return the following unless overridden:</p> <pre><code>subscriptionId: 'ffffffff-ffff-ffff-ffff-ffffffffffff'\ndisplayName: 'PSRule Test Subscription'\nstate: 'NotDefined'\n</code></pre> <p>To override, configure <code>AZURE_SUBSCRIPTION</code>.</p>"},{"location":"expanding-source-files/#resource-group","title":"Resource Group","text":"<p>The <code>resourceGroup()</code> function will return the following unless overridden:</p> <pre><code>name: 'ps-rule-test-rg'\nlocation: 'eastus'\ntags: { }\nproperties:\n  provisioningState: 'Succeeded'\n</code></pre> <p>To override, configure <code>AZURE_RESOURCE_GROUP</code>.</p>"},{"location":"expanding-source-files/#tenant","title":"Tenant","text":"<p>The <code>tenant()</code> function will return the following unless overridden:</p> <pre><code>countryCode: 'US'\ntenantId: 'ffffffff-ffff-ffff-ffff-ffffffffffff'\ndisplayName: 'PSRule'\n</code></pre> <p>To override, configure <code>AZURE_TENANT</code>.</p>"},{"location":"expanding-source-files/#management-group","title":"Management Group","text":"<p>The <code>managementGroup()</code> function will return the following unless overridden:</p> <pre><code>name: 'psrule-test'\nproperties:\n  displyName: 'PSRule Test Management Group'\n</code></pre> <p>To override, configure <code>AZURE_MANAGEMENT_GROUP</code>.</p>"},{"location":"expanding-source-files/#related-content","title":"Related content","text":"<ul> <li>Using Bicep source</li> <li>Using templates</li> <li>Creating your pipeline</li> </ul>"},{"location":"export-rule-data/","title":"Exporting rule data","text":"<p>The current state of Azure resources can be tested with PSRule for Azure, referred to as in-flight analysis. This is a two step process that works in high security environments with separation of roles.</p> <p>Abstract</p> <p>This topics covers how you can export the current state of Azure resources deployed into a subscription. After the current state has been exported, offline analysis can be performed against the saved state.</p> <p>Important</p> <p>Before continuing, complete the steps from Installing locally. To export data from a subscription, Azure PowerShell modules must be installed. Exporting rule data can also be automated and scheduled with Azure Automation Service. However, for this scenario we will focus how to run this process interactively.</p> <p>To perform analysis on Azure resources the current configuration state is exported to a JSON file format. The exported state is processed later during analysis.</p> <ul> <li>What's exported \u2014 Configurations such as:<ul> <li>Resource SKUs, names, tags, and settings configured for an Azure resource.</li> </ul> </li> <li> <p>What's not exported \u2014 Resource data such as:</p> <ul> <li>The contents of blobs stored on a storage account, or databases tables.</li> </ul> </li> </ul>"},{"location":"export-rule-data/#export-an-azure-subscription","title":"Export an Azure subscription","text":"<p>The state of resources from the current Azure subscription will be exported by using the following commands:</p> <pre><code># STEP 1: Authenticate to Azure, only required if not currently connected\nConnect-AzAccount;\n\n# STEP 2: Confirm the current subscription context\nGet-AzContext;\n\n# STEP 3: Exports Azure resources to JSON files\nExport-AzRuleData -OutputPath 'out/';\n</code></pre>"},{"location":"export-rule-data/#additional-options","title":"Additional options","text":"<p>By default, resource data for the current subscription context will be exported.</p> <p>To export resource data for specific subscriptions use:</p> <ul> <li><code>-Subscription</code> - to specify subscriptions by id or name.</li> <li><code>-Tenant</code> - to specify subscriptions within an Azure Active Directory Tenant by id.</li> </ul> <p>For example:</p> <pre><code># Export data from two specific subscriptions\nExport-AzRuleData -Subscription 'Contoso Production', 'Contoso Non-production';\n</code></pre> <p>To export specific resource data use:</p> <ul> <li><code>-ResourceGroupName</code> - to filter resources by Resource Group.</li> <li><code>-Tag</code> - to filter resources based on tag.</li> </ul> <p>For example:</p> <pre><code># Export information from two resource groups within the current subscription context\nExport-AzRuleData -ResourceGroupName 'rg-app1-web', 'rg-app1-db';\n</code></pre> <p>To export resource data for all subscription contexts use:</p> <ul> <li><code>-All</code> - to export resource data for all subscription contexts.</li> </ul> <p>For example:</p> <pre><code># Export data from all subscription contexts\nExport-AzRuleData -All;\n</code></pre>"},{"location":"faq/","title":"Frequently Asked Questions (FAQ)","text":"<p>Continue reading for FAQ relating to PSRule for Azure. For general FAQ see PSRule - Frequently Asked Questions (FAQ), including:</p> <ul> <li>How is PSRule different to Pester?</li> <li>How do I configure PSRule?</li> <li>How do I ignore a rule?</li> <li>How do exclude or ignore files from being processed?</li> <li>How do I disable or suppress the not processed warning?</li> <li>How do I layer on custom rules on top of an existing module?</li> </ul> <p>Note</p> <p>If you have a question that is not answered here, please join or start a discussion. For common issues and workarounds, please see troubleshooting.</p>"},{"location":"faq/#what-is-a-rule","title":"What is a rule?","text":"<p>A rule is a named set of checks and documentation. Each rule is tests a specific aspect of an Azure resource or deployment to determine if it is aligned with the Microsoft Azure Well-Architected Framework. You can find the documentation for each rule under reference.</p>"},{"location":"faq/#what-is-a-baseline","title":"What is a baseline?","text":"<p>A baseline combines rules and configuration. PSRule for Azure provides several baselines that can be referenced when running PSRule. Quarterly baselines provide a stable checkpoint of rules when you need to stagger adoption of new rules.</p> <p>Continue reading working with baselines for a detailed breakdown.</p>"},{"location":"faq/#what-is-expansion","title":"What is expansion?","text":"<p>Expansion is a feature of PSRule for Azure that converts Azure Infrastructure as Code (IaC) to a testable Azure resource. IaC format such as Bicep and ARM templates, support dynamic capabilities such parameters, variables, and conditions... These dynamic capabilities allow customers to create modular reusable code that can scale across an organization. However, to determine if a specific Azure resource meets the requirements of an organization the final state must be known.</p> <p>Expansion resolves these dynamic capabilities so that a final state for each resource can be tested by rules. Noting the final expanded state provided by PSRule for Azure is a close approximation. This close approximation allows testing of Azure resources offline directly from code before deployment to Azure.</p> <p>Continue reading Expanding source files.</p>"},{"location":"faq/#is-terraform-supported","title":"Is Terraform supported?","text":"<p>Currently PSRule for Azure supports testing Azure resources from IaC with:</p> <ul> <li>Azure Resource Manager (ARM) templates.</li> <li>Azure Bicep deployments.</li> </ul> <p>Checking Terraform from HashiCorp Configuration Language (HCL) is not supported at this time. If this feature is important to you, please upvote \ud83d\udc4d the issue on GitHub.</p> <p>What is supported? After resources are deployed to Azure, PSRule for Azure can be used to check the Azure resources in-flight.</p> <p>This methods works for Azure resources regardless of how they are deployed. Use this method for analyzing resources deployed via the Azure Portal, Terraform, Pulumi, or other tools.</p> <p>For instructions on how to do this see Exporting rule data.</p>"},{"location":"faq/#what-methods-are-supported-for-checking-resources","title":"What methods are supported for checking resources?","text":"<p>PSRule for Azure supports two methods for analyzing Azure resources:</p> <ul> <li>Pre-flight \u2014 Before resources are deployed from an ARM template or Bicep.   Use pre-flight analysis to:<ul> <li>Implement checks within Pull Requests (PRs).</li> <li>Improve alignment of resources to WAF recommendations.</li> <li>Identify issues that prevent successful resource deployments on Azure.</li> <li>Integrate continual improvement and standardization of Azure resource configurations.</li> <li>Implement release gates between environments.</li> <li>For more information see Creating your pipeline.</li> </ul> </li> <li> <p>In-flight \u2014 After resources are deployed to an Azure subscription.   Use in-flight analysis to:</p> <ul> <li>Implement release gates between environments for non-native tools such as Terraform.</li> <li>Performing offline analysis in split-environments.</li> <li>For more information see Exporting rule data.</li> </ul> </li> </ul>"},{"location":"faq/#how-do-i-create-a-custom-rule-to-enforce-resource-group-tagging","title":"How do I create a custom rule to enforce resource group tagging?","text":"<p>PSRule for Azure covers common use cases that align to the Microsoft Azure Well-Architected Framework. Use of resource and resource group tags is recommended in the WAF, however implementation may vary. You may want to use PSRule to enforce tagging or something similar early in a DevOps pipeline.</p> <p>We have a walk through scenario Enforcing custom tags to get you started.</p>"},{"location":"faq/#how-do-i-create-a-custom-rule-to-enforce-code-ownership","title":"How do I create a custom rule to enforce code ownership?","text":"<p>GitHub, Azure DevOps, and other DevOps platforms may implement code ownership. This process involves assigning a team or an individual review and approval responsibility. In GitHub or Azure DevOps implementation, ownership is linked to the file path.</p> <p>When a repository contains resources that different teams would approve how do you:</p> <ul> <li>Ensure resources are created in a path that triggers the correct approval?</li> </ul> <p>We have a walk through scenario Enforcing code ownership to get you started.</p>"},{"location":"faq/#do-you-have-sample-code","title":"Do you have sample code?","text":"<p>In addition to the walk through scenarios, we have a quick start template here. The repository contains sample ARM templates, Bicep, and pipeline code to get you started.</p> <p>In GitHub you can simply use the repository as a template for your own project.</p>"},{"location":"faq/#do-i-need-powershell-experience-to-start-using-psrule-for-azure","title":"Do I need PowerShell experience to start using PSRule for Azure?","text":"<p>No. You can start using built-in rules and CI with Azure Pipelines or GitHub Actions. If we didn't tell you, you might not even know that PowerShell runs under the covers.</p> <p>To perform local validation, some PowerShell setup is required but we step you through that. See How to install PSRule for Azure for details.</p> <p>To start writing your own custom rules you can use YAML, JSON, or PowerShell. PowerShell experience is required for some scenarios. We have a walk through scenario Enforcing custom tags to get you started.</p>"},{"location":"faq/#what-permissions-do-i-need-to-export-rule-data","title":"What permissions do I need to export rule data?","text":"<p>When exporting data for in-flight analysis, the default built-in Reader role to a subscription is required for:</p> <ul> <li>Exporting rule data with <code>Export-AzRuleData</code>.</li> <li>Exporting rule data from templates with <code>Export-AzRuleTemplateData</code> when online features are used.<ul> <li>Optionally <code>-ResourceGroupName</code> and <code>-Subscription</code> parameter can be used; these require access Reader access.</li> </ul> </li> </ul>"},{"location":"faq/#what-permissions-do-i-need-to-analyze-exported-rule-data","title":"What permissions do I need to analyze exported rule data?","text":"<p>When exporting data for in-flight analysis, no access to Azure is required after data has been exported to JSON.</p>"},{"location":"faq/#should-i-continue-to-use-azure-advisor-defender-for-cloud-or-azure-policy","title":"Should I continue to use Azure Advisor, Defender for Cloud, or Azure Policy?","text":"<p>Absolutely. PSRule for Azure does not replace Azure Advisor, Microsoft Defender for Cloud, or Azure Policy.</p> <p>PSRule complements Azure Advisor, Microsoft Defender for Cloud, and Azure Policy features by:</p> <ul> <li>Recommending turning on and using features of Azure Advisor, Microsoft Defender for Cloud, or Azure Policy.</li> <li>Providing offline analysis in split environments where the analyst has no access to Azure subscriptions.   Rule data for analysis can be exported out to a JSON file.</li> <li>Providing the ability to analyze resources in Azure Resource Manager templates before deployment.   Additionally, analysis can be performed in a CI process.</li> <li>Providing the ability to layer on organization specific rules, as required.</li> <li>Data collection requires limited permissions and requires no additional configuration.</li> </ul>"},{"location":"faq/#what-do-the-different-severity-and-levels-for-rules-means","title":"What do the different severity and levels for rules means?","text":"<p>PSRule for Azure annotates rules with three (3) severities which indicate how you should prioritize remediation. The following severities are defined:</p> <ul> <li><code>Critical</code> \u2014 Consider addressing these first, ideally within the next thirty (30) days.   Rules identified as critical often have high impact and are highly likely to affect your services.</li> <li><code>Important</code> \u2014 Consider addressing these next, ideally within the next sixty (60) days.   Rules identified as important often have a significant impact and are likely to affect your services.</li> <li><code>Awareness</code> \u2014 Consider addressing these last, ideally within the next ninety (90) days.   Rules identified as awareness often have a moderate or low impact to the operation of your services.</li> </ul> <p>Tip</p> <p>Severities and suggested time frames are an indicator only. They may affect your environment, compliance, or security differently based on your specific requirements. If you feel the severity for a rule is broadly incorrect then please let as know. You can do this by joining or starting a discussion.</p> <p>Additionally, PSRule for Azure uses three (3) rule levels. These levels determine how PSRule provides feedback about failing cases. The following levels are defined:</p> <ul> <li><code>Error</code> \u2014 Rules defined as error will stop CI pipelines that are configured to break on error.</li> <li><code>Warning</code> \u2014 Rules defined as warning will not stop CI pipelines and will produce a warning.</li> <li><code>Information</code> \u2014 Rules defined as information will not stop CI pipelines.</li> </ul>"},{"location":"faq/#how-often-are-releases-shipped","title":"How often are releases shipped?","text":"<p>PSRule for Azure uses semantic versioning to declare breaking changes.</p> <ul> <li>Major releases are infrequent in nature, but created on an as-needed basis.   You can check the upgrade notes to plan for the changes of the next major release.</li> <li>Minor releases are shipped normally each month.</li> <li>Patch releases for the most recent minor version are released on an as-needed basis.</li> </ul> <p>The latest module version can be installed from the PowerShell Gallery and NuGet. For a list of module changes please see the change log.</p> <p>For more information on how we handles versioning and changes see Changes and versioning.</p>"},{"location":"faq/#traditional-unit-testing-vs-psrule-for-azure","title":"Traditional unit testing vs PSRule for Azure?","text":"<p>You may already be using a unit test framework such as Pester to test infrastructure code. If you are, then you may have encountered the following challenges.</p> <p>For a general PSRule/ Pester comparison see How is PSRule different to Pester?</p>"},{"location":"faq/#unit-testing-more-than-basic-json-structure","title":"Unit testing more than basic JSON structure","text":"<p>Unit tests are unable to effectively test resources contained within Azure templates. Templates should be reusable, but this creates problems for testing when functions, conditions and copy loops are used. Template parameters could completely change the type, number of, or configuration of resources.</p> <p>PSRule resolves templates to allow analysis of the resources that would be deployed based on provided parameters.</p>"},{"location":"faq/#standard-library-of-tests","title":"Standard library of tests","text":"<p>When building unit tests for Azure resources, starting with an empty repository can be a daunting experience. While there are several open source repositories and samples around to get you started, you need to integrate these yourself.</p> <p>PSRule for Azure is distributed as a PowerShell module using the PowerShell Gallery. Using a PowerShell module makes it easy to install and update. The built-in rules allow you starting testing resources quickly, with minimal integration.</p> <p>For detailed examples see:</p> <ul> <li>Validate Azure resources from templates with Azure Pipelines</li> <li>Validate Azure resources from templates with continuous integration (CI)</li> </ul>"},{"location":"faq/#collection-of-telemetry","title":"Collection of telemetry","text":"<p>PSRule and PSRule for Azure currently do not collect any telemetry during installation or execution.</p> <p>PowerShell (used by PSRule for Azure) does collect basic telemetry by default. Collection of telemetry in PowerShell and how to opt-out is explained in about_Telemetry.</p>"},{"location":"features/","title":"Features","text":""},{"location":"features/#learn-by-example","title":"Learn by example","text":"<p>PSRule for Azure helps you quickly identify and fix issues to improve the quality of solutions deployed on Azure. Tests include documentation with official documentation references and examples. Use the Azure Bicep or template examples to adapt your solution to recommendations.</p> <p>Note</p> <p>Start exploring the list of rules included with PSRule for Azure.</p>"},{"location":"features/#framework-aligned","title":"Framework aligned","text":"<p>PSRule for Azure is aligned to the Azure Well-Architected Framework (WAF). Tests called rules check the configuration of Azure resources against WAF principles. Rules exist across five (5) WAF pillars:</p> <ul> <li>Cost Optimization</li> <li>Operational Excellence</li> <li>Performance Efficiency</li> <li>Reliability</li> <li>Security</li> </ul> <p>To help you align your Infrastructure as Code (IaC) to WAF principles, PSRule for Azure includes documentation. Included are examples, references to WAF and product documentation. This allows you to explore and learn the context of each WAF principle.</p>"},{"location":"features/#start-day-one","title":"Start day one","text":"<p>PSRule for Azure includes over 400 rules for validating resources against configuration recommendations. Rules automatically detect and analyze resources from Azure IaC artifacts. This allows you to quickly light up unit testing of Azure resources from templates and Bicep deployments.</p> <p>Use the built-in rules to start enforcing testing quickly. Then layer on your own rules as your organization's requirements mature. Custom rules can be implemented quickly and work side-by-side with built-in rules.</p> <p>As new built-in rules are added and improved, download the latest version to start using them.</p> <p>Tip</p> <p>For detailed information on building custom rules see:</p> <ul> <li>Enforcing custom tags.</li> <li>Enforcing code ownership.</li> </ul>"},{"location":"features/#devops-integrated","title":"DevOps integrated","text":"<p>Azure resources can be validated throughout their lifecycle to support a DevOps culture. Start testing your Bicep and ARM templates from code by validating them offline before deployment.</p> <p>Pre-flight validation can be integrated into a continuous integration (CI) pipeline as unit tests to:</p> <ul> <li>Shift-left \u2014 Identify configuration issues and provide fast feedback in PRs.</li> <li>Quality gates \u2014 Implement quality gates between environments such as dev, test, and production.</li> <li>Monitor continuously \u2014 Perform ongoing checks for configuration optimization opportunities.</li> </ul> <p>Learn</p> <p>You can learn more about Azure Bicep with the following links:</p> <ul> <li>What is Bicep?</li> <li>Learn modules for Azure Bicep</li> </ul>"},{"location":"features/#cross-platform","title":"Cross-platform","text":"<p>PSRule for Azure uses modern PowerShell libraries at its core, allowing it to go anywhere PowerShell can go. PSRule for Azure runs on MacOS, Linux, and Windows.</p> <p>PowerShell makes it easy to integrate PSRule into popular CI systems. Run natively or in a container depending on your platform. PSRule has native extensions for:</p> <ul> <li>Azure Pipelines (Azure DevOps)</li> <li>GitHub Actions</li> <li>Visual Studio Code</li> </ul> <p>Additionally, PSRule for Azure can be installed locally or within Azure Cloud Shell. For installation options see installation.</p>"},{"location":"install/","title":"How to install PSRule for Azure","text":"<p>PSRule for Azure supports running within continuous integration (CI) systems or locally. It is shipped as a PowerShell module which makes it easy to install and distribute updates.</p> Task Options Run tests within CI pipelines With GitHub Actions or Azure Pipelines or PowerShell Run tests locally during development With Visual Studio Code and PowerShell Create custom tests for your organization With Visual Studio Code and PowerShell <p>Tip</p> <p>PSRule for Azure provides native integration to popular CI systems such as GitHub Actions and Azure Pipelines. If you are using a different CI system you can use the local install to run on MacOS, Linux, and Windows worker nodes.</p>"},{"location":"install/#with-github-actions","title":"With GitHub Actions","text":"<p> GitHub Action</p> <p>Install and use PSRule for Azure with GitHub Actions by referencing the <code>microsoft/ps-rule</code> action.</p> StablePre-release <p>Install the latest stable version of PSRule for Azure.</p> GitHub Actions<pre><code>- name: Analyze Azure template files\n  uses: microsoft/ps-rule@v2.9.0\n  with:\n    modules: 'PSRule.Rules.Azure'\n</code></pre> <p>Install the latest stable or pre-release version of PSRule for Azure.</p> GitHub Actions<pre><code>- name: Analyze Azure template files\n  uses: microsoft/ps-rule@v2.9.0\n  with:\n    modules: 'PSRule.Rules.Azure'\n    prerelease: true\n</code></pre> <p>This will automatically install compatible versions of all dependencies.</p> <p>Note</p> <p>For additional examples on commonly configured parameters see Creating your pipeline.</p>"},{"location":"install/#with-azure-pipelines","title":"With Azure Pipelines","text":"<p> Extension</p> <p>Install and use PSRule for Azure with Azure Pipeline by using extension tasks. Install the extension from the marketplace, then use the <code>ps-rule-assert</code> task in pipeline steps.</p> StablePre-release <p>Install the latest stable version of PSRule for Azure.</p> Azure Pipelines<pre><code>- task: ps-rule-assert@2\n  displayName: Analyze Azure template files\n  inputs:\n    modules: 'PSRule.Rules.Azure'\n</code></pre> <p>Install the latest stable or pre-release version of PSRule for Azure.</p> Azure Pipelines<pre><code>- task: ps-rule-install@2\n  displayName: Install PSRule for Azure (pre-release)\n  inputs:\n    module: PSRule.Rules.Azure\n    prerelease: true\n\n- task: ps-rule-assert@2\n  displayName: Analyze Azure template files\n  inputs:\n    modules: 'PSRule.Rules.Azure'\n</code></pre> <p>This will automatically install compatible versions of all dependencies.</p> <p>Note</p> <p>For additional examples on commonly configured parameters see Creating your pipeline.</p>"},{"location":"install/#with-visual-studio-code","title":"With Visual Studio Code","text":"<p> Extension</p> <p>An extension for Visual Studio Code is available. The Visual Studio Code extension includes a built-in task to test locally and configuration schemas.</p> <p> </p> <p>To learn about Visual Studio Code support see the marketplace extension.</p> <p>For best results, configure the <code>PSRule.Rules.Azure</code> module using <code>ps-rule.yaml</code> by setting <code>requires</code> and <code>include</code> options.</p> ps-rule.yaml<pre><code>requires:\n  PSRule.Rules.Azure: '&gt;=1.29.0'\n\ninclude:\n  module:\n  - PSRule.Rules.Azure\n</code></pre> <p>Note</p> <p>Currently the Visual Studio Code extension relies on PSRule for Azure installed by PowerShell.</p>"},{"location":"install/#with-powershell","title":"With PowerShell","text":"<p>PSRule for Azure can be installed locally from the PowerShell Gallery using PowerShell. You can also use this option to install on CI workers that are not natively supported.</p>"},{"location":"install/#prerequisites","title":"Prerequisites","text":"Operating System Tool Installation Link Windows Windows PowerShell 5.1 with .NET Framework 4.7.2 or greater. link Windows, MacOS, Linux PowerShell version 7.4.x or greater. link <p>To use PSRule for Azure, PSRule a separate PowerShell module must be installed. The required version will automatically be installed along-side PSRule for Azure.</p> <p>Additionally, the exporting data from a subscription functionality requires the additional PowerShell modules:</p> <ul> <li>Az.Accounts</li> <li>Az.Resources</li> </ul> <p>Note</p> <p>Azure PowerShell modules are not installed automatically when installing PSRule for Azure. This has been changed from v1.16.0 due to module dependency chains in Azure DevOps. In most cases these modules will be pre-installed on the CI worker. For private CI workers, consider pre-installing these modules in a previous step.</p>"},{"location":"install/#installing-powershell","title":"Installing PowerShell","text":"<p>PowerShell 7.x can be installed on MacOS, Linux, and Windows but is not installed by default. For a list of platforms that PowerShell 7.4 is supported on and install instructions see Get PowerShell.</p>"},{"location":"install/#getting-the-modules","title":"Getting the modules","text":"<p> Module</p> <p>PSRule for Azure can be installed or updated from the PowerShell Gallery. Use the following command line examples from a PowerShell terminal to install or update PSRule for Azure.</p> For the current userFor all users <p>To install PSRule for Azure for the current user use:</p> <pre><code>Install-Module -Name 'PSRule.Rules.Azure' -Repository PSGallery -Scope CurrentUser\n</code></pre> <p>To update PSRule for Azure for the current user use:</p> <pre><code>Update-Module -Name 'PSRule.Rules.Azure' -Scope CurrentUser\n</code></pre> <p>This will automatically install compatible versions of all dependencies.</p> <p>To install PSRule for Azure for all users (requires admin/ root permissions) use:</p> <pre><code>Install-Module -Name 'PSRule.Rules.Azure' -Repository PSGallery -Scope AllUsers\n</code></pre> <p>To update PSRule for Azure for all users (requires admin/ root permissions) use:</p> <pre><code>Update-Module -Name 'PSRule.Rules.Azure' -Scope AllUsers\n</code></pre> <p>This will automatically install compatible versions of all dependencies.</p>"},{"location":"install/#pre-release-versions","title":"Pre-release versions","text":"<p>To use a pre-release version of PSRule for Azure add the <code>-AllowPrerelease</code> switch when calling <code>Install-Module</code>, <code>Update-Module</code>, or <code>Save-Module</code> cmdlets.</p> <p>Tip</p> <p>To install pre-release module versions, the latest version of PowerShellGet may be required.</p> <pre><code># Install the latest PowerShellGet version\nInstall-Module -Name PowerShellGet -Repository PSGallery -Scope CurrentUser -Force\n</code></pre> <p>Tip</p> <p>To install a pre-release version of PSRule and PSRule for Azure, install each in separate steps.</p> For the current userFor all users <p>To install PSRule for Azure for the current user use:</p> <pre><code>Install-Module -Name PowerShellGet -Repository PSGallery -Scope CurrentUser -Force\nInstall-Module -Name PSRule -Repository PSGallery -Scope CurrentUser -AllowPrerelease\nInstall-Module -Name PSRule.Rules.Azure -Repository PSGallery -Scope CurrentUser -AllowPrerelease\n</code></pre> <p>Open PowerShell with Run as administrator on Windows or <code>sudo pwsh</code> on Linux.</p> <p>To install PSRule for Azure for all users (requires admin/ root permissions) use:</p> <pre><code>Install-Module -Name PowerShellGet -Repository PSGallery -Scope CurrentUser -Force\nInstall-Module -Name PSRule -Repository PSGallery -Scope AllUsers -AllowPrerelease\nInstall-Module -Name PSRule.Rules.Azure -Repository PSGallery -Scope AllUsers -AllowPrerelease\n</code></pre>"},{"location":"install/#building-from-source","title":"Building from source","text":"<p> Source</p> <p>PSRule for Azure is provided as open source on GitHub. To build PSRule for Azure from source code:</p> <ol> <li>Clone the GitHub repository.</li> <li>Run <code>./build.ps1</code> from a PowerShell terminal in the cloned path.</li> </ol> <p>This build script will compile the module and documentation then output the result into <code>out/modules/PSRule.Rules.Azure</code>.</p>"},{"location":"install/#development-dependencies","title":"Development dependencies","text":"Operating System Tool Overview Installation Link Windows Windows PowerShell Support for version 5.1 with .NET Framework 4.7.2 or greater. link Windows, MacOS, Linux PowerShell Version 7.4 or greater is support. link - - Multiple PowerShell modules are required (PlatyPS, Pester, PSScriptAnalyzer, PowerShellGet, PackageManagement, InvokeBuild, PSRule). Installed when you run the <code>build.ps1</code> script - .NET .NET SDK v8 is required. link - Bicep CLI PSRule depends on the Bicep CLI to expand Bicep modules to ARM link <p>The following dependencies will be automatically installed if the required versions are not present:</p> <ul> <li>PowerShell modules:<ul> <li>PlatyPS</li> <li>Pester</li> <li>PSScriptAnalyzer</li> <li>PowerShellGet</li> <li>PackageManagement</li> <li>InvokeBuild</li> </ul> </li> <li>Bicep CLI</li> </ul> <p>These dependencies are only required for building and running tests for PSRule for Azure.</p>"},{"location":"install/#troubleshooting","title":"Troubleshooting","text":"<p>If the <code>./build.ps1</code> script fails, you can start troubleshooting this by:</p> <ul> <li>Checking the prerequisites are installed installed (and the specific versions)<ul> <li>Check the PowerShell version enter the following statement in the PowerShell terminal: <code>$PSVersionTable.PSVersion</code></li> <li>Check the installed .NET version by entering the <code>dotnet --list-sdks</code> command in your terminal.</li> </ul> </li> <li>Check if your .NET setup is connected to any Nuget repositories and if there's any connectivity or authentication issues.</li> <li>Installation of some pre-reqs may require admin privileges.</li> </ul>"},{"location":"install/#limited-access-networks","title":"Limited access networks","text":"<p>If you are on a network that does not permit Internet access to the PowerShell Gallery, download the required PowerShell modules on an alternative device that has access. PowerShell provides the <code>Save-Module</code> cmdlet that can be run from a PowerShell terminal to do this.</p> <p>The following command lines can be used to download the required modules using a PowerShell terminal. After downloading the modules, copy the module directories to devices with restricted Internet access.</p> Runtime modulesDevelopment modules <p>To save PSRule for Azure for offline use:</p> <pre><code>$modules = @('PSRule', 'PSRule.Rules.Azure', 'Az.Accounts', 'Az.Resources')\nSave-Module -Name $modules -Path '.\\modules'\n</code></pre> <p>This will save PSRule for Azure and all dependencies into the <code>modules</code> sub-directory.</p> <p>To save PSRule for Azure development module dependencies for offline use:</p> <pre><code>$modules = @('PSRule', 'Az.Accounts', 'Az.Resources', 'PlatyPS', 'Pester',\n  'PSScriptAnalyzer', 'PowerShellGet', 'PackageManagement', 'InvokeBuild')\nSave-Module -Name $modules -Repository PSGallery -Path '.\\modules';\n</code></pre> <p>This will save required developments dependencies into the <code>modules</code> sub-directory.</p>"},{"location":"integrations/","title":"Integrations","text":""},{"location":"integrations/#integrates-with-psrule-for-azure","title":"Integrates with PSRule for Azure","text":"<p>The following tools also take advantage of PSRule for Azure.</p>"},{"location":"integrations/#azure-governance-visualizer","title":"Azure Governance Visualizer","text":"<p> Docs \u00b7  v6_major_20220521_1</p> <p>AzGovViz provides a convenient way to view your Azure governance and hierarchy. Additionally you can view recommendations from PSRule as you navigate to each level in your hierarchy.</p> <p>You can include PSRule recommendations in AzGovViz output by adding the <code>-DoPSRule</code> command-line switch. This and more is included in the documentation.</p>"},{"location":"integrations/#template-analyzer","title":"Template Analyzer","text":"<p> Docs \u00b7  v0.3.0</p> <p>Template Analyzer scans Azure templates and Bicep code to ensure security and best practice checks are being followed before deployment.</p> <p>By default, Template Analyzer will only include rules aligned to the Security Well-Architected Framework pillar. To include rules from other pillars, use the <code>--include-non-security-rules</code> command-line switch.</p>"},{"location":"integrations/#microsoft-defender-for-devops","title":"Microsoft Defender for DevOps","text":"<p> Docs \u00b7  Public Preview</p> <p>Microsoft Defender for DevOps (DfD) provides unified DevOps security management across multicloud and multiple-pipeline environments.</p> <p>In this preview, DfD will include PSRule for Azure rules aligned to the Security Well-Architected Framework pillar.</p>"},{"location":"license-contributing/","title":"License and contributing","text":"<p>PSRule for Azure is licensed with an  MIT License, which means it's free to use and modify. But please check out the details.</p> <p>We  open source at Microsoft.</p> <p>In addition to our team, we hope you will think about contributing too. Here is how you can get started:</p> <ul> <li> Report issues.</li> <li> Upvote existing issues that are important to you.</li> <li> Improve documentation.</li> <li> Contribute code.</li> </ul> <p>Please read our contributing guidelines and code of conduct to learn how to contribute.</p>"},{"location":"related-projects/","title":"Related projects","text":"<p>The PSRule project is distributed across multiple repositories. You can find out more by visiting each repository.</p> Name Description microsoft/PSRule Core engine responsible for running rules. microsoft/ps-rule GitHub continuous integration using GitHub Actions. microsoft/PSRule-pipelines Azure DevOps continuous integration using Azure Pipelines. microsoft/PSRule-vscode Support for running and authoring rules within Visual Studio Code. microsoft/PSRule.Monitor Support for logging PSRule analysis results to Azure Monitor. microsoft/PSRule.Rules.CAF A suite of rules to validate Azure resources against the Cloud Adoption Framework (CAF) using PSRule."},{"location":"samples/","title":"Samples","text":""},{"location":"samples/#quick-start-repository","title":"Quick Start repository","text":"<p> Template</p> <p>You can clone, download, or use as a template for your own repository. This repository contains the following samples for PSRule for Azure:</p> <ul> <li>Azure Templates \u2014 Starter Azure Resource Manager (ARM) templates and parameter files.</li> <li>Azure Bicep \u2014 Starter Azure Bicep deployments and test files.</li> <li>GitHub Actions \u2014 Starter workflow for checking Azure Infrastructure as Code (IaC).</li> <li>Azure Pipelines \u2014 Starter pipelines for checking Azure Infrastructure as Code (IaC).</li> <li>Custom rules \u2014 Example custom rules that enforce organization specific requirements.</li> <li> <p>PSRule options \u2014 Example options for using PSRule for Azure.</p> </li> </ul>"},{"location":"samples/#community-samples","title":"Community samples","text":""},{"location":"samples/#custom-rules-and-conventions","title":"Custom rules and conventions","text":"<p>The following sample rules and conventions for Azure are available. You can use these samples as a starting point for developing your own custom rules.</p> Title Description Author Bicep Module Requires Discover and test Bicep modules based on a directory structure convention. @BernieWhite API Management Policy Discover and test API Management <code>.xml</code> policy files. @BernieWhite"},{"location":"support/","title":"Support","text":"<p>This project uses GitHub Issues to track bugs and feature requests. Before logging an issue please see our troubleshooting guide.</p> <p>Please search the existing issues before filing new issues to avoid duplicates.</p> <ul> <li>For new issues, file your bug or feature request as a new issue.</li> <li>For help, discussion, and support questions about using this project, join or start a discussion.</li> </ul>"},{"location":"support/#microsoft-support-policy","title":"Microsoft Support Policy","text":"<p>Support for this project/ product is limited to the resources listed above.</p>"},{"location":"troubleshooting/","title":"Troubleshooting","text":"<p>This article provides troubleshooting instructions for common errors.</p>"},{"location":"troubleshooting/#bicep-compile-errors","title":"Bicep compile errors","text":"<p>When expanding Bicep source files you may get an error including a BCPnnn code similar to the following:</p> <p>Message</p> <p>Exception calling \"GetResources\" with \"3\" argument(s): \"Bicep (0.14.46) compilation of '' failed with: Error BCP057: The name \"storageAccountName\" does not exist in the current context. <p>This error is raised when Bicep fails to compile a source file. To resolve this issue:</p> <ul> <li>You may need to update your Bicep source file before PSRule can expand it.   Use guidance from the Bicep error message to help resolve the issue.</li> <li>Check that you are using a version of Bicep that supports the Bicep features you are using.   It may not always be clear which version of Bicep CLI PSRule for Azure is using if you have multiple versions installed.   Using the Bicep CLI via <code>az bicep</code> is not the default, and you may need to set additional options to use it.</li> </ul> <p>Tip</p> <p>From PSRule for Azure v1.25.0 you can configure the minimum version of Bicep CLI required. If an earlier version is detected, PSRule for Azure will generate an error. See Configuring minimum version for details on how to configure this option.</p>"},{"location":"troubleshooting/#bicep-version","title":"Bicep version","text":"<p>When expanding Bicep source files you may get an error relating to the Bicep version you have installed. For example if you attempt to use a Bicep feature that is not supported by the version used by PSRule for Azure.</p> <p>Check the Bicep version reported by PSRule supports the Bicep features you are using.</p> <p>PSRule for Azure uses the Bicep CLI installed on your machine or CI worker. By default, the Bicep CLI binary will be selected by your <code>PATH</code> environment variable.</p> <p>Optionally you can configure an alternative Bicep CLI binary to use by either:</p> <ul> <li>By path \u2014 Set the PSRULE_AZURE_BICEP_PATH environment variable to the specified binary path.</li> <li>From Azure CLI \u2014 Set the PSRULE_AZURE_BICEP_USE_AZURE_CLI environment variable to <code>true</code>.</li> </ul> <p>For more details on installing and configuring the Bicep CLI, see Setup Bicep.</p>"},{"location":"troubleshooting/#bicep-features","title":"Bicep features","text":"<p>Generally PSRule for Azure plans to support any language features that are supported by the latest version of Bicep. New language features are often added behind an experimental feature flag for community feedback. Features flagged by Bicep as experimental may not be supported by PSRule for Azure immediately. PSRule for Azure will plan to add support as soon as possible after the feature flag is removed.</p> <p>If you are using a Bicep feature that is not supported by PSRule for Azure, please join or start a discussion.</p>"},{"location":"troubleshooting/#bicep-compilation-timeout","title":"Bicep compilation timeout","text":"<p>When expanding Bicep source files you may get an error similar to the following:</p> <p>Message</p> <p>Bicep (0.4.1124) compilation of 'C:\\temp\\deploy.bicep' failed with: Bicep compilation hasn't completed within the timeout window. This can be caused by errors or warnings. Check the Bicep output by running bicep build and addressing any issues.</p> <p>This error is raised when Bicep takes longer then the timeout to build a source file. The default timeout is 5 seconds.</p> <p>You can take steps to reduce your code complexity and reduce the time a build takes by:</p> <ul> <li>Removing unnecessary nested <code>module</code> calls.</li> <li>Cache bicep modules restored from a registry in continuous integration (CI) pipelines.</li> </ul> <p>To increase the timeout value, set the <code>AZURE_BICEP_FILE_EXPANSION_TIMEOUT</code> configuration option. See Bicep compilation timeout for details on how to configure this option.</p>"},{"location":"troubleshooting/#no-rules-or-no-azure-resources-are-found","title":"No rules or no Azure resources are found","text":"<p>There is a few common causes of this issue including:</p> <ul> <li>Check input format \u2014 PSRule for Azure must discover files to expand them.<ul> <li>When running PSRule for Azure using GitHub Actions or the Azure Pipelines extension:<ul> <li>Your pipeline must be set to <code>inputType: repository</code>, which is the default value.</li> <li>PSRule for Azure will not work with <code>inputType</code> set to <code>inputPath</code>.</li> <li>You may have set this parameter because you wanted to use the <code>inputPath</code> parameter.   Setting the <code>inputType</code> is not a requirement for using the <code>inputPath</code> parameter.   The <code>inputPath</code> parameter can be used independently.</li> </ul> </li> <li>When running PSRule for Azure from PowerShell:<ul> <li>Your command-line must use the <code>-Format File</code> parameter.</li> <li>Your command-line must use the <code>-InputPath</code> or <code>-f</code> parameter followed by a file or directory path.</li> <li>For example: <code>Assert-PSRule -Module PSRule.Rules.Azure -Format File -f 'modules/'</code>.</li> </ul> </li> </ul> </li> <li>Check expansion is enabled \u2014 Expansion must be enabled to analyze Azure Infrastructure as Code.   See using templates and using Bicep source for details on how to enable expansion.</li> <li>Check parameter files are linked \u2014 Parameter files must be linked to ARM templates or Bicep source files.   See using templates for details on how to link using metadata or naming convention.</li> </ul> <p>Note</p> <p>If your pipeline is still not finding any Azure resources, please join or start a discussion.</p>"},{"location":"troubleshooting/#custom-rules-are-not-running","title":"Custom rules are not running","text":"<p>There is a few common causes of this issue including:</p> <ul> <li>Check rule path \u2014 By default, PSRule will look for rules in the <code>.ps-rule/</code> directory.   This directory is the root for your repository or the current working path by default.   On case-sensitive file systems such as Linux, this directory name is case-sensitive.   See Storing and naming rules for more information.</li> <li>Check file name suffix \u2014 PSRule only looks for files with the <code>.Rule.ps1</code>, <code>.Rule.yaml</code>, or <code>.Rule.jsonc</code> suffix.   On case-sensitive file systems such as Linux, this file suffix is case-sensitive.   See Storing and naming rules for more information.</li> <li>Check binding configuration \u2014 PSRule uses binding to work out which property to use for a resource type.   To be able to use the <code>-Type</code> parameter or <code>type</code> properties in rules definitions, binding must be set.   This is automatically configured for PSRule for Azure, however must be set in <code>ps-rule.yaml</code> for custom rules.   See binding type for more information.</li> <li>Check modules \u2014 PSRule for Azure is responsible for expanding Azure resources from Infrastructure as Code.   Expansion occurs automatically in memory when enabled.   For this to work, the module <code>PSRule.Rules.Azure</code> must be run with any custom rules.   See using templates and using Bicep source for details on how to enable expansion.</li> <li>Check include local option \u2014 When running PSRule for Azure with a baseline.   Baselines such as quarterly baselines may use filters to limit the rules that are included.   As a result, custom rules may not be included.   To include custom rules set the Rule.IncludeLocal option to <code>true</code>.   See Including custom rules for more information.</li> </ul> <p>Tip</p> <p>You may be able to use <code>git mv</code> to change the case of a file if it is committed to the repository incorrectly.</p>"},{"location":"troubleshooting/#parameter-file-warns-of-metadata-property","title":"Parameter file warns of metadata property","text":"<p>You may find while editing a <code>.json</code> parameter file the root <code>metadata</code> property is flagged with a warning.</p> <p>Message</p> <p>The property 'metadata' is not allowed.</p> Azure parameter file<pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"metadata\": {\n        \"template\": \"./storage.template.json\"\n    },\n    \"parameters\": {\n    }\n}\n</code></pre> <p>This doesn't affect the workings of the parameter file or deployment. The reason for the warning is that the <code>metadata</code> property has not been added to the parameter file JSON schema. However, the top level <code>metadata</code> property is ignored by Azure Resource Manager when deploying a template.</p>"},{"location":"troubleshooting/#issues-with-azresources","title":"Issues with Az.Resources","text":"<p>The PowerShell module <code>Az.Resources</code> and <code>Az.Accounts</code> is currently used when exporting data from Azure. These modules are use when:</p> <ul> <li>Exporting resources for in-flight analysis.</li> <li>Exporting policy assignments for policy as rules.</li> </ul> <p>These modules are not required if you only want to execute rules.</p>"},{"location":"troubleshooting/#suppression-of-azresources-warning","title":"Suppression of Az.Resources warning","text":"<p>If you only intend to execute rules you can suppress the following warning message.</p> <p>Message</p> <p>To use PSRule for Azure export cmdlets please install Az.Resources.</p> <p>This message can be ignored if you are not exporting data from Azure. To suppress the warning configure the <code>PSRULE_AZURE_RESOURCE_MODULE_NOWARN</code> environment variable to <code>true</code>. For more details see Configuring exports.</p>"},{"location":"troubleshooting/#installing-azresources","title":"Installing Az.Resources","text":"<p>If you plan on exporting data from Azure, you must install the <code>Az.Resources</code> module.</p> <p>Some versions of <code>Az.Resources</code> are known to be incompatible with PSRule for Azure. As a result, we recommend installing and importing v6.7.0 to address these issues. A known incompatibility currently exists with v7.1.0 (#2970). By default, PowerShell will attempt to install or use a newer version already installed which may return an error.</p> <p>Message</p> <p>ExpandPolicyAssignment: The property 'Properties' cannot be found on this object. Verify that the property exists.</p> <p>To install a specific version use:</p> PowerShell<pre><code>Install-Module Az.Resources -RequiredVersion '6.7.0' -Force -Scope CurrentUser\n</code></pre> <p>To import a specific version prior to using PSRule:</p> PowerShell<pre><code>Import-Module Az.Resources -RequiredVersion '6.7.0'\n</code></pre>"},{"location":"troubleshooting/#could-not-load-file-or-assembly-yamldotnet","title":"Could not load file or assembly YamlDotNet","text":"<p>PSRule &gt;=1.3.0 uses an updated version of the YamlDotNet library. The PSRule for Azure &lt;1.3.1 uses an older version of this library which may conflict.</p> <p>To avoid this issue:</p> <ul> <li>Update to the latest version and use PSRule for Azure &gt;=1.3.1 with PSRule &gt;=1.3.0.</li> <li>Alternatively, when using PSRule for Azure &lt;1.3.1 use PSRule =1.2.0.</li> </ul> <p>To install the latest module version of PSRule use the following commands:</p> PowerShell<pre><code>Install-Module -Name PSRule.Rules.Azure -MinimumVersion 1.3.1 -Scope CurrentUser -Force;\n</code></pre> <p>For the PSRule GitHub Action, use &gt;=1.4.0.</p> GitHub Actions<pre><code>- name: Run PSRule analysis\n  uses: microsoft/ps-rule@v2.9.0\n</code></pre>"},{"location":"upgrade-notes/","title":"Upgrade notes","text":"<p>This document contains notes to help upgrade from previous versions of PSRule for Azure.</p>"},{"location":"upgrade-notes/#upgrading-to-v200","title":"Upgrading to v2.0.0","text":"<p>PSRule for Azure v2.0.0 is a planned future release. It's not yet available, but you can take these steps to proactively prepare for the release.</p>"},{"location":"upgrade-notes/#realigned-configuration-option-names","title":"Realigned configuration option names","text":"<p>Several configuration options will be renamed in upcoming releases of PSRule for Azure. This is part of a ongoing effort to align the naming of configuration options across PSRule for Azure. For information on other options that will be renamed see deprecations.</p> <p>You only need to take action if you have explicitly set old configuration option names.</p> <p>The old option names may be set in:</p> <ul> <li>An option file such as <code>ps-rule.yaml</code>.</li> <li>A custom baseline.</li> <li>An environment variable.</li> </ul> <p>To locate any configurations, search for the old option names within your Infrastructure as Code repo.</p> New name Old name Available from <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> <code>Azure_AKSMinimumVersion</code>  v1.12.0 <code>AZURE_AKS_POOL_MINIMUM_MAXPODS</code> <code>Azure_AKSNodeMinimumMaxPods</code>  v1.39.0 <code>AZURE_RESOURCE_ALLOWED_LOCATIONS</code> <code>Azure_AllowedRegions</code>  v1.30.0 <code>AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME</code> <code>Azure_MinimumCertificateLifetime</code>  v1.39.0 <p>To update your configuration, use the new name instead.</p> <p>Note</p> <p>Environment variables are prefixed by <code>PSRULE_CONFIGURATION_</code> and are case sensitive.</p> Options fileBashGitHub ActionsAzure Pipelines <p>Set the <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> option in <code>ps-rule.yaml</code>.</p> <pre><code># YAML: Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option to 1.27.3\nconfiguration:\n  AZURE_AKS_CLUSTER_MINIMUM_VERSION: 1.27.3\n</code></pre> <p>Set the <code>PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> environment variable.</p> <pre><code># Bash: Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option to 1.27.3\nexport PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION=\"1.27.3\"\n</code></pre> <p>Set the <code>PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> environment variable.</p> <pre><code># GitHub Actions: Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option to 1.27.3\nenv:\n  PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION: '1.27.3'\n</code></pre> <p>Set the <code>PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> environment variable.</p> <pre><code># Azure Pipelines: Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option to 1.27.3\nvariables:\n- name: PSRULE_CONFIGURATION_AZURE_AKS_CLUSTER_MINIMUM_VERSION\n  value: '1.27.3'\n</code></pre>"},{"location":"upgrade-notes/#realignment-of-rule-names-for-network-interfaces","title":"Realignment of rule names for network interfaces","text":"<p>Originally when many of the rules targeting network interfaces were created, network interfaces only applied to virtual machines. Today, network interfaces can be attached to different types of resources including:</p> <ul> <li>Virtual machines.</li> <li>Private endpoints.</li> <li>Private link services.</li> </ul> <p>To better reflect that network interfaces are not only related to VMs, the following rules have been renamed:</p> <ul> <li>From <code>Azure.VM.NICAttached</code> to <code>Azure.NIC.Attached</code>.</li> <li>From <code>Azure.VM.NICName</code> to <code>Azure.NIC.Name</code>.</li> <li>From <code>Azure.VM.UniqueDns</code> to <code>Azure.NIC.UniqueDns</code>.</li> </ul> <p>Aliases have been added to ensure any existing suppression and exclusion to these rules continues to work. However a warning will be displayed to indicate the an alias is being used.</p> <p>To update your configuration, use the new rule names instead. Possible locations where the old rule names may be used include:</p> <ul> <li>Within the <code>suppression</code> option defined within <code>ps-rule.yaml</code> or by using <code>New-PSRuleOption</code>.</li> <li>Within the <code>rule.exclude</code> or <code>rule.include</code> option defined within <code>ps-rule.yaml</code> or by using <code>New-PSRuleOption</code>.</li> <li>Within the <code>rule.exclude</code> or <code>rule.include</code> option defined within a custom baseline.</li> <li>Other custom scripts that run PSRule cmdlets directly.</li> </ul>"},{"location":"upgrade-notes/#removal-of-supportstags-function","title":"Removal of SupportsTags function","text":"<p>The <code>SupportsTags</code> function is a PowerShell function used for filtering rules. Previously you could use this function to only run a rule against resources that support tags. As of v1.15.0 this function has been deprecated for removal in the next major release v2.0.0.</p> <p>From v2.0.0 the <code>SupportsTags</code> function will not longer work.</p> <p>The <code>SupportsTags</code> function was previously only available for PowerShell rules and not well documented. Instead you can use the <code>Azure.Resource.SupportsTags</code> selector introduced in v1.15.0. This selector supports the the same features but also supports YAML and JSON rules in addition to PowerShell.</p> <p>To upgrade your PowerShell rules use the <code>-With</code> parameter to set <code>Azure.Resource.SupportsTags</code>. For example:</p> <pre><code># Synopsis: Old rule using the SupportsTags function\nRule 'Local.MyRule' -If { (SupportsTags) } {\n  # Rule logic goes here\n}\n\n# Synopsis: Rule updated using the Azure.Resource.SupportsTags selector\nRule 'Local.MyRule' -With 'Azure.Resource.SupportsTags' {\n  # Rule logic goes here\n}\n</code></pre> <p>To read more about the selector, see the documentation.</p>"},{"location":"using-bicep/","title":"Using Bicep source","text":"<p>PSRule for Azure discovers and analyzes Azure resources contained within Bicep files. To enable this feature, you need to:</p> <ul> <li>Enable expansion.</li> <li>For modules (if used):<ul> <li>Define a deployment or parameters file.</li> <li>Configure path exclusions.</li> </ul> </li> </ul> <p>Abstract</p> <p>This topic covers how you can validate Azure resources within <code>.bicep</code> files. To learn more about why this is important see Expanding source files.</p>"},{"location":"using-bicep/#enabling-expansion","title":"Enabling expansion","text":"<p>To expand Bicep deployments configure <code>ps-rule.yaml</code> with the <code>AZURE_BICEP_FILE_EXPANSION</code> option.</p> ps-rule.yaml<pre><code># YAML: Enable expansion for Bicep source files.\nconfiguration:\n  AZURE_BICEP_FILE_EXPANSION: true\n</code></pre> <p>Note</p> <p>If you are using JSON parameter files exclusively, you do not need to set this option. Instead continue reading using parameter files.</p>"},{"location":"using-bicep/#setup-bicep","title":"Setup Bicep","text":"<p>To expand Azure resources for analysis from Bicep source files the Bicep CLI is required. The Bicep CLI is already installed on hosted runners and agents used by GitHub Actions and Azure Pipelines. For details on how to configure Bicep for PSRule for Azure see Setup Bicep.</p>"},{"location":"using-bicep/#building-files","title":"Building files","text":"<p>It's not necessary to build <code>.bicep</code> files with <code>bicep build</code> or <code>az bicep build</code>. PSRule will automatically detect and build <code>.bicep</code> files. You may choose to pre-build <code>.bicep</code> files if the Bicep CLI is not available when PSRule is run.</p> <p>Important</p> <p>If using this method, follow using templates instead. Using <code>bicep build</code> transpiles Bicep code into an Azure template <code>.json</code>.</p>"},{"location":"using-bicep/#testing-bicep-modules","title":"Testing Bicep modules","text":"<p>Bicep allows you to separate out complex details into separate files called modules. To expand resources, any parameters must be resolved.</p> <p>Tip</p> <p>If you are not familiar with the concept of expansion within PSRule for Azure see Expanding source files.</p> <p>Two types of parameters exist, required (also called mandatory) and optional. An optional parameter is any parameter with a default value. Required parameters do not have a default value and must be specified.</p> <p>Example <code>modules/storage/main.bicep</code></p> <pre><code>// Required parameter\nparam name string\n\n// Optional parameters\nparam location string = resourceGroup().location\nparam sku string = 'Standard_LRS'\n</code></pre> <p>To specify required parameters for a module, create a deployment or test that references the module.</p> <p>Example <code>deploy.bicep</code></p> <pre><code>// Deploy storage account to production subscription\nmodule storageAccount './modules/storage/main.bicep' = {\n  name: 'deploy-storage'\n  params: {\n    name: 'stpsrulebicep001'\n    sku: 'Standard_GRS'\n  }\n}\n</code></pre> <p>Example <code>modules/storage/.tests/main.tests.bicep</code></p> <pre><code>// Test with only required parameters\nmodule test_required_params '../main.bicep' = {\n  name: 'test_required_params'\n  params: {\n    name: 'sttest001'\n  }\n}\n</code></pre>"},{"location":"using-bicep/#configuring-path-exclusions","title":"Configuring path exclusions","text":"<p>Unless configured, PSRule will discover all <code>.bicep</code> files when expansion is enabled. Bicep module files with required parameters will not be able be expanded and should be excluded. Instead expand resources from deployments or tests.</p> <p>To do this configure <code>ps-rule.yaml</code> with the <code>input.pathIgnore</code> option.</p> <p>Example <code>ps-rule.yaml</code></p> <pre><code>configuration:\n  # Enable expansion for Bicep source files.\n  AZURE_BICEP_FILE_EXPANSION: true\n\ninput:\n  pathIgnore:\n  # Exclude bicepconfig.json\n  - 'bicepconfig.json'\n  # Exclude module files\n  - 'modules/**/*.bicep'\n  # Include test files from modules\n  - '!modules/**/*.tests.bicep'\n</code></pre> <p>Note</p> <p>In this example, Bicep files such as <code>deploy.bicep</code> in other directories will be expanded.</p>"},{"location":"using-bicep/#using-parameter-files","title":"Using parameter files","text":"<p>When using Bicep, you don't need to use parameter files. You can call <code>.bicep</code> files directly from other <code>.bicep</code> files with modules by using the <code>module</code> keyword.</p> <p>Alternatively, Bicep supports two options for parameter files:</p> <ul> <li>JSON parameter files \u2014 This format uses conventional JSON syntax compatible with ARM templates.</li> <li>Bicep parameter files \u2014 This format uses Bicep language from a <code>.bicepparam</code> file to reference a Bicep module.</li> </ul> <p>Each option is described in more detail in the following sections.</p>"},{"location":"using-bicep/#using-json-parameter-files","title":"Using JSON parameter files","text":"<p>You can choose to expand and test a Bicep module from JSON parameter files by metadata.</p> <p>When using parameter files exclusively, the <code>AZURE_BICEP_FILE_EXPANSION</code> configuration option does not need to be set. Instead set the <code>AZURE_PARAMETER_FILE_EXPANSION</code> configuration option to <code>true</code>. This option will discover Bicep files from parameter metadata.</p> <p>Example <code>ps-rule.yaml</code></p> <pre><code>configuration:\n  # Enable expansion for Bicep module from parameter files.\n  AZURE_PARAMETER_FILE_EXPANSION: true\n\ninput:\n  pathIgnore:\n  # Exclude bicepconfig.json\n  - 'bicepconfig.json'\n  # Exclude module files\n  - 'modules/**/*.bicep'\n</code></pre> <p>Example <code>template.parameters.json</code></p> <pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"metadata\": {\n        \"template\": \"./template.bicep\"\n    },\n    \"parameters\": {\n        \"storageAccountName\": {\n            \"value\": \"bicepstorage001\"\n        },\n        \"tags\": {\n            \"value\": {\n                \"env\": \"test\"\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"using-bicep/#using-bicep-parameter-files","title":"Using Bicep parameter files","text":"<p>v1.34.0</p> <p>You can use <code>.bicepparam</code> files to reference your Bicep modules as a method for providing parameters. Using the Bicep parameter file format, allows you to get many of the benefits of the Bicep language.</p> <p>For example:</p> <pre><code>using 'main.bicep'\n\nparam storageAccountName = 'bicepstorage001'\nparam tags = {\n  env: 'test'\n}\n</code></pre> <p>Learn</p> <p>To learn more about Bicep parameter files see Create parameters files for Bicep deployment.</p> <p>Note</p> <p>To use Bicep parameter files you must use a minimum of Bicep CLI version 0.18.4. You can configure PSRule to check for the minimum Bicep version. See configuring minimum version for information on how to enable this check.</p>"},{"location":"using-bicep/#restoring-modules-from-a-private-registry","title":"Restoring modules from a private registry","text":"<p>Bicep modules can be stored in a private registry. Storing modules in a private registry gives you a central location to reference modules across your organization.</p> <p>To test Bicep deployments which uses modules stored in a private registry, these modules must be restored. The restore process automatically occurs when PSRule is run, however some additional steps are required to authenticate.</p> <p>To prepare your registry for storing Bicep modules see Create private registry for Bicep modules.</p> <p>To configure authentication for PSRule to a private registry:</p> <ul> <li>Configure <code>bicepconfig.json</code></li> <li>Granting access to a private registry</li> <li>Set pipeline environment variables</li> </ul> <p>Some organizations may want to expose Bicep modules publicly. This can be configured by enabling anonymous pull access. To configure your registry see Make your container registry content publicly available.</p> <p>Note</p> <p>To use anonymous pull access to a registry you must use a minimum of Bicep CLI version 0.15.31. You can configure PSRule to check for the minimum Bicep version. See configuring minimum version for information on how to enable this check.</p>"},{"location":"using-bicep/#configure-bicepconfigjson","title":"Configure <code>bicepconfig.json</code>","text":"<p>To authenticate to a private registry, configure <code>bicepconfig.json</code> by setting credentialPrecedence. This setting determines the order to find a credential to use when authenticating to the registry.</p> <p>Use the following credential type based on your environment as the first value of the credentialPrecedence setting:</p> <ul> <li><code>Environment</code> \u2014 Use environment variables to authenticate to the registry.   This is the most common scenario for CI pipelines and works for cloud-hosted or self-hosted agents/ private runners.</li> <li><code>ManagedIdentity</code> \u2014 Use a managed identity to authenticate to the registry.   This may be applicable for scenarios where you are using self-hosted agents or private runners.   You must configure a System-Assigned managed identity for the Azure Virtual Machine or Virtual Machine Scale Set.</li> </ul> <p>Example <code>bicepconfig.json</code></p> <pre><code>{\n  \"credentialPrecedence\": [\n    \"Environment\",\n    \"AzureCLI\",\n  ]\n}\n</code></pre> <p>Tip</p> <p>The <code>bicepconfig.json</code> configures the Bicep CLI. You should commit this file into a repository along with your Bicep code.</p>"},{"location":"using-bicep/#granting-access-to-a-private-registry","title":"Granting access to a private registry","text":"<p>To access a private registry use an Entra ID identity which has been granted permissions to pull Bicep modules. When using <code>Environment</code> credential type, see create a service principal that can access resources to create the identity. If you are using the <code>ManagedIdentity</code> credential type, an identity is created for when you configure the managed identity.</p> <p>After configuring the identity, grant access using the <code>AcrPull</code> built-in RBAC role on the Azure Container Registry.</p>"},{"location":"using-bicep/#set-pipeline-environment-variables","title":"Set pipeline environment variables","text":"<p>When using the <code>Environment</code> credential type, environment variables should be set in the pipeline. Typically, the following three environment variables should be set:</p> <ul> <li><code>AZURE_CLIENT_ID</code> \u2014 The Client ID (also called Application ID) of an App Registration in Azure AD.   This will be represented as a GUID.</li> <li><code>AZURE_CLIENT_SECRET</code> \u2014 A valid secret that was generated for the App Registration.</li> <li><code>AZURE_TENANT_ID</code> \u2014 The Tenant ID that identifies your specific Azure AD tenant where your App Registration is created.   This will be represented as a GUID.</li> </ul> <p>Note</p> <p>The environment credential type also supports other environment variables that may be applicable to your environment. To see a list visit EnvironmentCredential Class.</p> GitHub ActionsAzure Pipelines <p>Configure the <code>microsoft/ps-rule</code> action with Azure environment variables.</p> <pre><code>- name: Analyze Azure template files\n  uses: microsoft/ps-rule@v2.9.0\n  with:\n    modules: PSRule.Rules.Azure,PSRule.Monitor\n    conventions: Monitor.LogAnalytics.Import\n  env:\n    # Define environment variables using GitHub encrypted secrets\n    AZURE_CLIENT_ID: ${{ secrets.BICEP_REGISTRY_CLIENTID }}\n    AZURE_CLIENT_SECRET: ${{ secrets.BICEP_REGISTRY_CLIENTSECRET }}\n    AZURE_TENANT_ID: ${{ secrets.BICEP_REGISTRY_TENANTID }}\n</code></pre> <p>Important</p> <p>Environment variables can be configured in the workflow or from a secret. To keep <code>BICEP_REGISTRY_CLIENTSECRET</code> secure, use an encrypted secret.</p> <p>Configure the <code>ps-rule-assert</code> task with Azure environment variables.</p> <pre><code>- task: ps-rule-assert@2\n  displayName: Analyze Azure template files\n  inputs:\n    modules: 'PSRule.Rules.Azure'\n  env:\n    # Define environment variables within Azure Pipelines\n    AZURE_CLIENT_ID: $(BICEPREGISTRYCLIENTID)\n    AZURE_CLIENT_SECRET: $(BICEPREGISTRYCLIENTSECRET)\n    AZURE_TENANT_ID: $(BICEPREGISTRYTENANTID)\n</code></pre> <p>Important</p> <p>Variables can be configured in YAML, on the pipeline, or referenced from a defined variable group. To keep <code>BICEPREGISTRYCLIENTSECRET</code> secure, use a variable group linked to an Azure Key Vault.</p>"},{"location":"using-bicep/#recommended-content","title":"Recommended content","text":"<ul> <li>Setup Bicep</li> <li>Bicep compilation timeout</li> <li>Troubleshooting</li> </ul>"},{"location":"using-templates/","title":"Using templates","text":"<p>PSRule for Azure discovers and analyzes Azure resources contained within template and parameter files. To enable this feature, you need to:</p> <ol> <li>Enable expansion.</li> <li>Link parameter files to templates.</li> </ol> <p>Abstract</p> <p>This topic covers how you can validate Azure resources within template <code>.json</code> files. To learn more about why this is important see Expanding source files.</p>"},{"location":"using-templates/#enabling-expansion","title":"Enabling expansion","text":"<p>To expand parameter files configure <code>ps-rule.yaml</code> with the <code>AZURE_PARAMETER_FILE_EXPANSION</code> option.</p> ps-rule.yaml<pre><code># YAML: Enable expansion for template expansion.\nconfiguration:\n  AZURE_PARAMETER_FILE_EXPANSION: true\n</code></pre> <p>After enabling expansion, PSRule for Azure will start to discover ARM templates and Bicep module from parameter files. Supported parameter files must:</p> <ul> <li>The use <code>.parameters.json</code> or <code>.parameters.jsonc</code> suffix. i.e. <code>deploy.parameters.jsonc</code>.</li> <li>The use either of the following schemas:<ul> <li><code>https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#</code> OR</li> <li><code>https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#</code></li> </ul> </li> <li>Must be linked to a template or Bicep module using one of the methods described below.</li> </ul>"},{"location":"using-templates/#linking-templates","title":"Linking templates","text":"<p>PSRule for Azure automatically detects parameter files and uses the following logic to link templates or Bicep modules.</p> <ul> <li>By metadata \u2014 Check parameter file for a metadata link identifying the associated template.</li> <li>By naming convention \u2014 Check for matching template files using file naming convention.</li> </ul> <p>Note</p> <p>Metadata links take priority over naming convention. For details on both options continue reading.</p> <p>Tip</p> <p>Linking templates also applies to Bicep modules when you are using JSON parameter files.</p>"},{"location":"using-templates/#by-metadata","title":"By metadata","text":"<p>A parameter file can be linked to an associated template or Bicep module by setting metadata. To link a template within a parameter file, set the <code>metadata.template</code> property to the path of the template.</p> <p>PSRule for Azure supports either:</p> <ul> <li>Relative to repository \u2014 By default, the path is relative to the root of the repository.</li> <li>Relative to template \u2014 To use a path relative to the parameter file,   prefix the path with <code>./</code>.</li> </ul> <p>Tip</p> <p>Referencing a path outside of the repository is blocked as this could lead to unintended exposure.</p> Relative to repositoryRelative to parameter file <p>The following example shows linking to a template which is stored within a hierarchical <code>template/</code> sub-directory.</p> <p>Example</p> <pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"metadata\": {\n        \"template\": \"templates/storage/v1/template.json\"\n    },\n    \"parameters\": {\n    }\n}\n</code></pre> <p>The following example shows linking to a template that is in the same directory as the parameter file.</p> <p>Example</p> <pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"metadata\": {\n        \"template\": \"./storage.template.json\"\n    },\n    \"parameters\": {\n    }\n}\n</code></pre> <p>Additional benefits you get by using metadata links include:</p> <ul> <li>You can share a common set of versioned templates across multiple deployments in a repository.   This works great to mono-repositories.</li> <li>You can discover all the deployments using a specific template by reading metadata.   PSRule for Azure includes the <code>Get-AzRuleTemplateLink</code> cmdlet to list parameter file links.</li> </ul> <p>Tip</p> <p>By default, metadata links are not required. By configuring the <code>AZURE_PARAMETER_FILE_METADATA_LINK</code> option to <code>true</code>, this can be enforced. When configured, PSRule for Azure will fail parameter files that do not contain a metadata link. For details on <code>AZURE_PARAMETER_FILE_METADATA_LINK</code> see Configuring expansion.</p> <p>Note</p> <p>Bicep modules can also be expanded from parameter files. Instead of specifying a template path, you can specify the path to a Bicep file.</p> <p>Note</p> <p>You may find while editing a <code>.json</code> parameter file the root <code>metadata</code> property is flagged with a warning. For example <code>Property metadata is not allowed.</code>. This doesn't affect the workings of the parameter file or deployment. If you like a detailed description continue reading Troubleshooting.</p>"},{"location":"using-templates/#by-naming-convention","title":"By naming convention","text":"<p>When metadata links are not set, PSRule will fallback to use a naming convention to link to template files.</p> <p>Example</p> <p>A parameter file named <code>azuredeploy.parameters.json</code> links to the template file named <code>azuredeploy.json</code>.</p> <p>PSRule for Azure supports linking by naming convention when:</p> <ul> <li>Parameter files end with <code>.parameters.json</code> or <code>.parameters.jsonc</code> linking to ARM templates or Bicep modules.</li> <li>The parameter file prefix matches the file name of the template or Bicep module.   For example, <code>azuredeploy.parameters.json</code> links to <code>azuredeploy.json</code>, <code>azuredeploy.jsonc</code>, or <code>azuredeploy.bicep</code>.</li> <li>Both parameter file and template or Bicep module must be in the same directory.</li> <li>The following search order is used to determine the file that will be used if multiple template or Bicep files exist:<ol> <li>ARM template file with the <code>.json</code> extension.</li> <li>ARM template file with the <code>.jsonc</code> extension.</li> <li>Bicep module file with the <code>.bicep</code> extension.</li> </ol> </li> </ul> <p>For example, <code>azuredeploy.parameters.json</code> links to <code>azuredeploy.json</code> over <code>azuredeploy.jsonc</code> or <code>azuredeploy.bicep</code>. When <code>azuredeploy.json</code> does not exist, <code>azuredeploy.jsonc</code> is chosen. Finally <code>azuredeploy.parameters.json</code> will link to <code>azuredeploy.bicep</code> if neither of the other files exist.</p> <p>The following is not currently supported:</p> <ul> <li>Using a different naming convention for parameter files such as <code>&lt;templateName&gt;.param.json</code>.</li> <li>Template or parameter files with alternative file extensions such as <code>.jsonc</code>.</li> </ul>"},{"location":"versioning/","title":"Changes and versioning","text":"<p>As PSRule evolves over time features and rules are added, updated, and removed. PSRule for Azure uses semantic versioning to declare breaking changes.</p> <ul> <li>Major releases are infrequent in nature, but created on an as-needed basis.   You can check the upgrade notes to plan for the changes of the next major release.</li> <li>Minor releases are shipped normally each month.</li> <li>Patch releases to fix bugs for the most recent minor version are released on an as-needed basis.</li> </ul> <p>The latest module version can be installed from the PowerShell Gallery and NuGet. For a list of module changes please see the change log.</p>"},{"location":"versioning/#module-releases","title":"Module releases","text":""},{"location":"versioning/#stable-releases","title":"Stable releases","text":"<p>Stable modules versions are identified by a version number (<code>major.minor.patch</code>) such as <code>1.34.2</code>. A stable release is considered production ready and is recommended for general use. These versions are can be installed from the PowerShell Gallery or NuGet.</p> <p>When using PSRule extensions in GitHub and Azure Pipelines, the latest stable version is automatically installed by default when an existing version is not already installed.</p> <p>The version of PSRule and PSRule for Azure modules can be viewed by default in the output of each run.</p>"},{"location":"versioning/#pre-releases","title":"Pre-releases","text":"<p>Pre-release module versions are created on major commits and can be installed from the PowerShell Gallery. Module versions and change log details for pre-releases will be removed as stable releases are made available.</p> <p>You can identify a pre-release version by the pre-release suffix on the end of the version (<code>major.minor.patch-prerelease</code>). For example, <code>1.35.0-B0055</code>.</p> <p>To use a pre-release version you will need to install it specifically. To do this, insert a PowerShell step in your pipeline to install the module with the <code>-AllowPrerelease</code> switch.</p> <p>For example:</p> <pre><code>Install-Module -Name 'PSRule.Rules.Azure' -RequiredVersion '1.35.0-B0055' -AllowPrerelease -Force;\n</code></pre> <p>Important</p> <p>Pre-release versions should be considered work in progress. These releases should not be used in production. We may introduce breaking changes between a pre-release as we work towards a stable version release.</p>"},{"location":"versioning/#experimental-features","title":"Experimental features","text":"<p>From time to time we may ship experiential features. Experiential features are shipped so that customers can try them out and provide feedback. These features are generally marked experimental in the change log as these features ship. Experimental features may ship in stable releases, however to use them you may need to:</p> <ul> <li>Enable or explicitly reference them.</li> </ul> <p>Important</p> <p>Experimental features should be considered work in progress. These features may be incomplete and should not be used in production. We may introduce breaking changes for experimental features as we work towards a general release for the feature.</p>"},{"location":"versioning/#rule-lifecycle","title":"Rule lifecycle","text":"<p>Common rules are added and updated on a regular basis. Occasionally rules are removed or deprecated.</p> <p>The following information outlines how changes to rules are managed within PSRule for Azure.</p> <ul> <li>New - rules are introduced to PSRule for Azure on a regular basis as Azure evolves and recommended practices are identified.   Recommended practices are aligned to the Azure Well-Architected Framework.   Each rule is added to a rule set which identifies the quarter and year the rule was added/ updated (e.g. <code>2024_03</code>).</li> <li>Bug fix - is a change that corrects a rule that is not working as intended.   These updates are shipped regularly in the next release.   Typically no action is required to receive these updates in addition to using the latest release.</li> <li>Revision - is an improvement to the rule that changes the behavior of the rule.   Most commonly these changes are made to better align with the intent of the rule and Azure features as they evolve.   The changes log, GitHub issue, rule documentation, and rule set are updated to reflect the change.   Quarterly baselines are provided to help manage these changes by providing a stable checkpoint for a given quarter.   These updates normally ship in the next minor release.</li> <li>Rename - is a change to the rule name to better reflect the intent of the rule or to align with naming conventions.   These changes can occur when Microsoft products or features are renamed, similar rules are renamed to reduce customer confusion.   When a rule is renamed, the old name is added as an alias, this allows existing suppression to continue to work.   A warning will be generated if you are referencing the rule alias so you can update your configuration.   These updates normally ship in the next minor release.</li> <li> <p>Deprecation/ removal - occurs when checking for the conditions of the rule is no longer necessary or it no longer aligns.   In these cases, the rule may be removed or if there is still some customer value it may be retained but not run by default.   For example, the rule may not align to the Well-Architected Framework but is still useful for some customers.   This is done by the means of a feature flag, by requiring a configuration value to be set.   Check the rule documentation for details on any configuration requirements.</p> </li> </ul>"},{"location":"versioning/#reporting-bugs","title":"Reporting bugs","text":"<p>If you experience an issue with a feature or release please let us know by logging an issue as a bug.</p>"},{"location":"working-with-baselines/","title":"Working with baselines","text":"<p>A baseline is a standard PSRule artifact that combines rules and configuration. PSRule for Azure provides several baselines that can be referenced when running PSRule.</p> <p>Abstract</p> <p>This topic covers how to use standard baselines shipped with PSRule for Azure or custom baselines you define.</p>"},{"location":"working-with-baselines/#quarterly-baselines","title":"Quarterly baselines","text":"<p>PSRule for Azure ships new rules on a monthly cadence. As new rules are added, existing pipelines that previously passed may fail based on additional requirements. It is generally expected that files committed to an integration branch such as <code>main</code> continue to pass.</p> <p>PSRule for Azure addresses this through quarterly baselines that provide:</p> <ul> <li>Greater consistency \u2014 Quarterly baselines provide a stable checkpoint of rules to use.   Each quarterly baseline includes rules for generally available (GA) and preview Azure features to date.   Rules released after the quarterly baseline are added to the next quarterly baseline.   New quarterly baselines are released every three (3) months.   Baselines are named <code>Azure.GA_yyyy_mm</code> and <code>Azure.Preview_yyyy_mm</code> based on the release year/ month.</li> <li>Incremental adoption \u2014 It may not be possibly to implement new rules immediately.   Existing backlogs or timelines may make it impossible to add new requirements until a future sprint.   In a future sprint, bump the quarterly baseline to the latest release to get the additional rules.</li> </ul> <p>Considerations for adopting a quarterly baseline include:</p> <ul> <li>The quarterly baselines older than the latest are flagged as obsolete.   Obsolete baselines can still be used, however will generate a warning.</li> <li>As Azure evolves there may be cases where a feature change means a rule is no longer required.   In these cases, a rule may be removed from PSRule for Azure and any applicable baselines.</li> <li>Separate quarterly baselines for Azure GA and preview features are provided.   The baseline for GA features is named <code>Azure.GA_yyyy_mm</code> and preview features is named <code>Azure.Preview_yyyy_mm</code>.</li> </ul> <p>Important</p> <p>When using a quarterly baseline, by default PSRule will ignore custom/ standalone rules. To include custom rules, set the <code>Rule.IncludeLocal</code> option to <code>true</code>. This is described further in including custom rules.</p> <p>Note</p> <p>The preview quarterly baselines includes Azure features released under preview only. This is different from the <code>Azure.Preview</code> baseline which contains GA and preview features.</p>"},{"location":"working-with-baselines/#limitations","title":"Limitations","text":"<p>Quarterly baselines don't address all cases where a previously passing pipeline may fail, specifically:</p> <ul> <li>As bugs are identified they are corrected and shipped in the next minor or patch release.   If the rule was not correctly working previously, failures may be generated after the fix.   To workaround this you can either:<ul> <li>Create a temporary suppression to ignore the issue.</li> <li>Install a previous version of the PSRule for Azure module.</li> </ul> </li> <li>Rule configuration defaults change.   Currently rule configuration defaults are not included in quarterly baselines.   To workaround this, override the rule configuration option by setting the value in <code>ps-rule.yaml</code>.</li> </ul>"},{"location":"working-with-baselines/#pillar-specific-baselines","title":"Pillar specific baselines","text":"<p>v1.35.0</p> <p>Pillar specific baselines includes rules aligned to a specific Microsoft Azure Well-Architected Framework pillar.</p> <p>Use these baselines to focus on improvement aligned to a specific area of the Azure Well-Architected Framework. Only rules that related to GA Azure features are included in these baselines. These baselines are best used for ad-hoc scans.</p> <p>The following baselines are available:</p> <ul> <li><code>Azure.Pillar.CostOptimization</code> \u2014 A baseline that only includes cost optimization rules.</li> <li><code>Azure.Pillar.OperationalExcellence</code> \u2014 A baseline that only includes operational excellence rules.</li> <li><code>Azure.Pillar.PerformanceEfficiency</code> \u2014 A baseline that only includes performance efficiency rules.</li> <li><code>Azure.Pillar.Reliability</code> \u2014 A baseline that only includes reliability rules.</li> <li><code>Azure.Pillar.Security</code> \u2014 A baseline that only includes security rules.</li> </ul>"},{"location":"working-with-baselines/#additional-standard-baselines","title":"Additional standard baselines","text":"<p>In additional to quarterly and pillar specific baselines, some additional baselines exist:</p> <ul> <li><code>Azure.Default</code> \u2014 Includes rules for GA Azure features.   This is the default baseline that is used when no baseline is specified.   Rules for Azure features that are within the scope of a public or private preview are not included.</li> <li><code>Azure.Preview</code> \u2014 Includes all rules for GA and preview Azure features.</li> <li><code>Azure.All</code> \u2014 Includes all Azure rules shipped with PSRule for Azure.   This is functionally the same as <code>Azure.Preview</code> however intended for internal use only.</li> <li> <p><code>Azure.MCSB.v1</code> \u2014 Includes rules related to Microsoft cloud security benchmark (MCSB) controls.   This baseline is currently experimental and may change in future releases.   You can learn more about MCSB within PSRule for Azure in the Microsoft cloud security benchmark (MCSB) topic.</p> </li> </ul>"},{"location":"working-with-baselines/#using-baselines","title":"Using baselines","text":"<p>To use a baseline within a CI pipeline specify the baseline by name. See reference for a list baselines shipped with PSRule for Azure.</p> GitHub ActionsAzure PipelinesPowerShell <p>Update your GitHub Actions workflow by specifying <code>baseline: &lt;name_of_baseline&gt;</code>.</p> <pre><code># Analyze Azure resources using PSRule for Azure\n- name: Analyze Azure template files\n  uses: microsoft/ps-rule@v2.9.0\n  with:\n    modules: 'PSRule.Rules.Azure'\n    baseline: 'Azure.GA_2023_12'\n</code></pre> <p>Update your Azure DevOps YAML pipeline by specifying <code>baseline: &lt;name_of_baseline&gt;</code>.</p> <pre><code># Analyze Azure resources using PSRule for Azure\n- task: ps-rule-assert@2\n  displayName: Analyze Azure template files\n  inputs:\n    modules: 'PSRule.Rules.Azure'\n    baseline: 'Azure.GA_2023_12'\n</code></pre> <p>Update your PowerShell command-line with <code>-Baseline &lt;name_of_baseline&gt;</code>.</p> With Assert-PSRule<pre><code>Assert-PSRule -Format File -InputPath '.' -Module 'PSRule.Rules.Azure' -Baseline 'Azure.GA_2023_12'\n</code></pre> With Invoke-PSRule<pre><code>Invoke-PSRule -Format File -InputPath '.' -Module 'PSRule.Rules.Azure' -Baseline 'Azure.GA_2023_12'\n</code></pre>"},{"location":"working-with-baselines/#creating-baselines","title":"Creating baselines","text":"<p>To create your own baselines see the PSRule help topic about_PSRule_Baseline.</p>"},{"location":"working-with-baselines/#including-custom-rules","title":"Including custom rules","text":"<p>v1.8.0</p> <p>The quarterly baselines shipped with PSRule for Azure target a subset of rules for GA Azure features. When you specify a baseline, custom rules you create and store in <code>.ps-rule/</code> will be ignored by default.</p> <p>To change this behavior, set the <code>Rule.IncludeLocal</code> option to <code>true</code>. This option can be set in <code>ps-rule.yaml</code>.</p> ps-rule.yaml<pre><code># YAML: Enable custom rules that don't exist in the baseline\nrule:\n  includeLocal: true\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentData/","title":"Export-AzPolicyAssignmentData","text":"<p>Export policy assignment data.</p>"},{"location":"commands/Export-AzPolicyAssignmentData/#syntax","title":"SYNTAX","text":""},{"location":"commands/Export-AzPolicyAssignmentData/#default-default","title":"Default (Default)","text":"<pre><code>Export-AzPolicyAssignmentData [-OutputPath &lt;String&gt;] [-PassThru] [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentData/#name","title":"Name","text":"<pre><code>Export-AzPolicyAssignmentData [-Name &lt;String&gt;] [-Scope &lt;String&gt;] [-PolicyDefinitionId &lt;String&gt;]\n [-OutputPath &lt;String&gt;] [-PassThru] [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentData/#id","title":"Id","text":"<pre><code>Export-AzPolicyAssignmentData -Id &lt;String&gt; [-PolicyDefinitionId &lt;String&gt;] [-OutputPath &lt;String&gt;] [-PassThru]\n [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentData/#includedescendent","title":"IncludeDescendent","text":"<pre><code>Export-AzPolicyAssignmentData [-Scope &lt;String&gt;] [-IncludeDescendent] [-OutputPath &lt;String&gt;] [-PassThru]\n [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentData/#description","title":"Description","text":"<p>This is an experimental cmdlet.</p> <p>Export policy assignment data.</p> <p>By default the current subscription context will be exported. i.e <code>Get-AzContext</code></p> <p>Policy assignment data will be exported to the current working directory by default as JSON files, one per subscription.</p> <p>All output files include a <code>.assignment.json</code> extension by default.</p>"},{"location":"commands/Export-AzPolicyAssignmentData/#examples","title":"Examples","text":""},{"location":"commands/Export-AzPolicyAssignmentData/#example-1","title":"Example 1","text":"<pre><code>Export-AzPolicyAssignmentData\n</code></pre> <pre><code>Directory: C:\\\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a---        26/03/2022   7:01 PM         740098 \ue60b  00000000-0000-0000-0000-000000000000.assignment.json\n</code></pre> <p>Export policy assignment data from current subscription context.</p>"},{"location":"commands/Export-AzPolicyAssignmentData/#example-2","title":"Example 2","text":"<pre><code>Export-AzPolicyAssignmentData -Name '000000000000000000000000' -Scope '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/PolicyRG'\n</code></pre> <pre><code>Directory: C:\\\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a---        26/03/2022   7:15 PM           4185 \ue60b  00000000-0000-0000-0000-000000000000.assignment.json\n</code></pre> <p>Export policy assignment with specific name and scope.</p>"},{"location":"commands/Export-AzPolicyAssignmentData/#example-3","title":"Example 3","text":"<pre><code>Export-AzPolicyAssignmentData -Id '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/PolicyRG/providers/Microsoft.Authorization/policyAssignments/000000000000000000000000'\n</code></pre> <pre><code>Directory: C:\\\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a---        26/03/2022   7:42 PM           4185 \ue60b  00000000-0000-0000-0000-00000000000.assignment.json\n</code></pre> <p>Export policy assignment with specific resource ID.</p>"},{"location":"commands/Export-AzPolicyAssignmentData/#parameters","title":"PARAMETERS","text":""},{"location":"commands/Export-AzPolicyAssignmentData/#-name","title":"-Name","text":"<p>Specifies the name of the policy assignment.</p> <pre><code>Type: String\nParameter Sets: Name\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentData/#-id","title":"-Id","text":"<p>Specifies the fully qualified resource ID for the policy assignment.</p> <pre><code>Type: String\nParameter Sets: Id\nAliases: AssignmentId\n\nRequired: True\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentData/#-scope","title":"-Scope","text":"<p>Specifies the scope at which the policy is applied for the assignment.</p> <pre><code>Type: String\nParameter Sets: Name, IncludeDescendent\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentData/#-policydefinitionid","title":"-PolicyDefinitionId","text":"<p>Specifies the ID of the policy definition of the policy assignment.</p> <pre><code>Type: String\nParameter Sets: Name, Id\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentData/#-includedescendent","title":"-IncludeDescendent","text":"<p>Causes the list of returned policy assignments to include all assignments related to the given scope, including those from ancestor scopes and those from descendent scopes.</p> <pre><code>Type: SwitchParameter\nParameter Sets: IncludeDescendent\nAliases:\n\nRequired: True\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentData/#-outputpath","title":"-OutputPath","text":"<p>The path to store generated JSON files containing policy assignment data.</p> <pre><code>Type: String\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: $PWD\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentData/#-passthru","title":"-PassThru","text":"<p>By default, FileInfo objects are returned to the pipeline for each JSON file created. When <code>-PassThru</code> is specified, JSON files are not created and Azure resource objects are returned to the pipeline instead.</p> <pre><code>Type: SwitchParameter\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentData/#commonparameters","title":"CommonParameters","text":"<p>This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters.</p>"},{"location":"commands/Export-AzPolicyAssignmentData/#inputs","title":"INPUTS","text":""},{"location":"commands/Export-AzPolicyAssignmentData/#none","title":"None","text":""},{"location":"commands/Export-AzPolicyAssignmentData/#outputs","title":"OUTPUTS","text":""},{"location":"commands/Export-AzPolicyAssignmentData/#systemiofileinfo","title":"System.IO.FileInfo","text":"<p>Return <code>FileInfo</code> for each of the output files created, one per subscription context. This is the default.</p>"},{"location":"commands/Export-AzPolicyAssignmentData/#psobject","title":"PSObject","text":"<p>Return an object for each Azure resource, and configuration exported. This is returned when the <code>-PassThru</code> switch is used.</p>"},{"location":"commands/Export-AzPolicyAssignmentData/#notes","title":"Notes","text":""},{"location":"commands/Export-AzPolicyAssignmentData/#related-links","title":"RELATED LINKS","text":""},{"location":"commands/Export-AzPolicyAssignmentRuleData/","title":"Export-AzPolicyAssignmentRuleData","text":"<p>Export JSON based rules from policy assignment data.</p>"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#syntax","title":"SYNTAX","text":"<pre><code>Export-AzPolicyAssignmentRuleData [-Name &lt;String&gt;] -AssignmentFile &lt;String&gt;\n [-ResourceGroup &lt;ResourceGroupReference&gt;] [-Subscription &lt;SubscriptionReference&gt;] [-OutputPath &lt;String&gt;]\n [-RulePrefix &lt;String&gt;] [-PassThru] [-KeepDuplicates] [&lt;CommonParameters&gt;]\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#description","title":"Description","text":"<p>This is an experimental cmdlet.</p> <p>Export JSON based rules from policy assignment data.</p> <p>Policy assignment data generated from <code>Export-AzPolicyAssignmentData</code> is used to generate JSON rules.</p> <p>By default this is an offline process, requiring no connectivity to Azure.</p> <p>Policy definitions with the <code>Disabled</code> effect are ignored.</p> <p>The <code>subscription()</code> function will return the following unless overridden:</p> <ul> <li>subscriptionId: 'ffffffff-ffff-ffff-ffff-ffffffffffff'</li> <li>tenantId: 'ffffffff-ffff-ffff-ffff-ffffffffffff'</li> <li>displayName: 'PSRule Test Subscription'</li> <li>state: 'NotDefined'</li> </ul> <p>The <code>resourceGroup()</code> function will return the following unless overridden:</p> <ul> <li>name: 'ps-rule-test-rg'</li> <li>location: 'eastus'</li> <li>tags: { }</li> <li>properties:<ul> <li>provisioningState: 'Succeeded'</li> </ul> </li> </ul> <p>To override, set the <code>AZURE_SUBSCRIPTION</code> and <code>AZURE_RESOURCE_GROUP</code> in configuration.</p> <p>The rule prefix <code>Azure</code> is also applied to the policy names unless overridden with <code>-RulePrefix</code> or <code>AZURE_POLICY_RULE_PREFIX</code> in configuration.</p> <p>Currently the following limitations apply:</p> <ul> <li><code>field()</code> expressions are not expanded.</li> <li>Field/Value count expressions are not supported.</li> <li>Template functions with <code>value</code> cannot be expanded e.g. <code>\"value\": \"[substring(field('name'), 0, 3)]\"</code>.</li> <li>Any of the above will lead to errors when emitting JSON rules.</li> </ul>"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#examples","title":"Examples","text":""},{"location":"commands/Export-AzPolicyAssignmentRuleData/#example-1","title":"Example 1","text":"<pre><code>Export-AzPolicyAssignmentRuleData -Name \"policy\" -AssignmentFile .\\00000000-0000-0000-0000-000000000000.assignment.json\n</code></pre> <pre><code>Mode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a---        26/03/2022   9:41 PM            361 \uf15b  definitions-policy.Rule.jsonc\n</code></pre> <p>Export JSON rules to file in current working directory.</p>"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#example-2","title":"Example 2","text":"<pre><code>$subscription = @{\n  subscriptionId = 'nnnnnnnn-nnnn-nnnn-nnnn-nnnnnnnnnnnn'\n  displayName = 'My Azure Subscription'\n  tenantId = 'nnnnnnnn-nnnn-nnnn-nnnn-nnnnnnnnnnnn'\n}\n\nExport-AzPolicyAssignmentRuleData -Name \"policy\" -AssignmentFile .\\00000000-0000-0000-0000-000000000000.assignment.json -Subscription $subscription\n</code></pre> <pre><code>Mode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a---        26/03/2022   9:41 PM            361 \uf15b  definitions-policy.Rule.jsonc\n</code></pre> <p>Export JSON rules to file in current working directory using a specific subscription.</p>"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#example-3","title":"Example 3","text":"<pre><code>Get-AzPolicyAssignmentDataSource | Export-AzPolicyAssignmentRuleData\n</code></pre> <pre><code>Mode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a---        27/03/2022  11:26 AM            721 \uf15b  definitions-export-1b474938.Rule.jsonc\n</code></pre> <p>Export JSON rules from the current working directory using discovered assignment sources in the current working directory.</p>"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#parameters","title":"PARAMETERS","text":""},{"location":"commands/Export-AzPolicyAssignmentRuleData/#-name","title":"-Name","text":"<p>The name of the assignment. If not specified <code>export-&lt;xxxxxxxx&gt;</code> will be used as the name of the assignment.</p> <pre><code>Type: String\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#-assignmentfile","title":"-AssignmentFile","text":"<p>The absolute or relative path to an assignment data file.</p> <pre><code>Type: String\nParameter Sets: (All)\nAliases:\n\nRequired: True\nPosition: Named\nDefault value: None\nAccept pipeline input: True (ByPropertyName)\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#-outputpath","title":"-OutputPath","text":"<p>The path to store generated JSON files containing resources.</p> <p>If this parameter is not specified, output will be written to the current working path. The file name <code>definitions-&lt;name&gt;.Rule.jsonc</code> will be used when this parameter is not set or a directory is specified. Where <code>&lt;name&gt;</code> is the name of the assignment specified by <code>-Name</code>.</p> <p>This parameter has no affect when <code>-PassThru</code> is used.</p> <pre><code>Type: String\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: $PWD\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#-ruleprefix","title":"-RulePrefix","text":"<p>By default, policy rule names use the <code>Azure</code> prefix e.g. <code>Azure.Policy.e749c2d003da</code>.</p> <p>When <code>-RulePrefix</code> is specified, the default prefix is overridden.</p> <p>For example, with <code>-RulePrefix 'CustomPolicyPrefix'</code> this would generate the policy rule name <code>CustomPolicyPrefix.Policy.e749c2d003da</code>.</p> <pre><code>Type: String\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#-passthru","title":"-PassThru","text":"<p>By default, FileInfo objects are returned to the pipeline for each JSON file created. When <code>-PassThru</code> is specified, JSON files are not created and Azure resource objects are returned to the pipeline instead.</p> <pre><code>Type: SwitchParameter\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: False\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#-keepduplicates","title":"-KeepDuplicates","text":"<p>Determines if Azure policy definitions that duplicate existing built-in rules are exported. By default, duplicates are not exported.</p> <p>This only applies to built-in policy definitions.</p> <pre><code>Type: SwitchParameter\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: False\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#-resourcegroup","title":"-ResourceGroup","text":"<p>A name or hashtable of the Resource Group in the assignment data file. This Resource Group specified here will be used to resolve the <code>resourceGroup()</code> function.</p> <p>When the name of Resource Group is specified, the Resource Group will be looked up and used during export. This requires an authenticated connection to Azure with permissions to read the specified Resource Group.</p> <p>Alternately, a hashtable of a Resource Group object can be specified. This option does not require an authenticated Azure connection. The hashtable will override the defaults for any specified properties.</p> <p>For more details see about_PSRule_Azure_Configuration.</p> <pre><code>Type: ResourceGroupReference\nParameter Sets: (All)\nAliases: ResourceGroupName\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#-subscription","title":"-Subscription","text":"<p>The name or hashtable of the Subscription in the assignment data file. This subscription specified here will be used to resolve the <code>subscription()</code> function.</p> <p>When a subscription name is specified, the Subscription will be looked up and used during export. This requires an authenticated connection to Azure with permissions to read the specified Subscription.</p> <p>Alternately, a hashtable of a Subscription object can be specified. This option does not require an authenticated Azure connection. The hashtable will override the defaults for any specified properties.</p> <p>For more details see about_PSRule_Azure_Configuration.</p> <pre><code>Type: SubscriptionReference\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#commonparameters","title":"CommonParameters","text":"<p>This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters.</p>"},{"location":"commands/Export-AzPolicyAssignmentRuleData/#inputs","title":"INPUTS","text":""},{"location":"commands/Export-AzPolicyAssignmentRuleData/#systemstring","title":"System.String","text":""},{"location":"commands/Export-AzPolicyAssignmentRuleData/#outputs","title":"OUTPUTS","text":""},{"location":"commands/Export-AzPolicyAssignmentRuleData/#systemiofileinfo","title":"System.IO.FileInfo","text":""},{"location":"commands/Export-AzPolicyAssignmentRuleData/#systemobject","title":"System.Object","text":""},{"location":"commands/Export-AzPolicyAssignmentRuleData/#notes","title":"Notes","text":""},{"location":"commands/Export-AzPolicyAssignmentRuleData/#related-links","title":"RELATED LINKS","text":""},{"location":"commands/Export-AzRuleData/","title":"Export-AzRuleData","text":"<p>Export resource configuration data from one or more Azure subscriptions.</p>"},{"location":"commands/Export-AzRuleData/#syntax","title":"SYNTAX","text":""},{"location":"commands/Export-AzRuleData/#default-default","title":"Default (Default)","text":"<pre><code>Export-AzRuleData [[-OutputPath] &lt;String&gt;] [-Subscription &lt;String[]&gt;] [-Tenant &lt;String[]&gt;]\n [-ResourceGroupName &lt;String[]&gt;] [-Tag &lt;Hashtable&gt;] [-PassThru] [-SkipDiscovery] [-ResourceId &lt;String[]&gt;]\n [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]\n</code></pre>"},{"location":"commands/Export-AzRuleData/#all","title":"All","text":"<pre><code>Export-AzRuleData [[-OutputPath] &lt;String&gt;] [-ResourceGroupName &lt;String[]&gt;] [-Tag &lt;Hashtable&gt;] [-PassThru]\n [-All] [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]\n</code></pre>"},{"location":"commands/Export-AzRuleData/#description","title":"Description","text":"<p>Export resource configuration data from deployed resources in one or more Azure subscriptions.</p> <p>If no filters are specified then the current subscription context will be exported. i.e. <code>Get-AzContext</code></p> <p>To export all subscriptions contexts use the <code>-All</code> switch. When the <code>-All</code> switch is used, all subscriptions contexts will be exported. i.e. <code>Get-AzContext -ListAvailable</code></p> <p>Resource data will be exported to the current working directory by default as JSON files, one per subscription.</p>"},{"location":"commands/Export-AzRuleData/#examples","title":"Examples","text":""},{"location":"commands/Export-AzRuleData/#example-1","title":"Example 1","text":"<pre><code>Export-AzRuleData\n</code></pre> <pre><code>Directory: C:\\\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----         1/07/2019 10:03 AM        7304948 00000000-0000-0000-0000-000000000001.json\n</code></pre> <p>Export resource configuration data from current subscription context.</p>"},{"location":"commands/Export-AzRuleData/#example-2","title":"Example 2","text":"<pre><code>Export-AzRuleData -Subscription 'Contoso Production', 'Contoso Non-production'\n</code></pre> <pre><code>Directory: C:\\\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----         1/07/2019 10:03 AM        7304948 00000000-0000-0000-0000-000000000001.json\n-a----         1/07/2019 10:03 AM        7304948 00000000-0000-0000-0000-000000000002.json\n</code></pre> <p>Export resource configuration data from subscriptions by name.</p>"},{"location":"commands/Export-AzRuleData/#example-3","title":"Example 3","text":"<pre><code>Export-AzRuleData -ResourceGroupName 'rg-app1-web', 'rg-app1-db'\n</code></pre> <pre><code>Directory: C:\\\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----         1/07/2019 10:03 AM        7304948 00000000-0000-0000-0000-000000000001.json\n</code></pre> <p>Export resource configuration data from two resource groups within the current subscription context.</p>"},{"location":"commands/Export-AzRuleData/#parameters","title":"PARAMETERS","text":""},{"location":"commands/Export-AzRuleData/#-all","title":"-All","text":"<p>By default, resources from the current subscription context are extracted. Use <code>-All</code> to extract resource data for all subscription contexts instead.</p> <pre><code>Type: SwitchParameter\nParameter Sets: All\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleData/#-outputpath","title":"-OutputPath","text":"<p>The path to store generated JSON files containing resources.</p> <pre><code>Type: String\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: 0\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleData/#-passthru","title":"-PassThru","text":"<p>By default, FileInfo objects are returned to the pipeline for each JSON file created. When <code>-PassThru</code> is specified, JSON files are not created and Azure resource objects are returned to the pipeline instead.</p> <pre><code>Type: SwitchParameter\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleData/#-resourcegroupname","title":"-ResourceGroupName","text":"<p>Optionally filter resources by Resource Group name.</p> <pre><code>Type: String[]\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleData/#-subscription","title":"-Subscription","text":"<p>Optionally filter resources by subscription, Id or Name.</p> <pre><code>Type: String[]\nParameter Sets: Default\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleData/#-tag","title":"-Tag","text":"<p>Optionally filter resources based on tag.</p> <pre><code>Type: Hashtable\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleData/#-tenant","title":"-Tenant","text":"<p>Optionally filter resources by a unique Tenant identifer.</p> <pre><code>Type: String[]\nParameter Sets: Default\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleData/#-resourceid","title":"-ResourceId","text":"<p>A list of resource Ids to expand.</p> <pre><code>Type: String[]\nParameter Sets: Default\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: True (ByValue)\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleData/#-skipdiscovery","title":"-SkipDiscovery","text":"<p>Determines if resource discovery is skipped. When skipped resources are expanded based on provided resource Ids.</p> <pre><code>Type: SwitchParameter\nParameter Sets: Default\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleData/#-confirm","title":"-Confirm","text":"<p>Prompts you for confirmation before running the cmdlet.</p> <pre><code>Type: SwitchParameter\nParameter Sets: (All)\nAliases: cf\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleData/#-whatif","title":"-WhatIf","text":"<p>Shows what would happen if the cmdlet runs. The cmdlet is not run.</p> <pre><code>Type: SwitchParameter\nParameter Sets: (All)\nAliases: wi\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleData/#commonparameters","title":"CommonParameters","text":"<p>This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters.</p>"},{"location":"commands/Export-AzRuleData/#inputs","title":"INPUTS","text":""},{"location":"commands/Export-AzRuleData/#none","title":"None","text":""},{"location":"commands/Export-AzRuleData/#outputs","title":"OUTPUTS","text":""},{"location":"commands/Export-AzRuleData/#systemiofileinfo","title":"System.IO.FileInfo","text":"<p>Return <code>FileInfo</code> for each of the output files created, one per subscription. This is the default.</p>"},{"location":"commands/Export-AzRuleData/#psobject","title":"PSObject","text":"<p>Return an object for each Azure resource, and configuration exported. This is returned when the <code>-PassThru</code> switch is used.</p>"},{"location":"commands/Export-AzRuleData/#notes","title":"Notes","text":""},{"location":"commands/Export-AzRuleData/#related-links","title":"RELATED LINKS","text":""},{"location":"commands/Export-AzRuleTemplateData/","title":"Export-AzRuleTemplateData","text":"<p>Export resource configuration data from Azure templates.</p>"},{"location":"commands/Export-AzRuleTemplateData/#syntax","title":"SYNTAX","text":""},{"location":"commands/Export-AzRuleTemplateData/#template-default","title":"Template (Default)","text":"<pre><code>Export-AzRuleTemplateData [[-Name] &lt;String&gt;] -TemplateFile &lt;String&gt; [-ParameterFile &lt;String[]&gt;]\n [-ResourceGroup &lt;ResourceGroupReference&gt;] [-Subscription &lt;SubscriptionReference&gt;] [-OutputPath &lt;String&gt;]\n [-PassThru] [&lt;CommonParameters&gt;]\n</code></pre>"},{"location":"commands/Export-AzRuleTemplateData/#source","title":"Source","text":"<pre><code>Export-AzRuleTemplateData [[-Name] &lt;String&gt;] -SourceFile &lt;String&gt; [-ResourceGroup &lt;ResourceGroupReference&gt;]\n [-Subscription &lt;SubscriptionReference&gt;] [-OutputPath &lt;String&gt;] [-PassThru] [&lt;CommonParameters&gt;]\n</code></pre>"},{"location":"commands/Export-AzRuleTemplateData/#description","title":"Description","text":"<p>Export resource configuration data by merging Azure Resource Manager (ARM) template and parameter files. Template and parameters are merged by resolving template parameters, variables and functions.</p> <p>This function does not check template files for strict compliance with Azure schemas.</p> <p>By default this is an offline process, requiring no connectivity to Azure. Some functions that may be included in templates dynamically query Azure for current state. For these functions standard placeholder values are used by default. Functions that use placeholders include <code>reference</code>, <code>list*</code>.</p> <p>The <code>subscription()</code> function will return the following unless overridden:</p> <ul> <li>subscriptionId: 'ffffffff-ffff-ffff-ffff-ffffffffffff'</li> <li>tenantId: 'ffffffff-ffff-ffff-ffff-ffffffffffff'</li> <li>displayName: 'PSRule Test Subscription'</li> <li>state: 'NotDefined'</li> </ul> <p>The <code>resourceGroup()</code> function will return the following unless overridden:</p> <ul> <li>name: 'ps-rule-test-rg'</li> <li>location: 'eastus'</li> <li>tags: { }</li> <li>properties:<ul> <li>provisioningState: 'Succeeded'</li> </ul> </li> </ul> <p>To override, set the <code>AZURE_SUBSCRIPTION</code> and <code>AZURE_RESOURCE_GROUP</code> in configuration.</p> <p>Currently the following limitations apply:</p> <ul> <li>Nested templates are expanded, external templates are not.<ul> <li>Deployment resources that link to an external template are returned as a resource.</li> </ul> </li> <li>Sub-resources such as diagnostic logs or configurations are automatically nested. Automatic nesting a sub-resource requires:<ul> <li>The parent resource is defined in the same template.</li> <li>The sub-resource depends on the parent resource.</li> </ul> </li> <li>The <code>environment</code> template function always returns values for Azure public cloud.</li> <li>References to Key Vault secrets are not expanded. A placeholder value is used instead.</li> <li>The <code>reference()</code> function will return objects for resources within the same template.   For resources that are not in the same template, a placeholder value is used instead.</li> <li>Multi-line strings are not supported.</li> <li>Template expressions up to a maximum of 100,000 characters are supported.</li> </ul>"},{"location":"commands/Export-AzRuleTemplateData/#examples","title":"Examples","text":""},{"location":"commands/Export-AzRuleTemplateData/#example-1","title":"Example 1","text":"<pre><code>Export-AzRuleTemplateData -TemplateFile .\\template.json -ParameterFile .\\parameters.json;\n</code></pre> <p>Export resource configuration data based on merging a template and parameter file together.</p>"},{"location":"commands/Export-AzRuleTemplateData/#example-2","title":"Example 2","text":"<pre><code>Get-AzRuleTemplateLink | Export-AzRuleTemplateData;\n</code></pre> <p>Recursively scan the current working path and export linked templates.</p>"},{"location":"commands/Export-AzRuleTemplateData/#example-3","title":"Example 3","text":"<pre><code>$subscription = @{\n  subscriptionId = 'nnnnnnnn-nnnn-nnnn-nnnn-nnnnnnnnnnnn'\n  displayName = 'My Azure Subscription'\n  tenantId = 'nnnnnnnn-nnnn-nnnn-nnnn-nnnnnnnnnnnn'\n}\nGet-AzRuleTemplateLink | Export-AzRuleTemplateData -Subscription $subscription;\n</code></pre> <p>Export linked templates from the current working path using a specific subscription.</p>"},{"location":"commands/Export-AzRuleTemplateData/#example-4","title":"Example 4","text":"<pre><code>$rg = @{\n  name = 'my-test-rg'\n  location = 'australiaeast'\n  tags = @{\n    env = 'prod'\n  }\n}\nGet-AzRuleTemplateLink | Export-AzRuleTemplateData -ResourceGroup $rg;\n</code></pre> <p>Export linked templates from the current working path using a specific resource group.</p>"},{"location":"commands/Export-AzRuleTemplateData/#parameters","title":"PARAMETERS","text":""},{"location":"commands/Export-AzRuleTemplateData/#-name","title":"-Name","text":"<p>The name of the deployment. If not specified <code>export-&lt;xxxxxxxx&gt;</code> will be used as the name of the deployment.</p> <p>This parameter is used by the <code>deployment()</code> function and is also used to name the output file.</p> <pre><code>Type: String\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: 0\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleTemplateData/#-templatefile","title":"-TemplateFile","text":"<p>The absolute or relative file path to an Azure Resource Manager template file.</p> <pre><code>Type: String\nParameter Sets: Template\nAliases:\n\nRequired: True\nPosition: Named\nDefault value: None\nAccept pipeline input: True (ByPropertyName)\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleTemplateData/#-parameterfile","title":"-ParameterFile","text":"<p>The absolute or relative file path to one or more Azure Resource Manager template parameter files.</p> <pre><code>Type: String[]\nParameter Sets: Template\nAliases: TemplateParameterFile\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: True (ByPropertyName)\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleTemplateData/#-sourcefile","title":"-SourceFile","text":"<p>The absolute or relative file path to a file of a Bicep file.</p> <pre><code>Type: String\nParameter Sets: Source\nAliases: f, FullName\n\nRequired: True\nPosition: Named\nDefault value: None\nAccept pipeline input: True (ByPropertyName)\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleTemplateData/#-outputpath","title":"-OutputPath","text":"<p>The path to store generated JSON files containing resources.</p> <p>If this parameter is not specified, output will be written to the current working path. The file name <code>resources-&lt;name&gt;.json</code> will be used when this parameter is not set or a directory is specified. Where <code>&lt;name&gt;</code> is the name of the deployment specified by <code>-Name</code>.</p> <p>This parameter has no affect when <code>-PassThru</code> is used.</p> <pre><code>Type: String\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: $PWD\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleTemplateData/#-passthru","title":"-PassThru","text":"<p>By default, FileInfo objects are returned to the pipeline for each JSON file created. When <code>-PassThru</code> is specified, JSON files are not created and Azure resource objects are returned to the pipeline instead.</p> <pre><code>Type: SwitchParameter\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleTemplateData/#-resourcegroup","title":"-ResourceGroup","text":"<p>A name or hashtable of the Resource Group where the deployment will occur. This Resource Group specified here will be used to resolve the <code>resourceGroup()</code> function.</p> <p>When the name of Resource Group is specified, the Resource Group will be looked up and used during export. This requires an authenticated connection to Azure with permissions to read the specified Resource Group.</p> <p>Alternately, a hashtable of a Resource Group object can be specified. This option does not require an authenticated Azure connection. The hashtable will override the defaults for any specified properties.</p> <p>For more details see about_PSRule_Azure_Configuration.</p> <pre><code>Type: ResourceGroupReference\nParameter Sets: (All)\nAliases: ResourceGroupName\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleTemplateData/#-subscription","title":"-Subscription","text":"<p>The name or hashtable of the Subscription where the deployment will occur. This subscription specified here will be used to resolve the <code>subscription()</code> function.</p> <p>When a subscription name is specified, the Subscription will be looked up and used during export. This requires an authenticated connection to Azure with permissions to read the specified Subscription.</p> <p>Alternately, a hashtable of a Subscription object can be specified. This option does not require an authenticated Azure connection. The hashtable will override the defaults for any specified properties.</p> <p>For more details see about_PSRule_Azure_Configuration.</p> <pre><code>Type: SubscriptionReference\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Export-AzRuleTemplateData/#commonparameters","title":"CommonParameters","text":"<p>This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters.</p>"},{"location":"commands/Export-AzRuleTemplateData/#inputs","title":"INPUTS","text":""},{"location":"commands/Export-AzRuleTemplateData/#systemstring","title":"System.String","text":""},{"location":"commands/Export-AzRuleTemplateData/#systemstring_1","title":"System.String[]","text":""},{"location":"commands/Export-AzRuleTemplateData/#outputs","title":"OUTPUTS","text":""},{"location":"commands/Export-AzRuleTemplateData/#systemiofileinfo","title":"System.IO.FileInfo","text":""},{"location":"commands/Export-AzRuleTemplateData/#systemobject","title":"System.Object","text":""},{"location":"commands/Export-AzRuleTemplateData/#notes","title":"Notes","text":""},{"location":"commands/Export-AzRuleTemplateData/#related-links","title":"RELATED LINKS","text":""},{"location":"commands/Get-AzPolicyAssignmentDataSource/","title":"Get-AzPolicyAssignmentDataSource","text":"<p>Get policy assignment sources.</p>"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#syntax","title":"SYNTAX","text":"<pre><code>Get-AzPolicyAssignmentDataSource [-InputPath &lt;String[]&gt;] [[-Path] &lt;String&gt;] [&lt;CommonParameters&gt;]\n</code></pre>"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#description","title":"Description","text":"<p>This is an experimental cmdlet.</p> <p>Get policy assignment sources. By default <code>*.assignment.json</code> sources are discovered from the current working directory.</p>"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#examples","title":"Examples","text":""},{"location":"commands/Get-AzPolicyAssignmentDataSource/#example-1","title":"Example 1","text":"<pre><code>Get-AzPolicyAssignmentDataSource\n</code></pre> <pre><code>AssignmentFile\n--------------\nC:\\00000000-0000-0000-0000-000000000001.assignment.json\nC:\\Users\\user\\00000000-0000-0000-0000-000000000002.assignment.json\n</code></pre> <p>Gets policy assignment sources from any <code>*.assignment.json</code> sources within any folder in the current working directory path.</p>"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#parameters","title":"PARAMETERS","text":""},{"location":"commands/Get-AzPolicyAssignmentDataSource/#-inputpath","title":"-InputPath","text":"<p>A path or filter to search for assignment files within the path specified by <code>-Path</code>. By default, files with <code>*.assignment.json</code> suffix will be used.</p> <p>When searching for assignment files all sub-directories will be scanned. To perform a shallow search, prefix input paths with <code>./</code>.</p> <pre><code>Type: String[]\nParameter Sets: (All)\nAliases: f, AssignmentFile, FullName\n\nRequired: False\nPosition: Named\nDefault value: '*.assignment.json'\nAccept pipeline input: True (ByPropertyName)\nAccept wildcard characters: True\n</code></pre>"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#-path","title":"-Path","text":"<p>Sets the path to search for assignment files in. By default, this is the current working path.</p> <pre><code>Type: String\nParameter Sets: (All)\nAliases: p\n\nRequired: False\nPosition: 0\nDefault value: $PWD\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#commonparameters","title":"CommonParameters","text":"<p>This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters.</p>"},{"location":"commands/Get-AzPolicyAssignmentDataSource/#inputs","title":"INPUTS","text":""},{"location":"commands/Get-AzPolicyAssignmentDataSource/#systemstring","title":"System.String[]","text":""},{"location":"commands/Get-AzPolicyAssignmentDataSource/#outputs","title":"OUTPUTS","text":""},{"location":"commands/Get-AzPolicyAssignmentDataSource/#psrulerulesazurepipelinepolicyassignmentsource","title":"PSRule.Rules.Azure.Pipeline.PolicyAssignmentSource","text":""},{"location":"commands/Get-AzPolicyAssignmentDataSource/#notes","title":"Notes","text":""},{"location":"commands/Get-AzPolicyAssignmentDataSource/#related-links","title":"RELATED LINKS","text":""},{"location":"commands/Get-AzRuleTemplateLink/","title":"Get-AzRuleTemplateLink","text":"<p>Get a metadata link to a Azure template file.</p>"},{"location":"commands/Get-AzRuleTemplateLink/#syntax","title":"SYNTAX","text":"<pre><code>Get-AzRuleTemplateLink [[-InputPath] &lt;String[]&gt;] [-SkipUnlinked] [[-Path] &lt;String&gt;] [&lt;CommonParameters&gt;]\n</code></pre>"},{"location":"commands/Get-AzRuleTemplateLink/#description","title":"Description","text":"<p>Gets a link between an Azure Resource Manager (ARM) parameter file and its referenced template file. Parameter files reference a template file by defining metadata. Alternatively, template files are discovered by naming convention.</p> <p>By default, when parameter files without a matching template are discovered an error is raised.</p> <p>To reference a template, set the <code>metadata.template</code> property to a file path. Referencing templates outside of the path specified with <code>-Path</code> is not permitted.</p> <p>To discover template files by naming convention:</p> <ul> <li>Both template and parameter files must be in the same sub-directory.</li> <li>The parameter file must end with <code>.parameters.json</code>.</li> <li>The parameter file must be named <code>&lt;templateName&gt;.parameters.json</code>.</li> <li>The template file must be named <code>&lt;templateName&gt;.json</code>.</li> </ul> <p>For more information see the about_PSRule_Azure_Metadata_Link topic.</p>"},{"location":"commands/Get-AzRuleTemplateLink/#examples","title":"Examples","text":""},{"location":"commands/Get-AzRuleTemplateLink/#example-1","title":"Example 1","text":"<pre><code>Get-AzRuleTemplateLink\n</code></pre> <p>Get links from any <code>*.parameters.json</code> files within any folder in the current working path.</p>"},{"location":"commands/Get-AzRuleTemplateLink/#parameters","title":"PARAMETERS","text":""},{"location":"commands/Get-AzRuleTemplateLink/#-inputpath","title":"-InputPath","text":"<p>A path or filter to search for parameter files within the path specified by <code>-Path</code>. By default, files with <code>*.parameters.json</code> suffix will be used.</p> <p>When searching for parameter files all sub-directories will be scanned. To perform a shallow search, prefix input paths with <code>./</code>.</p> <pre><code>Type: String[]\nParameter Sets: (All)\nAliases: f, TemplateParameterFile, FullName\n\nRequired: False\nPosition: 1\nDefault value: '*.parameters.json'\nAccept pipeline input: True (ByPropertyName)\nAccept wildcard characters: True\n</code></pre>"},{"location":"commands/Get-AzRuleTemplateLink/#-skipunlinked","title":"-SkipUnlinked","text":"<p>Use this option to ignore parameter files that have no matching template. By default, when parameter files without a matching template are discovered an error is raised.</p> <pre><code>Type: SwitchParameter\nParameter Sets: (All)\nAliases:\n\nRequired: False\nPosition: Named\nDefault value: None\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Get-AzRuleTemplateLink/#-path","title":"-Path","text":"<p>Sets the path to search for parameter files in. By default, this is the current working path.</p> <pre><code>Type: String\nParameter Sets: (All)\nAliases: p\n\nRequired: False\nPosition: 0\nDefault value: $PWD\nAccept pipeline input: False\nAccept wildcard characters: False\n</code></pre>"},{"location":"commands/Get-AzRuleTemplateLink/#commonparameters","title":"CommonParameters","text":"<p>This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters.</p>"},{"location":"commands/Get-AzRuleTemplateLink/#inputs","title":"INPUTS","text":""},{"location":"commands/Get-AzRuleTemplateLink/#systemstring","title":"System.String[]","text":""},{"location":"commands/Get-AzRuleTemplateLink/#outputs","title":"OUTPUTS","text":""},{"location":"commands/Get-AzRuleTemplateLink/#psrulerulesazuredatametadataitemplatelink","title":"PSRule.Rules.Azure.Data.Metadata.ITemplateLink","text":""},{"location":"commands/Get-AzRuleTemplateLink/#notes","title":"Notes","text":""},{"location":"commands/Get-AzRuleTemplateLink/#related-links","title":"RELATED LINKS","text":"<p>about_PSRule_Azure_Metadata_Link</p>"},{"location":"commands/PSRule.Rules.Azure/","title":"PSRule.Rules.Azure Module","text":""},{"location":"commands/PSRule.Rules.Azure/#description","title":"Description","text":"<p>Validate Azure resources and infrastructure as code using PSRule.</p>"},{"location":"commands/PSRule.Rules.Azure/#psrule-cmdlets","title":"PSRule Cmdlets","text":""},{"location":"commands/PSRule.Rules.Azure/#export-azruledata","title":"Export-AzRuleData","text":"<p>Export resource configuration data from one or more Azure subscriptions.</p>"},{"location":"commands/PSRule.Rules.Azure/#export-azruletemplatedata","title":"Export-AzRuleTemplateData","text":"<p>Export resource configuration data from Azure templates.</p>"},{"location":"commands/PSRule.Rules.Azure/#get-azruletemplatelink","title":"Get-AzRuleTemplateLink","text":"<p>Get a metadata link to a Azure template file.</p>"},{"location":"concepts/about_PSRule_Azure_Configuration/","title":"Configuration options","text":"<p>Describes PSRule configuration options specific to PSRule for Azure.</p>"},{"location":"concepts/about_PSRule_Azure_Configuration/#description","title":"Description","text":"<p>PSRule exposes configuration options that can be used to customize execution of <code>PSRule.Rules.Azure</code>. This topic describes what configuration options are available.</p> <p>PSRule configuration options can be specified by setting the configuration option in <code>ps-rule.yaml</code>. Additionally, configuration options can be configured in a baseline or set at runtime. For details of setting configuration options see PSRule options.</p> <p>The following configurations options are available for use:</p> <ul> <li>AZURE_AKS_CLUSTER_MINIMUM_VERSION</li> <li>AZURE_AKS_POOL_MINIMUM_MAXPODS</li> <li>AZURE_RESOURCE_ALLOWED_LOCATIONS</li> <li>AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME</li> <li>AZURE_PARAMETER_FILE_EXPANSION</li> <li>AZURE_POLICY_WAIVER_MAX_EXPIRY</li> <li>AZURE_RESOURCE_GROUP</li> <li>AZURE_SUBSCRIPTION</li> <li>AZURE_POLICY_IGNORE_LIST</li> <li>AZURE_POLICY_RULE_PREFIX</li> <li>AZURE_APIM_MIN_API_VERSION</li> <li>AZURE_COSMOS_DEFENDER_PER_ACCOUNT</li> <li> <p>AZURE_STORAGE_DEFENDER_PER_ACCOUNT</p> </li> </ul>"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_aks_cluster_minimum_version","title":"AZURE_AKS_CLUSTER_MINIMUM_VERSION","text":"<p>This configuration option determines the minimum version of Kubernetes for AKS clusters and node pools. Rules that check the Kubernetes version fail when the version is older than the version specified.</p> <p>Syntax:</p> <pre><code>configuration:\n  AZURE_AKS_CLUSTER_MINIMUM_VERSION: string # A version string\n</code></pre> <p>Default:</p> <pre><code># YAML: The default AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option\nconfiguration:\n  AZURE_AKS_CLUSTER_MINIMUM_VERSION: 1.29.7\n</code></pre> <p>Example:</p> <pre><code># YAML: Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option to 1.19.7\nconfiguration:\n  AZURE_AKS_CLUSTER_MINIMUM_VERSION: 1.19.7\n</code></pre>"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_aks_pool_minimum_maxpods","title":"AZURE_AKS_POOL_MINIMUM_MAXPODS","text":"<p>This configuration option determines the minimum allowed max pods setting per node pool. When an AKS cluster node pool is created, a <code>maxPods</code> option is used to determine the maximum number of pods for each node in the node pool.</p> <p>Syntax:</p> <pre><code>configuration:\n  AZURE_AKS_POOL_MINIMUM_MAXPODS: integer\n</code></pre> <p>Default:</p> <pre><code># YAML: The default AZURE_AKS_POOL_MINIMUM_MAXPODS configuration option\nconfiguration:\n  AZURE_AKS_POOL_MINIMUM_MAXPODS: 50\n</code></pre> <p>Example:</p> <pre><code># YAML: Set the AZURE_AKS_POOL_MINIMUM_MAXPODS configuration option to 30\nconfiguration:\n  AZURE_AKS_POOL_MINIMUM_MAXPODS: 30\n</code></pre>"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_resource_allowed_locations","title":"AZURE_RESOURCE_ALLOWED_LOCATIONS","text":"<p>This configuration option specifies a list of allowed locations that resources can be deployed to. Rules that check the location of Azure resources fail when a resource or resource group is created in a different region.</p> <p>By default, <code>AZURE_RESOURCE_ALLOWED_LOCATIONS</code> is not configured. The rule <code>Azure.Resource.AllowedRegions</code> is skipped when no allowed locations are configured.</p> <p>Syntax:</p> <pre><code>configuration:\n  AZURE_RESOURCE_ALLOWED_LOCATIONS: array # An array of regions\n</code></pre> <p>Default:</p> <pre><code># YAML: The default AZURE_RESOURCE_ALLOWED_LOCATIONS configuration option\nconfiguration:\n  AZURE_RESOURCE_ALLOWED_LOCATIONS: []\n</code></pre> <p>Example:</p> <pre><code># YAML: Set the AZURE_RESOURCE_ALLOWED_LOCATIONS configuration option to Australia East, Australia South East\nconfiguration:\n  AZURE_RESOURCE_ALLOWED_LOCATIONS:\n  - 'australiaeast'\n  - 'australiasoutheast'\n</code></pre>"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_apim_minimum_certificate_lifetime","title":"AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME","text":"<p>This configuration option determines the minimum number of days allowed before certificate expiry. Rules that check certificate lifetime fail when the days remaining before expiry drop below this number.</p> <p>Syntax:</p> <pre><code>configuration:\n  AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME: integer\n</code></pre> <p>Default:</p> <pre><code># YAML: The default AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME configuration option\nconfiguration:\n  AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME: 30\n</code></pre> <p>Example:</p> <pre><code># YAML: Set the AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME configuration option to 90\nconfiguration:\n  AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME: 90\n</code></pre>"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_parameter_file_expansion","title":"AZURE_PARAMETER_FILE_EXPANSION","text":"<p>This configuration option determines if Azure template parameter files will automatically be expanded. By default, parameter files will not be automatically expanded.</p> <p>Parameter files are expanded when PSRule cmdlets with the <code>-Format File</code> parameter are used.</p> <p>Syntax:</p> <pre><code>configuration:\n  AZURE_PARAMETER_FILE_EXPANSION: bool\n</code></pre> <p>Default:</p> <pre><code># YAML: The default AZURE_PARAMETER_FILE_EXPANSION configuration option\nconfiguration:\n  AZURE_PARAMETER_FILE_EXPANSION: false\n</code></pre> <p>Example:</p> <pre><code># YAML: Set the AZURE_PARAMETER_FILE_EXPANSION configuration option to enable expansion\nconfiguration:\n  AZURE_PARAMETER_FILE_EXPANSION: true\n</code></pre>"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_policy_waiver_max_expiry","title":"AZURE_POLICY_WAIVER_MAX_EXPIRY","text":"<p>This configuration option determines the maximum number of days in the future for a waiver policy exemption.</p> <p>Syntax:</p> <pre><code>configuration:\n  AZURE_POLICY_WAIVER_MAX_EXPIRY: integer\n</code></pre> <p>Default:</p> <pre><code># YAML: The default AZURE_POLICY_WAIVER_MAX_EXPIRY configuration option\nconfiguration:\n  AZURE_POLICY_WAIVER_MAX_EXPIRY: 366\n</code></pre> <p>Example:</p> <pre><code># YAML: Set the AZURE_POLICY_WAIVER_MAX_EXPIRY configuration option to 90\nconfiguration:\n  AZURE_POLICY_WAIVER_MAX_EXPIRY: 90\n</code></pre>"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_resource_group","title":"AZURE_RESOURCE_GROUP","text":"<p>This configuration option sets the resource group object used by the <code>resourceGroup()</code> function. Configure this option to change the resource group object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below.</p> <p>This configuration option will be ignored when <code>-ResourceGroup</code> is used with <code>Export-AzRuleTemplateData</code>.</p> <p>Syntax:</p> <pre><code>configuration:\n  AZURE_RESOURCE_GROUP:\n    name: string\n    location: string\n    tags: object\n    properties:\n      provisioningState: string\n</code></pre> <p>Default:</p> <pre><code># YAML: The default AZURE_RESOURCE_GROUP configuration option\nconfiguration:\n  AZURE_RESOURCE_GROUP:\n    name: 'ps-rule-test-rg'\n    location: 'eastus'\n    tags: { }\n    properties:\n      provisioningState: 'Succeeded'\n</code></pre> <p>Example:</p> <pre><code># YAML: Override the location of the resource group object.\nconfiguration:\n  AZURE_RESOURCE_GROUP:\n    location: 'australiasoutheast'\n</code></pre>"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_subscription","title":"AZURE_SUBSCRIPTION","text":"<p>This configuration option sets the subscription object used by the <code>subscription()</code> function. Configure this option to change the subscription object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below.</p> <p>This configuration option will be ignored when <code>-Subscription</code> is used with <code>Export-AzRuleTemplateData</code>.</p> <p>Syntax:</p> <pre><code>configuration:\n  AZURE_SUBSCRIPTION:\n    subscriptionId: string\n    tenantId: string\n    displayName: string\n    state: string\n</code></pre> <p>Default:</p> <pre><code># YAML: The default AZURE_SUBSCRIPTION configuration option\nconfiguration:\n  AZURE_SUBSCRIPTION:\n    subscriptionId: 'ffffffff-ffff-ffff-ffff-ffffffffffff'\n    tenantId: 'ffffffff-ffff-ffff-ffff-ffffffffffff'\n    displayName: 'PSRule Test Subscription'\n    state: 'NotDefined'\n</code></pre> <p>Example:</p> <pre><code># YAML: Override the display name of the subscription object\n  AZURE_SUBSCRIPTION:\n    displayName: 'My test subscription'\n</code></pre>"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_policy_ignore_list","title":"AZURE_POLICY_IGNORE_LIST","text":"<p>This configuration option configures a custom list policy definitions to ignore when exporting policy to rules. In addition to the custom list, a built-in list of policies are ignored. The built-in list can be found here.</p> <p>Configure this option to ignore policy definitions that:</p> <ul> <li>Already have a rule defined.</li> <li>Are not relevant to testing Infrastructure as Code.</li> </ul> <p>Syntax:</p> <pre><code>configuration:\n  AZURE_POLICY_IGNORE_LIST: array\n</code></pre> <p>Default:</p> <pre><code># YAML: The default AZURE_POLICY_IGNORE_LIST configuration option\nconfiguration:\n  AZURE_POLICY_IGNORE_LIST: []\n</code></pre> <p>Example:</p> <pre><code># YAML: Add a custom policy definition to ignore\nconfiguration:\n  AZURE_POLICY_IGNORE_LIST:\n  - '/providers/Microsoft.Authorization/policyDefinitions/1f314764-cb73-4fc9-b863-8eca98ac36e9'\n  - '/providers/Microsoft.Authorization/policyDefinitions/b54ed75b-3e1a-44ac-a333-05ba39b99ff0'\n</code></pre>"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_policy_rule_prefix","title":"AZURE_POLICY_RULE_PREFIX","text":"<p>This configuration option sets the prefix for names of exported rules. Configure this option to change the prefix, which defaults to <code>Azure</code>.</p> <p>This configuration option will be ignored when <code>-Prefix</code> is used with <code>Export-AzPolicyAssignmentRuleData</code>.</p> <p>Syntax:</p> <pre><code>configuration:\n  AZURE_POLICY_RULE_PREFIX: string\n</code></pre> <p>Default:</p> <pre><code># YAML: The default AZURE_POLICY_RULE_PREFIX configuration option\nconfiguration:\n  AZURE_POLICY_RULE_PREFIX: 'Azure'\n</code></pre> <p>Example:</p> <pre><code># YAML: Override the prefix of exported policy rules\n  AZURE_POLICY_RULE_PREFIX: 'AzureCustomPrefix'\n</code></pre>"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_apim_min_api_version","title":"AZURE_APIM_MIN_API_VERSION","text":"<p>This configuration option sets the minimum API version used for control plane API calls to API Management instances. Configure this option to change the minimum API version, which defaults to <code>'2021-08-01'</code>.</p> <p>Syntax:</p> <pre><code>configuration:\n  AZURE_APIM_MIN_API_VERSION: string\n</code></pre> <p>Default:</p> <pre><code># YAML: The default AZURE_APIM_MIN_API_VERSION configuration option\nconfiguration:\n  AZURE_APIM_MIN_API_VERSION: '2021-08-01'\n</code></pre> <p>Example:</p> <pre><code># YAML: Set the AZURE_APIM_MIN_API_VERSION configuration option to '2021-12-01-preview'\nconfiguration:\n  AZURE_APIM_MIN_API_VERSION: '2021-12-01-preview'\n</code></pre>"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_cosmos_defender_per_account","title":"AZURE_COSMOS_DEFENDER_PER_ACCOUNT","text":"<p>This configuration option enables validation for that each Cosmos DB account is associated with a Microsoft Defender for Cosmos DB resource level plan. Configure this option to enable the per account validation, which defaults to <code>false</code>.</p> <p>Syntax:</p> <pre><code>configuration:\n  AZURE_COSMOS_DEFENDER_PER_ACCOUNT: boolean\n</code></pre> <p>Default:</p> <pre><code># YAML: The default AZURE_COSMOS_DEFENDER_PER_ACCOUNT configuration option\nconfiguration:\n  AZURE_COSMOS_DEFENDER_PER_ACCOUNT: false\n</code></pre> <p>Example:</p> <pre><code># YAML: Set the AZURE_COSMOS_DEFENDER_PER_ACCOUNT configuration option to true\nconfiguration:\n  AZURE_COSMOS_DEFENDER_PER_ACCOUNT: true\n</code></pre>"},{"location":"concepts/about_PSRule_Azure_Configuration/#azure_storage_defender_per_account","title":"AZURE_STORAGE_DEFENDER_PER_ACCOUNT","text":"<p>This configuration option enables validation for that each storage account is associated with a Microsoft Defender for Storage resource level plan. Configure this option to enable the per account validation, which defaults to <code>false</code>.</p> <p>Syntax:</p> <pre><code>configuration:\n  AZURE_STORAGE_DEFENDER_PER_ACCOUNT: boolean\n</code></pre> <p>Default:</p> <pre><code># YAML: The default AZURE_STORAGE_DEFENDER_PER_ACCOUNT configuration option\nconfiguration:\n  AZURE_STORAGE_DEFENDER_PER_ACCOUNT: false\n</code></pre> <p>Example:</p> <pre><code># YAML: Set the AZURE_STORAGE_DEFENDER_PER_ACCOUNT configuration option to true\nconfiguration:\n  AZURE_STORAGE_DEFENDER_PER_ACCOUNT: true\n</code></pre>"},{"location":"concepts/about_PSRule_Azure_Metadata_Link/","title":"PSRule_Azure_Metadata_Link","text":""},{"location":"concepts/about_PSRule_Azure_Metadata_Link/#about_psrule_azure_metadata_link","title":"about_PSRule_Azure_Metadata_Link","text":"<p>Describes how Azure Resource Manager (ARM) parameter files reference a template file.</p>"},{"location":"concepts/about_PSRule_Azure_Metadata_Link/#description","title":"Description","text":"<p>Azure Resource Manager (ARM) supports storing additional metadata within parameter files. PSRule uses this metadata to link template and parameter files together to improve unit testing of templates.</p> <p>To reference a template within a parameter file:</p> <ul> <li>Set the <code>metadata.template</code> property to the template.</li> <li>Prefix a template file relative to the parameter file with <code>./</code>. When <code>./</code> is not used, the template with is relative to the <code>-Path</code> parameter.</li> </ul> <p>For example:</p> <pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"metadata\": {\n        \"template\": \"./Resources.Template.json\"\n    },\n    \"parameters\": {\n    }\n}\n</code></pre>"},{"location":"concepts/about_PSRule_Azure_Metadata_Link/#see-also","title":"SEE ALSO","text":"<ul> <li>Get-AzRuleTemplateLink</li> </ul>"},{"location":"concepts/policy-as-rules/","title":"Policy as rules","text":"<p>PSRule for Azure allows you to export your current Azure Policy assignments out as rules to enforce controls during development. This allows you to:</p> <ul> <li>Reuse controls \u2014 that have already deployed with implementation of guardrails in your environment.   For example: Azure Cloud Adoption Framework or regulatory compliance standards.</li> <li>Reduce deployment issues \u2014 by identifying Azure Policy controls that could prevent a deployment from succeeding.</li> </ul> <p>Abstract</p> <p>This topic covers using policy as rules which allows you to use Azure Policy as rules to test Infrastructure as Code.</p> <p>Experimental - Learn more</p> <p>Policy as rules are a work in progress. As always if you find bugs/ errors or if something just doesn't work as your expect it to, please let us know. You can log a bug on GitHub or provide feedback here.</p>"},{"location":"concepts/policy-as-rules/#limitations","title":"Limitations","text":"<p>This feature does not support:</p> <ul> <li>Resource provider modes \u2014 evaluate data plane information exposed at runtime.   Policies that target resource provider modes are automatically ignored.</li> <li>Disabled policies \u2014 Policy definitions with the effect <code>Disabled</code> are ignored.</li> <li>Unassigned policies \u2014 Only policy definitions assigned to a scope are exported.</li> <li>Policies that check for assessment status \u2014 Some policies use additional detection tools to check for compliance.   Policies that check for assessment status are ignored.</li> <li>Importing rules \u2014 Rules generated from policy assignments cannot be imported back into Azure Policy.</li> </ul>"},{"location":"concepts/policy-as-rules/#using-policy-as-rules","title":"Using policy as rules","text":"<p>Using policy as rules is a two step process:</p> <ol> <li>Export assignment data from Azure.</li> <li>Convert assignments to rules.</li> </ol>"},{"location":"concepts/policy-as-rules/#export-assignment-data","title":"Export assignment data","text":"<p>Run <code>Export-AzPolicyAssignmentData</code> to export assignments from Azure to an <code>*.assignment.json</code> file.</p> <p>Key points:</p> <ul> <li>Before running this command, connect to an Azure subscription by installing the <code>Az</code> PowerShell module and using <code>Connect-AzAccount</code>.</li> <li>This command has no required parameters, and by default will export all assignments from you current Azure subscription.   You can change the current Azure subscription by using <code>Set-AzContext</code>.</li> </ul> <p>Bug</p> <p>Currently a known incompatibility exists with 7.x of <code>Az.Resources</code> which introduced a breaking change. Please use <code>Az.Resources</code> &gt;= v6.7.0 and &lt; v7.0.0. For more information see Issues with Az.Resources</p> <p>For example:</p> PowerShell<pre><code># Install and import required modules.\nInstall-Module Az.Resources -RequiredVersion '6.7.0' -Force -Scope CurrentUser\nImport-Module Az.Resources -RequiredVersion '6.7.0'\nImport-Module PSRule.Rules.Azure\n\n# Connect to Azure\nConnect-AzAccount\nSet-AzContext -Subscription '&lt;subscriptionId&gt;'\n\n# Export assignments\nExport-AzPolicyAssignmentData\n</code></pre>"},{"location":"concepts/policy-as-rules/#convert-assignments-to-rules","title":"Convert assignments to rules","text":"<p>Run <code>Export-AzPolicyAssignmentRuleData</code> to convert assignments to rules. To run this command an <code>-AssignmentFile</code> parameter with the path to the assignment JSON file generated in the previous step.</p> <p>After the command completes a new file <code>*.Rule.jsonc</code> should be generated containing generated rules.</p> <p>For example:</p> PowerShell<pre><code>Export-AzPolicyAssignmentRuleData -AssignmentFile '.\\&lt;subscriptionId&gt;.assignment.json'\n</code></pre>"},{"location":"concepts/policy-as-rules/#running-policy-rules","title":"Running policy rules","text":"<p>Rules and an initial baseline are generated in a file ending in <code>.Rule.jsonc</code>. This file extension and format are automatically detected by PSRule when it is run from an included source path. To start using the policy rules, copy the file to the default include sub-directory (<code>.ps-rule/</code>) in the root of your repository.</p> <p>Additionally, the following setup is required to scan Infrastructure as Code (IaC):</p> <ol> <li>Set a binding configuration.</li> <li>Configure expansion for processing Bicep or ARM templates.</li> <li>Include the <code>PSRule.Rules.Azure</code> module.</li> <li>Optionally specify a baseline to limit the rules evaluated to policy rules.</li> </ol>"},{"location":"concepts/policy-as-rules/#generated-baseline","title":"Generated baseline","text":"<p>v1.33.0</p> <p>When exporting policies, PSRule for Azure will automatically generate a baseline including any generated rules. By default, this baseline is called <code>Azure.PolicyBaseline.All</code>. If you change the prefix of generated rules the baseline will be named <code>&lt;Prefix&gt;.PolicyBaseline.All</code>.</p> <p>See Using baselines for examples on how to use a baseline in a run.</p>"},{"location":"concepts/policy-as-rules/#customizing-the-generated-rules","title":"Customizing the generated rules","text":"<p>PSRule for Azure allows you to:</p> <ul> <li>Set a name prefix \u2014 to help identify generated rules.   By default, generated rules and baselines are prefixed with <code>Azure</code>.   To change the prefix:<ul> <li>Use the <code>-RulePrefix</code> parameter when running <code>Export-AzPolicyAssignmentRuleData</code>. OR</li> <li>Set the <code>AZURE_POLICY_RULE_PREFIX</code> configuration option in <code>ps-rule.yaml</code>.</li> </ul> </li> <li>Exclude specific policies \u2014 by setting the <code>AZURE_POLICY_IGNORE_LIST</code> configuration option in <code>ps-rule.yaml</code>.   This option allows you to prevent specific policies from being exported as rules.</li> </ul> <p>For example:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_POLICY_RULE_PREFIX: MyOrg\n  AZURE_POLICY_IGNORE_LIST:\n  - /providers/Microsoft.Authorization/policyDefinitions/1f314764-cb73-4fc9-b863-8eca98ac36e9\n  - /providers/Microsoft.Authorization/policyDefinitions/b54ed75b-3e1a-44ac-a333-05ba39b99ff0\n</code></pre>"},{"location":"concepts/policy-as-rules/#duplicate-policies","title":"Duplicate policies","text":"<p>v1.33.0</p> <p>When exporting policies, you may encounter definitions that are duplicates of existing rules shipped with PSRule for Azure. By default, built-in Azure policies that are duplicates of existing rules are ignored. Additionally, PSRule for Azure will automatically switch in existing rules into the generated baseline.</p> <p>Note</p> <p>This only applies to built-in Azure policies that are duplicates of existing rules. Custom policies are not effected.</p> <p>The list of built-in policies that are duplicates can be viewed here. If you believe a policy is missing from this list, please open an issue.</p> <p>This allows you to:</p> <ul> <li>Focus on policies that are unique to your environment and not already covered by PSRule for Azure.</li> <li>Benefit from the additional references and examples provided by PSRule for Azure.</li> <li>Reduce noise reporting the same issue multiple times.</li> </ul> <p>To override this behavior use the <code>-KeepDuplicates</code> parameter switch when running <code>Export-AzPolicyAssignmentRuleData</code>.</p>"},{"location":"concepts/policy-as-rules/#recommended-content","title":"Recommended content","text":"<ul> <li>Using custom rules</li> <li>Creating your pipeline</li> <li>Working with baselines</li> </ul>"},{"location":"concepts/suppression/","title":"Suppression and excluding rules","text":"<p>By default, PSRule will attempt to read and test all files. You can configure options to:</p> <ul> <li>Control which files PSRule tests.</li> <li>Disable specific rules that don't apply to your environment.</li> <li>Configure exceptions for special cases.</li> </ul> <p>Abstract</p> <p>This topic covers how you can configure PSRule to ignore files, specific rules, or rules for special cases.</p>"},{"location":"concepts/suppression/#excluding-a-rule","title":"Excluding a rule","text":"<p> Docs</p> <p>You can exclude a rule to effectively disable the rule. When excluded, a rule is not used to test any Azure resources.</p> <p>To exclude a rule, set the <code>Rule.Exclude</code> option within the <code>ps-rule.yaml</code> file.</p> ps-rule.yaml<pre><code>rule:\n  exclude:\n  # Ignore the following rules for all resources\n  - Azure.VM.UseHybridUseBenefit\n  - Azure.VM.Standalone\n</code></pre>"},{"location":"concepts/suppression/#suppress-a-rule-individually","title":"Suppress a rule individually","text":"<p> Docs</p> <p>You can suppress a rule to effectively skip or ignore a rule for a specific case or exception.</p> <p>To suppress a rule, set <code>Suppression</code> option within the <code>ps-rule.yaml</code> file. PSRule allows you to specify the name of the rule and the name of the resources that will be suppressed.</p> ps-rule.yaml<pre><code>suppression:\n  Azure.Storage.SoftDelete:\n  # Ignore soft delete on the following non-production storage accounts\n  - storagedeveus6jo36t\n  - storagedeveus1df278\n</code></pre> <p>Tip</p> <p>Use comments within <code>ps-rule.yaml</code> to describe the reason why rules are excluded or suppressed. Meaningful comments help during peer review within a Pull Request (PR). Also consider including a date if the exclusions or suppressions are temporary.</p>"},{"location":"concepts/suppression/#suppressing-common-cases","title":"Suppressing common cases","text":"<p> Docs</p> <p>If you need to commonly suppress a rule for multiple resources you can use a Suppression Group. A Suppression Group allow you to define a condition for when a rule should be suppressed.</p> <p>Example</p> <p>For example, suppose you want to suppress the <code>Azure.Storage.SoftDelete</code> rule for Storage Accounts based on a tag.</p> <p>A Suppression Group can be defined within a <code>.Rule.yaml</code> file within the <code>.ps-rule/</code> sub-directory. Create this directory in your repository or current working path if it doesn't already exist.</p> .ps-rule/Suppression.Rule.yaml<pre><code>---\n# Synopsis: Ignore soft delete for development storage accounts\napiVersion: github.com/microsoft/PSRule/v1\nkind: SuppressionGroup\nmetadata:\n  name: Local.IgnoreNonProdStorage\nspec:\n  rule:\n  - Azure.Storage.SoftDelete\n  if:\n    field: tags.env\n    equals: dev\n</code></pre> <p>Learn</p> <p>To learn more, see suppression groups and expressions.</p>"},{"location":"concepts/suppression/#ignoring-files","title":"Ignoring files","text":"<p> Docs</p> <p>To exclude or ignore files from being processed, configure the Input.PathIgnore option. This option allows you to ignore files using a path spec.</p> <p>To ignore files with common extensions, set the <code>Input.PathIgnore</code> option within the <code>ps-rule.yaml</code> file.</p> ps-rule.yaml<pre><code>input:\n  pathIgnore:\n  # Exclude files with these extensions\n  - '*.md'\n  - '*.png'\n  # Exclude specific configuration files\n  - 'bicepconfig.json'\n</code></pre> <p>To ignore all files with some exceptions, set the <code>Input.PathIgnore</code> option within the <code>ps-rule.yaml</code> file.</p> ps-rule.yaml<pre><code>input:\n  pathIgnore:\n  # Exclude all files\n  - '*'\n  # Only process deploy.bicep files\n  - '!**/deploy.bicep'\n</code></pre> <p>Tip</p> <p>Some common file exclusions are recommended for working with Azure Bicep source files. See Configuring path exclusions for details.</p>"},{"location":"customization/enforce-codeowners/","title":"Enforcing code ownership","text":"<p>Abstract</p> <p>The following scenario extends on existing code ownership features available in your tool of choice. This topic covers static analysis testing for the content (specific Azure resource) within file paths. This allows you to:</p> <ul> <li>Identify if specific Azure resource types are added to file paths they shouldn't be.</li> </ul> <p>Pull requests (PRs) are a key concept within common Git workflows and DevOps culture to enforce peer review. Code ownership provides a mechanism to require one or more specific people review changes prior to merging a PR.</p> <p>For Git repositories in GitHub and Azure Repos, code ownership is controlled based on file path. If a person or team owns a file or file path they are required to review the changes proposed in the PR. The specifics of how many approvals and if approval is optional vs required is controlled by branch protection/ policies.</p> <p>In the context of Azure Infrastructure as Code (IaC) - Azure Bicep/ ARM templates, these changes may:</p> <ul> <li>Add, change, or remove infrastructure components.</li> <li>Include sensitive changes such as updates to firewall rules or policy exemptions.</li> <li>Introduce concerns that sentitive changes could be moved to a different file path to bypass review by a specific team.</li> </ul> <p>PSRule allows teams to layer on additional rules to ensure Azure resources fall within the paths expected by code ownership.</p> <p>Info</p> <p>Code ownership is implemented through CODEOWNERS in GitHub and required reviewers in Azure Repos.</p>"},{"location":"customization/enforce-codeowners/#creating-a-new-rule","title":"Creating a new rule","text":"<p>Within the <code>.ps-rule/</code> sub-directory create a new file called <code>Org.Azure.Rule.ps1</code>. Use the following snippet to populate the rule file:</p> <pre><code># Synopsis: Policy exemptions must be stored under designated paths for review.\nRule 'Org.Azure.Policy.Path' -Type 'Microsoft.Authorization/policyExemptions' {\n    $Assert.WithinPath($PSRule.Source['Parameter'], '.', @(\n        'deployments/policy/'\n    ));\n}\n</code></pre> <p>Some key points to call out with the rule snippet include:</p> <ul> <li>The name of the rule is <code>Org.Azure.Policy.Path</code>.   Each rule name must be unique.</li> <li>The rule applies to resources with the type of <code>Microsoft.Authorization/policyExemptions</code>.   i.e. Policy exemptions.</li> <li>The synopsis comment above the rule is read and used as the default recommendation if the rule fails.   The rule recommendation appears in output and is intended as an instruction to remediate the failure.</li> <li>The assertion <code>$Assert.WithinPath</code> ensures the specifies path is within the <code>deployments/policy/</code> sub-directory.</li> <li>The automatic variable <code>$PSRule.Source</code> exposes the source path for the resource.   PSRule for Azure exposes a <code>Template</code> and <code>Parameter</code> source for resources originating from a template.</li> </ul> <p>Tip</p> <p>For recommendations on naming and storing rules see using custom rules.</p>"},{"location":"customization/enforce-codeowners/#binding-type","title":"Binding type","text":"<p>Rules packaged within PSRule for Azure will automatically detect Policy Exemptions by their type properties. Standalone rules will get their type binding configuration from <code>ps-rule.yaml</code> instead.</p> <p>To configure type binding:</p> <ul> <li>Create/ update the <code>ps-rule.yaml</code> file within the root of the repository.</li> <li>Add the following configuration snippet.</li> </ul> ps-rule.yaml<pre><code># Configure binding options\nbinding:\n  targetType:\n    - 'resourceType'\n    - 'type'\n</code></pre> <p>Some key points to call out include:</p> <ul> <li>Configuring the binding for <code>targetType</code> allows rules to use the <code>-Type</code> parameter. Our custom rule uses <code>-Type 'Microsoft.Authorization/policyExemptions'</code>.</li> <li>The binding configuration will use the <code>resourceType</code> property if it exists, alternative it will use <code>type</code>. If neither property exists, PSRule will use the object type.</li> </ul>"},{"location":"customization/enforce-codeowners/#testing-locally","title":"Testing locally","text":"<p>To test the custom rule within Visual Studio Code, see How to install PSRule for Azure. Alternatively you can test the rule manually by running the following from a PowerShell terminal.</p> PowerShell<pre><code>Assert-PSRule -Path '.ps-rule/' -Module 'PSRule.Rules.Azure' `\n  -InputPath . -Format File\n</code></pre>"},{"location":"customization/enforce-codeowners/#sample-code","title":"Sample code","text":"<p>Grab the full sample code for each of these files from:</p> <ul> <li>Org.Azure.Rule.ps1</li> <li>ps-rule.yaml</li> <li>policy-exemption.parameters.json</li> <li>template.json</li> </ul>"},{"location":"customization/enforce-custom-tags/","title":"Enforcing custom tags","text":"<p>With PSRule, you can layer on custom rules with to implement organization specific requirements. These custom rules work side-by-side with PSRule for Azure.</p> <p>Use of resource and resource group tags is recommended in the WAF, however implementations may vary. You may want to use PSRule to enforce tagging or something similar early in a DevOps pipeline.</p> <p>Abstract</p> <p>The following scenario shows how to create a custom rule to validate Resource Group tags. The scenario walks you through the process so that you can apply the same concepts for similar requirements.</p>"},{"location":"customization/enforce-custom-tags/#creating-a-new-rule","title":"Creating a new rule","text":"<p>Within the <code>.ps-rule</code> sub-directory create a new file called <code>Org.Azure.Rule.ps1</code>. Use the following snippet to populate the rule file:</p> <pre><code># Synopsis: Resource Groups must have all mandatory tags defined.\nRule 'Org.Azure.RG.Tags' -Type 'Microsoft.Resources/resourceGroups' {\n    $hasTags = $Assert.HasField($TargetObject, 'Tags')\n    if (!$hasTags.Result) {\n        return $hasTags\n    }\n\n    # &lt;Code for custom tags goes here&gt;\n}\n</code></pre> <p>Some key points to call out with the rule snippet include:</p> <ul> <li>The name of the rule is <code>Org.Azure.RG.Tags</code>.   Each rule name must be unique.</li> <li>The rule applies to resources with the type of <code>Microsoft.Resources/resourceGroups</code>.   i.e. Resource Groups.</li> <li>The synopsis comment above the rule is read and used as the default recommendation if the rule fails.   The rule recommendation appears in output and is intended as an instruction to remediate the failure.</li> <li>The assertion <code>$Assert.HasField</code> ensures that Resource Group has a tags property.</li> <li>The automatic variable <code>$TargetObject</code> automatically exposes the current resource being processed.</li> </ul> <p>Tip</p> <p>For recommendations on naming and storing rules see using custom rules.</p>"},{"location":"customization/enforce-custom-tags/#adding-mandatory-tags","title":"Adding mandatory tags","text":"<p>To require specific tags to be configured on Resource Groups append this code to the rule.</p> <pre><code># Require tags be case-sensitive\n$Assert.HasField($TargetObject.tags, 'costCentre', &lt;# case-sensitive #&gt; $True)\n$Assert.HasField($TargetObject.tags, 'env', $True)\n</code></pre> <p>Some key points to call out include:</p> <ul> <li>The <code>$Assert.HasField</code> assertions are case-sensitive which differs from the previous snippet.</li> <li>A list of supported assertions can be found here.</li> <li>Comments can be added just like normal PowerShell code.</li> </ul> Updated Rule <p>The updated rule should look like:</p> <pre><code># Synopsis: Resource Groups must have all mandatory tags defined.\nRule 'Org.Azure.RG.Tags' -Type 'Microsoft.Resources/resourceGroups' {\n    $hasTags = $Assert.HasField($TargetObject, 'Tags')\n    if (!$hasTags.Result) {\n        return $hasTags\n    }\n\n    # Require tags be case-sensitive\n    $Assert.HasField($TargetObject.tags, 'costCentre', &lt;# case-sensitive #&gt; $True)\n    $Assert.HasField($TargetObject.tags, 'env', $True)\n}\n</code></pre>"},{"location":"customization/enforce-custom-tags/#limiting-tags-values","title":"Limiting tags values","text":"<p>To require these tags to only accept allowed values, append this code to the rule.</p> <pre><code>&lt;#\nThe costCentre tag must:\n- Start with a letter.\n- Be followed by a number between 10000-9999999999.\n#&gt;\n$Assert.Match($TargetObject, 'tags.costCentre', '^([A-Z][1-9][0-9]{4,9})$', $True)\n\n# Require specific values for environment tag\n$Assert.In($TargetObject, 'tags.env', @(\n    'dev',\n    'prod',\n    'uat'\n), $True)\n</code></pre> <p>Some key points to call out include:</p> <ul> <li>Each of these assertions for the field value are case-sensitive.</li> <li>Assertions can automatically traverse fields be using the dotted syntax. i.e. <code>tags.costCentre</code>.</li> </ul> Completed rule <p>The completed rule should look like:</p> <pre><code># Synopsis: Resource Groups must have all mandatory tags defined.\nRule 'Org.Azure.RG.Tags' -Type 'Microsoft.Resources/resourceGroups' {\n    $hasTags = $Assert.HasField($TargetObject, 'Tags')\n    if (!$hasTags.Result) {\n        return $hasTags\n    }\n\n    # Require tags be case-sensitive.\n    $Assert.HasField($TargetObject.tags, 'costCentre', &lt;# case-sensitive #&gt; $True)\n    $Assert.HasField($TargetObject.tags, 'env', $True)\n\n    &lt;#\n    The costCentre tag must:\n    - Start with a letter.\n    - Be followed by a number between 10000-9999999999.\n    #&gt;\n    $Assert.Match($TargetObject, 'tags.costCentre', '^([A-Z][1-9][0-9]{4,9})$', $True)\n\n    # Require specific values for environment tag.\n    $Assert.In($TargetObject, 'tags.env', @(\n        'dev',\n        'prod',\n        'uat'\n    ), $True)\n}\n</code></pre>"},{"location":"customization/enforce-custom-tags/#binding-type","title":"Binding type","text":"<p>Rules packaged within PSRule for Azure will automatically detect Resource Groups by their type properties. Standalone rules will get their type binding configuration from <code>ps-rule.yaml</code> instead.</p> <p>To configure type binding:</p> <ul> <li>Create/ update the <code>ps-rule.yaml</code> file within the root of the repository.</li> <li>Add the following configuration snippet.</li> </ul> ps-rule.yaml<pre><code># Configure binding options\nbinding:\n  targetType:\n    - 'resourceType'\n    - 'type'\n</code></pre> <p>Some key points to call out include:</p> <ul> <li>Configuring the binding for <code>targetType</code> allows rules to use the <code>-Type</code> parameter. Our custom rule uses <code>-Type 'Microsoft.Resources/resourceGroups'</code>.</li> <li>The binding configuration will use the <code>resourceType</code> property if it exists, alternative it will use <code>type</code>. If neither property exists, PSRule will use the object type.</li> </ul>"},{"location":"customization/enforce-custom-tags/#testing-locally","title":"Testing locally","text":"<p>To test the custom rule within Visual Studio Code, see How to install PSRule for Azure. Alternatively you can test the rule manually by running the following from a PowerShell terminal.</p> <pre><code>Assert-PSRule -Path '.ps-rule/' -Module 'PSRule.Rules.Azure' -InputPath . -Format File\n</code></pre>"},{"location":"customization/enforce-custom-tags/#sample-code","title":"Sample code","text":"<p>Grab the full sample code for each of these files from:</p> <ul> <li>Org.Azure.Rule.ps1</li> <li>ps-rule.yaml</li> </ul>"},{"location":"customization/permit-outbound-management/","title":"Permit outbound management","text":"<p>As discussed in Azure.NSG.LateralTraversal, outbound management traffic is expected from some subnets. Subnets that are expected allow outbound management traffic may include:</p> <ul> <li>Privileged access workstations (PAWs)</li> <li>Bastion hosts</li> <li>Jump boxes</li> </ul> <p>As a result, you may want to suppress the Azure.NSG.LateralTraversal rule on NSGs for these special cases.</p> <p>Abstract</p> <p>This topic provides an example you can use to configure PSRule to ignore special case NSGs.</p>"},{"location":"customization/permit-outbound-management/#create-a-suppression-group","title":"Create a suppression group","text":"<p>Within the <code>.ps-rule</code> sub-directory create a file called <code>Org.Azure.Suppressions.Rule.yaml</code>. If the <code>.ps-rule</code> sub-directory does not exist, create it in the root of your repository.</p> <p>Use the following snippet to populate the suppression group:</p> <pre><code>---\n# Synopsis: Ignore NSG lateral movement for management subnet NSGs such as Azure Bastion.\napiVersion: github.com/microsoft/PSRule/v1\nkind: SuppressionGroup\nmetadata:\n  name: Org.Azure.PermitOutboundManagement\nspec:\n  rule:\n  - PSRule.Rules.Azure\\Azure.NSG.LateralTraversal\n  if:\n    allOf:\n    - type: '.'\n      in:\n      - Microsoft.Network/networkSecurityGroups\n\n    # Suppress NSGs with bastion or management in thier name\n    - name: '.'\n      contains:\n      - bastion\n      - management\n</code></pre> <p>Some key points to call out with the suppression group snippet include:</p> <ul> <li>The name of the suppression group is <code>Org.Azure.PermitOutboundManagement</code>.   Each resource name must be unique.</li> <li>The suppression group applies to:<ul> <li>The rule <code>PSRule.Rules.Azure\\Azure.NSG.LateralTraversal</code>.</li> <li>Run against NSGs with the type <code>Microsoft.Network/networkSecurityGroups</code>.</li> <li>When the name of the NSG contains <code>bastion</code> or <code>management</code>.   The suppression group uses expressions to determine when a resource is suppressed.   Update this condition to match your environment.   For example, the following NSGs would be suppressed by this suppression group:<ul> <li><code>nsg-bastion-prod-eus-001</code></li> <li><code>nsg-hub-management-prod-001</code></li> </ul> </li> </ul> </li> <li>The synopsis comment above the suppression group is included in output as the explaination for the suppression.</li> </ul> <p>Tip</p> <p>Expressions can be combined within a suppression group using <code>allOf</code> or <code>anyOf</code> operators.</p>"},{"location":"customization/using-custom-rules/","title":"Using custom rules","text":"<p>PSRule for Azure covers common use cases that align to the Microsoft Azure Well-Architected Framework (WAF). In addition to WAF alignment you may have a requirement to enforce organization specific rules.</p> <p>For example:</p> <ul> <li>Required tags on a resource group.</li> <li>Code ownership for sensitive resource types.</li> <li>Apply similar controls to Infrastructure as Code that are deployed via Azure Policies.</li> </ul> <p>PSRule allows custom rules to be layered on. These custom rules work side-by-side with PSRule for Azure.</p> <p>Abstract</p> <p>This topic covers how you can use custom rules to test Azure Infrastructure as Code (IaC).</p>"},{"location":"customization/using-custom-rules/#requirements","title":"Requirements","text":"<p>For custom rules to work with IaC the following requirements must be configured:</p> <ol> <li>Set a binding configuration.</li> <li>Configure expansion for processing Bicep or ARM templates.</li> <li>Include the <code>PSRule.Rules.Azure</code> module.</li> </ol>"},{"location":"customization/using-custom-rules/#set-binding-configuration","title":"Set binding configuration","text":"<p>Rules packaged within PSRule for Azure will automatically detect Azure resources by their type properties. Standalone rules will get their type binding configuration from <code>ps-rule.yaml</code> instead. When binding is not configured, custom rules will typically be ignored.</p> <p>To configure type binding:</p> <ul> <li>Create/ update the <code>ps-rule.yaml</code> file within the root of the repository.</li> <li>Add the following configuration snippet.</li> </ul> ps-rule.yaml<pre><code># Configure binding options\nbinding:\n  targetType:\n    - 'resourceType'\n    - 'type'\n</code></pre>"},{"location":"customization/using-custom-rules/#configuring-expansion","title":"Configuring expansion","text":"<p>PSRule for Azure performs expansion on Bicep and ARM template files it finds in your repository. Enabling expansion is required for testing any IaC in your repository. The requirements for custom rules are no different then using the built-in rules included within PSRule for Azure.</p> <p>To configure expansion see either:</p> <ul> <li>Using Bicep source</li> <li> <p>Using templates</p> </li> </ul>"},{"location":"customization/using-custom-rules/#including-psrule-for-azure","title":"Including PSRule for Azure","text":"<p>When creating custom rules to test Azure IaC including PSRule for Azure is required for most scenarios. PSRule for Azure performs expansion on Bicep and ARM template files it finds in your repository.</p> <p>You can include PSRule for Azure by specifying <code>PSRule.Rules.Azure</code> in one of the following:</p> <ul> <li>Pipeline \u2014 The <code>modules:</code> parameter in GitHub Actions or Azure Pipelines.</li> <li>PowerShell \u2014 The <code>-Module</code> parameter with the PowerShell cmdlets.</li> <li> <p>Options \u2014 - The <code>Include.Module</code> option.</p> </li> </ul>"},{"location":"customization/using-custom-rules/#using-a-standard-file-path","title":"Using a standard file path","text":"<p>Rules can be standalone or packaged within a module. Standalone rules are ideal for a single project such as an Infrastructure as Code (IaC) repository. To reuse rules across multiple projects consider packaging these as a module.</p> <p>The instructions for packaging rules in a module can be found here:</p> <ul> <li>Packaging rules in a module</li> </ul> <p>To store standalone rules we recommend that you:</p> <ul> <li>Use .ps-rule/ \u2014 Create a sub-directory called <code>.ps-rule</code> in the root of your repository.   Use all lower-case in the sub-directory name.   Put any custom rules within this sub-directory.</li> <li>Use files ending with .Rule.ps1 | .Rule.yaml | .Rule.jsonc \u2014   PSRule uses a file naming convention to discover rules.   We recommend using a file name that ends in <code>.Rule.ps1</code> or <code>.Rule.yaml</code> or <code>.Rule.jsonc</code>.</li> </ul> <p>Note</p> <p>Build pipelines are often case-sensitive or run on Linux-based systems. Using the casing rule above reduces confusion latter when you configure continuous integration (CI).</p>"},{"location":"customization/using-custom-rules/#naming-rules","title":"Naming rules","text":"<p>When running PSRule, rule names must be unique. PSRule for Azure uses the name prefix of <code>Azure.</code> on all rules and resources included in the module.</p> <p>Example</p> <p>The following names are examples of rules included within PSRule for Azure:</p> <ul> <li><code>Azure.AKS.Version</code></li> <li><code>Azure.AKS.AuthorizedIPs</code></li> <li><code>Azure.SQL.MinTLS</code></li> </ul> <p>When naming custom rules we recommend that you:</p> <ul> <li>Use a standard prefix \u2014 You can use the <code>Local.</code> or <code>Org.</code> prefix for standalone rules.<ul> <li>Alternatively choose a short prefix that identifies your organization.</li> </ul> </li> <li>Use dotted notation \u2014 Use dots to separate rule name.</li> <li>Use a maximum length of 35 characters \u2014 The default view of <code>Invoke-PSRule</code> truncates longer names.   PSRule supports longer rule names however if <code>Invoke-PSRule</code> is called directly consider using <code>Format-List</code>.</li> </ul>"},{"location":"customization/using-custom-rules/#related-content","title":"Related content","text":"<ul> <li>Using Bicep source</li> <li>Using templates</li> <li>Creating your pipeline</li> </ul>"},{"location":"en/mcsb-v1/","title":"Microsoft cloud security benchmark","text":"<p>Microsoft cloud security benchmark (MCSB) is a set of controls and recommendations that help improve the security of workloads on Azure and your multi-cloud environment. Controls from the MCSB are also mapped to industry frameworks, such as CIS, PCI-DSS, and NIST.</p> <p>If you are new to MCSB or are looking for guidance on how to use it, please see the Introduction to the Microsoft cloud security benchmark.</p>"},{"location":"en/mcsb-v1/#microsoft-cloud-security-benchmark-v1","title":"Microsoft cloud security benchmark v1","text":"<p>Is the latest version of the MCSB. Rules included within PSRule for Azure have been mapped to v1 so that you are able to understand the impact of the rules. This is particularly useful when you are looking to understand how to address a compliance requirement specific to your organization.</p> <p>The following controls are included in the Microsoft cloud security benchmark v1:</p> <ul> <li>Network security (NS)</li> <li>Identity Management (IM)</li> <li>Privileged Access (PA)</li> <li>Data Protection (DP)</li> <li>Asset Management (AM)</li> <li>Logging and Threat Detection (LT)</li> <li>Incident Response (IR)</li> <li>Posture and Vulnerability Management (PV)</li> <li>Endpoint Security (ES)</li> <li>Backup and Recovery (BR)</li> <li>DevOps Security (DS)</li> <li> <p>Governance and Strategy (GS)</p> </li> </ul>"},{"location":"en/mcsb-v1/#using-the-mcsb-v1-baseline","title":"Using the MCSB v1 baseline","text":"<p> Experimental \u00b7  v1.25.0</p> <p>To start using the MCSB v1 baseline with PSRule, configure the baseline parameter to use <code>Azure.MCSB.v1</code>. View the list of rules associated with the MCSB v1 baseline.</p> <p>Experimental - Learn more</p> <p>MCSB baselines are a work in progress and subject to change. We hope to add more rules to the baseline in the future. Join or start a discussion to let us know how we can improve this feature going forward.</p> <p>Note</p> <p>It's important to note that the MCSB v1 baseline is subset of rules from the Well-Architected Framework. Not all rules for the Well-Architected Framework are included in MCSB. Using the MCSB v1 baseline is useful to understand alignment with the MCSB and other industry frameworks / standards. For a complete set of rules for the Well-Architected Framework, consider using a quarterly baseline.</p>"},{"location":"en/mcsb-v1/#recommended-content","title":"Recommended content","text":"<ul> <li>Overview of Microsoft cloud security benchmark (v1)</li> <li>Using baselines</li> </ul>"},{"location":"en/baselines/","title":"Baselines","text":""},{"location":"en/baselines/#quarterly-baselines","title":"Quarterly baselines","text":"<p>Quarterly baselines provide a quarterly checkpoint of rules.</p>"},{"location":"en/baselines/#ga","title":"GA","text":"<p>The following baselines relate to generally available Azure features.</p> Name Synopsis Status Azure.GA_2024_09 Include rules released September 2024 or prior for Azure GA features. Latest Azure.GA_2024_06 Include rules released June 2024 or prior for Azure GA features. Obsolete Azure.GA_2024_03 Include rules released March 2024 or prior for Azure GA features. Obsolete Azure.GA_2023_12 Include rules released December 2023 or prior for Azure GA features. Obsolete Azure.GA_2023_09 Include rules released September 2023 or prior for Azure GA features. Obsolete Azure.GA_2023_06 Include rules released June 2023 or prior for Azure GA features. Obsolete Azure.GA_2023_03 Include rules released March 2023 or prior for Azure GA features. Obsolete Azure.GA_2022_12 Include rules released December 2022 or prior for Azure GA features. Obsolete Azure.GA_2022_09 Include rules released September 2022 or prior for Azure GA features. Obsolete Azure.GA_2022_06 Include rules released June 2022 or prior for Azure GA features. Obsolete Azure.GA_2022_03 Include rules released March 2022 or prior for Azure GA features. Obsolete Azure.GA_2021_12 Include rules released December 2021 or prior for Azure GA features. Obsolete Azure.GA_2021_09 Include rules released September 2021 or prior for Azure GA features. Obsolete Azure.GA_2021_06 Include rules released June 2021 or prior for Azure GA features. Obsolete Azure.GA_2021_03 Include rules released March 2021 or prior for Azure GA features. Obsolete Azure.GA_2020_12 Include rules released December 2020 or prior for Azure GA features. Obsolete Azure.GA_2020_09 Include rules released September 2020 or prior for Azure GA features. Obsolete Azure.GA_2020_06 Include rules released June 2020 or prior for Azure GA features. Obsolete"},{"location":"en/baselines/#preview","title":"Preview","text":"<p>The following baselines relate to preview Azure features.</p> Name Synopsis Status Azure.Preview_2024_09 Include rules released September 2024 or prior for Azure preview only features. Latest Azure.Preview_2024_06 Include rules released June 2024 or prior for Azure preview only features. Obsolete Azure.Preview_2024_03 Include rules released March 2024 or prior for Azure preview only features. Obsolete Azure.Preview_2023_12 Include rules released December 2023 or prior for Azure preview only features. Obsolete Azure.Preview_2023_09 Include rules released September 2023 or prior for Azure preview only features. Obsolete Azure.Preview_2023_06 Include rules released June 2023 or prior for Azure preview only features. Obsolete Azure.Preview_2023_03 Include rules released March 2023 or prior for Azure preview only features. Obsolete Azure.Preview_2022_12 Include rules released December 2022 or prior for Azure preview only features. Obsolete Azure.Preview_2022_09 Include rules released September 2022 or prior for Azure preview only features. Obsolete Azure.Preview_2022_06 Include rules released June 2022 or prior for Azure preview only features. Obsolete Azure.Preview_2022_03 Include rules released March 2022 or prior for Azure preview only features. Obsolete Azure.Preview_2021_12 Include rules released December 2021 or prior for Azure preview only features. Obsolete Azure.Preview_2021_09 Include rules released September 2021 or prior for Azure preview only features. Obsolete"},{"location":"en/baselines/#pillar-specific-baselines","title":"Pillar specific baselines","text":"<p>Pillar specific baselines provide a focused set of rules for a specific Azure Well-Architected Pillar.</p> Name Synopsis Status Azure.Pillar.Security Microsoft Azure Well-Architected Framework - Security pillar specific baseline. Latest Azure.Pillar.Reliability Microsoft Azure Well-Architected Framework - Reliability pillar specific baseline. Latest Azure.Pillar.PerformanceEfficiency Microsoft Azure Well-Architected Framework - Performance Efficiency pillar specific baseline. Latest Azure.Pillar.OperationalExcellence Microsoft Azure Well-Architected Framework - Operational Excellence pillar specific baseline. Latest Azure.Pillar.CostOptimization Microsoft Azure Well-Architected Framework - Cost Optimization pillar specific baseline. Latest"},{"location":"en/baselines/Azure.All/","title":"Azure.All","text":"<p>Includes all Azure rules.</p>"},{"location":"en/baselines/Azure.All/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.All</code> baseline.</p> <p>This baseline includes a total of 451 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.AnonymousAccess Anonymous pull access allows unidentified downloading of images and metadata from a container registry. Important Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.Firewall Container Registry without restrictions can be accessed from any network location including the Internet. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Important Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Azure.AKS.AuditAdmin Use kube-audit-admin instead of kube-audit to capture administrative actions in AKS clusters. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.MaintenanceWindow Configure customer-controlled maintenance windows for AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.MinUserPoolNodes User node pools in an AKS cluster should have a minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeAutoUpgrade Deploy AKS Clusters with Node Auto-Upgrade enabled Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API Management instances should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. Important Azure.APIM.DefenderCloud APIs published in Azure API Management should be onboarded to Microsoft Defender for APIs. Critical Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. Important Azure.APIM.MultiRegion Enhance service availability and resilience by deploying API Management instances across multiple regions. Important Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.PolicyBase Base element for any policy element in a section should be configured. Important Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Azure.AppConfig.GeoReplica Replicate app configuration store across all points of presence for an application. Important Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. Important Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MigrateV2 Use a Application Gateway v2 SKU. Important Azure.AppGw.MigrateWAFPolicy Migrate to Application Gateway WAF policy. Critical Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.Name Application Gateways should meet naming requirements. Awareness Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppGwWAF.RuleGroups Use recommended rule groups in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.AvailabilityZone Deploy app service plan instances using availability zones in supported regions to ensure high availability and resilience. Important Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.NodeJsVersion Configure applications to use supported Node.js runtime versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.Arc.Kubernetes.Defender Deploy Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters. Important Azure.Arc.Server.MaintenanceConfig Use a maintenance configuration for Arc-enabled servers. Important Azure.ASE.AvailabilityZone Deploy app service environments using availability zones in supported regions to ensure high availability and resilience. Important Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.AVD.ScheduleAgentUpdate Define a windows for agent updates to minimize disruptions to users. Important Azure.Bastion.Name Bastion hosts should meet naming requirements. Awareness Azure.BV.Immutable Ensure immutability is configured to protect backup data. Important Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.ContainerApp.APIVersion Migrate from retired API version to a supported version. Important Azure.ContainerApp.AvailabilityZone Use Container Apps environments that are zone redundant to improve reliability. Important Azure.ContainerApp.DisableAffinity Disable session affinity to prevent unbalanced distribution. Awareness Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. Important Azure.ContainerApp.MinReplicas Use multiple replicas to remove a single point of failure. Important Azure.ContainerApp.Name Container Apps should meet naming requirements. Awareness Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. Important Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. Important Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. Awareness Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.ContinuousBackup Enable continuous backup on Cosmos DB accounts. Important Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Cosmos.DisableLocalAuth Access keys allow depersonalized access to Cosmos DB accounts using a shared secret. Critical Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.Cosmos.MinTLS Cosmos DB accounts should reject TLS versions older than 1.2. Critical Azure.Cosmos.PublicAccess Azure Cosmos DB should have public network access disabled. Critical Azure.Cosmos.SLA Use a paid tier to qualify for a Service Level Agreement (SLA). Important Azure.Databricks.PublicAccess Azure Databricks workspaces should disable public network access. Critical Azure.Databricks.SecureConnectivity Use Databricks workspaces configured for secure cluster connectivity. Critical Azure.Databricks.SKU Ensure Databricks workspaces are non-trial SKUs for production workloads. Critical Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Defender.Api Enable Microsoft Defender for APIs. Critical Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). Critical Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. Critical Azure.Defender.Dns Enable Microsoft Defender for DNS. Critical Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. Critical Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. Critical Azure.Defender.SecurityContact Important security notifications may be lost or not processed in a timely manner when a clear security contact is not identified. Important Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Azure.Defender.Storage Enable Microsoft Defender for Storage. Critical Azure.Defender.Storage.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Azure.Defender.Storage.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. Awareness Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. Critical Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Azure.Deployment.SecureParameter Sensitive parameters that have been not been marked as secure may leak the secret into deployment history or logs. Critical Azure.Deployment.SecureValue A secret property set from a non-secure value may leak the secret into deployment history or logs. Critical Azure.DevBox.ProjectLimit Limit the number of Dev Boxes a single user can create for a project. Important Azure.EntraDS.NTLM Disable NTLM v1 for Microsoft Entra Domain Services. Critical Azure.EntraDS.RC4 Disable RC4 encryption for Microsoft Entra Domain Services. Critical Azure.EntraDS.TLS Disable TLS v1 for Microsoft Entra Domain Services. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Azure.EventHub.Firewall Access to the namespace endpoints should be restricted to only allowed sources. Critical Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. Critical Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.AvailabilityZone Deploy firewall instances using availability zones in supported regions to ensure high availability and resilience. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyMode Deny high confidence malicious IP addresses, domains and URLs. Critical Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Azure Front Door profiles. Important Azure.FrontDoor.ManagedIdentity Ensure Front Door uses a managed identity to authorize access to Azure resources. Important Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.Grafana.Version Grafana workspaces should be on Grafana version 10. Important Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. Awareness Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogAnalytics.Replication Log Analytics workspaces should have workspace replication enabled to improve service availability. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. Awareness Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. Important Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. Awareness Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. Important Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. Critical Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. Awareness Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. Critical Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. Awareness Azure.ML.ComputeIdleShutdown Configure an idle shutdown timeout for Machine Learning compute instances. Critical Azure.ML.ComputeVnet Azure Machine Learning Computes should be hosted in a virtual network (VNet). Critical Azure.ML.DisableLocalAuth Azure Machine Learning compute resources should have local authentication methods disabled. Critical Azure.ML.PublicAccess Disable public network access from a Azure Machine Learning workspace. Critical Azure.ML.UserManagedIdentity ML workspaces should use user-assigned managed identity, rather than the default system-assigned managed identity. Important Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. Critical Azure.MySQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. Important Azure.MySQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for MySQL servers. Important Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. Important Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.MySQL.ZoneRedundantHA Deploy Azure Database for MySQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. Critical Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. Important Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. Important Azure.PostgreSQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for PostgreSQL servers. Important Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PostgreSQL.ZoneRedundantHA Deploy Azure Database for PostgreSQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.MigrateStandard Use the Standard SKU for Public IP addresses as the Basic SKU will be retired. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.EntraID Use Entra ID authentication with cache instances. Critical Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. Important Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.Immutable Ensure immutability is configured to protect backup data. Important Azure.RSV.Name Recovery Services vaults should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Azure.ServiceBus.GeoReplica Enhance resilience to regional outages by replicating namespaces. Important Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. Important Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL databases. Important Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. Critical Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. Important Azure.SQLMI.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL Managed Instances. Important Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Azure.Storage.Defender.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Azure.Storage.Defender.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. Critical Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASDistributeTraffic Ensure high availability by distributing traffic among members in an availability set. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.MaintenanceConfig Use a maintenance configuration for virtual machines. Important Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VM.MultiTenantHosting Deploy Windows 10 and 11 virtual machines in Azure using Multi-tenant Hosting Rights to leverage your existing Windows licenses. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicIPAttached Avoid attaching public IPs directly to virtual machines. Critical Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. Important Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. Important Azure.VMSS.AutoInstanceRepairs Automatic instance repairs are enabled. Important Azure.VMSS.AvailabilityZone Deploy virtual machine scale set instances using availability zones in supported regions to ensure high availability and resilience. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VMSS.PublicIPAttached Avoid attaching public IPs directly to virtual machine scale set instances. Critical Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VMSS.ZoneBalance Deploy virtual machine scale set instances using the best-effort zone balance in supported regions. Important Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. Important Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. Important Azure.VNET.FirewallSubnetNAT Zonal-deployed Azure Firewalls should consider using an Azure NAT Gateway for outbound access. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.PrivateSubnet Disable default outbound access for virtual machines. Critical Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.MaintenanceConfig Use a customer-controlled maintenance configuration for virtual network gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important"},{"location":"en/baselines/Azure.Default/","title":"Azure.Default","text":"<p>Default baseline for that includes the latest rules for Azure GA features that is updated each release.</p>"},{"location":"en/baselines/Azure.Default/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Default</code> baseline.</p> <p>This baseline includes a total of 434 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.Firewall Container Registry without restrictions can be accessed from any network location including the Internet. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Azure.AKS.AuditAdmin Use kube-audit-admin instead of kube-audit to capture administrative actions in AKS clusters. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.MaintenanceWindow Configure customer-controlled maintenance windows for AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.MinUserPoolNodes User node pools in an AKS cluster should have a minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeAutoUpgrade Deploy AKS Clusters with Node Auto-Upgrade enabled Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API Management instances should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. Important Azure.APIM.DefenderCloud APIs published in Azure API Management should be onboarded to Microsoft Defender for APIs. Critical Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. Important Azure.APIM.MultiRegion Enhance service availability and resilience by deploying API Management instances across multiple regions. Important Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.PolicyBase Base element for any policy element in a section should be configured. Important Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Azure.AppConfig.GeoReplica Replicate app configuration store across all points of presence for an application. Important Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. Important Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MigrateV2 Use a Application Gateway v2 SKU. Important Azure.AppGw.MigrateWAFPolicy Migrate to Application Gateway WAF policy. Critical Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.Name Application Gateways should meet naming requirements. Awareness Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppGwWAF.RuleGroups Use recommended rule groups in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.AvailabilityZone Deploy app service plan instances using availability zones in supported regions to ensure high availability and resilience. Important Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.NodeJsVersion Configure applications to use supported Node.js runtime versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASE.AvailabilityZone Deploy app service environments using availability zones in supported regions to ensure high availability and resilience. Important Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.AVD.ScheduleAgentUpdate Define a windows for agent updates to minimize disruptions to users. Important Azure.Bastion.Name Bastion hosts should meet naming requirements. Awareness Azure.BV.Immutable Ensure immutability is configured to protect backup data. Important Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.ContainerApp.APIVersion Migrate from retired API version to a supported version. Important Azure.ContainerApp.AvailabilityZone Use Container Apps environments that are zone redundant to improve reliability. Important Azure.ContainerApp.DisableAffinity Disable session affinity to prevent unbalanced distribution. Awareness Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. Important Azure.ContainerApp.MinReplicas Use multiple replicas to remove a single point of failure. Important Azure.ContainerApp.Name Container Apps should meet naming requirements. Awareness Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. Important Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. Important Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. Awareness Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.ContinuousBackup Enable continuous backup on Cosmos DB accounts. Important Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Cosmos.DisableLocalAuth Access keys allow depersonalized access to Cosmos DB accounts using a shared secret. Critical Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.Cosmos.MinTLS Cosmos DB accounts should reject TLS versions older than 1.2. Critical Azure.Cosmos.PublicAccess Azure Cosmos DB should have public network access disabled. Critical Azure.Cosmos.SLA Use a paid tier to qualify for a Service Level Agreement (SLA). Important Azure.Databricks.PublicAccess Azure Databricks workspaces should disable public network access. Critical Azure.Databricks.SecureConnectivity Use Databricks workspaces configured for secure cluster connectivity. Critical Azure.Databricks.SKU Ensure Databricks workspaces are non-trial SKUs for production workloads. Critical Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Defender.Api Enable Microsoft Defender for APIs. Critical Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). Critical Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. Critical Azure.Defender.Dns Enable Microsoft Defender for DNS. Critical Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. Critical Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. Critical Azure.Defender.SecurityContact Important security notifications may be lost or not processed in a timely manner when a clear security contact is not identified. Important Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Azure.Defender.Storage Enable Microsoft Defender for Storage. Critical Azure.Defender.Storage.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. Awareness Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. Critical Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Azure.Deployment.SecureParameter Sensitive parameters that have been not been marked as secure may leak the secret into deployment history or logs. Critical Azure.Deployment.SecureValue A secret property set from a non-secure value may leak the secret into deployment history or logs. Critical Azure.DevBox.ProjectLimit Limit the number of Dev Boxes a single user can create for a project. Important Azure.EntraDS.NTLM Disable NTLM v1 for Microsoft Entra Domain Services. Critical Azure.EntraDS.RC4 Disable RC4 encryption for Microsoft Entra Domain Services. Critical Azure.EntraDS.TLS Disable TLS v1 for Microsoft Entra Domain Services. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Azure.EventHub.Firewall Access to the namespace endpoints should be restricted to only allowed sources. Critical Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. Critical Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.AvailabilityZone Deploy firewall instances using availability zones in supported regions to ensure high availability and resilience. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyMode Deny high confidence malicious IP addresses, domains and URLs. Critical Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Azure Front Door profiles. Important Azure.FrontDoor.ManagedIdentity Ensure Front Door uses a managed identity to authorize access to Azure resources. Important Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.Grafana.Version Grafana workspaces should be on Grafana version 10. Important Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. Awareness Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. Awareness Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. Important Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. Awareness Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. Important Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. Critical Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. Awareness Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. Critical Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. Awareness Azure.ML.ComputeIdleShutdown Configure an idle shutdown timeout for Machine Learning compute instances. Critical Azure.ML.ComputeVnet Azure Machine Learning Computes should be hosted in a virtual network (VNet). Critical Azure.ML.DisableLocalAuth Azure Machine Learning compute resources should have local authentication methods disabled. Critical Azure.ML.PublicAccess Disable public network access from a Azure Machine Learning workspace. Critical Azure.ML.UserManagedIdentity ML workspaces should use user-assigned managed identity, rather than the default system-assigned managed identity. Important Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. Critical Azure.MySQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. Important Azure.MySQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for MySQL servers. Important Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. Important Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.MySQL.ZoneRedundantHA Deploy Azure Database for MySQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. Critical Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. Important Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. Important Azure.PostgreSQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for PostgreSQL servers. Important Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PostgreSQL.ZoneRedundantHA Deploy Azure Database for PostgreSQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.MigrateStandard Use the Standard SKU for Public IP addresses as the Basic SKU will be retired. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.EntraID Use Entra ID authentication with cache instances. Critical Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. Important Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.Immutable Ensure immutability is configured to protect backup data. Important Azure.RSV.Name Recovery Services vaults should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. Important Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL databases. Important Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. Critical Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. Important Azure.SQLMI.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL Managed Instances. Important Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Azure.Storage.Defender.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. Critical Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASDistributeTraffic Ensure high availability by distributing traffic among members in an availability set. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.MaintenanceConfig Use a maintenance configuration for virtual machines. Important Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VM.MultiTenantHosting Deploy Windows 10 and 11 virtual machines in Azure using Multi-tenant Hosting Rights to leverage your existing Windows licenses. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicIPAttached Avoid attaching public IPs directly to virtual machines. Critical Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. Important Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. Important Azure.VMSS.AvailabilityZone Deploy virtual machine scale set instances using availability zones in supported regions to ensure high availability and resilience. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VMSS.PublicIPAttached Avoid attaching public IPs directly to virtual machine scale set instances. Critical Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VMSS.ZoneBalance Deploy virtual machine scale set instances using the best-effort zone balance in supported regions. Important Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. Important Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. Important Azure.VNET.FirewallSubnetNAT Zonal-deployed Azure Firewalls should consider using an Azure NAT Gateway for outbound access. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important"},{"location":"en/baselines/Azure.GA_2020_06/","title":"Azure.GA_2020_06","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released June 2020 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2020_06/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2020_06</code> baseline.</p> <p>This baseline includes a total of 135 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical"},{"location":"en/baselines/Azure.GA_2020_09/","title":"Azure.GA_2020_09","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released September 2020 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2020_09/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2020_09</code> baseline.</p> <p>This baseline includes a total of 149 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical"},{"location":"en/baselines/Azure.GA_2020_12/","title":"Azure.GA_2020_12","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released December 2020 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2020_12/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2020_12</code> baseline.</p> <p>This baseline includes a total of 171 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical"},{"location":"en/baselines/Azure.GA_2021_03/","title":"Azure.GA_2021_03","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released March 2021 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2021_03/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2021_03</code> baseline.</p> <p>This baseline includes a total of 185 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical"},{"location":"en/baselines/Azure.GA_2021_06/","title":"Azure.GA_2021_06","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released June 2021 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2021_06/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2021_06</code> baseline.</p> <p>This baseline includes a total of 199 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical"},{"location":"en/baselines/Azure.GA_2021_09/","title":"Azure.GA_2021_09","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released September 2021 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2021_09/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2021_09</code> baseline.</p> <p>This baseline includes a total of 217 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical"},{"location":"en/baselines/Azure.GA_2021_12/","title":"Azure.GA_2021_12","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released December 2021 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2021_12/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2021_12</code> baseline.</p> <p>This baseline includes a total of 242 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness"},{"location":"en/baselines/Azure.GA_2022_03/","title":"Azure.GA_2022_03","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released March 2022 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2022_03/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2022_03</code> baseline.</p> <p>This baseline includes a total of 258 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important"},{"location":"en/baselines/Azure.GA_2022_06/","title":"Azure.GA_2022_06","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released June 2022 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2022_06/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2022_06</code> baseline.</p> <p>This baseline includes a total of 262 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important"},{"location":"en/baselines/Azure.GA_2022_09/","title":"Azure.GA_2022_09","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released September 2022 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2022_09/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2022_09</code> baseline.</p> <p>This baseline includes a total of 293 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important"},{"location":"en/baselines/Azure.GA_2022_12/","title":"Azure.GA_2022_12","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released December 2022 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2022_12/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2022_12</code> baseline.</p> <p>This baseline includes a total of 329 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. Important Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. Important Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.Name Application Gateways should meet naming requirements. Awareness Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.Bastion.Name Bastion hosts should meet naming requirements. Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. Critical Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. Awareness Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. Important Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. Awareness Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. Important Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. Critical Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. Awareness Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. Critical Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. Awareness Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. Important Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. Important Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. Important Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. Important Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.Name Recovery Services vaults should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. Important Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. Important Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important"},{"location":"en/baselines/Azure.GA_2023_03/","title":"Azure.GA_2023_03","text":"<p>v1.26.0</p> <p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released March 2023 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2023_03/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2023_03</code> baseline.</p> <p>This baseline includes a total of 349 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. Important Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. Important Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.Name Application Gateways should meet naming requirements. Awareness Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.Bastion.Name Bastion hosts should meet naming requirements. Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. Important Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. Important Azure.ContainerApp.Name Container Apps should meet naming requirements. Awareness Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. Important Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. Awareness Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). Critical Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Azure.Defender.Dns Enable Microsoft Defender for DNS. Critical Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. Critical Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. Awareness Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. Critical Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. Critical Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. Awareness Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. Important Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. Awareness Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. Important Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. Critical Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. Awareness Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. Critical Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. Awareness Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. Important Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. Important Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. Important Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. Important Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.Name Recovery Services vaults should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. Important Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. Critical Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. Important Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. Important Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. Important Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. Important Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important"},{"location":"en/baselines/Azure.GA_2023_06/","title":"Azure.GA_2023_06","text":"<p>v1.28.0</p> <p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released June 2023 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2023_06/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2023_06</code> baseline.</p> <p>This baseline includes a total of 364 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. Important Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. Important Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.PolicyBase Base element for any policy element in a section should be configured. Important Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. Important Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MigrateV2 Use a Application Gateway v2 SKU. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.Name Application Gateways should meet naming requirements. Awareness Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.Bastion.Name Bastion hosts should meet naming requirements. Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. Important Azure.ContainerApp.Name Container Apps should meet naming requirements. Awareness Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. Important Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. Important Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. Awareness Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). Critical Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. Critical Azure.Defender.Dns Enable Microsoft Defender for DNS. Critical Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. Critical Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. Critical Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Azure.Defender.Storage Enable Microsoft Defender for Storage. Critical Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. Awareness Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. Critical Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. Critical Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. Awareness Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. Awareness Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. Important Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. Awareness Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. Important Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. Critical Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. Awareness Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. Critical Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. Awareness Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. Critical Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. Important Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. Important Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. Critical Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. Important Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. Important Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. Important Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.Name Recovery Services vaults should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. Important Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. Critical Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. Important Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. Critical Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. Important Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. Important Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. Important Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important"},{"location":"en/baselines/Azure.GA_2023_09/","title":"Azure.GA_2023_09","text":"<p>v1.30.0</p> <p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released September 2023 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2023_09/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2023_09</code> baseline.</p> <p>This baseline includes a total of 375 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.Firewall Container Registry without restrictions can be accessed from any network location including the Internet. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. Important Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. Important Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.PolicyBase Base element for any policy element in a section should be configured. Important Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. Important Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MigrateV2 Use a Application Gateway v2 SKU. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.Name Application Gateways should meet naming requirements. Awareness Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.Bastion.Name Bastion hosts should meet naming requirements. Awareness Azure.BV.Immutable Ensure immutability is configured to protect backup data. Important Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.ContainerApp.APIVersion Migrate from retired API version to a supported version. Important Azure.ContainerApp.DisableAffinity Disable session affinity to prevent unbalanced distribution. Awareness Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. Important Azure.ContainerApp.Name Container Apps should meet naming requirements. Awareness Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. Important Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. Important Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. Awareness Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.Databricks.SecureConnectivity Use Databricks workspaces configured for secure cluster connectivity. Critical Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). Critical Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. Critical Azure.Defender.Dns Enable Microsoft Defender for DNS. Critical Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. Critical Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. Critical Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Azure.Defender.Storage Enable Microsoft Defender for Storage. Critical Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. Awareness Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. Critical Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. Critical Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyMode Deny high confidence malicious IP addresses, domains and URLs. Critical Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.ManagedIdentity Ensure Front Door uses a managed identity to authorize access to Azure resources. Important Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. Awareness Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. Awareness Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. Important Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. Awareness Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. Important Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. Critical Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. Awareness Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. Critical Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. Awareness Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. Critical Azure.MySQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. Important Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. Important Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. Critical Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. Important Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. Important Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.MigrateStandard Use the Standard SKU for Public IP addresses as the Basic SKU will be retired. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. Important Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.Immutable Ensure immutability is configured to protect backup data. Important Azure.RSV.Name Recovery Services vaults should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. Important Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. Critical Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. Important Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. Critical Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. Important Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. Important Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. Important Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important"},{"location":"en/baselines/Azure.GA_2023_12/","title":"Azure.GA_2023_12","text":"<p>v1.32.0</p> <p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released December 2023 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2023_12/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2023_12</code> baseline.</p> <p>This baseline includes a total of 384 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.Firewall Container Registry without restrictions can be accessed from any network location including the Internet. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. Important Azure.APIM.DefenderCloud APIs published in Azure API Management should be onboarded to Microsoft Defender for APIs. Critical Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. Important Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.PolicyBase Base element for any policy element in a section should be configured. Important Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Azure.AppConfig.GeoReplica Replicate app configuration store across all points of presence for an application. Important Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. Important Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MigrateV2 Use a Application Gateway v2 SKU. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.Name Application Gateways should meet naming requirements. Awareness Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.Bastion.Name Bastion hosts should meet naming requirements. Awareness Azure.BV.Immutable Ensure immutability is configured to protect backup data. Important Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.ContainerApp.APIVersion Migrate from retired API version to a supported version. Important Azure.ContainerApp.DisableAffinity Disable session affinity to prevent unbalanced distribution. Awareness Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. Important Azure.ContainerApp.Name Container Apps should meet naming requirements. Awareness Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. Important Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. Important Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. Awareness Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.Databricks.SecureConnectivity Use Databricks workspaces configured for secure cluster connectivity. Critical Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Defender.Api Enable Microsoft Defender for APIs. Critical Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). Critical Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. Critical Azure.Defender.Dns Enable Microsoft Defender for DNS. Critical Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. Critical Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. Critical Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Azure.Defender.Storage Enable Microsoft Defender for Storage. Critical Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. Awareness Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. Critical Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Azure.Deployment.SecureParameter Sensitive parameters that have been not been marked as secure may leak the secret into deployment history or logs. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. Critical Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyMode Deny high confidence malicious IP addresses, domains and URLs. Critical Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.ManagedIdentity Ensure Front Door uses a managed identity to authorize access to Azure resources. Important Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. Awareness Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. Awareness Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. Important Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. Awareness Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. Important Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. Critical Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. Awareness Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. Critical Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. Awareness Azure.ML.ComputeIdleShutdown Configure an idle shutdown timeout for Machine Learning compute instances. Critical Azure.ML.ComputeVnet Azure Machine Learning Computes should be hosted in a virtual network (VNet). Critical Azure.ML.DisableLocalAuth Azure Machine Learning compute resources should have local authentication methods disabled. Critical Azure.ML.PublicAccess Disable public network access from a Azure Machine Learning workspace. Critical Azure.ML.UserManagedIdentity ML workspaces should use user-assigned managed identity, rather than the default system-assigned managed identity. Important Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. Critical Azure.MySQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. Important Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. Important Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. Critical Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. Important Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. Important Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.MigrateStandard Use the Standard SKU for Public IP addresses as the Basic SKU will be retired. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. Important Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.Immutable Ensure immutability is configured to protect backup data. Important Azure.RSV.Name Recovery Services vaults should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. Important Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. Critical Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. Important Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. Critical Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. Important Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. Important Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. Important Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important"},{"location":"en/baselines/Azure.GA_2024_03/","title":"Azure.GA_2024_03","text":"<p>v1.35.0</p> <p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released March 2024 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2024_03/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2024_03</code> baseline.</p> <p>This baseline includes a total of 394 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.Firewall Container Registry without restrictions can be accessed from any network location including the Internet. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.MinUserPoolNodes User node pools in an AKS cluster should have a minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. Important Azure.APIM.DefenderCloud APIs published in Azure API Management should be onboarded to Microsoft Defender for APIs. Critical Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. Important Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.PolicyBase Base element for any policy element in a section should be configured. Important Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Azure.AppConfig.GeoReplica Replicate app configuration store across all points of presence for an application. Important Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. Important Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MigrateV2 Use a Application Gateway v2 SKU. Important Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.Name Application Gateways should meet naming requirements. Awareness Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppGwWAF.RuleGroups Use recommended rule groups in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.Bastion.Name Bastion hosts should meet naming requirements. Awareness Azure.BV.Immutable Ensure immutability is configured to protect backup data. Important Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.ContainerApp.APIVersion Migrate from retired API version to a supported version. Important Azure.ContainerApp.DisableAffinity Disable session affinity to prevent unbalanced distribution. Awareness Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. Important Azure.ContainerApp.Name Container Apps should meet naming requirements. Awareness Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. Important Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. Important Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. Awareness Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.Databricks.PublicAccess Azure Databricks workspaces should disable public network access. Critical Azure.Databricks.SecureConnectivity Use Databricks workspaces configured for secure cluster connectivity. Critical Azure.Databricks.SKU Ensure Databricks workspaces are non-trial SKUs for production workloads. Critical Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Defender.Api Enable Microsoft Defender for APIs. Critical Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). Critical Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. Critical Azure.Defender.Dns Enable Microsoft Defender for DNS. Critical Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. Critical Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. Critical Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Azure.Defender.Storage Enable Microsoft Defender for Storage. Critical Azure.Defender.Storage.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. Awareness Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. Critical Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Azure.Deployment.SecureParameter Sensitive parameters that have been not been marked as secure may leak the secret into deployment history or logs. Critical Azure.DevBox.ProjectLimit Limit the number of Dev Boxes a single user can create for a project. Important Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. Critical Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyMode Deny high confidence malicious IP addresses, domains and URLs. Critical Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Azure Front Door profiles. Important Azure.FrontDoor.ManagedIdentity Ensure Front Door uses a managed identity to authorize access to Azure resources. Important Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. Awareness Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. Awareness Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. Important Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. Awareness Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. Important Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. Critical Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. Awareness Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. Critical Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. Awareness Azure.ML.ComputeIdleShutdown Configure an idle shutdown timeout for Machine Learning compute instances. Critical Azure.ML.ComputeVnet Azure Machine Learning Computes should be hosted in a virtual network (VNet). Critical Azure.ML.DisableLocalAuth Azure Machine Learning compute resources should have local authentication methods disabled. Critical Azure.ML.PublicAccess Disable public network access from a Azure Machine Learning workspace. Critical Azure.ML.UserManagedIdentity ML workspaces should use user-assigned managed identity, rather than the default system-assigned managed identity. Important Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. Critical Azure.MySQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. Important Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. Important Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. Critical Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. Important Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. Important Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.MigrateStandard Use the Standard SKU for Public IP addresses as the Basic SKU will be retired. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. Important Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.Immutable Ensure immutability is configured to protect backup data. Important Azure.RSV.Name Recovery Services vaults should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. Important Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. Critical Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. Important Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Azure.Storage.Defender.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. Critical Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. Important Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. Important Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. Important Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important"},{"location":"en/baselines/Azure.GA_2024_06/","title":"Azure.GA_2024_06","text":"<p>v1.38.0</p> <p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released June 2024 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2024_06/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2024_06</code> baseline.</p> <p>This baseline includes a total of 415 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.Firewall Container Registry without restrictions can be accessed from any network location including the Internet. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.MinUserPoolNodes User node pools in an AKS cluster should have a minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeAutoUpgrade Deploy AKS Clusters with Node Auto-Upgrade enabled Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API Management instances should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. Important Azure.APIM.DefenderCloud APIs published in Azure API Management should be onboarded to Microsoft Defender for APIs. Critical Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. Important Azure.APIM.MultiRegion Enhance service availability and resilience by deploying API Management instances across multiple regions. Important Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.PolicyBase Base element for any policy element in a section should be configured. Important Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Azure.AppConfig.GeoReplica Replicate app configuration store across all points of presence for an application. Important Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. Important Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MigrateV2 Use a Application Gateway v2 SKU. Important Azure.AppGw.MigrateWAFPolicy Migrate to Application Gateway WAF policy. Critical Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.Name Application Gateways should meet naming requirements. Awareness Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppGwWAF.RuleGroups Use recommended rule groups in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.NodeJsVersion Configure applications to use supported Node.js runtime versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.AVD.ScheduleAgentUpdate Define a windows for agent updates to minimize disruptions to users. Important Azure.Bastion.Name Bastion hosts should meet naming requirements. Awareness Azure.BV.Immutable Ensure immutability is configured to protect backup data. Important Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.ContainerApp.APIVersion Migrate from retired API version to a supported version. Important Azure.ContainerApp.AvailabilityZone Use Container Apps environments that are zone redundant to improve reliability. Important Azure.ContainerApp.DisableAffinity Disable session affinity to prevent unbalanced distribution. Awareness Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. Important Azure.ContainerApp.MinReplicas Use multiple replicas to remove a single point of failure. Important Azure.ContainerApp.Name Container Apps should meet naming requirements. Awareness Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. Important Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. Important Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. Awareness Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Cosmos.DisableLocalAuth Access keys allow depersonalized access to Cosmos DB accounts using a shared secret. Critical Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.Cosmos.MinTLS Cosmos DB accounts should reject TLS versions older than 1.2. Critical Azure.Cosmos.PublicAccess Azure Cosmos DB should have public network access disabled. Critical Azure.Cosmos.SLA Use a paid tier to qualify for a Service Level Agreement (SLA). Important Azure.Databricks.PublicAccess Azure Databricks workspaces should disable public network access. Critical Azure.Databricks.SecureConnectivity Use Databricks workspaces configured for secure cluster connectivity. Critical Azure.Databricks.SKU Ensure Databricks workspaces are non-trial SKUs for production workloads. Critical Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Defender.Api Enable Microsoft Defender for APIs. Critical Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). Critical Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. Critical Azure.Defender.Dns Enable Microsoft Defender for DNS. Critical Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. Critical Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. Critical Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Azure.Defender.Storage Enable Microsoft Defender for Storage. Critical Azure.Defender.Storage.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. Awareness Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. Critical Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Azure.Deployment.SecureParameter Sensitive parameters that have been not been marked as secure may leak the secret into deployment history or logs. Critical Azure.DevBox.ProjectLimit Limit the number of Dev Boxes a single user can create for a project. Important Azure.EntraDS.NTLM Disable NTLM v1 for Microsoft Entra Domain Services. Critical Azure.EntraDS.RC4 Disable RC4 encryption for Microsoft Entra Domain Services. Critical Azure.EntraDS.TLS Disable TLS v1 for Microsoft Entra Domain Services. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Azure.EventHub.Firewall Access to the namespace endpoints should be restricted to only allowed sources. Critical Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. Critical Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyMode Deny high confidence malicious IP addresses, domains and URLs. Critical Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Azure Front Door profiles. Important Azure.FrontDoor.ManagedIdentity Ensure Front Door uses a managed identity to authorize access to Azure resources. Important Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.Grafana.Version Grafana workspaces should be on Grafana version 10. Important Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. Awareness Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. Awareness Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. Important Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. Awareness Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. Important Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. Critical Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. Awareness Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. Critical Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. Awareness Azure.ML.ComputeIdleShutdown Configure an idle shutdown timeout for Machine Learning compute instances. Critical Azure.ML.ComputeVnet Azure Machine Learning Computes should be hosted in a virtual network (VNet). Critical Azure.ML.DisableLocalAuth Azure Machine Learning compute resources should have local authentication methods disabled. Critical Azure.ML.PublicAccess Disable public network access from a Azure Machine Learning workspace. Critical Azure.ML.UserManagedIdentity ML workspaces should use user-assigned managed identity, rather than the default system-assigned managed identity. Important Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. Critical Azure.MySQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. Important Azure.MySQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for MySQL servers. Important Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. Important Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. Critical Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. Important Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. Important Azure.PostgreSQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for PostgreSQL servers. Important Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.MigrateStandard Use the Standard SKU for Public IP addresses as the Basic SKU will be retired. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.EntraID Use Entra ID authentication with cache instances. Critical Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. Important Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.Immutable Ensure immutability is configured to protect backup data. Important Azure.RSV.Name Recovery Services vaults should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. Important Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. Critical Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. Important Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Azure.Storage.Defender.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. Critical Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.MaintenanceConfig Use a maintenance configuration for virtual machines. Important Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. Important Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. Important Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. Important Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important"},{"location":"en/baselines/Azure.GA_2024_09/","title":"Azure.GA_2024_09","text":"<p>v1.39.0</p> <p>Include rules released September 2024 or prior for Azure GA features.</p>"},{"location":"en/baselines/Azure.GA_2024_09/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.GA_2024_09</code> baseline.</p> <p>This baseline includes a total of 432 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.Firewall Container Registry without restrictions can be accessed from any network location including the Internet. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Azure.AKS.AuditAdmin Use kube-audit-admin instead of kube-audit to capture administrative actions in AKS clusters. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.MaintenanceWindow Configure customer-controlled maintenance windows for AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.MinUserPoolNodes User node pools in an AKS cluster should have a minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeAutoUpgrade Deploy AKS Clusters with Node Auto-Upgrade enabled Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API Management instances should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. Important Azure.APIM.DefenderCloud APIs published in Azure API Management should be onboarded to Microsoft Defender for APIs. Critical Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. Important Azure.APIM.MultiRegion Enhance service availability and resilience by deploying API Management instances across multiple regions. Important Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.PolicyBase Base element for any policy element in a section should be configured. Important Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Azure.AppConfig.GeoReplica Replicate app configuration store across all points of presence for an application. Important Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. Important Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MigrateV2 Use a Application Gateway v2 SKU. Important Azure.AppGw.MigrateWAFPolicy Migrate to Application Gateway WAF policy. Critical Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.Name Application Gateways should meet naming requirements. Awareness Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppGwWAF.RuleGroups Use recommended rule groups in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.AvailabilityZone Deploy app service plan instances using availability zones in supported regions to ensure high availability and resilience. Important Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.NodeJsVersion Configure applications to use supported Node.js runtime versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.ASE.AvailabilityZone Deploy app service environments using availability zones in supported regions to ensure high availability and resilience. Important Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.AVD.ScheduleAgentUpdate Define a windows for agent updates to minimize disruptions to users. Important Azure.Bastion.Name Bastion hosts should meet naming requirements. Awareness Azure.BV.Immutable Ensure immutability is configured to protect backup data. Important Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.ContainerApp.APIVersion Migrate from retired API version to a supported version. Important Azure.ContainerApp.AvailabilityZone Use Container Apps environments that are zone redundant to improve reliability. Important Azure.ContainerApp.DisableAffinity Disable session affinity to prevent unbalanced distribution. Awareness Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. Important Azure.ContainerApp.MinReplicas Use multiple replicas to remove a single point of failure. Important Azure.ContainerApp.Name Container Apps should meet naming requirements. Awareness Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. Important Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. Important Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. Awareness Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.ContinuousBackup Enable continuous backup on Cosmos DB accounts. Important Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Cosmos.DisableLocalAuth Access keys allow depersonalized access to Cosmos DB accounts using a shared secret. Critical Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.Cosmos.MinTLS Cosmos DB accounts should reject TLS versions older than 1.2. Critical Azure.Cosmos.PublicAccess Azure Cosmos DB should have public network access disabled. Critical Azure.Cosmos.SLA Use a paid tier to qualify for a Service Level Agreement (SLA). Important Azure.Databricks.PublicAccess Azure Databricks workspaces should disable public network access. Critical Azure.Databricks.SecureConnectivity Use Databricks workspaces configured for secure cluster connectivity. Critical Azure.Databricks.SKU Ensure Databricks workspaces are non-trial SKUs for production workloads. Critical Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Defender.Api Enable Microsoft Defender for APIs. Critical Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). Critical Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. Critical Azure.Defender.Dns Enable Microsoft Defender for DNS. Critical Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. Critical Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. Critical Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Azure.Defender.Storage Enable Microsoft Defender for Storage. Critical Azure.Defender.Storage.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. Awareness Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. Critical Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Azure.Deployment.SecureParameter Sensitive parameters that have been not been marked as secure may leak the secret into deployment history or logs. Critical Azure.DevBox.ProjectLimit Limit the number of Dev Boxes a single user can create for a project. Important Azure.EntraDS.NTLM Disable NTLM v1 for Microsoft Entra Domain Services. Critical Azure.EntraDS.RC4 Disable RC4 encryption for Microsoft Entra Domain Services. Critical Azure.EntraDS.TLS Disable TLS v1 for Microsoft Entra Domain Services. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Azure.EventHub.Firewall Access to the namespace endpoints should be restricted to only allowed sources. Critical Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. Critical Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.AvailabilityZone Deploy firewall instances using availability zones in supported regions to ensure high availability and resilience. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyMode Deny high confidence malicious IP addresses, domains and URLs. Critical Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Azure Front Door profiles. Important Azure.FrontDoor.ManagedIdentity Ensure Front Door uses a managed identity to authorize access to Azure resources. Important Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.Grafana.Version Grafana workspaces should be on Grafana version 10. Important Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. Awareness Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. Awareness Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. Important Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. Awareness Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. Important Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. Critical Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. Awareness Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. Critical Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. Awareness Azure.ML.ComputeIdleShutdown Configure an idle shutdown timeout for Machine Learning compute instances. Critical Azure.ML.ComputeVnet Azure Machine Learning Computes should be hosted in a virtual network (VNet). Critical Azure.ML.DisableLocalAuth Azure Machine Learning compute resources should have local authentication methods disabled. Critical Azure.ML.PublicAccess Disable public network access from a Azure Machine Learning workspace. Critical Azure.ML.UserManagedIdentity ML workspaces should use user-assigned managed identity, rather than the default system-assigned managed identity. Important Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. Critical Azure.MySQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. Important Azure.MySQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for MySQL servers. Important Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. Important Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.MySQL.ZoneRedundantHA Deploy Azure Database for MySQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. Critical Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. Important Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. Important Azure.PostgreSQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for PostgreSQL servers. Important Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PostgreSQL.ZoneRedundantHA Deploy Azure Database for PostgreSQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.MigrateStandard Use the Standard SKU for Public IP addresses as the Basic SKU will be retired. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.EntraID Use Entra ID authentication with cache instances. Critical Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. Important Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.Immutable Ensure immutability is configured to protect backup data. Important Azure.RSV.Name Recovery Services vaults should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. Important Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL databases. Important Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. Critical Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. Important Azure.SQLMI.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL Managed Instances. Important Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Azure.Storage.Defender.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. Critical Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASDistributeTraffic Ensure high availability by distributing traffic among members in an availability set. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.MaintenanceConfig Use a maintenance configuration for virtual machines. Important Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VM.MultiTenantHosting Deploy Windows 10 and 11 virtual machines in Azure using Multi-tenant Hosting Rights to leverage your existing Windows licenses. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicIPAttached Avoid attaching public IPs directly to virtual machines. Critical Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. Important Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. Important Azure.VMSS.AvailabilityZone Deploy virtual machine scale set instances using availability zones in supported regions to ensure high availability and resilience. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VMSS.PublicIPAttached Avoid attaching public IPs directly to virtual machine scale set instances. Critical Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VMSS.ZoneBalance Deploy virtual machine scale set instances using the best-effort zone balance in supported regions. Important Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. Important Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. Important Azure.VNET.FirewallSubnetNAT Zonal-deployed Azure Firewalls should consider using an Azure NAT Gateway for outbound access. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important"},{"location":"en/baselines/Azure.MCSB.v1/","title":"Azure.MCSB.v1","text":"<p>v1.25.0</p> <p>Experimental</p> <p>This baseline is experimental and subject to change.</p> <p>Rules for GA Azure features that align to the Microsoft Cloud Security Benchmark v1. This baseline is updated each release.</p>"},{"location":"en/baselines/Azure.MCSB.v1/#controls","title":"Controls","text":"<p>The following rules are included within the <code>Azure.MCSB.v1</code> baseline.</p> <p>This baseline includes a total of 135 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.Firewall Container Registry without restrictions can be accessed from any network location including the Internet. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Azure.APIM.DefenderCloud APIs published in Azure API Management should be onboarded to Microsoft Defender for APIs. Critical Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.BV.Immutable Ensure immutability is configured to protect backup data. Important Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. Important Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. Important Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. Important Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Cosmos.DisableLocalAuth Access keys allow depersonalized access to Cosmos DB accounts using a shared secret. Critical Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.Cosmos.PublicAccess Azure Cosmos DB should have public network access disabled. Critical Azure.Defender.Api Enable Microsoft Defender for APIs. Critical Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). Critical Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. Critical Azure.Defender.Dns Enable Microsoft Defender for DNS. Critical Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. Critical Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. Critical Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Azure.Defender.Storage Enable Microsoft Defender for Storage. Critical Azure.Defender.Storage.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.EntraDS.TLS Disable TLS v1 for Microsoft Entra Domain Services. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Azure.EventHub.Firewall Access to the namespace endpoints should be restricted to only allowed sources. Critical Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. Critical Azure.Firewall.PolicyMode Deny high confidence malicious IP addresses, domains and URLs. Critical Azure.FrontDoor.Logs Audit and monitor access through Azure Front Door profiles. Important Azure.FrontDoor.ManagedIdentity Ensure Front Door uses a managed identity to authorize access to Azure resources. Important Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. Critical Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. Important Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. Awareness Azure.ML.ComputeVnet Azure Machine Learning Computes should be hosted in a virtual network (VNet). Critical Azure.ML.PublicAccess Disable public network access from a Azure Machine Learning workspace. Critical Azure.ML.UserManagedIdentity ML workspaces should use user-assigned managed identity, rather than the default system-assigned managed identity. Important Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. Critical Azure.MySQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases. Important Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. Critical Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. Important Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.EntraID Use Entra ID authentication with cache instances. Critical Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.RSV.Immutable Ensure immutability is configured to protect backup data. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. Critical Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Defender.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. Critical Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important"},{"location":"en/baselines/Azure.Pillar.CostOptimization/","title":"Azure.Pillar.CostOptimization","text":"<p>v1.35.0</p> <p>Microsoft Azure Well-Architected Framework - Cost Optimization pillar specific baseline.</p>"},{"location":"en/baselines/Azure.Pillar.CostOptimization/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Pillar.CostOptimization</code> baseline.</p> <p>This baseline includes a total of 17 rules.</p> Name Synopsis Severity Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AKS.AuditAdmin Use kube-audit-admin instead of kube-audit to capture administrative actions in AKS clusters. Important Azure.DevBox.ProjectLimit Limit the number of Dev Boxes a single user can create for a project. Important Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.ML.ComputeIdleShutdown Configure an idle shutdown timeout for Machine Learning compute instances. Critical Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.MultiTenantHosting Deploy Windows 10 and 11 virtual machines in Azure using Multi-tenant Hosting Rights to leverage your existing Windows licenses. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness"},{"location":"en/baselines/Azure.Pillar.OperationalExcellence/","title":"Azure.Pillar.OperationalExcellence","text":"<p>v1.35.0</p> <p>Microsoft Azure Well-Architected Framework - Operational Excellence pillar specific baseline.</p>"},{"location":"en/baselines/Azure.Pillar.OperationalExcellence/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Pillar.OperationalExcellence</code> baseline.</p> <p>This baseline includes a total of 100 rules.</p> Name Synopsis Severity Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppGw.MigrateV2 Use a Application Gateway v2 SKU. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.Name Application Gateways should meet naming requirements. Awareness Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Bastion.Name Bastion hosts should meet naming requirements. Awareness Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.ContainerApp.APIVersion Migrate from retired API version to a supported version. Important Azure.ContainerApp.Name Container Apps should meet naming requirements. Awareness Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. Awareness Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. Awareness Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. Awareness Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. Awareness Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. Awareness Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.MigrateStandard Use the Standard SKU for Public IP addresses as the Basic SKU will be retired. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.Name Recovery Services vaults should meet naming requirements. Awareness Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness"},{"location":"en/baselines/Azure.Pillar.PerformanceEfficiency/","title":"Azure.Pillar.PerformanceEfficiency","text":"<p>v1.35.0</p> <p>Microsoft Azure Well-Architected Framework - Performance Efficiency pillar specific baseline.</p>"},{"location":"en/baselines/Azure.Pillar.PerformanceEfficiency/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Pillar.PerformanceEfficiency</code> baseline.</p> <p>This baseline includes a total of 18 rules.</p> Name Synopsis Severity Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.ContainerApp.DisableAffinity Disable session affinity to prevent unbalanced distribution. Awareness Azure.Databricks.SKU Ensure Databricks workspaces are non-trial SKUs for production workloads. Critical Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. Important Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. Important"},{"location":"en/baselines/Azure.Pillar.Reliability/","title":"Azure.Pillar.Reliability","text":"<p>v1.35.0</p> <p>Microsoft Azure Well-Architected Framework - Reliability pillar specific baseline.</p>"},{"location":"en/baselines/Azure.Pillar.Reliability/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Pillar.Reliability</code> baseline.</p> <p>This baseline includes a total of 90 rules.</p> Name Synopsis Severity Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.MaintenanceWindow Configure customer-controlled maintenance windows for AKS clusters. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.MinUserPoolNodes User node pools in an AKS cluster should have a minimum number of nodes for failover and updates. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.AvailabilityZone API Management instances should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.MultiRegion Enhance service availability and resilience by deploying API Management instances across multiple regions. Important Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. Important Azure.AppConfig.GeoReplica Replicate app configuration store across all points of presence for an application. Important Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. Important Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MigrateWAFPolicy Migrate to Application Gateway WAF policy. Critical Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.AvailabilityZone Deploy app service plan instances using availability zones in supported regions to ensure high availability and resilience. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.ASE.AvailabilityZone Deploy app service environments using availability zones in supported regions to ensure high availability and resilience. Important Azure.AVD.ScheduleAgentUpdate Define a windows for agent updates to minimize disruptions to users. Important Azure.ContainerApp.AvailabilityZone Use Container Apps environments that are zone redundant to improve reliability. Important Azure.ContainerApp.MinReplicas Use multiple replicas to remove a single point of failure. Important Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. Awareness Azure.Cosmos.ContinuousBackup Enable continuous backup on Cosmos DB accounts. Important Azure.Cosmos.SLA Use a paid tier to qualify for a Service Level Agreement (SLA). Important Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Firewall.AvailabilityZone Deploy firewall instances using availability zones in supported regions to ensure high availability and resilience. Important Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.Grafana.Version Grafana workspaces should be on Grafana version 10. Important Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. Important Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. Important Azure.MySQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for MySQL servers. Important Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. Important Azure.MySQL.ZoneRedundantHA Deploy Azure Database for MySQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. Important Azure.PostgreSQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for PostgreSQL servers. Important Azure.PostgreSQL.ZoneRedundantHA Deploy Azure Database for PostgreSQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. Important Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL databases. Important Azure.SQLMI.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL Managed Instances. Important Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASDistributeTraffic Ensure high availability by distributing traffic among members in an availability set. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.MaintenanceConfig Use a maintenance configuration for virtual machines. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VMSS.AvailabilityZone Deploy virtual machine scale set instances using availability zones in supported regions to ensure high availability and resilience. Important Azure.VMSS.ZoneBalance Deploy virtual machine scale set instances using the best-effort zone balance in supported regions. Important Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. Important Azure.VNET.FirewallSubnetNAT Zonal-deployed Azure Firewalls should consider using an Azure NAT Gateway for outbound access. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important"},{"location":"en/baselines/Azure.Pillar.Security/","title":"Azure.Pillar.Security","text":"<p>v1.35.0</p> <p>Microsoft Azure Well-Architected Framework - Security pillar specific baseline.</p>"},{"location":"en/baselines/Azure.Pillar.Security/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Pillar.Security</code> baseline.</p> <p>This baseline includes a total of 209 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.Firewall Container Registry without restrictions can be accessed from any network location including the Internet. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. Important Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeAutoUpgrade Deploy AKS Clusters with Node Auto-Upgrade enabled Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. Important Azure.APIM.DefenderCloud APIs published in Azure API Management should be onboarded to Microsoft Defender for APIs. Critical Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.PolicyBase Base element for any policy element in a section should be configured. Important Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppGwWAF.RuleGroups Use recommended rule groups in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.NodeJsVersion Configure applications to use supported Node.js runtime versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.BV.Immutable Ensure immutability is configured to protect backup data. Important Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. Important Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. Important Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. Important Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Cosmos.DisableLocalAuth Access keys allow depersonalized access to Cosmos DB accounts using a shared secret. Critical Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.Cosmos.MinTLS Cosmos DB accounts should reject TLS versions older than 1.2. Critical Azure.Cosmos.PublicAccess Azure Cosmos DB should have public network access disabled. Critical Azure.Databricks.PublicAccess Azure Databricks workspaces should disable public network access. Critical Azure.Databricks.SecureConnectivity Use Databricks workspaces configured for secure cluster connectivity. Critical Azure.Defender.Api Enable Microsoft Defender for APIs. Critical Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). Critical Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. Critical Azure.Defender.Dns Enable Microsoft Defender for DNS. Critical Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. Critical Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. Critical Azure.Defender.SecurityContact Important security notifications may be lost or not processed in a timely manner when a clear security contact is not identified. Important Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Azure.Defender.Storage Enable Microsoft Defender for Storage. Critical Azure.Defender.Storage.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. Critical Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Azure.Deployment.SecureParameter Sensitive parameters that have been not been marked as secure may leak the secret into deployment history or logs. Critical Azure.Deployment.SecureValue A secret property set from a non-secure value may leak the secret into deployment history or logs. Critical Azure.EntraDS.NTLM Disable NTLM v1 for Microsoft Entra Domain Services. Critical Azure.EntraDS.RC4 Disable RC4 encryption for Microsoft Entra Domain Services. Critical Azure.EntraDS.TLS Disable TLS v1 for Microsoft Entra Domain Services. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Azure.EventHub.Firewall Access to the namespace endpoints should be restricted to only allowed sources. Critical Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. Critical Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.PolicyMode Deny high confidence malicious IP addresses, domains and URLs. Critical Azure.FrontDoor.Logs Audit and monitor access through Azure Front Door profiles. Important Azure.FrontDoor.ManagedIdentity Ensure Front Door uses a managed identity to authorize access to Azure resources. Important Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. Important Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. Awareness Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. Important Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. Critical Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. Critical Azure.ML.ComputeVnet Azure Machine Learning Computes should be hosted in a virtual network (VNet). Critical Azure.ML.DisableLocalAuth Azure Machine Learning compute resources should have local authentication methods disabled. Critical Azure.ML.PublicAccess Disable public network access from a Azure Machine Learning workspace. Critical Azure.ML.UserManagedIdentity ML workspaces should use user-assigned managed identity, rather than the default system-assigned managed identity. Important Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. Critical Azure.MySQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. Critical Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. Important Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.EntraID Use Entra ID authentication with cache instances. Critical Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.RSV.Immutable Ensure immutability is configured to protect backup data. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. Important Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. Critical Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. Important Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. Important Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.Defender.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. Critical Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.PublicIPAttached Avoid attaching public IPs directly to virtual machines. Critical Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.PublicIPAttached Avoid attaching public IPs directly to virtual machine scale set instances. Critical Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. Important Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important"},{"location":"en/baselines/Azure.Preview/","title":"Azure.Preview","text":"<p>Includes the latest rules for Azure GA and preview features that is updated each release.</p>"},{"location":"en/baselines/Azure.Preview/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Preview</code> baseline.</p> <p>This baseline includes a total of 447 rules.</p> Name Synopsis Severity Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Azure.ACR.AnonymousAccess Anonymous pull access allows unidentified downloading of images and metadata from a container registry. Important Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Azure.ACR.Firewall Container Registry without restrictions can be accessed from any network location including the Internet. Important Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Azure.ACR.Name Container registry names should meet naming requirements. Awareness Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Important Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Azure.AKS.AuditAdmin Use kube-audit-admin instead of kube-audit to capture administrative actions in AKS clusters. Important Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. Important Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Azure.AKS.MaintenanceWindow Configure customer-controlled maintenance windows for AKS clusters. Important Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Azure.AKS.MinUserPoolNodes User node pools in an AKS cluster should have a minimum number of nodes for failover and updates. Important Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Azure.AKS.NodeAutoUpgrade Deploy AKS Clusters with Node Auto-Upgrade enabled Important Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Azure.APIM.AvailabilityZone API Management instances should use availability zones in supported regions for high availability. Important Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. Important Azure.APIM.DefenderCloud APIs published in Azure API Management should be onboarded to Microsoft Defender for APIs. Critical Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. Important Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. Important Azure.APIM.MultiRegion Enhance service availability and resilience by deploying API Management instances across multiple regions. Important Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. Important Azure.APIM.Name API Management service names should meet naming requirements. Awareness Azure.APIM.PolicyBase Base element for any policy element in a section should be configured. Important Azure.APIM.ProductApproval Configure products to require approval. Important Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Azure.APIM.ProductSubscription Configure products to require a subscription. Important Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Azure.AppConfig.GeoReplica Replicate app configuration store across all points of presence for an application. Important Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. Important Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Azure.AppGw.MigrateV2 Use a Application Gateway v2 SKU. Important Azure.AppGw.MigrateWAFPolicy Migrate to Application Gateway WAF policy. Critical Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Azure.AppGw.Name Application Gateways should meet naming requirements. Awareness Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppGwWAF.RuleGroups Use recommended rule groups in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Azure.AppService.AvailabilityZone Deploy app service plan instances using availability zones in supported regions to ensure high availability and resilience. Important Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Azure.AppService.NodeJsVersion Configure applications to use supported Node.js runtime versions. Important Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.AppService.WebProbe Configure and enable instance health probes. Important Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Azure.Arc.Kubernetes.Defender Deploy Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters. Important Azure.Arc.Server.MaintenanceConfig Use a maintenance configuration for Arc-enabled servers. Important Azure.ASE.AvailabilityZone Deploy app service environments using availability zones in supported regions to ensure high availability and resilience. Important Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. Important Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Azure.AVD.ScheduleAgentUpdate Define a windows for agent updates to minimize disruptions to users. Important Azure.Bastion.Name Bastion hosts should meet naming requirements. Awareness Azure.BV.Immutable Ensure immutability is configured to protect backup data. Important Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Azure.ContainerApp.APIVersion Migrate from retired API version to a supported version. Important Azure.ContainerApp.AvailabilityZone Use Container Apps environments that are zone redundant to improve reliability. Important Azure.ContainerApp.DisableAffinity Disable session affinity to prevent unbalanced distribution. Awareness Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. Important Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. Important Azure.ContainerApp.MinReplicas Use multiple replicas to remove a single point of failure. Important Azure.ContainerApp.Name Container Apps should meet naming requirements. Awareness Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. Important Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. Important Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. Awareness Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Azure.Cosmos.ContinuousBackup Enable continuous backup on Cosmos DB accounts. Important Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Cosmos.DisableLocalAuth Access keys allow depersonalized access to Cosmos DB accounts using a shared secret. Critical Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Azure.Cosmos.MinTLS Cosmos DB accounts should reject TLS versions older than 1.2. Critical Azure.Cosmos.PublicAccess Azure Cosmos DB should have public network access disabled. Critical Azure.Cosmos.SLA Use a paid tier to qualify for a Service Level Agreement (SLA). Important Azure.Databricks.PublicAccess Azure Databricks workspaces should disable public network access. Critical Azure.Databricks.SecureConnectivity Use Databricks workspaces configured for secure cluster connectivity. Critical Azure.Databricks.SKU Ensure Databricks workspaces are non-trial SKUs for production workloads. Critical Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Azure.Defender.Api Enable Microsoft Defender for APIs. Critical Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). Critical Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. Critical Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. Critical Azure.Defender.Dns Enable Microsoft Defender for DNS. Critical Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. Critical Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. Critical Azure.Defender.SecurityContact Important security notifications may be lost or not processed in a timely manner when a clear security contact is not identified. Important Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Azure.Defender.Storage Enable Microsoft Defender for Storage. Critical Azure.Defender.Storage.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Azure.Defender.Storage.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. Awareness Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. Critical Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Azure.Deployment.SecureParameter Sensitive parameters that have been not been marked as secure may leak the secret into deployment history or logs. Critical Azure.Deployment.SecureValue A secret property set from a non-secure value may leak the secret into deployment history or logs. Critical Azure.DevBox.ProjectLimit Limit the number of Dev Boxes a single user can create for a project. Important Azure.EntraDS.NTLM Disable NTLM v1 for Microsoft Entra Domain Services. Critical Azure.EntraDS.RC4 Disable RC4 encryption for Microsoft Entra Domain Services. Critical Azure.EntraDS.TLS Disable TLS v1 for Microsoft Entra Domain Services. Critical Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Azure.EventHub.Firewall Access to the namespace endpoints should be restricted to only allowed sources. Critical Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. Critical Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Azure.Firewall.AvailabilityZone Deploy firewall instances using availability zones in supported regions to ensure high availability and resilience. Important Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Azure.Firewall.PolicyMode Deny high confidence malicious IP addresses, domains and URLs. Critical Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Azure.FrontDoor.Logs Audit and monitor access through Azure Front Door profiles. Important Azure.FrontDoor.ManagedIdentity Ensure Front Door uses a managed identity to authorize access to Azure resources. Important Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. Important Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Azure.Grafana.Version Grafana workspaces should be on Grafana version 10. Important Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. Critical Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. Important Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. Awareness Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Azure.LB.Probe Use a specific probe for web protocols. Important Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Azure.LogAnalytics.Replication Log Analytics workspaces should have workspace replication enabled to improve service availability. Important Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. Awareness Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. Important Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. Awareness Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. Important Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. Critical Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. Awareness Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. Critical Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. Awareness Azure.ML.ComputeIdleShutdown Configure an idle shutdown timeout for Machine Learning compute instances. Critical Azure.ML.ComputeVnet Azure Machine Learning Computes should be hosted in a virtual network (VNet). Critical Azure.ML.DisableLocalAuth Azure Machine Learning compute resources should have local authentication methods disabled. Critical Azure.ML.PublicAccess Disable public network access from a Azure Machine Learning workspace. Critical Azure.ML.UserManagedIdentity ML workspaces should use user-assigned managed identity, rather than the default system-assigned managed identity. Important Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. Critical Azure.MySQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases. Important Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. Important Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. Important Azure.MySQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for MySQL servers. Important Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. Important Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Azure.MySQL.ZoneRedundantHA Deploy Azure Database for MySQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. Critical Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. Important Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. Important Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. Important Azure.PostgreSQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for PostgreSQL servers. Important Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Azure.PostgreSQL.ZoneRedundantHA Deploy Azure Database for PostgreSQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Azure.PublicIP.MigrateStandard Use the Standard SKU for Public IP addresses as the Basic SKU will be retired. Important Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Azure.Redis.EntraID Use Entra ID authentication with cache instances. Critical Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. Important Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Azure.Route.Name Route table names should meet naming requirements. Awareness Azure.RSV.Immutable Ensure immutability is configured to protect backup data. Important Azure.RSV.Name Recovery Services vaults should meet naming requirements. Awareness Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Azure.Search.Name AI Search service names should meet naming requirements. Awareness Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. Important Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Azure.ServiceBus.GeoReplica Enhance resilience to regional outages by replicating namespaces. Important Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. Important Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Azure.SQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL databases. Important Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. Critical Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. Important Azure.SQLMI.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL Managed Instances. Important Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. Important Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Azure.Storage.Defender.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Azure.Storage.Defender.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. Critical Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Azure.Template.LocationType Location parameters should use a string value. Important Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Azure.Template.TemplateFile Use ARM template files that are valid. Important Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. Important Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Azure.VM.ASDistributeTraffic Ensure high availability by distributing traffic among members in an availability set. Important Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Azure.VM.MaintenanceConfig Use a maintenance configuration for virtual machines. Important Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VM.MultiTenantHosting Deploy Windows 10 and 11 virtual machines in Azure using Multi-tenant Hosting Rights to leverage your existing Windows licenses. Awareness Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Azure.VM.PublicIPAttached Avoid attaching public IPs directly to virtual machines. Critical Azure.VM.PublicKey Linux virtual machines should use public keys. Important Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. Important Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. Important Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. Important Azure.VMSS.AutoInstanceRepairs Automatic instance repairs are enabled. Important Azure.VMSS.AvailabilityZone Deploy virtual machine scale set instances using availability zones in supported regions to ensure high availability and resilience. Important Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Azure.VMSS.PublicIPAttached Avoid attaching public IPs directly to virtual machine scale set instances. Critical Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Azure.VMSS.ZoneBalance Deploy virtual machine scale set instances using the best-effort zone balance in supported regions. Important Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. Important Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. Important Azure.VNET.FirewallSubnetNAT Zonal-deployed Azure Firewalls should consider using an Azure NAT Gateway for outbound access. Awareness Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Azure.VNET.PeerState VNET peering connections must be connected. Important Azure.VNET.PrivateSubnet Disable default outbound access for virtual machines. Critical Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Azure.VNG.MaintenanceConfig Use a customer-controlled maintenance configuration for virtual network gateways. Important Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important"},{"location":"en/baselines/Azure.Preview_2021_09/","title":"Azure.Preview_2021_09","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released September 2021 or prior for Azure preview only features.</p>"},{"location":"en/baselines/Azure.Preview_2021_09/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Preview_2021_09</code> baseline.</p> <p>This baseline includes a total of 2 rules.</p> Name Synopsis Severity Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important"},{"location":"en/baselines/Azure.Preview_2021_12/","title":"Azure.Preview_2021_12","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released December 2021 or prior for Azure preview only features.</p>"},{"location":"en/baselines/Azure.Preview_2021_12/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Preview_2021_12</code> baseline.</p> <p>This baseline includes a total of 2 rules.</p> Name Synopsis Severity Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important"},{"location":"en/baselines/Azure.Preview_2022_03/","title":"Azure.Preview_2022_03","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released March 2022 or prior for Azure preview only features.</p>"},{"location":"en/baselines/Azure.Preview_2022_03/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Preview_2022_03</code> baseline.</p> <p>This baseline includes a total of 2 rules.</p> Name Synopsis Severity Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important"},{"location":"en/baselines/Azure.Preview_2022_06/","title":"Azure.Preview_2022_06","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released June 2022 or prior for Azure preview only features.</p>"},{"location":"en/baselines/Azure.Preview_2022_06/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Preview_2022_06</code> baseline.</p> <p>This baseline includes a total of 2 rules.</p> Name Synopsis Severity Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important"},{"location":"en/baselines/Azure.Preview_2022_09/","title":"Azure.Preview_2022_09","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released September 2022 or prior for Azure preview only features.</p>"},{"location":"en/baselines/Azure.Preview_2022_09/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Preview_2022_09</code> baseline.</p> <p>This baseline includes a total of 3 rules.</p> Name Synopsis Severity Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Important"},{"location":"en/baselines/Azure.Preview_2022_12/","title":"Azure.Preview_2022_12","text":"<p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released December 2022 or prior for Azure preview only features.</p>"},{"location":"en/baselines/Azure.Preview_2022_12/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Preview_2022_12</code> baseline.</p> <p>This baseline includes a total of 3 rules.</p> Name Synopsis Severity Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Important"},{"location":"en/baselines/Azure.Preview_2023_03/","title":"Azure.Preview_2023_03","text":"<p>v1.26.0</p> <p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released March 2023 or prior for Azure preview only features.</p>"},{"location":"en/baselines/Azure.Preview_2023_03/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Preview_2023_03</code> baseline.</p> <p>This baseline includes a total of 3 rules.</p> Name Synopsis Severity Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Important"},{"location":"en/baselines/Azure.Preview_2023_06/","title":"Azure.Preview_2023_06","text":"<p>v1.28.0</p> <p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released June 2023 or prior for Azure preview only features.</p>"},{"location":"en/baselines/Azure.Preview_2023_06/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Preview_2023_06</code> baseline.</p> <p>This baseline includes a total of 7 rules.</p> Name Synopsis Severity Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Important Azure.Arc.Kubernetes.Defender Deploy Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters. Important Azure.Arc.Server.MaintenanceConfig Use a maintenance configuration for Arc-enabled servers. Important Azure.Defender.Storage.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Azure.Storage.Defender.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical"},{"location":"en/baselines/Azure.Preview_2023_09/","title":"Azure.Preview_2023_09","text":"<p>v1.30.0</p> <p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released September 2023 or prior for Azure preview only features.</p>"},{"location":"en/baselines/Azure.Preview_2023_09/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Preview_2023_09</code> baseline.</p> <p>This baseline includes a total of 8 rules.</p> Name Synopsis Severity Azure.ACR.AnonymousAccess Anonymous pull access allows unidentified downloading of images and metadata from a container registry. Important Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Important Azure.Arc.Kubernetes.Defender Deploy Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters. Important Azure.Arc.Server.MaintenanceConfig Use a maintenance configuration for Arc-enabled servers. Important Azure.Defender.Storage.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Azure.Storage.Defender.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical"},{"location":"en/baselines/Azure.Preview_2023_12/","title":"Azure.Preview_2023_12","text":"<p>v1.32.0</p> <p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released December 2023 or prior for Azure preview only features.</p>"},{"location":"en/baselines/Azure.Preview_2023_12/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Preview_2023_12</code> baseline.</p> <p>This baseline includes a total of 8 rules.</p> Name Synopsis Severity Azure.ACR.AnonymousAccess Anonymous pull access allows unidentified downloading of images and metadata from a container registry. Important Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Important Azure.Arc.Kubernetes.Defender Deploy Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters. Important Azure.Arc.Server.MaintenanceConfig Use a maintenance configuration for Arc-enabled servers. Important Azure.Defender.Storage.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Azure.Storage.Defender.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical"},{"location":"en/baselines/Azure.Preview_2024_03/","title":"Azure.Preview_2024_03","text":"<p>v1.35.0</p> <p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released March 2024 or prior for Azure preview only features.</p>"},{"location":"en/baselines/Azure.Preview_2024_03/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Preview_2024_03</code> baseline.</p> <p>This baseline includes a total of 8 rules.</p> Name Synopsis Severity Azure.ACR.AnonymousAccess Anonymous pull access allows unidentified downloading of images and metadata from a container registry. Important Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Important Azure.Arc.Kubernetes.Defender Deploy Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters. Important Azure.Arc.Server.MaintenanceConfig Use a maintenance configuration for Arc-enabled servers. Important Azure.Defender.Storage.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Azure.Storage.Defender.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical"},{"location":"en/baselines/Azure.Preview_2024_06/","title":"Azure.Preview_2024_06","text":"<p>v1.38.0</p> <p>Warning</p> <p>This baseline is obsolete. Consider switching to a newer baseline.</p> <p>Include rules released June 2024 or prior for Azure preview only features.</p>"},{"location":"en/baselines/Azure.Preview_2024_06/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Preview_2024_06</code> baseline.</p> <p>This baseline includes a total of 11 rules.</p> Name Synopsis Severity Azure.ACR.AnonymousAccess Anonymous pull access allows unidentified downloading of images and metadata from a container registry. Important Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Important Azure.Arc.Kubernetes.Defender Deploy Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters. Important Azure.Arc.Server.MaintenanceConfig Use a maintenance configuration for Arc-enabled servers. Important Azure.Defender.Storage.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Azure.LogAnalytics.Replication Log Analytics workspaces should have workspace replication enabled to improve service availability. Important Azure.Storage.Defender.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Azure.VMSS.AutoInstanceRepairs Automatic instance repairs are enabled. Important Azure.VNG.MaintenanceConfig Use a customer-controlled maintenance configuration for virtual network gateways. Important"},{"location":"en/baselines/Azure.Preview_2024_09/","title":"Azure.Preview_2024_09","text":"<p>v1.39.0</p> <p>Include rules released September 2024 or prior for Azure preview only features.</p>"},{"location":"en/baselines/Azure.Preview_2024_09/#rules","title":"Rules","text":"<p>The following rules are included within the <code>Azure.Preview_2024_09</code> baseline.</p> <p>This baseline includes a total of 13 rules.</p> Name Synopsis Severity Azure.ACR.AnonymousAccess Anonymous pull access allows unidentified downloading of images and metadata from a container registry. Important Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Important Azure.Arc.Kubernetes.Defender Deploy Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters. Important Azure.Arc.Server.MaintenanceConfig Use a maintenance configuration for Arc-enabled servers. Important Azure.Defender.Storage.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Azure.LogAnalytics.Replication Log Analytics workspaces should have workspace replication enabled to improve service availability. Important Azure.ServiceBus.GeoReplica Enhance resilience to regional outages by replicating namespaces. Important Azure.Storage.Defender.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Azure.VMSS.AutoInstanceRepairs Automatic instance repairs are enabled. Important Azure.VNET.PrivateSubnet Disable default outbound access for virtual machines. Critical Azure.VNG.MaintenanceConfig Use a customer-controlled maintenance configuration for virtual network gateways. Important"},{"location":"en/rules/","title":"Reference","text":"<p>The following rules and features are included in PSRule for Azure.</p> <p>Info</p> <p>The rule release indicates if the Azure feature is generally available (GA) or available under preview. Features provided under previews may have additional limits, availability restrictions, or terms. By default, PSRule for Azure will not provide recommendations that relate to preview features. To include rules for preview features see working with baselines.</p>"},{"location":"en/rules/#rules","title":"Rules","text":"<p>The following rules are included in PSRule for Azure.</p> Reference Name Synopsis Release AZR-000001 Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. GA AZR-000002 Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. GA AZR-000003 Azure.ACR.ImageHealth Remove container images with known vulnerabilities. GA AZR-000004 Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. GA AZR-000005 Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. GA AZR-000006 Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. GA AZR-000007 Azure.ACR.Name Container registry names should meet naming requirements. GA AZR-000008 Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Preview AZR-000009 Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. GA AZR-000010 Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Preview AZR-000011 Azure.ADX.Usage Regularly remove unused resources to reduce costs. GA AZR-000012 Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. GA AZR-000013 Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. GA AZR-000014 Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. GA AZR-000015 Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. GA AZR-000016 Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. GA AZR-000017 Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. GA AZR-000018 Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. GA AZR-000019 Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. GA AZR-000020 Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. GA AZR-000021 Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. GA AZR-000022 Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. GA AZR-000023 Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. GA AZR-000024 Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. GA AZR-000025 Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. GA AZR-000026 Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. GA AZR-000027 Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. GA AZR-000028 Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. GA AZR-000029 Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. GA AZR-000030 Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. GA AZR-000031 Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. GA AZR-000032 Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. GA AZR-000033 Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. GA AZR-000034 Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. GA AZR-000035 Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. GA AZR-000036 Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. GA AZR-000038 Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. GA AZR-000039 Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. GA AZR-000040 Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. GA AZR-000041 Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. GA AZR-000042 Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. GA AZR-000043 Azure.APIM.APIDescriptors APIs should have a display name and description. GA AZR-000044 Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. GA AZR-000045 Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. GA AZR-000046 Azure.APIM.ProductSubscription Configure products to require a subscription. GA AZR-000047 Azure.APIM.ProductApproval Configure products to require approval. GA AZR-000048 Azure.APIM.SampleProducts Remove starter and unlimited sample products. GA AZR-000049 Azure.APIM.ProductDescriptors API Management products should have a display name and description. GA AZR-000050 Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. GA AZR-000051 Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. GA AZR-000052 Azure.APIM.AvailabilityZone API Management instances should use availability zones in supported regions for high availability. GA AZR-000053 Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. GA AZR-000054 Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. GA AZR-000055 Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. GA AZR-000056 Azure.APIM.Name API Management service names should meet naming requirements. GA AZR-000057 Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. GA AZR-000058 Azure.AppConfig.Name App Configuration store names should meet naming requirements. GA AZR-000059 Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. GA AZR-000060 Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. GA AZR-000061 Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. GA AZR-000062 Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. GA AZR-000063 Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. GA AZR-000064 Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. GA AZR-000065 Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. GA AZR-000066 Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. GA AZR-000067 Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. GA AZR-000068 Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. GA AZR-000069 Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. GA AZR-000070 Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. GA AZR-000071 Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. GA AZR-000072 Azure.AppService.MinPlan Use at least a Standard App Service Plan. GA AZR-000073 Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. GA AZR-000074 Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. GA AZR-000075 Azure.AppService.NETVersion Configure applications to use newer .NET versions. GA AZR-000076 Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. GA AZR-000077 Azure.AppService.AlwaysOn Configure Always On for App Service apps. GA AZR-000078 Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. GA AZR-000079 Azure.AppService.WebProbe Configure and enable instance health probes. GA AZR-000080 Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. GA AZR-000081 Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. GA AZR-000082 Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. GA AZR-000083 Azure.AppService.ARRAffinity Disable client affinity for stateless services. GA AZR-000084 Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. GA AZR-000085 Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. GA AZR-000086 Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. GA AZR-000087 Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). GA AZR-000088 Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. GA AZR-000089 Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. GA AZR-000090 Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. GA AZR-000091 Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. GA AZR-000092 Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. GA AZR-000093 Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. GA AZR-000094 Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. GA AZR-000095 Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. GA AZR-000096 Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. GA AZR-000097 Azure.DataFactory.Version Consider migrating to DataFactory v2. GA AZR-000098 Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. GA AZR-000099 Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. GA AZR-000100 Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. GA AZR-000101 Azure.EventHub.Usage Regularly remove unused resources to reduce costs. GA AZR-000102 Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. GA AZR-000103 Azure.Firewall.Name Firewall names should meet naming requirements. GA AZR-000104 Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. GA AZR-000105 Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. GA AZR-000106 Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. GA AZR-000107 Azure.FrontDoor.Logs Audit and monitor access through Azure Front Door profiles. GA AZR-000108 Azure.FrontDoor.Probe Use health probes to check the health of each backend. GA AZR-000109 Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. GA AZR-000110 Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. GA AZR-000111 Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. GA AZR-000112 Azure.FrontDoor.State Enable Azure Front Door Classic instance. GA AZR-000113 Azure.FrontDoor.Name Front Door names should meet naming requirements. GA AZR-000114 Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. GA AZR-000115 Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. GA AZR-000116 Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. GA AZR-000117 Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. GA AZR-000118 Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. GA AZR-000119 Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. GA AZR-000120 Azure.KeyVault.Name Key Vault names should meet naming requirements. GA AZR-000121 Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. GA AZR-000122 Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. GA AZR-000123 Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. GA AZR-000124 Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. GA AZR-000125 Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. GA AZR-000126 Azure.LB.Probe Use a specific probe for web protocols. GA AZR-000127 Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. GA AZR-000128 Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. GA AZR-000129 Azure.LB.Name Load Balancer names should meet naming requirements. GA AZR-000130 Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. GA AZR-000131 Azure.MySQL.UseSSL Enforce encrypted MySQL connections. GA AZR-000132 Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. GA AZR-000133 Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. GA AZR-000134 Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. GA AZR-000135 Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. GA AZR-000136 Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. GA AZR-000137 Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. GA AZR-000138 Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. GA AZR-000139 Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. GA AZR-000140 Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. GA AZR-000141 Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. GA AZR-000142 Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. GA AZR-000143 Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. GA AZR-000144 Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. GA AZR-000145 Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. GA AZR-000146 Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. GA AZR-000147 Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. GA AZR-000148 Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. GA AZR-000149 Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. GA AZR-000150 Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. GA AZR-000151 Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. GA AZR-000152 Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. GA AZR-000153 Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. GA AZR-000154 Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. GA AZR-000155 Azure.PublicIP.Name Public IP names should meet naming requirements. GA AZR-000156 Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. GA AZR-000157 Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. GA AZR-000158 Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. GA AZR-000159 Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. GA AZR-000160 Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. GA AZR-000161 Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. GA AZR-000162 Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. GA AZR-000163 Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. GA AZR-000164 Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. GA AZR-000165 Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. GA AZR-000166 Azure.Resource.UseTags Azure resources should be tagged using a standard convention. GA AZR-000167 Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. GA AZR-000168 Azure.ResourceGroup.Name Resource Group names should meet naming requirements. GA AZR-000169 Azure.Route.Name Route table names should meet naming requirements. GA AZR-000170 Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. GA AZR-000171 Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. GA AZR-000172 Azure.Search.SKU Use the basic and standard tiers for entry level workloads. GA AZR-000173 Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. GA AZR-000174 Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. GA AZR-000175 Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. GA AZR-000176 Azure.Search.Name AI Search service names should meet naming requirements. GA AZR-000177 Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. GA AZR-000178 Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. GA AZR-000179 Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. GA AZR-000180 Azure.SignalR.Name SignalR service instance names should meet naming requirements. GA AZR-000181 Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. GA AZR-000182 Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. GA AZR-000183 Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. GA AZR-000184 Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. GA AZR-000185 Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. GA AZR-000186 Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. GA AZR-000187 Azure.SQL.Auditing Enable auditing for Azure SQL logical server. GA AZR-000188 Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. GA AZR-000189 Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. GA AZR-000190 Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. GA AZR-000191 Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. GA AZR-000192 Azure.SQL.DBName Azure SQL Database names should meet naming requirements. GA AZR-000193 Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. GA AZR-000194 Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. GA AZR-000195 Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. GA AZR-000196 Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. GA AZR-000197 Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. GA AZR-000198 Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. GA AZR-000199 Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. GA AZR-000200 Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. GA AZR-000201 Azure.Storage.Name Storage Account names should meet naming requirements. GA AZR-000202 Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. GA AZR-000203 Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. GA AZR-000204 Azure.RBAC.LimitOwner Limit the number of subscription Owners. GA AZR-000205 Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. GA AZR-000206 Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). GA AZR-000207 Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. GA AZR-000208 Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. GA AZR-000209 Azure.Defender.SecurityContact Important security notifications may be lost or not processed in a timely manner when a clear security contact is not identified. GA AZR-000210 Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. GA AZR-000211 Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. GA AZR-000212 Azure.Template.TemplateFile Use ARM template files that are valid. GA AZR-000213 Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. GA AZR-000214 Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. GA AZR-000215 Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. GA AZR-000216 Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. GA AZR-000217 Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. deprecated AZR-000218 Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. deprecated AZR-000219 Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. deprecated AZR-000220 Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. GA AZR-000221 Azure.Template.LocationType Location parameters should use a string value. GA AZR-000222 Azure.Template.ResourceLocation Resource locations should be an expression or global. GA AZR-000223 Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. GA AZR-000224 Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. GA AZR-000225 Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. GA AZR-000226 Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. GA AZR-000227 Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. GA AZR-000228 Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. GA AZR-000229 Azure.Template.ParameterFile Use ARM template parameter files that are valid. GA AZR-000230 Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. GA AZR-000231 Azure.Template.MetadataLink Configure a metadata link for each parameter file. GA AZR-000232 Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. GA AZR-000233 Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. deprecated AZR-000234 Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. GA AZR-000235 Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. GA AZR-000236 Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. GA AZR-000237 Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. GA AZR-000238 Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. GA AZR-000239 Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. GA AZR-000240 Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. GA AZR-000241 Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. GA AZR-000242 Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. GA AZR-000243 Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. GA AZR-000244 Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. GA AZR-000245 Azure.VM.PublicKey Linux virtual machines should use public keys. GA AZR-000246 Azure.VM.Agent Ensure the VM agent is provisioned automatically. GA AZR-000247 Azure.VM.Updates Ensure automatic updates are enabled at deployment. GA AZR-000248 Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. GA AZR-000249 Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. GA AZR-000250 Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. GA AZR-000251 Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. GA AZR-000252 Azure.VM.ADE Use Azure Disk Encryption (ADE). GA AZR-000253 Azure.VM.DiskName Managed Disk names should meet naming requirements. GA AZR-000254 Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. GA AZR-000255 Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). GA AZR-000256 Azure.VM.ASName Availability Set names should meet naming requirements. GA AZR-000257 Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. GA AZR-000258 Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. GA AZR-000259 Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. GA AZR-000260 Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. GA AZR-000261 Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. GA AZR-000262 Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. GA AZR-000263 Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. GA AZR-000264 Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. GA AZR-000265 Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. GA AZR-000266 Azure.VNET.PeerState VNET peering connections must be connected. GA AZR-000267 Azure.VNET.SubnetName Subnet names should meet naming requirements. GA AZR-000268 Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. GA AZR-000269 Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. GA AZR-000270 Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. GA AZR-000271 Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. GA AZR-000272 Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. GA AZR-000273 Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. GA AZR-000274 Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. GA AZR-000275 Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. GA AZR-000276 Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. GA AZR-000277 Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. GA AZR-000278 Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. GA AZR-000279 Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. GA AZR-000280 Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. GA AZR-000281 Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. GA AZR-000282 Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. GA AZR-000283 Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. GA AZR-000284 Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. GA AZR-000285 Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. GA AZR-000286 Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. GA AZR-000287 Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. GA AZR-000288 Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. GA AZR-000289 Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. GA AZR-000290 Azure.Defender.Containers Enable Microsoft Defender for Containers. GA AZR-000291 Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. GA AZR-000292 Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. GA AZR-000293 Azure.Defender.Servers Enable Microsoft Defender for Servers. GA AZR-000294 Azure.Defender.SQL Enable Microsoft Defender for SQL servers. GA AZR-000295 Azure.Defender.AppServices Enable Microsoft Defender for App Service. GA AZR-000296 Azure.Defender.Storage Enable Microsoft Defender for Storage. GA AZR-000297 Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. GA AZR-000298 Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. GA AZR-000299 Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. GA AZR-000300 Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. GA AZR-000301 Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. GA AZR-000302 Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. GA AZR-000303 Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. GA AZR-000304 Azure.AppGwWAF.RuleGroups Use recommended rule groups in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. GA AZR-000305 Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. GA AZR-000306 Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. GA AZR-000307 Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. GA AZR-000308 Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. GA AZR-000309 Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. GA AZR-000310 Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Preview AZR-000311 Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. GA AZR-000312 Azure.AppConfig.GeoReplica Replicate app configuration store across all points of presence for an application. GA AZR-000313 Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. GA AZR-000314 Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. GA AZR-000315 Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. GA AZR-000316 Azure.Deployment.SecureValue A secret property set from a non-secure value may leak the secret into deployment history or logs. GA AZR-000317 Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. GA AZR-000318 Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. GA AZR-000319 Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. GA AZR-000320 Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. GA AZR-000321 Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. GA AZR-000322 Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. GA AZR-000323 Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. GA AZR-000324 Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. GA AZR-000325 Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. GA AZR-000326 Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. GA AZR-000327 Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. GA AZR-000328 Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. GA AZR-000329 Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. GA AZR-000330 Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. GA AZR-000331 Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. GA AZR-000332 Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. GA AZR-000333 Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. GA AZR-000334 Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. GA AZR-000335 Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. GA AZR-000336 Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. GA AZR-000337 Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. GA AZR-000338 Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. GA AZR-000339 Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. GA AZR-000340 Azure.APIM.MultiRegion Enhance service availability and resilience by deploying API Management instances across multiple regions. GA AZR-000341 Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. GA AZR-000342 Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. GA AZR-000343 Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. GA AZR-000344 Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. GA AZR-000345 Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. GA AZR-000346 Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. GA AZR-000347 Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. GA AZR-000348 Azure.AppGw.Name Application Gateways should meet naming requirements. GA AZR-000349 Azure.Bastion.Name Bastion hosts should meet naming requirements. GA AZR-000350 Azure.RSV.Name Recovery Services vaults should meet naming requirements. GA AZR-000351 Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. GA AZR-000352 Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. GA AZR-000353 Azure.Defender.Dns Enable Microsoft Defender for DNS. GA AZR-000354 Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). GA AZR-000355 Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. GA AZR-000356 Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. GA AZR-000357 Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. GA AZR-000358 Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. GA AZR-000359 Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. GA AZR-000360 Azure.ContainerApp.Name Container Apps should meet naming requirements. GA AZR-000361 Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. GA AZR-000362 Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. GA AZR-000363 Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. GA AZR-000364 Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. GA AZR-000365 Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. GA AZR-000366 Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. GA AZR-000367 Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. GA AZR-000368 Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. GA AZR-000369 Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. GA AZR-000370 Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. GA AZR-000371 Azure.APIM.PolicyBase Base element for any policy element in a section should be configured. GA AZR-000372 Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. GA AZR-000373 Azure.Arc.Kubernetes.Defender Deploy Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters. Preview AZR-000374 Azure.Arc.Server.MaintenanceConfig Use a maintenance configuration for Arc-enabled servers. Preview AZR-000375 Azure.VM.MaintenanceConfig Use a maintenance configuration for virtual machines. GA AZR-000376 Azure.AppGw.MigrateV2 Use a Application Gateway v2 SKU. GA AZR-000377 Azure.Defender.Api Enable Microsoft Defender for APIs. GA AZR-000378 Azure.ContainerApp.DisableAffinity Disable session affinity to prevent unbalanced distribution. GA AZR-000379 Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. GA AZR-000380 Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. GA AZR-000381 Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. GA AZR-000382 Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. GA AZR-000383 Azure.Defender.Storage.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. GA AZR-000384 Azure.Storage.Defender.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. GA AZR-000385 Azure.Defender.Storage.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Preview AZR-000386 Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. GA AZR-000387 Azure.APIM.DefenderCloud APIs published in Azure API Management should be onboarded to Microsoft Defender for APIs. GA AZR-000388 Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. GA AZR-000389 Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. GA AZR-000390 Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. GA AZR-000391 Azure.Storage.Defender.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Preview AZR-000392 Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. GA AZR-000393 Azure.Databricks.SecureConnectivity Use Databricks workspaces configured for secure cluster connectivity. GA AZR-000394 Azure.MySQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases. GA AZR-000395 Azure.PublicIP.MigrateStandard Use the Standard SKU for Public IP addresses as the Basic SKU will be retired. GA AZR-000396 Azure.FrontDoor.ManagedIdentity Ensure Front Door uses a managed identity to authorize access to Azure resources. GA AZR-000397 Azure.RSV.Immutable Ensure immutability is configured to protect backup data. GA AZR-000398 Azure.BV.Immutable Ensure immutability is configured to protect backup data. GA AZR-000399 Azure.Firewall.PolicyMode Deny high confidence malicious IP addresses, domains and URLs. GA AZR-000400 Azure.ContainerApp.APIVersion Migrate from retired API version to a supported version. GA AZR-000401 Azure.ACR.AnonymousAccess Anonymous pull access allows unidentified downloading of images and metadata from a container registry. Preview AZR-000402 Azure.ACR.Firewall Container Registry without restrictions can be accessed from any network location including the Internet. GA AZR-000403 Azure.ML.ComputeIdleShutdown Configure an idle shutdown timeout for Machine Learning compute instances. GA AZR-000404 Azure.ML.DisableLocalAuth Azure Machine Learning compute resources should have local authentication methods disabled. GA AZR-000405 Azure.ML.ComputeVnet Azure Machine Learning Computes should be hosted in a virtual network (VNet). GA AZR-000406 Azure.ML.PublicAccess Disable public network access from a Azure Machine Learning workspace. GA AZR-000407 Azure.ML.UserManagedIdentity ML workspaces should use user-assigned managed identity, rather than the default system-assigned managed identity. GA AZR-000408 Azure.Deployment.SecureParameter Sensitive parameters that have been not been marked as secure may leak the secret into deployment history or logs. GA AZR-000409 Azure.Databricks.SKU Ensure Databricks workspaces are non-trial SKUs for production workloads. GA AZR-000410 Azure.Databricks.PublicAccess Azure Databricks workspaces should disable public network access. GA AZR-000411 Azure.DevBox.ProjectLimit Limit the number of Dev Boxes a single user can create for a project. GA AZR-000412 Azure.AKS.MinUserPoolNodes User node pools in an AKS cluster should have a minimum number of nodes for failover and updates. GA AZR-000413 Azure.ContainerApp.MinReplicas Use multiple replicas to remove a single point of failure. GA AZR-000414 Azure.ContainerApp.AvailabilityZone Use Container Apps environments that are zone redundant to improve reliability. GA AZR-000415 Azure.Cosmos.MinTLS Cosmos DB accounts should reject TLS versions older than 1.2. GA AZR-000416 Azure.EntraDS.NTLM Disable NTLM v1 for Microsoft Entra Domain Services. GA AZR-000417 Azure.EntraDS.TLS Disable TLS v1 for Microsoft Entra Domain Services. GA AZR-000418 Azure.EntraDS.RC4 Disable RC4 encryption for Microsoft Entra Domain Services. GA AZR-000419 Azure.Cosmos.SLA Use a paid tier to qualify for a Service Level Agreement (SLA). GA AZR-000420 Azure.Cosmos.DisableLocalAuth Access keys allow depersonalized access to Cosmos DB accounts using a shared secret. GA AZR-000421 Azure.Cosmos.PublicAccess Azure Cosmos DB should have public network access disabled. GA AZR-000422 Azure.EventHub.Firewall Access to the namespace endpoints should be restricted to only allowed sources. GA AZR-000423 Azure.AppGw.MigrateWAFPolicy Migrate to Application Gateway WAF policy. GA AZR-000424 Azure.Grafana.Version Grafana workspaces should be on Grafana version 10. GA AZR-000425 Azure.LogAnalytics.Replication Log Analytics workspaces should have workspace replication enabled to improve service availability. Preview AZR-000426 Azure.VMSS.AutoInstanceRepairs Automatic instance repairs are enabled. Preview AZR-000427 Azure.Redis.EntraID Use Entra ID authentication with cache instances. GA AZR-000428 Azure.AppService.NodeJsVersion Configure applications to use supported Node.js runtime versions. GA AZR-000429 Azure.Firewall.AvailabilityZone Deploy firewall instances using availability zones in supported regions to ensure high availability and resilience. GA AZR-000430 Azure.VNG.MaintenanceConfig Use a customer-controlled maintenance configuration for virtual network gateways. Preview AZR-000431 Azure.MySQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for MySQL servers. GA AZR-000432 Azure.MySQL.ZoneRedundantHA Deploy Azure Database for MySQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. GA AZR-000433 Azure.PostgreSQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for PostgreSQL servers. GA AZR-000434 Azure.PostgreSQL.ZoneRedundantHA Deploy Azure Database for PostgreSQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. GA AZR-000435 Azure.AKS.NodeAutoUpgrade Deploy AKS Clusters with Node Auto-Upgrade enabled GA AZR-000436 Azure.VMSS.AvailabilityZone Deploy virtual machine scale set instances using availability zones in supported regions to ensure high availability and resilience. GA AZR-000437 Azure.AVD.ScheduleAgentUpdate Define a windows for agent updates to minimize disruptions to users. GA AZR-000438 Azure.VMSS.ZoneBalance Deploy virtual machine scale set instances using the best-effort zone balance in supported regions. GA AZR-000439 Azure.Cosmos.ContinuousBackup Enable continuous backup on Cosmos DB accounts. GA AZR-000440 Azure.SQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL databases. GA AZR-000441 Azure.SQLMI.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL Managed Instances. GA AZR-000442 Azure.AppService.AvailabilityZone Deploy app service plan instances using availability zones in supported regions to ensure high availability and resilience. GA AZR-000443 Azure.ASE.AvailabilityZone Deploy app service environments using availability zones in supported regions to ensure high availability and resilience. GA AZR-000444 Azure.ServiceBus.GeoReplica Enhance resilience to regional outages by replicating namespaces. Preview AZR-000445 Azure.AKS.AuditAdmin Use kube-audit-admin instead of kube-audit to capture administrative actions in AKS clusters. GA AZR-000446 Azure.AKS.MaintenanceWindow Configure customer-controlled maintenance windows for AKS clusters. GA AZR-000447 Azure.VNET.PrivateSubnet Disable default outbound access for virtual machines. Preview AZR-000448 Azure.VNET.FirewallSubnetNAT Zonal-deployed Azure Firewalls should consider using an Azure NAT Gateway for outbound access. GA AZR-000449 Azure.VM.PublicIPAttached Avoid attaching public IPs directly to virtual machines. GA AZR-000450 Azure.VMSS.PublicIPAttached Avoid attaching public IPs directly to virtual machine scale set instances. GA AZR-000451 Azure.VM.ASDistributeTraffic Ensure high availability by distributing traffic among members in an availability set. GA AZR-000452 Azure.VM.MultiTenantHosting Deploy Windows 10 and 11 virtual machines in Azure using Multi-tenant Hosting Rights to leverage your existing Windows licenses. GA"},{"location":"en/rules/Azure.ACR.AdminUser/","title":"Container Registry local admin account is enabled","text":"Azure.ACR.AdminUserAZR-000005Error <p> Security  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>The local admin account allows depersonalized access to a container registry using a shared secret.</p>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"en/rules/Azure.ACR.AdminUser/#description","title":"Description","text":"<p>Azure Container Registry (ACR) includes a built-in local admin user account. The local admin account is a single user account with administrative access to the registry. This account is intended for early proof of concepts and working with sample code. The admin user account is not intended for general use with container registries.</p> <p>Instead of using the admin account, consider using Entra ID (previously Azure AD) identities. Entra ID provides a centralized identity and authentication system for Azure. This provides a number of benefits including:</p> <ul> <li>Strong account protection controls with conditional access, identity governance, and privileged identity management.</li> <li>Auditing and reporting of account activity.</li> <li>Granular access control with role-based access control (RBAC).</li> <li>Separation of account types for users and applications.</li> </ul>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"en/rules/Azure.ACR.AdminUser/#recommendation","title":"Recommendation","text":"<p>Consider disabling the local admin account and only use identity-based authentication for registry operations.</p>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"en/rules/Azure.ACR.AdminUser/#examples","title":"Examples","text":"","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"en/rules/Azure.ACR.AdminUser/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy registries that pass this rule:</p> <ul> <li>Set <code>properties.adminUserEnabled</code> to <code>false</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerRegistry/registries\",\n  \"apiVersion\": \"2023-07-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Premium\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"adminUserEnabled\": false,\n    \"policies\": {\n      \"trustPolicy\": {\n        \"status\": \"enabled\",\n        \"type\": \"Notary\"\n      },\n      \"retentionPolicy\": {\n        \"days\": 30,\n        \"status\": \"enabled\"\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"en/rules/Azure.ACR.AdminUser/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy registries that pass this rule:</p> <ul> <li>Set <code>properties.adminUserEnabled</code> to <code>false</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource registry 'Microsoft.ContainerRegistry/registries@2023-07-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    adminUserEnabled: false\n    policies: {\n      trustPolicy: {\n        status: 'enabled'\n        type: 'Notary'\n      }\n      retentionPolicy: {\n        days: 30\n        status: 'enabled'\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-registry/registry:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/container-registry/registry:0.5.1\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-registry/registry:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"en/rules/Azure.ACR.AdminUser/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"<p>To configure registries that pass this rule:</p> Azure CLI snippet<pre><code>az acr update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --admin-enabled false\n</code></pre>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"en/rules/Azure.ACR.AdminUser/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"<p>To configure registries that pass this rule:</p> Azure PowerShell snippet<pre><code>Update-AzContainerRegistry -ResourceGroupName '&lt;resource_group&gt;' -Name '&lt;name&gt;' -DisableAdminUser\n</code></pre>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"en/rules/Azure.ACR.AdminUser/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Container registries should have local admin account disabled <code>/providers/Microsoft.Authorization/policyDefinitions/dc921057-6b28-4fbe-9b83-f7bec05db6c2</code>.</li> <li>Configure container registries to disable local admin account <code>/providers/Microsoft.Authorization/policyDefinitions/79fdfe03-ffcb-4e55-b4d0-b925b8241759</code>.</li> </ul>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"en/rules/Azure.ACR.AdminUser/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Authenticate with a private Docker container registry</li> <li>Best practices for Azure Container Registry</li> <li>Use an Azure managed identity to authenticate to an Azure container registry</li> <li>Azure Container Registry roles and permissions</li> <li>What is Azure role-based access control (Azure RBAC)?</li> <li>IM-1: Use centralized identity and authentication system</li> <li>IM-3: Manage application identities securely and automatically</li> <li>PA-1: Separate and limit highly privileged/administrative users</li> <li>Azure Policy Regulatory Compliance controls for Azure Container Registry</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"en/rules/Azure.ACR.AnonymousAccess/","title":"Container registry anonymous pull access is enabled","text":"Azure.ACR.AnonymousAccessAZR-000401Error <p> Security  \u00b7  Container Registry  \u00b7  Rule  \u00b7  Preview  \u00b7  2023_09  \u00b7  Important</p> <p>Anonymous pull access allows unidentified downloading of images and metadata from a container registry.</p>","tags":["Azure.ACR.AnonymousAccess","AZR-000401"]},{"location":"en/rules/Azure.ACR.AnonymousAccess/#description","title":"Description","text":"<p>By default, Azure Container Registry (ACR) requires you to be authorized before you push or pull content from the registry. When anonymous pull access is enabled:</p> <ul> <li>Any client with network access can pull content from the entire registry without authorization.</li> <li>Repository-scoped tokens can not be used to limit pull access, tokens will be able to pull all content.</li> </ul>","tags":["Azure.ACR.AnonymousAccess","AZR-000401"]},{"location":"en/rules/Azure.ACR.AnonymousAccess/#recommendation","title":"Recommendation","text":"<p>Consider disabling anonymous pull access in scenarios that require user authentication.</p>","tags":["Azure.ACR.AnonymousAccess","AZR-000401"]},{"location":"en/rules/Azure.ACR.AnonymousAccess/#examples","title":"Examples","text":"","tags":["Azure.ACR.AnonymousAccess","AZR-000401"]},{"location":"en/rules/Azure.ACR.AnonymousAccess/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy registries that pass this rule:</p> <ul> <li>Set the <code>properties.anonymousPullEnabled</code> property to <code>false</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerRegistry/registries\",\n  \"apiVersion\": \"2023-08-01-preview\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Premium\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"adminUserEnabled\": false,\n    \"anonymousPullEnabled\": false,\n    \"policies\": {\n      \"quarantinePolicy\": {\n        \"status\": \"enabled\"\n      },\n      \"trustPolicy\": {\n        \"status\": \"enabled\",\n        \"type\": \"Notary\"\n      },\n      \"retentionPolicy\": {\n        \"days\": 30,\n        \"status\": \"enabled\"\n      },\n      \"softDeletePolicy\": {\n        \"retentionDays\": 90,\n        \"status\": \"enabled\"\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.AnonymousAccess","AZR-000401"]},{"location":"en/rules/Azure.ACR.AnonymousAccess/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy registries that pass this rule:</p> <ul> <li>Set the <code>properties.anonymousPullEnabled</code> property to <code>false</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource registry 'Microsoft.ContainerRegistry/registries@2023-08-01-preview' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    adminUserEnabled: false\n    anonymousPullEnabled: false\n    policies: {\n      quarantinePolicy: {\n        status: 'enabled'\n      }\n      trustPolicy: {\n        status: 'enabled'\n        type: 'Notary'\n      }\n      retentionPolicy: {\n        days: 30\n        status: 'enabled'\n      }\n      softDeletePolicy: {\n        retentionDays: 90\n        status: 'enabled'\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-registry/registry:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/container-registry/registry:0.5.1\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-registry/registry:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ACR.AnonymousAccess","AZR-000401"]},{"location":"en/rules/Azure.ACR.AnonymousAccess/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"<p>To configure registries that pass this rule:</p> Azure CLI snippet<pre><code>az acr update  -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --anonymous-pull-enabled false\n</code></pre>","tags":["Azure.ACR.AnonymousAccess","AZR-000401"]},{"location":"en/rules/Azure.ACR.AnonymousAccess/#notes","title":"Notes","text":"<p>The anonymous pull access feature is currently in preview. Anonymous pull access is only available in the <code>Standard</code> and <code>Premium</code> service tiers.</p> <p>This rule may generate false positives in specific scenarios where to intend to distribute OCI content to Internet users, for example: You are a software vendor and intend to distribute container images of your software to customers.</p>","tags":["Azure.ACR.AnonymousAccess","AZR-000401"]},{"location":"en/rules/Azure.ACR.AnonymousAccess/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Make your container registry content publicly available</li> <li>Azure security baseline for Container Registry</li> <li>IM-1: Use centralized identity and authentication system</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ACR.AnonymousAccess","AZR-000401"]},{"location":"en/rules/Azure.ACR.ContainerScan/","title":"Container Registry images are not scanned regularly for vulnerabilities","text":"Azure.ACR.ContainerScanAZR-000002Error <p> Security  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2020_12  \u00b7  Critical</p> <p>Container images or their base images may have vulnerabilities discovered after they are built.</p>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"en/rules/Azure.ACR.ContainerScan/#description","title":"Description","text":"<p>A potential risk with container-based workloads is un-patched security vulnerabilities in:</p> <ul> <li>Operating System base images.</li> <li>Frameworks and runtime dependencies used by application code.</li> </ul> <p>It is important to adopt a strategy to actively scan images for security vulnerabilities. One option for scanning container images is to use Microsoft Defender for container registries. Microsoft Defender for container registries scans each container image pushed to the registry.</p> <p>Microsoft Defender for container registries scans images on push, import, and recently pulled images. Recently pulled images are scanned on a regular basis when they have been pulled within the last 30 days. When scanned, the container image is pulled and executed in an isolated sandbox for scanning. Any detected vulnerabilities are reported to Microsoft Defender for Cloud.</p> <p>Container image vulnerability scanning with Microsoft Defender for container registries:</p> <ul> <li>Is currently only available for Linux-hosted ACR registries.</li> <li>The container registry must be accessible by Microsoft Defender for Container registries.   Network access can not be restricted by firewall, Service Endpoints, or Private Endpoints.</li> <li>Is supported in commercial clouds.   Is not currently supported in sovereign or national clouds (e.g. US Gov, China Gov, etc.).</li> </ul>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"en/rules/Azure.ACR.ContainerScan/#recommendation","title":"Recommendation","text":"<p>Consider using Microsoft Defender for Cloud to scan for security vulnerabilities in container images.</p>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"en/rules/Azure.ACR.ContainerScan/#examples","title":"Examples","text":"","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"en/rules/Azure.ACR.ContainerScan/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable container image scanning:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for container registries.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Security/pricings\",\n    \"apiVersion\": \"2018-06-01\",\n    \"name\": \"ContainerRegistry\",\n    \"properties\": {\n        \"pricingTier\": \"Standard\"\n    }\n}\n</code></pre>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"en/rules/Azure.ACR.ContainerScan/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable container image scanning:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for container registries.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForContainerRegistry 'Microsoft.Security/pricings@2018-06-01' = {\n  name: 'ContainerRegistry'\n  properties: {\n    pricingTier: 'Standard'\n  }\n}\n</code></pre>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"en/rules/Azure.ACR.ContainerScan/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az security pricing create -n 'ContainerRegistry' --tier 'standard'\n</code></pre>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"en/rules/Azure.ACR.ContainerScan/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Set-AzSecurityPricing -Name 'ContainerRegistry' -PricingTier 'Standard'\n</code></pre>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"en/rules/Azure.ACR.ContainerScan/#notes","title":"Notes","text":"<p>This rule applies when analyzing resources deployed (in-flight) to Azure and does not detect third-party scanning tools.</p>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"en/rules/Azure.ACR.ContainerScan/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>Introduction to Microsoft Defender for container registries</li> <li>Container security in Microsoft Defender for Cloud</li> <li>Secure the images and run time</li> </ul>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"en/rules/Azure.ACR.ContentTrust/","title":"Use trusted container images","text":"Azure.ACR.ContentTrustAZR-000009Error <p> Security  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2020_12  \u00b7  Important</p> <p>Use container images signed by a trusted image publisher.</p>","tags":["Azure.ACR.ContentTrust","AZR-000009"]},{"location":"en/rules/Azure.ACR.ContentTrust/#description","title":"Description","text":"<p>Azure Container Registry (ACR) content trust enables pushing and pulling of signed images. Signed images provides additional assurance that they have been built on a trusted source.</p> <p>To enable content trust, the container registry must be using a Premium SKU.</p> <p>Content trust is currently not supported in a registry that's encrypted with a customer-managed key. When using customer-managed keys, content trust can not be enabled.</p>","tags":["Azure.ACR.ContentTrust","AZR-000009"]},{"location":"en/rules/Azure.ACR.ContentTrust/#recommendation","title":"Recommendation","text":"<p>Consider enabling content trust on registries, clients, and sign container images.</p>","tags":["Azure.ACR.ContentTrust","AZR-000009"]},{"location":"en/rules/Azure.ACR.ContentTrust/#examples","title":"Examples","text":"","tags":["Azure.ACR.ContentTrust","AZR-000009"]},{"location":"en/rules/Azure.ACR.ContentTrust/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy registries that pass this rule:</p> <ul> <li>Set <code>properties.trustPolicy.status</code> to <code>enabled</code>.</li> <li>Set <code>properties.trustPolicy.type</code> to <code>Notary</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerRegistry/registries\",\n  \"apiVersion\": \"2023-08-01-preview\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Premium\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"adminUserEnabled\": false,\n    \"policies\": {\n      \"trustPolicy\": {\n        \"status\": \"enabled\",\n        \"type\": \"Notary\"\n      },\n      \"retentionPolicy\": {\n        \"days\": 30,\n        \"status\": \"enabled\"\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.ContentTrust","AZR-000009"]},{"location":"en/rules/Azure.ACR.ContentTrust/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy registries that pass this rule:</p> <ul> <li>Set <code>properties.trustPolicy.status</code> to <code>enabled</code>.</li> <li>Set <code>properties.trustPolicy.type</code> to <code>Notary</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource registry 'Microsoft.ContainerRegistry/registries@2023-08-01-preview' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    adminUserEnabled: false\n    policies: {\n      trustPolicy: {\n        status: 'enabled'\n        type: 'Notary'\n      }\n      retentionPolicy: {\n        days: 30\n        status: 'enabled'\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-registry/registry:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/container-registry/registry:0.5.1\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-registry/registry:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ACR.ContentTrust","AZR-000009"]},{"location":"en/rules/Azure.ACR.ContentTrust/#links","title":"Links","text":"<ul> <li>SE:02 Secured development lifecycle</li> <li>Content trust in Azure Container Registry</li> <li>Content trust in Docker</li> <li>Overview of customer-managed keys</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ACR.ContentTrust","AZR-000009"]},{"location":"en/rules/Azure.ACR.Firewall/","title":"Container Registry service firewall is not restricted","text":"Azure.ACR.FirewallAZR-000402Error <p> Security  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2023_09  \u00b7  Important</p> <p>Container Registry without restrictions can be accessed from any network location including the Internet.</p>","tags":["Azure.ACR.Firewall","AZR-000402"]},{"location":"en/rules/Azure.ACR.Firewall/#description","title":"Description","text":"<p>Azure Container Registry (ACR) allows you to restrict network access to trusted clients and networks instead of any client.</p> <p>Container registries using the Premium SKU can limit network access by setting firewall rules or using private endpoints. Firewall and private endpoints are not supported when using the Basic or Standard SKU.</p> <p>In general, network access should be restricted to harden against unauthorized access or exfiltration attempts. However may not be required when publishing and distributing public container images to external parties.</p>","tags":["Azure.ACR.Firewall","AZR-000402"]},{"location":"en/rules/Azure.ACR.Firewall/#recommendation","title":"Recommendation","text":"<p>Consider restricting network access to trusted clients to harden against unauthorized access or exfiltration attempts.</p>","tags":["Azure.ACR.Firewall","AZR-000402"]},{"location":"en/rules/Azure.ACR.Firewall/#examples","title":"Examples","text":"","tags":["Azure.ACR.Firewall","AZR-000402"]},{"location":"en/rules/Azure.ACR.Firewall/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Container Registries that pass this rule:</p> <ul> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code>. OR</li> <li>Set the <code>properties.networkRuleSet.defaultAction</code> property to <code>Deny</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerRegistry/registries\",\n  \"apiVersion\": \"2023-11-01-preview\",\n  \"name\": \"[parameters('registryName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Premium\"\n  },\n  \"properties\": {\n    \"publicNetworkAccess\": \"Enabled\",\n    \"networkRuleBypassOptions\": \"AzureServices\",\n    \"networkRuleSet\": {\n      \"defaultAction\": \"Deny\",\n      \"ipRules\": [\n        {\n          \"action\": \"Allow\",\n          \"value\": \"_PublicIPv4Address_\"\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.Firewall","AZR-000402"]},{"location":"en/rules/Azure.ACR.Firewall/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Container Registries that pass this rule:</p> <ul> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code>. OR</li> <li>Set the <code>properties.networkRuleSet.defaultAction</code> property to <code>Deny</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource acr 'Microsoft.ContainerRegistry/registries@2023-11-01-preview' = {\n  name: registryName\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  properties: {\n    publicNetworkAccess: 'Enabled'\n    networkRuleBypassOptions: 'AzureServices'\n    networkRuleSet: {\n      defaultAction: 'Deny'\n      ipRules: [\n        {\n          action: 'Allow'\n          value: '_PublicIPv4Address_'\n        }\n      ]\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-registry/registry:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/container-registry/registry:0.5.1\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-registry/registry:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ACR.Firewall","AZR-000402"]},{"location":"en/rules/Azure.ACR.Firewall/#notes","title":"Notes","text":"<p>Configuring firewall rules or using private endpoints is only available for the Premium SKU.</p> <p>When used with Microsoft Defender for Containers, you must enable trusted Microsoft services for the vulnerability assessment feature to be able to scan the registry.</p>","tags":["Azure.ACR.Firewall","AZR-000402"]},{"location":"en/rules/Azure.ACR.Firewall/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Restrict access using private endpoint</li> <li>Restrict access using firewall rules</li> <li>Allow trusted services to securely access a network-restricted container registry</li> <li>Vulnerability assessments for Azure with Microsoft Defender Vulnerability Management</li> <li>Azure security baseline for Container Registry</li> <li>NS-2: Secure cloud services with network controls</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ACR.Firewall","AZR-000402"]},{"location":"en/rules/Azure.ACR.GeoReplica/","title":"Container Registry does not replica images to a secondary region","text":"Azure.ACR.GeoReplicaAZR-000004Error <p> Reliability  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2020_12  \u00b7  Important</p> <p>Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start.</p>","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"en/rules/Azure.ACR.GeoReplica/#description","title":"Description","text":"<p>A container registry is stored and maintained by default in a single region. Optionally geo-replication to one or more additional regions can be enabled.</p> <p>Geo-replicating container registries provides the following benefits:</p> <ul> <li>Single registry/ image/ tag names can be used across multiple regions.</li> <li>Network-close registry access within the region reduces latency.</li> <li>As images are pulled from a local replicated registry, each pull does not incur additional egress costs.</li> </ul>","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"en/rules/Azure.ACR.GeoReplica/#recommendation","title":"Recommendation","text":"<p>Consider using a geo-replicated container registry for multi-region deployments.</p>","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"en/rules/Azure.ACR.GeoReplica/#examples","title":"Examples","text":"","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"en/rules/Azure.ACR.GeoReplica/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable geo-replication for Container Registries that pass this rule:</p> <ul> <li>Set <code>sku.name</code> to <code>Premium</code> (required for geo-replication).</li> <li>Add <code>replications</code> child resource with <code>location</code> set to the region to replicate to.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"metadata\": {\n    \"_generator\": {\n      \"name\": \"bicep\",\n      \"version\": \"0.5.6.12127\",\n      \"templateHash\": \"12610175857982700190\"\n    }\n  },\n  \"parameters\": {\n    \"acrName\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"[format('acr{0}', uniqueString(resourceGroup().id))]\",\n      \"maxLength\": 50,\n      \"minLength\": 5,\n      \"metadata\": {\n        \"description\": \"Globally unique name of your Azure Container Registry\"\n      }\n    },\n    \"acrAdminUserEnabled\": {\n      \"type\": \"bool\",\n      \"defaultValue\": false,\n      \"metadata\": {\n        \"description\": \"Enable admin user that has push / pull permission to the registry.\"\n      }\n    },\n    \"location\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"[resourceGroup().location]\",\n      \"metadata\": {\n        \"description\": \"Location for registry home replica.\"\n      }\n    },\n    \"acrSku\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"Premium\",\n      \"allowedValues\": [\n        \"Premium\"\n      ],\n      \"metadata\": {\n        \"description\": \"Tier of your Azure Container Registry. Geo-replication requires Premium SKU.\"\n      }\n    },\n    \"acrReplicaLocation\": {\n      \"type\": \"string\",\n      \"metadata\": {\n        \"description\": \"Short name for registry replica location.\"\n      }\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.ContainerRegistry/registries\",\n      \"apiVersion\": \"2023-11-01-preview\",\n      \"name\": \"[parameters('acrName')]\",\n      \"location\": \"[parameters('location')]\",\n      \"sku\": {\n        \"name\": \"[parameters('acrSku')]\"\n      },\n      \"tags\": {\n        \"displayName\": \"Container Registry\",\n        \"container.registry\": \"[parameters('acrName')]\"\n      },\n      \"properties\": {\n        \"adminUserEnabled\": \"[parameters('acrAdminUserEnabled')]\"\n      }\n    },\n    {\n      \"type\": \"Microsoft.ContainerRegistry/registries/replications\",\n      \"apiVersion\": \"2023-11-01-preview\",\n      \"name\": \"[format('{0}/{1}', parameters('acrName'), parameters('acrReplicaLocation'))]\",\n      \"location\": \"[parameters('acrReplicaLocation')]\",\n      \"properties\": {},\n      \"dependsOn\": [\n        \"[resourceId('Microsoft.ContainerRegistry/registries', parameters('acrName'))]\"\n      ]\n    }\n  ],\n  \"outputs\": {\n    \"acrLoginServer\": {\n      \"type\": \"string\",\n      \"value\": \"[reference(resourceId('Microsoft.ContainerRegistry/registries', parameters('acrName'))).loginServer]\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"en/rules/Azure.ACR.GeoReplica/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Container Registries that pass this rule:</p> <ul> <li>Set <code>sku.name</code> to <code>Premium</code> (required for geo-replication).</li> <li>Add <code>replications</code> child resource with <code>location</code> set to the region to replicate to.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource containerRegistry 'Microsoft.ContainerRegistry/registries@2023-11-01-preview' = {\n  name: acrName\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  tags: {\n    displayName: 'Container Registry'\n    'container.registry': acrName\n  }\n  properties: {\n    adminUserEnabled: acrAdminUserEnabled\n  }\n}\n\nresource containerRegistryReplica 'Microsoft.ContainerRegistry/registries/replications@2023-11-01-preview' = {\n  parent: containerRegistry\n  name: '${acrReplicaLocation}'\n  location: acrReplicaLocation\n  properties: {\n  }\n}\n</code></pre>","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"en/rules/Azure.ACR.GeoReplica/#notes","title":"Notes","text":"<p>This rule applies when analyzing resources deployed (in-flight) to Azure.</p>","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"en/rules/Azure.ACR.GeoReplica/#links","title":"Links","text":"<ul> <li>RE:05 High-availability multi-region design</li> <li>Geo-replicate multi-region deployments</li> <li>Geo-replication in Azure Container Registry</li> <li>Tutorial: Prepare a geo-replicated Azure container registry</li> </ul>","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"en/rules/Azure.ACR.ImageHealth/","title":"Remove vulnerable container images","text":"Azure.ACR.ImageHealthAZR-000003Error <p> Security  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2020_12  \u00b7  Critical</p> <p>Remove container images with known vulnerabilities.</p>","tags":["Azure.ACR.ImageHealth","AZR-000003"]},{"location":"en/rules/Azure.ACR.ImageHealth/#description","title":"Description","text":"<p>When Microsoft Defender for container registries is enabled, Microsoft Defender scans container images. Container images are scanned for known vulnerabilities and marked as healthy or unhealthy. Vulnerable container images should not be used.</p>","tags":["Azure.ACR.ImageHealth","AZR-000003"]},{"location":"en/rules/Azure.ACR.ImageHealth/#recommendation","title":"Recommendation","text":"<p>Consider using removing container images with known vulnerabilities.</p>","tags":["Azure.ACR.ImageHealth","AZR-000003"]},{"location":"en/rules/Azure.ACR.ImageHealth/#notes","title":"Notes","text":"<p>This rule applies when analyzing resources deployed (in-flight) to Azure.</p>","tags":["Azure.ACR.ImageHealth","AZR-000003"]},{"location":"en/rules/Azure.ACR.ImageHealth/#links","title":"Links","text":"<ul> <li>SE:02 Secured development lifecycle</li> <li>Introduction to Azure Defender for container registries</li> <li>Overview of Microsoft Defender for Containers</li> <li>Secure the images and run time</li> </ul>","tags":["Azure.ACR.ImageHealth","AZR-000003"]},{"location":"en/rules/Azure.ACR.MinSku/","title":"Use ACR production SKU","text":"Azure.ACR.MinSkuAZR-000006Error <p> Reliability  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>ACR should use the Premium or Standard SKU for production deployments.</p>","tags":["Azure.ACR.MinSku","AZR-000006"]},{"location":"en/rules/Azure.ACR.MinSku/#description","title":"Description","text":"<p>Azure Container Registry (ACR) provides a range of different service tiers (also known as SKUs). These service tiers provide different levels of performance and features.</p> <p>Three service tiers are available: Basic, Standard, and Premium. Basic container registries are only recommended for non-production deployments. Use a minimum of Standard for production container registries.</p> <p>The Premium SKU provides higher image throughput and included storage, and is required for:</p> <ul> <li>Geo-replication</li> <li>Availability zones</li> <li>Private Endpoints</li> <li>Firewall restrictions</li> <li>Tokens and scope-maps</li> </ul>","tags":["Azure.ACR.MinSku","AZR-000006"]},{"location":"en/rules/Azure.ACR.MinSku/#recommendation","title":"Recommendation","text":"<p>Consider using the Premium Container Registry SKU for production deployments.</p>","tags":["Azure.ACR.MinSku","AZR-000006"]},{"location":"en/rules/Azure.ACR.MinSku/#examples","title":"Examples","text":"","tags":["Azure.ACR.MinSku","AZR-000006"]},{"location":"en/rules/Azure.ACR.MinSku/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy registries that pass this rule:</p> <ul> <li>Set the <code>sku.name</code> property to <code>Premium</code> or <code>Standard</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerRegistry/registries\",\n  \"apiVersion\": \"2023-01-01-preview\",\n  \"name\": \"[parameters('registryName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Premium\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"adminUserEnabled\": false,\n    \"policies\": {\n      \"quarantinePolicy\": {\n        \"status\": \"enabled\"\n      },\n      \"trustPolicy\": {\n        \"status\": \"enabled\",\n        \"type\": \"Notary\"\n      },\n      \"retentionPolicy\": {\n        \"days\": 30,\n        \"status\": \"enabled\"\n      },\n      \"softDeletePolicy\": {\n        \"retentionDays\": 90,\n        \"status\": \"enabled\"\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.MinSku","AZR-000006"]},{"location":"en/rules/Azure.ACR.MinSku/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy registries that pass this rule:</p> <ul> <li>Set the <code>sku.name</code> property to <code>Premium</code> or <code>Standard</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource acr 'Microsoft.ContainerRegistry/registries@2023-01-01-preview' = {\n  name: registryName\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    adminUserEnabled: false\n    policies: {\n      quarantinePolicy: {\n        status: 'enabled'\n      }\n      trustPolicy: {\n        status: 'enabled'\n        type: 'Notary'\n      }\n      retentionPolicy: {\n        days: 30\n        status: 'enabled'\n      }\n      softDeletePolicy: {\n        retentionDays: 90\n        status: 'enabled'\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-registry/registry:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/container-registry/registry:0.5.1\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-registry/registry:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ACR.MinSku","AZR-000006"]},{"location":"en/rules/Azure.ACR.MinSku/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Azure Container Registry SKUs</li> <li>Geo-replication in Azure Container Registry</li> <li>Best practices for Azure Container Registry</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ACR.MinSku","AZR-000006"]},{"location":"en/rules/Azure.ACR.Name/","title":"Use valid registry names","text":"Azure.ACR.NameAZR-000007Error <p> Operational Excellence  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Container registry names should meet naming requirements.</p>","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"en/rules/Azure.ACR.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for container registry names are:</p> <ul> <li>Between 5 and 50 characters long.</li> <li>Alphanumerics.</li> <li>Container registry names must be globally unique.</li> </ul>","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"en/rules/Azure.ACR.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet container registry naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"en/rules/Azure.ACR.Name/#examples","title":"Examples","text":"","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"en/rules/Azure.ACR.Name/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy registries that pass this rule, consider:</p> <ul> <li>Configuring a <code>minLength</code> and <code>maxLength</code> constraint for the resource name parameter.</li> <li>Optionally, you could also use a <code>uniqueString()</code> function to generate a unique name.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"name\": {\n      \"type\": \"string\",\n      \"minLength\": 5,\n      \"maxLength\": 50,\n      \"metadata\": {\n        \"description\": \"The name of the resource.\"\n      }\n    },\n    \"location\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"[resourceGroup().location]\",\n      \"metadata\": {\n        \"description\": \"The location resources will be deployed.\"\n      }\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.ContainerRegistry/registries\",\n      \"apiVersion\": \"2023-08-01-preview\",\n      \"name\": \"[parameters('name')]\",\n      \"location\": \"[parameters('location')]\",\n      \"sku\": {\n        \"name\": \"Premium\"\n      },\n      \"identity\": {\n        \"type\": \"SystemAssigned\"\n      },\n      \"properties\": {\n        \"adminUserEnabled\": false,\n        \"policies\": {\n          \"trustPolicy\": {\n            \"status\": \"enabled\",\n            \"type\": \"Notary\"\n          },\n          \"retentionPolicy\": {\n            \"days\": 30,\n            \"status\": \"enabled\"\n          }\n        }\n      }\n    }\n  ]\n}\n</code></pre>","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"en/rules/Azure.ACR.Name/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy registries that pass this rule, consider:</p> <ul> <li>Configuring a <code>minLength</code> and <code>maxLength</code> constraint for the resource name parameter.</li> <li>Optionally, you could also use a <code>uniqueString()</code> function to generate a unique name.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>@minLength(5)\n@maxLength(50)\n@sys.description('The name of the resource.')\nparam name string\n\n@sys.description('The location resources will be deployed.')\nparam location string = resourceGroup().location\n\nresource registry 'Microsoft.ContainerRegistry/registries@2023-08-01-preview' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    adminUserEnabled: false\n    policies: {\n      trustPolicy: {\n        status: 'enabled'\n        type: 'Notary'\n      }\n      retentionPolicy: {\n        days: 30\n        status: 'enabled'\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-registry/registry:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/container-registry/registry:0.5.1\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-registry/registry:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"en/rules/Azure.ACR.Name/#notes","title":"Notes","text":"<p>This rule does not check if container registry names are unique.</p>","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"en/rules/Azure.ACR.Name/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Azure resources</li> <li>Recommended abbreviations for Azure resource types</li> <li>Parameters in Bicep</li> <li>Bicep functions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"en/rules/Azure.ACR.Quarantine/","title":"Use container image quarantine pattern","text":"Azure.ACR.QuarantineAZR-000008Error <p> Security  \u00b7  Container Registry  \u00b7  Rule  \u00b7  Preview  \u00b7  2020_12  \u00b7  Important</p> <p>Enable container image quarantine, scan, and mark images as verified.</p>","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"en/rules/Azure.ACR.Quarantine/#description","title":"Description","text":"<p>Image quarantine is a configurable option for Azure Container Registry (ACR). When enabled, images pushed to the container registry are not available by default. Each image must be verified and marked as <code>Passed</code> before it is available to pull.</p> <p>To verify container images, integrate with an external security tool that supports this feature.</p>","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"en/rules/Azure.ACR.Quarantine/#recommendation","title":"Recommendation","text":"<p>Consider configuring a security tool to implement the image quarantine pattern. Enable image quarantine on the container registry to ensure each image is verified before use.</p>","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"en/rules/Azure.ACR.Quarantine/#examples","title":"Examples","text":"","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"en/rules/Azure.ACR.Quarantine/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Container Registries that pass this rule:</p> <ul> <li>Set <code>properties.quarantinePolicy.status</code> to <code>enabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerRegistry/registries\",\n  \"apiVersion\": \"2023-01-01-preview\",\n  \"name\": \"[parameters('registryName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Premium\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"adminUserEnabled\": false,\n    \"policies\": {\n      \"quarantinePolicy\": {\n        \"status\": \"enabled\"\n      },\n      \"trustPolicy\": {\n        \"status\": \"enabled\",\n        \"type\": \"Notary\"\n      },\n      \"retentionPolicy\": {\n        \"days\": 30,\n        \"status\": \"enabled\"\n      },\n      \"softDeletePolicy\": {\n        \"retentionDays\": 90,\n        \"status\": \"enabled\"\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"en/rules/Azure.ACR.Quarantine/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Container Registries that pass this rule:</p> <ul> <li>Set <code>properties.quarantinePolicy.status</code> to <code>enabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource acr 'Microsoft.ContainerRegistry/registries@2023-01-01-preview' = {\n  name: registryName\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    adminUserEnabled: false\n    policies: {\n      quarantinePolicy: {\n        status: 'enabled'\n      }\n      trustPolicy: {\n        status: 'enabled'\n        type: 'Notary'\n      }\n      retentionPolicy: {\n        days: 30\n        status: 'enabled'\n      }\n      softDeletePolicy: {\n        retentionDays: 90\n        status: 'enabled'\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"en/rules/Azure.ACR.Quarantine/#notes","title":"Notes","text":"<p>Image quarantine for Azure Container Registry is currently in preview.</p>","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"en/rules/Azure.ACR.Quarantine/#links","title":"Links","text":"<ul> <li>Monitor Azure resources in Microsoft Defender for Cloud</li> <li>How do I enable automatic image quarantine for a registry?</li> <li>Quarantine Pattern</li> <li>Secure the images and run time</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"en/rules/Azure.ACR.Retention/","title":"Configure ACR retention policies","text":"Azure.ACR.RetentionAZR-000010Error <p> Cost Optimization  \u00b7  Container Registry  \u00b7  Rule  \u00b7  Preview  \u00b7  2020_12  \u00b7  Important</p> <p>Use a retention policy to cleanup untagged manifests.</p>","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"en/rules/Azure.ACR.Retention/#description","title":"Description","text":"<p>Retention policy is a configurable option of Premium Azure Container Registry (ACR). When a retention policy is configured, untagged manifests in the registry are automatically deleted. A manifest is untagged when a more recent image is pushed using the same tag. i.e. latest.</p> <p>The retention policy (in days) can be set to 0-365. The default is 7 days.</p> <p>To configure a retention policy, the container registry must be using a Premium SKU.</p>","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"en/rules/Azure.ACR.Retention/#recommendation","title":"Recommendation","text":"<p>Consider enabling a retention policy for untagged manifests.</p>","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"en/rules/Azure.ACR.Retention/#examples","title":"Examples","text":"","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"en/rules/Azure.ACR.Retention/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Container Registries that pass this rule:</p> <ul> <li>Set <code>properties.retentionPolicy.status</code> to <code>enabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerRegistry/registries\",\n  \"apiVersion\": \"2023-11-01-preview\",\n  \"name\": \"[parameters('registryName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Premium\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"adminUserEnabled\": false,\n    \"policies\": {\n      \"quarantinePolicy\": {\n        \"status\": \"enabled\"\n      },\n      \"trustPolicy\": {\n        \"status\": \"enabled\",\n        \"type\": \"Notary\"\n      },\n      \"retentionPolicy\": {\n        \"days\": 30,\n        \"status\": \"enabled\"\n      },\n      \"softDeletePolicy\": {\n        \"retentionDays\": 90,\n        \"status\": \"enabled\"\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"en/rules/Azure.ACR.Retention/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Container Registries that pass this rule:</p> <ul> <li>Set <code>properties.retentionPolicy.status</code> to <code>enabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource acr 'Microsoft.ContainerRegistry/registries@2023-11-01-preview' = {\n  name: registryName\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    adminUserEnabled: false\n    policies: {\n      quarantinePolicy: {\n        status: 'enabled'\n      }\n      trustPolicy: {\n        status: 'enabled'\n        type: 'Notary'\n      }\n      retentionPolicy: {\n        days: 30\n        status: 'enabled'\n      }\n      softDeletePolicy: {\n        retentionDays: 90\n        status: 'enabled'\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"en/rules/Azure.ACR.Retention/#notes","title":"Notes","text":"<p>Retention policies for Azure Container Registry is currently in preview.</p>","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"en/rules/Azure.ACR.Retention/#links","title":"Links","text":"<ul> <li>CO:10 Data costs</li> <li>Set a retention policy for untagged manifests</li> <li>Lock a container image in an Azure container registry</li> <li>Scalable storage</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"en/rules/Azure.ACR.SoftDelete/","title":"Use ACR soft delete policy","text":"Azure.ACR.SoftDeleteAZR-000310Error <p> Reliability  \u00b7  Container Registry  \u00b7  Rule  \u00b7  Preview  \u00b7  2022_09  \u00b7  Important</p> <p>Azure Container Registries should have soft delete policy enabled.</p>","tags":["Azure.ACR.SoftDelete","AZR-000310"]},{"location":"en/rules/Azure.ACR.SoftDelete/#description","title":"Description","text":"<p>Azure Container Registry (ACR) allows you to enable the soft delete policy to recover any accidentally deleted artifacts for a set retention period.</p> <p>This feature is available in all the service tiers (also known as SKUs). For information about registry service tiers, see Azure Container Registry service tiers.</p> <p>Once you enable the soft delete policy, ACR manages the deleted artifacts as the soft deleted artifacts with a set retention period. Thereby you have ability to list, filter, and restore the soft deleted artifacts. Once the retention period is complete, all the soft deleted artifacts are auto-purged.</p> <p>Current preview limitations:</p> <ul> <li>ACR currently doesn't support manually purging soft deleted artifacts.</li> <li>The soft delete policy doesn't support a geo-replicated registry.</li> <li>ACR doesn't allow enabling both the retention policy and the soft delete policy. See retention policy for untagged manifests.</li> </ul>","tags":["Azure.ACR.SoftDelete","AZR-000310"]},{"location":"en/rules/Azure.ACR.SoftDelete/#recommendation","title":"Recommendation","text":"<p>Azure Container Registries should have soft delete enabled to enable recovery of accidentally deleted artifacts.</p>","tags":["Azure.ACR.SoftDelete","AZR-000310"]},{"location":"en/rules/Azure.ACR.SoftDelete/#examples","title":"Examples","text":"","tags":["Azure.ACR.SoftDelete","AZR-000310"]},{"location":"en/rules/Azure.ACR.SoftDelete/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy an Azure Container Registry that pass this rule:</p> <ul> <li>Set the <code>properties.policies.softDeletePolicy.status</code> property to <code>enabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerRegistry/registries\",\n  \"apiVersion\": \"2023-01-01-preview\",\n  \"name\": \"[parameters('registryName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Premium\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"adminUserEnabled\": false,\n    \"policies\": {\n      \"quarantinePolicy\": {\n        \"status\": \"enabled\"\n      },\n      \"trustPolicy\": {\n        \"status\": \"enabled\",\n        \"type\": \"Notary\"\n      },\n      \"retentionPolicy\": {\n        \"days\": 30,\n        \"status\": \"enabled\"\n      },\n      \"softDeletePolicy\": {\n        \"retentionDays\": 90,\n        \"status\": \"enabled\"\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.SoftDelete","AZR-000310"]},{"location":"en/rules/Azure.ACR.SoftDelete/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy an Azure Container Registry that pass this rule:</p> <ul> <li>Set the <code>properties.policies.softDeletePolicy.status</code> property to <code>enabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource acr 'Microsoft.ContainerRegistry/registries@2023-01-01-preview' = {\n  name: registryName\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    adminUserEnabled: false\n    policies: {\n      quarantinePolicy: {\n        status: 'enabled'\n      }\n      trustPolicy: {\n        status: 'enabled'\n        type: 'Notary'\n      }\n      retentionPolicy: {\n        days: 30\n        status: 'enabled'\n      }\n      softDeletePolicy: {\n        retentionDays: 90\n        status: 'enabled'\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-registry/registry:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/container-registry/registry:0.5.1\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-registry/registry:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ACR.SoftDelete","AZR-000310"]},{"location":"en/rules/Azure.ACR.SoftDelete/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az acr config soft-delete update -r '&lt;name&gt;' --days 90 --status enabled\n</code></pre>","tags":["Azure.ACR.SoftDelete","AZR-000310"]},{"location":"en/rules/Azure.ACR.SoftDelete/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Azure Container Registry (ACR) soft delete policy</li> <li>Azure Container Registry service tiers</li> <li>Policy for untagged manifests</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ACR.SoftDelete","AZR-000310"]},{"location":"en/rules/Azure.ACR.Usage/","title":"Container registry storage usage","text":"Azure.ACR.UsageAZR-000001Error <p> Cost Optimization  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2020_12  \u00b7  Important</p> <p>Regularly remove deprecated and unneeded images to reduce storage usage.</p>","tags":["Azure.ACR.Usage","AZR-000001"]},{"location":"en/rules/Azure.ACR.Usage/#description","title":"Description","text":"<p>Each ACR SKU has an amount of included storage. When the amount of included storage is exceeded, additional storage costs per GiB are accrued.</p> <p>It is good practice to regularly clean-up orphaned (or dangling) images. These images are a result of pushing updated images with the same tag.</p>","tags":["Azure.ACR.Usage","AZR-000001"]},{"location":"en/rules/Azure.ACR.Usage/#recommendation","title":"Recommendation","text":"<p>Consider removing deprecated and unneeded images to reduce storage consumption. Also consider upgrading to the Premium SKU for Basic or Standard registries to increase included storage.</p>","tags":["Azure.ACR.Usage","AZR-000001"]},{"location":"en/rules/Azure.ACR.Usage/#notes","title":"Notes","text":"<p>This rule applies when analyzing resources deployed (in-flight) to Azure.</p>","tags":["Azure.ACR.Usage","AZR-000001"]},{"location":"en/rules/Azure.ACR.Usage/#links","title":"Links","text":"<ul> <li>CO:07 Component costs</li> <li>Azure Container Registry service tiers</li> <li>Scalable storage</li> <li>Manage registry size</li> <li>Delete container images in Azure Container Registry using the Azure CLI</li> </ul>","tags":["Azure.ACR.Usage","AZR-000001"]},{"location":"en/rules/Azure.ADX.DiskEncryption/","title":"Use disk encryption for Azure Data Explorer clusters","text":"Azure.ADX.DiskEncryptionAZR-000013Error <p> Security  \u00b7  Data Explorer  \u00b7  Rule  \u00b7  2022_03  \u00b7  Important</p> <p>Use disk encryption for Azure Data Explorer (ADX) clusters.</p>","tags":["Azure.ADX.DiskEncryption","AZR-000013"]},{"location":"en/rules/Azure.ADX.DiskEncryption/#description","title":"Description","text":"<p>Azure storage is encrypted at rest, however computing resources can additionally use disk encryption. Disk encryption provides additional security for data at rest.</p>","tags":["Azure.ADX.DiskEncryption","AZR-000013"]},{"location":"en/rules/Azure.ADX.DiskEncryption/#recommendation","title":"Recommendation","text":"<p>Consider enabling disk encryption on Azure Data Explorer clusters.</p>","tags":["Azure.ADX.DiskEncryption","AZR-000013"]},{"location":"en/rules/Azure.ADX.DiskEncryption/#examples","title":"Examples","text":"","tags":["Azure.ADX.DiskEncryption","AZR-000013"]},{"location":"en/rules/Azure.ADX.DiskEncryption/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy clusters that pass this rule:</p> <ul> <li>Set <code>properties.enableDiskEncryption</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Kusto/clusters\",\n    \"apiVersion\": \"2021-08-27\",\n    \"name\": \"[parameters('name')]\",\n    \"location\": \"[parameters('location')]\",\n    \"sku\": {\n        \"name\": \"Standard_D11_v2\",\n        \"tier\": \"Standard\"\n    },\n    \"identity\": {\n        \"type\": \"SystemAssigned\"\n    },\n    \"properties\": {\n        \"enableDiskEncryption\": true\n    }\n}\n</code></pre>","tags":["Azure.ADX.DiskEncryption","AZR-000013"]},{"location":"en/rules/Azure.ADX.DiskEncryption/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy clusters that pass this rule:</p> <ul> <li>Set <code>properties.enableDiskEncryption</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource adx 'Microsoft.Kusto/clusters@2021-08-27' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard_D11_v2'\n    tier: 'Standard'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    enableDiskEncryption: true\n  }\n}\n</code></pre>","tags":["Azure.ADX.DiskEncryption","AZR-000013"]},{"location":"en/rules/Azure.ADX.DiskEncryption/#links","title":"Links","text":"<ul> <li>Data encryption in Azure</li> <li>Secure your cluster using Disk Encryption in Azure Data Explorer</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ADX.DiskEncryption","AZR-000013"]},{"location":"en/rules/Azure.ADX.ManagedIdentity/","title":"Use managed identities for Data Explorer clusters","text":"Azure.ADX.ManagedIdentityAZR-000012Error <p> Security  \u00b7  Data Explorer  \u00b7  Rule  \u00b7  2022_03  \u00b7  Important</p> <p>Configure Data Explorer clusters to use managed identities to access Azure resources securely.</p>","tags":["Azure.ADX.ManagedIdentity","AZR-000012"]},{"location":"en/rules/Azure.ADX.ManagedIdentity/#description","title":"Description","text":"<p>A managed identity allows your cluster to access other Azure AD-protected resources such as Azure Storage. The identity is managed by the Azure platform and doesn't require you to provision or rotate any secrets.</p> <p>Using Azure managed identities have the following benefits:</p> <ul> <li>You don't need to store or manage credentials.   Azure automatically generates tokens and performs rotation.</li> <li>You can use managed identities to authenticate to any Azure service that supports Azure AD authentication.</li> <li>Managed identities can be used without any additional cost.</li> </ul>","tags":["Azure.ADX.ManagedIdentity","AZR-000012"]},{"location":"en/rules/Azure.ADX.ManagedIdentity/#recommendation","title":"Recommendation","text":"<p>Consider configuring a managed identity for each Azure Data Explorer cluster. Also consider using managed identities to authenticate to related Azure services.</p>","tags":["Azure.ADX.ManagedIdentity","AZR-000012"]},{"location":"en/rules/Azure.ADX.ManagedIdentity/#examples","title":"Examples","text":"","tags":["Azure.ADX.ManagedIdentity","AZR-000012"]},{"location":"en/rules/Azure.ADX.ManagedIdentity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy clusters that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Kusto/clusters\",\n    \"apiVersion\": \"2021-08-27\",\n    \"name\": \"[parameters('name')]\",\n    \"location\": \"[parameters('location')]\",\n    \"sku\": {\n        \"name\": \"Standard_D11_v2\",\n        \"tier\": \"Standard\"\n    },\n    \"identity\": {\n        \"type\": \"SystemAssigned\"\n    },\n    \"properties\": {\n        \"enableDiskEncryption\": true\n    }\n}\n</code></pre>","tags":["Azure.ADX.ManagedIdentity","AZR-000012"]},{"location":"en/rules/Azure.ADX.ManagedIdentity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy clusters that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource adx 'Microsoft.Kusto/clusters@2021-08-27' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard_D11_v2'\n    tier: 'Standard'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    enableDiskEncryption: true\n  }\n}\n</code></pre>","tags":["Azure.ADX.ManagedIdentity","AZR-000012"]},{"location":"en/rules/Azure.ADX.ManagedIdentity/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>What are managed identities for Azure resources?</li> <li>Managed identities overview</li> <li>Configure managed identities for your Azure Data Explorer cluster</li> <li>Managed identities for Azure resources</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ADX.ManagedIdentity","AZR-000012"]},{"location":"en/rules/Azure.ADX.SLA/","title":"Use an SLA for Azure Data Explorer clusters","text":"Azure.ADX.SLAAZR-000014Error <p> Reliability  \u00b7  Data Explorer  \u00b7  Rule  \u00b7  2022_03  \u00b7  Important</p> <p>Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters.</p>","tags":["Azure.ADX.SLA","AZR-000014"]},{"location":"en/rules/Azure.ADX.SLA/#description","title":"Description","text":"<p>When choosing a SKU for an ADX cluster you should consider the SLA that is included in the SKU. ADX clusters offer a range of offerings. Development SKUs are designed for early non-production use and do not include any SLA.</p>","tags":["Azure.ADX.SLA","AZR-000014"]},{"location":"en/rules/Azure.ADX.SLA/#recommendation","title":"Recommendation","text":"<p>Consider using a production ready SKU that includes a SLA.</p>","tags":["Azure.ADX.SLA","AZR-000014"]},{"location":"en/rules/Azure.ADX.SLA/#examples","title":"Examples","text":"","tags":["Azure.ADX.SLA","AZR-000014"]},{"location":"en/rules/Azure.ADX.SLA/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy clusters that pass this rule:</p> <ul> <li>Set the <code>sku.tier</code> property to <code>Standard</code>.</li> <li>Set the <code>sku.name</code> property to non-development SKU such as <code>Standard_D11_v2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Kusto/clusters\",\n  \"apiVersion\": \"2023-08-15\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_D11_v2\",\n    \"tier\": \"Standard\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"enableDiskEncryption\": true\n  }\n}\n</code></pre>","tags":["Azure.ADX.SLA","AZR-000014"]},{"location":"en/rules/Azure.ADX.SLA/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy clusters that pass this rule:</p> <ul> <li>Set the <code>sku.tier</code> property to <code>Standard</code>.</li> <li>Set the <code>sku.name</code> property to non-development SKU such as <code>Standard_D11_v2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource adx 'Microsoft.Kusto/clusters@2023-08-15' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard_D11_v2'\n    tier: 'Standard'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    enableDiskEncryption: true\n  }\n}\n</code></pre>","tags":["Azure.ADX.SLA","AZR-000014"]},{"location":"en/rules/Azure.ADX.SLA/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Azure Data Explorer pricing</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ADX.SLA","AZR-000014"]},{"location":"en/rules/Azure.ADX.Usage/","title":"Remove unused Data Explorer clusters","text":"Azure.ADX.UsageAZR-000011Error <p> Cost Optimization  \u00b7  Data Explorer  \u00b7  Rule  \u00b7  2022_03  \u00b7  Important</p> <p>Regularly remove unused resources to reduce costs.</p>","tags":["Azure.ADX.Usage","AZR-000011"]},{"location":"en/rules/Azure.ADX.Usage/#description","title":"Description","text":"<p>Billing starts for an Azure Data Explorer (ADX) cluster after it is provisioned. To store data in an ADX cluster, you must first create a database. Clusters without any databases are considered unused and can be removed to reduce costs and management overhead.</p> <p>Additionally, ADX clusters on a paid tier can stopped. Stopping an ADX cluster de-allocates and removes compute resources. While in the stopped state, compute charges are not incurred. Any data stored in the cluster is persisted while the cluster is stopped.</p>","tags":["Azure.ADX.Usage","AZR-000011"]},{"location":"en/rules/Azure.ADX.Usage/#recommendation","title":"Recommendation","text":"<p>Consider removing Data Explorer clusters that have no databases and are not used.</p>","tags":["Azure.ADX.Usage","AZR-000011"]},{"location":"en/rules/Azure.ADX.Usage/#notes","title":"Notes","text":"<p>This rule applies when analyzing ADX clusters deployed (in-flight) and running within Azure. If the cluster is stopped, this rule is ignored.</p>","tags":["Azure.ADX.Usage","AZR-000011"]},{"location":"en/rules/Azure.ADX.Usage/#links","title":"Links","text":"<ul> <li>CO:14 Consolidation</li> <li>Design review checklist for Cost Optimization</li> <li>Pricing</li> <li>Stop and restart the cluster</li> <li>Automatic stop of inactive Azure Data Explorer clusters</li> </ul>","tags":["Azure.ADX.Usage","AZR-000011"]},{"location":"en/rules/Azure.AI.DisableLocalAuth/","title":"Azure AI account access keys are enabled","text":"Azure.AI.DisableLocalAuthAZR-000282Error <p> Security  \u00b7  Azure AI  \u00b7  Rule  \u00b7  2022_09  \u00b7  Important</p> <p>Access keys allow depersonalized access to Azure AI using a shared secret.</p>","tags":["Azure.AI.DisableLocalAuth","AZR-000282"]},{"location":"en/rules/Azure.AI.DisableLocalAuth/#description","title":"Description","text":"<p>To send requests to Azure AI service endpoints (previously known as Cognitive Services), each request must include an authentication header. Azure AI service endpoints supports authentication with keys or access tokens. Using an Entra ID access token instead of a cryptographic key has some additional security benefits.</p> <p>With Entra ID authentication, an authorized identity is issued an OAuth2 access token issued by Entra ID. Using Entra ID as the identity provider centralizes identity management and auditing.</p> <p>Once you decide to use Entra ID authentication, you can disable authentication using keys.</p>","tags":["Azure.AI.DisableLocalAuth","AZR-000282"]},{"location":"en/rules/Azure.AI.DisableLocalAuth/#recommendation","title":"Recommendation","text":"<p>Consider only using Entra ID identities to authenticate requests to Azure AI service accounts. Once configured, disable authentication based on access keys.</p>","tags":["Azure.AI.DisableLocalAuth","AZR-000282"]},{"location":"en/rules/Azure.AI.DisableLocalAuth/#examples","title":"Examples","text":"","tags":["Azure.AI.DisableLocalAuth","AZR-000282"]},{"location":"en/rules/Azure.AI.DisableLocalAuth/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy accounts that pass this rule:</p> <ul> <li>Set the <code>properties.disableLocalAuth</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.CognitiveServices/accounts\",\n  \"apiVersion\": \"2023-05-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"sku\": {\n    \"name\": \"S0\"\n  },\n  \"kind\": \"CognitiveServices\",\n  \"properties\": {\n    \"publicNetworkAccess\": \"Disabled\",\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\"\n    },\n    \"disableLocalAuth\": true\n  }\n}\n</code></pre>","tags":["Azure.AI.DisableLocalAuth","AZR-000282"]},{"location":"en/rules/Azure.AI.DisableLocalAuth/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy accounts that pass this rule:</p> <ul> <li>Set the <code>properties.disableLocalAuth</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource account 'Microsoft.CognitiveServices/accounts@2023-05-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'S0'\n  }\n  kind: 'CognitiveServices'\n  properties: {\n    publicNetworkAccess: 'Disabled'\n    networkAcls: {\n      defaultAction: 'Deny'\n    }\n    disableLocalAuth: true\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/cognitive-services/account:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/cognitive-services/account:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AI.DisableLocalAuth","AZR-000282"]},{"location":"en/rules/Azure.AI.DisableLocalAuth/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Azure AI Services resources should have key access disabled (disable local authentication) <code>/providers/Microsoft.Authorization/policyDefinitions/71ef260a-8f18-47b7-abcb-62d0673d94dc</code></li> <li>Configure Cognitive Services accounts to disable local authentication methods <code>/providers/Microsoft.Authorization/policyDefinitions/14de9e63-1b31-492e-a5a3-c3f7fd57f555</code></li> </ul>","tags":["Azure.AI.DisableLocalAuth","AZR-000282"]},{"location":"en/rules/Azure.AI.DisableLocalAuth/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>IM-1: Use centralized identity and authentication system</li> <li>Authenticate with Microsoft Entra ID</li> <li>Azure Policy built-in policy definitions for Azure AI services</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AI.DisableLocalAuth","AZR-000282"]},{"location":"en/rules/Azure.AI.ManagedIdentity/","title":"Use Managed Identity for Azure AI services accounts","text":"Azure.AI.ManagedIdentityAZR-000281Error <p> Security  \u00b7  Azure AI  \u00b7  Rule  \u00b7  2022_09  \u00b7  Important</p> <p>Configure managed identities to access Azure resources.</p>","tags":["Azure.AI.ManagedIdentity","AZR-000281"]},{"location":"en/rules/Azure.AI.ManagedIdentity/#description","title":"Description","text":"<p>Azure AI services (previously known as Cognitive Services) must authenticate to Azure resources such storage accounts. To authenticate to Azure resources, Azure AI can use managed identities.</p> <p>Using Azure managed identities have the following benefits:</p> <ul> <li>You don't need to store or manage credentials.   Azure automatically generates tokens and performs rotation.</li> <li>You can use managed identities to authenticate to any Azure service that supports Entra ID (previously Azure AD) authentication.</li> <li>Managed identities can be used without any additional cost.</li> </ul>","tags":["Azure.AI.ManagedIdentity","AZR-000281"]},{"location":"en/rules/Azure.AI.ManagedIdentity/#recommendation","title":"Recommendation","text":"<p>Consider configuring a managed identity for each Azure AI services account.</p>","tags":["Azure.AI.ManagedIdentity","AZR-000281"]},{"location":"en/rules/Azure.AI.ManagedIdentity/#examples","title":"Examples","text":"","tags":["Azure.AI.ManagedIdentity","AZR-000281"]},{"location":"en/rules/Azure.AI.ManagedIdentity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy accounts that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.CognitiveServices/accounts\",\n  \"apiVersion\": \"2023-05-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"sku\": {\n    \"name\": \"S0\"\n  },\n  \"kind\": \"TextAnalytics\",\n  \"properties\": {\n    \"publicNetworkAccess\": \"Disabled\",\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\"\n    },\n    \"disableLocalAuth\": true\n  }\n}\n</code></pre>","tags":["Azure.AI.ManagedIdentity","AZR-000281"]},{"location":"en/rules/Azure.AI.ManagedIdentity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy accounts that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource language 'Microsoft.CognitiveServices/accounts@2023-05-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'S0'\n  }\n  kind: 'TextAnalytics'\n  properties: {\n    publicNetworkAccess: 'Disabled'\n    networkAcls: {\n      defaultAction: 'Deny'\n    }\n    disableLocalAuth: true\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/cognitive-services/account:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/cognitive-services/account:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AI.ManagedIdentity","AZR-000281"]},{"location":"en/rules/Azure.AI.ManagedIdentity/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Cognitive Services accounts should use a managed identity <code>/providers/Microsoft.Authorization/policyDefinitions/fe3fd216-4f83-4fc1-8984-2bbec80a3418</code>.</li> </ul>","tags":["Azure.AI.ManagedIdentity","AZR-000281"]},{"location":"en/rules/Azure.AI.ManagedIdentity/#notes","title":"Notes","text":"<p>Configuration of additional Azure resources is not required for all Azure AI services. This rule will run for the following Azure AI services:</p> <ul> <li><code>TextAnalytics</code> - Language service.</li> </ul>","tags":["Azure.AI.ManagedIdentity","AZR-000281"]},{"location":"en/rules/Azure.AI.ManagedIdentity/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Azure Policy built-in policy definitions for Azure AI services</li> <li>IM-1: Use centralized identity and authentication system</li> <li>IM-3: Manage application identities securely and automatically</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AI.ManagedIdentity","AZR-000281"]},{"location":"en/rules/Azure.AI.PrivateEndpoints/","title":"Use Azure AI services Private Endpoints","text":"Azure.AI.PrivateEndpointsAZR-000283Error <p> Security  \u00b7  Azure AI  \u00b7  Rule  \u00b7  2022_09  \u00b7  Important</p> <p>Use Private Endpoints to access Azure AI services accounts.</p>","tags":["Azure.AI.PrivateEndpoints","AZR-000283"]},{"location":"en/rules/Azure.AI.PrivateEndpoints/#description","title":"Description","text":"<p>By default, a public endpoint is enabled for Azure AI services accounts (previously known as Cognitive Services). The public endpoint is used for all access except for requests that use a Private Endpoint. Access through the public endpoint can be disabled or restricted to authorized virtual networks.</p> <p>Data exfiltration is an attack where an malicious actor does an unauthorized data transfer. Private Endpoints help prevent data exfiltration by an internal or external malicious actor. They do this by providing clear separation between public and private endpoints. As a result, broad access to public endpoints which could be operated by a malicious actor is not required.</p>","tags":["Azure.AI.PrivateEndpoints","AZR-000283"]},{"location":"en/rules/Azure.AI.PrivateEndpoints/#recommendation","title":"Recommendation","text":"<p>Consider accessing Azure AI services accounts by Private Endpoints and disabling public endpoints.</p>","tags":["Azure.AI.PrivateEndpoints","AZR-000283"]},{"location":"en/rules/Azure.AI.PrivateEndpoints/#examples","title":"Examples","text":"","tags":["Azure.AI.PrivateEndpoints","AZR-000283"]},{"location":"en/rules/Azure.AI.PrivateEndpoints/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy accounts that pass this rule:</p> <ul> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.CognitiveServices/accounts\",\n  \"apiVersion\": \"2023-05-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"sku\": {\n    \"name\": \"S0\"\n  },\n  \"kind\": \"CognitiveServices\",\n  \"properties\": {\n    \"publicNetworkAccess\": \"Disabled\",\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\"\n    },\n    \"disableLocalAuth\": true\n  }\n}\n</code></pre>","tags":["Azure.AI.PrivateEndpoints","AZR-000283"]},{"location":"en/rules/Azure.AI.PrivateEndpoints/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy accounts that pass this rule:</p> <ul> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource account 'Microsoft.CognitiveServices/accounts@2023-05-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'S0'\n  }\n  kind: 'CognitiveServices'\n  properties: {\n    publicNetworkAccess: 'Disabled'\n    networkAcls: {\n      defaultAction: 'Deny'\n    }\n    disableLocalAuth: true\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/cognitive-services/account:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/cognitive-services/account:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AI.PrivateEndpoints","AZR-000283"]},{"location":"en/rules/Azure.AI.PrivateEndpoints/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Configure Azure AI services virtual networks</li> <li>Azure Policy built-in policy definitions for Azure AI services</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AI.PrivateEndpoints","AZR-000283"]},{"location":"en/rules/Azure.AI.PublicAccess/","title":"Restrict Azure AI service endpoints","text":"Azure.AI.PublicAccessAZR-000280Error <p> Security  \u00b7  Azure AI  \u00b7  Rule  \u00b7  2022_09  \u00b7  Important</p> <p>Restrict access of Azure AI services to authorized virtual networks.</p>","tags":["Azure.AI.PublicAccess","AZR-000280"]},{"location":"en/rules/Azure.AI.PublicAccess/#description","title":"Description","text":"<p>By default, public network access is enabled for a Azure AI service accounts (previously known as Cognitive Services). Service Endpoints and Private Link can be leveraged to restrict access to PaaS endpoints. When access is restricted, access by malicious actor is from an unauthorized virtual network is mitigated.</p> <p>Configure service endpoints and private links where appropriate.</p>","tags":["Azure.AI.PublicAccess","AZR-000280"]},{"location":"en/rules/Azure.AI.PublicAccess/#recommendation","title":"Recommendation","text":"<p>Consider configuring network access restrictions for Azure AI service accounts. Limit access to accounts so that access is permitted from authorized virtual networks only.</p>","tags":["Azure.AI.PublicAccess","AZR-000280"]},{"location":"en/rules/Azure.AI.PublicAccess/#examples","title":"Examples","text":"","tags":["Azure.AI.PublicAccess","AZR-000280"]},{"location":"en/rules/Azure.AI.PublicAccess/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy accounts that pass this rule:</p> <ul> <li>Set the <code>properties.networkAcls.defaultAction</code> property to <code>Deny</code>, or</li> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.CognitiveServices/accounts\",\n  \"apiVersion\": \"2023-05-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"sku\": {\n    \"name\": \"S0\"\n  },\n  \"kind\": \"CognitiveServices\",\n  \"properties\": {\n    \"publicNetworkAccess\": \"Disabled\",\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\"\n    },\n    \"disableLocalAuth\": true\n  }\n}\n</code></pre>","tags":["Azure.AI.PublicAccess","AZR-000280"]},{"location":"en/rules/Azure.AI.PublicAccess/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy accounts that pass this rule:</p> <ul> <li>Set the <code>properties.networkAcls.defaultAction</code> property to <code>Deny</code>, or</li> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource account 'Microsoft.CognitiveServices/accounts@2023-05-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'S0'\n  }\n  kind: 'CognitiveServices'\n  properties: {\n    publicNetworkAccess: 'Disabled'\n    networkAcls: {\n      defaultAction: 'Deny'\n    }\n    disableLocalAuth: true\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/cognitive-services/account:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/cognitive-services/account:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AI.PublicAccess","AZR-000280"]},{"location":"en/rules/Azure.AI.PublicAccess/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Configure Azure AI services virtual networks</li> <li>Azure Policy built-in policy definitions for Azure AI services</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AI.PublicAccess","AZR-000280"]},{"location":"en/rules/Azure.AKS.AuditAdmin/","title":"kube-audit-admin","text":"Azure.AKS.AuditAdminAZR-000445Error <p> Cost Optimization  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2024_09  \u00b7  Important</p> <p>Use kube-audit-admin instead of kube-audit to capture administrative actions in AKS clusters.</p>","tags":["Azure.AKS.AuditAdmin","AZR-000445"]},{"location":"en/rules/Azure.AKS.AuditAdmin/#description","title":"Description","text":"<p>Key components in a Kubernetes cluster regularly scan or check for updated Kubernetes resources against the API server. These get and list operations typically occur more frequently as a Kubernetes cluster grows.</p> <p>Auditing within AKS writes log events for each operation that occur against the API server. As a result, collecting audit logs for get and list operations of a production AKS cluster can increase cost exponentially.</p> <p>AKS provides two log categories for collecting audit logs, <code>kube-audit</code> and <code>kube-audit-admin</code>.</p> <ul> <li><code>kube-audit</code> - Audit log data for every audit event including get, list, create, update, delete, patch, and post.</li> <li><code>kube-audit-admin</code> - Is a subset of the <code>kube-audit</code> log category that excludes get and list audit events.</li> </ul> <p>In other words, both <code>kube-audit</code> and <code>kube-audit-admin</code> contain the same data except <code>kube-audit-admin</code> does not contain get and list events. Changes to the cluster configuration are captured with create, update, delete, patch, and post events.</p> <p>By using <code>kube-audit-admin</code>, changes to resources in AKS are audited, however events relating to reading resources and configuration are not. This significantly reduces the number of logs and overall cost for collecting and storing AKS audit events.</p>","tags":["Azure.AKS.AuditAdmin","AZR-000445"]},{"location":"en/rules/Azure.AKS.AuditAdmin/#recommendation","title":"Recommendation","text":"<p>Consider using kube-audit-admin logging instead of kube-audit when detailed logging of every API request is not required. This approach helps in managing log volume and associated costs while still capturing essential administrative actions.</p>","tags":["Azure.AKS.AuditAdmin","AZR-000445"]},{"location":"en/rules/Azure.AKS.AuditAdmin/#examples","title":"Examples","text":"","tags":["Azure.AKS.AuditAdmin","AZR-000445"]},{"location":"en/rules/Azure.AKS.AuditAdmin/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource.</li> <li>Enable logging for the <code>kube-audit-admin</code> category and disable logging for the <code>kube-audit</code> category.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Insights/diagnosticSettings\",\n  \"apiVersion\": \"2021-05-01-preview\",\n  \"scope\": \"[format('Microsoft.ContainerService/managedClusters/{0}', parameters('clusterName'))]\",\n  \"name\": \"[parameters('name')]\",\n  \"properties\": {\n    \"logs\": [\n      {\n        \"category\": \"kube-audit-admin\",\n        \"enabled\": true,\n        \"retentionPolicy\": {\n          \"days\": 0,\n          \"enabled\": false\n        }\n      },\n      {\n        \"category\": \"kube-audit\",\n        \"enabled\": false,\n        \"retentionPolicy\": {\n          \"days\": 0,\n          \"enabled\": false\n        }\n      }\n    ],\n    \"workspaceId\": \"[parameters('workspaceId')]\",\n    \"logAnalyticsDestinationType\": \"Dedicated\"\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ContainerService/managedClusters', parameters('clusterName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.AuditAdmin","AZR-000445"]},{"location":"en/rules/Azure.AKS.AuditAdmin/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource.</li> <li>Enable logging for the <code>kube-audit-admin</code> category and disable logging for the <code>kube-audit</code> category.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource diagnosticSetting 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  name: name\n  scope: aks\n  properties: {\n    logs: [\n      {\n        category: 'kube-audit-admin'\n        enabled: true\n        retentionPolicy: {\n          days: 0\n          enabled: false\n        }\n      }\n      {\n        category: 'kube-audit'\n        enabled: false\n        retentionPolicy: {\n          days: 0\n          enabled: false\n        }\n      }\n    ]\n    workspaceId: workspaceId\n    logAnalyticsDestinationType: 'Dedicated'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:0.5.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AKS.AuditAdmin","AZR-000445"]},{"location":"en/rules/Azure.AKS.AuditAdmin/#links","title":"Links","text":"<ul> <li>CO:07 Component costs</li> <li>Monitoring AKS data reference</li> <li>AKS control plane/resource logs</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.AuditAdmin","AZR-000445"]},{"location":"en/rules/Azure.AKS.AuditLogs/","title":"AKS clusters should collect security-based audit logs","text":"Azure.AKS.AuditLogsAZR-000022Error <p> Security  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2021_09  \u00b7  Important</p> <p>AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads.</p>","tags":["Azure.AKS.AuditLogs","AZR-000022"]},{"location":"en/rules/Azure.AKS.AuditLogs/#description","title":"Description","text":"<p>The Azure Kubernetes Service (AKS) service supports collection of security-based audit logs from clusters. The following log categories are available:</p> <ul> <li><code>kube-audit</code> - Audit log data for every audit event including get, list, create, update, delete, patch, and post.</li> <li><code>kube-audit-admin</code> - Is a subset of the <code>kube-audit</code> log category that excludes get and list audit events.</li> <li><code>guard</code> - Contains logs for Entra ID and Azure RBAC events.</li> </ul> <p>In other words, both <code>kube-audit</code> and <code>kube-audit-admin</code> contain the same data except <code>kube-audit-admin</code> does not contain get and list events.</p> <p>For most configurations, consider enabling logging for <code>kube-audit-admin</code> and <code>guard</code>. This configuration provides good coverage and significantly reduces the number of logs and overall cost for collecting and storing AKS audit events. Enable <code>kube-audit</code> only when required.</p>","tags":["Azure.AKS.AuditLogs","AZR-000022"]},{"location":"en/rules/Azure.AKS.AuditLogs/#recommendation","title":"Recommendation","text":"<p>Consider configuring diagnostic settings to capture security-based audit logs from AKS clusters.</p>","tags":["Azure.AKS.AuditLogs","AZR-000022"]},{"location":"en/rules/Azure.AKS.AuditLogs/#examples","title":"Examples","text":"","tags":["Azure.AKS.AuditLogs","AZR-000022"]},{"location":"en/rules/Azure.AKS.AuditLogs/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource.</li> <li>Enable logging for <code>kube-audit-admin</code> (or <code>kube-audit</code>) and <code>guard</code> log categories.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Insights/diagnosticSettings\",\n  \"apiVersion\": \"2021-05-01-preview\",\n  \"scope\": \"[format('Microsoft.ContainerService/managedClusters/{0}', parameters('name'))]\",\n  \"name\": \"audit\",\n  \"properties\": {\n    \"logs\": [\n      {\n        \"category\": \"kube-audit-admin\",\n        \"enabled\": true,\n        \"retentionPolicy\": {\n          \"days\": 0,\n          \"enabled\": false\n        }\n      },\n      {\n        \"category\": \"guard\",\n        \"enabled\": true,\n        \"retentionPolicy\": {\n          \"days\": 0,\n          \"enabled\": false\n        }\n      }\n    ],\n    \"workspaceId\": \"[parameters('workspaceId')]\",\n    \"logAnalyticsDestinationType\": \"Dedicated\"\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ContainerService/managedClusters', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.AuditLogs","AZR-000022"]},{"location":"en/rules/Azure.AKS.AuditLogs/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource.</li> <li>Enable logging for <code>kube-audit-admin</code> (or <code>kube-audit</code>) and <code>guard</code> log categories.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource auditLogs 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  name: 'audit'\n  scope: cluster\n  properties: {\n    logs: [\n      {\n        category: 'kube-audit-admin'\n        enabled: true\n        retentionPolicy: {\n          days: 0\n          enabled: false\n        }\n      }\n      {\n        category: 'guard'\n        enabled: true\n        retentionPolicy: {\n          days: 0\n          enabled: false\n        }\n      }\n    ]\n    workspaceId: workspaceId\n    logAnalyticsDestinationType: 'Dedicated'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:0.5.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AKS.AuditLogs","AZR-000022"]},{"location":"en/rules/Azure.AKS.AuditLogs/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>Monitoring AKS data reference</li> <li>AKS control plane/resource logs</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.AuditLogs","AZR-000022"]},{"location":"en/rules/Azure.AKS.AuthorizedIPs/","title":"Restrict access to AKS API server endpoints","text":"Azure.AKS.AuthorizedIPsAZR-000030Error <p> Security  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2021_06  \u00b7  Important</p> <p>Restrict access to API server endpoints to authorized IP addresses.</p>","tags":["Azure.AKS.AuthorizedIPs","AZR-000030"]},{"location":"en/rules/Azure.AKS.AuthorizedIPs/#description","title":"Description","text":"<p>In Kubernetes, the API server is the control plane of the cluster. Access to the API server is required by various cluster functions as well as all administrator activities.</p> <p>All activities performed against the cluster require authorization. To improve cluster security, the API server can be restricted to a limited set of IP address ranges.</p> <p>Restricting authorized IP addresses for the API server has the following limitations:</p> <ul> <li>Requires AKS clusters configured with a Standard Load Balancer SKU.</li> <li>This feature is not compatible with clusters that use Public IP per Node.</li> <li>This feature is not compatible with AKS private clusters.</li> </ul> <p>When configuring this feature, you must specify the IP address ranges that will be authorized. To allow only the outbound public IP of the Standard SKU load balancer, use <code>0.0.0.0/32</code>.</p> <p>You should add these ranges to the allow list:</p> <ul> <li>Include output IP addresses for cluster nodes</li> <li>Any range where administration will connect to the API server, including CI/CD systems, monitoring, and management systems.</li> </ul>","tags":["Azure.AKS.AuthorizedIPs","AZR-000030"]},{"location":"en/rules/Azure.AKS.AuthorizedIPs/#recommendation","title":"Recommendation","text":"<p>Consider restricting network traffic to the API server endpoints to trusted IP addresses.</p>","tags":["Azure.AKS.AuthorizedIPs","AZR-000030"]},{"location":"en/rules/Azure.AKS.AuthorizedIPs/#examples","title":"Examples","text":"","tags":["Azure.AKS.AuthorizedIPs","AZR-000030"]},{"location":"en/rules/Azure.AKS.AuthorizedIPs/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy clusters that pass this rule:</p> <ul> <li>Set the <code>properties.apiServerAccessProfile.authorizedIPRanges</code> property to a list of authorized IP ranges.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2023-11-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"UserAssigned\",\n    \"userAssignedIdentities\": {\n      \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n    }\n  },\n  \"properties\": {\n    \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n    \"disableLocalAccounts\": true,\n    \"enableRBAC\": true,\n    \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n    \"agentPoolProfiles\": \"[variables('allPools')]\",\n    \"aadProfile\": {\n      \"managed\": true,\n      \"enableAzureRBAC\": true,\n      \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n      \"tenantID\": \"[subscription().tenantId]\"\n    },\n    \"networkProfile\": {\n      \"networkPlugin\": \"azure\",\n      \"networkPolicy\": \"azure\",\n      \"loadBalancerSku\": \"standard\",\n      \"serviceCidr\": \"[variables('serviceCidr')]\",\n      \"dnsServiceIP\": \"[variables('dnsServiceIP')]\"\n    },\n    \"apiServerAccessProfile\": {\n      \"authorizedIPRanges\": [\n        \"0.0.0.0/32\"\n      ]\n    },\n    \"autoUpgradeProfile\": {\n      \"upgradeChannel\": \"stable\"\n    },\n    \"oidcIssuerProfile\": {\n      \"enabled\": true\n    },\n    \"addonProfiles\": {\n      \"azurepolicy\": {\n        \"enabled\": true\n      },\n      \"omsagent\": {\n        \"enabled\": true,\n        \"config\": {\n          \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n        }\n      },\n      \"azureKeyvaultSecretsProvider\": {\n        \"enabled\": true,\n        \"config\": {\n          \"enableSecretRotation\": \"true\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.AuthorizedIPs","AZR-000030"]},{"location":"en/rules/Azure.AKS.AuthorizedIPs/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy resource that pass this rule:</p> <ul> <li>Set the <code>properties.apiServerAccessProfile.authorizedIPRanges</code> property to a list of authorized IP ranges.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cluster 'Microsoft.ContainerService/managedClusters@2023-11-01' = {\n  location: location\n  name: name\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    disableLocalAccounts: true\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: allPools\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n    }\n    apiServerAccessProfile: {\n      authorizedIPRanges: [\n        '0.0.0.0/32'\n      ]\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    oidcIssuerProfile: {\n      enabled: true\n    }\n    addonProfiles: {\n      azurepolicy: {\n        enabled: true\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.AKS.AuthorizedIPs","AZR-000030"]},{"location":"en/rules/Azure.AKS.AuthorizedIPs/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az aks update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --api-server-authorized-ip-ranges '0.0.0.0/32'\n</code></pre>","tags":["Azure.AKS.AuthorizedIPs","AZR-000030"]},{"location":"en/rules/Azure.AKS.AuthorizedIPs/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Set-AzAksCluster -Name '&lt;name&gt;' -ResourceGroupName '&lt;resource_group&gt;' -ApiServerAccessAuthorizedIpRange '0.0.0.0/32'\n</code></pre>","tags":["Azure.AKS.AuthorizedIPs","AZR-000030"]},{"location":"en/rules/Azure.AKS.AuthorizedIPs/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Secure access to the API server using authorized IP address ranges in Azure Kubernetes Service (AKS)</li> <li>Best practices for cluster security and upgrades in Azure Kubernetes Service (AKS)</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.AuthorizedIPs","AZR-000030"]},{"location":"en/rules/Azure.AKS.AutoScaling/","title":"Enable AKS cluster autoscaler","text":"Azure.AKS.AutoScalingAZR-000019Error <p> Performance Efficiency  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2021_09  \u00b7  Important</p> <p>Use autoscaling to scale clusters based on workload requirements.</p>","tags":["Azure.AKS.AutoScaling","AZR-000019"]},{"location":"en/rules/Azure.AKS.AutoScaling/#description","title":"Description","text":"<p>In addition to perform manual scaling, AKS clusters support autoscaling. Autoscaling reduces manual intervention required to scale a cluster up/ down to keep up with changing workload requirements. Scaling is performed on a node pool, which is a group of nodes with the same configuration within a cluster.</p> <p>Within AKS, the cluster autoscaler monitors pods and nodes in the cluster. When a pod cannot be scheduled due to resource constraints, the cluster autoscaler increases the number of nodes in the node pool. When a node is underutilized, the cluster autoscaler removes the node from the node pool. Scaling is performed within the range of <code>minCount</code> and <code>maxCount</code> properties set on the node pool.</p> <p>In addition to performance efficiency, autoscaling can also help reduce costs when the cluster is underutilized enough to reduce the number of nodes.</p> <p>When scaling an AKS cluster manually or with auto-scale, consider the following:</p> <ul> <li>When you are using Azure CNI, ensure that there is enough IP address space in the node pool subnet.   The node pools subnet should have enough IP address space to accommodate the <code>maxCount</code> nodes and nodes added during upgrades.</li> <li>Plan for the cost of running the cluster nodes between <code>minCount</code> and <code>maxCount</code> nodes.</li> </ul>","tags":["Azure.AKS.AutoScaling","AZR-000019"]},{"location":"en/rules/Azure.AKS.AutoScaling/#recommendation","title":"Recommendation","text":"<p>Consider deploying AKS clusters with virtual machine scale sets node pools and enable autoscaling.</p>","tags":["Azure.AKS.AutoScaling","AZR-000019"]},{"location":"en/rules/Azure.AKS.AutoScaling/#examples","title":"Examples","text":"","tags":["Azure.AKS.AutoScaling","AZR-000019"]},{"location":"en/rules/Azure.AKS.AutoScaling/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set the <code>properties.agentPoolProfiles[*].enableAutoScaling</code> property to <code>true</code>.</li> <li>Set the <code>properties.agentPoolProfiles[*].type</code> property to <code>VirtualMachineScaleSets</code>.</li> <li>Set the <code>properties.agentPoolProfiles[*].minCount</code> and <code>properties.agentPoolProfiles[*].maxCount</code> properties.   The cluster autoscaler will adjust the number of nodes between (inclusive of) these values.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2023-11-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"UserAssigned\",\n    \"userAssignedIdentities\": {\n      \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n    }\n  },\n  \"properties\": {\n    \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n    \"disableLocalAccounts\": true,\n    \"enableRBAC\": true,\n    \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n    \"agentPoolProfiles\": [\n      {\n        \"name\": \"system\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 5,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"System\",\n        \"osDiskType\": \"Ephemeral\"\n      },\n      {\n        \"name\": \"user\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 20,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"User\",\n        \"osDiskType\": \"Ephemeral\"\n      }\n    ],\n    \"aadProfile\": {\n      \"managed\": true,\n      \"enableAzureRBAC\": true,\n      \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n      \"tenantID\": \"[subscription().tenantId]\"\n    },\n    \"networkProfile\": {\n      \"networkPlugin\": \"azure\",\n      \"networkPolicy\": \"azure\",\n      \"loadBalancerSku\": \"standard\",\n      \"serviceCidr\": \"[variables('serviceCidr')]\",\n      \"dnsServiceIP\": \"[variables('dnsServiceIP')]\"\n    },\n    \"apiServerAccessProfile\": {\n      \"authorizedIPRanges\": [\n        \"0.0.0.0/32\"\n      ]\n    },\n    \"autoUpgradeProfile\": {\n      \"upgradeChannel\": \"stable\"\n    },\n    \"oidcIssuerProfile\": {\n      \"enabled\": true\n    },\n    \"addonProfiles\": {\n      \"azurepolicy\": {\n        \"enabled\": true\n      },\n      \"omsagent\": {\n        \"enabled\": true,\n        \"config\": {\n          \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n        }\n      },\n      \"azureKeyvaultSecretsProvider\": {\n        \"enabled\": true,\n        \"config\": {\n          \"enableSecretRotation\": \"true\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.AutoScaling","AZR-000019"]},{"location":"en/rules/Azure.AKS.AutoScaling/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set the <code>properties.agentPoolProfiles[*].enableAutoScaling</code> property to <code>true</code>.</li> <li>Set the <code>properties.agentPoolProfiles[*].type</code> property to <code>VirtualMachineScaleSets</code>.</li> <li>Set the <code>properties.agentPoolProfiles[*].minCount</code> and <code>properties.agentPoolProfiles[*].maxCount</code> properties.   The cluster autoscaler will adjust the number of nodes between (inclusive of) these values.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource clusterWithPools 'Microsoft.ContainerService/managedClusters@2023-11-01' = {\n  location: location\n  name: name\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    disableLocalAccounts: true\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: [\n      {\n        name: 'system'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 5\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'System'\n        osDiskType: 'Ephemeral'\n      }\n      {\n        name: 'user'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 20\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'User'\n        osDiskType: 'Ephemeral'\n      }\n    ]\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n    }\n    apiServerAccessProfile: {\n      authorizedIPRanges: [\n        '0.0.0.0/32'\n      ]\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    oidcIssuerProfile: {\n      enabled: true\n    }\n    addonProfiles: {\n      azurepolicy: {\n        enabled: true\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.AKS.AutoScaling","AZR-000019"]},{"location":"en/rules/Azure.AKS.AutoScaling/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"","tags":["Azure.AKS.AutoScaling","AZR-000019"]},{"location":"en/rules/Azure.AKS.AutoScaling/#enable-cluster-autoscaler","title":"Enable cluster autoscaler","text":"Azure CLI snippet<pre><code>az aks update \\\n  --name '&lt;name&gt;' \\\n  --resource-group '&lt;resource_group&gt;' \\\n  --enable-cluster-autoscaler \\\n  --min-count '&lt;min_count&gt;' \\\n  --max-count '&lt;max_count&gt;'\n</code></pre>","tags":["Azure.AKS.AutoScaling","AZR-000019"]},{"location":"en/rules/Azure.AKS.AutoScaling/#enable-cluster-nodepool-autoscaler","title":"Enable cluster nodepool autoscaler","text":"Azure CLI snippet<pre><code>az aks nodepool update \\\n  --name '&lt;name&gt;' \\\n  --resource-group '&lt;resource_group&gt;' \\\n  --cluster-name '&lt;cluster_name&gt;' \\\n  --enable-cluster-autoscaler \\\n  --min-count '&lt;min_count&gt;' \\\n  --max-count '&lt;max_count&gt;'\n</code></pre>","tags":["Azure.AKS.AutoScaling","AZR-000019"]},{"location":"en/rules/Azure.AKS.AutoScaling/#links","title":"Links","text":"<ul> <li>PE:05 Scaling and partitioning</li> <li>Autoscaling</li> <li>Use the cluster autoscaler in Azure Kubernetes Service (AKS)</li> <li>Scaling options for applications in Azure Kubernetes Service (AKS)</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.AutoScaling","AZR-000019"]},{"location":"en/rules/Azure.AKS.AutoUpgrade/","title":"Set AKS auto-upgrade channel","text":"Azure.AKS.AutoUpgradeAZR-000036Error <p> Operational Excellence  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2021_12  \u00b7  Important</p> <p>Configure AKS to automatically upgrade to newer supported AKS versions as they are made available.</p>","tags":["Azure.AKS.AutoUpgrade","AZR-000036"]},{"location":"en/rules/Azure.AKS.AutoUpgrade/#description","title":"Description","text":"<p>In additional to performing manual upgrades, AKS supports auto-upgrades. Auto-upgrades reduces manual intervention required to maintain an AKS cluster.</p> <p>To configure auto-upgrades select a release channel instead of the default <code>none</code>. The following release channels are available:</p> <ul> <li><code>none</code> - Disables auto-upgrades.   The default setting.</li> <li><code>patch</code> - Automatically upgrade to the latest supported patch version of the current minor version.</li> <li><code>stable</code> - Automatically upgrade to the latest supported patch release of the recommended minor version.   This is N-1 of the current AKS non-preview minor version.</li> <li><code>rapid</code> - Automatically upgrade to the latest supported patch of the latest support minor version.</li> <li><code>node-image</code> - Automatically upgrade to the latest node image version.   Normally upgraded weekly.</li> </ul>","tags":["Azure.AKS.AutoUpgrade","AZR-000036"]},{"location":"en/rules/Azure.AKS.AutoUpgrade/#recommendation","title":"Recommendation","text":"<p>Consider enabling auto-upgrades for AKS clusters by setting an auto-upgrade channel.</p>","tags":["Azure.AKS.AutoUpgrade","AZR-000036"]},{"location":"en/rules/Azure.AKS.AutoUpgrade/#examples","title":"Examples","text":"","tags":["Azure.AKS.AutoUpgrade","AZR-000036"]},{"location":"en/rules/Azure.AKS.AutoUpgrade/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>properties.autoUpgradeProfile.upgradeChannel</code> to an upgrade channel such as <code>stable</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2024-02-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"UserAssigned\",\n    \"userAssignedIdentities\": {\n      \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n    }\n  },\n  \"properties\": {\n    \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n    \"disableLocalAccounts\": true,\n    \"enableRBAC\": true,\n    \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n    \"agentPoolProfiles\": \"[variables('allPools')]\",\n    \"aadProfile\": {\n      \"managed\": true,\n      \"enableAzureRBAC\": true,\n      \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n      \"tenantID\": \"[subscription().tenantId]\"\n    },\n    \"networkProfile\": {\n      \"networkPlugin\": \"azure\",\n      \"networkPolicy\": \"azure\",\n      \"loadBalancerSku\": \"standard\",\n      \"serviceCidr\": \"[variables('serviceCidr')]\",\n      \"dnsServiceIP\": \"[variables('dnsServiceIP')]\"\n    },\n    \"apiServerAccessProfile\": {\n      \"authorizedIPRanges\": [\n        \"0.0.0.0/32\"\n      ]\n    },\n    \"autoUpgradeProfile\": {\n      \"upgradeChannel\": \"stable\"\n    },\n    \"oidcIssuerProfile\": {\n      \"enabled\": true\n    },\n    \"addonProfiles\": {\n      \"azurepolicy\": {\n        \"enabled\": true\n      },\n      \"omsagent\": {\n        \"enabled\": true,\n        \"config\": {\n          \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n        }\n      },\n      \"azureKeyvaultSecretsProvider\": {\n        \"enabled\": true,\n        \"config\": {\n          \"enableSecretRotation\": \"true\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.AutoUpgrade","AZR-000036"]},{"location":"en/rules/Azure.AKS.AutoUpgrade/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>properties.autoUpgradeProfile.upgradeChannel</code> to an upgrade channel such as <code>stable</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cluster 'Microsoft.ContainerService/managedClusters@2024-02-01' = {\n  location: location\n  name: name\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    disableLocalAccounts: true\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: allPools\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n    }\n    apiServerAccessProfile: {\n      authorizedIPRanges: [\n        '0.0.0.0/32'\n      ]\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    oidcIssuerProfile: {\n      enabled: true\n    }\n    addonProfiles: {\n      azurepolicy: {\n        enabled: true\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:0.5.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AKS.AutoUpgrade","AZR-000036"]},{"location":"en/rules/Azure.AKS.AutoUpgrade/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az aks update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --auto-upgrade-channel 'stable'\n</code></pre>","tags":["Azure.AKS.AutoUpgrade","AZR-000036"]},{"location":"en/rules/Azure.AKS.AutoUpgrade/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Azure Kubernetes Service Clusters should enable cluster auto-upgrade <code>/providers/Microsoft.Authorization/policyDefinitions/5c345cdf-2049-47e0-b8fe-b0e96bc2df35</code></li> </ul>","tags":["Azure.AKS.AutoUpgrade","AZR-000036"]},{"location":"en/rules/Azure.AKS.AutoUpgrade/#links","title":"Links","text":"<ul> <li>OE:09 Task automation</li> <li>Supported Kubernetes versions in Azure Kubernetes Service</li> <li>Support policies for Azure Kubernetes Service</li> <li>Automatically upgrade an Azure Kubernetes Service (AKS) cluster</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.AutoUpgrade","AZR-000036"]},{"location":"en/rules/Azure.AKS.AvailabilityZone/","title":"AKS clusters should use Availability zones in supported regions","text":"Azure.AKS.AvailabilityZoneAZR-000021Error <p> Reliability  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2021_09  \u00b7  Important</p> <p>AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability.</p>","tags":["Azure.AKS.AvailabilityZone","AZR-000021"]},{"location":"en/rules/Azure.AKS.AvailabilityZone/#description","title":"Description","text":"<p>AKS clusters using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. Nodes in one availability zone are physically separated from nodes defined in another availability zone. By spreading node pools across multiple zones, nodes in one node pool will continue running even if another zone has gone down.</p>","tags":["Azure.AKS.AvailabilityZone","AZR-000021"]},{"location":"en/rules/Azure.AKS.AvailabilityZone/#recommendation","title":"Recommendation","text":"<p>Consider using availability zones for AKS clusters deployed with virtual machine scale sets.</p>","tags":["Azure.AKS.AvailabilityZone","AZR-000021"]},{"location":"en/rules/Azure.AKS.AvailabilityZone/#notes","title":"Notes","text":"<p>This rule applies when analyzing resources deployed to Azure using pre-flight and in-flight data.</p> <p>This rule fails when <code>\"availabilityZones\"</code> is <code>null</code>, <code>[]</code> or not set when the AKS cluster is deployed to a virtual machine scale set and there are supported availability zones for the given region.</p> <p>Configure <code>AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST</code> to set additional availability zones that need to be supported which are not in the existing providers for namespace <code>Microsoft.Compute</code> and resource type <code>virtualMachineScaleSets</code>.</p> <pre><code># YAML: The default AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option\nconfiguration:\n  AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST: []\n</code></pre>","tags":["Azure.AKS.AvailabilityZone","AZR-000021"]},{"location":"en/rules/Azure.AKS.AvailabilityZone/#examples","title":"Examples","text":"","tags":["Azure.AKS.AvailabilityZone","AZR-000021"]},{"location":"en/rules/Azure.AKS.AvailabilityZone/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To set availability zones for an AKS cluster:</p> <ul> <li>Set <code>properties.agentPoolProfiles[*].availabilityZones</code> to any or all of <code>[\"1\", \"2\", \"3\"]</code>.</li> <li>Set <code>properties.agentPoolProfiles[*].type</code> to <code>VirtualMachineScaleSets</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"comments\": \"Azure Kubernetes Cluster\",\n    \"apiVersion\": \"2020-12-01\",\n    \"dependsOn\": [\n        \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n    ],\n    \"type\": \"Microsoft.ContainerService/managedClusters\",\n    \"location\": \"[parameters('location')]\",\n    \"name\": \"[parameters('clusterName')]\",\n    \"identity\": {\n        \"type\": \"UserAssigned\",\n        \"userAssignedIdentities\": {\n            \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\": {}\n        }\n    },\n    \"properties\": {\n        \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n        \"disableLocalAccounts\": true,\n        \"enableRBAC\": true,\n        \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n        \"agentPoolProfiles\": [\n            {\n                \"name\": \"system\",\n                \"osDiskSizeGB\": 32,\n                \"count\": 3,\n                \"minCount\": 3,\n                \"maxCount\": 10,\n                \"enableAutoScaling\": true,\n                \"maxPods\": 50,\n                \"vmSize\": \"Standard_D2s_v3\",\n                \"osType\": \"Linux\",\n                \"type\": \"VirtualMachineScaleSets\",\n                \"vnetSubnetID\": \"[variables('clusterSubnetId')]\",\n                \"mode\": \"System\",\n                \"osDiskType\": \"Ephemeral\",\n                \"scaleSetPriority\": \"Regular\",\n                \"availabilityZones\": [\n                    \"1\",\n                    \"2\",\n                    \"3\"\n                ]\n            }\n        ],\n        \"aadProfile\": {\n            \"managed\": true,\n            \"enableAzureRBAC\": true,\n            \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n            \"tenantID\": \"[subscription().tenantId]\"\n        },\n        \"networkProfile\": {\n            \"networkPlugin\": \"azure\",\n            \"networkPolicy\": \"azure\",\n            \"loadBalancerSku\": \"Standard\",\n            \"serviceCidr\": \"192.168.0.0/16\",\n            \"dnsServiceIP\": \"192.168.0.4\",\n            \"dockerBridgeCidr\": \"172.17.0.1/16\"\n        },\n        \"autoUpgradeProfile\": {\n            \"upgradeChannel\": \"stable\"\n        },\n        \"addonProfiles\": {\n            \"azurepolicy\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"version\": \"v2\"\n                }\n            },\n            \"omsagent\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n                }\n            },\n            \"kubeDashboard\": {\n                \"enabled\": false\n            }\n        }\n    }\n}\n</code></pre>","tags":["Azure.AKS.AvailabilityZone","AZR-000021"]},{"location":"en/rules/Azure.AKS.AvailabilityZone/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"","tags":["Azure.AKS.AvailabilityZone","AZR-000021"]},{"location":"en/rules/Azure.AKS.AvailabilityZone/#create-aks-cluster-in-zone-1-2-and-3","title":"Create AKS Cluster in Zone 1, 2 and 3","text":"Azure CLI snippet<pre><code>az aks create \\\n  --resource-group '&lt;resource_group&gt;' \\\n  --name '&lt;cluster_name&gt;' \\\n  --generate-ssh-keys \\\n  --vm-set-type VirtualMachineScaleSets \\\n  --load-balancer-sku standard \\\n  --node-count '&lt;node_count&gt;' \\\n  --zones 1 2 3\n</code></pre>","tags":["Azure.AKS.AvailabilityZone","AZR-000021"]},{"location":"en/rules/Azure.AKS.AvailabilityZone/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>Create an Azure Kubernetes Service (AKS) cluster that uses availability zones</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.AvailabilityZone","AZR-000021"]},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/","title":"Use Azure Policy Add-on with AKS clusters","text":"Azure.AKS.AzurePolicyAddOnAZR-000028Error <p> Security  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2020_12  \u00b7  Important</p> <p>Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes.</p>","tags":["Azure.AKS.AzurePolicyAddOn","AZR-000028"]},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/#description","title":"Description","text":"<p>AKS clusters support integration with Azure Policy using an Open Policy Agent (OPA). Azure Policy integration is provided by an optional add-on that can be enabled on AKS clusters. Once enabled and Azure policies assigned, AKS clusters will enforce the configured constraints.</p> <p>Examples of policies include:</p> <ul> <li>Enforce HTTPS ingress in Kubernetes cluster.</li> <li>Do not allow privileged containers in Kubernetes cluster.</li> <li>Ensure container CPU and memory resource limits do not exceed the specified limits in Kubernetes cluster.</li> </ul>","tags":["Azure.AKS.AzurePolicyAddOn","AZR-000028"]},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/#recommendation","title":"Recommendation","text":"<p>Consider installing the Azure Policy Add-on for AKS clusters. Additionally, assign one or more Azure Policy definitions to security controls.</p>","tags":["Azure.AKS.AzurePolicyAddOn","AZR-000028"]},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/#examples","title":"Examples","text":"","tags":["Azure.AKS.AzurePolicyAddOn","AZR-000028"]},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>properties.addonProfiles.azurepolicy.enabled</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"UserAssigned\",\n    \"userAssignedIdentities\": {\n      \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n    }\n  },\n  \"properties\": {\n    \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n    \"disableLocalAccounts\": true,\n    \"enableRBAC\": true,\n    \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n    \"agentPoolProfiles\": [\n      {\n        \"name\": \"system\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 5,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"System\",\n        \"osDiskType\": \"Ephemeral\"\n      },\n      {\n        \"name\": \"user\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 20,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"User\",\n        \"osDiskType\": \"Ephemeral\"\n      }\n    ],\n    \"aadProfile\": {\n      \"managed\": true,\n      \"enableAzureRBAC\": true,\n      \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n      \"tenantID\": \"[subscription().tenantId]\"\n    },\n    \"networkProfile\": {\n      \"networkPlugin\": \"azure\",\n      \"networkPolicy\": \"azure\",\n      \"loadBalancerSku\": \"standard\",\n      \"serviceCidr\": \"[variables('serviceCidr')]\",\n      \"dnsServiceIP\": \"[variables('dnsServiceIP')]\"\n    },\n    \"apiServerAccessProfile\": {\n      \"enablePrivateCluster\": true,\n      \"enablePrivateClusterPublicFQDN\": false\n    },\n    \"autoUpgradeProfile\": {\n      \"upgradeChannel\": \"stable\"\n    },\n    \"oidcIssuerProfile\": {\n      \"enabled\": true\n    },\n    \"addonProfiles\": {\n      \"azurepolicy\": {\n        \"enabled\": true\n      },\n      \"omsagent\": {\n        \"enabled\": true,\n        \"config\": {\n          \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n        }\n      },\n      \"azureKeyvaultSecretsProvider\": {\n        \"enabled\": true,\n        \"config\": {\n          \"enableSecretRotation\": \"true\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.AzurePolicyAddOn","AZR-000028"]},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>properties.addonProfiles.azurepolicy.enabled</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource privateCluster 'Microsoft.ContainerService/managedClusters@2024-01-01' = {\n  location: location\n  name: name\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    disableLocalAccounts: true\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: [\n      {\n        name: 'system'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 5\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'System'\n        osDiskType: 'Ephemeral'\n      }\n      {\n        name: 'user'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 20\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'User'\n        osDiskType: 'Ephemeral'\n      }\n    ]\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n    }\n    apiServerAccessProfile: {\n      enablePrivateCluster: true\n      enablePrivateClusterPublicFQDN: false\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    oidcIssuerProfile: {\n      enabled: true\n    }\n    addonProfiles: {\n      azurepolicy: {\n        enabled: true\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:0.5.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AKS.AzurePolicyAddOn","AZR-000028"]},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Azure Policy Add-on for Kubernetes service (AKS) should be installed and enabled on your clusters <code>/providers/Microsoft.Authorization/policyDefinitions/0a15ec92-a229-4763-bb14-0ea34a568f8d</code></li> <li>Deploy Azure Policy Add-on to Azure Kubernetes Service clusters <code>/providers/Microsoft.Authorization/policyDefinitions/a8eff44f-8c92-45c3-a3fb-9880802d67a7</code></li> </ul>","tags":["Azure.AKS.AzurePolicyAddOn","AZR-000028"]},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/#notes","title":"Notes","text":"<p>Azure Policy for AKS clusters is generally available (GA). Azure Policy for AKS Engine and Arc enabled Kubernetes are currently in preview.</p>","tags":["Azure.AKS.AzurePolicyAddOn","AZR-000028"]},{"location":"en/rules/Azure.AKS.AzurePolicyAddOn/#links","title":"Links","text":"<ul> <li>SE:08 Hardening resources</li> <li>Understand Azure Policy for Kubernetes clusters</li> <li>Secure your Azure Kubernetes Service (AKS) clusters with Azure Policy</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.AzurePolicyAddOn","AZR-000028"]},{"location":"en/rules/Azure.AKS.AzureRBAC/","title":"Use Azure RBAC for Kubernetes Authorization","text":"Azure.AKS.AzureRBACAZR-000032Error <p> Security  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2021_06  \u00b7  Important</p> <p>Use Azure RBAC for Kubernetes Authorization with AKS clusters.</p>","tags":["Azure.AKS.AzureRBAC","AZR-000032"]},{"location":"en/rules/Azure.AKS.AzureRBAC/#description","title":"Description","text":"<p>Azure Kubernetes Service (AKS) supports Role-based Access Control (RBAC). RBAC is supported using Kubernetes RBAC and optionally Azure RBAC.</p> <ul> <li>Using Kubernetes RBAC, you can grant users, groups, and service accounts access to cluster resources.</li> <li>Additionally AKS supports granting Azure AD identities access to cluster resources using Azure RBAC.</li> </ul> <p>Using authorization provided by Azure RBAC simplifies and centralizes authorization of Azure AD principals. Access to Kubernetes resource can be managed using Azure Resource Manager (ARM).</p> <p>When Azure RBAC is enabled:</p> <ul> <li>Azure AD principals will be validated exclusively by Azure RBAC.</li> <li>Kubernetes users and service accounts are exclusively validated by Kubernetes RBAC.</li> </ul>","tags":["Azure.AKS.AzureRBAC","AZR-000032"]},{"location":"en/rules/Azure.AKS.AzureRBAC/#recommendation","title":"Recommendation","text":"<p>Consider using Azure RBAC for Kubernetes Authorization to centralize authorization of Azure AD principals.</p>","tags":["Azure.AKS.AzureRBAC","AZR-000032"]},{"location":"en/rules/Azure.AKS.AzureRBAC/#examples","title":"Examples","text":"","tags":["Azure.AKS.AzureRBAC","AZR-000032"]},{"location":"en/rules/Azure.AKS.AzureRBAC/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>properties.aadProfile.enableAzureRBAC</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2024-02-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"UserAssigned\",\n    \"userAssignedIdentities\": {\n      \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n    }\n  },\n  \"properties\": {\n    \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n    \"disableLocalAccounts\": true,\n    \"enableRBAC\": true,\n    \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n    \"agentPoolProfiles\": \"[variables('allPools')]\",\n    \"aadProfile\": {\n      \"managed\": true,\n      \"enableAzureRBAC\": true,\n      \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n      \"tenantID\": \"[subscription().tenantId]\"\n    },\n    \"networkProfile\": {\n      \"networkPlugin\": \"azure\",\n      \"networkPolicy\": \"azure\",\n      \"loadBalancerSku\": \"standard\",\n      \"serviceCidr\": \"[variables('serviceCidr')]\",\n      \"dnsServiceIP\": \"[variables('dnsServiceIP')]\"\n    },\n    \"apiServerAccessProfile\": {\n      \"authorizedIPRanges\": [\n        \"0.0.0.0/32\"\n      ]\n    },\n    \"autoUpgradeProfile\": {\n      \"upgradeChannel\": \"stable\"\n    },\n    \"oidcIssuerProfile\": {\n      \"enabled\": true\n    },\n    \"addonProfiles\": {\n      \"azurepolicy\": {\n        \"enabled\": true\n      },\n      \"omsagent\": {\n        \"enabled\": true,\n        \"config\": {\n          \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n        }\n      },\n      \"azureKeyvaultSecretsProvider\": {\n        \"enabled\": true,\n        \"config\": {\n          \"enableSecretRotation\": \"true\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.AzureRBAC","AZR-000032"]},{"location":"en/rules/Azure.AKS.AzureRBAC/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>properties.aadProfile.enableAzureRBAC</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cluster 'Microsoft.ContainerService/managedClusters@2024-02-01' = {\n  location: location\n  name: name\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    disableLocalAccounts: true\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: allPools\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n    }\n    apiServerAccessProfile: {\n      authorizedIPRanges: [\n        '0.0.0.0/32'\n      ]\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    oidcIssuerProfile: {\n      enabled: true\n    }\n    addonProfiles: {\n      azurepolicy: {\n        enabled: true\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:0.5.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AKS.AzureRBAC","AZR-000032"]},{"location":"en/rules/Azure.AKS.AzureRBAC/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az aks update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --enable-azure-rbac\n</code></pre>","tags":["Azure.AKS.AzureRBAC","AZR-000032"]},{"location":"en/rules/Azure.AKS.AzureRBAC/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Use Azure RBAC for Kubernetes Authorization</li> <li>Access and identity options for Azure Kubernetes Service (AKS)</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.AzureRBAC","AZR-000032"]},{"location":"en/rules/Azure.AKS.CNISubnetSize/","title":"AKS clusters using Azure CNI should use large subnets","text":"Azure.AKS.CNISubnetSizeAZR-000020Error <p> Reliability  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2021_09  \u00b7  Important</p> <p>AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues.</p>","tags":["Azure.AKS.CNISubnetSize","AZR-000020"]},{"location":"en/rules/Azure.AKS.CNISubnetSize/#description","title":"Description","text":"<p>In addition to kubenet, AKS clusters support Azure Container Networking Interface (CNI). This enables every pod to be accessed directly from the subnet via an IP address. Each node supports a maximum number of pods, which are reserved as IP addresses. This approach requires more capacity planning ahead of time, and can result in IP address exhaustion or the need to rebuild AKS clusters into larger subnets as application workloads begin to grow.</p>","tags":["Azure.AKS.CNISubnetSize","AZR-000020"]},{"location":"en/rules/Azure.AKS.CNISubnetSize/#recommendation","title":"Recommendation","text":"<p>Consider allocating a larger subnet (<code>/23</code> or bigger) to your AKS cluster.</p>","tags":["Azure.AKS.CNISubnetSize","AZR-000020"]},{"location":"en/rules/Azure.AKS.CNISubnetSize/#notes","title":"Notes","text":"<p>This rule applies when analyzing resources deployed to Azure using Export in-flight resource data.</p>","tags":["Azure.AKS.CNISubnetSize","AZR-000020"]},{"location":"en/rules/Azure.AKS.CNISubnetSize/#rule-configuration","title":"Rule configuration","text":"<p>AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE</p> <p>This rule fails when the CNI subnet size is smaller than <code>/23</code>.</p> <p>Configure <code>AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE</code> to set the minimum AKS CNI cluster subnet size.</p> <pre><code># YAML: The default AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE configuration option\nconfiguration:\n  AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE: 23\n</code></pre>","tags":["Azure.AKS.CNISubnetSize","AZR-000020"]},{"location":"en/rules/Azure.AKS.CNISubnetSize/#links","title":"Links","text":"<ul> <li>Plan for growth</li> <li>Configure Azure CNI networking in Azure Kubernetes Service (AKS)</li> <li>Use kubenet networking with your own IP address ranges in Azure Kubernetes Service (AKS)</li> <li>Tutorial: Configure Azure CNI networking in Azure Kubernetes Service (AKS) using Ansible</li> </ul>","tags":["Azure.AKS.CNISubnetSize","AZR-000020"]},{"location":"en/rules/Azure.AKS.ContainerInsights/","title":"Enable AKS Container insights","text":"Azure.AKS.ContainerInsightsAZR-000041Error <p> Operational Excellence  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2021_09  \u00b7  Important</p> <p>Enable Container insights to monitor AKS cluster workloads.</p>","tags":["Azure.AKS.ContainerInsights","AZR-000041"]},{"location":"en/rules/Azure.AKS.ContainerInsights/#description","title":"Description","text":"<p>With Container insights, you can use performance charts and health status to monitor AKS clusters, nodes and pods. Container insights delivers quick, visual and actionable information: from the CPU and memory pressure of your nodes to the logs of individual Kubernetes pods.</p>","tags":["Azure.AKS.ContainerInsights","AZR-000041"]},{"location":"en/rules/Azure.AKS.ContainerInsights/#recommendation","title":"Recommendation","text":"<p>Consider enabling Container insights for AKS clusters. Monitoring containers is critical, especially when running production AKS clusters at scale with multiple applications.</p>","tags":["Azure.AKS.ContainerInsights","AZR-000041"]},{"location":"en/rules/Azure.AKS.ContainerInsights/#examples","title":"Examples","text":"","tags":["Azure.AKS.ContainerInsights","AZR-000041"]},{"location":"en/rules/Azure.AKS.ContainerInsights/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable Container insights for an AKS cluster:</p> <ul> <li>Set <code>properties.addonProfiles.omsAgent.enabled</code> to <code>true</code>.</li> <li>Set Log Analytics workspace ID with <code>properties.addonProfiles.omsAgent.config.logAnalyticsWorkspaceResourceID</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"comments\": \"Azure Kubernetes Cluster\",\n    \"apiVersion\": \"2020-12-01\",\n    \"dependsOn\": [\n        \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n    ],\n    \"type\": \"Microsoft.ContainerService/managedClusters\",\n    \"location\": \"[parameters('location')]\",\n    \"name\": \"[parameters('clusterName')]\",\n    \"identity\": {\n        \"type\": \"UserAssigned\",\n        \"userAssignedIdentities\": {\n            \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\": {}\n        }\n    },\n    \"properties\": {\n        \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n        \"disableLocalAccounts\": true,\n        \"enableRBAC\": true,\n        \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n        \"agentPoolProfiles\": [\n            {\n                \"name\": \"system\",\n                \"osDiskSizeGB\": 32,\n                \"count\": 3,\n                \"minCount\": 3,\n                \"maxCount\": 10,\n                \"enableAutoScaling\": true,\n                \"maxPods\": 50,\n                \"vmSize\": \"Standard_D2s_v3\",\n                \"osType\": \"Linux\",\n                \"type\": \"VirtualMachineScaleSets\",\n                \"vnetSubnetID\": \"[variables('clusterSubnetId')]\",\n                \"mode\": \"System\",\n                \"osDiskType\": \"Ephemeral\",\n                \"scaleSetPriority\": \"Regular\"\n            }\n        ],\n        \"aadProfile\": {\n            \"managed\": true,\n            \"enableAzureRBAC\": true,\n            \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n            \"tenantID\": \"[subscription().tenantId]\"\n        },\n        \"networkProfile\": {\n            \"networkPlugin\": \"azure\",\n            \"networkPolicy\": \"azure\",\n            \"loadBalancerSku\": \"Standard\",\n            \"serviceCidr\": \"192.168.0.0/16\",\n            \"dnsServiceIP\": \"192.168.0.4\",\n            \"dockerBridgeCidr\": \"172.17.0.1/16\"\n        },\n        \"autoUpgradeProfile\": {\n            \"upgradeChannel\": \"stable\"\n        },\n        \"addonProfiles\": {\n            \"azurepolicy\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"version\": \"v2\"\n                }\n            },\n            \"omsagent\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n                }\n            },\n            \"kubeDashboard\": {\n                \"enabled\": false\n            }\n        }\n    }\n}\n</code></pre>","tags":["Azure.AKS.ContainerInsights","AZR-000041"]},{"location":"en/rules/Azure.AKS.ContainerInsights/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"","tags":["Azure.AKS.ContainerInsights","AZR-000041"]},{"location":"en/rules/Azure.AKS.ContainerInsights/#enable-for-default-log-analytics-workspace","title":"Enable for default Log Analytics workspace","text":"Azure CLI snippet<pre><code>az aks enable-addons \\\n  --addons monitoring \\\n  --name '&lt;cluster_name&gt;' \\\n  --resource-group '&lt;cluster_resource_group&gt;'\n</code></pre>","tags":["Azure.AKS.ContainerInsights","AZR-000041"]},{"location":"en/rules/Azure.AKS.ContainerInsights/#enable-for-an-existing-log-analytics-workspace","title":"Enable for an existing Log Analytics workspace","text":"Azure CLI snippet<pre><code>az aks enable-addons \\\n  --addons monitoring \\\n  --name '&lt;cluster_name&gt;' \\\n  --resource-group '&lt;cluster_resource_group&gt;' \\\n  --workspace-resource-id '&lt;workspace_id&gt;'\n</code></pre>","tags":["Azure.AKS.ContainerInsights","AZR-000041"]},{"location":"en/rules/Azure.AKS.ContainerInsights/#links","title":"Links","text":"<ul> <li>Container Insights</li> <li>Monitor your Kubernetes cluster performance with Container insights</li> <li>Container insights overview</li> <li>Enable monitoring of a new Azure Kubernetes Service (AKS) cluster</li> <li>Enable monitoring of Azure Kubernetes Service (AKS) cluster already deployed</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.ContainerInsights","AZR-000041"]},{"location":"en/rules/Azure.AKS.DNSPrefix/","title":"Use valid AKS cluster DNS prefix","text":"Azure.AKS.DNSPrefixAZR-000040Error <p> Operational Excellence  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements.</p>","tags":["Azure.AKS.DNSPrefix","AZR-000040"]},{"location":"en/rules/Azure.AKS.DNSPrefix/#description","title":"Description","text":"<p>The DNS prefix for AKS clusters has different requirements then the cluster name. The requirements for DNS prefixes are:</p> <ul> <li>Between 1 and 54 characters long.</li> <li>Alphanumerics and hyphens.</li> <li>Start and end with alphanumeric.</li> </ul>","tags":["Azure.AKS.DNSPrefix","AZR-000040"]},{"location":"en/rules/Azure.AKS.DNSPrefix/#recommendation","title":"Recommendation","text":"<p>Consider using a DNS prefix that meets naming requirements.</p>","tags":["Azure.AKS.DNSPrefix","AZR-000040"]},{"location":"en/rules/Azure.AKS.DNSPrefix/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Azure resources</li> <li>Recommended abbreviations for Azure resource types</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.DNSPrefix","AZR-000040"]},{"location":"en/rules/Azure.AKS.DefenderProfile/","title":"Enable Defender profile","text":"Azure.AKS.DefenderProfileAZR-000370Error <p> Security  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2023_03  \u00b7  Important</p> <p>Enable the Defender profile with Azure Kubernetes Service (AKS) cluster.</p>","tags":["Azure.AKS.DefenderProfile","AZR-000370"]},{"location":"en/rules/Azure.AKS.DefenderProfile/#description","title":"Description","text":"<p>To collect and provide data plane protections of Microsoft Defender for Containers some additional daemon set and deployments needs to be deployed to the AKS clusters.</p> <p>These components are installed when the Defender profile is enabled on the cluster.</p> <p>The Defender profile deployed to each node provides the runtime protections and collects signals from nodes.</p>","tags":["Azure.AKS.DefenderProfile","AZR-000370"]},{"location":"en/rules/Azure.AKS.DefenderProfile/#recommendation","title":"Recommendation","text":"<p>Consider enabling the Defender profile with Azure Kubernetes Service (AKS) cluster.</p>","tags":["Azure.AKS.DefenderProfile","AZR-000370"]},{"location":"en/rules/Azure.AKS.DefenderProfile/#examples","title":"Examples","text":"","tags":["Azure.AKS.DefenderProfile","AZR-000370"]},{"location":"en/rules/Azure.AKS.DefenderProfile/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable the Defender profile with Azure Kubernetes Service clusters:</p> <ul> <li>Set the <code>properties.securityProfile.defender.securityMonitoring.enabled</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2023-01-02-preview\",\n  \"name\": \"[parameters('clusterName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"securityProfile\": {\n      \"defender\": {\n        \"logAnalyticsWorkspaceResourceId\": \"[parameters('logAnalyticsWorkspaceResourceId')]\",\n        \"securityMonitoring\": {\n          \"enabled\": true\n        }\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.AKS.DefenderProfile","AZR-000370"]},{"location":"en/rules/Azure.AKS.DefenderProfile/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable the Defender profile with Azure Kubernetes Service clusters:</p> <ul> <li>Set the <code>properties.securityProfile.defender.securityMonitoring.enabled</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cluster 'Microsoft.ContainerService/managedClusters@2023-01-02-preview' = {\n  location: location\n  name: clusterName\n  properties: {\n    securityProfile: {\n      defender: {\n        logAnalyticsWorkspaceResourceId: logAnalyticsWorkspaceResourceId\n        securityMonitoring: {\n          enabled: true\n        }\n      }\n    }\n  } \n}\n</code></pre>","tags":["Azure.AKS.DefenderProfile","AZR-000370"]},{"location":"en/rules/Azure.AKS.DefenderProfile/#notes","title":"Notes","text":"<p>Outbound access so that the Defender profile can connect to Microsoft Defender for Cloud to send security data and events is required.</p>","tags":["Azure.AKS.DefenderProfile","AZR-000370"]},{"location":"en/rules/Azure.AKS.DefenderProfile/#links","title":"Links","text":"<ul> <li>Monitor Azure resources in Microsoft Defender for Cloud</li> <li>Introduction to Microsoft Defender for Containers</li> <li>Defender for Containers architecture</li> <li>Deploy the Defender profile</li> <li>Required FQDN / application rules</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.DefenderProfile","AZR-000370"]},{"location":"en/rules/Azure.AKS.EphemeralOSDisk/","title":"Use AKS Ephemeral OS disk","text":"Azure.AKS.EphemeralOSDiskAZR-000287Warning <p> Performance Efficiency  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2022_09  \u00b7  Important</p> <p>AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades.</p>","tags":["Azure.AKS.EphemeralOSDisk","AZR-000287"]},{"location":"en/rules/Azure.AKS.EphemeralOSDisk/#description","title":"Description","text":"<p>By default, Azure automatically replicates the operating system disk for a virtual machine to Azure storage to avoid data loss if the VM needs to be relocated to another host. However, since containers aren't designed to have local state persisted, this behavior offers limited value while providing some drawbacks, including slower node provisioning and higher read/write latency.</p> <p>By contrast, ephemeral OS disks are stored only on the host machine, just like a temporary disk. This provides lower read/write latency, along with faster node scaling and cluster upgrades.</p> <p>Like the temporary disk, an ephemeral OS disk is included in the price of the virtual machine, so you incur no additional storage costs.</p> <p>NB: When a user does not explicitly request managed disks for the OS, AKS will default to ephemeral OS if possible for a given node pool configuration. The rule is therefore configured with <code>-Level Warning</code> as it can give inaccurate information.</p> <p>When using ephemeral OS, the OS disk must fit in the VM cache. The sizes for VM cache are available in the Azure documentation in parentheses next to IO throughput (\"cache size in GiB\").</p> <p>Examples:</p> <ul> <li>Using the AKS default VM size Standard_DS2_v2 with the default OS disk size of 100GB as an example, this VM size supports ephemeral OS but only has 86GB of cache size.   This configuration would default to managed disks if the user does not specify explicitly.   If a user explicitly requested ephemeral OS, they would receive a validation error.</li> <li>If a user requests the same Standard_DS2_v2 with a 60GB OS disk, this configuration would default to ephemeral OS: the requested size of 60GB is smaller than the maximum cache size of 86GB.</li> </ul>","tags":["Azure.AKS.EphemeralOSDisk","AZR-000287"]},{"location":"en/rules/Azure.AKS.EphemeralOSDisk/#recommendation","title":"Recommendation","text":"<p>AKS clusters should use ephemeral OS disks.</p>","tags":["Azure.AKS.EphemeralOSDisk","AZR-000287"]},{"location":"en/rules/Azure.AKS.EphemeralOSDisk/#examples","title":"Examples","text":"","tags":["Azure.AKS.EphemeralOSDisk","AZR-000287"]},{"location":"en/rules/Azure.AKS.EphemeralOSDisk/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy an AKS cluster that pass this rule:</p> <ul> <li>Set <code>properties.agentPoolProfiles.osDiskType</code> to <code>Ephemeral</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2022-06-02-preview\",\n  \"name\": \"[parameters('clusterName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Basic\",\n    \"tier\": \"Paid\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n    \"agentPoolProfiles\": [\n      {\n        \"name\": \"agentpool\",\n        \"osDiskSizeGB\": 60,\n        \"count\": \"[parameters('agentCount')]\",\n        \"vmSize\": \"[parameters('agentVMSize')]\",\n        \"osDiskType\": \"Ephemeral\",\n        \"osType\": \"Linux\",\n        \"mode\": \"System\"\n      }\n    ],\n    \"linuxProfile\": {\n      \"adminUsername\": \"[parameters('linuxAdminUsername')]\",\n      \"ssh\": {\n        \"publicKeys\": [\n          {\n            \"keyData\": \"[parameters('sshRSAPublicKey')]\"\n          }\n        ]\n      }\n    }\n  }\n}\n</code></pre> <p>To deploy an AKS agent pool that pass this rule:</p> <ul> <li>Set <code>properties.osDiskType</code> to <code>Ephemeral</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters/agentPools\",\n  \"apiVersion\": \"2022-07-01\",\n  \"name\": \"[format('{0}/{1}', parameters('clusterName'), variables('poolName'))]\",\n  \"properties\": {\n    \"count\": \"[variables('minCount')]\",\n    \"vmSize\": \"[variables('vmSize')]\",\n    \"osDiskSizeGB\": 60,\n    \"osType\": \"Linux\",\n    \"osDiskType\": \"Ephemeral\",\n    \"maxPods\": 50,\n    \"mode\": \"User\"\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ContainerService/managedClusters', parameters('clusterName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.EphemeralOSDisk","AZR-000287"]},{"location":"en/rules/Azure.AKS.EphemeralOSDisk/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy an AKS cluster that pass this rule:</p> <ul> <li>Set <code>properties.agentPoolProfiles.osDiskType</code> to <code>Ephemeral</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource aks 'Microsoft.ContainerService/managedClusters@2022-06-02-preview' = {\n  name: clusterName\n  location: location\n  sku: {\n    name: 'Basic'\n    tier: 'Paid'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: [\n      {\n        name: 'agentpool'\n        osDiskSizeGB: 60\n        count: agentCount\n        vmSize: agentVMSize\n        osDiskType: 'Ephemeral'\n        osType: 'Linux'\n        mode: 'System'\n      }\n    ]\n    linuxProfile: {\n      adminUsername: linuxAdminUsername\n      ssh: {\n        publicKeys: [\n          {\n            keyData: sshRSAPublicKey\n          }\n        ]\n      }\n    }\n  }\n}\n</code></pre> <p>To deploy an AKS agent pool that pass this rule:</p> <ul> <li>Set <code>properties.osDiskType</code> to <code>Ephemeral</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource userPool 'Microsoft.ContainerService/managedClusters/agentPools@2022-07-01' = {\n  parent: cluster\n  name: poolName\n  properties: {\n    count: minCount\n    vmSize: vmSize\n    osDiskSizeGB: 60\n    osType: 'Linux'\n    osDiskType: 'Ephemeral'\n    maxPods: 50\n    mode: 'User'\n  }\n}\n</code></pre>","tags":["Azure.AKS.EphemeralOSDisk","AZR-000287"]},{"location":"en/rules/Azure.AKS.EphemeralOSDisk/#links","title":"Links","text":"<ul> <li>Performance efficiency checklist</li> <li>Azure Kubernetes Service (AKS) Ephemeral OS</li> <li>Azure deployment reference (managedclusters)</li> <li>Azure deployment reference (agentpools)</li> </ul>","tags":["Azure.AKS.EphemeralOSDisk","AZR-000287"]},{"location":"en/rules/Azure.AKS.HttpAppRouting/","title":"Disable HTTP application routing add-on","text":"Azure.AKS.HttpAppRoutingAZR-000035Error <p> Security  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2021_12  \u00b7  Important</p> <p>Disable HTTP application routing add-on in AKS clusters.</p>","tags":["Azure.AKS.HttpAppRouting","AZR-000035"]},{"location":"en/rules/Azure.AKS.HttpAppRouting/#description","title":"Description","text":"<p>The HTTP application routing add-on is designed to quickly expose HTTP endpoints to the public internet. This may be helpful in some limited scenarios, but should not be used in production.</p> <p>When exposing application endpoints consider using an ingress controller that supports:</p> <ul> <li>Security filtering behind web application firewall (WAF).</li> <li>Encryption in transit over TLS.</li> <li>Multiple replicas.</li> </ul> <p>Azure provides a production ready ingress controller Application Gateway Ingress Controller (AGIC).</p> <p>HTTP application routing add-on (preview) for Azure Kubernetes Service (AKS) will be retired on 03 March 2025.</p>","tags":["Azure.AKS.HttpAppRouting","AZR-000035"]},{"location":"en/rules/Azure.AKS.HttpAppRouting/#recommendation","title":"Recommendation","text":"<p>Consider disabling the HTTP application routing add-on in your AKS cluster. Also consider using Application Gateway Ingress Controller (AGIC) instead to protect application endpoints.</p>","tags":["Azure.AKS.HttpAppRouting","AZR-000035"]},{"location":"en/rules/Azure.AKS.HttpAppRouting/#examples","title":"Examples","text":"","tags":["Azure.AKS.HttpAppRouting","AZR-000035"]},{"location":"en/rules/Azure.AKS.HttpAppRouting/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>Properties.addonProfiles.httpApplicationRouting.enabled</code> to <code>false</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.ContainerService/managedClusters\",\n    \"apiVersion\": \"2021-07-01\",\n    \"name\": \"[parameters('clusterName')]\",\n    \"location\": \"[parameters('location')]\",\n    \"identity\": {\n        \"type\": \"UserAssigned\",\n        \"userAssignedIdentities\": {\n            \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n        }\n    },\n    \"properties\": {\n        \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n        \"enableRBAC\": true,\n        \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n        \"agentPoolProfiles\": \"[variables('allPools')]\",\n        \"aadProfile\": {\n            \"managed\": true,\n            \"enableAzureRBAC\": true,\n            \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n            \"tenantID\": \"[subscription().tenantId]\"\n        },\n        \"networkProfile\": {\n            \"networkPlugin\": \"azure\",\n            \"networkPolicy\": \"azure\",\n            \"loadBalancerSku\": \"standard\",\n            \"serviceCidr\": \"[variables('serviceCidr')]\",\n            \"dnsServiceIP\": \"[variables('dnsServiceIP')]\",\n            \"dockerBridgeCidr\": \"[variables('dockerBridgeCidr')]\"\n        },\n        \"autoUpgradeProfile\": {\n            \"upgradeChannel\": \"stable\"\n        },\n        \"addonProfiles\": {\n            \"httpApplicationRouting\": {\n                \"enabled\": false\n            },\n            \"azurepolicy\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"version\": \"v2\"\n                }\n            },\n            \"omsagent\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n                }\n            },\n            \"kubeDashboard\": {\n                \"enabled\": false\n            },\n            \"azureKeyvaultSecretsProvider\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"enableSecretRotation\": \"true\"\n                }\n            }\n        }\n    },\n    \"tags\": \"[parameters('tags')]\",\n    \"dependsOn\": [\n        \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n    ]\n}\n</code></pre>","tags":["Azure.AKS.HttpAppRouting","AZR-000035"]},{"location":"en/rules/Azure.AKS.HttpAppRouting/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>Properties.addonProfiles.httpApplicationRouting.enabled</code> to <code>false</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cluster 'Microsoft.ContainerService/managedClusters@2021-07-01' = {\n  location: location\n  name: clusterName\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: allPools\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n      dockerBridgeCidr: dockerBridgeCidr\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    addonProfiles: {\n      httpApplicationRouting: {\n        enabled: false\n      }\n      azurepolicy: {\n        enabled: true\n        config: {\n          version: 'v2'\n        }\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      kubeDashboard: {\n        enabled: false\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n  tags: tags\n}\n</code></pre>","tags":["Azure.AKS.HttpAppRouting","AZR-000035"]},{"location":"en/rules/Azure.AKS.HttpAppRouting/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>HTTP application routing</li> <li>Enable Application Gateway Ingress Controller add-on for an existing AKS cluster</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.HttpAppRouting","AZR-000035"]},{"location":"en/rules/Azure.AKS.LocalAccounts/","title":"Disable AKS local accounts","text":"Azure.AKS.LocalAccountsAZR-000031Error <p> Security  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2023_09  \u00b7  Important</p> <p>Enforce named user accounts with RBAC assigned permissions.</p>","tags":["Azure.AKS.LocalAccounts","AZR-000031"]},{"location":"en/rules/Azure.AKS.LocalAccounts/#description","title":"Description","text":"<p>AKS clusters support Role-based Access Control (RBAC) authorization. RBAC allows users, groups, and service accounts to be granted access to resources on an as needed basis. Actions performed by each identity can be logged for auditing with Kubernetes audit policies.</p> <p>When a cluster is deployed, local accounts are enabled by default even when RBAC is enabled. These local accounts such as <code>clusterAdmin</code> and <code>clusterUser</code> are shared accounts that are not tied to an identity.</p> <p>If local account credentials are used, Kubernetes auditing logs the local account instead of named accounts. Who performed an action cannot be determined from the audit logs, creating an audit log gap for privileged actions.</p> <p>In an AKS cluster with local account disabled administrator will be unable to get the clusterAdmin credential. For example, using <code>az aks get-credentials -g '&lt;resource-group&gt;' -n '&lt;cluster-name&gt;' --admin</code> will fail.</p>","tags":["Azure.AKS.LocalAccounts","AZR-000031"]},{"location":"en/rules/Azure.AKS.LocalAccounts/#recommendation","title":"Recommendation","text":"<p>Consider enforcing usage of named accounts by disabling local Kubernetes account credentials. Also consider enforcing this setting using Azure Policy.</p>","tags":["Azure.AKS.LocalAccounts","AZR-000031"]},{"location":"en/rules/Azure.AKS.LocalAccounts/#examples","title":"Examples","text":"","tags":["Azure.AKS.LocalAccounts","AZR-000031"]},{"location":"en/rules/Azure.AKS.LocalAccounts/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set the <code>properties.disableLocalAccounts</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2023-07-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"UserAssigned\",\n    \"userAssignedIdentities\": {\n      \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n    }\n  },\n  \"properties\": {\n    \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n    \"disableLocalAccounts\": true,\n    \"enableRBAC\": true,\n    \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n    \"agentPoolProfiles\": [\n      {\n        \"name\": \"system\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 5,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"System\",\n        \"osDiskType\": \"Ephemeral\"\n      },\n      {\n        \"name\": \"user\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 20,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"User\",\n        \"osDiskType\": \"Ephemeral\"\n      }\n    ],\n    \"aadProfile\": {\n      \"managed\": true,\n      \"enableAzureRBAC\": true,\n      \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n      \"tenantID\": \"[subscription().tenantId]\"\n    },\n    \"networkProfile\": {\n      \"networkPlugin\": \"azure\",\n      \"networkPolicy\": \"azure\",\n      \"loadBalancerSku\": \"standard\",\n      \"serviceCidr\": \"[variables('serviceCidr')]\",\n      \"dnsServiceIP\": \"[variables('dnsServiceIP')]\"\n    },\n    \"autoUpgradeProfile\": {\n      \"upgradeChannel\": \"stable\"\n    },\n    \"oidcIssuerProfile\": {\n      \"enabled\": true\n    },\n    \"addonProfiles\": {\n      \"azurepolicy\": {\n        \"enabled\": true\n      },\n      \"omsagent\": {\n        \"enabled\": true,\n        \"config\": {\n          \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n        }\n      },\n      \"azureKeyvaultSecretsProvider\": {\n        \"enabled\": true,\n        \"config\": {\n          \"enableSecretRotation\": \"true\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.LocalAccounts","AZR-000031"]},{"location":"en/rules/Azure.AKS.LocalAccounts/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set the <code>properties.disableLocalAccounts</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource clusterWithPools 'Microsoft.ContainerService/managedClusters@2023-07-01' = {\n  location: location\n  name: name\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    disableLocalAccounts: true\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: [\n      {\n        name: 'system'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 5\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'System'\n        osDiskType: 'Ephemeral'\n      }\n      {\n        name: 'user'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 20\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'User'\n        osDiskType: 'Ephemeral'\n      }\n    ]\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    oidcIssuerProfile: {\n      enabled: true\n    }\n    addonProfiles: {\n      azurepolicy: {\n        enabled: true\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:0.5.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AKS.LocalAccounts","AZR-000031"]},{"location":"en/rules/Azure.AKS.LocalAccounts/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az aks update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --enable-aad --aad-admin-group-object-ids '&lt;aad-group-id&gt;' --disable-local\n</code></pre>","tags":["Azure.AKS.LocalAccounts","AZR-000031"]},{"location":"en/rules/Azure.AKS.LocalAccounts/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Azure Kubernetes Service Clusters should have local authentication methods disabled <code>/providers/Microsoft.Authorization/policyDefinitions/993c2fcd-2b29-49d2-9eb0-df2c3a730c32</code></li> </ul>","tags":["Azure.AKS.LocalAccounts","AZR-000031"]},{"location":"en/rules/Azure.AKS.LocalAccounts/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Security design principles</li> <li>Manage local accounts with AKS-managed Azure Active Directory integration</li> <li>Access and identity options for Azure Kubernetes Service (AKS)</li> <li>Azure Policy built-in definitions for Azure Kubernetes Service</li> <li>IM-1: Use centralized identity and authentication system</li> <li>PA-1: Separate and limit highly privileged/administrative users</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.LocalAccounts","AZR-000031"]},{"location":"en/rules/Azure.AKS.MaintenanceWindow/","title":"Customer-controlled maintenance window configuration","text":"Azure.AKS.MaintenanceWindowAZR-000446Error <p> Reliability  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2024_09  \u00b7  Important</p> <p>Configure customer-controlled maintenance windows for AKS clusters.</p>","tags":["Azure.AKS.MaintenanceWindow","AZR-000446"]},{"location":"en/rules/Azure.AKS.MaintenanceWindow/#description","title":"Description","text":"<p>AKS clusters undergo periodic maintenance automatically to ensure your applications remains secure, stable, and up-to-date. This maintenance includes applying security updates, system upgrades, and software patches.</p> <p>During peak load times, AKS clusters or workloads may already be scaled to their configured maximums or under stress. As a result, rescheduling pods, or upgrading a node may take longer then normal.</p> <p>Maintenance configurations provide a best-effort option that allows you to schedule planned maintenance operations to a predefined window. This provides greater predictability over cluster operations so that maintenance during peak load times can be avoided when possible. Noting that some critical or urgent maintenance operations may be performed outside the configured maintenance window.</p> <p>AKS provides three (3) schedule configuration types are available for customer-controlled maintenance:</p> <ul> <li><code>default</code> is a basic configuration for controlling AKS weekly releases.</li> <li><code>aksManagedAutoUpgradeSchedule</code> controls when to schedule AKS Kubernetes version upgrades.   This configuration affects the schedule for when cluster auto-upgrades are applied based on your configured channel.</li> <li><code>aksManagedNodeOSUpgradeSchedule</code> controls when to schedule AKS node OS upgrades.   This configuration affects the schedule for when AKS node OS auto-upgrades are applied based on your configured channel.</li> </ul> <p>To read more about automated maintenance operations in AKS see the reference links below.</p>","tags":["Azure.AKS.MaintenanceWindow","AZR-000446"]},{"location":"en/rules/Azure.AKS.MaintenanceWindow/#recommendation","title":"Recommendation","text":"<p>Consider using a planned maintenance windows for AKS and node OS upgrades to avoid periods of high cluster utilization for improved reliability. Do this by configuring the <code>aksManagedAutoUpgradeSchedule</code> and <code>aksManagedNodeOSUpgradeSchedule</code> maintenance configurations.</p>","tags":["Azure.AKS.MaintenanceWindow","AZR-000446"]},{"location":"en/rules/Azure.AKS.MaintenanceWindow/#examples","title":"Examples","text":"","tags":["Azure.AKS.MaintenanceWindow","AZR-000446"]},{"location":"en/rules/Azure.AKS.MaintenanceWindow/#configure-with-azure-template","title":"Configure with Azure template","text":"<ul> <li>Deploy maintenance configurations for cluster version and node OS auto-upgrades.<ul> <li>For cluster version auto-upgrades, set the <code>name</code> property to <code>aksManagedAutoUpgradeSchedule</code>.</li> <li>For node OS auto-upgrades, set the <code>name</code> property to <code>aksManagedNodeOSUpgradeSchedule</code>.</li> </ul> </li> </ul> <p>For cluster version auto-upgrades see the example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters/maintenanceConfigurations\",\n  \"apiVersion\": \"2024-03-02-preview\",\n  \"name\": \"[format('{0}/{1}', parameters('clusterName'), 'aksManagedAutoUpgradeSchedule')]\",\n  \"properties\": {\n    \"maintenanceWindow\": {\n      \"schedule\": {\n        \"weekly\": {\n          \"intervalWeeks\": 1,\n          \"dayOfWeek\": \"Sunday\"\n        }\n      },\n      \"durationHours\": 4,\n      \"utcOffset\": \"+00:00\",\n      \"startDate\": \"2024-07-15\",\n      \"startTime\": \"00:00\"\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ContainerService/managedClusters', parameters('clusterName'))]\"\n  ]\n}\n</code></pre> <p>For node OS auto-upgrades see the example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters/maintenanceConfigurations\",\n  \"apiVersion\": \"2024-03-02-preview\",\n  \"name\": \"[format('{0}/{1}', parameters('clusterName'), 'aksManagedNodeOSUpgradeSchedule')]\",\n  \"properties\": {\n    \"maintenanceWindow\": {\n      \"schedule\": {\n        \"weekly\": {\n          \"intervalWeeks\": 1,\n          \"dayOfWeek\": \"Sunday\"\n        }\n      },\n      \"durationHours\": 4,\n      \"utcOffset\": \"+00:00\",\n      \"startDate\": \"2024-07-15\",\n      \"startTime\": \"00:00\"\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ContainerService/managedClusters', parameters('clusterName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.MaintenanceWindow","AZR-000446"]},{"location":"en/rules/Azure.AKS.MaintenanceWindow/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Deploy maintenance configurations for cluster version and node OS auto-upgrades.<ul> <li>For cluster version auto-upgrades, set the <code>name</code> property to <code>aksManagedAutoUpgradeSchedule</code>.</li> <li>For node OS auto-upgrades, set the <code>name</code> property to <code>aksManagedNodeOSUpgradeSchedule</code>.</li> </ul> </li> </ul> <p>For cluster version auto-upgrades see the example:</p> Azure Bicep snippet<pre><code>resource aksManagedAutoUpgradeSchedule 'Microsoft.ContainerService/managedClusters/maintenanceConfigurations@2024-03-02-preview' = {\n  parent: aks\n  name: 'aksManagedAutoUpgradeSchedule'\n  properties: {\n    maintenanceWindow: {\n      schedule: {\n        weekly: {\n          intervalWeeks: 1\n          dayOfWeek: 'Sunday'\n        }\n      }\n      durationHours: 4\n      utcOffset: '+00:00'\n      startDate: '2024-07-15'\n      startTime: '00:00'\n    }\n  }\n}\n</code></pre> <p>For node OS auto-upgrades see the example:</p> Azure Bicep snippet<pre><code>resource aksManagedNodeOSUpgradeSchedule 'Microsoft.ContainerService/managedClusters/maintenanceConfigurations@2024-03-02-preview' = {\n  parent: aks\n  name: 'aksManagedNodeOSUpgradeSchedule'\n  properties: {\n    maintenanceWindow: {\n      schedule: {\n        weekly: {\n          intervalWeeks: 1\n          dayOfWeek: 'Sunday'\n        }\n      }\n      durationHours: 4\n      utcOffset: '+00:00'\n      startDate: '2024-07-15'\n      startTime: '00:00'\n    }\n  }\n}\n</code></pre>","tags":["Azure.AKS.MaintenanceWindow","AZR-000446"]},{"location":"en/rules/Azure.AKS.MaintenanceWindow/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Planned maintenance to schedule and control upgrades</li> <li>Automatically upgrade an Azure Kubernetes Service (AKS) cluster</li> <li>Auto-upgrade node OS images</li> <li>Patch and upgrade guidance</li> <li>Create a maintenance window</li> <li>Upgrade options</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.MaintenanceWindow","AZR-000446"]},{"location":"en/rules/Azure.AKS.ManagedAAD/","title":"Enable AKS-managed Azure AD","text":"Azure.AKS.ManagedAADAZR-000029Error <p> Security  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2021_06  \u00b7  Important</p> <p>Use AKS-managed Azure AD to simplify authorization and improve security.</p>","tags":["Azure.AKS.ManagedAAD","AZR-000029"]},{"location":"en/rules/Azure.AKS.ManagedAAD/#description","title":"Description","text":"<p>AKS-managed integration provides an easy way to use Azure AD authorization for AKS. Previous Azure AD integration with AKS required app registration and management within Azure AD.</p>","tags":["Azure.AKS.ManagedAAD","AZR-000029"]},{"location":"en/rules/Azure.AKS.ManagedAAD/#recommendation","title":"Recommendation","text":"<p>Consider configuring AKS-managed Azure AD integration for AKS clusters.</p>","tags":["Azure.AKS.ManagedAAD","AZR-000029"]},{"location":"en/rules/Azure.AKS.ManagedAAD/#examples","title":"Examples","text":"","tags":["Azure.AKS.ManagedAAD","AZR-000029"]},{"location":"en/rules/Azure.AKS.ManagedAAD/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>properties.aadProfile.managed</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2024-02-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"UserAssigned\",\n    \"userAssignedIdentities\": {\n      \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n    }\n  },\n  \"properties\": {\n    \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n    \"disableLocalAccounts\": true,\n    \"enableRBAC\": true,\n    \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n    \"agentPoolProfiles\": \"[variables('allPools')]\",\n    \"aadProfile\": {\n      \"managed\": true,\n      \"enableAzureRBAC\": true,\n      \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n      \"tenantID\": \"[subscription().tenantId]\"\n    },\n    \"networkProfile\": {\n      \"networkPlugin\": \"azure\",\n      \"networkPolicy\": \"azure\",\n      \"loadBalancerSku\": \"standard\",\n      \"serviceCidr\": \"[variables('serviceCidr')]\",\n      \"dnsServiceIP\": \"[variables('dnsServiceIP')]\"\n    },\n    \"apiServerAccessProfile\": {\n      \"authorizedIPRanges\": [\n        \"0.0.0.0/32\"\n      ]\n    },\n    \"autoUpgradeProfile\": {\n      \"upgradeChannel\": \"stable\"\n    },\n    \"oidcIssuerProfile\": {\n      \"enabled\": true\n    },\n    \"addonProfiles\": {\n      \"azurepolicy\": {\n        \"enabled\": true\n      },\n      \"omsagent\": {\n        \"enabled\": true,\n        \"config\": {\n          \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n        }\n      },\n      \"azureKeyvaultSecretsProvider\": {\n        \"enabled\": true,\n        \"config\": {\n          \"enableSecretRotation\": \"true\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.ManagedAAD","AZR-000029"]},{"location":"en/rules/Azure.AKS.ManagedAAD/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>properties.aadProfile.managed</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cluster 'Microsoft.ContainerService/managedClusters@2024-02-01' = {\n  location: location\n  name: name\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    disableLocalAccounts: true\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: allPools\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n    }\n    apiServerAccessProfile: {\n      authorizedIPRanges: [\n        '0.0.0.0/32'\n      ]\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    oidcIssuerProfile: {\n      enabled: true\n    }\n    addonProfiles: {\n      azurepolicy: {\n        enabled: true\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:0.5.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AKS.ManagedAAD","AZR-000029"]},{"location":"en/rules/Azure.AKS.ManagedAAD/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az aks update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --enable-aad --aad-admin-group-object-ids '&lt;group_id&gt;'\n</code></pre>","tags":["Azure.AKS.ManagedAAD","AZR-000029"]},{"location":"en/rules/Azure.AKS.ManagedAAD/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Security design principles</li> <li>Access and identity options for Azure Kubernetes Service (AKS)</li> <li>AKS-managed Azure Active Directory integration</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.ManagedAAD","AZR-000029"]},{"location":"en/rules/Azure.AKS.ManagedIdentity/","title":"Use managed identities for AKS cluster authentication","text":"Azure.AKS.ManagedIdentityAZR-000025Error <p> Security  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Configure AKS clusters to use managed identities for managing cluster infrastructure.</p>","tags":["Azure.AKS.ManagedIdentity","AZR-000025"]},{"location":"en/rules/Azure.AKS.ManagedIdentity/#description","title":"Description","text":"<p>During the lifecycle of an AKS cluster, the control plane configures a number of Azure resources. This includes node pools, networking, storage and other supporting services.</p> <p>When making calls against the Azure REST APIs, an identity must be used to authenticate requests. The type of identity the control plane will use is configurable at cluster creation. Either a service principal or system-assigned managed identity can be used.</p> <p>By default, the service principal credentials are valid for one year. Service principal credentials must be rotated before expiry to prevent issues. You can update or rotate the service principal credentials at any time.</p> <p>Using a system-assigned managed identity abstracts the process of managing a service principal. The managed identity is automatically created/ removed with the cluster. Managed identities also reduce maintenance (and improve security) by automatically rotating credentials.</p> <p>Separately, applications within an AKS cluster may use managed identities with AAD Pod Identity.</p>","tags":["Azure.AKS.ManagedIdentity","AZR-000025"]},{"location":"en/rules/Azure.AKS.ManagedIdentity/#recommendation","title":"Recommendation","text":"<p>Consider using managed identities during AKS cluster creation. Additionally, consider redeploying the AKS cluster with managed identities instead of service principals.</p>","tags":["Azure.AKS.ManagedIdentity","AZR-000025"]},{"location":"en/rules/Azure.AKS.ManagedIdentity/#examples","title":"Examples","text":"","tags":["Azure.AKS.ManagedIdentity","AZR-000025"]},{"location":"en/rules/Azure.AKS.ManagedIdentity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2023-11-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"UserAssigned\",\n    \"userAssignedIdentities\": {\n      \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n    }\n  },\n  \"properties\": {\n    \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n    \"disableLocalAccounts\": true,\n    \"enableRBAC\": true,\n    \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n    \"agentPoolProfiles\": [\n      {\n        \"name\": \"system\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 5,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"System\",\n        \"osDiskType\": \"Ephemeral\"\n      },\n      {\n        \"name\": \"user\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 20,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"User\",\n        \"osDiskType\": \"Ephemeral\"\n      }\n    ],\n    \"aadProfile\": {\n      \"managed\": true,\n      \"enableAzureRBAC\": true,\n      \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n      \"tenantID\": \"[subscription().tenantId]\"\n    },\n    \"networkProfile\": {\n      \"networkPlugin\": \"azure\",\n      \"networkPolicy\": \"azure\",\n      \"loadBalancerSku\": \"standard\",\n      \"serviceCidr\": \"[variables('serviceCidr')]\",\n      \"dnsServiceIP\": \"[variables('dnsServiceIP')]\"\n    },\n    \"apiServerAccessProfile\": {\n      \"authorizedIPRanges\": [\n        \"0.0.0.0/32\"\n      ]\n    },\n    \"autoUpgradeProfile\": {\n      \"upgradeChannel\": \"stable\"\n    },\n    \"oidcIssuerProfile\": {\n      \"enabled\": true\n    },\n    \"addonProfiles\": {\n      \"azurepolicy\": {\n        \"enabled\": true\n      },\n      \"omsagent\": {\n        \"enabled\": true,\n        \"config\": {\n          \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n        }\n      },\n      \"azureKeyvaultSecretsProvider\": {\n        \"enabled\": true,\n        \"config\": {\n          \"enableSecretRotation\": \"true\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.ManagedIdentity","AZR-000025"]},{"location":"en/rules/Azure.AKS.ManagedIdentity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource clusterWithPools 'Microsoft.ContainerService/managedClusters@2023-11-01' = {\n  location: location\n  name: name\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    disableLocalAccounts: true\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: [\n      {\n        name: 'system'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 5\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'System'\n        osDiskType: 'Ephemeral'\n      }\n      {\n        name: 'user'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 20\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'User'\n        osDiskType: 'Ephemeral'\n      }\n    ]\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n    }\n    apiServerAccessProfile: {\n      authorizedIPRanges: [\n        '0.0.0.0/32'\n      ]\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    oidcIssuerProfile: {\n      enabled: true\n    }\n    addonProfiles: {\n      azurepolicy: {\n        enabled: true\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.AKS.ManagedIdentity","AZR-000025"]},{"location":"en/rules/Azure.AKS.ManagedIdentity/#notes","title":"Notes","text":"<p>Managed identities can only be configured during initial cluster creation. Existing AKS clusters must be redeployed to enable managed identities.</p>","tags":["Azure.AKS.ManagedIdentity","AZR-000025"]},{"location":"en/rules/Azure.AKS.ManagedIdentity/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>What are managed identities for Azure resources?</li> <li>Use managed identities in Azure Kubernetes Service</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.ManagedIdentity","AZR-000025"]},{"location":"en/rules/Azure.AKS.MinNodeCount/","title":"Minimum number of system nodes in an AKS cluster","text":"Azure.AKS.MinNodeCountAZR-000024Error <p> Reliability  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>AKS clusters should have minimum number of system nodes for failover and updates.</p>","tags":["Azure.AKS.MinNodeCount","AZR-000024"]},{"location":"en/rules/Azure.AKS.MinNodeCount/#description","title":"Description","text":"<p>Azure Kubernetes (AKS) clusters support multiple nodes and node pools. Each node is a virtual machine (VM) that runs Kubernetes components and a container runtime. A node pool is a grouping of nodes that run the same configuration. Application or system pods can be scheduled to run across multiple nodes to ensure resiliency and high availability. AKS supports configuring one or more system node pools, and zero or more user node pools.</p> <p>System node pools are intended for pods that perform important management and infrastructure functions for cluster operation. This includes CoreDNS, konnectivity, and Azure Policy to name a few. The number of pods that are scheduled to run on system node pools varies based on the configuration of your cluster.</p> <p>User node pools are intended for application pods. In general, schedule application workloads to run on user node pools to avoid disrupting the operation of system pods.</p> <p>A minimum number of nodes in each node pool should be maintained to ensure resiliency during node failures or disruptions. Also consider how your nodes are distributed across availability zones when deploying to a supported region. Understanding that adding new nodes to a node pool can take time.</p> <p>For example, in a three-node node pool:</p> <ul> <li>If one node fails ~33% capacity is lost until a new node is created to replace the failed node.</li> <li>The pods running on the failed node may be rescheduled to run on the remaining two nodes if there is enough capacity.   However, there is a number of factors that affect which pods will be scheduled to run on the two remaining nodes.</li> </ul> <p>For example, in a 2x two-node node pool:</p> <ul> <li>If 2x two node pools are deployed both with availability zones <code>1</code>, <code>2</code>.   AKS will automatically spread the nodes across the two availability zones as it scales out.</li> <li>If availability zone <code>1</code> fails, 50% capacity on the remaining nodes in availability zone <code>2</code> will continue to run pods.</li> <li>Pods running on the failed nodes in availability zone <code>1</code> will be rescheduled to run pending enough capacity.</li> </ul>","tags":["Azure.AKS.MinNodeCount","AZR-000024"]},{"location":"en/rules/Azure.AKS.MinNodeCount/#recommendation","title":"Recommendation","text":"<p>Consider configuring AKS clusters with at least three (3) agent nodes in system node pools.</p>","tags":["Azure.AKS.MinNodeCount","AZR-000024"]},{"location":"en/rules/Azure.AKS.MinNodeCount/#examples","title":"Examples","text":"","tags":["Azure.AKS.MinNodeCount","AZR-000024"]},{"location":"en/rules/Azure.AKS.MinNodeCount/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <p>To deploy AKS clusters that pass this rule:</p> <ul> <li>For a single system mode node pool <code>properties.agentPoolProfiles</code>:<ul> <li>Set the <code>minCount</code> property to at least <code>3</code> for node pools with auto-scale. OR</li> <li>Set the <code>count</code> property to at least <code>3</code> for node pools without auto-scale. OR</li> </ul> </li> <li>Deploy an additional system mode node pool so the total number of nodes is at least <code>3</code> across all pools.   For example, two node pools with <code>minCount</code> set to <code>2</code> totalling 4 nodes.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2023-11-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"UserAssigned\",\n    \"userAssignedIdentities\": {\n      \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n    }\n  },\n  \"properties\": {\n    \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n    \"disableLocalAccounts\": true,\n    \"enableRBAC\": true,\n    \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n    \"agentPoolProfiles\": [\n      {\n        \"name\": \"system\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 5,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"System\",\n        \"osDiskType\": \"Ephemeral\"\n      },\n      {\n        \"name\": \"user\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 20,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"User\",\n        \"osDiskType\": \"Ephemeral\"\n      }\n    ],\n    \"aadProfile\": {\n      \"managed\": true,\n      \"enableAzureRBAC\": true,\n      \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n      \"tenantID\": \"[subscription().tenantId]\"\n    },\n    \"networkProfile\": {\n      \"networkPlugin\": \"azure\",\n      \"networkPolicy\": \"azure\",\n      \"loadBalancerSku\": \"standard\",\n      \"serviceCidr\": \"[variables('serviceCidr')]\",\n      \"dnsServiceIP\": \"[variables('dnsServiceIP')]\"\n    },\n    \"apiServerAccessProfile\": {\n      \"authorizedIPRanges\": [\n        \"0.0.0.0/32\"\n      ]\n    },\n    \"autoUpgradeProfile\": {\n      \"upgradeChannel\": \"stable\"\n    },\n    \"oidcIssuerProfile\": {\n      \"enabled\": true\n    },\n    \"addonProfiles\": {\n      \"azurepolicy\": {\n        \"enabled\": true\n      },\n      \"omsagent\": {\n        \"enabled\": true,\n        \"config\": {\n          \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n        }\n      },\n      \"azureKeyvaultSecretsProvider\": {\n        \"enabled\": true,\n        \"config\": {\n          \"enableSecretRotation\": \"true\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.MinNodeCount","AZR-000024"]},{"location":"en/rules/Azure.AKS.MinNodeCount/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>For a single system mode node pool <code>properties.agentPoolProfiles</code>:<ul> <li>Set the <code>minCount</code> property to at least <code>3</code> for node pools with auto-scale. OR</li> <li>Set the <code>count</code> property to at least <code>3</code> for node pools without auto-scale. OR</li> </ul> </li> <li>Deploy an additional system mode node pool so the total number of nodes is at least <code>3</code> across all pools.   For example, two node pools with <code>minCount</code> set to <code>2</code> totalling 4 nodes.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource clusterWithPools 'Microsoft.ContainerService/managedClusters@2023-11-01' = {\n  location: location\n  name: name\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    disableLocalAccounts: true\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: [\n      {\n        name: 'system'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 5\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'System'\n        osDiskType: 'Ephemeral'\n      }\n      {\n        name: 'user'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 20\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'User'\n        osDiskType: 'Ephemeral'\n      }\n    ]\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n    }\n    apiServerAccessProfile: {\n      authorizedIPRanges: [\n        '0.0.0.0/32'\n      ]\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    oidcIssuerProfile: {\n      enabled: true\n    }\n    addonProfiles: {\n      azurepolicy: {\n        enabled: true\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.AKS.MinNodeCount","AZR-000024"]},{"location":"en/rules/Azure.AKS.MinNodeCount/#notes","title":"Notes","text":"","tags":["Azure.AKS.MinNodeCount","AZR-000024"]},{"location":"en/rules/Azure.AKS.MinNodeCount/#rule-configuration","title":"Rule configuration","text":"<p>AZURE_AKS_CLUSTER_MINIMUM_SYSTEM_NODES</p> <p>This rule fails by default if you have less than three (3) nodes in the cluster across all system node pools. To change the default, set the <code>AZURE_AKS_CLUSTER_MINIMUM_SYSTEM_NODES</code> configuration option.</p>","tags":["Azure.AKS.MinNodeCount","AZR-000024"]},{"location":"en/rules/Azure.AKS.MinNodeCount/#links","title":"Links","text":"<ul> <li>RE:05 Redundancy</li> <li>Azure Well-Architected Framework review - Azure Kubernetes Service (AKS)</li> <li>Manage node pools for a cluster in Azure Kubernetes Service (AKS)</li> <li>Manage system node pools in Azure Kubernetes Service (AKS)</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.MinNodeCount","AZR-000024"]},{"location":"en/rules/Azure.AKS.MinUserPoolNodes/","title":"Minimum number of nodes in a user node pool","text":"Azure.AKS.MinUserPoolNodesAZR-000412Error <p> Reliability  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2024_03  \u00b7  Important</p> <p>User node pools in an AKS cluster should have a minimum number of nodes for failover and updates.</p>","tags":["Azure.AKS.MinUserPoolNodes","AZR-000412"]},{"location":"en/rules/Azure.AKS.MinUserPoolNodes/#description","title":"Description","text":"<p>Azure Kubernetes (AKS) clusters support multiple nodes and node pools. Each node is a virtual machine (VM) that runs Kubernetes components and a container runtime. A node pool is a grouping of nodes that run the same configuration. Application or system pods can be scheduled to run across multiple nodes to ensure resiliency and high availability. AKS supports configuring one or more system node pools, and zero or more user node pools.</p> <p>User node pools are intended for application pods.</p> <p>A minimum number of nodes in each node pool should be maintained to ensure resiliency during node failures or disruptions. Resiliency in application pods is also dependent on the number of replicas and the distribution of pods across nodes. Application pods may be configured to use specific node pools based on access features such as GPU or access to storage.</p> <p>Also consider how your nodes are distributed across availability zones when deploying to a supported region. Understanding that adding new nodes to a node pool can take time.</p>","tags":["Azure.AKS.MinUserPoolNodes","AZR-000412"]},{"location":"en/rules/Azure.AKS.MinUserPoolNodes/#recommendation","title":"Recommendation","text":"<p>Consider configuring AKS clusters with at least three (3) agent nodes in each user node pools.</p>","tags":["Azure.AKS.MinUserPoolNodes","AZR-000412"]},{"location":"en/rules/Azure.AKS.MinUserPoolNodes/#examples","title":"Examples","text":"","tags":["Azure.AKS.MinUserPoolNodes","AZR-000412"]},{"location":"en/rules/Azure.AKS.MinUserPoolNodes/#configure-with-azure-template","title":"Configure with Azure template","text":"<ul> <li>For each user node pool <code>properties.agentPoolProfiles</code>:<ul> <li>Set the <code>minCount</code> property to at least <code>3</code> for node pools with auto-scale. OR</li> <li>Set the <code>count</code> property to at least <code>3</code> for node pools without auto-scale.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2023-11-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"UserAssigned\",\n    \"userAssignedIdentities\": {\n      \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n    }\n  },\n  \"properties\": {\n    \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n    \"disableLocalAccounts\": true,\n    \"enableRBAC\": true,\n    \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n    \"agentPoolProfiles\": [\n      {\n        \"name\": \"system\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 5,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"System\",\n        \"osDiskType\": \"Ephemeral\"\n      },\n      {\n        \"name\": \"user\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 20,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"User\",\n        \"osDiskType\": \"Ephemeral\"\n      }\n    ],\n    \"aadProfile\": {\n      \"managed\": true,\n      \"enableAzureRBAC\": true,\n      \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n      \"tenantID\": \"[subscription().tenantId]\"\n    },\n    \"networkProfile\": {\n      \"networkPlugin\": \"azure\",\n      \"networkPolicy\": \"azure\",\n      \"loadBalancerSku\": \"standard\",\n      \"serviceCidr\": \"[variables('serviceCidr')]\",\n      \"dnsServiceIP\": \"[variables('dnsServiceIP')]\"\n    },\n    \"apiServerAccessProfile\": {\n      \"authorizedIPRanges\": [\n        \"0.0.0.0/32\"\n      ]\n    },\n    \"autoUpgradeProfile\": {\n      \"upgradeChannel\": \"stable\"\n    },\n    \"oidcIssuerProfile\": {\n      \"enabled\": true\n    },\n    \"addonProfiles\": {\n      \"azurepolicy\": {\n        \"enabled\": true\n      },\n      \"omsagent\": {\n        \"enabled\": true,\n        \"config\": {\n          \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n        }\n      },\n      \"azureKeyvaultSecretsProvider\": {\n        \"enabled\": true,\n        \"config\": {\n          \"enableSecretRotation\": \"true\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.MinUserPoolNodes","AZR-000412"]},{"location":"en/rules/Azure.AKS.MinUserPoolNodes/#configure-with-bicep","title":"Configure with Bicep","text":"<ul> <li>For each user node pool <code>properties.agentPoolProfiles</code>:<ul> <li>Set the <code>minCount</code> property to at least <code>3</code> for node pools with auto-scale. OR</li> <li>Set the <code>count</code> property to at least <code>3</code> for node pools without auto-scale.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource clusterWithPools 'Microsoft.ContainerService/managedClusters@2023-11-01' = {\n  location: location\n  name: name\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    disableLocalAccounts: true\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: [\n      {\n        name: 'system'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 5\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'System'\n        osDiskType: 'Ephemeral'\n      }\n      {\n        name: 'user'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 20\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'User'\n        osDiskType: 'Ephemeral'\n      }\n    ]\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n    }\n    apiServerAccessProfile: {\n      authorizedIPRanges: [\n        '0.0.0.0/32'\n      ]\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    oidcIssuerProfile: {\n      enabled: true\n    }\n    addonProfiles: {\n      azurepolicy: {\n        enabled: true\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.AKS.MinUserPoolNodes","AZR-000412"]},{"location":"en/rules/Azure.AKS.MinUserPoolNodes/#notes","title":"Notes","text":"<p>Node pools that are configured for spot instances are excluded from this rule. Spot instances can be used for burst capacity but do not provide a guarantee of availability.</p>","tags":["Azure.AKS.MinUserPoolNodes","AZR-000412"]},{"location":"en/rules/Azure.AKS.MinUserPoolNodes/#rule-configuration","title":"Rule configuration","text":"<p>AZURE_AKS_CLUSTER_USER_POOL_MINIMUM_NODES</p> <p>This rule fails by default if you have less than three (3) nodes in each user node pool. To change the default, set the <code>AZURE_AKS_CLUSTER_USER_POOL_MINIMUM_NODES</code> configuration option.</p> <p>AZURE_AKS_CLUSTER_USER_POOL_EXCLUDED_FROM_MINIMUM_NODES</p> <p>To exclude a specific user node pool by name from this rule, set the <code>AZURE_AKS_CLUSTER_USER_POOL_EXCLUDED_FROM_MINIMUM_NODES</code> configuration option.</p>","tags":["Azure.AKS.MinUserPoolNodes","AZR-000412"]},{"location":"en/rules/Azure.AKS.MinUserPoolNodes/#links","title":"Links","text":"<ul> <li>RE:05 Redundancy</li> <li>Azure Well-Architected Framework review - Azure Kubernetes Service (AKS)</li> <li>Manage node pools for a cluster in Azure Kubernetes Service (AKS)</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.MinUserPoolNodes","AZR-000412"]},{"location":"en/rules/Azure.AKS.Name/","title":"Use valid AKS cluster names","text":"Azure.AKS.NameAZR-000039Error <p> Operational Excellence  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Azure Kubernetes Service (AKS) cluster names should meet naming requirements.</p>","tags":["Azure.AKS.Name","AZR-000039"]},{"location":"en/rules/Azure.AKS.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for AKS cluster names are:</p> <ul> <li>Between 1 and 63 characters long.</li> <li>Alphanumerics, underscores, and hyphens.</li> <li>Start and end with alphanumeric.</li> <li>Cluster names must be unique within a resource group.</li> </ul>","tags":["Azure.AKS.Name","AZR-000039"]},{"location":"en/rules/Azure.AKS.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet AKS cluster naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.AKS.Name","AZR-000039"]},{"location":"en/rules/Azure.AKS.Name/#notes","title":"Notes","text":"<p>This rule does not check if cluster names are unique.</p> <p>Cluster DNS prefix has different naming requirements then cluster name. The requirements for DNS prefixes are:</p> <ul> <li>Between 1 and 54 characters long.</li> <li>Alphanumerics and hyphens.</li> <li>Start and end with alphanumeric.</li> </ul>","tags":["Azure.AKS.Name","AZR-000039"]},{"location":"en/rules/Azure.AKS.Name/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Azure resources</li> <li>Recommended abbreviations for Azure resource types</li> <li>Parameters in Bicep</li> <li>Bicep functions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.Name","AZR-000039"]},{"location":"en/rules/Azure.AKS.NetworkPolicy/","title":"AKS network policies are not configured","text":"Azure.AKS.NetworkPolicyAZR-000027Error <p> Security  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement.</p>","tags":["Azure.AKS.NetworkPolicy","AZR-000027"]},{"location":"en/rules/Azure.AKS.NetworkPolicy/#description","title":"Description","text":"<p>AKS clusters provides a platform to host containerized workloads. The running of these applications or services is orchestrated by Kubernetes. Workloads may elastic scale or change network addressing.</p> <p>By default, all pods in an AKS cluster can send and receive traffic without limitations. Network Policy defines access policies for limiting network communication of pods. Using Network Policies allows network controls to be applied with the context of the workload.</p> <p>For improved security, define network policy rules to control the flow of traffic. For example, only permit backend components to receive traffic from frontend components.</p> <p>When network communication is unrestricted, your applications or infrastructure may be exposed to lateral movement. Lateral movement is technique used to bypass controls, increase impact, and escalate privileges.</p> <p>To use Network Policy it must be enabled at cluster deployment time. AKS supports two implementations of network policies, Azure Network Policies and Calico Network Policies. Azure Network Policies are supported by Azure support and engineering teams.</p>","tags":["Azure.AKS.NetworkPolicy","AZR-000027"]},{"location":"en/rules/Azure.AKS.NetworkPolicy/#recommendation","title":"Recommendation","text":"<p>Consider deploying AKS clusters with network policy enabled to extend network segmentation into clusters.</p>","tags":["Azure.AKS.NetworkPolicy","AZR-000027"]},{"location":"en/rules/Azure.AKS.NetworkPolicy/#examples","title":"Examples","text":"","tags":["Azure.AKS.NetworkPolicy","AZR-000027"]},{"location":"en/rules/Azure.AKS.NetworkPolicy/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>properties.networkProfile.networkPolicy</code> to <code>azure</code> or <code>calico</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2023-11-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"UserAssigned\",\n    \"userAssignedIdentities\": {\n      \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n    }\n  },\n  \"properties\": {\n    \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n    \"disableLocalAccounts\": true,\n    \"enableRBAC\": true,\n    \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n    \"agentPoolProfiles\": [\n      {\n        \"name\": \"system\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 5,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"System\",\n        \"osDiskType\": \"Ephemeral\"\n      },\n      {\n        \"name\": \"user\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 20,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"User\",\n        \"osDiskType\": \"Ephemeral\"\n      }\n    ],\n    \"aadProfile\": {\n      \"managed\": true,\n      \"enableAzureRBAC\": true,\n      \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n      \"tenantID\": \"[subscription().tenantId]\"\n    },\n    \"networkProfile\": {\n      \"networkPlugin\": \"azure\",\n      \"networkPolicy\": \"azure\",\n      \"loadBalancerSku\": \"standard\",\n      \"serviceCidr\": \"[variables('serviceCidr')]\",\n      \"dnsServiceIP\": \"[variables('dnsServiceIP')]\"\n    },\n    \"apiServerAccessProfile\": {\n      \"authorizedIPRanges\": [\n        \"0.0.0.0/32\"\n      ]\n    },\n    \"autoUpgradeProfile\": {\n      \"upgradeChannel\": \"stable\"\n    },\n    \"oidcIssuerProfile\": {\n      \"enabled\": true\n    },\n    \"addonProfiles\": {\n      \"azurepolicy\": {\n        \"enabled\": true\n      },\n      \"omsagent\": {\n        \"enabled\": true,\n        \"config\": {\n          \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n        }\n      },\n      \"azureKeyvaultSecretsProvider\": {\n        \"enabled\": true,\n        \"config\": {\n          \"enableSecretRotation\": \"true\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.NetworkPolicy","AZR-000027"]},{"location":"en/rules/Azure.AKS.NetworkPolicy/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>properties.networkProfile.networkPolicy</code> to <code>azure</code> or <code>calico</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource clusterWithPools 'Microsoft.ContainerService/managedClusters@2023-11-01' = {\n  location: location\n  name: name\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    disableLocalAccounts: true\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: [\n      {\n        name: 'system'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 5\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'System'\n        osDiskType: 'Ephemeral'\n      }\n      {\n        name: 'user'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 20\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'User'\n        osDiskType: 'Ephemeral'\n      }\n    ]\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n    }\n    apiServerAccessProfile: {\n      authorizedIPRanges: [\n        '0.0.0.0/32'\n      ]\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    oidcIssuerProfile: {\n      enabled: true\n    }\n    addonProfiles: {\n      azurepolicy: {\n        enabled: true\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.AKS.NetworkPolicy","AZR-000027"]},{"location":"en/rules/Azure.AKS.NetworkPolicy/#notes","title":"Notes","text":"<p>Network Policy can only be set during initial cluster creation. Existing AKS clusters must be redeployed to enable Network Policy.</p>","tags":["Azure.AKS.NetworkPolicy","AZR-000027"]},{"location":"en/rules/Azure.AKS.NetworkPolicy/#links","title":"Links","text":"<ul> <li>SE:04 Segmentation</li> <li>NS-1: Establish network segmentation boundaries</li> <li>Secure traffic between pods using network policies in Azure Kubernetes Service (AKS)</li> <li>Best practices for network connectivity and security in Azure Kubernetes Service (AKS)</li> <li>Network Policies</li> <li>Azure Well-Architected Framework review - Azure Kubernetes Service (AKS)</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.NetworkPolicy","AZR-000027"]},{"location":"en/rules/Azure.AKS.NodeAutoUpgrade/","title":"Azure AKS Node Auto-Upgrade Rule","text":"Azure.AKS.NodeAutoUpgradeAZR-000435Error <p> Security  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2024_06  \u00b7  Important</p> <p>Deploy AKS Clusters with Node Auto-Upgrade enabled</p>","tags":["Azure.AKS.NodeAutoUpgrade","AZR-000435"]},{"location":"en/rules/Azure.AKS.NodeAutoUpgrade/#description","title":"Description","text":"<p>AKS provides multiple auto-upgrade channels dedicated to timely node-level OS security updates. This channel is different from cluster-level Kubernetes version upgrades and supersedes it. Node-level OS security updates are released at a faster rate than Kubernetes patch or minor version updates.</p> <p>The node OS auto-upgrade channel grants you flexibility and enables a customized strategy for node-level OS security updates. Then, you can choose a separate plan for cluster-level Kubernetes version auto-upgrades. It's best to use both cluster-level auto-upgrades and the node OS auto-upgrade channel together. When making changes to node OS auto-upgrade channels, allow up to 24 hours for the changes to take effect.</p> <p>Two channels are available for kubernetes node auto-upgrade are SecurityPatch, NodeImage. For details on the differences between the two channels, see the references below. Once you change from one channel to another channel, a re-image is triggered leading to rolling nodes.</p> <p>Node OS image auto-upgrade won't affect the cluster's Kubernetes version.</p>","tags":["Azure.AKS.NodeAutoUpgrade","AZR-000435"]},{"location":"en/rules/Azure.AKS.NodeAutoUpgrade/#recommendation","title":"Recommendation","text":"<p>AKS clusters should be configured to utilize the SecurityPatch,NodeImage upgrade channels to ensure timely security updates. This will help maintain operational resilience by addressing known security issues and improving overall cluster performance.</p> <p>This practice helps maintain the security and reliability of your AKS clusters aligning with Well Architected Framework principles.</p>","tags":["Azure.AKS.NodeAutoUpgrade","AZR-000435"]},{"location":"en/rules/Azure.AKS.NodeAutoUpgrade/#examples","title":"Examples","text":"","tags":["Azure.AKS.NodeAutoUpgrade","AZR-000435"]},{"location":"en/rules/Azure.AKS.NodeAutoUpgrade/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>properties.autoUpgradeProfile.nodeOSupgradeChannel</code> to <code>SecurityPatch</code> or <code>NodeImage</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.ContainerService/managedClusters\",\n    \"apiVersion\": \"2023-07-01\",\n    \"name\": \"[parameters('clusterName')]\",\n    \"location\": \"[parameters('location')]\",\n    \"identity\": {\n        \"type\": \"UserAssigned\",\n        \"userAssignedIdentities\": {\n            \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n        }\n    },\n    \"properties\": {\n        \"kubernetesVersion\": \"1.29.7\",\n        \"enableRBAC\": true,\n        \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n        \"agentPoolProfiles\": \"[variables('allPools')]\",\n        \"aadProfile\": {\n            \"managed\": true,\n            \"enableAzureRBAC\": true,\n            \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n            \"tenantID\": \"[subscription().tenantId]\"\n        },\n        \"networkProfile\": {\n            \"networkPlugin\": \"azure\",\n            \"networkPolicy\": \"azure\",\n            \"loadBalancerSku\": \"standard\",\n            \"serviceCidr\": \"[variables('serviceCidr')]\",\n            \"dnsServiceIP\": \"[variables('dnsServiceIP')]\",\n            \"dockerBridgeCidr\": \"[variables('dockerBridgeCidr')]\"\n        },\n        \"autoUpgradeProfile\": {\n            \"nodeOSUpgradeChannel\": \"SecurityPatch\"\n        },\n        \"addonProfiles\": {\n            \"httpApplicationRouting\": {\n                \"enabled\": false\n            },\n            \"azurepolicy\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"version\": \"v2\"\n                }\n            },\n            \"omsagent\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n                }\n            },\n            \"kubeDashboard\": {\n                \"enabled\": false\n            },\n            \"azureKeyvaultSecretsProvider\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"enableSecretRotation\": \"true\"\n                }\n            }\n        },\n        \"podIdentityProfile\": {\n            \"enabled\": true\n        }\n    },\n    \"tags\": \"[parameters('tags')]\",\n    \"dependsOn\": [\n        \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n    ]\n}\n</code></pre>","tags":["Azure.AKS.NodeAutoUpgrade","AZR-000435"]},{"location":"en/rules/Azure.AKS.NodeAutoUpgrade/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>properties.autoUpgradeProfile.nodeOSupgradeChannel</code> to <code>SecurityPatch</code> or <code>NodeImage</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cluster 'Microsoft.ContainerService/managedClusters@2023-07-01' = {\n  location: location\n  name: clusterName\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: '1.29.7'\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: allPools\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n      dockerBridgeCidr: dockerBridgeCidr\n    }\n    autoUpgradeProfile: {\n      nodeOSupgradeChannel: 'SecurityPatch'\n    }\n    addonProfiles: {\n      httpApplicationRouting: {\n        enabled: false\n      }\n      azurepolicy: {\n        enabled: true\n        config: {\n          version: 'v2'\n        }\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      kubeDashboard: {\n        enabled: false\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n    podIdentityProfile: {\n      enabled: true\n    }\n  }\n  tags: tags\n}\n</code></pre>","tags":["Azure.AKS.NodeAutoUpgrade","AZR-000435"]},{"location":"en/rules/Azure.AKS.NodeAutoUpgrade/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az aks update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --node-os-upgrade-channel 'securitypatch' . _OR_\n</code></pre> Azure CLI snippet<pre><code>az aks update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --node-os-upgrade-channel 'SecurityPatch'. _OR_ \n</code></pre> Azure CLI snippet<pre><code>az aks update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --node-os-upgrade-channel 'NodeImage'.  \n</code></pre>","tags":["Azure.AKS.NodeAutoUpgrade","AZR-000435"]},{"location":"en/rules/Azure.AKS.NodeAutoUpgrade/#notes","title":"Notes","text":"<p>AKS releases weekly rounds of fixes and feature and component updates that affect all clusters and customers. It's important for you to know when a particular AKS release is hitting your region.</p> <p>AKS release tracker provides  specific component updates present in an AKS version release real time by versions and regions. It also helps you to identify such fixes shipped to a core add-on, and node image updates for Azure Linux, Ubuntu, and Windows.</p>","tags":["Azure.AKS.NodeAutoUpgrade","AZR-000435"]},{"location":"en/rules/Azure.AKS.NodeAutoUpgrade/#links","title":"Links","text":"<ul> <li>SE:01-Security Baseline</li> <li>AutoUpgrade NodeImages</li> <li>NodeImage Upgrade</li> <li>Process Node Updates with Kured</li> <li>NodeOSUpgrade with GithubActions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.NodeAutoUpgrade","AZR-000435"]},{"location":"en/rules/Azure.AKS.NodeMinPods/","title":"Nodes use a minimum number of pods","text":"Azure.AKS.NodeMinPodsAZR-000018Error <p> Performance Efficiency  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods.</p>","tags":["Azure.AKS.NodeMinPods","AZR-000018"]},{"location":"en/rules/Azure.AKS.NodeMinPods/#description","title":"Description","text":"<p>Node pools within a Azure Kubernetes Cluster (AKS) support between 30 and 250 pods per node. The maximum number of pods for nodes within a node pool is set at creation time.</p> <p>When deploying AKS clusters with kubernet networking the default maximum number of pods is 110. For Azure CNI AKS clusters, the default maximum number of pods is 30.</p> <p>In many environments, deploying DaemonSets for monitoring and management tools can exhaust the CNI default.</p> <p>When you are using Azure CNI, ensure that there is enough IP address space in the node pool subnet. Each pod and host requires at least one IP address. Additionally, other resources such as load balancers will consuming additional IP addresses based on configuration. The node pools subnet should have enough IP address space to accommodate the <code>maxCount</code> nodes and nodes added during upgrades.</p>","tags":["Azure.AKS.NodeMinPods","AZR-000018"]},{"location":"en/rules/Azure.AKS.NodeMinPods/#recommendation","title":"Recommendation","text":"<p>Consider deploying node pools with a minimum number of pods per node.</p>","tags":["Azure.AKS.NodeMinPods","AZR-000018"]},{"location":"en/rules/Azure.AKS.NodeMinPods/#examples","title":"Examples","text":"","tags":["Azure.AKS.NodeMinPods","AZR-000018"]},{"location":"en/rules/Azure.AKS.NodeMinPods/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy clusters that pass this rule:</p> <ul> <li>Set the <code>properties.agentPoolProfiles[].maxPods</code> property to at least <code>50</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2023-11-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"UserAssigned\",\n    \"userAssignedIdentities\": {\n      \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n    }\n  },\n  \"properties\": {\n    \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n    \"disableLocalAccounts\": true,\n    \"enableRBAC\": true,\n    \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n    \"agentPoolProfiles\": [\n      {\n        \"name\": \"system\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 5,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"System\",\n        \"osDiskType\": \"Ephemeral\"\n      },\n      {\n        \"name\": \"user\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 20,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"User\",\n        \"osDiskType\": \"Ephemeral\"\n      }\n    ],\n    \"aadProfile\": {\n      \"managed\": true,\n      \"enableAzureRBAC\": true,\n      \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n      \"tenantID\": \"[subscription().tenantId]\"\n    },\n    \"networkProfile\": {\n      \"networkPlugin\": \"azure\",\n      \"networkPolicy\": \"azure\",\n      \"loadBalancerSku\": \"standard\",\n      \"serviceCidr\": \"[variables('serviceCidr')]\",\n      \"dnsServiceIP\": \"[variables('dnsServiceIP')]\"\n    },\n    \"apiServerAccessProfile\": {\n      \"authorizedIPRanges\": [\n        \"0.0.0.0/32\"\n      ]\n    },\n    \"autoUpgradeProfile\": {\n      \"upgradeChannel\": \"stable\"\n    },\n    \"oidcIssuerProfile\": {\n      \"enabled\": true\n    },\n    \"addonProfiles\": {\n      \"azurepolicy\": {\n        \"enabled\": true\n      },\n      \"omsagent\": {\n        \"enabled\": true,\n        \"config\": {\n          \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n        }\n      },\n      \"azureKeyvaultSecretsProvider\": {\n        \"enabled\": true,\n        \"config\": {\n          \"enableSecretRotation\": \"true\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.NodeMinPods","AZR-000018"]},{"location":"en/rules/Azure.AKS.NodeMinPods/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy clusters that pass this rule:</p> <ul> <li>Set the <code>properties.agentPoolProfiles[].maxPods</code> property to at least <code>50</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource clusterWithPools 'Microsoft.ContainerService/managedClusters@2023-11-01' = {\n  location: location\n  name: name\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    disableLocalAccounts: true\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: [\n      {\n        name: 'system'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 5\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'System'\n        osDiskType: 'Ephemeral'\n      }\n      {\n        name: 'user'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 20\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'User'\n        osDiskType: 'Ephemeral'\n      }\n    ]\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n    }\n    apiServerAccessProfile: {\n      authorizedIPRanges: [\n        '0.0.0.0/32'\n      ]\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    oidcIssuerProfile: {\n      enabled: true\n    }\n    addonProfiles: {\n      azurepolicy: {\n        enabled: true\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.AKS.NodeMinPods","AZR-000018"]},{"location":"en/rules/Azure.AKS.NodeMinPods/#notes","title":"Notes","text":"","tags":["Azure.AKS.NodeMinPods","AZR-000018"]},{"location":"en/rules/Azure.AKS.NodeMinPods/#rule-configuration","title":"Rule configuration","text":"<p>AZURE_AKS_POOL_MINIMUM_MAXPODS</p> <p>By default, this rule fails when node pools have <code>maxPods</code> set to less than 50. To configure this rule, override the <code>AZURE_AKS_POOL_MINIMUM_MAXPODS</code> configuration value with the minimum maxPods.</p>","tags":["Azure.AKS.NodeMinPods","AZR-000018"]},{"location":"en/rules/Azure.AKS.NodeMinPods/#links","title":"Links","text":"<ul> <li>PE:05 Scaling and partitioning</li> <li>Plan IP addressing for your cluster</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.NodeMinPods","AZR-000018"]},{"location":"en/rules/Azure.AKS.PlatformLogs/","title":"AKS clusters should collect platform diagnostic logs","text":"Azure.AKS.PlatformLogsAZR-000023Error <p> Operational Excellence  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2021_09  \u00b7  Important</p> <p>AKS clusters should collect platform diagnostic logs to monitor the state of workloads.</p>","tags":["Azure.AKS.PlatformLogs","AZR-000023"]},{"location":"en/rules/Azure.AKS.PlatformLogs/#description","title":"Description","text":"<p>To capture platform logs from AKS clusters, the following diagnostic log/metric categories should be enabled:</p> <ul> <li><code>cluster-autoscaler</code><ul> <li>Understand why the AKS cluster is scaling up or down, which may not be expected. This information is also useful to correlate time intervals where something interesting may have happened in the cluster.</li> </ul> </li> <li><code>kube-apiserver</code><ul> <li>Logs from the Kubernetes API server.</li> </ul> </li> <li><code>kube-controller-manager</code><ul> <li>Gain deeper visibility of issues that may arise between Kubernetes and the Azure control plane. A typical example is the AKS cluster having a lack of permissions to interact with Azure.</li> </ul> </li> <li><code>kube-scheduler</code><ul> <li>Logs from the Kubernetes scheduler.</li> </ul> </li> <li><code>AllMetrics</code><ul> <li>Includes all platform metrics. Sends these values to Log Analytics workspace where it can be evaluated with other data using log queries.</li> </ul> </li> </ul>","tags":["Azure.AKS.PlatformLogs","AZR-000023"]},{"location":"en/rules/Azure.AKS.PlatformLogs/#recommendation","title":"Recommendation","text":"<p>Consider configuring diagnostic settings to capture platform logs from AKS clusters.</p>","tags":["Azure.AKS.PlatformLogs","AZR-000023"]},{"location":"en/rules/Azure.AKS.PlatformLogs/#notes","title":"Notes","text":"<p>Configure <code>AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST</code> to enable selective log categories. By default all log categories are selected, as shown below.</p> <pre><code># YAML: The default AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option\nconfiguration:\n  AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST: ['cluster-autoscaler', 'kube-apiserver', 'kube-controller-manager', 'kube-scheduler', 'AllMetrics']\n</code></pre>","tags":["Azure.AKS.PlatformLogs","AZR-000023"]},{"location":"en/rules/Azure.AKS.PlatformLogs/#examples","title":"Examples","text":"","tags":["Azure.AKS.PlatformLogs","AZR-000023"]},{"location":"en/rules/Azure.AKS.PlatformLogs/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource.</li> <li>Enable logging for the <code>cluster-autoscaler</code>, <code>kube-apiserver</code>, <code>kube-controller-manager</code>, <code>kube-scheduler</code> and <code>AllMetrics</code> categories.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"comments\": \"Azure Kubernetes Cluster\",\n    \"apiVersion\": \"2020-12-01\",\n    \"dependsOn\": [\n        \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n    ],\n    \"type\": \"Microsoft.ContainerService/managedClusters\",\n    \"location\": \"[parameters('location')]\",\n    \"name\": \"[parameters('clusterName')]\",\n    \"identity\": {\n        \"type\": \"UserAssigned\",\n        \"userAssignedIdentities\": {\n            \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\": {}\n        }\n    },\n    \"properties\": {\n        \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n        \"disableLocalAccounts\": true,\n        \"enableRBAC\": true,\n        \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n        \"agentPoolProfiles\": [\n            {\n                \"name\": \"system\",\n                \"osDiskSizeGB\": 32,\n                \"count\": 3,\n                \"minCount\": 3,\n                \"maxCount\": 10,\n                \"enableAutoScaling\": true,\n                \"maxPods\": 50,\n                \"vmSize\": \"Standard_D2s_v3\",\n                \"osType\": \"Linux\",\n                \"type\": \"VirtualMachineScaleSets\",\n                \"vnetSubnetID\": \"[variables('clusterSubnetId')]\",\n                \"mode\": \"System\",\n                \"osDiskType\": \"Ephemeral\",\n                \"scaleSetPriority\": \"Regular\"\n            }\n        ],\n        \"aadProfile\": {\n            \"managed\": true,\n            \"enableAzureRBAC\": true,\n            \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n            \"tenantID\": \"[subscription().tenantId]\"\n        },\n        \"networkProfile\": {\n            \"networkPlugin\": \"azure\",\n            \"networkPolicy\": \"azure\",\n            \"loadBalancerSku\": \"Standard\",\n            \"serviceCidr\": \"192.168.0.0/16\",\n            \"dnsServiceIP\": \"192.168.0.4\",\n            \"dockerBridgeCidr\": \"172.17.0.1/16\"\n        },\n        \"autoUpgradeProfile\": {\n            \"upgradeChannel\": \"stable\"\n        },\n        \"addonProfiles\": {\n            \"azurepolicy\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"version\": \"v2\"\n                }\n            },\n            \"omsagent\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n                }\n            },\n            \"kubeDashboard\": {\n                \"enabled\": false\n            }\n        }\n    },\n    \"resources\": [\n        {\n            \"apiVersion\": \"2016-09-01\",\n            \"type\": \"Microsoft.ContainerService/managedClusters/providers/diagnosticSettings\",\n            \"name\": \"[concat(parameters('clusterName'), '/Microsoft.Insights/service')]\",\n            \"properties\": {\n                \"workspaceId\": \"[parameters('workspaceId')]\",\n                \"logs\": [\n                    {\n                        \"category\": \"kube-apiserver\",\n                        \"enabled\": true,\n                        \"retentionPolicy\": {\n                            \"days\": 0,\n                            \"enabled\": false\n                        }\n                    },\n                    {\n                        \"category\": \"kube-controller-manager\",\n                        \"enabled\": true,\n                        \"retentionPolicy\": {\n                            \"days\": 0,\n                            \"enabled\": false\n                        }\n                    },\n                    {\n                        \"category\": \"kube-scheduler\",\n                        \"enabled\": true,\n                        \"retentionPolicy\": {\n                            \"days\": 0,\n                            \"enabled\": false\n                        }\n                    },\n                    {\n                        \"category\": \"cluster-autoscaler\",\n                        \"enabled\": true,\n                        \"retentionPolicy\": {\n                            \"days\": 0,\n                            \"enabled\": false\n                        }\n                    }\n                ],\n                \"metrics\": [\n                    {\n                        \"category\": \"AllMetrics\",\n                        \"enabled\": true,\n                        \"retentionPolicy\": {\n                            \"days\": 0,\n                            \"enabled\": false\n                        }\n                    }\n                ]\n            }\n        }\n    ]\n}\n</code></pre>","tags":["Azure.AKS.PlatformLogs","AZR-000023"]},{"location":"en/rules/Azure.AKS.PlatformLogs/#links","title":"Links","text":"<ul> <li>Platform Monitoring</li> <li>Monitoring AKS data reference</li> <li>Collect resource logs</li> <li>Template reference</li> </ul>","tags":["Azure.AKS.PlatformLogs","AZR-000023"]},{"location":"en/rules/Azure.AKS.PoolScaleSet/","title":"AKS clusters use VM scale sets","text":"Azure.AKS.PoolScaleSetAZR-000017Error <p> Performance Efficiency  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Deploy AKS clusters with nodes pools based on VM scale sets.</p>","tags":["Azure.AKS.PoolScaleSet","AZR-000017"]},{"location":"en/rules/Azure.AKS.PoolScaleSet/#description","title":"Description","text":"<p>When deploying AKS clusters, Azure node pool VMs can be deployed using Availability Sets or VM Scale Sets. New AKS clusters default to VM scale set node pools.</p> <p>Deploying AKS clusters with scale set node pools is required for some cluster features such as multiple node pools and cluster autoscaler.</p>","tags":["Azure.AKS.PoolScaleSet","AZR-000017"]},{"location":"en/rules/Azure.AKS.PoolScaleSet/#recommendation","title":"Recommendation","text":"<p>Multiple node pools and the cluster autoscaler can be used to improve the scalability and performance of a cluster while minimizing cost.</p> <p>Using VM scale sets is a deployment time configuration. Consider redeploying the AKS cluster with VM Scale Sets instead of Availability Sets.</p>","tags":["Azure.AKS.PoolScaleSet","AZR-000017"]},{"location":"en/rules/Azure.AKS.PoolScaleSet/#examples","title":"Examples","text":"","tags":["Azure.AKS.PoolScaleSet","AZR-000017"]},{"location":"en/rules/Azure.AKS.PoolScaleSet/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy clusters that pass this rule:</p> <ul> <li>Set the <code>properties.agentPoolProfiles[].type</code> property to <code>VirtualMachineScaleSets</code> for each node pool.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2023-04-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"UserAssigned\",\n    \"userAssignedIdentities\": {\n      \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n    }\n  },\n  \"properties\": {\n    \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n    \"disableLocalAccounts\": true,\n    \"enableRBAC\": true,\n    \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n    \"agentPoolProfiles\": [\n      {\n        \"name\": \"system\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 5,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"System\",\n        \"osDiskType\": \"Ephemeral\"\n      },\n      {\n        \"name\": \"user\",\n        \"osDiskSizeGB\": 0,\n        \"minCount\": 3,\n        \"maxCount\": 20,\n        \"enableAutoScaling\": true,\n        \"maxPods\": 50,\n        \"vmSize\": \"Standard_D4s_v5\",\n        \"type\": \"VirtualMachineScaleSets\",\n        \"vnetSubnetID\": \"[parameters('clusterSubnetId')]\",\n        \"mode\": \"User\",\n        \"osDiskType\": \"Ephemeral\"\n      }\n    ],\n    \"aadProfile\": {\n      \"managed\": true,\n      \"enableAzureRBAC\": true,\n      \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n      \"tenantID\": \"[subscription().tenantId]\"\n    },\n    \"networkProfile\": {\n      \"networkPlugin\": \"azure\",\n      \"networkPolicy\": \"azure\",\n      \"loadBalancerSku\": \"standard\",\n      \"serviceCidr\": \"[variables('serviceCidr')]\",\n      \"dnsServiceIP\": \"[variables('dnsServiceIP')]\"\n    },\n    \"autoUpgradeProfile\": {\n      \"upgradeChannel\": \"stable\"\n    },\n    \"oidcIssuerProfile\": {\n      \"enabled\": true\n    },\n    \"addonProfiles\": {\n      \"azurepolicy\": {\n        \"enabled\": true\n      },\n      \"omsagent\": {\n        \"enabled\": true,\n        \"config\": {\n          \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n        }\n      },\n      \"azureKeyvaultSecretsProvider\": {\n        \"enabled\": true,\n        \"config\": {\n          \"enableSecretRotation\": \"true\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"identity\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.PoolScaleSet","AZR-000017"]},{"location":"en/rules/Azure.AKS.PoolScaleSet/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy clusters that pass this rule:</p> <ul> <li>Set the <code>properties.agentPoolProfiles[].type</code> property to <code>VirtualMachineScaleSets</code> for each node pool.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource clusterWithPools 'Microsoft.ContainerService/managedClusters@2023-04-01' = {\n  location: location\n  name: name\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    disableLocalAccounts: true\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: [\n      {\n        name: 'system'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 5\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'System'\n        osDiskType: 'Ephemeral'\n      }\n      {\n        name: 'user'\n        osDiskSizeGB: 0\n        minCount: 3\n        maxCount: 20\n        enableAutoScaling: true\n        maxPods: 50\n        vmSize: 'Standard_D4s_v5'\n        type: 'VirtualMachineScaleSets'\n        vnetSubnetID: clusterSubnetId\n        mode: 'User'\n        osDiskType: 'Ephemeral'\n      }\n    ]\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    oidcIssuerProfile: {\n      enabled: true\n    }\n    addonProfiles: {\n      azurepolicy: {\n        enabled: true\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.AKS.PoolScaleSet","AZR-000017"]},{"location":"en/rules/Azure.AKS.PoolScaleSet/#links","title":"Links","text":"<ul> <li>Plan for growth</li> <li>Create and manage multiple node pools for a cluster in Azure Kubernetes Service (AKS)</li> <li>Scaling options for applications in Azure Kubernetes Service (AKS)</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.PoolScaleSet","AZR-000017"]},{"location":"en/rules/Azure.AKS.PoolVersion/","title":"Upgrade AKS node pool version","text":"Azure.AKS.PoolVersionAZR-000016Error <p> Reliability  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>AKS node pools should match Kubernetes control plane version.</p>","tags":["Azure.AKS.PoolVersion","AZR-000016"]},{"location":"en/rules/Azure.AKS.PoolVersion/#description","title":"Description","text":"<p>AKS supports multiple node pools. In a multi-node pool configuration, it is possible that the control plane and node pools could be running a different version of Kubernetes.</p> <p>Different versions of Kubernetes between the control plane and node pools is intended as a short term option to allow rolling upgrades. For general operation, the control plane and node pool Kubernetes versions should match.</p>","tags":["Azure.AKS.PoolVersion","AZR-000016"]},{"location":"en/rules/Azure.AKS.PoolVersion/#recommendation","title":"Recommendation","text":"<p>Consider upgrading node pools to match AKS control plan version.</p>","tags":["Azure.AKS.PoolVersion","AZR-000016"]},{"location":"en/rules/Azure.AKS.PoolVersion/#links","title":"Links","text":"<ul> <li>Target and non-functional requirements</li> <li>Upgrade a cluster control plane with multiple node pools</li> <li>Supported Kubernetes versions in Azure Kubernetes Service</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.PoolVersion","AZR-000016"]},{"location":"en/rules/Azure.AKS.SecretStore/","title":"AKS clusters use Key Vault to store secrets","text":"Azure.AKS.SecretStoreAZR-000033Error <p> Security  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2021_12  \u00b7  Important</p> <p>Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault.</p>","tags":["Azure.AKS.SecretStore","AZR-000033"]},{"location":"en/rules/Azure.AKS.SecretStore/#description","title":"Description","text":"<p>AKS clusters may need to store and retrieve secrets, keys, and certificates. The Secrets Store CSI Driver provides cluster support to integrate with Key Vault. When enabled and configured secrets, keys, and certificates can be securely accessed from a pod.</p> <p>The Secrets Store CSI Driver can automatically refresh secrets and keys periodically from Key Vault. To enable this feature, enable Secrets Store CSI Driver autorotation.</p> <p>Avoid storing secrets to access Azure resources. Use a Managed Identity when possible instead of cryptographic keys or a regular service principal.</p>","tags":["Azure.AKS.SecretStore","AZR-000033"]},{"location":"en/rules/Azure.AKS.SecretStore/#recommendation","title":"Recommendation","text":"<p>Consider deploying AKS clusters with the Secrets Store CSI Driver and store Secrets in Key Vault.</p>","tags":["Azure.AKS.SecretStore","AZR-000033"]},{"location":"en/rules/Azure.AKS.SecretStore/#examples","title":"Examples","text":"","tags":["Azure.AKS.SecretStore","AZR-000033"]},{"location":"en/rules/Azure.AKS.SecretStore/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>Properties.addonProfiles.azureKeyvaultSecretsProvider.enabled</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.ContainerService/managedClusters\",\n    \"apiVersion\": \"2021-07-01\",\n    \"name\": \"[parameters('clusterName')]\",\n    \"location\": \"[parameters('location')]\",\n    \"identity\": {\n        \"type\": \"UserAssigned\",\n        \"userAssignedIdentities\": {\n            \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n        }\n    },\n    \"properties\": {\n        \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n        \"enableRBAC\": true,\n        \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n        \"agentPoolProfiles\": \"[variables('allPools')]\",\n        \"aadProfile\": {\n            \"managed\": true,\n            \"enableAzureRBAC\": true,\n            \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n            \"tenantID\": \"[subscription().tenantId]\"\n        },\n        \"networkProfile\": {\n            \"networkPlugin\": \"azure\",\n            \"networkPolicy\": \"azure\",\n            \"loadBalancerSku\": \"standard\",\n            \"serviceCidr\": \"[variables('serviceCidr')]\",\n            \"dnsServiceIP\": \"[variables('dnsServiceIP')]\",\n            \"dockerBridgeCidr\": \"[variables('dockerBridgeCidr')]\"\n        },\n        \"autoUpgradeProfile\": {\n            \"upgradeChannel\": \"stable\"\n        },\n        \"addonProfiles\": {\n            \"httpApplicationRouting\": {\n                \"enabled\": false\n            },\n            \"azurepolicy\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"version\": \"v2\"\n                }\n            },\n            \"omsagent\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n                }\n            },\n            \"kubeDashboard\": {\n                \"enabled\": false\n            },\n            \"azureKeyvaultSecretsProvider\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"enableSecretRotation\": \"true\"\n                }\n            }\n        }\n    },\n    \"tags\": \"[parameters('tags')]\",\n    \"dependsOn\": [\n        \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n    ]\n}\n</code></pre>","tags":["Azure.AKS.SecretStore","AZR-000033"]},{"location":"en/rules/Azure.AKS.SecretStore/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>Properties.addonProfiles.azureKeyvaultSecretsProvider.enabled</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cluster 'Microsoft.ContainerService/managedClusters@2021-07-01' = {\n  location: location\n  name: clusterName\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: allPools\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n      dockerBridgeCidr: dockerBridgeCidr\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    addonProfiles: {\n      httpApplicationRouting: {\n        enabled: false\n      }\n      azurepolicy: {\n        enabled: true\n        config: {\n          version: 'v2'\n        }\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      kubeDashboard: {\n        enabled: false\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n  tags: tags\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:0.5.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AKS.SecretStore","AZR-000033"]},{"location":"en/rules/Azure.AKS.SecretStore/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az aks enable-addons --addons azure-keyvault-secrets-provider -n '&lt;name&gt;' -g '&lt;resource_group&gt;'\n</code></pre>","tags":["Azure.AKS.SecretStore","AZR-000033"]},{"location":"en/rules/Azure.AKS.SecretStore/#links","title":"Links","text":"<ul> <li>Key and secret management considerations in Azure</li> <li>Operational considerations</li> <li>Use the Azure Key Vault Provider for Secrets Store CSI Driver in an AKS cluster</li> <li>Automate the rotation of a secret for resources that use one set of authentication credentials</li> <li>Automate the rotation of a secret for resources that have two sets of authentication credentials</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.SecretStore","AZR-000033"]},{"location":"en/rules/Azure.AKS.SecretStoreRotation/","title":"AKS clusters refresh secrets from Key Vault","text":"Azure.AKS.SecretStoreRotationAZR-000034Error <p> Security  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2021_12  \u00b7  Important</p> <p>Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters.</p>","tags":["Azure.AKS.SecretStoreRotation","AZR-000034"]},{"location":"en/rules/Azure.AKS.SecretStoreRotation/#description","title":"Description","text":"<p>AKS clusters may need to store and retrieve secrets, keys, and certificates. The Secrets Store CSI Driver provides cluster support to integrate with Key Vault. When enabled and configured secrets, keys, and certificates can be securely accessed from a pod.</p> <p>When secrets are updated in Key Vault, pods may need to be restarted to pick up the new secrets. Enabling autorotation with the Secrets Store CSI Driver, automatically refreshed pods with new secrets. It does this by periodically polling for updates to the secrets in Key Vault. The default interval is every 2 minutes.</p> <p>The Secrets Store CSI Driver does not automatically change secrets in Key Vault. Updating the secrets in Key Vault must be done by an external process, such as an Azure Function.</p>","tags":["Azure.AKS.SecretStoreRotation","AZR-000034"]},{"location":"en/rules/Azure.AKS.SecretStoreRotation/#recommendation","title":"Recommendation","text":"<p>Consider enabling autorotation of Secrets Store CSI Driver secrets for AKS clusters.</p>","tags":["Azure.AKS.SecretStoreRotation","AZR-000034"]},{"location":"en/rules/Azure.AKS.SecretStoreRotation/#examples","title":"Examples","text":"","tags":["Azure.AKS.SecretStoreRotation","AZR-000034"]},{"location":"en/rules/Azure.AKS.SecretStoreRotation/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>Properties.addonProfiles.azureKeyvaultSecretsProvider.config.enableSecretRotation</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.ContainerService/managedClusters\",\n    \"apiVersion\": \"2021-07-01\",\n    \"name\": \"[parameters('clusterName')]\",\n    \"location\": \"[parameters('location')]\",\n    \"identity\": {\n        \"type\": \"UserAssigned\",\n        \"userAssignedIdentities\": {\n            \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n        }\n    },\n    \"properties\": {\n        \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n        \"enableRBAC\": true,\n        \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n        \"agentPoolProfiles\": \"[variables('allPools')]\",\n        \"aadProfile\": {\n            \"managed\": true,\n            \"enableAzureRBAC\": true,\n            \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n            \"tenantID\": \"[subscription().tenantId]\"\n        },\n        \"networkProfile\": {\n            \"networkPlugin\": \"azure\",\n            \"networkPolicy\": \"azure\",\n            \"loadBalancerSku\": \"standard\",\n            \"serviceCidr\": \"[variables('serviceCidr')]\",\n            \"dnsServiceIP\": \"[variables('dnsServiceIP')]\",\n            \"dockerBridgeCidr\": \"[variables('dockerBridgeCidr')]\"\n        },\n        \"autoUpgradeProfile\": {\n            \"upgradeChannel\": \"stable\"\n        },\n        \"addonProfiles\": {\n            \"httpApplicationRouting\": {\n                \"enabled\": false\n            },\n            \"azurepolicy\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"version\": \"v2\"\n                }\n            },\n            \"omsagent\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n                }\n            },\n            \"kubeDashboard\": {\n                \"enabled\": false\n            },\n            \"azureKeyvaultSecretsProvider\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"enableSecretRotation\": \"true\"\n                }\n            }\n        }\n    },\n    \"tags\": \"[parameters('tags')]\",\n    \"dependsOn\": [\n        \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n    ]\n}\n</code></pre>","tags":["Azure.AKS.SecretStoreRotation","AZR-000034"]},{"location":"en/rules/Azure.AKS.SecretStoreRotation/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>Properties.addonProfiles.azureKeyvaultSecretsProvider.config.enableSecretRotation</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cluster 'Microsoft.ContainerService/managedClusters@2021-07-01' = {\n  location: location\n  name: clusterName\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: allPools\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n      dockerBridgeCidr: dockerBridgeCidr\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    addonProfiles: {\n      httpApplicationRouting: {\n        enabled: false\n      }\n      azurepolicy: {\n        enabled: true\n        config: {\n          version: 'v2'\n        }\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      kubeDashboard: {\n        enabled: false\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n  tags: tags\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:0.5.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AKS.SecretStoreRotation","AZR-000034"]},{"location":"en/rules/Azure.AKS.SecretStoreRotation/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az aks update --enable-secret-rotation -n '&lt;name&gt;' -g '&lt;resource_group&gt;'\n</code></pre>","tags":["Azure.AKS.SecretStoreRotation","AZR-000034"]},{"location":"en/rules/Azure.AKS.SecretStoreRotation/#links","title":"Links","text":"<ul> <li>Key and secret management considerations in Azure</li> <li>Operational considerations</li> <li>Use the Azure Key Vault Provider for Secrets Store CSI Driver in an AKS cluster</li> <li>Automate the rotation of a secret for resources that use one set of authentication credentials</li> <li>Automate the rotation of a secret for resources that have two sets of authentication credentials</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.SecretStoreRotation","AZR-000034"]},{"location":"en/rules/Azure.AKS.StandardLB/","title":"Use the Standard load balancer SKU","text":"Azure.AKS.StandardLBAZR-000026Error <p> Performance Efficiency  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU.</p>","tags":["Azure.AKS.StandardLB","AZR-000026"]},{"location":"en/rules/Azure.AKS.StandardLB/#description","title":"Description","text":"<p>When deploying an AKS cluster, either a Standard or Basic load balancer SKU can be configured. A Standard load balancer SKU is required for several AKS features including:</p> <ul> <li>Multiple node pools</li> <li>Availability zones</li> <li>Authorized IP ranges</li> </ul> <p>These features improve the scalability and reliability of the cluster.</p> <p>AKS clusters can not be updated to use a Standard load balancer SKU after deployment. For switch to an Standard load balancer SKU, the cluster must be redeployed.</p>","tags":["Azure.AKS.StandardLB","AZR-000026"]},{"location":"en/rules/Azure.AKS.StandardLB/#recommendation","title":"Recommendation","text":"<p>Consider using Standard load balancer SKU during AKS cluster creation. Additionally, consider redeploying the AKS clusters with a Standard load balancer SKU configured.</p>","tags":["Azure.AKS.StandardLB","AZR-000026"]},{"location":"en/rules/Azure.AKS.StandardLB/#examples","title":"Examples","text":"","tags":["Azure.AKS.StandardLB","AZR-000026"]},{"location":"en/rules/Azure.AKS.StandardLB/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy clusters that pass this rule:</p> <ul> <li>Set the <code>properties.networkProfile.loadBalancerSku</code> property to <code>standard</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2023-04-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"UserAssigned\",\n    \"userAssignedIdentities\": {\n      \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n    }\n  },\n  \"properties\": {\n    \"kubernetesVersion\": \"[parameters('kubernetesVersion')]\",\n    \"disableLocalAccounts\": true,\n    \"enableRBAC\": true,\n    \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n    \"agentPoolProfiles\": \"[variables('allPools')]\",\n    \"aadProfile\": {\n      \"managed\": true,\n      \"enableAzureRBAC\": true,\n      \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n      \"tenantID\": \"[subscription().tenantId]\"\n    },\n    \"networkProfile\": {\n      \"networkPlugin\": \"azure\",\n      \"networkPolicy\": \"azure\",\n      \"loadBalancerSku\": \"standard\",\n      \"serviceCidr\": \"[variables('serviceCidr')]\",\n      \"dnsServiceIP\": \"[variables('dnsServiceIP')]\"\n    },\n    \"autoUpgradeProfile\": {\n      \"upgradeChannel\": \"stable\"\n    },\n    \"oidcIssuerProfile\": {\n      \"enabled\": true\n    },\n    \"addonProfiles\": {\n      \"azurepolicy\": {\n        \"enabled\": true\n      },\n      \"omsagent\": {\n        \"enabled\": true,\n        \"config\": {\n          \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n        }\n      },\n      \"azureKeyvaultSecretsProvider\": {\n        \"enabled\": true,\n        \"config\": {\n          \"enableSecretRotation\": \"true\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"identity\"\n  ]\n}\n</code></pre>","tags":["Azure.AKS.StandardLB","AZR-000026"]},{"location":"en/rules/Azure.AKS.StandardLB/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy clusters that pass this rule:</p> <ul> <li>Set the <code>properties.networkProfile.loadBalancerSku</code> property to <code>standard</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cluster 'Microsoft.ContainerService/managedClusters@2023-04-01' = {\n  location: location\n  name: name\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: kubernetesVersion\n    disableLocalAccounts: true\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: allPools\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    oidcIssuerProfile: {\n      enabled: true\n    }\n    addonProfiles: {\n      azurepolicy: {\n        enabled: true\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.AKS.StandardLB","AZR-000026"]},{"location":"en/rules/Azure.AKS.StandardLB/#links","title":"Links","text":"<ul> <li>Plan for growth</li> <li>Use a Standard SKU load balancer in Azure Kubernetes Service (AKS)</li> <li>LoadBalancer annotations</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.StandardLB","AZR-000026"]},{"location":"en/rules/Azure.AKS.UptimeSLA/","title":"Azure.AKS.UptimeSLA","text":""},{"location":"en/rules/Azure.AKS.UptimeSLA/#online-version-httpsazuregithubiopsrulerulesazureenrulesazureaksuptimesla","title":"online version: https://azure.github.io/PSRule.Rules.Azure/en/rules/Azure.AKS.UptimeSLA/","text":""},{"location":"en/rules/Azure.AKS.UptimeSLA/#use-aks-uptime-sla","title":"Use AKS Uptime SLA","text":"<p>AKS clusters should have Uptime SLA enabled for a financially backed SLA.</p>"},{"location":"en/rules/Azure.AKS.UptimeSLA/#description","title":"Description","text":"<p>Azure Kubernetes Service (AKS) offers two pricing tiers for cluster management.</p> <p>The <code>Standard</code> tier is suitable for financially backed SLA scenarios as it enables Uptime SLA by default on the cluster.</p> <p>Benefits:</p> <ul> <li>The Free tier SKU imposes in-flight request limits of 50 mutating and 100 read-only calls.   The Standard tier SKU automatically scales out based on the load.</li> <li>The Free tier SKU is recommended only for cost-sensitive non-production workloads with 10 or fewer agent nodes.   The Standard tier SKU configures more resources for the control plane and will dynamically scale to handle the request load from more nodes.</li> <li>AKS recommends the use of the Standard tier for production workloads to ensure availability of control plane components.   Clusters on the Free tier, by contrast come with limited resources for the control plane and are not suitable for production workloads.</li> <li>Uptime SLA guarantees 99.95% availability of the Kubernetes API server endpoint for clusters that use Availability Zones.</li> <li>Uptime SLA guarantees 99.9% of availability for clusters that don't use Availability Zones.</li> <li>AKS uses master node replicas across update and fault domains to ensure SLA requirements are met.</li> </ul>"},{"location":"en/rules/Azure.AKS.UptimeSLA/#recommendation","title":"Recommendation","text":"<p>Consider enabling Uptime SLA for a financially backed SLA.</p>"},{"location":"en/rules/Azure.AKS.UptimeSLA/#examples","title":"Examples","text":""},{"location":"en/rules/Azure.AKS.UptimeSLA/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy an AKS cluster that pass this rule:</p> <ul> <li>Set the <code>sku.tier</code> property to <code>Standard</code>.</li> </ul> <p>For example:</p> <pre><code>{\n  \"type\": \"Microsoft.ContainerService/managedClusters\",\n  \"apiVersion\": \"2023-02-01\",\n  \"name\": \"[parameters('clusterName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Basic\",\n    \"tier\": \"Standard\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n    \"agentPoolProfiles\": [\n      {\n        \"name\": \"agentpool\",\n        \"osDiskSizeGB\": \"[parameters('osDiskSizeGB')]\",\n        \"count\": \"[parameters('agentCount')]\",\n        \"vmSize\": \"[parameters('agentVMSize')]\",\n        \"osType\": \"Linux\",\n        \"mode\": \"System\"\n      }\n    ],\n    \"linuxProfile\": {\n      \"adminUsername\": \"[parameters('linuxAdminUsername')]\",\n      \"ssh\": {\n        \"publicKeys\": [\n          {\n            \"keyData\": \"[parameters('sshRSAPublicKey')]\"\n          }\n        ]\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"en/rules/Azure.AKS.UptimeSLA/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy an AKS cluster that pass this rule:</p> <ul> <li>Set the <code>sku.tier</code> property to <code>Standard</code>.</li> </ul> <p>For example:</p> <pre><code>resource aks 'Microsoft.ContainerService/managedClusters@2023-02-01' = {\n  name: clusterName\n  location: location\n  sku: {\n    name: 'Basic'\n    tier: 'Standard'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: [\n      {\n        name: 'agentpool'\n        osDiskSizeGB: osDiskSizeGB\n        count: agentCount\n        vmSize: agentVMSize\n        osType: 'Linux'\n        mode: 'System'\n      }\n    ]\n    linuxProfile: {\n      adminUsername: linuxAdminUsername\n      ssh: {\n        publicKeys: [\n          {\n            keyData: sshRSAPublicKey\n          }\n        ]\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/container-service/managed-cluster:0.5.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>"},{"location":"en/rules/Azure.AKS.UptimeSLA/#notes","title":"Notes","text":"<p><code>Basic</code> and <code>Paid</code> are removed in the <code>2023-02-01</code> and <code>2023-02-02 Preview</code> API version, and this will be a breaking change in API versions <code>2023-02-01</code> and <code>2023-02-02 Preview</code> or newer.</p>"},{"location":"en/rules/Azure.AKS.UptimeSLA/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Azure Kubernetes Service (AKS) Uptime SLA</li> <li>Free and Standard pricing tiers for Azure Kubernetes Service (AKS) cluster management</li> <li>Azure deployment reference</li> </ul>"},{"location":"en/rules/Azure.AKS.UseRBAC/","title":"AKS clusters use RBAC","text":"Azure.AKS.UseRBACAZR-000038Error <p> Security  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Deploy AKS cluster with role-based access control (RBAC) enabled.</p>","tags":["Azure.AKS.UseRBAC","AZR-000038"]},{"location":"en/rules/Azure.AKS.UseRBAC/#description","title":"Description","text":"<p>AKS supports granting access to cluster resources using role-based access control (RBAC). Additionally Azure Active Directory (AAD) integration with AKS allows, RBAC to be granted based on AAD user or group.</p>","tags":["Azure.AKS.UseRBAC","AZR-000038"]},{"location":"en/rules/Azure.AKS.UseRBAC/#recommendation","title":"Recommendation","text":"<p>Azure AD integration with AKS provides granular access control for Kubernetes resources using RBAC.</p> <p>RBAC is a deployment time configuration. Consider redeploying the AKS cluster with RBAC enabled.</p>","tags":["Azure.AKS.UseRBAC","AZR-000038"]},{"location":"en/rules/Azure.AKS.UseRBAC/#links","title":"Links","text":"<ul> <li>Access and identity options for Azure Kubernetes Service (AKS)</li> <li>Authorization with Azure AD</li> <li>Best practices for authentication and authorization in Azure Kubernetes Service (AKS)</li> <li>Using RBAC Authorization</li> <li>Azure deployment reference</li> <li>Use role-based access control (RBAC)</li> </ul>","tags":["Azure.AKS.UseRBAC","AZR-000038"]},{"location":"en/rules/Azure.AKS.Version/","title":"Upgrade Kubernetes version","text":"Azure.AKS.VersionAZR-000015Error <p> Reliability  \u00b7  Azure Kubernetes Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>AKS control plane and nodes pools should use a current stable release.</p>","tags":["Azure.AKS.Version","AZR-000015"]},{"location":"en/rules/Azure.AKS.Version/#description","title":"Description","text":"<p>The AKS Kubernetes support policy provides support for the latest generally available (GA) three minor versions (N-2). This version support policy is based on the Kubernetes community support policy, who maintain the Kubernetes project. As the Kubernetes releases new minor versions, the old minor versions are deprecated and eventually removed from support.</p> <p>When your cluster or cluster nodes are running a version that is no longer supported, you may:</p> <ul> <li>Encounter issues that may adversely affect the reliability of your cluster and cause down time.</li> <li>Have bugs or security vulnerabilities that have already been mitigated by the Kubernetes community.</li> <li>Introduce additional risk to your cluster and applications when you upgrade to a supported version.</li> </ul> <p>Additionally, AKS provides Platform Support for subset of components following an N-3.</p> <p>AKS supports a feature called cluster auto-upgrade, which can be used to reduce operational overhead of upgrading your cluster. This feature allows you to configure your cluster to automatically upgrade to the latest supported minor version of Kubernetes. When you enable cluster auto-upgrade, the control plane and node pools are upgraded to the latest supported minor version. Two channels are available for cluster auto-upgrade that maintain Kubernetes minor versions <code>stable</code> and <code>rapid</code>. For details on the differences between the two channels, see the references below.</p> <p>You are able to define a planned maintenance window to schedule and control upgrades to your cluster. Use the Planned Maintenance window to schedule upgrades to your cluster during times of low business impact. Alternatively, consider using blue / green clusters.</p>","tags":["Azure.AKS.Version","AZR-000015"]},{"location":"en/rules/Azure.AKS.Version/#recommendation","title":"Recommendation","text":"<p>Consider upgrading AKS control plane and nodes pools to the latest stable version of Kubernetes. Also consider enabling cluster auto-upgrade within a maintenance window to minimize operational overhead of cluster upgrades.</p>","tags":["Azure.AKS.Version","AZR-000015"]},{"location":"en/rules/Azure.AKS.Version/#examples","title":"Examples","text":"","tags":["Azure.AKS.Version","AZR-000015"]},{"location":"en/rules/Azure.AKS.Version/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>properties.autoUpgradeProfile.upgradeChannel</code> to <code>rapid</code> or <code>stable</code>. OR</li> <li>Set <code>properties.kubernetesVersion</code> to a newer stable version.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.ContainerService/managedClusters\",\n    \"apiVersion\": \"2023-07-01\",\n    \"name\": \"[parameters('clusterName')]\",\n    \"location\": \"[parameters('location')]\",\n    \"identity\": {\n        \"type\": \"UserAssigned\",\n        \"userAssignedIdentities\": {\n            \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName')))]\": {}\n        }\n    },\n    \"properties\": {\n        \"kubernetesVersion\": \"1.29.7\",\n        \"enableRBAC\": true,\n        \"dnsPrefix\": \"[parameters('dnsPrefix')]\",\n        \"agentPoolProfiles\": \"[variables('allPools')]\",\n        \"aadProfile\": {\n            \"managed\": true,\n            \"enableAzureRBAC\": true,\n            \"adminGroupObjectIDs\": \"[parameters('clusterAdmins')]\",\n            \"tenantID\": \"[subscription().tenantId]\"\n        },\n        \"networkProfile\": {\n            \"networkPlugin\": \"azure\",\n            \"networkPolicy\": \"azure\",\n            \"loadBalancerSku\": \"standard\",\n            \"serviceCidr\": \"[variables('serviceCidr')]\",\n            \"dnsServiceIP\": \"[variables('dnsServiceIP')]\",\n            \"dockerBridgeCidr\": \"[variables('dockerBridgeCidr')]\"\n        },\n        \"autoUpgradeProfile\": {\n            \"upgradeChannel\": \"stable\"\n        },\n        \"addonProfiles\": {\n            \"httpApplicationRouting\": {\n                \"enabled\": false\n            },\n            \"azurepolicy\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"version\": \"v2\"\n                }\n            },\n            \"omsagent\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"logAnalyticsWorkspaceResourceID\": \"[parameters('workspaceId')]\"\n                }\n            },\n            \"kubeDashboard\": {\n                \"enabled\": false\n            },\n            \"azureKeyvaultSecretsProvider\": {\n                \"enabled\": true,\n                \"config\": {\n                    \"enableSecretRotation\": \"true\"\n                }\n            }\n        },\n        \"podIdentityProfile\": {\n            \"enabled\": true\n        }\n    },\n    \"tags\": \"[parameters('tags')]\",\n    \"dependsOn\": [\n        \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('identityName'))]\"\n    ]\n}\n</code></pre>","tags":["Azure.AKS.Version","AZR-000015"]},{"location":"en/rules/Azure.AKS.Version/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AKS clusters that pass this rule:</p> <ul> <li>Set <code>properties.autoUpgradeProfile.upgradeChannel</code> to <code>rapid</code> or <code>stable</code>. OR</li> <li>Set <code>properties.kubernetesVersion</code> to a newer stable version.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cluster 'Microsoft.ContainerService/managedClusters@2023-07-01' = {\n  location: location\n  name: clusterName\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    kubernetesVersion: '1.29.7'\n    enableRBAC: true\n    dnsPrefix: dnsPrefix\n    agentPoolProfiles: allPools\n    aadProfile: {\n      managed: true\n      enableAzureRBAC: true\n      adminGroupObjectIDs: clusterAdmins\n      tenantID: subscription().tenantId\n    }\n    networkProfile: {\n      networkPlugin: 'azure'\n      networkPolicy: 'azure'\n      loadBalancerSku: 'standard'\n      serviceCidr: serviceCidr\n      dnsServiceIP: dnsServiceIP\n      dockerBridgeCidr: dockerBridgeCidr\n    }\n    autoUpgradeProfile: {\n      upgradeChannel: 'stable'\n    }\n    addonProfiles: {\n      httpApplicationRouting: {\n        enabled: false\n      }\n      azurepolicy: {\n        enabled: true\n        config: {\n          version: 'v2'\n        }\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      kubeDashboard: {\n        enabled: false\n      }\n      azureKeyvaultSecretsProvider: {\n        enabled: true\n        config: {\n          enableSecretRotation: 'true'\n        }\n      }\n    }\n    podIdentityProfile: {\n      enabled: true\n    }\n  }\n  tags: tags\n}\n</code></pre>","tags":["Azure.AKS.Version","AZR-000015"]},{"location":"en/rules/Azure.AKS.Version/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az aks update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --auto-upgrade-channel 'stable'\n</code></pre> Azure CLI snippet<pre><code>az aks upgrade -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --kubernetes-version '1.29.7'\n</code></pre>","tags":["Azure.AKS.Version","AZR-000015"]},{"location":"en/rules/Azure.AKS.Version/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Set-AzAksCluster -Name '&lt;name&gt;' -ResourceGroupName '&lt;resource_group&gt;' -KubernetesVersion '1.29.7'\n</code></pre>","tags":["Azure.AKS.Version","AZR-000015"]},{"location":"en/rules/Azure.AKS.Version/#notes","title":"Notes","text":"<p>A list of available Kubernetes versions can be found using the <code>az aks get-versions -o table --location &lt;location&gt;</code> CLI command.</p> <p>If you must maintain AKS clusters for longer then the community support period, consider switching to Long Term Support (LTS). AKS LTS provides support for a specific Kubernetes version for a longer period of time. The first LTS release is 1.27.</p>","tags":["Azure.AKS.Version","AZR-000015"]},{"location":"en/rules/Azure.AKS.Version/#rule-configuration","title":"Rule configuration","text":"<p>AZURE_AKS_CLUSTER_MINIMUM_VERSION</p> <p>To configure this rule override the <code>AZURE_AKS_CLUSTER_MINIMUM_VERSION</code> configuration value with the minimum Kubernetes version.</p>","tags":["Azure.AKS.Version","AZR-000015"]},{"location":"en/rules/Azure.AKS.Version/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Automatically upgrade an Azure Kubernetes Service cluster</li> <li>Supported Kubernetes versions in Azure Kubernetes Service</li> <li>Support policies for Azure Kubernetes Service</li> <li>Platform support policy</li> <li>Blue-green deployment of AKS clusters</li> <li>Long Term Support (LTS)</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AKS.Version","AZR-000015"]},{"location":"en/rules/Azure.APIM.APIDescriptors/","title":"Use API descriptors","text":"Azure.APIM.APIDescriptorsAZR-000043Warning <p> Operational Excellence  \u00b7  API Management  \u00b7  Rule  \u00b7  2020_09  \u00b7  Awareness</p> <p>APIs should have a display name and description.</p>","tags":["Azure.APIM.APIDescriptors","AZR-000043"]},{"location":"en/rules/Azure.APIM.APIDescriptors/#description","title":"Description","text":"<p>Each API created in API Management can have a display name and description set. Using easy to understand descriptions and metadata greatly assist identification for management and usage.</p> <p>During monitoring from service provider and consumer perspectives:</p> <ul> <li>Having a clear understanding of the purpose of an API is often important to during analysis.</li> <li>Allows for accurate management and clean up of unused APIs.</li> </ul> <p>This information is visible within the developer portal and exported OpenAPI definitions.</p>","tags":["Azure.APIM.APIDescriptors","AZR-000043"]},{"location":"en/rules/Azure.APIM.APIDescriptors/#recommendation","title":"Recommendation","text":"<p>Consider using display name and description fields on APIs to convey intended purpose and usage. Display name and description fields should be human readable and easy to understand.</p>","tags":["Azure.APIM.APIDescriptors","AZR-000043"]},{"location":"en/rules/Azure.APIM.APIDescriptors/#examples","title":"Examples","text":"","tags":["Azure.APIM.APIDescriptors","AZR-000043"]},{"location":"en/rules/Azure.APIM.APIDescriptors/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy API Management APIs that pass this rule:</p> <ul> <li>Set the <code>properties.displayName</code> with a human readable name.</li> <li>Set the <code>properties.description</code> with an description of the APIs purpose.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ApiManagement/service/apis\",\n  \"apiVersion\": \"2022-08-01\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), 'echo-v1')]\",\n  \"properties\": {\n    \"displayName\": \"Echo API\",\n    \"description\": \"An echo API service.\",\n    \"type\": \"http\",\n    \"path\": \"echo\",\n    \"serviceUrl\": \"https://echo.contoso.com\",\n    \"protocols\": [\n      \"https\"\n    ],\n    \"apiVersion\": \"v1\",\n    \"apiVersionSetId\": \"[resourceId('Microsoft.ApiManagement/service/apiVersionSets', parameters('name'), 'echo')]\",\n    \"subscriptionRequired\": true\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ApiManagement/service', parameters('name'))]\",\n    \"[resourceId('Microsoft.ApiManagement/service/apiVersionSets', parameters('name'), 'echo')]\"\n  ]\n}\n</code></pre>","tags":["Azure.APIM.APIDescriptors","AZR-000043"]},{"location":"en/rules/Azure.APIM.APIDescriptors/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy API Management APIs that pass this rule:</p> <ul> <li>Set the <code>properties.displayName</code> with a human readable name.</li> <li>Set the <code>properties.description</code> with an description of the APIs purpose.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource api 'Microsoft.ApiManagement/service/apis@2022-08-01' = {\n  parent: service\n  name: 'echo-v1'\n  properties: {\n    displayName: 'Echo API'\n    description: 'An echo API service.'\n    type: 'http'\n    path: 'echo'\n    serviceUrl: 'https://echo.contoso.com'\n    protocols: [\n      'https'\n    ]\n    apiVersion: 'v1'\n    apiVersionSetId: version.id\n    subscriptionRequired: true\n  }\n}\n</code></pre>","tags":["Azure.APIM.APIDescriptors","AZR-000043"]},{"location":"en/rules/Azure.APIM.APIDescriptors/#links","title":"Links","text":"<ul> <li>OE:04 Tools and processes</li> <li>Import and publish your first API</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.APIDescriptors","AZR-000043"]},{"location":"en/rules/Azure.APIM.AvailabilityZone/","title":"API management instances should use availability zones in supported regions","text":"Azure.APIM.AvailabilityZoneAZR-000052Error <p> Reliability  \u00b7  API Management  \u00b7  Rule  \u00b7  2024_06  \u00b7  Important</p> <p>API Management instances should use availability zones in supported regions for high availability.</p>","tags":["Azure.APIM.AvailabilityZone","AZR-000052"]},{"location":"en/rules/Azure.APIM.AvailabilityZone/#description","title":"Description","text":"<p>API Management supports using availability zones to provide zone redundency for key components. Zone redundancy improves resiliency and high availability of the service by deploying scale units across data centers in physically separated zones.</p> <p>The following are required to deploy a zone redundant configuration:</p> <ul> <li>API Management is deployed with the Premium SKU.</li> <li>At least two scale units must be deployed in separate availbility zones.</li> </ul> <p>Zone redundancy has a different configuration for the primary and additional regions:</p> <ul> <li>In the primary region, all service components are replicated across zones (gateway, management plane, and developer portal).</li> <li>In additional regions, only the gateway is replicated across zones.   As the management plane/developer portal service components are only deployed to the primary region.</li> </ul>","tags":["Azure.APIM.AvailabilityZone","AZR-000052"]},{"location":"en/rules/Azure.APIM.AvailabilityZone/#recommendation","title":"Recommendation","text":"<p>Consider using at least two (2) scale units and availability zones to improve resiliency of API Management instances to zone failures.</p>","tags":["Azure.APIM.AvailabilityZone","AZR-000052"]},{"location":"en/rules/Azure.APIM.AvailabilityZone/#examples","title":"Examples","text":"","tags":["Azure.APIM.AvailabilityZone","AZR-000052"]},{"location":"en/rules/Azure.APIM.AvailabilityZone/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To set availability zones for a API Management instance:</p> <ul> <li>Set <code>zones</code> to a minimum of two zones from <code>[\"1\", \"2\", \"3\"]</code>, ensuring the number of zones match <code>sku.capacity</code>.</li> <li>Set <code>properties.additionalLocations[*].zones</code> to a minimum of two zones from <code>[\"1\", \"2\", \"3\"]</code>, ensuring the number of zones match <code>properties.additionalLocations[*].sku.capacity</code>. </li> <li>Set <code>sku.name</code> and/or <code>properties.additionalLocations[*].sku.name</code> to <code>Premium</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.ApiManagement/service\",\n    \"apiVersion\": \"2021-01-01-preview\",\n    \"name\": \"[parameters('service_api_mgmt_test2_name')]\",\n    \"location\": \"Australia East\",\n    \"sku\": {\n        \"name\": \"Premium\",\n        \"capacity\": 3\n    },\n    \"zones\": [\n        \"1\",\n        \"2\",\n        \"3\"\n    ],\n    \"properties\": {\n        \"publisherEmail\": \"john.doe@contoso.com\",\n        \"publisherName\": \"contoso\",\n        \"notificationSenderEmail\": \"apimgmt-noreply@mail.windowsazure.com\",\n        \"hostnameConfigurations\": [\n            {\n                \"type\": \"Proxy\",\n                \"hostName\": \"[concat(parameters('service_api_mgmt_test2_name'), '.azure-api.net')]\",\n                \"negotiateClientCertificate\": false,\n                \"defaultSslBinding\": true,\n                \"certificateSource\": \"BuiltIn\"\n            }\n        ],\n        \"additionalLocations\": [\n            {\n                \"location\": \"East US\",\n                \"sku\": {\n                    \"name\": \"Premium\",\n                    \"capacity\": 3\n                },\n                \"zones\": [\n                    \"1\",\n                    \"2\",\n                    \"3\"\n                ],\n                \"disableGateway\": false\n            }\n        ],\n        \"customProperties\": {\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168\": \"false\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11\": \"false\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10\": \"false\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30\": \"false\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11\": \"false\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10\": \"false\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30\": \"false\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2\": \"false\"\n        },\n        \"virtualNetworkType\": \"None\",\n        \"disableGateway\": false,\n        \"apiVersionConstraint\": {}\n    }\n}\n</code></pre>","tags":["Azure.APIM.AvailabilityZone","AZR-000052"]},{"location":"en/rules/Azure.APIM.AvailabilityZone/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To set availability zones for a API Management instance:</p> <ul> <li>Set <code>zones</code> to a minimum of two zones from <code>[\"1\", \"2\", \"3\"]</code>, ensuring the number of zones match <code>sku.capacity</code>.</li> <li>Set <code>properties.additionalLocations[*].zones</code> to a minimum of two zones from <code>[\"1\", \"2\", \"3\"]</code>, ensuring the number of zones match <code>properties.additionalLocations[*].sku.capacity</code>. </li> <li>Set <code>sku.name</code> and/or <code>properties.additionalLocations[*].sku.name</code> to <code>Premium</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource service_api_mgmt_test2_name_resource 'Microsoft.ApiManagement/service@2021-01-01-preview' = {\n  name: service_api_mgmt_test2_name\n  location: 'Australia East'\n  sku: {\n    name: 'Premium'\n    capacity: 3\n  }\n  zones: [\n    '1',\n    '2',\n    '3'\n  ]\n  properties: {\n    publisherEmail: 'john.doe@contoso.com'\n    publisherName: 'contoso'\n    notificationSenderEmail: 'apimgmt-noreply@mail.windowsazure.com'\n    hostnameConfigurations: [\n      {\n        type: 'Proxy'\n        hostName: '${service_api_mgmt_test2_name}.azure-api.net'\n        negotiateClientCertificate: false\n        defaultSslBinding: true\n        certificateSource: 'BuiltIn'\n      }\n    ]\n    additionalLocations: [\n      {\n        location: 'East US'\n        sku: {\n          name: 'Premium'\n          capacity: 1\n        }\n        zones: [\n          '1'\n        ]\n        disableGateway: false\n      }\n    ]\n    customProperties: {\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168': 'false'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11': 'false'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10': 'false'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30': 'false'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11': 'false'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10': 'false'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30': 'false'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2': 'false'\n    }\n    virtualNetworkType: 'None'\n    disableGateway: false\n    apiVersionConstraint: {}\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/api-management/service:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/api-management/service:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.APIM.AvailabilityZone","AZR-000052"]},{"location":"en/rules/Azure.APIM.AvailabilityZone/#notes","title":"Notes","text":"<p>This rule applies when analyzing resources deployed to Azure using pre-flight and in-flight data.</p> <p>This rule fails when <code>\"zones\"</code> is <code>null</code>, <code>[]</code> or less than two zones when API Management instance is deployed with Premium SKU and there are supported availability zones for the given region.</p> <p>Configure <code>AZURE_APIM_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST</code> to set additional availability zones that need to be supported which are not in the existing providers for namespace <code>Microsoft.ApiManagement</code> and resource type <code>services</code>.</p> <pre><code># YAML: The default AZURE_APIM_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option\nconfiguration:\n  AZURE_APIM_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST: []\n</code></pre> <p>For developer environments, suppressing the rule might make sense as enabling zone redundancy for an API Management instance requries the <code>Premium</code> SKU currently.</p>","tags":["Azure.APIM.AvailabilityZone","AZR-000052"]},{"location":"en/rules/Azure.APIM.AvailabilityZone/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>Availability zone support for Azure API Management</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.AvailabilityZone","AZR-000052"]},{"location":"en/rules/Azure.APIM.CORSPolicy/","title":"Avoid wildcards in APIM CORS policies","text":"Azure.APIM.CORSPolicyAZR-000365Error <p> Security  \u00b7  API Management  \u00b7  Rule  \u00b7  2023_03  \u00b7  Important</p> <p>Avoid using wildcard for any configuration option in CORS policies.</p>","tags":["Azure.APIM.CORSPolicy","AZR-000365"]},{"location":"en/rules/Azure.APIM.CORSPolicy/#description","title":"Description","text":"<p>The API Management <code>cors</code> policy adds cross-origin resource sharing (CORS) support to an operation or APIs.</p> <p>CORS is not a security feature. CORS is a W3C standard that allows a server to relax the same-origin policy enforced by modern browsers. CORS uses HTTP headers that allows API Management (and other HTTP servers) to indicate any allowed origins.</p> <p>Using wildcard (<code>*</code>) in any policy is overly permissive and may reduce the effectiveness of browser same-origin policy enforcement.</p>","tags":["Azure.APIM.CORSPolicy","AZR-000365"]},{"location":"en/rules/Azure.APIM.CORSPolicy/#recommendation","title":"Recommendation","text":"<p>Consider configuring the CORS policy by specifying explicit values for each property.</p>","tags":["Azure.APIM.CORSPolicy","AZR-000365"]},{"location":"en/rules/Azure.APIM.CORSPolicy/#examples","title":"Examples","text":"","tags":["Azure.APIM.CORSPolicy","AZR-000365"]},{"location":"en/rules/Azure.APIM.CORSPolicy/#configure-api-management-policy","title":"Configure API Management policy","text":"<p>To deploy API Management CORS policies that pass this rule:</p> <ul> <li>When configuring <code>cors</code> policies provide the exact values for all properties.</li> <li>Avoid using wildcards for any property of the <code>cors</code> policy including:<ul> <li><code>allowed-origins</code></li> <li><code>allowed-methods</code></li> <li><code>allowed-headers</code></li> <li><code>expose-headers</code></li> </ul> </li> </ul> <p>For example a global scoped policy:</p> API Management policy<pre><code>&lt;policies&gt;\n  &lt;inbound&gt;\n    &lt;cors allow-credentials=\"true\"&gt;\n      &lt;allowed-origins&gt;\n        &lt;origin&gt;https://contoso.developer.azure-api.net&lt;/origin&gt;\n        &lt;origin&gt;https://developer.contoso.com&lt;/origin&gt;\n      &lt;/allowed-origins&gt;\n      &lt;allowed-methods preflight-result-max-age=\"300\"&gt;\n        &lt;method&gt;GET&lt;/method&gt;\n        &lt;method&gt;PUT&lt;/method&gt;\n        &lt;method&gt;POST&lt;/method&gt;\n        &lt;method&gt;PATCH&lt;/method&gt;\n        &lt;method&gt;HEAD&lt;/method&gt;\n        &lt;method&gt;DELETE&lt;/method&gt;\n        &lt;method&gt;OPTIONS&lt;/method&gt;\n      &lt;/allowed-methods&gt;\n      &lt;allowed-headers&gt;\n        &lt;header&gt;Content-Type&lt;/header&gt;\n        &lt;header&gt;Cache-Control&lt;/header&gt;\n        &lt;header&gt;Authorization&lt;/header&gt;\n      &lt;/allowed-headers&gt;\n    &lt;/cors&gt;\n  &lt;/inbound&gt;\n  &lt;backend&gt;\n    &lt;forward-request /&gt;\n  &lt;/backend&gt;\n  &lt;outbound /&gt;\n  &lt;on-error /&gt;\n&lt;/policies&gt;\n</code></pre>","tags":["Azure.APIM.CORSPolicy","AZR-000365"]},{"location":"en/rules/Azure.APIM.CORSPolicy/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy API Management CORS policies that pass this rule:</p> <ul> <li>Configure an policy sub-resource.</li> <li>Avoid using wildcards <code>*</code> for any CORS policy element in <code>properties.value</code> property.   Instead provide exact values.</li> </ul> <p>For example a global scoped policy:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ApiManagement/service/policies\",\n  \"apiVersion\": \"2022-08-01\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), 'policy')]\",\n  \"properties\": {\n    \"value\": \"&lt;policies&gt;&lt;inbound&gt;&lt;cors allow-credentials=\\\"true\\\"&gt;&lt;allowed-origins&gt;&lt;origin&gt;https://contoso.developer.azure-api.net&lt;/origin&gt;&lt;origin&gt;https://developer.contoso.com&lt;/origin&gt;&lt;/allowed-origins&gt;&lt;allowed-methods preflight-result-max-age=\\\"300\\\"&gt;&lt;method&gt;GET&lt;/method&gt;&lt;method&gt;PUT&lt;/method&gt;&lt;method&gt;POST&lt;/method&gt;&lt;method&gt;PATCH&lt;/method&gt;&lt;method&gt;HEAD&lt;/method&gt;&lt;method&gt;DELETE&lt;/method&gt;&lt;method&gt;OPTIONS&lt;/method&gt;&lt;/allowed-methods&gt;&lt;allowed-headers&gt;&lt;header&gt;Content-Type&lt;/header&gt;&lt;header&gt;Cache-Control&lt;/header&gt;&lt;header&gt;Authorization&lt;/header&gt;&lt;/allowed-headers&gt;&lt;/cors&gt;&lt;/inbound&gt;&lt;backend&gt;&lt;forward-request /&gt;&lt;/backend&gt;&lt;outbound /&gt;&lt;on-error /&gt;&lt;/policies&gt;\",\n    \"format\": \"xml\"\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ApiManagement/service', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.APIM.CORSPolicy","AZR-000365"]},{"location":"en/rules/Azure.APIM.CORSPolicy/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy API Management CORS policies that pass this rule:</p> <ul> <li>Configure an policy sub-resource.</li> <li>Avoid using wildcards <code>*</code> for any CORS policy element in <code>properties.value</code> property.   Instead provide exact values.</li> </ul> <p>For example a global scoped policy:</p> Azure Bicep snippet<pre><code>resource globalPolicy 'Microsoft.ApiManagement/service/policies@2022-08-01' = {\n  parent: service\n  name: 'policy'\n  properties: {\n    value: '&lt;policies&gt;&lt;inbound&gt;&lt;cors allow-credentials=\"true\"&gt;&lt;allowed-origins&gt;&lt;origin&gt;https://contoso.developer.azure-api.net&lt;/origin&gt;&lt;origin&gt;https://developer.contoso.com&lt;/origin&gt;&lt;/allowed-origins&gt;&lt;allowed-methods preflight-result-max-age=\"300\"&gt;&lt;method&gt;GET&lt;/method&gt;&lt;method&gt;PUT&lt;/method&gt;&lt;method&gt;POST&lt;/method&gt;&lt;method&gt;PATCH&lt;/method&gt;&lt;method&gt;HEAD&lt;/method&gt;&lt;method&gt;DELETE&lt;/method&gt;&lt;method&gt;OPTIONS&lt;/method&gt;&lt;/allowed-methods&gt;&lt;allowed-headers&gt;&lt;header&gt;Content-Type&lt;/header&gt;&lt;header&gt;Cache-Control&lt;/header&gt;&lt;header&gt;Authorization&lt;/header&gt;&lt;/allowed-headers&gt;&lt;/cors&gt;&lt;/inbound&gt;&lt;backend&gt;&lt;forward-request /&gt;&lt;/backend&gt;&lt;outbound /&gt;&lt;on-error /&gt;&lt;/policies&gt;'\n    format: 'xml'\n  }\n}\n</code></pre>","tags":["Azure.APIM.CORSPolicy","AZR-000365"]},{"location":"en/rules/Azure.APIM.CORSPolicy/#notes","title":"Notes","text":"<p>The rule only checks against <code>rawxml</code> and <code>xml</code> policy formatted content.</p> <p>When using Azure Bicep, the policy XML can be loaded from an external file by using the <code>loadTextContent</code> function.</p>","tags":["Azure.APIM.CORSPolicy","AZR-000365"]},{"location":"en/rules/Azure.APIM.CORSPolicy/#links","title":"Links","text":"<ul> <li>Application threat analysis</li> <li>CORS policy</li> <li>Mitigate OWASP API threats</li> <li>How CORS works</li> <li>Policies in Azure API Management</li> <li>File functions for Bicep</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.CORSPolicy","AZR-000365"]},{"location":"en/rules/Azure.APIM.CertificateExpiry/","title":"API Management uses current certificates","text":"Azure.APIM.CertificateExpiryAZR-000051Error <p> Reliability  \u00b7  API Management  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Renew certificates used for custom domain bindings.</p>","tags":["Azure.APIM.CertificateExpiry","AZR-000051"]},{"location":"en/rules/Azure.APIM.CertificateExpiry/#description","title":"Description","text":"<p>When custom domains are configured within an API Management service. A certificate must be assigned to allow traffic to be transmitted using TLS.</p> <p>Each certificate has an expiry date, after which the certificate is not valid. After expiry, client connections to the API Management service will reject the certificate.</p>","tags":["Azure.APIM.CertificateExpiry","AZR-000051"]},{"location":"en/rules/Azure.APIM.CertificateExpiry/#recommendation","title":"Recommendation","text":"<p>Consider renewing certificates before expiry to prevent service issues.</p>","tags":["Azure.APIM.CertificateExpiry","AZR-000051"]},{"location":"en/rules/Azure.APIM.CertificateExpiry/#notes","title":"Notes","text":"<p>By default, this rule fails when certificates have less than 30 days remaining before expiry.</p>","tags":["Azure.APIM.CertificateExpiry","AZR-000051"]},{"location":"en/rules/Azure.APIM.CertificateExpiry/#rule-configuration","title":"Rule configuration","text":"<p>AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME</p> <p>By default, this rule fails if the days before a configured certificate expires is less than 30 days. To configure this rule, override the <code>AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME</code> configuration value with the minimum number of days until expiry.</p>","tags":["Azure.APIM.CertificateExpiry","AZR-000051"]},{"location":"en/rules/Azure.APIM.CertificateExpiry/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Configure a custom domain name</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.CertificateExpiry","AZR-000051"]},{"location":"en/rules/Azure.APIM.Ciphers/","title":"Use secure ciphers for API Management","text":"Azure.APIM.CiphersAZR-000055Error <p> Security  \u00b7  API Management  \u00b7  Rule  \u00b7  2022_03  \u00b7  Critical</p> <p>API Management should not accept weak or deprecated ciphers for client or backend communication.</p>","tags":["Azure.APIM.Ciphers","AZR-000055"]},{"location":"en/rules/Azure.APIM.Ciphers/#description","title":"Description","text":"<p>API Management provides support for weak or deprecated ciphers. These older versions are provided for compatibility with clients and backends but are not consider secure. These many of these ciphers are enabled by default and need to be set to <code>'False'</code>.</p> <p>The following ciphers are considered weak or deprecated:</p> <ul> <li><code>TripleDes168</code></li> <li><code>TLS_RSA_WITH_AES_128_CBC_SHA</code></li> <li><code>TLS_RSA_WITH_AES_256_CBC_SHA</code></li> <li><code>TLS_RSA_WITH_AES_128_CBC_SHA256</code></li> <li><code>TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</code></li> <li><code>TLS_RSA_WITH_AES_256_CBC_SHA256</code></li> <li><code>TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA</code></li> <li><code>TLS_RSA_WITH_AES_128_GCM_SHA256</code></li> </ul>","tags":["Azure.APIM.Ciphers","AZR-000055"]},{"location":"en/rules/Azure.APIM.Ciphers/#recommendation","title":"Recommendation","text":"<p>Consider disabling weak or deprecated ciphers from API Management Services. Also consider disabling weak or deprecated protocols.</p>","tags":["Azure.APIM.Ciphers","AZR-000055"]},{"location":"en/rules/Azure.APIM.Ciphers/#examples","title":"Examples","text":"","tags":["Azure.APIM.Ciphers","AZR-000055"]},{"location":"en/rules/Azure.APIM.Ciphers/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy API Management Services that pass this rule:</p> <ul> <li>Set the following keys to <code>\"False\"</code> (as a string) within the <code>properties.customProperties</code> property:<ul> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256</code></li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.ApiManagement/service\",\n    \"apiVersion\": \"2021-08-01\",\n    \"name\": \"[parameters('name')]\",\n    \"location\": \"[parameters('location')]\",\n    \"sku\": {\n        \"name\": \"Premium\",\n        \"capacity\": 1\n    },\n    \"identity\": {\n        \"type\": \"SystemAssigned\"\n    },\n    \"properties\": {\n        \"publisherEmail\": \"[parameters('publisherEmail')]\",\n        \"publisherName\": \"[parameters('publisherName')]\",\n        \"customProperties\": {\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2\": \"True\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256\": \"False\"\n        },\n        \"apiVersionConstraint\": {\n            \"minApiVersion\": \"2021-08-01\"\n        }\n    }\n}\n</code></pre>","tags":["Azure.APIM.Ciphers","AZR-000055"]},{"location":"en/rules/Azure.APIM.Ciphers/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy API Management Services that pass this rule:</p> <ul> <li>Set the following keys to <code>'False'</code> (as a string) within the <code>properties.customProperties</code> property:<ul> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256</code></li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource service 'Microsoft.ApiManagement/service@2021-08-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Premium'\n    capacity: 1\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    publisherEmail: publisherEmail\n    publisherName: publisherName\n    customProperties: {\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2': 'True'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256': 'False'\n    }\n    apiVersionConstraint: {\n      minApiVersion: '2021-08-01'\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/api-management/service:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/api-management/service:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.APIM.Ciphers","AZR-000055"]},{"location":"en/rules/Azure.APIM.Ciphers/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Manage protocols and ciphers in Azure API Management</li> <li>Cryptographic Recommendations</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.Ciphers","AZR-000055"]},{"location":"en/rules/Azure.APIM.DefenderCloud/","title":"Onboard Defender for APIs","text":"Azure.APIM.DefenderCloudAZR-000387Error <p> Security  \u00b7  API Management  \u00b7  Rule  \u00b7  2023_12  \u00b7  Critical</p> <p>APIs published in Azure API Management should be onboarded to Microsoft Defender for APIs.</p>","tags":["Azure.APIM.DefenderCloud","AZR-000387"]},{"location":"en/rules/Azure.APIM.DefenderCloud/#description","title":"Description","text":"<p>Microsoft Defender for APIs provides additional security for APIs published in Azure API Management. Protection is provided by analyzing onboarded APIs.</p> <p>Which allows Microsoft Defender for Cloud to produce security findings. These security findings includes API recommendations and runtime threats.</p> <p>The inventory and security findings for onboarded APIs is reviewed in the Defender for Cloud API Security dashboard. Defender for APIs can be enabled together with the Defender CSPM plan, offering further capabilities.</p> <p>To use Microsoft Defender for APIs:</p> <ol> <li>Enable the plan at the subscription level.</li> <li>Onboard each API to Microsoft Defender for APIs.</li> </ol>","tags":["Azure.APIM.DefenderCloud","AZR-000387"]},{"location":"en/rules/Azure.APIM.DefenderCloud/#recommendation","title":"Recommendation","text":"<p>Consider onboarding APIs published in Azure API Management to Microsoft Defender for APIs.</p>","tags":["Azure.APIM.DefenderCloud","AZR-000387"]},{"location":"en/rules/Azure.APIM.DefenderCloud/#examples","title":"Examples","text":"","tags":["Azure.APIM.DefenderCloud","AZR-000387"]},{"location":"en/rules/Azure.APIM.DefenderCloud/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy API Management APIs that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.Security/apiCollections</code> sub-resource (extension resource).</li> <li>Set the <code>name</code> property to the name as the API.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/apiCollections\",\n  \"apiVersion\": \"2022-11-20-preview\",\n  \"scope\": \"[format('Microsoft.ApiManagement/service/{0}', parameters('apiManagementServiceName'))]\",\n  \"name\": \"[parameters('apiName')]\"\n}\n</code></pre>","tags":["Azure.APIM.DefenderCloud","AZR-000387"]},{"location":"en/rules/Azure.APIM.DefenderCloud/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy API Management APIs that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.Security/apiCollections</code> sub-resource (extension resource).</li> <li>Set the <code>name</code> property to the name as the API.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource apiManagementService 'Microsoft.ApiManagement/service@2022-08-01' existing = {\n  name: apiManagementServiceName\n}\n\nresource onboardDefender 'Microsoft.Security/apiCollections@2022-11-20-preview' = {\n  name: apiName\n  scope: apiManagementService\n}\n</code></pre>","tags":["Azure.APIM.DefenderCloud","AZR-000387"]},{"location":"en/rules/Azure.APIM.DefenderCloud/#notes","title":"Notes","text":"<p>Microsoft Defender for APIs has the following limitations:</p> <ul> <li>Not all regions are supported.</li> <li>Only REST APIs published through Azure API Management are supported.</li> <li>APIs published through a self-hosted gateway are not supported.</li> <li>APIs defined within an API Management workspace are not supported.</li> </ul> <p>This rule may currently generate false positive results for APIs only hosted on self-hosted gateways or managed using workspaces.</p>","tags":["Azure.APIM.DefenderCloud","AZR-000387"]},{"location":"en/rules/Azure.APIM.DefenderCloud/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>What is Microsoft Defender for Cloud?</li> <li>Overview of Microsoft Defender for APIs</li> <li>Support and prerequisites for Defender for APIs</li> <li>Onboard Defender for APIs</li> <li>Quickstart: Enable enhanced security features</li> <li>Azure security baseline for API Management</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure Policy built-in policy definitions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.DefenderCloud","AZR-000387"]},{"location":"en/rules/Azure.APIM.EncryptValues/","title":"Use encrypted named values","text":"Azure.APIM.EncryptValuesAZR-000045Error <p> Security  \u00b7  API Management  \u00b7  Rule  \u00b7  2023_06  \u00b7  Important</p> <p>Encrypt all API Management named values with Key Vault secrets.</p>","tags":["Azure.APIM.EncryptValues","AZR-000045"]},{"location":"en/rules/Azure.APIM.EncryptValues/#description","title":"Description","text":"<p>Named values can be used to manage constant string values and secrets across all API configurations and policies.</p> <p>Named values are a global collection of name/value pairs in each API Management instance, which may contain sensitive information.</p> <p>Secret values can be stored either as encrypted strings in API Management (custom secrets) or by referencing secrets in Azure Key Vault.</p> <p>All secrets in Key Vault are stored encrypted.</p> <p>Using Key Vault secrets is recommended because it helps improve API Management security by:</p> <ul> <li>Granular access policies and audit logs can be used with secrets.</li> <li>Making it easier to rotate secrets within Key Vault.</li> <li>Secrets that are rotated in Key Vault are automatically refreshed within API Management within 4 hours.   You can also manually refresh the secret using the Azure portal or via the management REST API.</li> </ul>","tags":["Azure.APIM.EncryptValues","AZR-000045"]},{"location":"en/rules/Azure.APIM.EncryptValues/#recommendation","title":"Recommendation","text":"<p>Consider encrypting all API Management named values with Key Vault secrets.</p>","tags":["Azure.APIM.EncryptValues","AZR-000045"]},{"location":"en/rules/Azure.APIM.EncryptValues/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy API Management named values that pass this rule:</p> <ul> <li>Configure a named value sub-resource.</li> <li>Configure the <code>properties.keyVault.secretIdentifier</code> property.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ApiManagement/service/namedValues\",\n  \"apiVersion\": \"2022-08-01\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), parameters('namedValue'))]\",\n  \"properties\": {\n    \"displayName\": \"[parameters('namedValue')]\",\n    \"keyVault\": {\n      \"identityClientId\": null,\n      \"secretIdentifier\": \"[format('https://myVault.vault.azure.net/secrets/{0}', parameters('namedValue'))]\"\n    },\n    \"tags\": []\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ApiManagement/service', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.APIM.EncryptValues","AZR-000045"]},{"location":"en/rules/Azure.APIM.EncryptValues/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy API Management named values that pass this rule:</p> <ul> <li>Configure a named value sub-resource.</li> <li>Configure the <code>properties.keyVault.secretIdentifier</code> property.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource apimNamedValue 'Microsoft.ApiManagement/service/namedValues@2022-08-01' = {\n  name: namedValue\n  parent: apim\n  properties: {\n    displayName: namedValue\n    keyVault: {\n      identityClientId: null\n      secretIdentifier: 'https://myVault.vault.azure.net/secrets/${namedValue}'\n    }\n    tags: []\n  }\n}\n</code></pre>","tags":["Azure.APIM.EncryptValues","AZR-000045"]},{"location":"en/rules/Azure.APIM.EncryptValues/#notes","title":"Notes","text":"<p>Using Key Vault secrets requires a system-assigned or user-assigned managed identity assigned to the API Management instance. The identity needs permissions to get and list secrets from the Key Vault. Also make sure to read the <code>Prerequisites for key vault integration</code> section in links.</p>","tags":["Azure.APIM.EncryptValues","AZR-000045"]},{"location":"en/rules/Azure.APIM.EncryptValues/#links","title":"Links","text":"<ul> <li>Key storage</li> <li>Prerequisites for key vault integration</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.EncryptValues","AZR-000045"]},{"location":"en/rules/Azure.APIM.HTTPBackend/","title":"API Management allows unencrypted traffic to backends","text":"Azure.APIM.HTTPBackendAZR-000044Error <p> Security  \u00b7  API Management  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Unencrypted communication could allow disclosure of information to an untrusted party.</p>","tags":["Azure.APIM.HTTPBackend","AZR-000044"]},{"location":"en/rules/Azure.APIM.HTTPBackend/#description","title":"Description","text":"<p>When API Management connects to the backend API it can use HTTP or HTTPS. When using HTTP, sensitive information may be exposed to an untrusted party.</p> <p>Additionally, when configuring backends:</p> <ul> <li>Use a newer version of TLS such as TLS 1.2.</li> <li>Use client certificate authentication from API Management to authenticate to the backend.</li> </ul>","tags":["Azure.APIM.HTTPBackend","AZR-000044"]},{"location":"en/rules/Azure.APIM.HTTPBackend/#recommendation","title":"Recommendation","text":"<p>Consider configuring only backend services configured with HTTPS-based URLs.</p>","tags":["Azure.APIM.HTTPBackend","AZR-000044"]},{"location":"en/rules/Azure.APIM.HTTPBackend/#examples","title":"Examples","text":"","tags":["Azure.APIM.HTTPBackend","AZR-000044"]},{"location":"en/rules/Azure.APIM.HTTPBackend/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy APIs that pass this rule:</p> <ul> <li>Set the <code>properties.serviceUrl</code> property to a URL that starts with <code>https://</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.ApiManagement/service/apis\",\n    \"apiVersion\": \"2021-08-01\",\n    \"name\": \"[format('{0}/{1}', parameters('name'), 'echo-v1')]\",\n    \"properties\": {\n        \"displayName\": \"Echo API\",\n        \"description\": \"An echo API service.\",\n        \"path\": \"echo\",\n        \"serviceUrl\": \"https://echo.contoso.com\",\n        \"protocols\": [\n            \"https\"\n        ],\n        \"apiVersion\": \"v1\",\n        \"apiVersionSetId\": \"[resourceId('Microsoft.ApiManagement/service/apiVersionSets', parameters('name'), 'echo')]\",\n        \"subscriptionRequired\": true\n    },\n    \"dependsOn\": [\n        \"[resourceId('Microsoft.ApiManagement/service', parameters('name'))]\",\n        \"[resourceId('Microsoft.ApiManagement/service/apiVersionSets', parameters('name'), 'echo')]\"\n    ]\n}\n</code></pre> <p>To deploy API backends that pass this rule:</p> <ul> <li>Set the <code>properties.url</code> property to a URL that starts with <code>https://</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.ApiManagement/service/backends\",\n    \"apiVersion\": \"2021-08-01\",\n    \"name\": \"[format('{0}/{1}', parameters('name'), 'echo')]\",\n    \"properties\": {\n        \"title\": \"echo\",\n        \"description\": \"A backend service for the Each API.\",\n        \"protocol\": \"http\",\n        \"url\": \"https://echo.contoso.com\"\n    },\n    \"dependsOn\": [\n        \"[resourceId('Microsoft.ApiManagement/service', parameters('name'))]\"\n    ]\n}\n</code></pre>","tags":["Azure.APIM.HTTPBackend","AZR-000044"]},{"location":"en/rules/Azure.APIM.HTTPBackend/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy APIs that pass this rule:</p> <ul> <li>Set the <code>properties.serviceUrl</code> property to a URL that starts with <code>https://</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource api 'Microsoft.ApiManagement/service/apis@2021-08-01' = {\n  parent: service\n  name: 'echo-v1'\n  properties: {\n    displayName: 'Echo API'\n    description: 'An echo API service.'\n    path: 'echo'\n    serviceUrl: 'https://echo.contoso.com'\n    protocols: [\n      'https'\n    ]\n    apiVersion: 'v1'\n    apiVersionSetId: version.id\n    subscriptionRequired: true\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/api-management/service:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/api-management/service:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul> <p>To deploy API backends that pass this rule:</p> <ul> <li>Set the <code>properties.url</code> property to a URL that starts with <code>https://</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource backend 'Microsoft.ApiManagement/service/backends@2021-08-01' = {\n  parent: service\n  name: 'echo'\n  properties: {\n    title: 'echo'\n    description: 'A backend service for the Each API.'\n    protocol: 'http'\n    url: 'https://echo.contoso.com'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/api-management/service:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/api-management/service:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.APIM.HTTPBackend","AZR-000044"]},{"location":"en/rules/Azure.APIM.HTTPBackend/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Manage protocols and ciphers in Azure API Management</li> <li>Secure backend services using client certificate authentication in Azure API Management</li> <li>Azure deployment reference for APIs</li> <li>Azure deployment reference for backends</li> </ul>","tags":["Azure.APIM.HTTPBackend","AZR-000044"]},{"location":"en/rules/Azure.APIM.HTTPEndpoint/","title":"API Management allows unencrypted communication with clients","text":"Azure.APIM.HTTPEndpointAZR-000042Error <p> Security  \u00b7  API Management  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Unencrypted communication could allow disclosure of information to an untrusted party.</p>","tags":["Azure.APIM.HTTPEndpoint","AZR-000042"]},{"location":"en/rules/Azure.APIM.HTTPEndpoint/#description","title":"Description","text":"<p>When an client connects to API Management it can use HTTP or HTTPS. Each API can be configured to accept connection for HTTP and/ or HTTPS. When using HTTP, sensitive information may be exposed to an untrusted party.</p>","tags":["Azure.APIM.HTTPEndpoint","AZR-000042"]},{"location":"en/rules/Azure.APIM.HTTPEndpoint/#recommendation","title":"Recommendation","text":"<p>Consider setting the each API to only accept HTTPS connections. In the portal, this is done by configuring the HTTPS URL scheme.</p>","tags":["Azure.APIM.HTTPEndpoint","AZR-000042"]},{"location":"en/rules/Azure.APIM.HTTPEndpoint/#examples","title":"Examples","text":"","tags":["Azure.APIM.HTTPEndpoint","AZR-000042"]},{"location":"en/rules/Azure.APIM.HTTPEndpoint/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy apis that pass this rule:</p> <ul> <li>Set the <code>properties.protocols</code> property to include <code>https</code>. AND</li> <li>Remove <code>http</code> from the <code>properties.protocols</code> property.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ApiManagement/service/apis\",\n  \"apiVersion\": \"2022-08-01\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), 'echo-v1')]\",\n  \"properties\": {\n    \"displayName\": \"Echo API\",\n    \"description\": \"An echo API service.\",\n    \"type\": \"http\",\n    \"path\": \"echo\",\n    \"serviceUrl\": \"https://echo.contoso.com\",\n    \"protocols\": [\n      \"https\"\n    ],\n    \"apiVersion\": \"v1\",\n    \"apiVersionSetId\": \"[resourceId('Microsoft.ApiManagement/service/apiVersionSets', parameters('name'), 'echo')]\",\n    \"subscriptionRequired\": true\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ApiManagement/service', parameters('name'))]\",\n    \"[resourceId('Microsoft.ApiManagement/service/apiVersionSets', parameters('name'), 'echo')]\"\n  ]\n}\n</code></pre>","tags":["Azure.APIM.HTTPEndpoint","AZR-000042"]},{"location":"en/rules/Azure.APIM.HTTPEndpoint/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy apis that pass this rule:</p> <ul> <li>Set the <code>properties.protocols</code> property to include <code>https</code>. AND</li> <li>Remove <code>http</code> from the <code>properties.protocols</code> property.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource api 'Microsoft.ApiManagement/service/apis@2022-08-01' = {\n  parent: service\n  name: 'echo-v1'\n  properties: {\n    displayName: 'Echo API'\n    description: 'An echo API service.'\n    type: 'http'\n    path: 'echo'\n    serviceUrl: 'https://echo.contoso.com'\n    protocols: [\n      'https'\n    ]\n    apiVersion: 'v1'\n    apiVersionSetId: version.id\n    subscriptionRequired: true\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/api-management/service:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/api-management/service:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.APIM.HTTPEndpoint","AZR-000042"]},{"location":"en/rules/Azure.APIM.HTTPEndpoint/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Import and publish a back-end API</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.HTTPEndpoint","AZR-000042"]},{"location":"en/rules/Azure.APIM.ManagedIdentity/","title":"API Management uses a managed identity","text":"Azure.APIM.ManagedIdentityAZR-000053Error <p> Security  \u00b7  API Management  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Configure managed identities to access Azure resources.</p>","tags":["Azure.APIM.ManagedIdentity","AZR-000053"]},{"location":"en/rules/Azure.APIM.ManagedIdentity/#description","title":"Description","text":"<p>API Management must authenticate to access Azure resources such as Key Vault. Use Key Vault to store certificates and secrets used within API Management.</p>","tags":["Azure.APIM.ManagedIdentity","AZR-000053"]},{"location":"en/rules/Azure.APIM.ManagedIdentity/#recommendation","title":"Recommendation","text":"<p>Consider configuring a managed identity for each API Management instance. Also consider using managed identities to authenticate to related Azure services.</p>","tags":["Azure.APIM.ManagedIdentity","AZR-000053"]},{"location":"en/rules/Azure.APIM.ManagedIdentity/#examples","title":"Examples","text":"","tags":["Azure.APIM.ManagedIdentity","AZR-000053"]},{"location":"en/rules/Azure.APIM.ManagedIdentity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy API Management services that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.ApiManagement/service\",\n    \"apiVersion\": \"2021-08-01\",\n    \"name\": \"[parameters('name')]\",\n    \"location\": \"[parameters('location')]\",\n    \"sku\": {\n        \"name\": \"Premium\",\n        \"capacity\": 1\n    },\n    \"identity\": {\n        \"type\": \"SystemAssigned\"\n    },\n    \"properties\": {\n        \"publisherEmail\": \"[parameters('publisherEmail')]\",\n        \"publisherName\": \"[parameters('publisherName')]\",\n        \"customProperties\": {\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2\": \"True\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256\": \"False\"\n        },\n        \"apiVersionConstraint\": {\n            \"minApiVersion\": \"2021-08-01\"\n        }\n    }\n}\n</code></pre>","tags":["Azure.APIM.ManagedIdentity","AZR-000053"]},{"location":"en/rules/Azure.APIM.ManagedIdentity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy API Management services that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource service 'Microsoft.ApiManagement/service@2021-08-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Premium'\n    capacity: 1\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    publisherEmail: publisherEmail\n    publisherName: publisherName\n    customProperties: {\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2': 'True'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256': 'False'\n    }\n    apiVersionConstraint: {\n      minApiVersion: '2021-08-01'\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/api-management/service:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/api-management/service:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.APIM.ManagedIdentity","AZR-000053"]},{"location":"en/rules/Azure.APIM.ManagedIdentity/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>What are managed identities for Azure resources?</li> <li>Use managed identities in Azure API Management</li> <li>Authenticate with managed identity</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.ManagedIdentity","AZR-000053"]},{"location":"en/rules/Azure.APIM.MinAPIVersion/","title":"API Management API versions prior to 2021-08-01 will be retired","text":"Azure.APIM.MinAPIVersionAZR-000321Error <p> Operational Excellence  \u00b7  API Management  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer.</p>","tags":["Azure.APIM.MinAPIVersion","AZR-000321"]},{"location":"en/rules/Azure.APIM.MinAPIVersion/#description","title":"Description","text":"<p>On 30 September 2023, all API versions prior to 2021-08-01 will be retired and API calls using those API versions will fail. This means you'll no longer be able to create or manage your API Management services using your existing templates, tools, scripts, and programs until they've been updated. Data operations (such as accessing the APIs or Products configured on Azure API Management) will be unaffected by this update, including after 30 September 2023.</p> <p>From now through 30 September 2023, you can continue to use the templates, tools, and programs without impact. You can transition to API version 2021-08-01 or later at any point prior to 30 September 2023.</p>","tags":["Azure.APIM.MinAPIVersion","AZR-000321"]},{"location":"en/rules/Azure.APIM.MinAPIVersion/#recommendation","title":"Recommendation","text":"<p>Limit control plane API calls to API Management with version <code>2021-08-01</code> or newer.</p>","tags":["Azure.APIM.MinAPIVersion","AZR-000321"]},{"location":"en/rules/Azure.APIM.MinAPIVersion/#examples","title":"Examples","text":"","tags":["Azure.APIM.MinAPIVersion","AZR-000321"]},{"location":"en/rules/Azure.APIM.MinAPIVersion/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy API Management services that pass this rule:</p> <ul> <li>Set the <code>apiVersion</code> property to <code>2021-08-01</code> or newer.</li> <li>Set the <code>properties.apiVersionConstraint.minApiVersion</code> property to <code>2021-08-01</code> or newer.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.ApiManagement/service\",\n    \"apiVersion\": \"2021-08-01\",\n    \"name\": \"[parameters('name')]\",\n    \"location\": \"[parameters('location')]\",\n    \"sku\": {\n        \"name\": \"Premium\",\n        \"capacity\": 1\n    },\n    \"identity\": {\n        \"type\": \"SystemAssigned\"\n    },\n    \"properties\": {\n        \"publisherEmail\": \"[parameters('publisherEmail')]\",\n        \"publisherName\": \"[parameters('publisherName')]\",\n        \"customProperties\": {\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2\": \"True\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256\": \"False\"\n        },\n        \"apiVersionConstraint\": {\n            \"minApiVersion\": \"2021-08-01\"\n        }\n    }\n}\n</code></pre>","tags":["Azure.APIM.MinAPIVersion","AZR-000321"]},{"location":"en/rules/Azure.APIM.MinAPIVersion/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy API Management services that pass this rule:</p> <ul> <li>Use the API Version <code>Microsoft.ApiManagement/service@2021-08-01</code> or newer.</li> <li>Set the <code>properties.apiVersionConstraint.minApiVersion</code> property to <code>2021-08-01</code> or newer.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource service 'Microsoft.ApiManagement/service@2021-08-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Premium'\n    capacity: 1\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    publisherEmail: publisherEmail\n    publisherName: publisherName\n    customProperties: {\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2': 'True'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256': 'False'\n    }\n    apiVersionConstraint: {\n      minApiVersion: '2021-08-01'\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/api-management/service:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/api-management/service:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.APIM.MinAPIVersion","AZR-000321"]},{"location":"en/rules/Azure.APIM.MinAPIVersion/#notes","title":"Notes","text":"<p>This rule fails:</p> <ul> <li>When the <code>properties.apiVersionConstraint.minApiVersion</code> property is not configured.</li> <li>When the <code>properties.apiVersionConstraint.minApiVersion</code> property value is less than the default value <code>2021-08-01</code> and no configuration option property value is set to overwrite the default value.</li> <li>When the <code>properties.apiVersionConstraint.minApiVersion</code> property value is less than the configuration option property value specified.</li> </ul> <p>Important Currently, depending on how you delete an API Management instance, the instance is either soft-deleted and recoverable during a retention period, or it's permanently deleted:</p> <ul> <li>When you use the Azure portal or REST API version 2020-06-01-preview or later to delete an API Management instance, it's soft-deleted.</li> <li>An API Management instance deleted using a REST API version before 2020-06-01-preview is permanently deleted.</li> </ul>","tags":["Azure.APIM.MinAPIVersion","AZR-000321"]},{"location":"en/rules/Azure.APIM.MinAPIVersion/#rule-configuration","title":"Rule configuration","text":"<p>AZURE_APIM_MIN_API_VERSION</p> <p>Configure <code>AZURE_APIM_MIN_API_VERSION</code> to set the minimum API version used for control plane API calls to the API Management instance.</p> <pre><code># YAML: The default AZURE_APIM_MIN_API_VERSION configuration option\nconfiguration:\n  AZURE_APIM_MIN_API_VERSION: '2021-08-01'\n</code></pre>","tags":["Azure.APIM.MinAPIVersion","AZR-000321"]},{"location":"en/rules/Azure.APIM.MinAPIVersion/#links","title":"Links","text":"<ul> <li>Repeatable Infrastructure</li> <li>Azure API Management API version retirements</li> <li>Azure API Management soft-delete API versions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.MinAPIVersion","AZR-000321"]},{"location":"en/rules/Azure.APIM.MultiRegion/","title":"API Management instances should use multi-region deployment","text":"Azure.APIM.MultiRegionAZR-000340Error <p> Reliability  \u00b7  API Management  \u00b7  Rule  \u00b7  2024_06  \u00b7  Important</p> <p>Enhance service availability and resilience by deploying API Management instances across multiple regions.</p>","tags":["Azure.APIM.MultiRegion","AZR-000340"]},{"location":"en/rules/Azure.APIM.MultiRegion/#description","title":"Description","text":"<p>API Management supports multi-region deployment, which allows the API gateway to be available in more than one region. This configuration enhances service availability by ensuring that if one region experiences an outage, the API gateway remains operational in another region. Multi-region deployment is crucial for maintaining high availability and reducing latency for global users.</p> <p>This feature is available exclusively in the Premium SKU for API Management.</p>","tags":["Azure.APIM.MultiRegion","AZR-000340"]},{"location":"en/rules/Azure.APIM.MultiRegion/#recommendation","title":"Recommendation","text":"<p>Consider deploying API Management instances across multiple regions to enhance service availability and resilience.</p>","tags":["Azure.APIM.MultiRegion","AZR-000340"]},{"location":"en/rules/Azure.APIM.MultiRegion/#examples","title":"Examples","text":"","tags":["Azure.APIM.MultiRegion","AZR-000340"]},{"location":"en/rules/Azure.APIM.MultiRegion/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy API Management instances that pass this rule:</p> <ul> <li>Configure the <code>properties.additionalLocations</code> property.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ApiManagement/service\",\n  \"apiVersion\": \"2021-12-01-preview\",\n  \"name\": \"[parameters('apiManagementServiceName')]\",\n  \"location\": \"eastus\",\n  \"sku\": {\n    \"name\": \"Premium\",\n    \"capacity\": 1\n  },\n  \"properties\": {\n    \"additionalLocations\": [\n      {\n        \"location\": \"westeurope\",\n        \"sku\": {\n          \"name\": \"Premium\",\n          \"capacity\": 1\n        },\n        \"disableGateway\": false\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.APIM.MultiRegion","AZR-000340"]},{"location":"en/rules/Azure.APIM.MultiRegion/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy API Management instances that pass this rule:</p> <ul> <li>Configure the <code>properties.additionalLocations</code> property.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource apiManagementService 'Microsoft.ApiManagement/service@2021-12-01-preview' = {\n  name: apiManagementServiceName\n  location: 'eastus'\n  sku: {\n    name: 'Premium'\n    capacity: 1\n  }\n  properties: {\n    additionalLocations: [\n      {\n        location: 'westeurope'\n        sku: {\n          name: 'Premium'\n          capacity: 1\n        }\n        disableGateway: false\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.APIM.MultiRegion","AZR-000340"]},{"location":"en/rules/Azure.APIM.MultiRegion/#notes","title":"Notes","text":"<p>It is recommended to configure zone redundancy if the region supports it.</p> <p>Virtual network settings must be configured in the added region, if networking is configured in the existing region or regions. The rule does not take this into consideration.</p> <p>For developer environments, suppressing the rule might make sense as configuring multi-region for an API Management instance requires the <code>Premium</code> SKU currently.</p>","tags":["Azure.APIM.MultiRegion","AZR-000340"]},{"location":"en/rules/Azure.APIM.MultiRegion/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>Resiliency and dependencies</li> <li>Azure API Management instance multi-region</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.MultiRegion","AZR-000340"]},{"location":"en/rules/Azure.APIM.MultiRegionGateway/","title":"Multi-region deployment gateways","text":"Azure.APIM.MultiRegionGatewayAZR-000341Error <p> Reliability  \u00b7  API Management  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>API Management instances should have multi-region deployment gateways enabled.</p>","tags":["Azure.APIM.MultiRegionGateway","AZR-000341"]},{"location":"en/rules/Azure.APIM.MultiRegionGateway/#description","title":"Description","text":"<p>Azure API Management supports multi-region deployment. Deploy API Management in multiple locations to:</p> <ul> <li>Provide active-active redundancy for API gateway requests across Azure regions.</li> <li>Serve the request from the closest API gateway region to the original request.</li> </ul> <p>API gateways can be disabled to enabled you to test failover of your API workloads to another region. When disabled, an API gateway will not route API traffic. You should reenable API gateways after you have concluded failover testing to ensure that the API gateway is available for failover if another region becomes unavailable.</p> <p>If a region goes offline, API requests are automatically routed around the failed region to the next closest gateway.</p>","tags":["Azure.APIM.MultiRegionGateway","AZR-000341"]},{"location":"en/rules/Azure.APIM.MultiRegionGateway/#recommendation","title":"Recommendation","text":"<p>Consider enabling each regional API gateway location for multi-region redundancy.</p>","tags":["Azure.APIM.MultiRegionGateway","AZR-000341"]},{"location":"en/rules/Azure.APIM.MultiRegionGateway/#examples","title":"Examples","text":"","tags":["Azure.APIM.MultiRegionGateway","AZR-000341"]},{"location":"en/rules/Azure.APIM.MultiRegionGateway/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy API Management instances that pass this rule:</p> <ul> <li>Set the <code>properties.additionalLocations.disableGateway</code> property to <code>false</code> for each additional location.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ApiManagement/service\",\n  \"apiVersion\": \"2021-12-01-preview\",\n  \"name\": \"[parameters('apiManagementServiceName')]\",\n  \"location\": \"eastus\",\n  \"sku\": {\n    \"name\": \"Premium\",\n    \"capacity\": 1\n  },\n  \"properties\": {\n    \"additionalLocations\": [\n      {\n        \"location\": \"westeurope\",\n        \"sku\": {\n          \"name\": \"Premium\",\n          \"capacity\": 1\n        },\n        \"disableGateway\": false\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.APIM.MultiRegionGateway","AZR-000341"]},{"location":"en/rules/Azure.APIM.MultiRegionGateway/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy API Management instances that pass this rule:</p> <ul> <li>Set the <code>properties.additionalLocations.disableGateway</code> property to <code>false</code> for each additional location.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource apiManagementService 'Microsoft.ApiManagement/service@2021-12-01-preview' = {\n  name: apiManagementServiceName\n  location: 'eastus'\n  sku: {\n    name: 'Premium'\n    capacity: 1\n  }\n  properties: {\n    additionalLocations: [\n      {\n        location: 'westeurope'\n        sku: {\n          name: 'Premium'\n          capacity: 1\n        }\n        disableGateway: false\n      }\n    ]\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/api-management/service:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/api-management/service:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.APIM.MultiRegionGateway","AZR-000341"]},{"location":"en/rules/Azure.APIM.MultiRegionGateway/#links","title":"Links","text":"<ul> <li>Resiliency and dependencies</li> <li>About multi-region deployment</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.MultiRegionGateway","AZR-000341"]},{"location":"en/rules/Azure.APIM.Name/","title":"Use valid API Management service names","text":"Azure.APIM.NameAZR-000056Error <p> Operational Excellence  \u00b7  API Management  \u00b7  Rule  \u00b7  2020_09  \u00b7  Awareness</p> <p>API Management service names should meet naming requirements.</p>","tags":["Azure.APIM.Name","AZR-000056"]},{"location":"en/rules/Azure.APIM.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for API Management service names are:</p> <ul> <li>Between 1 and 50 characters long.</li> <li>Alphanumerics and hyphens.</li> <li>Start with letter.</li> <li>End with letter or number.</li> <li>API Management service names must be globally unique.</li> </ul>","tags":["Azure.APIM.Name","AZR-000056"]},{"location":"en/rules/Azure.APIM.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet API Management naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.APIM.Name","AZR-000056"]},{"location":"en/rules/Azure.APIM.Name/#examples","title":"Examples","text":"","tags":["Azure.APIM.Name","AZR-000056"]},{"location":"en/rules/Azure.APIM.Name/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy services that pass this rule, consider:</p> <ul> <li>Configuring a <code>minLength</code> and <code>maxLength</code> constraint for the resource name parameter.</li> <li>Optionally, you could also use a <code>uniqueString()</code> function to generate a unique name.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"name\": {\n      \"type\": \"string\",\n      \"minLength\": 1,\n      \"maxLength\": 50,\n      \"metadata\": {\n        \"description\": \"The name of the resource.\"\n      }\n    },\n    \"location\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"[resourceGroup().location]\",\n      \"metadata\": {\n        \"description\": \"The location resources will be deployed.\"\n      }\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.ApiManagement/service\",\n      \"apiVersion\": \"2022-08-01\",\n      \"name\": \"[parameters('name')]\",\n      \"location\": \"[parameters('location')]\",\n      \"sku\": {\n        \"name\": \"Premium\",\n        \"capacity\": 1\n      },\n      \"identity\": {\n        \"type\": \"SystemAssigned\"\n      },\n      \"properties\": {\n        \"publisherEmail\": \"[parameters('publisherEmail')]\",\n        \"publisherName\": \"[parameters('publisherName')]\",\n        \"customProperties\": {\n          \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10\": \"False\",\n          \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11\": \"False\",\n          \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30\": \"False\",\n          \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10\": \"False\",\n          \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11\": \"False\",\n          \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30\": \"False\",\n          \"Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2\": \"True\",\n          \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168\": \"False\",\n          \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA\": \"False\",\n          \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA\": \"False\",\n          \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256\": \"False\",\n          \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA\": \"False\",\n          \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256\": \"False\",\n          \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA\": \"False\",\n          \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256\": \"False\"\n        },\n        \"apiVersionConstraint\": {\n          \"minApiVersion\": \"2021-08-01\"\n        }\n      },\n      \"metadata\": {\n        \"description\": \"An example API Management service.\"\n      }\n    }\n  ]\n}\n</code></pre>","tags":["Azure.APIM.Name","AZR-000056"]},{"location":"en/rules/Azure.APIM.Name/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy services that pass this rule, consider:</p> <ul> <li>Configuring a <code>minLength</code> and <code>maxLength</code> constraint for the resource name parameter.</li> <li>Optionally, you could also use a <code>uniqueString()</code> function to generate a unique name.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>@minLength(1)\n@maxLength(50)\n@sys.description('The name of the resource.')\nparam name string\n\n@sys.description('The location resources will be deployed.')\nparam location string = resourceGroup().location\n\nresource service 'Microsoft.ApiManagement/service@2022-08-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Premium'\n    capacity: 1\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    publisherEmail: publisherEmail\n    publisherName: publisherName\n    customProperties: {\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2': 'True'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256': 'False'\n    }\n    apiVersionConstraint: {\n      minApiVersion: '2021-08-01'\n    }\n  }\n}\n</code></pre>","tags":["Azure.APIM.Name","AZR-000056"]},{"location":"en/rules/Azure.APIM.Name/#notes","title":"Notes","text":"<p>This rule does not check if API Management service names are unique.</p>","tags":["Azure.APIM.Name","AZR-000056"]},{"location":"en/rules/Azure.APIM.Name/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Azure resources</li> <li>Recommended abbreviations for Azure resource types</li> <li>Parameters in Bicep</li> <li>Bicep functions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.Name","AZR-000056"]},{"location":"en/rules/Azure.APIM.PolicyBase/","title":"Use base APIM policy element","text":"Azure.APIM.PolicyBaseAZR-000371Error <p> Security  \u00b7  API Management  \u00b7  Rule  \u00b7  2023_06  \u00b7  Important</p> <p>Base element for any policy element in a section should be configured.</p>","tags":["Azure.APIM.PolicyBase","AZR-000371"]},{"location":"en/rules/Azure.APIM.PolicyBase/#description","title":"Description","text":"<p>Determine the policy evaluation order by placement of the base (<code>&lt;base /&gt;</code>) element in each section in the policy definition at each scope.</p> <p>API Management supports the following scopes Global (all API), Workspace, Product, API, or Operation.</p> <p>The base element inherits the policies configured in that section at the next broader (parent) scope. Otherwise inherited security or other controls may not apply. The base element can be placed before or after any policy element in a section, depending on the wanted evaluation order. However, if security controls are defined in inherited scopes it may decrease the effectiveness of these controls. For most cases, unless otherwise specified in the policy reference (such as <code>cors</code>) the base element should be specified as the first element in each section.</p> <p>A specific exception is at the Global scope. The Global scope does not need the base element because this is the peak scope from which all others inherit.</p>","tags":["Azure.APIM.PolicyBase","AZR-000371"]},{"location":"en/rules/Azure.APIM.PolicyBase/#recommendation","title":"Recommendation","text":"<p>Consider configuring the base element for any policy element in a section.</p>","tags":["Azure.APIM.PolicyBase","AZR-000371"]},{"location":"en/rules/Azure.APIM.PolicyBase/#examples","title":"Examples","text":"","tags":["Azure.APIM.PolicyBase","AZR-000371"]},{"location":"en/rules/Azure.APIM.PolicyBase/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy API Management policies that pass this rule:</p> <ul> <li>Configure an policy sub-resource.</li> <li>Configure the base element before or after any policy element in a section in <code>properties.value</code> property.</li> </ul> <p>For example an API policy:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ApiManagement/service/apis/policies\",\n  \"apiVersion\": \"2021-08-01\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), 'policy')]\",\n  \"properties\": {\n    \"value\": \"&lt;policies&gt;&lt;inbound&gt;&lt;base /&gt;&lt;ip-filter action=\\\"allow\\\"&gt;&lt;address-range from=\\\"10.1.0.1\\\" to=\\\"10.1.0.255\\\" /&gt;&lt;/ip-filter&gt;&lt;/inbound&gt;&lt;backend&gt;&lt;base /&gt;&lt;/backend&gt;&lt;outbound&gt;&lt;base /&gt;&lt;/outbound&gt;&lt;on-error&gt;&lt;base /&gt;&lt;/on-error&gt;&lt;/policies&gt;\",\n    \"format\": \"xml\"\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ApiManagement/service/apis', parameters('name'))]\"\n  ],\n}\n</code></pre>","tags":["Azure.APIM.PolicyBase","AZR-000371"]},{"location":"en/rules/Azure.APIM.PolicyBase/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy API Management policies that pass this rule:</p> <ul> <li>Configure an policy sub-resource.</li> <li>Configure the base element before or after any policy element in a section in <code>properties.value</code> property.</li> </ul> <p>For example an API policy:</p> Azure Bicep snippet<pre><code>resource apiName_policy 'Microsoft.ApiManagement/service/apis/policies@2021-08-01' = {\n  parent: api\n  name: 'policy'\n  properties: {\n    value: '&lt;policies&gt;&lt;inbound&gt;&lt;base /&gt;&lt;ip-filter action=\\\"allow\\\"&gt;&lt;address-range from=\\\"10.1.0.1\\\" to=\\\"10.1.0.255\\\" /&gt;&lt;/ip-filter&gt;&lt;/inbound&gt;&lt;backend&gt;&lt;base /&gt;&lt;/backend&gt;&lt;outbound&gt;&lt;base /&gt;&lt;/outbound&gt;&lt;on-error&gt;&lt;base /&gt;&lt;/on-error&gt;&lt;/policies&gt;'\n    format: 'xml'\n  }\n}\n</code></pre>","tags":["Azure.APIM.PolicyBase","AZR-000371"]},{"location":"en/rules/Azure.APIM.PolicyBase/#notes","title":"Notes","text":"<p>The rule only checks against <code>rawxml</code> and <code>xml</code> policy formatted content. Global policies are excluded since they don't benefit from the base element.</p>","tags":["Azure.APIM.PolicyBase","AZR-000371"]},{"location":"en/rules/Azure.APIM.PolicyBase/#links","title":"Links","text":"<ul> <li>Secure application configuration and dependencies</li> <li>Things to know</li> <li>Mitigate OWASP API threats</li> <li>Apply policies specified at different scopes</li> <li>Azure deployment reference</li> <li>Azure deployment reference</li> <li>Azure deployment reference</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.PolicyBase","AZR-000371"]},{"location":"en/rules/Azure.APIM.ProductApproval/","title":"Require approval for products","text":"Azure.APIM.ProductApprovalAZR-000047Error <p> Security  \u00b7  API Management  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Configure products to require approval.</p>","tags":["Azure.APIM.ProductApproval","AZR-000047"]},{"location":"en/rules/Azure.APIM.ProductApproval/#description","title":"Description","text":"<p>When publishing APIs through Azure API Management (APIM), APIs can optionally be assigned to products. Products are a grouping and management construct within API Management. API Management uses products:</p> <ul> <li>To organize APIs and make them available to developers via the developer portal.   For an API to be discoverable within the developer portal, it must be assigned to a published product.</li> <li>To control access and assign policies to APIs with subscription keys.   Subscription keys are a form of credential secret that is used to authenticate a client application to an API.   Examples of policies include throttling, caching, and transformation.</li> </ul> <p>Requiring subscriptions on products and requiring approval is an optional security control within API Management. However, for authorizing access to APIs it is recommended to use stronger forms of authorization such as OAuth 2.0.</p> <p>Using subscriptions and approval on products helps by:</p> <ul> <li>Reducing the risk of unintended exposure of APIs.</li> <li>Allowing organization governance processes to ensure any issued subscription keys are stored securely, rotated, and expired.</li> </ul> <p>If a product does not require subscriptions (called an open product):</p> <ul> <li>Any API assigned to that product can be called without a subscription key.   This applies even if the API is configured to require a subscription key.</li> </ul> <p>If a product requires subscriptions, but does not require approval:</p> <ul> <li>A subscription key can be generated by any developer portal user with permission to the product.</li> </ul>","tags":["Azure.APIM.ProductApproval","AZR-000047"]},{"location":"en/rules/Azure.APIM.ProductApproval/#recommendation","title":"Recommendation","text":"<p>Consider configuring all API Management products to require approval.</p>","tags":["Azure.APIM.ProductApproval","AZR-000047"]},{"location":"en/rules/Azure.APIM.ProductApproval/#examples","title":"Examples","text":"","tags":["Azure.APIM.ProductApproval","AZR-000047"]},{"location":"en/rules/Azure.APIM.ProductApproval/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy API Management Products that pass this rule:</p> <ul> <li>Set the <code>properties.approvalRequired</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ApiManagement/service/products\",\n  \"apiVersion\": \"2022-08-01\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), 'echo')]\",\n  \"properties\": {\n    \"displayName\": \"Echo\",\n    \"description\": \"Echo API services for Contoso.\",\n    \"approvalRequired\": true,\n    \"subscriptionRequired\": true\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ApiManagement/service', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.APIM.ProductApproval","AZR-000047"]},{"location":"en/rules/Azure.APIM.ProductApproval/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy API Management Products that pass this rule:</p> <ul> <li>Set the <code>properties.approvalRequired</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource product 'Microsoft.ApiManagement/service/products@2022-08-01' = {\n  parent: service\n  name: 'echo'\n  properties: {\n    displayName: 'Echo'\n    description: 'Echo API services for Contoso.'\n    approvalRequired: true\n    subscriptionRequired: true\n  }\n}\n</code></pre>","tags":["Azure.APIM.ProductApproval","AZR-000047"]},{"location":"en/rules/Azure.APIM.ProductApproval/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Create and publish a product</li> <li>Subscriptions in Azure API Management</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.ProductApproval","AZR-000047"]},{"location":"en/rules/Azure.APIM.ProductDescriptors/","title":"Azure.APIM.ProductDescriptors","text":""},{"location":"en/rules/Azure.APIM.ProductDescriptors/#online-version-httpsazuregithubiopsrulerulesazureenrulesazureapimproductdescriptors","title":"online version: https://azure.github.io/PSRule.Rules.Azure/en/rules/Azure.APIM.ProductDescriptors/","text":""},{"location":"en/rules/Azure.APIM.ProductDescriptors/#use-product-descriptors","title":"Use product descriptors","text":"<p>API Management products should have a display name and description.</p>"},{"location":"en/rules/Azure.APIM.ProductDescriptors/#description","title":"Description","text":"<p>Each product created in API Management can have a display name and description set. Using easy to understand descriptions and metadata greatly assists identification for management and usage.</p> <p>During monitoring from service provider perspective:</p> <ul> <li>Having a clear understanding of the purpose of a product is often important to during analysis.</li> <li>Allows for accurate management and clean up of unused or old products.</li> <li>Allows for accurate access control decisions.</li> </ul> <p>This information is visible within the developer portal. Accurate information can be used to assist developers in understanding the purpose of a product.</p>"},{"location":"en/rules/Azure.APIM.ProductDescriptors/#recommendation","title":"Recommendation","text":"<p>Consider using display name and description fields on products to convey intended purpose and usage. Display name and description fields should be human readable and easy to understand.</p>"},{"location":"en/rules/Azure.APIM.ProductDescriptors/#examples","title":"Examples","text":""},{"location":"en/rules/Azure.APIM.ProductDescriptors/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy API Management Products that pass this rule:</p> <ul> <li>Set the <code>properties.displayName</code> with a human readable name.</li> <li>Set the <code>properties.description</code> with an description of the APIs purpose.</li> </ul> <p>For example:</p> <pre><code>{\n  \"type\": \"Microsoft.ApiManagement/service/products\",\n  \"apiVersion\": \"2022-08-01\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), 'echo')]\",\n  \"properties\": {\n    \"displayName\": \"Echo\",\n    \"description\": \"Echo API services for Contoso.\",\n    \"approvalRequired\": true,\n    \"subscriptionRequired\": true\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ApiManagement/service', parameters('name'))]\"\n  ]\n}\n</code></pre>"},{"location":"en/rules/Azure.APIM.ProductDescriptors/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy API Management Products that pass this rule:</p> <ul> <li>Set the <code>properties.displayName</code> with a human readable name.</li> <li>Set the <code>properties.description</code> with an description of the APIs purpose.</li> </ul> <p>For example:</p> <pre><code>resource product 'Microsoft.ApiManagement/service/products@2022-08-01' = {\n  parent: service\n  name: 'echo'\n  properties: {\n    displayName: 'Echo'\n    description: 'Echo API services for Contoso.'\n    approvalRequired: true\n    subscriptionRequired: true\n  }\n}\n</code></pre>"},{"location":"en/rules/Azure.APIM.ProductDescriptors/#links","title":"Links","text":"<ul> <li>OE:04 Tools and processes</li> <li>Design review checklist for Operational Excellence</li> <li>Create and publish a product</li> <li>Azure deployment reference</li> </ul>"},{"location":"en/rules/Azure.APIM.ProductSubscription/","title":"Require a subscription for products","text":"Azure.APIM.ProductSubscriptionAZR-000046Error <p> Security  \u00b7  API Management  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Configure products to require a subscription.</p>","tags":["Azure.APIM.ProductSubscription","AZR-000046"]},{"location":"en/rules/Azure.APIM.ProductSubscription/#description","title":"Description","text":"<p>When publishing APIs through Azure API Management (APIM), APIs can optionally be assigned to products. Products are a grouping and management construct within API Management. API Management uses products:</p> <ul> <li>To organize APIs and make them available to developers via the developer portal.   For an API to be discoverable within the developer portal, it must be assigned to a published product.</li> <li>To control access and assign policies to APIs with subscription keys.   Subscription keys are a form of credential secret that is used to authenticate a client application to an API.   Examples of policies include throttling, caching, and transformation.</li> </ul> <p>Requiring subscriptions on products and requiring approval is an optional security control within API Management. However, for authorizing access to APIs it is recommended to use stronger forms of authorization such as OAuth 2.0.</p> <p>Using subscriptions and approval on products helps by:</p> <ul> <li>Reducing the risk of unintended exposure of APIs.</li> <li>Allowing organization governance processes to ensure any issued subscription keys are stored securely, rotated, and expired.</li> </ul> <p>If a product does not require subscriptions (called an open product):</p> <ul> <li>Any API assigned to that product can be called without a subscription key.   This applies even if the API is configured to require a subscription key.</li> </ul> <p>If a product requires subscriptions, but does not require approval:</p> <ul> <li>A subscription key can be generated by any developer portal user with permission to the product.</li> </ul>","tags":["Azure.APIM.ProductSubscription","AZR-000046"]},{"location":"en/rules/Azure.APIM.ProductSubscription/#recommendation","title":"Recommendation","text":"<p>Consider configuring all API Management products to require a subscription.</p>","tags":["Azure.APIM.ProductSubscription","AZR-000046"]},{"location":"en/rules/Azure.APIM.ProductSubscription/#examples","title":"Examples","text":"","tags":["Azure.APIM.ProductSubscription","AZR-000046"]},{"location":"en/rules/Azure.APIM.ProductSubscription/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy API Management Products that pass this rule:</p> <ul> <li>Set the <code>properties.subscriptionRequired</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ApiManagement/service/products\",\n  \"apiVersion\": \"2022-08-01\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), 'echo')]\",\n  \"properties\": {\n    \"displayName\": \"Echo\",\n    \"description\": \"Echo API services for Contoso.\",\n    \"approvalRequired\": true,\n    \"subscriptionRequired\": true\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ApiManagement/service', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.APIM.ProductSubscription","AZR-000046"]},{"location":"en/rules/Azure.APIM.ProductSubscription/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy API Management Products that pass this rule:</p> <ul> <li>Set the <code>properties.subscriptionRequired</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource product 'Microsoft.ApiManagement/service/products@2022-08-01' = {\n  parent: service\n  name: 'echo'\n  properties: {\n    displayName: 'Echo'\n    description: 'Echo API services for Contoso.'\n    approvalRequired: true\n    subscriptionRequired: true\n  }\n}\n</code></pre>","tags":["Azure.APIM.ProductSubscription","AZR-000046"]},{"location":"en/rules/Azure.APIM.ProductSubscription/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Create and publish a product</li> <li>Subscriptions in Azure API Management</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.ProductSubscription","AZR-000046"]},{"location":"en/rules/Azure.APIM.ProductTerms/","title":"Use API product legal terms","text":"Azure.APIM.ProductTermsAZR-000050Error <p> Operational Excellence  \u00b7  API Management  \u00b7  Rule  \u00b7  2020_09  \u00b7  Important</p> <p>Set legal terms for each product registered in API Management.</p>","tags":["Azure.APIM.ProductTerms","AZR-000050"]},{"location":"en/rules/Azure.APIM.ProductTerms/#description","title":"Description","text":"<p>Within API Management a product is created to publish one or more APIs. For each product legal terms can be specified. When set, developers using the developer portal are required to accept the terms to subscribe to a product. Use these terms to set expectations on acceptable use of the included APIs.</p> <p>Acceptance of legal terms is bypassed when an administrator creates a subscription.</p>","tags":["Azure.APIM.ProductTerms","AZR-000050"]},{"location":"en/rules/Azure.APIM.ProductTerms/#recommendation","title":"Recommendation","text":"<p>Consider configuring legal terms for all products to declare acceptable use of included APIs.</p>","tags":["Azure.APIM.ProductTerms","AZR-000050"]},{"location":"en/rules/Azure.APIM.ProductTerms/#links","title":"Links","text":"<ul> <li>Create and publish a product</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.ProductTerms","AZR-000050"]},{"location":"en/rules/Azure.APIM.Protocols/","title":"Use secure TLS versions for API Management","text":"Azure.APIM.ProtocolsAZR-000054Error <p> Security  \u00b7  API Management  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>API Management should only accept a minimum of TLS 1.2 for client and backend communication.</p>","tags":["Azure.APIM.Protocols","AZR-000054"]},{"location":"en/rules/Azure.APIM.Protocols/#description","title":"Description","text":"<p>API Management provides support for older TLS/ SSL protocols, which are disabled by default. These older versions are provided for compatibility but are not consider secure.</p> <p>The following protocols are considered weak or deprecated:</p> <ul> <li><code>SSL 3.0</code></li> <li><code>TLS 1.0</code></li> <li><code>TLS 1.1</code></li> </ul>","tags":["Azure.APIM.Protocols","AZR-000054"]},{"location":"en/rules/Azure.APIM.Protocols/#recommendation","title":"Recommendation","text":"<p>Consider configuring the minimum supported TLS version to be 1.2. Also consider disabling weak or deprecated ciphers.</p>","tags":["Azure.APIM.Protocols","AZR-000054"]},{"location":"en/rules/Azure.APIM.Protocols/#examples","title":"Examples","text":"","tags":["Azure.APIM.Protocols","AZR-000054"]},{"location":"en/rules/Azure.APIM.Protocols/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy API Management Services that pass this rule:</p> <ul> <li>Set the following keys to <code>\"False\"</code> (as a string) within the <code>properties.customProperties</code> property:<ul> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30</code></li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.ApiManagement/service\",\n    \"apiVersion\": \"2021-08-01\",\n    \"name\": \"[parameters('name')]\",\n    \"location\": \"[parameters('location')]\",\n    \"sku\": {\n        \"name\": \"Premium\",\n        \"capacity\": 1\n    },\n    \"identity\": {\n        \"type\": \"SystemAssigned\"\n    },\n    \"properties\": {\n        \"publisherEmail\": \"[parameters('publisherEmail')]\",\n        \"publisherName\": \"[parameters('publisherName')]\",\n        \"customProperties\": {\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2\": \"True\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA\": \"False\",\n            \"Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256\": \"False\"\n        },\n        \"apiVersionConstraint\": {\n            \"minApiVersion\": \"2021-08-01\"\n        }\n    }\n}\n</code></pre>","tags":["Azure.APIM.Protocols","AZR-000054"]},{"location":"en/rules/Azure.APIM.Protocols/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy API Management Services that pass this rule:</p> <ul> <li>Set the following keys to <code>'False'</code> (as a string) within the <code>properties.customProperties</code> property:<ul> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11</code></li> <li><code>Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30</code></li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource service 'Microsoft.ApiManagement/service@2021-08-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Premium'\n    capacity: 1\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    publisherEmail: publisherEmail\n    publisherName: publisherName\n    customProperties: {\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2': 'True'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA': 'False'\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256': 'False'\n    }\n    apiVersionConstraint: {\n      minApiVersion: '2021-08-01'\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/api-management/service:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/api-management/service:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.APIM.Protocols","AZR-000054"]},{"location":"en/rules/Azure.APIM.Protocols/#links","title":"Links","text":"<ul> <li>Data encryption in Azure</li> <li>Manage protocols and ciphers in Azure API Management</li> <li>Cryptographic Recommendations</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.APIM.Protocols","AZR-000054"]},{"location":"en/rules/Azure.APIM.SampleProducts/","title":"Remove default products","text":"Azure.APIM.SampleProductsAZR-000048Error <p> Operational Excellence  \u00b7  API Management  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Remove starter and unlimited sample products.</p>","tags":["Azure.APIM.SampleProducts","AZR-000048"]},{"location":"en/rules/Azure.APIM.SampleProducts/#description","title":"Description","text":"<p>API Management includes two sample products Starter and Unlimited. Accidentally adding APIs to these sample products may expose APIs more than intended.</p>","tags":["Azure.APIM.SampleProducts","AZR-000048"]},{"location":"en/rules/Azure.APIM.SampleProducts/#recommendation","title":"Recommendation","text":"<p>Consider removing starter and unlimited sample products from API Management.</p>","tags":["Azure.APIM.SampleProducts","AZR-000048"]},{"location":"en/rules/Azure.APIM.SampleProducts/#links","title":"Links","text":"<ul> <li>Create and publish a product</li> </ul>","tags":["Azure.APIM.SampleProducts","AZR-000048"]},{"location":"en/rules/Azure.ASE.AvailabilityZone/","title":"Deploy app service environments using availability zones","text":"Azure.ASE.AvailabilityZoneAZR-000443Error <p> Reliability  \u00b7  App Service Environment  \u00b7  Rule  \u00b7  2024_09  \u00b7  Important</p> <p>Deploy app service environments using availability zones in supported regions to ensure high availability and resilience.</p>","tags":["Azure.ASE.AvailabilityZone","AZR-000443"]},{"location":"en/rules/Azure.ASE.AvailabilityZone/#description","title":"Description","text":"<p>App Service Environments support zone redundancy, which distributes your application running within the environment across Availablity Zones. Each Availability Zone is a group of phyiscally separated data centers. Deploying your application with zone redundancy:</p> <ul> <li>Scales your plan within the environment to a minimum of 3 instances in a highly available configuration.   Additional instances can be added manually or on-demand by using autoscale.</li> <li>Improves the resiliency against service disruptions or issues affecting a single zone.</li> </ul> <p>Additionally:</p> <ul> <li>Even Distribution: If the instance count is larger than 3 and divisible by 3, instances are evenly distributed across the three zones.</li> <li>Partial Distribution: Instance counts beyond 3*N are spread across the remaining one or two zones to ensure balanced distribution.</li> </ul> <p>Important Configuring zone redundancy with per-application scaling is possible but may increase costs and administrative overhead. When <code>perSiteScaling</code> is enabled, each application can have its own scaling rules and run on dedicated instances. To maintain zone redundancy, it is crucial that each application\u2019s scaling rules ensure a minimum of 3 instances. Without explicitly configuring this minimum, the application may not meet the zone redundancy requirement.</p>","tags":["Azure.ASE.AvailabilityZone","AZR-000443"]},{"location":"en/rules/Azure.ASE.AvailabilityZone/#recommendation","title":"Recommendation","text":"<p>Consider using enabling zone redundancy using availability zones to improve the resiliency of your solution.</p>","tags":["Azure.ASE.AvailabilityZone","AZR-000443"]},{"location":"en/rules/Azure.ASE.AvailabilityZone/#examples","title":"Examples","text":"","tags":["Azure.ASE.AvailabilityZone","AZR-000443"]},{"location":"en/rules/Azure.ASE.AvailabilityZone/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure a zone-redundant app service environment:</p> <ul> <li>Set the <code>properties.zoneRedundant</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Web/hostingEnvironments\",\n  \"apiVersion\": \"2022-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"kind\": \"ASEV3\",\n  \"properties\": {\n    \"zoneRedundant\": true\n  }\n}\n</code></pre>","tags":["Azure.ASE.AvailabilityZone","AZR-000443"]},{"location":"en/rules/Azure.ASE.AvailabilityZone/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure a zone-redundant app service environment:</p> <ul> <li>Set the <code>properties.zoneRedundant</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource ase 'Microsoft.Web/hostingEnvironments@2022-09-01' = {\n  name: name\n  location: location\n  kind 'ASEV3'\n  properties: {\n    zoneRedundant: true\n  }\n}\n</code></pre>","tags":["Azure.ASE.AvailabilityZone","AZR-000443"]},{"location":"en/rules/Azure.ASE.AvailabilityZone/#notes","title":"Notes","text":"<p>Zone-redundancy is only supported for the <code>ASEV3</code> version.</p> <p>Zone-redundancy is not supported for environments deployed on a dedicated host group.</p>","tags":["Azure.ASE.AvailabilityZone","AZR-000443"]},{"location":"en/rules/Azure.ASE.AvailabilityZone/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>Reliability in Azure App Service</li> <li>Availability zone support</li> <li>About App Service Environment</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.ASE.AvailabilityZone","AZR-000443"]},{"location":"en/rules/Azure.ASE.MigrateV3/","title":"Migrate to App Service Environment v3","text":"Azure.ASE.MigrateV3AZR-000319Error <p> Operational Excellence  \u00b7  App Service Environment  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2.</p>","tags":["Azure.ASE.MigrateV3","AZR-000319"]},{"location":"en/rules/Azure.ASE.MigrateV3/#description","title":"Description","text":"<p>The classic App Service Environment version 1 (ASEv1) and version 2 (ASEv2) will be retired on August 31, 2024. To avoid service disruption, migrate to App Service Environment version 3 (ASEv3). App Service Environment v3 has advantages and feature differences that provide enhanced support for your workloads and can reduce overall costs.</p> <p>App Service Environment v3 differs from earlier versions in the following ways:</p> <ul> <li>There are no networking dependencies on the customer's virtual network. You can secure all inbound and outbound traffic and route outbound traffic as you want.</li> <li>You can deploy an App Service Environment v3 that's enabled for zone redundancy. You set zone redundancy only during creation and only in regions where all App Service Environment v3 dependencies are zone redundant. In this case, each App Service Plan on the App Service Environment will need to have a minimum of three instances so that they can be spread across zones. For more information, see Migrate App Service Environment to availability zone support.</li> <li>You can deploy an App Service Environment v3 on a dedicated host group. Host group deployments aren't zone redundant.</li> <li>Scaling is much faster than with an App Service Environment v2. Although scaling still isn't immediate, as in the multi-tenant service, it's a lot faster.</li> <li>Front-end scaling adjustments are no longer required. App Service Environment v3 front ends automatically scale to meet your needs and are deployed on better hosts.</li> <li>Scaling no longer blocks other scale operations within the App Service Environment v3. Only one scale operation can be in effect for a combination of OS and size. For example, while your Windows small App Service plan is scaling, you could kick off a scale operation to run at the same time on a Windows medium or anything else other than Windows small.</li> <li>You can reach apps in an internal-VIP App Service Environment v3 across global peering. Such access wasn't possible in earlier versions.</li> </ul> <p>A few features that were available in earlier versions of App Service Environment aren't available in App Service Environment v3. For example, you can no longer do the following:</p> <ul> <li>Monitor your traffic with Network Watcher or network security group (NSG) flow logs.</li> <li>Perform a backup and restore operation on a storage account behind a firewall.</li> </ul>","tags":["Azure.ASE.MigrateV3","AZR-000319"]},{"location":"en/rules/Azure.ASE.MigrateV3/#recommendation","title":"Recommendation","text":"<p>Classic App Service Environments should migrate to App Service Environment v3.</p>","tags":["Azure.ASE.MigrateV3","AZR-000319"]},{"location":"en/rules/Azure.ASE.MigrateV3/#examples","title":"Examples","text":"","tags":["Azure.ASE.MigrateV3","AZR-000319"]},{"location":"en/rules/Azure.ASE.MigrateV3/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy app service environments pass this rule:</p> <ul> <li>Set <code>kind</code> to <code>'ASEV3'</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"metadata\": {\n    \"_generator\": {\n      \"name\": \"bicep\",\n      \"version\": \"0.11.1.770\",\n      \"templateHash\": \"13381170219553357893\"\n    }\n  },\n  \"parameters\": {\n    \"aseName\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"001-ase\",\n      \"metadata\": {\n        \"description\": \"Name of the App Service Environment\"\n      }\n    },\n    \"virtualNetworkName\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"ase-001-vnet\",\n      \"metadata\": {\n        \"description\": \"The name of the vnet\"\n      }\n    },\n    \"vnetResourceGroupName\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"ase-001-rg\",\n      \"metadata\": {\n        \"description\": \"The resource group name that contains the vnet\"\n      }\n    },\n    \"subnetName\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"ase-001-sn\",\n      \"metadata\": {\n        \"description\": \"Subnet name that will contain the App Service Environment\"\n      }\n    },\n    \"location\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"[resourceGroup().location]\",\n      \"metadata\": {\n        \"description\": \"Location for the resources\"\n      }\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.Web/hostingEnvironments\",\n      \"apiVersion\": \"2022-03-01\",\n      \"name\": \"[parameters('aseName')]\",\n      \"location\": \"[parameters('location')]\",\n      \"kind\": \"ASEV3\",\n      \"tags\": {\n        \"displayName\": \"App Service Environment\",\n        \"usage\": \"Hosting awesome applications\",\n        \"owner\": \"Platform\"\n      },\n      \"properties\": {\n        \"virtualNetwork\": {\n          \"id\": \"[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vnetResourceGroupName')), 'Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworkName'), parameters('subnetName'))]\"\n        }\n      }\n    }\n  ]\n}\n</code></pre>","tags":["Azure.ASE.MigrateV3","AZR-000319"]},{"location":"en/rules/Azure.ASE.MigrateV3/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy app service environments pass this rule:</p> <ul> <li>Set <code>kind</code> to <code>'ASEV3'</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>@description('Name of the App Service Environment')\nparam aseName string = '001-ase'\n\n@description('The name of the vnet')\nparam virtualNetworkName string = 'ase-001-vnet'\n\n@description('The resource group name that contains the vnet')\nparam vnetResourceGroupName string = 'ase-001-rg'\n\n@description('Subnet name that will contain the App Service Environment')\nparam subnetName string = 'ase-001-sn'\n\n@description('Location for the resources')\nparam location string = resourceGroup().location\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2022-05-01' existing = {\n  scope: resourceGroup(vnetResourceGroupName)\n  name: virtualNetworkName\n}\n\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2022-05-01' existing = {\n  parent: virtualNetwork\n  name: subnetName\n}\n\nresource hostingEnvironment 'Microsoft.Web/hostingEnvironments@2022-03-01' = {\n  name: aseName\n  location: location\n  kind: 'ASEV3'\n  tags: {\n    displayName: 'App Service Environment'\n    usage: 'Hosting awesome applications'\n    owner: 'Platform'\n  }\n  properties: {\n    virtualNetwork: {\n      id: subnet.id\n    }\n  }\n}\n</code></pre>","tags":["Azure.ASE.MigrateV3","AZR-000319"]},{"location":"en/rules/Azure.ASE.MigrateV3/#links","title":"Links","text":"<ul> <li>Infrastructure provisioning</li> <li>App Service Environment version 1 and version 2 will be retired on 31 August 2024</li> <li>Migrate to App Service Environment v3</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ASE.MigrateV3","AZR-000319"]},{"location":"en/rules/Azure.ASG.Name/","title":"Use valid ASG names","text":"Azure.ASG.NameAZR-000085Error <p> Operational Excellence  \u00b7  Application Security Group  \u00b7  Rule  \u00b7  2021_12  \u00b7  Awareness</p> <p>Application Security Group (ASG) names should meet naming requirements.</p>","tags":["Azure.ASG.Name","AZR-000085"]},{"location":"en/rules/Azure.ASG.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for ASG names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>ASG names must be unique within a resource group.</li> </ul>","tags":["Azure.ASG.Name","AZR-000085"]},{"location":"en/rules/Azure.ASG.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Application Security Group naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.ASG.Name","AZR-000085"]},{"location":"en/rules/Azure.ASG.Name/#examples","title":"Examples","text":"","tags":["Azure.ASG.Name","AZR-000085"]},{"location":"en/rules/Azure.ASG.Name/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Application Security Groups that pass this rule:</p> <ul> <li>Set <code>name</code> to a value that meets the requirements.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/applicationSecurityGroups\",\n  \"apiVersion\": \"2022-01-01\",\n  \"name\": \"[parameters('asgName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {}\n}\n</code></pre>","tags":["Azure.ASG.Name","AZR-000085"]},{"location":"en/rules/Azure.ASG.Name/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Application Security Groups that pass this rule:</p> <ul> <li>Set <code>name</code> to a value that meets the requirements.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource asg 'Microsoft.Network/applicationSecurityGroups@2022-01-01' = {\n  name: asgName\n  location:location\n  properties: {}\n}\n</code></pre>","tags":["Azure.ASG.Name","AZR-000085"]},{"location":"en/rules/Azure.ASG.Name/#notes","title":"Notes","text":"<p>This rule does not check if ASG names are unique.</p>","tags":["Azure.ASG.Name","AZR-000085"]},{"location":"en/rules/Azure.ASG.Name/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> <li>Recommended abbreviations for Azure resource types</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ASG.Name","AZR-000085"]},{"location":"en/rules/Azure.AVD.ScheduleAgentUpdate/","title":"Schedule agent updates for host pools","text":"Azure.AVD.ScheduleAgentUpdateAZR-000437Error <p> Reliability  \u00b7  Azure Virtual Desktop  \u00b7  Rule  \u00b7  2024_06  \u00b7  Important</p> <p>Define a windows for agent updates to minimize disruptions to users.</p>","tags":["Azure.AVD.ScheduleAgentUpdate","AZR-000437"]},{"location":"en/rules/Azure.AVD.ScheduleAgentUpdate/#description","title":"Description","text":"<p>Azure Virtual Desktop (AVD) regularly provide updates to the agent software that runs on host pools. The agent software is responsible for managing user sessions and providing access to resources. These updates provide new functionality and fixes. While the update process is designed to minimize disruptions, updates should be applied outside of peak load times.</p> <p>By default, agent updates are applied automatically when they become available. If you have configured a maintenance window, updates are only applied during the maintenance window that you specify. Each host pool can configure up to two maintenance windows per week.</p>","tags":["Azure.AVD.ScheduleAgentUpdate","AZR-000437"]},{"location":"en/rules/Azure.AVD.ScheduleAgentUpdate/#recommendation","title":"Recommendation","text":"<p>Consider defining a maintenance window for agent updates to minimize disruptions to users on AVD host pools.</p>","tags":["Azure.AVD.ScheduleAgentUpdate","AZR-000437"]},{"location":"en/rules/Azure.AVD.ScheduleAgentUpdate/#examples","title":"Examples","text":"","tags":["Azure.AVD.ScheduleAgentUpdate","AZR-000437"]},{"location":"en/rules/Azure.AVD.ScheduleAgentUpdate/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy host pools that pass this rule:</p> <ul> <li>Set the <code>properties.agentUpdate.type</code> property to <code>Scheduled</code>. AND</li> <li>Configure one or more maintenance windows in the <code>properties.agentUpdate.maintenanceWindows</code> property.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DesktopVirtualization/hostPools\",\n  \"apiVersion\": \"2024-04-03\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"hostPoolType\": \"Pooled\",\n    \"loadBalancerType\": \"DepthFirst\",\n    \"preferredAppGroupType\": \"Desktop\",\n    \"maxSessionLimit\": 10,\n    \"agentUpdate\": {\n      \"type\": \"Scheduled\",\n      \"maintenanceWindowTimeZone\": \"AUS Eastern Standard Time\",\n      \"maintenanceWindows\": [\n        {\n          \"dayOfWeek\": \"Sunday\",\n          \"hour\": 1\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.AVD.ScheduleAgentUpdate","AZR-000437"]},{"location":"en/rules/Azure.AVD.ScheduleAgentUpdate/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy host pools that pass this rule:</p> <ul> <li>Set the <code>properties.agentUpdate.type</code> property to <code>Scheduled</code>. AND</li> <li>Configure one or more maintenance windows in the <code>properties.agentUpdate.maintenanceWindows</code> property.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource pool 'Microsoft.DesktopVirtualization/hostPools@2024-04-03' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    hostPoolType: 'Pooled'\n    loadBalancerType: 'DepthFirst'\n    preferredAppGroupType: 'Desktop'\n    maxSessionLimit: 10\n    agentUpdate: {\n      type: 'Scheduled'\n      maintenanceWindowTimeZone: 'AUS Eastern Standard Time'\n      maintenanceWindows: [\n        {\n          dayOfWeek: 'Sunday'\n          hour: 1\n        }\n      ]\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/desktop-virtualization/host-pool:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/desktop-virtualization/host-pool:0.5.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AVD.ScheduleAgentUpdate","AZR-000437"]},{"location":"en/rules/Azure.AVD.ScheduleAgentUpdate/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Get started with the Azure Virtual Desktop Agent</li> <li>Scheduled Agent Updates for Azure Virtual Desktop host pools</li> <li>What's new in the Azure Virtual Desktop Agent?</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AVD.ScheduleAgentUpdate","AZR-000437"]},{"location":"en/rules/Azure.AppConfig.AuditLogs/","title":"Audit App Configuration Store","text":"Azure.AppConfig.AuditLogsAZR-000311Error <p> Security  \u00b7  App Configuration  \u00b7  Rule  \u00b7  2022_09  \u00b7  Important</p> <p>Ensure app configuration store audit diagnostic logs are enabled.</p>","tags":["Azure.AppConfig.AuditLogs","AZR-000311"]},{"location":"en/rules/Azure.AppConfig.AuditLogs/#description","title":"Description","text":"<p>To capture logs that record interactions with data or the settings of the app configuration store, diagnostic settings must be configured.</p> <p>When configuring diagnostic settings, enable one of the following:</p> <ul> <li><code>Audit</code> category.</li> <li><code>audit</code> category group.</li> <li><code>allLogs</code> category group.</li> </ul> <p>Management operations for App Configuration Store are captured automatically within Azure Activity Logs.</p>","tags":["Azure.AppConfig.AuditLogs","AZR-000311"]},{"location":"en/rules/Azure.AppConfig.AuditLogs/#recommendation","title":"Recommendation","text":"<p>Consider configuring diagnostic settings to record interactions with data or the settings of the App Configuration Store.</p>","tags":["Azure.AppConfig.AuditLogs","AZR-000311"]},{"location":"en/rules/Azure.AppConfig.AuditLogs/#examples","title":"Examples","text":"","tags":["Azure.AppConfig.AuditLogs","AZR-000311"]},{"location":"en/rules/Azure.AppConfig.AuditLogs/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy an App Configuration Store that pass this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource (extension resource).</li> <li>Enable <code>Audit</code> category or <code>audit</code> category group or <code>allLogs</code> category group.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"parameters\": {\n    \"name\": {\n      \"type\": \"string\",\n      \"metadata\": {\n        \"description\": \"The name of the App Configuration Store.\"\n      }\n    },\n    \"location\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"[resourceGroup().location]\",\n      \"metadata\": {\n        \"description\": \"The location resources will be deployed.\"\n      }\n    },\n    \"workspaceId\": {\n      \"type\": \"string\",\n      \"metadata\": {\n        \"description\": \"The resource id of the Log Analytics workspace to send diagnostic logs to.\"\n      }\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.AppConfiguration/configurationStores\",\n      \"apiVersion\": \"2022-05-01\",\n      \"name\": \"[parameters('name')]\",\n      \"location\": \"[parameters('location')]\",\n      \"sku\": {\n        \"name\": \"standard\"\n      },\n      \"properties\": {\n        \"disableLocalAuth\": true,\n        \"enablePurgeProtection\": true\n      }\n    },\n    {\n      \"type\": \"Microsoft.Insights/diagnosticSettings\",\n      \"apiVersion\": \"2021-05-01-preview\",\n      \"scope\": \"[format('Microsoft.AppConfiguration/configurationStores/{0}', parameters('name'))]\",\n      \"name\": \"[format('{0}-diagnostic', parameters('name'))]\",\n      \"properties\": {\n        \"logs\": [\n          {\n            \"categoryGroup\": \"audit\",\n            \"enabled\": true,\n            \"retentionPolicy\": {\n              \"days\": 90,\n              \"enabled\": true\n            }\n          }\n        ],\n        \"workspaceId\": \"[parameters('workspaceId')]\"\n      },\n      \"dependsOn\": [\n        \"[resourceId('Microsoft.AppConfiguration/configurationStores', parameters('name'))]\"\n      ]\n    }\n  ]\n}\n</code></pre>","tags":["Azure.AppConfig.AuditLogs","AZR-000311"]},{"location":"en/rules/Azure.AppConfig.AuditLogs/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy an App Configuration Store that pass this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource (extension resource).</li> <li>Enable <code>Audit</code> category or <code>audit</code> category group or <code>allLogs</code> category group.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource store 'Microsoft.AppConfiguration/configurationStores@2023-03-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'standard'\n  }\n  properties: {\n    disableLocalAuth: true\n    enablePurgeProtection: true\n    publicNetworkAccess: 'Disabled'\n  }\n}\n\nresource diagnostic 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  scope: store\n  name: '${name}-diagnostic'\n  properties: {\n    logs: [\n      {\n        categoryGroup: 'audit'\n        enabled: true\n        retentionPolicy: {\n          days: 90\n          enabled: true\n        }\n      }\n    ]\n    workspaceId: workspaceId\n  }\n}\n</code></pre>","tags":["Azure.AppConfig.AuditLogs","AZR-000311"]},{"location":"en/rules/Azure.AppConfig.AuditLogs/#configure-with-bicep-public-registry","title":"Configure with Bicep Public Registry","text":"<p>To deploy an App Configuration Store that pass this rule:</p> <ul> <li>Configure the <code>diagnosticSettingsProperties.logs</code> parameter.</li> <li>Enable <code>Audit</code> category or <code>audit</code> category group or <code>allLogs</code> category group.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>module store 'br/public:app/app-configuration:1.1.1' = {\n  name: 'store'\n  params: {\n    skuName: 'Standard'\n    disableLocalAuth: true\n    enablePurgeProtection: true\n    publicNetworkAccess: 'Disabled'\n    diagnosticSettingsProperties: {\n      diagnosticReceivers: {\n        workspaceId: workspaceId\n      }\n      logs: [\n        {\n          categoryGroup: 'audit'\n          enabled: true\n          retentionPolicy: {\n            days: 90\n            enabled: true\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppConfig.AuditLogs","AZR-000311"]},{"location":"en/rules/Azure.AppConfig.AuditLogs/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>LT-4: Enable logging for security investigation</li> <li>Public registry</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppConfig.AuditLogs","AZR-000311"]},{"location":"en/rules/Azure.AppConfig.DisableLocalAuth/","title":"App Configuration access keys are enabled","text":"Azure.AppConfig.DisableLocalAuthAZR-000291Error <p> Security  \u00b7  App Configuration  \u00b7  Rule  \u00b7  2022_09  \u00b7  Important</p> <p>Access keys allow depersonalized access to App Configuration using a shared secret.</p>","tags":["Azure.AppConfig.DisableLocalAuth","AZR-000291"]},{"location":"en/rules/Azure.AppConfig.DisableLocalAuth/#description","title":"Description","text":"<p>Every request to an Azure App Configuration resource must be authenticated. App Configuration supports authenticating requests using either Entra ID (previously Azure AD) identities or access keys. Using Entra ID identities:</p> <ul> <li>Centralizes identity management and auditing.</li> <li>Allows granting of permissions using role-based access control (RBAC).</li> <li>Provides support for advanced security features such as conditional access and multi-factor authentication (MFA) when applicable.</li> </ul> <p>To require clients to use Entra ID to authenticate requests, you can disable the usage of access keys for an Azure App Configuration resource.</p> <p>When you disable access key authentication for an Azure App Configuration resource, any existing access keys for that resource are deleted. Any subsequent requests to the resource using the previously existing access keys will be rejected. Only requests that are authenticated using Entra ID will succeed.</p>","tags":["Azure.AppConfig.DisableLocalAuth","AZR-000291"]},{"location":"en/rules/Azure.AppConfig.DisableLocalAuth/#recommendation","title":"Recommendation","text":"<p>Consider only using Entra ID identities to access App Configuration data. Then disable authentication based on access keys or SAS tokens.</p>","tags":["Azure.AppConfig.DisableLocalAuth","AZR-000291"]},{"location":"en/rules/Azure.AppConfig.DisableLocalAuth/#examples","title":"Examples","text":"","tags":["Azure.AppConfig.DisableLocalAuth","AZR-000291"]},{"location":"en/rules/Azure.AppConfig.DisableLocalAuth/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy configuration stores that pass this rule:</p> <ul> <li>Set the <code>properties.disableLocalAuth</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.AppConfiguration/configurationStores\",\n  \"apiVersion\": \"2023-03-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"standard\"\n  },\n  \"properties\": {\n    \"disableLocalAuth\": true,\n    \"enablePurgeProtection\": true,\n    \"publicNetworkAccess\": \"Disabled\"\n  }\n}\n</code></pre>","tags":["Azure.AppConfig.DisableLocalAuth","AZR-000291"]},{"location":"en/rules/Azure.AppConfig.DisableLocalAuth/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy configuration stores that pass this rule:</p> <ul> <li>Set the <code>properties.disableLocalAuth</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource store 'Microsoft.AppConfiguration/configurationStores@2023-03-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'standard'\n  }\n  properties: {\n    disableLocalAuth: true\n    enablePurgeProtection: true\n    publicNetworkAccess: 'Disabled'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/app-configuration/configuration-store:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/app-configuration/configuration-store:0.5.2\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppConfig.DisableLocalAuth","AZR-000291"]},{"location":"en/rules/Azure.AppConfig.DisableLocalAuth/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>App Configuration stores should have local authentication methods disabled <code>/providers/Microsoft.Authorization/policyDefinitions/b08ab3ca-1062-4db3-8803-eec9cae605d6</code></li> <li>Configure App Configuration stores to disable local authentication methods <code>/providers/Microsoft.Authorization/policyDefinitions/72bc14af-4ab8-43af-b4e4-38e7983f9a1f</code></li> </ul>","tags":["Azure.AppConfig.DisableLocalAuth","AZR-000291"]},{"location":"en/rules/Azure.AppConfig.DisableLocalAuth/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>IM-1: Use centralized identity and authentication system</li> <li>Authorize access to Azure App Configuration using Microsoft Entra ID</li> <li>Disable access key authentication</li> <li>Azure security baseline for Azure App Configuration</li> <li>Azure Policy built-in definitions for Azure App Configuration</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppConfig.DisableLocalAuth","AZR-000291"]},{"location":"en/rules/Azure.AppConfig.GeoReplica/","title":"Geo-replicate app configuration store","text":"Azure.AppConfig.GeoReplicaAZR-000312Error <p> Reliability  \u00b7  App Configuration  \u00b7  Rule  \u00b7  2023_12  \u00b7  Important</p> <p>Replicate app configuration store across all points of presence for an application.</p>","tags":["Azure.AppConfig.GeoReplica","AZR-000312"]},{"location":"en/rules/Azure.AppConfig.GeoReplica/#description","title":"Description","text":"<p>By default, an app configuration store is stored and maintained in a single region.</p> <p>The app configuration geo-replication feature allows you to replicate your configuration store to additional regions. Each new replica will be in a different region with a new endpoint for your applications to send requests to. The original endpoint of your configuration store is called the origin. The origin can't be removed, but otherwise behaves like any replica.</p> <p>Replicating your configuration store adds the following benefits:</p> <ul> <li>Added resiliency for localized outages contained to a region.</li> <li>Redistribution of request limits.</li> <li>Regional compartmentalization.</li> </ul> <p>When considering where to place replicas, consider the following; where does the application run from?</p> <ul> <li>For server-side applications, consider deploying replicas to regions where the application is hosted and recovered.</li> <li>For client-side applications, consider deploying replicas to regions closest to where the users are located.</li> </ul>","tags":["Azure.AppConfig.GeoReplica","AZR-000312"]},{"location":"en/rules/Azure.AppConfig.GeoReplica/#recommendation","title":"Recommendation","text":"<p>Consider replicating app configuration stores to improve resiliency to region outages.</p>","tags":["Azure.AppConfig.GeoReplica","AZR-000312"]},{"location":"en/rules/Azure.AppConfig.GeoReplica/#examples","title":"Examples","text":"","tags":["Azure.AppConfig.GeoReplica","AZR-000312"]},{"location":"en/rules/Azure.AppConfig.GeoReplica/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy App Configuration Stores that pass this rule:</p> <ul> <li>Set <code>sku.name</code> to <code>Standard</code> (required for geo-replication).</li> <li>Deploy a replica sub-resource (child resource).</li> <li>Set <code>location</code> on replica sub-resource to a different location than the app configuration store.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.AppConfiguration/configurationStores\",\n      \"apiVersion\": \"2023-03-01\",\n      \"name\": \"[parameters('name')]\",\n      \"location\": \"[parameters('location')]\",\n      \"sku\": {\n        \"name\": \"standard\"\n      },\n      \"properties\": {\n        \"disableLocalAuth\": true,\n        \"enablePurgeProtection\": true,\n        \"publicNetworkAccess\": \"Disabled\"\n      }\n    },\n    {\n      \"type\": \"Microsoft.AppConfiguration/configurationStores/replicas\",\n      \"apiVersion\": \"2023-03-01\",\n      \"name\": \"[format('{0}/{1}', parameters('name'), parameters('replicaName'))]\",\n      \"location\": \"[parameters('replicaLocation')]\",\n      \"dependsOn\": [\n        \"[resourceId('Microsoft.AppConfiguration/configurationStores', parameters('name'))]\"\n      ]\n    }\n  ]\n}\n</code></pre>","tags":["Azure.AppConfig.GeoReplica","AZR-000312"]},{"location":"en/rules/Azure.AppConfig.GeoReplica/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy App Configuration Stores that pass this rule:</p> <ul> <li>Set <code>sku.name</code> to <code>Standard</code> (required for geo-replication).</li> <li>Deploy a replica sub-resource (child resource).</li> <li>Set <code>location</code> on replica sub-resource to a different location than the app configuration store.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource store 'Microsoft.AppConfiguration/configurationStores@2023-03-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'standard'\n  }\n  properties: {\n    disableLocalAuth: true\n    enablePurgeProtection: true\n    publicNetworkAccess: 'Disabled'\n  }\n}\n\nresource replica 'Microsoft.AppConfiguration/configurationStores/replicas@2023-03-01' = {\n  parent: store\n  name: replicaName\n  location: replicaLocation\n}\n</code></pre>","tags":["Azure.AppConfig.GeoReplica","AZR-000312"]},{"location":"en/rules/Azure.AppConfig.GeoReplica/#configure-with-bicep-public-registry","title":"Configure with Bicep Public Registry","text":"<p>To deploy App Configuration Stores that pass this rule:</p> <ul> <li>Set <code>params.skuName</code> to <code>Standard</code> (required for geo-replication).</li> <li>Configure one or more replicas by setting <code>params.replicas</code> to an array of objects.</li> <li>Set <code>location</code> on each replica to a different location than the app configuration store.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>module br_public_store 'br/public:app/app-configuration:1.1.2' = {\n  name: 'store'\n  params: {\n    skuName: 'Standard'\n    disableLocalAuth: true\n    enablePurgeProtection: true\n    publicNetworkAccess: 'Disabled'\n    replicas: [\n      {\n        name: 'eastus'\n        location: 'eastus'\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.AppConfig.GeoReplica","AZR-000312"]},{"location":"en/rules/Azure.AppConfig.GeoReplica/#links","title":"Links","text":"<ul> <li>RE:05 Redundancy</li> <li>Resiliency and diaster recovery</li> <li>Geo-replication overview</li> <li>Enable geo-replication</li> <li>Bicep public registry</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppConfig.GeoReplica","AZR-000312"]},{"location":"en/rules/Azure.AppConfig.Name/","title":"Use valid App Configuration store names","text":"Azure.AppConfig.NameAZR-000058Error <p> Operational Excellence  \u00b7  App Configuration  \u00b7  Rule  \u00b7  2020_12  \u00b7  Awareness</p> <p>App Configuration store names should meet naming requirements.</p>","tags":["Azure.AppConfig.Name","AZR-000058"]},{"location":"en/rules/Azure.AppConfig.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for App Configuration store names are:</p> <ul> <li>Between 5 and 50 characters long.</li> <li>Alphanumerics and hyphens.</li> <li>Start and end with a letter or number.</li> <li>App Configuration store names must be unique within a resource group.</li> </ul>","tags":["Azure.AppConfig.Name","AZR-000058"]},{"location":"en/rules/Azure.AppConfig.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet App Configuration store naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.AppConfig.Name","AZR-000058"]},{"location":"en/rules/Azure.AppConfig.Name/#examples","title":"Examples","text":"","tags":["Azure.AppConfig.Name","AZR-000058"]},{"location":"en/rules/Azure.AppConfig.Name/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy configuration stores that pass this rule:</p> <ul> <li>Set <code>name</code> to a value that meets the requirements.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.AppConfiguration/configurationStores\",\n  \"apiVersion\": \"2023-03-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"standard\"\n  },\n  \"properties\": {\n    \"disableLocalAuth\": true,\n    \"enablePurgeProtection\": true,\n    \"publicNetworkAccess\": \"Disabled\"\n  }\n}\n</code></pre>","tags":["Azure.AppConfig.Name","AZR-000058"]},{"location":"en/rules/Azure.AppConfig.Name/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy configuration stores that pass this rule:</p> <ul> <li>Set the <code>name</code> property to a value that meets the requirements.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource store 'Microsoft.AppConfiguration/configurationStores@2023-03-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'standard'\n  }\n  properties: {\n    disableLocalAuth: true\n    enablePurgeProtection: true\n    publicNetworkAccess: 'Disabled'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/app-configuration/configuration-store:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/app-configuration/configuration-store:0.5.2\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppConfig.Name","AZR-000058"]},{"location":"en/rules/Azure.AppConfig.Name/#notes","title":"Notes","text":"<p>This rule does not check if App Configuration store names are unique.</p>","tags":["Azure.AppConfig.Name","AZR-000058"]},{"location":"en/rules/Azure.AppConfig.Name/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> <li>Recommended abbreviations for Azure resource types</li> </ul>","tags":["Azure.AppConfig.Name","AZR-000058"]},{"location":"en/rules/Azure.AppConfig.PurgeProtect/","title":"Purge Protect App Configuration Stores","text":"Azure.AppConfig.PurgeProtectAZR-000313Error <p> Reliability  \u00b7  App Configuration  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Consider purge protection for app configuration store to ensure store cannot be purged in the retention period.</p>","tags":["Azure.AppConfig.PurgeProtect","AZR-000313"]},{"location":"en/rules/Azure.AppConfig.PurgeProtect/#description","title":"Description","text":"<p>With purge protection enabled, soft deleted stores can't be purged in the retention period. If disabled, the soft deleted store can be purged before the retention period expires. Once purge protection is enabled on a store, it can't be disabled.</p> <p>Purge protection is only available for configuration stores that use the standard SKU.</p>","tags":["Azure.AppConfig.PurgeProtect","AZR-000313"]},{"location":"en/rules/Azure.AppConfig.PurgeProtect/#recommendation","title":"Recommendation","text":"<p>Consider enabling purge protection for app configuration stores.</p>","tags":["Azure.AppConfig.PurgeProtect","AZR-000313"]},{"location":"en/rules/Azure.AppConfig.PurgeProtect/#examples","title":"Examples","text":"","tags":["Azure.AppConfig.PurgeProtect","AZR-000313"]},{"location":"en/rules/Azure.AppConfig.PurgeProtect/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy App Configuration Stores that pass this rule:</p> <ul> <li>Set the <code>properties.enablePurgeProtection</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.AppConfiguration/configurationStores\",\n  \"apiVersion\": \"2023-03-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"standard\"\n  },\n  \"properties\": {\n    \"disableLocalAuth\": true,\n    \"enablePurgeProtection\": true,\n    \"publicNetworkAccess\": \"Disabled\"\n  }\n}\n</code></pre>","tags":["Azure.AppConfig.PurgeProtect","AZR-000313"]},{"location":"en/rules/Azure.AppConfig.PurgeProtect/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy App Configuration Stores that pass this rule:</p> <ul> <li>Set the <code>properties.enablePurgeProtection</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource store 'Microsoft.AppConfiguration/configurationStores@2023-03-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'standard'\n  }\n  properties: {\n    disableLocalAuth: true\n    enablePurgeProtection: true\n    publicNetworkAccess: 'Disabled'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/app-configuration/configuration-store:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/app-configuration/configuration-store:0.5.2\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppConfig.PurgeProtect","AZR-000313"]},{"location":"en/rules/Azure.AppConfig.PurgeProtect/#links","title":"Links","text":"<ul> <li>Data management for reliability</li> <li>Purge protection</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppConfig.PurgeProtect","AZR-000313"]},{"location":"en/rules/Azure.AppConfig.SKU/","title":"Use production App Configuration SKU","text":"Azure.AppConfig.SKUAZR-000057Error <p> Reliability  \u00b7  App Configuration  \u00b7  Rule  \u00b7  2020_12  \u00b7  Important</p> <p>App Configuration should use a minimum size of Standard.</p>","tags":["Azure.AppConfig.SKU","AZR-000057"]},{"location":"en/rules/Azure.AppConfig.SKU/#description","title":"Description","text":"<p>App Configuration is offered in two different SKUs; Free, and Standard. Standard includes additional features, increases scalability, and 99.9% SLA. The Free SKU does not include a SLA.</p>","tags":["Azure.AppConfig.SKU","AZR-000057"]},{"location":"en/rules/Azure.AppConfig.SKU/#recommendation","title":"Recommendation","text":"<p>Consider upgrading App Configuration instances to Standard. Free instances are intended only for early development and testing scenarios.</p>","tags":["Azure.AppConfig.SKU","AZR-000057"]},{"location":"en/rules/Azure.AppConfig.SKU/#examples","title":"Examples","text":"","tags":["Azure.AppConfig.SKU","AZR-000057"]},{"location":"en/rules/Azure.AppConfig.SKU/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy configuration stores that pass this rule:</p> <ul> <li>Set the <code>sku.name</code> property to <code>standard</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.AppConfiguration/configurationStores\",\n  \"apiVersion\": \"2023-03-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"standard\"\n  },\n  \"properties\": {\n    \"disableLocalAuth\": true,\n    \"enablePurgeProtection\": true,\n    \"publicNetworkAccess\": \"Disabled\"\n  }\n}\n</code></pre>","tags":["Azure.AppConfig.SKU","AZR-000057"]},{"location":"en/rules/Azure.AppConfig.SKU/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy configuration stores that pass this rule:</p> <ul> <li>Set the <code>sku.name</code> property to <code>standard</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource store 'Microsoft.AppConfiguration/configurationStores@2023-03-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'standard'\n  }\n  properties: {\n    disableLocalAuth: true\n    enablePurgeProtection: true\n    publicNetworkAccess: 'Disabled'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/app-configuration/configuration-store:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/app-configuration/configuration-store:0.5.2\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppConfig.SKU","AZR-000057"]},{"location":"en/rules/Azure.AppConfig.SKU/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>App Configuration pricing</li> <li>Which App Configuration tier should I use?</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppConfig.SKU","AZR-000057"]},{"location":"en/rules/Azure.AppGw.AvailabilityZone/","title":"Application gateways should use Availability zones in supported regions","text":"Azure.AppGw.AvailabilityZoneAZR-000060Error <p> Reliability  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2021_09  \u00b7  Important</p> <p>Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency.</p>","tags":["Azure.AppGw.AvailabilityZone","AZR-000060"]},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#description","title":"Description","text":"<p>App Gateway V2 (Standard_v2 and WAF_v2) supports the use of availability zones to improve resiliency. Each Availability Zone is a group of physically separated data centers.</p> <p>When configured, App Gateway spreads infrastructure instances across multiple availability zones you choose. When a zone impacting event occurs, Application Gateway is able to continue processing network traffic from other zones.</p> <p>Key points when configuring availability zones:</p> <ul> <li>Configure two (2) or more \u2014 Configuring only a single zone (zonal) doesn't provide zone redundancy.   If the configured zone fails, the service fails.   Ideally, configure three zones. i.e. <code>1</code>, <code>2</code>, and <code>3</code>.</li> <li>Consider the network path and connected services \u2014 Look along the network path to other services, to match zones.   If App Gateway is deployed to zones <code>1</code> and <code>2</code> but your applications backend or firewall is deployed to zone <code>3</code>,   failure of any zone would cause failure of the application.</li> <li>Available regions \u2014 Availability zones are not available in all Azure regions/ locations.   To use availability zones, choose regions that support this feature for the Azure services in your application.</li> <li>Supported SKUs \u2014 Availability zones are not supported with the legacy V1 SKU.   You must use the <code>Standard_v2</code> or <code>WAF_v2</code> SKU to configure availability zones.</li> </ul>","tags":["Azure.AppGw.AvailabilityZone","AZR-000060"]},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#recommendation","title":"Recommendation","text":"<p>Consider using the Application Gateway V2 SKU and configure at least two (2) availability zones to improve resiliency.</p>","tags":["Azure.AppGw.AvailabilityZone","AZR-000060"]},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#examples","title":"Examples","text":"","tags":["Azure.AppGw.AvailabilityZone","AZR-000060"]},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Set <code>zones</code> to any or all of <code>[\"1\", \"2\", \"3\"]</code>.</li> <li>Set <code>properties.sku.name</code> and <code>properties.sku.tier</code> to <code>Standard_v2</code> or <code>WAF_v2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/applicationGateways\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ],\n  \"properties\": {\n    \"sku\": {\n      \"name\": \"WAF_v2\",\n      \"tier\": \"WAF_v2\"\n    },\n    \"sslPolicy\": {\n      \"policyType\": \"Custom\",\n      \"minProtocolVersion\": \"TLSv1_2\",\n      \"cipherSuites\": [\n        \"TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384\",\n        \"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256\",\n        \"TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\",\n        \"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\"\n      ]\n    },\n    \"autoscaleConfiguration\": {\n      \"minCapacity\": 2,\n      \"maxCapacity\": 3\n    },\n    \"firewallPolicy\": {\n      \"id\": \"[resourceId('Microsoft.Network/ApplicationGatewayWebApplicationFirewallPolicies', 'agwwaf')]\"\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Network/ApplicationGatewayWebApplicationFirewallPolicies', 'agwwaf')]\"\n  ]\n}\n</code></pre>","tags":["Azure.AppGw.AvailabilityZone","AZR-000060"]},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Set <code>zones</code> to any or all of <code>['1', '2', '3']</code>.</li> <li>Set <code>properties.sku.name</code> and <code>properties.sku.tier</code> to <code>Standard_v2</code> or <code>WAF_v2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource appgw 'Microsoft.Network/applicationGateways@2024-01-01' = {\n  name: name\n  location: location\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n  properties: {\n    sku: {\n      name: 'WAF_v2'\n      tier: 'WAF_v2'\n    }\n    sslPolicy: {\n      policyType: 'Custom'\n      minProtocolVersion: 'TLSv1_2'\n      cipherSuites: [\n        'TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384'\n        'TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256'\n        'TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384'\n        'TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256'\n      ]\n    }\n    autoscaleConfiguration: {\n      minCapacity: 2\n      maxCapacity: 3\n    }\n    firewallPolicy: {\n      id: waf.id\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/network/application-gateway:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/network/application-gateway:0.5.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppGw.AvailabilityZone","AZR-000060"]},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"","tags":["Azure.AppGw.AvailabilityZone","AZR-000060"]},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#create-wafv2-application-gateway-in-zone-1-2-and-3","title":"Create WAFv2 Application Gateway in Zone 1, 2 and 3","text":"<p>To deploy Application Gateways that pass this rule:</p> Azure CLI snippet<pre><code>az network application-gateway create \\\n  --name '&lt;application_gateway_name&gt;' \\\n  --location '&lt;location&gt;' \\\n  --resource-group '&lt;resource_group&gt;' \\\n  --capacity '&lt;capacity&gt;' \\\n  --sku WAF_v2 \\\n  --public-ip-address '&lt;public_ip_address&gt;' \\\n  --vnet-name '&lt;virtual_network_name&gt;' \\\n  --subnet '&lt;subnet_name&gt;' \\\n  --zones 1 2 3 \\\n  --servers '&lt;address_1&gt;' '&lt;address_2&gt;'\n</code></pre>","tags":["Azure.AppGw.AvailabilityZone","AZR-000060"]},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#notes","title":"Notes","text":"<p>This rule fails when <code>\"zones\"</code> is <code>null</code>, <code>[]</code> or not set when the Application gateway is deployed with V2 SKU (Standard_v2, WAF_v2) and there are supported availability zones for the given region.</p>","tags":["Azure.AppGw.AvailabilityZone","AZR-000060"]},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#rule-configuration","title":"Rule configuration","text":"<p>AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST</p> <p>Configure <code>AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST</code> to set additional availability zones that need to be supported which are not in the existing providers for namespace <code>Microsoft.Network</code> and resource type <code>applicationGateways</code>.</p> <pre><code># YAML: The default AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option\nconfiguration:\n  AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST: []\n</code></pre>","tags":["Azure.AppGw.AvailabilityZone","AZR-000060"]},{"location":"en/rules/Azure.AppGw.AvailabilityZone/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>What are availability zones?</li> <li>Autoscaling and Zone-redundant Application Gateway v2</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppGw.AvailabilityZone","AZR-000060"]},{"location":"en/rules/Azure.AppGw.MigrateV2/","title":"Migrate to Application Gateway v2","text":"Azure.AppGw.MigrateV2AZR-000376Error <p> Operational Excellence  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2023_06  \u00b7  Important</p> <p>Use a Application Gateway v2 SKU.</p>","tags":["Azure.AppGw.MigrateV2","AZR-000376"]},{"location":"en/rules/Azure.AppGw.MigrateV2/#description","title":"Description","text":"<p>The Application Gateway v1 SKUs (Standard and WAF) will be retired on April 28, 2026. To avoid service disruption, migrate to Application Gateway v2 SKUs.</p> <p>The v2 SKUs offers performance enhancements, security controls and adds support for critical new features like autoscaling, zone redundancy, support for static VIPs, header rewrite, key vault integration, mutual authentication (mTLS), Azure Kubernetes Service ingress controller and private link.</p>","tags":["Azure.AppGw.MigrateV2","AZR-000376"]},{"location":"en/rules/Azure.AppGw.MigrateV2/#recommendation","title":"Recommendation","text":"<p>Migrate deprecated v1 Application Gateways to a v2 SKU before retirement to avoid service disruption.</p>","tags":["Azure.AppGw.MigrateV2","AZR-000376"]},{"location":"en/rules/Azure.AppGw.MigrateV2/#examples","title":"Examples","text":"","tags":["Azure.AppGw.MigrateV2","AZR-000376"]},{"location":"en/rules/Azure.AppGw.MigrateV2/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Set <code>properties.sku.tier</code> or <code>properties.sku.name</code> to <code>Standard_v2</code> (Application Gateway) or <code>WAF_v2</code> (Web Application Firewall).</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"name\": \"[parameters('name')]\",\n  \"type\": \"Microsoft.Network/applicationGateways\",\n  \"apiVersion\": \"2022-07-01\",\n  \"location\": \"[resourceGroup().location]\",\n  \"properties\": {\n    \"sku\": {\n      \"capacity\": 2,\n      \"name\": \"WAF_v2\",\n      \"tier\": \"WAF_v2\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppGw.MigrateV2","AZR-000376"]},{"location":"en/rules/Azure.AppGw.MigrateV2/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Set <code>properties.sku.tier</code> or <code>properties.sku.name</code> to <code>Standard_v2</code> (Application Gateway) or <code>WAF_v2</code> (Web Application Firewall).</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource appGw 'Microsoft.Network/applicationGateways@2022-07-01' = {\n  name: \n  location: location\n  properties: {\n    sku: {\n      capacity: 2\n      name: 'WAF_v2'\n      tier: 'WAF_v2'\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppGw.MigrateV2","AZR-000376"]},{"location":"en/rules/Azure.AppGw.MigrateV2/#notes","title":"Notes","text":"<p>This rule is applicable for both Application Gateways and Application Gateways with Web Application Firewall (WAF).</p> <p>Not all existing features under the v1 SKUs are supported in the v2 SKUs. The v2 SKUs are not currently available in all regions.</p>","tags":["Azure.AppGw.MigrateV2","AZR-000376"]},{"location":"en/rules/Azure.AppGw.MigrateV2/#links","title":"Links","text":"<ul> <li>Infrastructure provisioning</li> <li>Migrate your Application Gateways</li> <li>What is Azure Application Gateway v2?</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppGw.MigrateV2","AZR-000376"]},{"location":"en/rules/Azure.AppGw.MigrateWAFPolicy/","title":"Migrate to Application Gateway WAF policy","text":"Azure.AppGw.MigrateWAFPolicyAZR-000423Error <p> Reliability  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2024_06  \u00b7  Critical</p> <p>Migrate to Application Gateway WAF policy.</p>","tags":["Azure.AppGw.MigrateWAFPolicy","AZR-000423"]},{"location":"en/rules/Azure.AppGw.MigrateWAFPolicy/#description","title":"Description","text":"<p>Application Gateway V2 supports two configuration modes for WAF:</p> <ul> <li>Define and reference an WAF policy that can be reused across multiple Application Gateways.</li> <li>Specify the WAF configuration tied directly a specific Application Gateway.   This is done by setting the <code>properties.webApplicationFirewallConfiguration</code> property.</li> </ul> <p>Setting the Application Gateway WAF configuration is depreciated and will be retired on 15 March 2027.</p>","tags":["Azure.AppGw.MigrateWAFPolicy","AZR-000423"]},{"location":"en/rules/Azure.AppGw.MigrateWAFPolicy/#recommendation","title":"Recommendation","text":"<p>Consider upgrading Application Gateway to use WAF v2 referencing a WAF policy.</p>","tags":["Azure.AppGw.MigrateWAFPolicy","AZR-000423"]},{"location":"en/rules/Azure.AppGw.MigrateWAFPolicy/#examples","title":"Examples","text":"","tags":["Azure.AppGw.MigrateWAFPolicy","AZR-000423"]},{"location":"en/rules/Azure.AppGw.MigrateWAFPolicy/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Deploy an Application Gateway with the <code>WAF_v2</code> SKU.</li> <li>Migrate any WAF configuration from <code>properties.webApplicationFirewallConfiguration</code> to a separate WAF policy.</li> <li>Set the <code>properties.firewallPolicy.id</code> property to reference the WAF policy resource by ID.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/applicationGateways\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ],\n  \"properties\": {\n    \"sku\": {\n      \"name\": \"WAF_v2\",\n      \"tier\": \"WAF_v2\"\n    },\n    \"sslPolicy\": {\n      \"policyType\": \"Custom\",\n      \"minProtocolVersion\": \"TLSv1_2\",\n      \"cipherSuites\": [\n        \"TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384\",\n        \"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256\",\n        \"TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\",\n        \"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\"\n      ]\n    },\n    \"autoscaleConfiguration\": {\n      \"minCapacity\": 2,\n      \"maxCapacity\": 3\n    },\n    \"firewallPolicy\": {\n      \"id\": \"[resourceId('Microsoft.Network/ApplicationGatewayWebApplicationFirewallPolicies', 'agwwaf')]\"\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Network/ApplicationGatewayWebApplicationFirewallPolicies', 'agwwaf')]\"\n  ]\n}\n</code></pre>","tags":["Azure.AppGw.MigrateWAFPolicy","AZR-000423"]},{"location":"en/rules/Azure.AppGw.MigrateWAFPolicy/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Deploy an Application Gateway with the <code>WAF_v2</code> SKU.</li> <li>Migrate any WAF configuration from <code>properties.webApplicationFirewallConfiguration</code> to a separate WAF policy.</li> <li>Set the <code>properties.firewallPolicy.id</code> property to reference the WAF policy resource by ID.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource appgw 'Microsoft.Network/applicationGateways@2024-01-01' = {\n  name: name\n  location: location\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n  properties: {\n    sku: {\n      name: 'WAF_v2'\n      tier: 'WAF_v2'\n    }\n    sslPolicy: {\n      policyType: 'Custom'\n      minProtocolVersion: 'TLSv1_2'\n      cipherSuites: [\n        'TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384'\n        'TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256'\n        'TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384'\n        'TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256'\n      ]\n    }\n    autoscaleConfiguration: {\n      minCapacity: 2\n      maxCapacity: 3\n    }\n    firewallPolicy: {\n      id: waf.id\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppGw.MigrateWAFPolicy","AZR-000423"]},{"location":"en/rules/Azure.AppGw.MigrateWAFPolicy/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Retirement: Support for Application Gateway Web Application Firewall v2 Configuration is ending</li> <li>Upgrade WAF v2 with legacy WAF configuration to WAF policy</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.AppGw.MigrateWAFPolicy","AZR-000423"]},{"location":"en/rules/Azure.AppGw.MinInstance/","title":"Use two or more Application Gateway instances","text":"Azure.AppGw.MinInstanceAZR-000061Error <p> Reliability  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Application Gateways should use a minimum of two instances.</p>","tags":["Azure.AppGw.MinInstance","AZR-000061"]},{"location":"en/rules/Azure.AppGw.MinInstance/#description","title":"Description","text":"<p>Application Gateways should use two or more instances to be covered by the Service Level Agreement (SLA). By having two or more instances this allows the App Gateway to meet high availability requirements and reduce downtime.</p>","tags":["Azure.AppGw.MinInstance","AZR-000061"]},{"location":"en/rules/Azure.AppGw.MinInstance/#recommendation","title":"Recommendation","text":"<p>When using Application Gateway v1 or v2 with auto-scaling disabled, specify the number of instances to be two or more. When auto-scaling is enabled with Application Gateway v2, configure the minimum number of instances to be two or more.</p>","tags":["Azure.AppGw.MinInstance","AZR-000061"]},{"location":"en/rules/Azure.AppGw.MinInstance/#examples","title":"Examples","text":"","tags":["Azure.AppGw.MinInstance","AZR-000061"]},{"location":"en/rules/Azure.AppGw.MinInstance/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To set capacity for an Application gateway:</p> <ul> <li>With Autoscaling:<ul> <li>Set <code>autoscaleConfiguration.minCapacity</code> to any or all of <code>2</code>.</li> </ul> </li> <li>With manual scaling:<ul> <li>Set <code>sku.capacity</code> to <code>2</code> or more.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"name\": \"appGw-001\",\n  \"type\": \"Microsoft.Network/applicationGateways\",\n  \"apiVersion\": \"2019-09-01\",\n  \"location\": \"[resourceGroup().location]\",\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ],\n  \"properties\": {\n    \"sku\": {\n      \"capacity\": 2, // Manual Scale\n      \"name\": \"WAF_v2\",\n      \"tier\": \"WAF_v2\"\n    },\n    \"autoscaleConfiguration\": { //Autoscale\n      \"minCapacity\": 2,\n      \"maxCapacity\": 3\n    },\n    \"webApplicationFirewallConfiguration\": {\n      \"enabled\": true,\n      \"firewallMode\": \"Detection\",\n      \"ruleSetType\": \"OWASP\",\n      \"ruleSetVersion\": \"3.0\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppGw.MinInstance","AZR-000061"]},{"location":"en/rules/Azure.AppGw.MinInstance/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To set capacity for an Application gateway:</p> <ul> <li>With Autoscaling:<ul> <li>Set <code>autoscaleConfiguration.minCapacity</code> to any or all of <code>2</code>.</li> </ul> </li> <li>With manual scaling:<ul> <li>Set <code>sku.capacity</code> to <code>2</code> or more.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource name_resource 'Microsoft.Network/applicationGateways@2019-09-01' = {\n  name: 'appGw-001'\n  location: location\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n  properties: {\n    sku: {\n      capacity: 2 // Manual scale\n      name: 'WAF_v2'\n      tier: 'WAF_v2'\n    }\n    autoscaleConfiguration: { // Autoscale\n      minCapacity: 1\n      maxCapacity: 2\n    }\n    webApplicationFirewallConfiguration: {\n      enabled: true\n      firewallMode: 'Detection'\n      ruleSetType: 'OWASP'\n      ruleSetVersion: '3.0'\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppGw.MinInstance","AZR-000061"]},{"location":"en/rules/Azure.AppGw.MinInstance/#links","title":"Links","text":"<ul> <li>Azure Application Gateway SLA</li> <li>Azure deployment reference</li> <li>Azure Well-Architected Framework - Reliability</li> </ul>","tags":["Azure.AppGw.MinInstance","AZR-000061"]},{"location":"en/rules/Azure.AppGw.MinSku/","title":"Use production Application Gateway SKU","text":"Azure.AppGw.MinSkuAZR-000062Error <p> Operational Excellence  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Application Gateway should use a minimum instance size of Medium.</p>","tags":["Azure.AppGw.MinSku","AZR-000062"]},{"location":"en/rules/Azure.AppGw.MinSku/#description","title":"Description","text":"<p>An Application Gateway is offered in different versions v1 and v2. When deploying an Application Gateway v1, three different instance sizes are available: Small, Medium and Large.</p> <p>Application Gateway v2, Standard_v2 and WAF_v2 SKUs don't offer different instance sizes.</p>","tags":["Azure.AppGw.MinSku","AZR-000062"]},{"location":"en/rules/Azure.AppGw.MinSku/#recommendation","title":"Recommendation","text":"<p>Application Gateways using v1 SKUs should be deployed with an instance size of Medium or Large. Small instance sizes are intended for development and testing scenarios.</p>","tags":["Azure.AppGw.MinSku","AZR-000062"]},{"location":"en/rules/Azure.AppGw.MinSku/#examples","title":"Examples","text":"","tags":["Azure.AppGw.MinSku","AZR-000062"]},{"location":"en/rules/Azure.AppGw.MinSku/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To set the instance size for an Application Gateway V1:</p> <ul> <li>Set <code>properties.sku.name</code> to <code>Standard_Medium</code> or <code>Standard_Large</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n\n  \"name\": \"appGw-001\",\n  \"type\": \"Microsoft.Network/applicationGateways\",\n  \"apiVersion\": \"2019-09-01\",\n  \"location\": \"[resourceGroup().location]\",\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ],\n  \"tags\": {},\n  \"properties\": {\n    \"sku\": {\n      \"capacity\": 2,\n      \"name\": \"Standard_Large\",\n      \"tier\": \"Standard\"\n    },\n    \"enableHttp2\": false\n  }\n\n}\n</code></pre>","tags":["Azure.AppGw.MinSku","AZR-000062"]},{"location":"en/rules/Azure.AppGw.MinSku/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To set the instance size for an Application Gateway V1:</p> <ul> <li>Set <code>properties.sku.name</code> to <code>Standard_Medium</code> or <code>Standard_Large</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource name_resource 'Microsoft.Network/applicationGateways@2019-09-01' = {\n  name: 'appGw-001'\n  location: location\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n  tags: {}\n  properties: {\n    sku: {\n      capacity: 2\n      name: 'Standard_Large'\n      tier: 'Standard'\n    }\n    enableHttp2: false\n  }\n}\n</code></pre>","tags":["Azure.AppGw.MinSku","AZR-000062"]},{"location":"en/rules/Azure.AppGw.MinSku/#links","title":"Links","text":"<ul> <li>Azure Application Gateway sizing</li> <li>Azure Application Gateway SLA</li> <li>Azure deployment reference</li> <li>Azure Well-Architected Framework - Reliability</li> </ul>","tags":["Azure.AppGw.MinSku","AZR-000062"]},{"location":"en/rules/Azure.AppGw.Name/","title":"Use valid names","text":"Azure.AppGw.NameAZR-000348Error <p> Operational Excellence  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2022_12  \u00b7  Awareness</p> <p>Application Gateways should meet naming requirements.</p>","tags":["Azure.AppGw.Name","AZR-000348"]},{"location":"en/rules/Azure.AppGw.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Application Gateway names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods and hyphens.</li> <li>Start with alphanumeric.</li> <li>End with alphanumeric or underscore.</li> </ul>","tags":["Azure.AppGw.Name","AZR-000348"]},{"location":"en/rules/Azure.AppGw.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Application Gateway naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.AppGw.Name","AZR-000348"]},{"location":"en/rules/Azure.AppGw.Name/#notes","title":"Notes","text":"<p>This rule does not check if Application Gateways names are unique.</p>","tags":["Azure.AppGw.Name","AZR-000348"]},{"location":"en/rules/Azure.AppGw.Name/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Application Gateway</li> <li>Template reference</li> </ul>","tags":["Azure.AppGw.Name","AZR-000348"]},{"location":"en/rules/Azure.AppGw.OWASP/","title":"Use OWASP 3.x rules","text":"Azure.AppGw.OWASPAZR-000067Error <p> Security  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules.</p>","tags":["Azure.AppGw.OWASP","AZR-000067"]},{"location":"en/rules/Azure.AppGw.OWASP/#description","title":"Description","text":"<p>Application Gateways deployed with WAF features support configuration of OWASP rule sets for detection and / or prevention of malicious attacks. Two rule set versions are available; OWASP 2.x and OWASP 3.x.</p>","tags":["Azure.AppGw.OWASP","AZR-000067"]},{"location":"en/rules/Azure.AppGw.OWASP/#recommendation","title":"Recommendation","text":"<p>Consider configuring Application Gateways to use OWASP 3.x rules instead of 2.x rule set versions.</p>","tags":["Azure.AppGw.OWASP","AZR-000067"]},{"location":"en/rules/Azure.AppGw.OWASP/#examples","title":"Examples","text":"","tags":["Azure.AppGw.OWASP","AZR-000067"]},{"location":"en/rules/Azure.AppGw.OWASP/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Set the <code>properties.webApplicationFirewallConfiguration.ruleSetType</code> property to <code>OWASP</code>.</li> <li>Set the <code>properties.webApplicationFirewallConfiguration.ruleSetVersion</code> property to a minimum of <code>3.2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Network/applicationGateways\",\n    \"apiVersion\": \"2020-11-01\",\n    \"name\": \"appGw-001\",\n    \"location\": \"[resourceGroup().location]\",\n    \"properties\": {\n        \"sku\": {\n            \"name\": \"WAF_v2\",\n            \"tier\": \"WAF_v2\"\n        },\n        \"webApplicationFirewallConfiguration\": {\n            \"enabled\": true,\n            \"firewallMode\": \"Prevention\",\n            \"ruleSetType\": \"OWASP\",\n            \"ruleSetVersion\": \"3.2\",\n            \"disabledRuleGroups\": [],\n            \"requestBodyCheck\": true,\n            \"maxRequestBodySizeInKb\": 128,\n            \"fileUploadLimitInMb\": 100\n        }\n    }\n}\n</code></pre>","tags":["Azure.AppGw.OWASP","AZR-000067"]},{"location":"en/rules/Azure.AppGw.OWASP/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Set the <code>properties.webApplicationFirewallConfiguration.ruleSetType</code> property to <code>OWASP</code>.</li> <li>Set the <code>properties.webApplicationFirewallConfiguration.ruleSetVersion</code> property to a minimum of <code>3.2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource appGw 'Microsoft.Network/applicationGateways@2021-02-01' = {\n  name: 'appGw-001'\n  location: location\n  properties: {\n    sku: {\n      name: 'WAF_v2'\n      tier: 'WAF_v2'\n    }\n    webApplicationFirewallConfiguration: {\n      enabled: true\n      firewallMode: 'Prevention'\n      ruleSetType: 'OWASP'\n      ruleSetVersion: '3.2'\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppGw.OWASP","AZR-000067"]},{"location":"en/rules/Azure.AppGw.OWASP/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az network application-gateway waf-config set --enabled true --rule-set-type OWASP --rule-set-version '3.2' -n '&lt;name&gt;' -g '&lt;resource_group&gt;'\n</code></pre>","tags":["Azure.AppGw.OWASP","AZR-000067"]},{"location":"en/rules/Azure.AppGw.OWASP/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>$AppGw = Get-AzApplicationGateway -Name '&lt;name&gt;' -ResourceGroupName '&lt;resource_group&gt;'\nSet-AzApplicationGatewayWebApplicationFirewallConfiguration -ApplicationGateway $AppGw -Enabled $True -FirewallMode 'Prevention' -RuleSetType 'OWASP' -RuleSetVersion '3.2'\n</code></pre>","tags":["Azure.AppGw.OWASP","AZR-000067"]},{"location":"en/rules/Azure.AppGw.OWASP/#links","title":"Links","text":"<ul> <li>Best practices for endpoint security on Azure</li> <li>OWASP ModSecurity Core Rule Set</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppGw.OWASP","AZR-000067"]},{"location":"en/rules/Azure.AppGw.Prevention/","title":"Use WAF prevention mode","text":"Azure.AppGw.PreventionAZR-000065Error <p> Security  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Internet exposed Application Gateways should use prevention mode to protect backend resources.</p>","tags":["Azure.AppGw.Prevention","AZR-000065"]},{"location":"en/rules/Azure.AppGw.Prevention/#description","title":"Description","text":"<p>Application Gateways with Web Application Firewall (WAF) enabled support two modes of operation:</p> <ul> <li>Detection - Monitors and logs all threat alerts.   In this mode, the WAF doesn't block incoming requests that are potentially malicious.</li> <li>Protection - Blocks potentially malicious attack patterns that the rules detect.</li> </ul>","tags":["Azure.AppGw.Prevention","AZR-000065"]},{"location":"en/rules/Azure.AppGw.Prevention/#recommendation","title":"Recommendation","text":"<p>Consider switching Internet exposed Application Gateways to use prevention mode to protect backend resources.</p>","tags":["Azure.AppGw.Prevention","AZR-000065"]},{"location":"en/rules/Azure.AppGw.Prevention/#examples","title":"Examples","text":"","tags":["Azure.AppGw.Prevention","AZR-000065"]},{"location":"en/rules/Azure.AppGw.Prevention/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Set the <code>properties.webApplicationFirewallConfiguration.firewallMode</code> property to <code>Prevention</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Network/applicationGateways\",\n    \"apiVersion\": \"2020-11-01\",\n    \"name\": \"appGw-001\",\n    \"location\": \"[resourceGroup().location]\",\n    \"properties\": {\n        \"sku\": {\n            \"name\": \"WAF_v2\",\n            \"tier\": \"WAF_v2\"\n        },\n        \"webApplicationFirewallConfiguration\": {\n            \"enabled\": true,\n            \"firewallMode\": \"Prevention\",\n            \"ruleSetType\": \"OWASP\",\n            \"ruleSetVersion\": \"3.2\",\n            \"disabledRuleGroups\": [],\n            \"requestBodyCheck\": true,\n            \"maxRequestBodySizeInKb\": 128,\n            \"fileUploadLimitInMb\": 100\n        }\n    }\n}\n</code></pre>","tags":["Azure.AppGw.Prevention","AZR-000065"]},{"location":"en/rules/Azure.AppGw.Prevention/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Set the <code>properties.webApplicationFirewallConfiguration.firewallMode</code> property to <code>Prevention</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource name_resource 'Microsoft.Network/applicationGateways@2019-09-01' = {\n  name: 'appGw-001'\n  location: location\n  properties: {\n    sku: {\n      name: 'WAF_v2'\n      tier: 'WAF_v2'\n    }\n    webApplicationFirewallConfiguration: {\n      enabled: true\n      firewallMode: 'Prevention'\n      ruleSetType: 'OWASP'\n      ruleSetVersion: '3.2'\n      disabledRuleGroups: []\n      requestBodyCheck: true\n      maxRequestBodySizeInKb: 128\n      fileUploadLimitInMb: 100\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppGw.Prevention","AZR-000065"]},{"location":"en/rules/Azure.AppGw.Prevention/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az network application-gateway waf-config set --enabled true --firewall-mode Prevention -n '&lt;name&gt;' -g '&lt;resource_group&gt;'\n</code></pre>","tags":["Azure.AppGw.Prevention","AZR-000065"]},{"location":"en/rules/Azure.AppGw.Prevention/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>$AppGw = Get-AzApplicationGateway -Name '&lt;name&gt;' -ResourceGroupName '&lt;resource_group&gt;'\nSet-AzApplicationGatewayWebApplicationFirewallConfiguration -ApplicationGateway $AppGw -Enabled $True -FirewallMode 'Prevention'\n</code></pre>","tags":["Azure.AppGw.Prevention","AZR-000065"]},{"location":"en/rules/Azure.AppGw.Prevention/#links","title":"Links","text":"<ul> <li>Best practices for endpoint security on Azure</li> <li>Application Gateway WAF modes</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppGw.Prevention","AZR-000065"]},{"location":"en/rules/Azure.AppGw.SSLPolicy/","title":"Application Gateways use a minimum TLS 1.2","text":"Azure.AppGw.SSLPolicyAZR-000064Error <p> Security  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Application Gateway should only accept a minimum of TLS 1.2.</p>","tags":["Azure.AppGw.SSLPolicy","AZR-000064"]},{"location":"en/rules/Azure.AppGw.SSLPolicy/#description","title":"Description","text":"<p>The minimum version of TLS that Application Gateways accept is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS.</p> <p>Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted.</p> <p>Application Gateway should only accept a minimum of TLS 1.2 to ensure secure connections.</p>","tags":["Azure.AppGw.SSLPolicy","AZR-000064"]},{"location":"en/rules/Azure.AppGw.SSLPolicy/#recommendation","title":"Recommendation","text":"<p>Consider configuring Application Gateways to accept a minimum of TLS 1.2.</p>","tags":["Azure.AppGw.SSLPolicy","AZR-000064"]},{"location":"en/rules/Azure.AppGw.SSLPolicy/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Application Gateways that pass this rule use a predefined or custom policy:</p> <ul> <li>Custom \u2014 Set the <code>properties.sslPolicy.policyType</code> property to <code>Custom</code>.<ul> <li>Set the <code>properties.sslPolicy.minProtocolVersion</code> property to <code>TLSv1_2</code>.</li> <li>Set the <code>properties.sslPolicy.cipherSuites</code> property to a list of supported ciphers. For example:<ul> <li><code>TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384</code></li> <li><code>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</code></li> <li><code>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</code></li> <li><code>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</code></li> </ul> </li> </ul> </li> <li>Predefined \u2014 Set the <code>properties.sslPolicy.policyType</code> property to <code>Predefined</code>.<ul> <li>Set the <code>properties.sslPolicy.policyName</code> property to a supported predefined policy such as <code>AppGwSslPolicy20220101S</code>.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/applicationGateways\",\n  \"apiVersion\": \"2023-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ],\n  \"properties\": {\n    \"sku\": {\n      \"name\": \"WAF_v2\",\n      \"tier\": \"WAF_v2\"\n    },\n    \"sslPolicy\": {\n      \"policyType\": \"Custom\",\n      \"minProtocolVersion\": \"TLSv1_2\",\n      \"cipherSuites\": [\n        \"TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384\",\n        \"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256\",\n        \"TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\",\n        \"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\"\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppGw.SSLPolicy","AZR-000064"]},{"location":"en/rules/Azure.AppGw.SSLPolicy/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Application Gateways that pass this rule use a predefined or custom policy:</p> <ul> <li>Custom \u2014 Set the <code>properties.sslPolicy.policyType</code> property to <code>Custom</code>.<ul> <li>Set the <code>properties.sslPolicy.minProtocolVersion</code> property to <code>TLSv1_2</code>.</li> <li>Set the <code>properties.sslPolicy.cipherSuites</code> property to a list of supported ciphers. For example:<ul> <li><code>TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384</code></li> <li><code>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</code></li> <li><code>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</code></li> <li><code>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</code></li> </ul> </li> </ul> </li> <li>Predefined \u2014 Set the <code>properties.sslPolicy.policyType</code> property to <code>Predefined</code>.<ul> <li>Set the <code>properties.sslPolicy.policyName</code> property to a supported predefined policy such as <code>AppGwSslPolicy20220101S</code>.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource app_gw 'Microsoft.Network/applicationGateways@2023-09-01' = {\n  name: name\n  location: location\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n  properties: {\n    sku: {\n      name: 'WAF_v2'\n      tier: 'WAF_v2'\n    }\n    sslPolicy: {\n      policyType: 'Custom'\n      minProtocolVersion: 'TLSv1_2'\n      cipherSuites: [\n        'TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384'\n        'TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256'\n        'TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384'\n        'TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256'\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppGw.SSLPolicy","AZR-000064"]},{"location":"en/rules/Azure.AppGw.SSLPolicy/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>$gw = Get-AzApplicationGateway -Name '&lt;name&gt;' -ResourceGroupName '&lt;resource_group&gt;'\nSet-AzApplicationGatewaySslPolicy -ApplicationGateway $gw -PolicyType Custom -MinProtocolVersion TLSv1_2 -CipherSuite 'TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384', 'TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256', 'TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384', 'TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256'\n</code></pre>","tags":["Azure.AppGw.SSLPolicy","AZR-000064"]},{"location":"en/rules/Azure.AppGw.SSLPolicy/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>DP-3: Encrypt sensitive data in transit</li> <li>Application Gateway SSL policy overview</li> <li>Configure SSL policy versions and cipher suites on Application Gateway</li> <li>Overview of TLS termination and end to end TLS with Application Gateway</li> <li>Predefined TLS policy</li> <li>Cipher suites</li> <li>Limitations</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppGw.SSLPolicy","AZR-000064"]},{"location":"en/rules/Azure.AppGw.UseHTTPS/","title":"Expose frontend HTTP endpoints over HTTPS","text":"Azure.AppGw.UseHTTPSAZR-000059Error <p> Security  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2021_09  \u00b7  Critical</p> <p>Application Gateways should only expose frontend HTTP endpoints over HTTPS.</p>","tags":["Azure.AppGw.UseHTTPS","AZR-000059"]},{"location":"en/rules/Azure.AppGw.UseHTTPS/#description","title":"Description","text":"<p>Application Gateways support HTTP and HTTPS endpoints for backend and frontend traffic. When using frontend HTTP (<code>80</code>) endpoints, traffic between client and Application Gateway is not encrypted.</p> <p>Unencrypted communication could allow disclosure of information to an un-trusted party.</p>","tags":["Azure.AppGw.UseHTTPS","AZR-000059"]},{"location":"en/rules/Azure.AppGw.UseHTTPS/#recommendation","title":"Recommendation","text":"<p>Consider configuring Application Gateways to only expose HTTPS endpoints. For client applications such as progressive web apps, consider redirecting HTTP traffic to HTTPS.</p>","tags":["Azure.AppGw.UseHTTPS","AZR-000059"]},{"location":"en/rules/Azure.AppGw.UseHTTPS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Set the <code>properties.frontendPorts.properties.port</code> property to <code>443</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/applicationGateways\",\n  \"apiVersion\": \"2023-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ],\n  \"properties\": {\n    \"sku\": {\n      \"name\": \"WAF_v2\",\n      \"tier\": \"WAF_v2\"\n    },\n    \"sslPolicy\": {\n      \"policyType\": \"Custom\",\n      \"minProtocolVersion\": \"TLSv1_2\",\n      \"cipherSuites\": [\n        \"TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384\",\n        \"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256\",\n        \"TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\",\n        \"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\"\n      ]\n    },\n    \"frontendPorts\": [\n      {\n        \"name\": \"https\",\n        \"properties\": {\n          \"Port\": 443\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.AppGw.UseHTTPS","AZR-000059"]},{"location":"en/rules/Azure.AppGw.UseHTTPS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Set the <code>properties.frontendPorts.properties.port</code> property to <code>443</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource app_gw 'Microsoft.Network/applicationGateways@2023-09-01' = {\n  name: name\n  location: location\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n  properties: {\n    sku: {\n      name: 'WAF_v2'\n      tier: 'WAF_v2'\n    }\n    sslPolicy: {\n      policyType: 'Custom'\n      minProtocolVersion: 'TLSv1_2'\n      cipherSuites: [\n        'TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384'\n        'TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256'\n        'TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384'\n        'TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256'\n      ]\n    }\n    frontendPorts: [\n      {\n        name: 'https'\n        properties: {\n          Port: 443\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.AppGw.UseHTTPS","AZR-000059"]},{"location":"en/rules/Azure.AppGw.UseHTTPS/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>DP-3: Encrypt sensitive data in transit</li> <li>Create an application gateway with HTTP to HTTPS redirection using the Azure portal</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppGw.UseHTTPS","AZR-000059"]},{"location":"en/rules/Azure.AppGw.UseWAF/","title":"Application Gateway uses WAF SKU","text":"Azure.AppGw.UseWAFAZR-000063Error <p> Security  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Internet accessible Application Gateways should use protect endpoints with WAF.</p>","tags":["Azure.AppGw.UseWAF","AZR-000063"]},{"location":"en/rules/Azure.AppGw.UseWAF/#description","title":"Description","text":"<p>Application Gateway endpoints can optionally be configured with a Web Application Firewall (WAF) policy. When configured, every incoming request is filtered by the WAF policy.</p> <p>To use a WAF policy, the Application Gateway must be deployed with a Web Application Firewall SKU.</p>","tags":["Azure.AppGw.UseWAF","AZR-000063"]},{"location":"en/rules/Azure.AppGw.UseWAF/#recommendation","title":"Recommendation","text":"<p>Consider deploying Application Gateways with a WAF SKU to protect against common attacks.</p>","tags":["Azure.AppGw.UseWAF","AZR-000063"]},{"location":"en/rules/Azure.AppGw.UseWAF/#examples","title":"Examples","text":"","tags":["Azure.AppGw.UseWAF","AZR-000063"]},{"location":"en/rules/Azure.AppGw.UseWAF/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Deploy an Application Gateway with the <code>WAF</code> or <code>WAF_v2</code> SKU.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Network/applicationGateways\",\n    \"apiVersion\": \"2020-11-01\",\n    \"name\": \"appGw-001\",\n    \"location\": \"[resourceGroup().location]\",\n    \"properties\": {\n        \"sku\": {\n            \"name\": \"WAF_v2\",\n            \"tier\": \"WAF_v2\"\n        },\n        \"webApplicationFirewallConfiguration\": {\n            \"enabled\": true,\n            \"firewallMode\": \"Prevention\",\n            \"ruleSetType\": \"OWASP\",\n            \"ruleSetVersion\": \"3.2\",\n            \"disabledRuleGroups\": [],\n            \"requestBodyCheck\": true,\n            \"maxRequestBodySizeInKb\": 128,\n            \"fileUploadLimitInMb\": 100\n        }\n    }\n}\n</code></pre>","tags":["Azure.AppGw.UseWAF","AZR-000063"]},{"location":"en/rules/Azure.AppGw.UseWAF/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Deploy an Application Gateway with the <code>WAF</code> or <code>WAF_v2</code> SKU.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource appGw 'Microsoft.Network/applicationGateways@2021-02-01' = {\n  name: 'appGw-001'\n  location: location\n  properties: {\n    sku: {\n      name: 'WAF_v2'\n      tier: 'WAF_v2'\n    }\n    webApplicationFirewallConfiguration: {\n      enabled: true\n      firewallMode: 'Prevention'\n      ruleSetType: 'OWASP'\n      ruleSetVersion: '3.2'\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppGw.UseWAF","AZR-000063"]},{"location":"en/rules/Azure.AppGw.UseWAF/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az network application-gateway update --sku WAF_v2 -n '&lt;name&gt;' -g '&lt;resource_group&gt;'\n</code></pre>","tags":["Azure.AppGw.UseWAF","AZR-000063"]},{"location":"en/rules/Azure.AppGw.UseWAF/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>$AppGw = Get-AzApplicationGateway -Name '&lt;name&gt;' -ResourceGroupName '&lt;resource_group&gt;'\n$AppGw = Set-AzApplicationGatewaySku -ApplicationGateway $AppGw -Name 'WAF_v2' -Tier 'WAF_v2'\n</code></pre>","tags":["Azure.AppGw.UseWAF","AZR-000063"]},{"location":"en/rules/Azure.AppGw.UseWAF/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Securing PaaS deployments</li> <li>What is Azure Web Application Firewall on Azure Application Gateway?</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppGw.UseWAF","AZR-000063"]},{"location":"en/rules/Azure.AppGw.WAFEnabled/","title":"Application Gateway WAF is enabled","text":"Azure.AppGw.WAFEnabledAZR-000066Error <p> Security  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources.</p>","tags":["Azure.AppGw.WAFEnabled","AZR-000066"]},{"location":"en/rules/Azure.AppGw.WAFEnabled/#description","title":"Description","text":"<p>Security features of Application Gateways deployed with WAF may be toggled on or off.</p> <p>When WAF is disabled network traffic is still processed by the Application Gateway however detection and/ or prevention of malicious attacks does not occur.</p> <p>To protect backend resources from potentially malicious network traffic, WAF must be enabled.</p>","tags":["Azure.AppGw.WAFEnabled","AZR-000066"]},{"location":"en/rules/Azure.AppGw.WAFEnabled/#recommendation","title":"Recommendation","text":"<p>Consider enabling WAF for Application Gateway instances connected to un-trusted or low-trust networks such as the Internet.</p>","tags":["Azure.AppGw.WAFEnabled","AZR-000066"]},{"location":"en/rules/Azure.AppGw.WAFEnabled/#examples","title":"Examples","text":"","tags":["Azure.AppGw.WAFEnabled","AZR-000066"]},{"location":"en/rules/Azure.AppGw.WAFEnabled/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Set the <code>properties.webApplicationFirewallConfiguration.enabled</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Network/applicationGateways\",\n    \"apiVersion\": \"2020-11-01\",\n    \"name\": \"appGw-001\",\n    \"location\": \"[resourceGroup().location]\",\n    \"properties\": {\n        \"sku\": {\n            \"name\": \"WAF_v2\",\n            \"tier\": \"WAF_v2\"\n        },\n        \"webApplicationFirewallConfiguration\": {\n            \"enabled\": true,\n            \"firewallMode\": \"Prevention\",\n            \"ruleSetType\": \"OWASP\",\n            \"ruleSetVersion\": \"3.2\",\n            \"disabledRuleGroups\": [],\n            \"requestBodyCheck\": true,\n            \"maxRequestBodySizeInKb\": 128,\n            \"fileUploadLimitInMb\": 100\n        }\n    }\n}\n</code></pre>","tags":["Azure.AppGw.WAFEnabled","AZR-000066"]},{"location":"en/rules/Azure.AppGw.WAFEnabled/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Set the <code>properties.webApplicationFirewallConfiguration.enabled</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource appGw 'Microsoft.Network/applicationGateways@2021-02-01' = {\n  name: 'appGw-001'\n  location: location\n  properties: {\n    sku: {\n      name: 'WAF_v2'\n      tier: 'WAF_v2'\n    }\n    webApplicationFirewallConfiguration: {\n      enabled: true\n      firewallMode: 'Prevention'\n      ruleSetType: 'OWASP'\n      ruleSetVersion: '3.2'\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppGw.WAFEnabled","AZR-000066"]},{"location":"en/rules/Azure.AppGw.WAFEnabled/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az network application-gateway waf-config set --enabled true -n '&lt;name&gt;' -g '&lt;resource_group&gt;'\n</code></pre>","tags":["Azure.AppGw.WAFEnabled","AZR-000066"]},{"location":"en/rules/Azure.AppGw.WAFEnabled/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>$AppGw = Get-AzApplicationGateway -Name '&lt;name&gt;' -ResourceGroupName '&lt;resource_group&gt;'\nSet-AzApplicationGatewayWebApplicationFirewallConfiguration -ApplicationGateway $AppGw -Enabled $True -FirewallMode 'Prevention'\n</code></pre>","tags":["Azure.AppGw.WAFEnabled","AZR-000066"]},{"location":"en/rules/Azure.AppGw.WAFEnabled/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Securing PaaS deployments</li> <li>What is Azure Web Application Firewall on Azure Application Gateway?</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppGw.WAFEnabled","AZR-000066"]},{"location":"en/rules/Azure.AppGw.WAFRules/","title":"Application Gateway rules are enabled","text":"Azure.AppGw.WAFRulesAZR-000068Error <p> Security  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Application Gateway Web Application Firewall (WAF) should have all rules enabled.</p>","tags":["Azure.AppGw.WAFRules","AZR-000068"]},{"location":"en/rules/Azure.AppGw.WAFRules/#description","title":"Description","text":"<p>Application Gateway instances with WAF allow OWASP detection/ prevention rules to be toggled on or off. All OWASP rules are turned on by default.</p> <p>When OWASP rules are turned off, the protection they provide is disabled.</p>","tags":["Azure.AppGw.WAFRules","AZR-000068"]},{"location":"en/rules/Azure.AppGw.WAFRules/#recommendation","title":"Recommendation","text":"<p>Consider enabling all OWASP rules within Application Gateway instances.</p> <p>Before disabling OWASP rules, ensure that the backend workload has alternative protections in-place. Alternatively consider updating application code to use safe web standards.</p>","tags":["Azure.AppGw.WAFRules","AZR-000068"]},{"location":"en/rules/Azure.AppGw.WAFRules/#examples","title":"Examples","text":"","tags":["Azure.AppGw.WAFRules","AZR-000068"]},{"location":"en/rules/Azure.AppGw.WAFRules/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Set the <code>properties.webApplicationFirewallConfiguration.disabledRuleGroups.ruleGroupName</code> property to <code>$ruleName</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Network/applicationGateways\",\n    \"apiVersion\": \"2020-11-01\",\n    \"name\": \"appGw-001\",\n    \"location\": \"[resourceGroup().location]\",\n    \"properties\": {\n        \"sku\": {\n            \"name\": \"WAF_v2\",\n            \"tier\": \"WAF_v2\"\n        },\n        \"webApplicationFirewallConfiguration\": {\n            \"enabled\": true,\n            \"firewallMode\": \"Prevention\",\n            \"ruleSetType\": \"OWASP\",\n            \"ruleSetVersion\": \"3.2\",\n            \"disabledRuleGroups\": [\n              {\n                \"ruleGroupName\": \"exampleRule\",\n                \"rules\": []\n              }\n            ],\n            \"requestBodyCheck\": true,\n            \"maxRequestBodySizeInKb\": 128,\n            \"fileUploadLimitInMb\": 100\n        }\n    }\n}\n</code></pre>","tags":["Azure.AppGw.WAFRules","AZR-000068"]},{"location":"en/rules/Azure.AppGw.WAFRules/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Set the <code>properties.webApplicationFirewallConfiguration.enabled</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource appGw 'Microsoft.Network/applicationGateways@2021-02-01' = {\n  name: 'appGw-001'\n  location: location\n  properties: {\n    sku: {\n      name: 'WAF_v2'\n      tier: 'WAF_v2'\n    }\n    webApplicationFirewallConfiguration: {\n      enabled: true\n      firewallMode: 'Prevention'\n      ruleSetType: 'OWASP'\n      ruleSetVersion: '3.2'\n      disabledRuleGroups: [\n        {\n          ruleGroupName: 'exampleRule',\n          rules: []\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppGw.WAFRules","AZR-000068"]},{"location":"en/rules/Azure.AppGw.WAFRules/#links","title":"Links","text":"<ul> <li>Best practices for endpoint security on Azure</li> <li>Securing PaaS deployments</li> <li>What is Azure Web Application Firewall on Azure Application Gateway?</li> <li>Web Application Firewall CRS rule groups and rules</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppGw.WAFRules","AZR-000068"]},{"location":"en/rules/Azure.AppGwWAF.Enabled/","title":"Application Gateway WAF is enabled","text":"Azure.AppGwWAF.EnabledAZR-000309Error <p> Security  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2022_09  \u00b7  Critical</p> <p>Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources.</p>","tags":["Azure.AppGwWAF.Enabled","AZR-000309"]},{"location":"en/rules/Azure.AppGwWAF.Enabled/#description","title":"Description","text":"<p>Security features of Application Gateways deployed with WAF may be toggled on or off.</p> <p>When WAF is disabled network traffic is still processed by the Application Gateway however detection and/ or prevention of malicious attacks does not occur.</p> <p>To protect backend resources from potentially malicious network traffic, WAF must be enabled.</p>","tags":["Azure.AppGwWAF.Enabled","AZR-000309"]},{"location":"en/rules/Azure.AppGwWAF.Enabled/#recommendation","title":"Recommendation","text":"<p>Consider enabling WAF for Application Gateway instances connected to un-trusted or low-trust networks such as the Internet.</p>","tags":["Azure.AppGwWAF.Enabled","AZR-000309"]},{"location":"en/rules/Azure.AppGwWAF.Enabled/#examples","title":"Examples","text":"","tags":["Azure.AppGwWAF.Enabled","AZR-000309"]},{"location":"en/rules/Azure.AppGwWAF.Enabled/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Set the <code>properties.policySettings.state</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/ApplicationGatewayWebApplicationFirewallPolicies\",\n  \"apiVersion\": \"2022-01-01\",\n  \"name\": \"agwwaf\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"managedRules\": {\n      \"managedRuleSets\": [\n        {\n          \"ruleSetType\": \"OWASP\",\n          \"ruleSetVersion\": \"3.2\"\n        },\n        {\n          \"ruleSetType\": \"Microsoft_BotManagerRuleSet\",\n          \"ruleSetVersion\": \"0.1\"\n        }\n      ]\n    },\n    \"policySettings\": {\n      \"state\": \"Enabled\",\n      \"mode\": \"Prevention\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppGwWAF.Enabled","AZR-000309"]},{"location":"en/rules/Azure.AppGwWAF.Enabled/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Application Gateways that pass this rule:</p> <ul> <li>Set the <code>properties.policySettings.state</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource waf 'Microsoft.Network/ApplicationGatewayWebApplicationFirewallPolicies@2022-01-01' = {\n  name: 'agwwaf'\n  location: location\n  properties: {\n    managedRules: {\n      managedRuleSets: [\n        {\n          ruleSetType: 'OWASP'\n          ruleSetVersion: '3.2'\n        }\n        {\n          ruleSetType: 'Microsoft_BotManagerRuleSet'\n          ruleSetVersion: '0.1'\n        }\n      ]\n    }\n    policySettings: {\n      state: 'Enabled'\n      mode: 'Prevention'\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppGwWAF.Enabled","AZR-000309"]},{"location":"en/rules/Azure.AppGwWAF.Enabled/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az network application-gateway waf-config set --enabled true -n '&lt;name&gt;' -g '&lt;resource_group&gt;'\n</code></pre>","tags":["Azure.AppGwWAF.Enabled","AZR-000309"]},{"location":"en/rules/Azure.AppGwWAF.Enabled/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>$AppGw = Get-AzApplicationGateway -Name '&lt;name&gt;' -ResourceGroupName '&lt;resource_group&gt;'\nSet-AzApplicationGatewayWebApplicationFirewallConfiguration -ApplicationGateway $AppGw -Enabled $True -FirewallMode 'Prevention'\n</code></pre>","tags":["Azure.AppGwWAF.Enabled","AZR-000309"]},{"location":"en/rules/Azure.AppGwWAF.Enabled/#links","title":"Links","text":"<ul> <li>Best practices for endpoint security on Azure</li> <li>Securing PaaS deployments</li> <li>What is Azure Web Application Firewall on Azure Application Gateway?</li> <li>Azure deployment reference</li> <li>Web Application Firewall best practices</li> </ul>","tags":["Azure.AppGwWAF.Enabled","AZR-000309"]},{"location":"en/rules/Azure.AppGwWAF.Exclusions/","title":"Application Gateway rules are enabled","text":"Azure.AppGwWAF.ExclusionsAZR-000303Error <p> Security  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2022_09  \u00b7  Critical</p> <p>Application Gateway Web Application Firewall (WAF) should have all rules enabled.</p>","tags":["Azure.AppGwWAF.Exclusions","AZR-000303"]},{"location":"en/rules/Azure.AppGwWAF.Exclusions/#description","title":"Description","text":"<p>Application Gateway instances with WAF allow OWASP detection/ prevention rules to be toggled on or off. All OWASP rules are turned on by default.</p> <p>When OWASP rules are turned off, the protection they provide is disabled.</p>","tags":["Azure.AppGwWAF.Exclusions","AZR-000303"]},{"location":"en/rules/Azure.AppGwWAF.Exclusions/#recommendation","title":"Recommendation","text":"<p>Consider enabling all OWASP rules within Application Gateway instances.</p> <p>Before disabling OWASP rules, ensure that the backend workload has alternative protections in-place. Alternatively consider updating application code to use safe web standards.</p>","tags":["Azure.AppGwWAF.Exclusions","AZR-000303"]},{"location":"en/rules/Azure.AppGwWAF.Exclusions/#links","title":"Links","text":"<ul> <li>Best practices for endpoint security on Azure</li> <li>Securing PaaS deployments</li> <li>What is Azure Web Application Firewall on Azure Application Gateway?</li> <li>Web Application Firewall CRS rule groups and rules</li> <li>Web Application Firewall best practices</li> </ul>","tags":["Azure.AppGwWAF.Exclusions","AZR-000303"]},{"location":"en/rules/Azure.AppGwWAF.PreventionMode/","title":"Use Application Gateway WAF policy in prevention mode","text":"Azure.AppGwWAF.PreventionModeAZR-000302Error <p> Security  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2022_09  \u00b7  Critical</p> <p>Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources.</p>","tags":["Azure.AppGwWAF.PreventionMode","AZR-000302"]},{"location":"en/rules/Azure.AppGwWAF.PreventionMode/#description","title":"Description","text":"<p>Application Gateway WAF policies support two modes of operation, detection and prevention. By default, prevention is configured.</p> <ul> <li>Detection - monitors and logs all requests which match a WAF rule. In this mode, the WAF doesn't take action against incoming requests. To log requests, diagnostics on the Application Gateway instance must be configured.</li> <li>Protection - log and takes action against requests which match a WAF rule. The action to perform is configurable for each WAF rule.</li> </ul>","tags":["Azure.AppGwWAF.PreventionMode","AZR-000302"]},{"location":"en/rules/Azure.AppGwWAF.PreventionMode/#recommendation","title":"Recommendation","text":"<p>Consider setting Application Gateway WAF policy to use protection mode.</p>","tags":["Azure.AppGwWAF.PreventionMode","AZR-000302"]},{"location":"en/rules/Azure.AppGwWAF.PreventionMode/#links","title":"Links","text":"<ul> <li>Best practices for endpoint security on Azure</li> <li>Securing PaaS deployments</li> <li>Web Application Firewall best practices</li> </ul>","tags":["Azure.AppGwWAF.PreventionMode","AZR-000302"]},{"location":"en/rules/Azure.AppGwWAF.RuleGroups/","title":"Use Recommended Application Gateway WAF policy rule groups","text":"Azure.AppGwWAF.RuleGroupsAZR-000304Error <p> Security  \u00b7  Application Gateway  \u00b7  Rule  \u00b7  2024_03  \u00b7  Critical</p> <p>Use recommended rule groups in Application Gateway Web Application Firewall (WAF) policies to protect back end resources.</p>","tags":["Azure.AppGwWAF.RuleGroups","AZR-000304"]},{"location":"en/rules/Azure.AppGwWAF.RuleGroups/#description","title":"Description","text":"<p>Application Gateway WAF policies support two main Rule Groups.</p> <ul> <li>OWASP - Application Gateway web application firewall (WAF) protects web applications from common vulnerabilities and exploits. This is done through rules that are defined based on the OWASP core rule sets 3.2, 3.1, 3.0. It is recommended to use the latest rule set.</li> <li>Bot protection - Enable a managed bot protection rule set to block or log requests from known malicious IP addresses.</li> </ul>","tags":["Azure.AppGwWAF.RuleGroups","AZR-000304"]},{"location":"en/rules/Azure.AppGwWAF.RuleGroups/#recommendation","title":"Recommendation","text":"<p>Consider configuring Application Gateway WAF policy to use the recommended rule sets.</p>","tags":["Azure.AppGwWAF.RuleGroups","AZR-000304"]},{"location":"en/rules/Azure.AppGwWAF.RuleGroups/#links","title":"Links","text":"<ul> <li>Best practices for endpoint security on Azure</li> <li>Securing PaaS deployments</li> <li>Web Application Firewall CRS rule groups and rules</li> <li>Bot protection overview</li> <li>Web Application Firewall best practices</li> </ul>","tags":["Azure.AppGwWAF.RuleGroups","AZR-000304"]},{"location":"en/rules/Azure.AppInsights.Name/","title":"Use valid Application Insights resource names","text":"Azure.AppInsights.NameAZR-000070Error <p> Operational Excellence  \u00b7  Application Insights  \u00b7  Rule  \u00b7  2021_06  \u00b7  Awareness</p> <p>Azure Application Insights resources names should meet naming requirements.</p>","tags":["Azure.AppInsights.Name","AZR-000070"]},{"location":"en/rules/Azure.AppInsights.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Application Insights resource names are:</p> <ul> <li>Between 1 and 255 characters long.</li> <li>Letters, numbers, hyphens, periods, underscores, and parenthesis.</li> <li>Must not end in a period.</li> <li>Resource names must be unique within a resource group.</li> </ul>","tags":["Azure.AppInsights.Name","AZR-000070"]},{"location":"en/rules/Azure.AppInsights.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Application Insights resource naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.AppInsights.Name","AZR-000070"]},{"location":"en/rules/Azure.AppInsights.Name/#notes","title":"Notes","text":"<p>This rule does not check if Application Insights resource names are unique.</p>","tags":["Azure.AppInsights.Name","AZR-000070"]},{"location":"en/rules/Azure.AppInsights.Name/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Define your naming convention</li> <li>Recommended abbreviations for Azure resource types</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppInsights.Name","AZR-000070"]},{"location":"en/rules/Azure.AppInsights.Workspace/","title":"Use workspace-based App Insights resources","text":"Azure.AppInsights.WorkspaceAZR-000069Error <p> Operational Excellence  \u00b7  Application Insights  \u00b7  Rule  \u00b7  2021_06  \u00b7  Important</p> <p>Configure Application Insights resources to store data in a workspace.</p>","tags":["Azure.AppInsights.Workspace","AZR-000069"]},{"location":"en/rules/Azure.AppInsights.Workspace/#description","title":"Description","text":"<p>Application Insights (App Insights) can be deployed as either classic or workspace-based resources. When configured as workspace-based, telemetry is sent from App Insights to a common Log Analytics workspace. New App Insights resources must have a workspace configured during initial deployment.</p> <p>Using a Log Analytics workspace for App Insights:</p> <ul> <li>Makes it easier to correlate issues and query across application components.</li> <li>Adds support for additional features of Log Analytics workspaces including:<ul> <li>Customer-Managed Keys (CMK).</li> <li>Support for Azure Private Link.</li> <li>Capacity Reservation tiers.</li> <li>Faster data ingestion.</li> </ul> </li> </ul> <p>Classic App Insights resources are retired</p> <p>Classic App Insights resources are were retired on the 29 February 2024. Consider migrating to workspace-based resources.</p>","tags":["Azure.AppInsights.Workspace","AZR-000069"]},{"location":"en/rules/Azure.AppInsights.Workspace/#recommendation","title":"Recommendation","text":"<p>Consider using workspace-based Application Insights resources to collect telemetry in shared storage.</p>","tags":["Azure.AppInsights.Workspace","AZR-000069"]},{"location":"en/rules/Azure.AppInsights.Workspace/#examples","title":"Examples","text":"","tags":["Azure.AppInsights.Workspace","AZR-000069"]},{"location":"en/rules/Azure.AppInsights.Workspace/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Application Insights resources that pass this rule:</p> <ul> <li>Set the <code>properties.WorkspaceResourceId</code> property to a valid Log Analytics workspace.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"microsoft.insights/components\",\n  \"apiVersion\": \"2020-02-02\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"kind\": \"web\",\n  \"properties\": {\n    \"Application_Type\": \"web\",\n    \"Flow_Type\": \"Redfield\",\n    \"Request_Source\": \"IbizaAIExtension\",\n    \"WorkspaceResourceId\": \"[parameters('workspaceId')]\"\n  }\n}\n</code></pre>","tags":["Azure.AppInsights.Workspace","AZR-000069"]},{"location":"en/rules/Azure.AppInsights.Workspace/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Application Insights resources that pass this rule:</p> <ul> <li>Set the <code>properties.WorkspaceResourceId</code> property to a valid Log Analytics workspace.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource appInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: name\n  location: location\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n    Flow_Type: 'Redfield'\n    Request_Source: 'IbizaAIExtension'\n    WorkspaceResourceId: workspaceId\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/insights/component:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/insights/component:0.4.2\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppInsights.Workspace","AZR-000069"]},{"location":"en/rules/Azure.AppInsights.Workspace/#links","title":"Links","text":"<ul> <li>OE:07 Monitoring system</li> <li>Migrate to workspace-based Application Insights resources</li> <li>We're retiring Classic Application Insights on 29 February 2024</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppInsights.Workspace","AZR-000069"]},{"location":"en/rules/Azure.AppService.ARRAffinity/","title":"Disable Application Request Routing","text":"Azure.AppService.ARRAffinityAZR-000083Error <p> Performance Efficiency  \u00b7  App Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Disable client affinity for stateless services.</p>","tags":["Azure.AppService.ARRAffinity","AZR-000083"]},{"location":"en/rules/Azure.AppService.ARRAffinity/#description","title":"Description","text":"<p>Azure App Service apps use Application Request Routing (ARR) by default. ARR uses a cookie to route subsequent client requests back to the same instance when an app is scaled to two or more instances. This benefits stateful applications, which may hold session information in instance memory.</p> <p>For stateless applications, disabling ARR allows Azure App Service more evenly distribute load.</p>","tags":["Azure.AppService.ARRAffinity","AZR-000083"]},{"location":"en/rules/Azure.AppService.ARRAffinity/#recommendation","title":"Recommendation","text":"<p>Azure App Service sites make use of Application Request Routing (ARR) by default. Consider disabling ARR affinity for stateless applications.</p>","tags":["Azure.AppService.ARRAffinity","AZR-000083"]},{"location":"en/rules/Azure.AppService.ARRAffinity/#examples","title":"Examples","text":"","tags":["Azure.AppService.ARRAffinity","AZR-000083"]},{"location":"en/rules/Azure.AppService.ARRAffinity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>Set the <code>properties.clientAffinityEnabled</code> property to <code>false</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Web/sites\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"kind\": \"web\",\n  \"properties\": {\n    \"serverFarmId\": \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\",\n    \"httpsOnly\": true,\n    \"clientAffinityEnabled\": false,\n    \"siteConfig\": {\n      \"alwaysOn\": true,\n      \"minTlsVersion\": \"1.2\",\n      \"ftpsState\": \"Disabled\",\n      \"remoteDebuggingEnabled\": false,\n      \"http20Enabled\": true,\n      \"netFrameworkVersion\": \"v8.0\",\n      \"healthCheckPath\": \"/healthz\",\n      \"metadata\": [\n        {\n          \"name\": \"CURRENT_STACK\",\n          \"value\": \"dotnet\"\n        }\n      ]\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AppService.ARRAffinity","AZR-000083"]},{"location":"en/rules/Azure.AppService.ARRAffinity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>Set the <code>properties.clientAffinityEnabled</code> property to <code>false</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource web 'Microsoft.Web/sites@2023-01-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  kind: 'web'\n  properties: {\n    serverFarmId: plan.id\n    httpsOnly: true\n    clientAffinityEnabled: false\n    siteConfig: {\n      alwaysOn: true\n      minTlsVersion: '1.2'\n      ftpsState: 'Disabled'\n      remoteDebuggingEnabled: false\n      http20Enabled: true\n      netFrameworkVersion: 'v8.0'\n      healthCheckPath: '/healthz'\n      metadata: [\n        {\n          name: 'CURRENT_STACK'\n          value: 'dotnet'\n        }\n      ]\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/web/site:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/web/site:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppService.ARRAffinity","AZR-000083"]},{"location":"en/rules/Azure.AppService.ARRAffinity/#links","title":"Links","text":"<ul> <li>PE:05 Scaling and partitioning</li> <li>Configure an App Service app</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppService.ARRAffinity","AZR-000083"]},{"location":"en/rules/Azure.AppService.AlwaysOn/","title":"Use App Service Always On","text":"Azure.AppService.AlwaysOnAZR-000077Error <p> Reliability  \u00b7  App Service  \u00b7  Rule  \u00b7  2020_12  \u00b7  Important</p> <p>Configure Always On for App Service apps.</p>","tags":["Azure.AppService.AlwaysOn","AZR-000077"]},{"location":"en/rules/Azure.AppService.AlwaysOn/#description","title":"Description","text":"<p>Azure App Service apps are automatically unloaded when there's no traffic. Unloading apps reduces resource consumption when apps share a single App Services Plan. After an app have been unloaded, the next web request will trigger a cold start of the app. A cold start of the app can cause request timeouts.</p> <p>Web apps using continuous WebJobs or WebJobs triggered with a CRON expression must use always on to start.</p>","tags":["Azure.AppService.AlwaysOn","AZR-000077"]},{"location":"en/rules/Azure.AppService.AlwaysOn/#recommendation","title":"Recommendation","text":"<p>Consider enabling Always On for each App Services app.</p>","tags":["Azure.AppService.AlwaysOn","AZR-000077"]},{"location":"en/rules/Azure.AppService.AlwaysOn/#examples","title":"Examples","text":"","tags":["Azure.AppService.AlwaysOn","AZR-000077"]},{"location":"en/rules/Azure.AppService.AlwaysOn/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>Set the <code>properties.siteConfig.alwaysOn</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Web/sites\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"kind\": \"web\",\n  \"properties\": {\n    \"serverFarmId\": \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\",\n    \"httpsOnly\": true,\n    \"siteConfig\": {\n      \"alwaysOn\": true,\n      \"minTlsVersion\": \"1.2\",\n      \"ftpsState\": \"Disabled\",\n      \"remoteDebuggingEnabled\": false,\n      \"http20Enabled\": true,\n      \"netFrameworkVersion\": \"v8.0\",\n      \"healthCheckPath\": \"/healthz\",\n      \"metadata\": [\n        {\n          \"name\": \"CURRENT_STACK\",\n          \"value\": \"dotnet\"\n        }\n      ]\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AppService.AlwaysOn","AZR-000077"]},{"location":"en/rules/Azure.AppService.AlwaysOn/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>Set the <code>properties.siteConfig.alwaysOn</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource web 'Microsoft.Web/sites@2023-01-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  kind: 'web'\n  properties: {\n    serverFarmId: plan.id\n    httpsOnly: true\n    siteConfig: {\n      alwaysOn: true\n      minTlsVersion: '1.2'\n      ftpsState: 'Disabled'\n      remoteDebuggingEnabled: false\n      http20Enabled: true\n      netFrameworkVersion: 'v8.0'\n      healthCheckPath: '/healthz'\n      metadata: [\n        {\n          name: 'CURRENT_STACK'\n          value: 'dotnet'\n        }\n      ]\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/web/site:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/web/site:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppService.AlwaysOn","AZR-000077"]},{"location":"en/rules/Azure.AppService.AlwaysOn/#notes","title":"Notes","text":"<p>The Always On feature of App Service is not applicable to Azure Functions and Standard Logic Apps under most circumstances. To reduce false positives, this rule ignores apps based on Azure Functions and Standard Logic Apps.</p> <p>When running in a Consumption Plan or Premium Plan you should not enable Always On. On a Consumption plan the platform activates function apps automatically. On a Premium plan the platform keeps your desired number of pre-warmed instances always on automatically.</p>","tags":["Azure.AppService.AlwaysOn","AZR-000077"]},{"location":"en/rules/Azure.AppService.AlwaysOn/#links","title":"Links","text":"<ul> <li>Service guide</li> <li>Configure an App Service app</li> <li>The Ultimate Guide to Running Healthy Apps in the Cloud</li> <li>Always on with Azure Functions</li> <li>Dedicated hosting plans for Azure Functions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppService.AlwaysOn","AZR-000077"]},{"location":"en/rules/Azure.AppService.AvailabilityZone/","title":"Deploy app service plan instances using availability zones","text":"Azure.AppService.AvailabilityZoneAZR-000442Error <p> Reliability  \u00b7  App Service  \u00b7  Rule  \u00b7  2024_09  \u00b7  Important</p> <p>Deploy app service plan instances using availability zones in supported regions to ensure high availability and resilience.</p>","tags":["Azure.AppService.AvailabilityZone","AZR-000442"]},{"location":"en/rules/Azure.AppService.AvailabilityZone/#description","title":"Description","text":"<p>App Service plans support zone redundancy, which distributes your application running within the plan across Availablity Zones. Each Availability Zone is a group of phyiscally separated data centers. Deploying your application with zone redundancy:</p> <ul> <li>Scales your plan to a minimum of 3 instances in a highly available configuration.   Additional instances can be added manually or on-demand by using autoscale.</li> <li>Improves the resiliency against service disruptions or issues affecting a single zone.</li> </ul> <p>Additionally:</p> <ul> <li>Even Distribution: If the instance count is larger than 3 and divisible by 3, instances are evenly distributed across the three zones.</li> <li>Partial Distribution: Instance counts beyond 3*N are spread across the remaining one or two zones to ensure balanced distribution.</li> </ul> <p>Important Configuring zone redundancy with per-application scaling is possible but may increase costs and administrative overhead. When <code>perSiteScaling</code> is enabled, each application can have its own scaling rules and run on dedicated instances. To maintain zone redundancy, it is crucial that each application\u2019s scaling rules ensure a minimum of 3 instances. Without explicitly configuring this minimum, the application may not meet the zone redundancy requirement.</p>","tags":["Azure.AppService.AvailabilityZone","AZR-000442"]},{"location":"en/rules/Azure.AppService.AvailabilityZone/#recommendation","title":"Recommendation","text":"<p>Consider using enabling zone redundancy using availability zones to improve the resiliency of your solution.</p>","tags":["Azure.AppService.AvailabilityZone","AZR-000442"]},{"location":"en/rules/Azure.AppService.AvailabilityZone/#examples","title":"Examples","text":"","tags":["Azure.AppService.AvailabilityZone","AZR-000442"]},{"location":"en/rules/Azure.AppService.AvailabilityZone/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure a zone-redundant app service plan:</p> <ul> <li>Set the <code>properties.zoneRedundant</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Web/serverfarms\",\n  \"apiVersion\": \"2022-09-01\",\n  \"name\": \"[parameters('planName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"P1v3\",\n    \"tier\": \"PremiumV3\",\n    \"size\": \"P1v3\",\n    \"family\": \"Pv3\",\n    \"capacity\": 3\n  },\n  \"properties\": {\n    \"zoneRedundant\": true\n  }\n}\n</code></pre>","tags":["Azure.AppService.AvailabilityZone","AZR-000442"]},{"location":"en/rules/Azure.AppService.AvailabilityZone/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure a zone-redundant app service plan:</p> <ul> <li>Set the <code>properties.zoneRedundant</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource plan 'Microsoft.Web/serverfarms@2022-09-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'P1v3'\n    tier: 'PremiumV3'\n    size: 'P1v3'\n    family: 'Pv3'\n    capacity: 3\n  }\n  properties: {\n    zoneRedundant: true\n  }\n}\n</code></pre>","tags":["Azure.AppService.AvailabilityZone","AZR-000442"]},{"location":"en/rules/Azure.AppService.AvailabilityZone/#notes","title":"Notes","text":"<p>Zone-redundancy is only supported for the <code>PremiumV2</code>, <code>PremiumV3</code> and <code>ElasticPremium</code> SKU tiers.</p>","tags":["Azure.AppService.AvailabilityZone","AZR-000442"]},{"location":"en/rules/Azure.AppService.AvailabilityZone/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>Reliability in Azure App Service</li> <li>Availability zone support</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.AppService.AvailabilityZone","AZR-000442"]},{"location":"en/rules/Azure.AppService.HTTP2/","title":"Use HTTP/2 connections for App Service apps","text":"Azure.AppService.HTTP2AZR-000078Error <p> Performance Efficiency  \u00b7  App Service  \u00b7  Rule  \u00b7  2020_12  \u00b7  Awareness</p> <p>Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency.</p>","tags":["Azure.AppService.HTTP2","AZR-000078"]},{"location":"en/rules/Azure.AppService.HTTP2/#description","title":"Description","text":"<p>Azure App Service has native support for HTTP/2, but by default it is disabled. HTTP/2 offers a number of improvements over HTTP/1.1, including:</p> <ul> <li>Connections are fully multiplexed, instead of ordered and blocking.</li> <li>Connections are reused, reducing connection establishment overhead.</li> <li>Headers are compressed to reduce overhead.</li> </ul>","tags":["Azure.AppService.HTTP2","AZR-000078"]},{"location":"en/rules/Azure.AppService.HTTP2/#recommendation","title":"Recommendation","text":"<p>Consider using HTTP/2 for Azure Services apps to improve protocol efficiency.</p>","tags":["Azure.AppService.HTTP2","AZR-000078"]},{"location":"en/rules/Azure.AppService.HTTP2/#examples","title":"Examples","text":"","tags":["Azure.AppService.HTTP2","AZR-000078"]},{"location":"en/rules/Azure.AppService.HTTP2/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>Set the <code>properties.siteConfig.http20Enabled</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Web/sites\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"kind\": \"web\",\n  \"properties\": {\n    \"serverFarmId\": \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\",\n    \"httpsOnly\": true,\n    \"clientAffinityEnabled\": false,\n    \"siteConfig\": {\n      \"alwaysOn\": true,\n      \"minTlsVersion\": \"1.2\",\n      \"ftpsState\": \"Disabled\",\n      \"remoteDebuggingEnabled\": false,\n      \"http20Enabled\": true,\n      \"netFrameworkVersion\": \"v8.0\",\n      \"healthCheckPath\": \"/healthz\",\n      \"metadata\": [\n        {\n          \"name\": \"CURRENT_STACK\",\n          \"value\": \"dotnet\"\n        }\n      ]\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AppService.HTTP2","AZR-000078"]},{"location":"en/rules/Azure.AppService.HTTP2/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>Set the <code>properties.siteConfig.http20Enabled</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource web 'Microsoft.Web/sites@2023-01-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  kind: 'web'\n  properties: {\n    serverFarmId: plan.id\n    httpsOnly: true\n    clientAffinityEnabled: false\n    siteConfig: {\n      alwaysOn: true\n      minTlsVersion: '1.2'\n      ftpsState: 'Disabled'\n      remoteDebuggingEnabled: false\n      http20Enabled: true\n      netFrameworkVersion: 'v8.0'\n      healthCheckPath: '/healthz'\n      metadata: [\n        {\n          name: 'CURRENT_STACK'\n          value: 'dotnet'\n        }\n      ]\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/web/site:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/web/site:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppService.HTTP2","AZR-000078"]},{"location":"en/rules/Azure.AppService.HTTP2/#links","title":"Links","text":"<ul> <li>PE:07 Code and infrastructure</li> <li>Service guide</li> <li>Configure an App Service app</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppService.HTTP2","AZR-000078"]},{"location":"en/rules/Azure.AppService.ManagedIdentity/","title":"App Service apps uses a managed identity","text":"Azure.AppService.ManagedIdentityAZR-000082Error <p> Security  \u00b7  App Service  \u00b7  Rule  \u00b7  2020_12  \u00b7  Important</p> <p>Configure managed identities to access Azure resources.</p>","tags":["Azure.AppService.ManagedIdentity","AZR-000082"]},{"location":"en/rules/Azure.AppService.ManagedIdentity/#description","title":"Description","text":"<p>Azure App Service apps must authenticate to Azure resources such as Azure SQL Databases. App Service can use managed identities to authenticate to Azure resource without storing credentials.</p> <p>Using Azure managed identities have the following benefits:</p> <ul> <li>You don't need to store or manage credentials. Azure automatically generates tokens and performs rotation.</li> <li>You can use managed identities to authenticate to any Azure service that supports Azure AD authentication.</li> <li>Managed identities can be used without any additional cost.</li> </ul>","tags":["Azure.AppService.ManagedIdentity","AZR-000082"]},{"location":"en/rules/Azure.AppService.ManagedIdentity/#recommendation","title":"Recommendation","text":"<p>Consider configuring a managed identity for each App Service app. Also consider using managed identities to authenticate to related Azure services.</p>","tags":["Azure.AppService.ManagedIdentity","AZR-000082"]},{"location":"en/rules/Azure.AppService.ManagedIdentity/#examples","title":"Examples","text":"","tags":["Azure.AppService.ManagedIdentity","AZR-000082"]},{"location":"en/rules/Azure.AppService.ManagedIdentity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Web/sites\",\n    \"apiVersion\": \"2021-02-01\",\n    \"name\": \"[parameters('name')]\",\n    \"location\": \"[parameters('location')]\",\n    \"identity\": {\n        \"type\": \"SystemAssigned\"\n    },\n    \"kind\": \"web\",\n    \"properties\": {\n        \"serverFarmId\": \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\",\n        \"httpsOnly\": true,\n        \"siteConfig\": {\n            \"alwaysOn\": true,\n            \"minTlsVersion\": \"1.2\",\n            \"ftpsState\": \"FtpsOnly\",\n            \"remoteDebuggingEnabled\": false,\n            \"http20Enabled\": true\n        }\n    },\n    \"tags\": \"[parameters('tags')]\",\n    \"dependsOn\": [\n        \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\"\n    ]\n}\n</code></pre>","tags":["Azure.AppService.ManagedIdentity","AZR-000082"]},{"location":"en/rules/Azure.AppService.ManagedIdentity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource webApp 'Microsoft.Web/sites@2021-02-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  kind: 'web'\n  properties: {\n    serverFarmId: plan.id\n    httpsOnly: true\n    siteConfig: {\n      alwaysOn: true\n      minTlsVersion: '1.2'\n      ftpsState: 'FtpsOnly'\n      remoteDebuggingEnabled: false\n      http20Enabled: true\n    }\n  }\n  tags: tags\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/web/site:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/web/site:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppService.ManagedIdentity","AZR-000082"]},{"location":"en/rules/Azure.AppService.ManagedIdentity/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>What are managed identities for Azure resources?</li> <li>Tutorial: Secure Azure SQL Database connection from App Service using a managed identity</li> <li>How to use managed identities for App Service and Azure Functions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppService.ManagedIdentity","AZR-000082"]},{"location":"en/rules/Azure.AppService.MinPlan/","title":"Use App Service production SKU","text":"Azure.AppService.MinPlanAZR-000072Error <p> Performance Efficiency  \u00b7  App Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Use at least a Standard App Service Plan.</p>","tags":["Azure.AppService.MinPlan","AZR-000072"]},{"location":"en/rules/Azure.AppService.MinPlan/#description","title":"Description","text":"<p>Azure App Services provide a range of different plans that can be used to scale your application. Each plan provides different levels of performance and features.</p> <p>To get you started a number of entry level plans are available. The <code>Free</code>, <code>Shared</code>, and <code>Basic</code> plans can be used for limited testing and development. However these plans are not suitable for production use. Production workloads are best suited to standard and premium plans with <code>PremiumV3</code> the newest plan.</p> <p>This rule does not apply to consumption or elastic App Services Plans used for Azure Functions.</p>","tags":["Azure.AppService.MinPlan","AZR-000072"]},{"location":"en/rules/Azure.AppService.MinPlan/#recommendation","title":"Recommendation","text":"<p>Consider using a standard or premium plan for hosting apps on Azure App Service.</p>","tags":["Azure.AppService.MinPlan","AZR-000072"]},{"location":"en/rules/Azure.AppService.MinPlan/#examples","title":"Examples","text":"","tags":["Azure.AppService.MinPlan","AZR-000072"]},{"location":"en/rules/Azure.AppService.MinPlan/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy App Services Plans that pass this rule:</p> <ul> <li>Set <code>sku.tier</code> to a plan equal to or greater than <code>Standard</code>.   For example: <code>PremiumV3</code>, <code>PremiumV2</code>, <code>Premium</code>, <code>Standard</code></li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Web/serverfarms\",\n    \"apiVersion\": \"2022-09-01\",\n    \"name\": \"[parameters('planName')]\",\n    \"location\": \"[parameters('location')]\",\n    \"sku\": {\n        \"name\": \"S1\",\n        \"tier\": \"Standard\",\n        \"capacity\": 2\n    }\n}\n</code></pre>","tags":["Azure.AppService.MinPlan","AZR-000072"]},{"location":"en/rules/Azure.AppService.MinPlan/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy App Services Plans that pass this rule:</p> <ul> <li>Set <code>sku.tier</code> to a plan equal to or greater than <code>Standard</code>.   For example: <code>PremiumV3</code>, <code>PremiumV2</code>, <code>Premium</code>, <code>Standard</code></li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource plan 'Microsoft.Web/serverfarms@2022-09-01' = {\n  name: planName\n  location: location\n  sku: {\n    name: 'S1'\n    tier: 'Standard'\n    capacity: 2\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/web/serverfarm:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/web/serverfarm:0.3.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppService.MinPlan","AZR-000072"]},{"location":"en/rules/Azure.AppService.MinPlan/#links","title":"Links","text":"<ul> <li>Choose the right resources</li> <li>Azure App Service plan overview</li> <li>Manage an App Service plan in Azure</li> <li>Configure PremiumV3 tier for Azure App Service</li> <li>App Service pricing</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppService.MinPlan","AZR-000072"]},{"location":"en/rules/Azure.AppService.MinTLS/","title":"App Service minimum TLS version","text":"Azure.AppService.MinTLSAZR-000073Error <p> Security  \u00b7  App Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>App Service should reject TLS versions older than 1.2.</p>","tags":["Azure.AppService.MinTLS","AZR-000073"]},{"location":"en/rules/Azure.AppService.MinTLS/#description","title":"Description","text":"<p>The minimum version of TLS that Azure App Service accepts is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS.</p> <p>App Service lets you disable outdated protocols and enforce TLS 1.2. By default, a minimum of TLS 1.2 is enforced.</p>","tags":["Azure.AppService.MinTLS","AZR-000073"]},{"location":"en/rules/Azure.AppService.MinTLS/#recommendation","title":"Recommendation","text":"<p>Consider configuring the minimum supported TLS version to be 1.2. Also consider using Azure Policy to audit or enforce this configuration.</p>","tags":["Azure.AppService.MinTLS","AZR-000073"]},{"location":"en/rules/Azure.AppService.MinTLS/#examples","title":"Examples","text":"","tags":["Azure.AppService.MinTLS","AZR-000073"]},{"location":"en/rules/Azure.AppService.MinTLS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>Set the <code>properties.siteConfig.minTlsVersion</code> property to <code>1.2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Web/sites\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"kind\": \"web\",\n  \"properties\": {\n    \"serverFarmId\": \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\",\n    \"httpsOnly\": true,\n    \"siteConfig\": {\n      \"alwaysOn\": true,\n      \"minTlsVersion\": \"1.2\",\n      \"ftpsState\": \"Disabled\",\n      \"remoteDebuggingEnabled\": false,\n      \"http20Enabled\": true,\n      \"netFrameworkVersion\": \"v8.0\",\n      \"healthCheckPath\": \"/healthz\",\n      \"metadata\": [\n        {\n          \"name\": \"CURRENT_STACK\",\n          \"value\": \"dotnet\"\n        }\n      ]\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AppService.MinTLS","AZR-000073"]},{"location":"en/rules/Azure.AppService.MinTLS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>Set the <code>properties.siteConfig.minTlsVersion</code> property to <code>1.2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource web 'Microsoft.Web/sites@2023-01-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  kind: 'web'\n  properties: {\n    serverFarmId: plan.id\n    httpsOnly: true\n    siteConfig: {\n      alwaysOn: true\n      minTlsVersion: '1.2'\n      ftpsState: 'Disabled'\n      remoteDebuggingEnabled: false\n      http20Enabled: true\n      netFrameworkVersion: 'v8.0'\n      healthCheckPath: '/healthz'\n      metadata: [\n        {\n          name: 'CURRENT_STACK'\n          value: 'dotnet'\n        }\n      ]\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/web/site:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/web/site:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppService.MinTLS","AZR-000073"]},{"location":"en/rules/Azure.AppService.MinTLS/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>DP-3: Encrypt sensitive data in transit</li> <li>Enforce TLS versions</li> <li>TLS encryption in Azure</li> <li>Preparing for TLS 1.2 in Microsoft Azure</li> <li>Insecure protocols</li> <li>Azure Policy built-in definitions for Azure App Service</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppService.MinTLS","AZR-000073"]},{"location":"en/rules/Azure.AppService.NETVersion/","title":"Use a newer .NET version","text":"Azure.AppService.NETVersionAZR-000075Error <p> Security  \u00b7  App Service  \u00b7  Rule  \u00b7  2024_03  \u00b7  Important</p> <p>Configure applications to use newer .NET versions.</p>","tags":["Azure.AppService.NETVersion","AZR-000075"]},{"location":"en/rules/Azure.AppService.NETVersion/#description","title":"Description","text":"<p>Within a App Service app, the version of .NET used to run application/ site code is configurable.</p> <p>Overtime, a specific version of .NET may become outdated and no longer supported by Microsoft. This can lead to security vulnerabilities or are simply not able to use the latest security features.</p> <p>.NET 6.0 and .NET 7.0 are approaching end of support.</p>","tags":["Azure.AppService.NETVersion","AZR-000075"]},{"location":"en/rules/Azure.AppService.NETVersion/#recommendation","title":"Recommendation","text":"<p>Consider updating the site to use a newer .NET version such as <code>v8.0</code>.</p>","tags":["Azure.AppService.NETVersion","AZR-000075"]},{"location":"en/rules/Azure.AppService.NETVersion/#examples","title":"Examples","text":"","tags":["Azure.AppService.NETVersion","AZR-000075"]},{"location":"en/rules/Azure.AppService.NETVersion/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>For Windows-based plans:<ul> <li>Set the <code>properties.siteConfig.netFrameworkVersion</code> property to <code>v4.0</code> or <code>v8.0</code>.</li> </ul> </li> <li>For Linux-based plans:<ul> <li>Set the <code>properties.siteConfig.linuxFxVersion</code> property to <code>DOTNET|8.0</code>.   .NET Framework is not supported on Linux-based plans.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Web/sites\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"kind\": \"web\",\n  \"properties\": {\n    \"serverFarmId\": \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\",\n    \"httpsOnly\": true,\n    \"siteConfig\": {\n      \"alwaysOn\": true,\n      \"minTlsVersion\": \"1.2\",\n      \"ftpsState\": \"Disabled\",\n      \"remoteDebuggingEnabled\": false,\n      \"http20Enabled\": true,\n      \"netFrameworkVersion\": \"v8.0\",\n      \"healthCheckPath\": \"/healthz\",\n      \"metadata\": [\n        {\n          \"name\": \"CURRENT_STACK\",\n          \"value\": \"dotnet\"\n        }\n      ]\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AppService.NETVersion","AZR-000075"]},{"location":"en/rules/Azure.AppService.NETVersion/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>For Windows-based plans:<ul> <li>Set the <code>properties.siteConfig.netFrameworkVersion</code> property to <code>v4.0</code> or <code>v8.0</code>.</li> </ul> </li> <li>For Linux-based plans:<ul> <li>Set the <code>properties.siteConfig.linuxFxVersion</code> property to <code>DOTNET|8.0</code>.   .NET Framework is not supported on Linux-based plans.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource web 'Microsoft.Web/sites@2023-01-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  kind: 'web'\n  properties: {\n    serverFarmId: plan.id\n    httpsOnly: true\n    siteConfig: {\n      alwaysOn: true\n      minTlsVersion: '1.2'\n      ftpsState: 'Disabled'\n      remoteDebuggingEnabled: false\n      http20Enabled: true\n      netFrameworkVersion: 'v8.0'\n      healthCheckPath: '/healthz'\n      metadata: [\n        {\n          name: 'CURRENT_STACK'\n          value: 'dotnet'\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppService.NETVersion","AZR-000075"]},{"location":"en/rules/Azure.AppService.NETVersion/#_1","title":"Azure.AppService.NETVersion","text":"","tags":["Azure.AppService.NETVersion","AZR-000075"]},{"location":"en/rules/Azure.AppService.NETVersion/#links","title":"Links","text":"<ul> <li>SE:02 Secured development lifecycle</li> <li>Configure ASP.NET</li> <li>Configure an ASP.NET Core app for Azure App Service</li> <li>.NET Support Policy</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppService.NETVersion","AZR-000075"]},{"location":"en/rules/Azure.AppService.NodeJsVersion/","title":"Use a supported Node.js runtime version","text":"Azure.AppService.NodeJsVersionAZR-000428Error <p> Security  \u00b7  App Service  \u00b7  Rule  \u00b7  2024_06  \u00b7  Important</p> <p>Configure applications to use supported Node.js runtime versions.</p>","tags":["Azure.AppService.NodeJsVersion","AZR-000428"]},{"location":"en/rules/Azure.AppService.NodeJsVersion/#description","title":"Description","text":"<p>In an App Service app, you can configure the Node.js runtime version used to run your application or site code.</p> <p>Extended support for Node.js 18 LTS will end on April 30, 2025. While apps hosted on App Service will continue to operate, security updates and customer support for Node.js 18 LTS will no longer be provided after this date.</p> <p>To avoid potential security vulnerabilities and minimize risks for your App Service apps, it is recommended to upgrade your apps to Node.js 20 LTS before April 30, 2025.</p>","tags":["Azure.AppService.NodeJsVersion","AZR-000428"]},{"location":"en/rules/Azure.AppService.NodeJsVersion/#recommendation","title":"Recommendation","text":"<p>Consider updating applications to use supported Node.js runtime versions to maintain security and support.</p>","tags":["Azure.AppService.NodeJsVersion","AZR-000428"]},{"location":"en/rules/Azure.AppService.NodeJsVersion/#examples","title":"Examples","text":"","tags":["Azure.AppService.NodeJsVersion","AZR-000428"]},{"location":"en/rules/Azure.AppService.NodeJsVersion/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>For Linux-based apps and slots:<ul> <li>Set the <code>properties.siteConfig.linuxFxVersion</code> property to <code>NODE|20-lts</code>.</li> </ul> </li> <li>For Windows-based apps and slots:<ul> <li>Add an app setting within <code>properties.siteConfig.appSettings</code> by creating an object with the <code>name</code> and <code>value</code> properties.</li> <li>Set the <code>name</code> property to <code>WEBSITE_NODE_DEFAULT_VERSION</code>.</li> <li>Set the <code>value</code> property to <code>~20</code>.</li> </ul> </li> </ul> <p>In addition to setting the <code>properties.siteConfig</code> property, you can also use a sub-resource.</p> <p>For example (Linux app):</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Web/sites\",\n  \"apiVersion\": \"2022-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"kind\": \"web\",\n  \"properties\": {\n    \"serverFarmId\": \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\",\n    \"httpsOnly\": true,\n    \"siteConfig\": {\n      \"minTlsVersion\": \"1.2\",\n      \"linuxFxVersion\": \"NODE|20-lts\"\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\"\n  ]\n}\n</code></pre> <p>For example (Windows app):</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Web/sites\",\n  \"apiVersion\": \"2022-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"kind\": \"web\",\n  \"properties\": {\n    \"serverFarmId\": \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\",\n    \"httpsOnly\": true,\n    \"siteConfig\": {\n      \"minTlsVersion\": \"1.2\",\n      \"appSettings\": [\n        {\n          \"name\": \"WEBSITE_NODE_DEFAULT_VERSION\",\n          \"value\": \"~20\"\n        }\n      ]\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AppService.NodeJsVersion","AZR-000428"]},{"location":"en/rules/Azure.AppService.NodeJsVersion/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>For Linux-based apps and slots:<ul> <li>Set the <code>properties.siteConfig.linuxFxVersion</code> property to <code>NODE|20-lts</code>.</li> </ul> </li> <li>For Windows-based apps and slots:<ul> <li>Add an app setting within <code>properties.siteConfig.appSettings</code> by creating an object with the <code>name</code> and <code>value</code> properties.</li> <li>Set the <code>name</code> property to <code>WEBSITE_NODE_DEFAULT_VERSION</code>.</li> <li>Set the <code>value</code> property to <code>~20</code>.</li> </ul> </li> </ul> <p>In addition to setting the <code>properties.siteConfig</code> property, you can also use a sub-resource.</p> <p>For example (Linux app):</p> Azure Bicep snippet<pre><code>resource linuxWeb 'Microsoft.Web/sites@2022-09-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  kind: 'web'\n  properties: {\n    serverFarmId: plan.id\n    httpsOnly: true\n    siteConfig: {\n      minTlsVersion: '1.2'\n      linuxFxVersion: 'NODE|20-lts'\n    }\n  }\n}\n</code></pre> <p>For example (Windows app):</p> Azure Bicep snippet<pre><code>resource windowsWeb 'Microsoft.Web/sites@2022-09-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  kind: 'web'\n  properties: {\n    serverFarmId: plan.id\n    httpsOnly: true\n    siteConfig: {\n      minTlsVersion: '1.2'\n      appSettings: [\n        {\n          name: 'WEBSITE_NODE_DEFAULT_VERSION'\n          value: '~20'\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppService.NodeJsVersion","AZR-000428"]},{"location":"en/rules/Azure.AppService.NodeJsVersion/#links","title":"Links","text":"<ul> <li>SE:02 Secured development lifecycle</li> <li>Upgrade your App Service apps to Node 20 LTS by 30 April 2025</li> <li>Node.js on App Service</li> <li>Azure resource deployment</li> <li>Azure resource deployment</li> <li>Azure resource deployment</li> <li>Azure resource deployment</li> <li>Azure resource deployment</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.AppService.NodeJsVersion","AZR-000428"]},{"location":"en/rules/Azure.AppService.PHPVersion/","title":"Use a newer PHP runtime version","text":"Azure.AppService.PHPVersionAZR-000076Error <p> Security  \u00b7  App Service  \u00b7  Rule  \u00b7  2024_03  \u00b7  Important</p> <p>Configure applications to use newer PHP runtime versions.</p>","tags":["Azure.AppService.PHPVersion","AZR-000076"]},{"location":"en/rules/Azure.AppService.PHPVersion/#description","title":"Description","text":"<p>Within a App Service app, the version of PHP runtime used to run application/ site code is configurable.</p> <p>Overtime, a specific version of PHP may become outdated and no longer supported by Microsoft in Azure App Service. This can lead to security vulnerabilities or are simply not able to use the latest security features.</p> <p>PHP 8.0 and 8.1 are approaching end of support.</p>","tags":["Azure.AppService.PHPVersion","AZR-000076"]},{"location":"en/rules/Azure.AppService.PHPVersion/#recommendation","title":"Recommendation","text":"<p>Consider updating the site to use a newer PHP runtime version such as <code>8.2</code>.</p>","tags":["Azure.AppService.PHPVersion","AZR-000076"]},{"location":"en/rules/Azure.AppService.PHPVersion/#examples","title":"Examples","text":"","tags":["Azure.AppService.PHPVersion","AZR-000076"]},{"location":"en/rules/Azure.AppService.PHPVersion/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>Set <code>properties.siteConfig.linuxFxVersion</code> to a minimum of <code>PHP|8.2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Web/sites\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"kind\": \"web\",\n  \"properties\": {\n    \"serverFarmId\": \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\",\n    \"httpsOnly\": true,\n    \"clientAffinityEnabled\": false,\n    \"siteConfig\": {\n      \"alwaysOn\": true,\n      \"minTlsVersion\": \"1.2\",\n      \"ftpsState\": \"Disabled\",\n      \"http20Enabled\": true,\n      \"healthCheckPath\": \"/healthz\",\n      \"linuxFxVersion\": \"PHP|8.2\"\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AppService.PHPVersion","AZR-000076"]},{"location":"en/rules/Azure.AppService.PHPVersion/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>Set <code>properties.siteConfig.linuxFxVersion</code> to a minimum of <code>PHP|8.2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource php 'Microsoft.Web/sites@2023-01-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  kind: 'web'\n  properties: {\n    serverFarmId: plan.id\n    httpsOnly: true\n    clientAffinityEnabled: false\n    siteConfig: {\n      alwaysOn: true\n      minTlsVersion: '1.2'\n      ftpsState: 'Disabled'\n      http20Enabled: true\n      healthCheckPath: '/healthz'\n      linuxFxVersion: 'PHP|8.2'\n    }\n  }\n}\n</code></pre>","tags":["Azure.AppService.PHPVersion","AZR-000076"]},{"location":"en/rules/Azure.AppService.PHPVersion/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>App Service apps that use PHP should use a specified 'PHP version' <code>/providers/Microsoft.Authorization/policyDefinitions/7261b898-8a84-4db8-9e04-18527132abb3</code></li> <li>App Service app slots that use PHP should use a specified 'PHP version' <code>/providers/Microsoft.Authorization/policyDefinitions/f466b2a6-823d-470d-8ea5-b031e72d79ae</code></li> </ul>","tags":["Azure.AppService.PHPVersion","AZR-000076"]},{"location":"en/rules/Azure.AppService.PHPVersion/#notes","title":"Notes","text":"<p>From November 2022 - PHP is only supported on Linux-based plans.</p>","tags":["Azure.AppService.PHPVersion","AZR-000076"]},{"location":"en/rules/Azure.AppService.PHPVersion/#links","title":"Links","text":"<ul> <li>SE:02 Secured development lifecycle</li> <li>Set PHP Version</li> <li>PHP on App Service</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppService.PHPVersion","AZR-000076"]},{"location":"en/rules/Azure.AppService.PlanInstanceCount/","title":"Use two or more App Service Plan instances","text":"Azure.AppService.PlanInstanceCountAZR-000071Error <p> Reliability  \u00b7  App Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>App Service Plan should use a minimum number of instances for failover.</p>","tags":["Azure.AppService.PlanInstanceCount","AZR-000071"]},{"location":"en/rules/Azure.AppService.PlanInstanceCount/#description","title":"Description","text":"<p>App Services Plans provides a configurable number of instances that will run apps. When a single instance is configured your app may be temporarily unavailable during unplanned interruptions. In most circumstances, Azure will self heal faulty app service instances automatically. However during this time there may interruptions to your workload.</p> <p>This rule does not apply to consumption or elastic App Services Plans.</p>","tags":["Azure.AppService.PlanInstanceCount","AZR-000071"]},{"location":"en/rules/Azure.AppService.PlanInstanceCount/#recommendation","title":"Recommendation","text":"<p>Consider using an App Service Plan with at least two (2) instances.</p>","tags":["Azure.AppService.PlanInstanceCount","AZR-000071"]},{"location":"en/rules/Azure.AppService.PlanInstanceCount/#examples","title":"Examples","text":"","tags":["Azure.AppService.PlanInstanceCount","AZR-000071"]},{"location":"en/rules/Azure.AppService.PlanInstanceCount/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy App Services Plans that pass this rule:</p> <ul> <li>Set <code>sku.capacity</code> to <code>2</code> or more.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Web/serverfarms\",\n    \"apiVersion\": \"2021-01-15\",\n    \"name\": \"[parameters('planName')]\",\n    \"location\": \"[parameters('location')]\",\n    \"sku\": {\n        \"name\": \"S1\",\n        \"tier\": \"Standard\",\n        \"capacity\": 2\n    }\n}\n</code></pre>","tags":["Azure.AppService.PlanInstanceCount","AZR-000071"]},{"location":"en/rules/Azure.AppService.PlanInstanceCount/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy App Services Plans that pass this rule:</p> <ul> <li>Set <code>sku.capacity</code> to <code>2</code> or more.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource appPlan 'Microsoft.Web/serverfarms@2021-01-15' = {\n  name: planName\n  location: location\n  sku: {\n    name: 'S1'\n    tier: 'Standard'\n    capacity: 2\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/web/serverfarm:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/web/serverfarm:0.3.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppService.PlanInstanceCount","AZR-000071"]},{"location":"en/rules/Azure.AppService.PlanInstanceCount/#links","title":"Links","text":"<ul> <li>Resiliency and dependencies</li> <li>Get started with Autoscale in Azure</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppService.PlanInstanceCount","AZR-000071"]},{"location":"en/rules/Azure.AppService.RemoteDebug/","title":"Disable App Service remote debugging","text":"Azure.AppService.RemoteDebugAZR-000074Error <p> Security  \u00b7  App Service  \u00b7  Rule  \u00b7  2020_12  \u00b7  Important</p> <p>Disable remote debugging on App Service apps when not in use.</p>","tags":["Azure.AppService.RemoteDebug","AZR-000074"]},{"location":"en/rules/Azure.AppService.RemoteDebug/#description","title":"Description","text":"<p>Remote debugging can be enabled on apps running within Azure App Services.</p> <p>To enable remote debugging, App Service allows connectivity to additional ports. While access to remote debugging ports is authenticated, the attack service for an app is increased.</p>","tags":["Azure.AppService.RemoteDebug","AZR-000074"]},{"location":"en/rules/Azure.AppService.RemoteDebug/#recommendation","title":"Recommendation","text":"<p>Consider disabling remote debugging when not in use.</p>","tags":["Azure.AppService.RemoteDebug","AZR-000074"]},{"location":"en/rules/Azure.AppService.RemoteDebug/#examples","title":"Examples","text":"","tags":["Azure.AppService.RemoteDebug","AZR-000074"]},{"location":"en/rules/Azure.AppService.RemoteDebug/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>Set the <code>properties.siteConfig.remoteDebuggingEnabled</code> property to <code>false</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Web/sites\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"kind\": \"web\",\n  \"properties\": {\n    \"serverFarmId\": \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\",\n    \"httpsOnly\": true,\n    \"siteConfig\": {\n      \"alwaysOn\": true,\n      \"minTlsVersion\": \"1.2\",\n      \"ftpsState\": \"Disabled\",\n      \"remoteDebuggingEnabled\": false,\n      \"http20Enabled\": true,\n      \"netFrameworkVersion\": \"v8.0\",\n      \"healthCheckPath\": \"/healthz\",\n      \"metadata\": [\n        {\n          \"name\": \"CURRENT_STACK\",\n          \"value\": \"dotnet\"\n        }\n      ]\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AppService.RemoteDebug","AZR-000074"]},{"location":"en/rules/Azure.AppService.RemoteDebug/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>Set the <code>properties.siteConfig.remoteDebuggingEnabled</code> property to <code>false</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource web 'Microsoft.Web/sites@2023-01-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  kind: 'web'\n  properties: {\n    serverFarmId: plan.id\n    httpsOnly: true\n    siteConfig: {\n      alwaysOn: true\n      minTlsVersion: '1.2'\n      ftpsState: 'Disabled'\n      remoteDebuggingEnabled: false\n      http20Enabled: true\n      netFrameworkVersion: 'v8.0'\n      healthCheckPath: '/healthz'\n      metadata: [\n        {\n          name: 'CURRENT_STACK'\n          value: 'dotnet'\n        }\n      ]\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/web/site:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/web/site:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppService.RemoteDebug","AZR-000074"]},{"location":"en/rules/Azure.AppService.RemoteDebug/#links","title":"Links","text":"<ul> <li>SE:08 Hardening resources</li> <li>PV-2: Audit and enforce secure configurations</li> <li>Configure general settings</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppService.RemoteDebug","AZR-000074"]},{"location":"en/rules/Azure.AppService.UseHTTPS/","title":"App Service allows unencrypted traffic","text":"Azure.AppService.UseHTTPSAZR-000084Error <p> Security  \u00b7  App Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Unencrypted communication could allow disclosure of information to an untrusted party.</p>","tags":["Azure.AppService.UseHTTPS","AZR-000084"]},{"location":"en/rules/Azure.AppService.UseHTTPS/#description","title":"Description","text":"<p>Azure App Service apps are configured by default to accept encrypted and unencrypted connections. HTTP connections can be automatically redirected to use HTTPS when the HTTPS Only setting is enabled.</p> <p>Unencrypted communication to App Service apps could allow disclosure of information to an untrusted party.</p>","tags":["Azure.AppService.UseHTTPS","AZR-000084"]},{"location":"en/rules/Azure.AppService.UseHTTPS/#recommendation","title":"Recommendation","text":"<p>When access using unencrypted HTTP connection is not required consider enabling HTTPS Only. Also consider using Azure Policy to audit or enforce this configuration.</p>","tags":["Azure.AppService.UseHTTPS","AZR-000084"]},{"location":"en/rules/Azure.AppService.UseHTTPS/#examples","title":"Examples","text":"","tags":["Azure.AppService.UseHTTPS","AZR-000084"]},{"location":"en/rules/Azure.AppService.UseHTTPS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>Set the <code>properties.httpsOnly</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Web/sites\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"kind\": \"web\",\n  \"properties\": {\n    \"serverFarmId\": \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\",\n    \"httpsOnly\": true,\n    \"siteConfig\": {\n      \"alwaysOn\": true,\n      \"minTlsVersion\": \"1.2\",\n      \"ftpsState\": \"Disabled\",\n      \"remoteDebuggingEnabled\": false,\n      \"http20Enabled\": true,\n      \"netFrameworkVersion\": \"v8.0\",\n      \"healthCheckPath\": \"/healthz\",\n      \"metadata\": [\n        {\n          \"name\": \"CURRENT_STACK\",\n          \"value\": \"dotnet\"\n        }\n      ]\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AppService.UseHTTPS","AZR-000084"]},{"location":"en/rules/Azure.AppService.UseHTTPS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy App Services that pass this rule:</p> <ul> <li>Set the <code>properties.httpsOnly</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource web 'Microsoft.Web/sites@2023-01-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  kind: 'web'\n  properties: {\n    serverFarmId: plan.id\n    httpsOnly: true\n    siteConfig: {\n      alwaysOn: true\n      minTlsVersion: '1.2'\n      ftpsState: 'Disabled'\n      remoteDebuggingEnabled: false\n      http20Enabled: true\n      netFrameworkVersion: 'v8.0'\n      healthCheckPath: '/healthz'\n      metadata: [\n        {\n          name: 'CURRENT_STACK'\n          value: 'dotnet'\n        }\n      ]\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/web/site:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/web/site:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppService.UseHTTPS","AZR-000084"]},{"location":"en/rules/Azure.AppService.UseHTTPS/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>DP-3: Encrypt sensitive data in transit</li> <li>Enforce HTTPS</li> <li>Azure Policy built-in definitions for Azure App Service</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppService.UseHTTPS","AZR-000084"]},{"location":"en/rules/Azure.AppService.WebProbe/","title":"Web apps use health probes","text":"Azure.AppService.WebProbeAZR-000079Error <p> Reliability  \u00b7  App Service  \u00b7  Rule  \u00b7  2022_06  \u00b7  Important</p> <p>Configure and enable instance health probes.</p>","tags":["Azure.AppService.WebProbe","AZR-000079"]},{"location":"en/rules/Azure.AppService.WebProbe/#description","title":"Description","text":"<p>Azure App Service monitors a specific path for each web app instance to determine health status. The monitored path should implement functional checks to determine if the app is performing correctly. The checks should include dependencies including those that may not be regularly called.</p> <p>Regular checks of the monitored path allow Azure App Service to route traffic based on availability.</p>","tags":["Azure.AppService.WebProbe","AZR-000079"]},{"location":"en/rules/Azure.AppService.WebProbe/#recommendation","title":"Recommendation","text":"<p>Consider configuring a health probe to monitor instance availability.</p>","tags":["Azure.AppService.WebProbe","AZR-000079"]},{"location":"en/rules/Azure.AppService.WebProbe/#examples","title":"Examples","text":"","tags":["Azure.AppService.WebProbe","AZR-000079"]},{"location":"en/rules/Azure.AppService.WebProbe/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Web Apps that pass this rule:</p> <ul> <li>Set the <code>properties.siteConfig.healthCheckPath</code> property to a valid application path such as <code>/healthz</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Web/sites\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"kind\": \"web\",\n  \"properties\": {\n    \"serverFarmId\": \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\",\n    \"httpsOnly\": true,\n    \"siteConfig\": {\n      \"alwaysOn\": true,\n      \"minTlsVersion\": \"1.2\",\n      \"ftpsState\": \"Disabled\",\n      \"remoteDebuggingEnabled\": false,\n      \"http20Enabled\": true,\n      \"netFrameworkVersion\": \"v8.0\",\n      \"healthCheckPath\": \"/healthz\",\n      \"metadata\": [\n        {\n          \"name\": \"CURRENT_STACK\",\n          \"value\": \"dotnet\"\n        }\n      ]\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AppService.WebProbe","AZR-000079"]},{"location":"en/rules/Azure.AppService.WebProbe/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Web Apps that pass this rule:</p> <ul> <li>Set the <code>properties.siteConfig.healthCheckPath</code> property to a valid application path such as <code>/healthz</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource web 'Microsoft.Web/sites@2023-01-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  kind: 'web'\n  properties: {\n    serverFarmId: plan.id\n    httpsOnly: true\n    siteConfig: {\n      alwaysOn: true\n      minTlsVersion: '1.2'\n      ftpsState: 'Disabled'\n      remoteDebuggingEnabled: false\n      http20Enabled: true\n      netFrameworkVersion: 'v8.0'\n      healthCheckPath: '/healthz'\n      metadata: [\n        {\n          name: 'CURRENT_STACK'\n          value: 'dotnet'\n        }\n      ]\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/web/site:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/web/site:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppService.WebProbe","AZR-000079"]},{"location":"en/rules/Azure.AppService.WebProbe/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Creating good health probes</li> <li>Health Check is now Generally Available</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppService.WebProbe","AZR-000079"]},{"location":"en/rules/Azure.AppService.WebProbePath/","title":"Web apps use a dedicated health probe path","text":"Azure.AppService.WebProbePathAZR-000080Error <p> Reliability  \u00b7  App Service  \u00b7  Rule  \u00b7  2022_06  \u00b7  Important</p> <p>Configure a dedicated path for health probe requests.</p>","tags":["Azure.AppService.WebProbePath","AZR-000080"]},{"location":"en/rules/Azure.AppService.WebProbePath/#description","title":"Description","text":"<p>Azure App Service monitors a specific path for each web app instance to determine health status. The monitored path should implement functional checks to determine if the app is performing correctly. The checks should include dependencies including those that may not be regularly called.</p> <p>Regular checks of the monitored path allow Azure App Service to route traffic based on availability.</p>","tags":["Azure.AppService.WebProbePath","AZR-000080"]},{"location":"en/rules/Azure.AppService.WebProbePath/#recommendation","title":"Recommendation","text":"<p>Consider using a dedicated health probe endpoint that implements functional checks.</p>","tags":["Azure.AppService.WebProbePath","AZR-000080"]},{"location":"en/rules/Azure.AppService.WebProbePath/#examples","title":"Examples","text":"","tags":["Azure.AppService.WebProbePath","AZR-000080"]},{"location":"en/rules/Azure.AppService.WebProbePath/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Web Apps that pass this rule:</p> <ul> <li>Set the <code>properties.siteConfig.healthCheckPath</code> property to a dedicated application path such as <code>/healthz</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Web/sites\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"kind\": \"web\",\n  \"properties\": {\n    \"serverFarmId\": \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\",\n    \"httpsOnly\": true,\n    \"siteConfig\": {\n      \"alwaysOn\": true,\n      \"minTlsVersion\": \"1.2\",\n      \"ftpsState\": \"Disabled\",\n      \"remoteDebuggingEnabled\": false,\n      \"http20Enabled\": true,\n      \"netFrameworkVersion\": \"v8.0\",\n      \"healthCheckPath\": \"/healthz\",\n      \"metadata\": [\n        {\n          \"name\": \"CURRENT_STACK\",\n          \"value\": \"dotnet\"\n        }\n      ]\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AppService.WebProbePath","AZR-000080"]},{"location":"en/rules/Azure.AppService.WebProbePath/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Web Apps that pass this rule:</p> <ul> <li>Set the <code>properties.siteConfig.healthCheckPath</code> property to a dedicated application path such as <code>/healthz</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource web 'Microsoft.Web/sites@2023-01-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  kind: 'web'\n  properties: {\n    serverFarmId: plan.id\n    httpsOnly: true\n    siteConfig: {\n      alwaysOn: true\n      minTlsVersion: '1.2'\n      ftpsState: 'Disabled'\n      remoteDebuggingEnabled: false\n      http20Enabled: true\n      netFrameworkVersion: 'v8.0'\n      healthCheckPath: '/healthz'\n      metadata: [\n        {\n          name: 'CURRENT_STACK'\n          value: 'dotnet'\n        }\n      ]\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/web/site:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/web/site:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppService.WebProbePath","AZR-000080"]},{"location":"en/rules/Azure.AppService.WebProbePath/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Creating good health probes</li> <li>Health Check is now Generally Available</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppService.WebProbePath","AZR-000080"]},{"location":"en/rules/Azure.AppService.WebSecureFtp/","title":"Web apps disable insecure FTP","text":"Azure.AppService.WebSecureFtpAZR-000081Error <p> Security  \u00b7  App Service  \u00b7  Rule  \u00b7  2022_06  \u00b7  Important</p> <p>Web apps should disable insecure FTP and configure SFTP when required.</p>","tags":["Azure.AppService.WebSecureFtp","AZR-000081"]},{"location":"en/rules/Azure.AppService.WebSecureFtp/#description","title":"Description","text":"<p>Azure App Service supports configuration of FTP and SFTP for uploading site content. By default, both FTP and SFTP are enabled. In many circumstances, use of FTP or SFTP is not required for automated deployments.</p> <p>When interactive deployments are required consider using SFTP instead of FTP. Use of FTP alone is not sufficient to prevent disclosure of sensitive information that may be transferred.</p>","tags":["Azure.AppService.WebSecureFtp","AZR-000081"]},{"location":"en/rules/Azure.AppService.WebSecureFtp/#recommendation","title":"Recommendation","text":"<p>Consider disabling insecure FTP and configure SFTP only when required. Also consider using Azure Policy to audit or enforce this configuration.</p>","tags":["Azure.AppService.WebSecureFtp","AZR-000081"]},{"location":"en/rules/Azure.AppService.WebSecureFtp/#examples","title":"Examples","text":"","tags":["Azure.AppService.WebSecureFtp","AZR-000081"]},{"location":"en/rules/Azure.AppService.WebSecureFtp/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Web Apps that pass this rule:</p> <ul> <li>Set the <code>properties.siteConfig.ftpsState</code> property to <code>FtpsOnly</code> or <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Web/sites\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"kind\": \"web\",\n  \"properties\": {\n    \"serverFarmId\": \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\",\n    \"httpsOnly\": true,\n    \"siteConfig\": {\n      \"alwaysOn\": true,\n      \"minTlsVersion\": \"1.2\",\n      \"ftpsState\": \"Disabled\",\n      \"remoteDebuggingEnabled\": false,\n      \"http20Enabled\": true,\n      \"netFrameworkVersion\": \"v8.0\",\n      \"healthCheckPath\": \"/healthz\",\n      \"metadata\": [\n        {\n          \"name\": \"CURRENT_STACK\",\n          \"value\": \"dotnet\"\n        }\n      ]\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Web/serverfarms', parameters('planName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.AppService.WebSecureFtp","AZR-000081"]},{"location":"en/rules/Azure.AppService.WebSecureFtp/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Web Apps that pass this rule:</p> <ul> <li>Set the <code>properties.siteConfig.ftpsState</code> property to <code>FtpsOnly</code> or <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource web 'Microsoft.Web/sites@2023-01-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  kind: 'web'\n  properties: {\n    serverFarmId: plan.id\n    httpsOnly: true\n    siteConfig: {\n      alwaysOn: true\n      minTlsVersion: '1.2'\n      ftpsState: 'Disabled'\n      remoteDebuggingEnabled: false\n      http20Enabled: true\n      netFrameworkVersion: 'v8.0'\n      healthCheckPath: '/healthz'\n      metadata: [\n        {\n          name: 'CURRENT_STACK'\n          value: 'dotnet'\n        }\n      ]\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/web/site:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/web/site:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.AppService.WebSecureFtp","AZR-000081"]},{"location":"en/rules/Azure.AppService.WebSecureFtp/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>App Service apps should require FTPS only <code>/providers/Microsoft.Authorization/policyDefinitions/4d24b6d4-5e53-4a4f-a7f4-618fa573ee4b</code></li> <li>App Service app slots should require FTPS only <code>/providers/Microsoft.Authorization/policyDefinitions/c285a320-8830-4665-9cc7-bbd05fc7c5c0</code></li> <li>Function apps should require FTPS only <code>/providers/Microsoft.Authorization/policyDefinitions/399b2637-a50f-4f95-96f8-3a145476eb15</code></li> <li>Function app slots should require FTPS only <code>/providers/Microsoft.Authorization/policyDefinitions/e1a09430-221d-4d4c-a337-1edb5a1fa9bb</code></li> <li>[Deprecated]: FTPS only should be required in your API App <code>/providers/Microsoft.Authorization/policyDefinitions/9a1b8c48-453a-4044-86c3-d8bfd823e4f5</code></li> </ul>","tags":["Azure.AppService.WebSecureFtp","AZR-000081"]},{"location":"en/rules/Azure.AppService.WebSecureFtp/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Deploy your app to Azure App Service using FTP/S</li> <li>Insecure protocols</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.AppService.WebSecureFtp","AZR-000081"]},{"location":"en/rules/Azure.Arc.Kubernetes.Defender/","title":"Use Microsoft Defender","text":"Azure.Arc.Kubernetes.DefenderAZR-000373Error <p> Security  \u00b7  Arc  \u00b7  Rule  \u00b7  Preview  \u00b7  2023_06  \u00b7  Important</p> <p>Deploy Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters.</p>","tags":["Azure.Arc.Kubernetes.Defender","AZR-000373"]},{"location":"en/rules/Azure.Arc.Kubernetes.Defender/#description","title":"Description","text":"<p>Defender for Containers relies on the Defender extension for several features.</p> <p>To collect and provide data plane protections of Microsoft Defender for Containers, the extension must be deployed to the Arc connected Kubernetes cluster. The extension will deploy some additional daemon set and deployments to the cluster.</p>","tags":["Azure.Arc.Kubernetes.Defender","AZR-000373"]},{"location":"en/rules/Azure.Arc.Kubernetes.Defender/#recommendation","title":"Recommendation","text":"<p>Consider deploying the Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters.</p>","tags":["Azure.Arc.Kubernetes.Defender","AZR-000373"]},{"location":"en/rules/Azure.Arc.Kubernetes.Defender/#examples","title":"Examples","text":"","tags":["Azure.Arc.Kubernetes.Defender","AZR-000373"]},{"location":"en/rules/Azure.Arc.Kubernetes.Defender/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Arc-enabled Kubernetes clusters that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.KubernetesConfiguration/extensions</code> sub-resource (extension resource).</li> <li>Set the <code>properties.extensionType</code> property to <code>microsoft.azuredefender.kubernetes</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.KubernetesConfiguration/extensions\",\n  \"apiVersion\": \"2022-11-01\",\n  \"scope\": \"[format('Microsoft.Kubernetes/connectedClusters/{0}', parameters('name'))]\",\n  \"name\": \"microsoft.azuredefender.kubernetes\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"extensionType\": \"microsoft.azuredefender.kubernetes\",\n    \"configurationSettings\": {\n      \"logAnalyticsWorkspaceResourceID\": \"[parameters('logAnalyticsWorkspaceResourceID')]\",\n       \"auditLogPath\": \"/var/log/kube-apiserver/audit.log\"\n    },\n    \"configurationProtectedSettings\": {\n      \"omsagent.secret.wsid\": \"[parameters('wsid')]\",\n      \"omsagent.secret.key\": \"[parameters('key')]\"\n    },\n    \"autoUpgradeMinorVersion\": true,\n    \"releaseTrain\": \"Stable\",\n    \"scope\": {\n      \"cluster\": {\n        \"releaseNamespace\": \"azuredefender\"\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Kubernetes/connectedClusters', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.Arc.Kubernetes.Defender","AZR-000373"]},{"location":"en/rules/Azure.Arc.Kubernetes.Defender/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Arc-enabled Kubernetes clusters that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.KubernetesConfiguration/extensions</code> sub-resource (extension resource).</li> <li>Set the <code>properties.extensionType</code> property to <code>microsoft.azuredefender.kubernetes</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderExtension 'Microsoft.KubernetesConfiguration/extensions@2022-11-01' = {\n  name: 'microsoft.azuredefender.kubernetes'\n  scope: arcKubernetesCluster\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    extensionType: 'microsoft.azuredefender.kubernetes'\n    configurationSettings: {\n      logAnalyticsWorkspaceResourceID: logAnalyticsWorkspaceResourceID\n      auditLogPath: '/var/log/kube-apiserver/audit.log'\n    }\n    configurationProtectedSettings: {\n      'omsagent.secret.wsid': wsid\n      'omsagent.secret.key': key\n    }\n    autoUpgradeMinorVersion: true\n    releaseTrain: 'Stable'\n    scope: {\n      cluster: {\n        releaseNamespace: 'azuredefender'\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.Arc.Kubernetes.Defender","AZR-000373"]},{"location":"en/rules/Azure.Arc.Kubernetes.Defender/#links","title":"Links","text":"<ul> <li>Security operations</li> <li>Defender for Containers architecture</li> <li>Enable Microsoft Defender for Containers</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Arc.Kubernetes.Defender","AZR-000373"]},{"location":"en/rules/Azure.Arc.Server.MaintenanceConfig/","title":"Associate a maintenance configuration","text":"Azure.Arc.Server.MaintenanceConfigAZR-000374Error <p> Operational Excellence  \u00b7  Arc  \u00b7  Rule  \u00b7  Preview  \u00b7  2023_06  \u00b7  Important</p> <p>Use a maintenance configuration for Arc-enabled servers.</p>","tags":["Azure.Arc.Server.MaintenanceConfig","AZR-000374"]},{"location":"en/rules/Azure.Arc.Server.MaintenanceConfig/#description","title":"Description","text":"<p>Arc-enabled servers can be attached to a maintenance configuration which allows customer managed assessments and updates for machine patches within the guest operating system.</p>","tags":["Azure.Arc.Server.MaintenanceConfig","AZR-000374"]},{"location":"en/rules/Azure.Arc.Server.MaintenanceConfig/#recommendation","title":"Recommendation","text":"<p>Consider automatically managing and applying operating system updates with a maintenance configuration.</p>","tags":["Azure.Arc.Server.MaintenanceConfig","AZR-000374"]},{"location":"en/rules/Azure.Arc.Server.MaintenanceConfig/#examples","title":"Examples","text":"","tags":["Azure.Arc.Server.MaintenanceConfig","AZR-000374"]},{"location":"en/rules/Azure.Arc.Server.MaintenanceConfig/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Arc-enabled servers that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.Maintenance/configurationAssignments</code> sub-resource (extension resource).</li> <li>Set the <code>properties.maintenanceConfigurationId</code> property to the linked maintenance configuration resource Id.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Maintenance/configurationAssignments\",\n  \"apiVersion\": \"2022-11-01-preview\",\n  \"name\": \"[parameters('assignmentName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"scope\": \"[format('Microsoft.HybridCompute/machines/{0}', parameters('name'))]\",\n  \"properties\": {\n    \"maintenanceConfigurationId\": \"[parameters('maintenanceConfigurationId')]\"\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.HybridCompute/machines', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.Arc.Server.MaintenanceConfig","AZR-000374"]},{"location":"en/rules/Azure.Arc.Server.MaintenanceConfig/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Arc-enabled servers that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.Maintenance/configurationAssignments</code> sub-resource (extension resource).</li> <li>Set the <code>properties.maintenanceConfigurationId</code> property to the linked maintenance configuration resource Id.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource config 'Microsoft.Maintenance/configurationAssignments@2022-11-01-preview' = {\n  name: assignmentName\n  location: location\n  scope: arcServer\n  properties: {\n    maintenanceConfigurationId: maintenanceConfigurationId\n  }\n}\n</code></pre>","tags":["Azure.Arc.Server.MaintenanceConfig","AZR-000374"]},{"location":"en/rules/Azure.Arc.Server.MaintenanceConfig/#notes","title":"Notes","text":"<p>Operating system updates with Update Managment center is a preview feature. Not all regions or operating systems are supported, check out the <code>LINKS</code> section for supported regions. Update management center doesn't support driver updates.</p>","tags":["Azure.Arc.Server.MaintenanceConfig","AZR-000374"]},{"location":"en/rules/Azure.Arc.Server.MaintenanceConfig/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>About Update management center</li> <li>How to programmatically manage updates for Azure Arc-enabled servers</li> <li>Manage Update configuration settings</li> <li>Supported regions</li> <li>Supported operating systems</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Arc.Server.MaintenanceConfig","AZR-000374"]},{"location":"en/rules/Azure.Automation.AuditLogs/","title":"Audit Automation Account data access","text":"Azure.Automation.AuditLogsAZR-000088Error <p> Security  \u00b7  Automation Account  \u00b7  Rule  \u00b7  2021_12  \u00b7  Important</p> <p>Ensure automation account audit diagnostic logs are enabled.</p>","tags":["Azure.Automation.AuditLogs","AZR-000088"]},{"location":"en/rules/Azure.Automation.AuditLogs/#description","title":"Description","text":"<p>To capture logs that record interactions with data or the settings of the automation account, diagnostic settings must be configured.</p> <p>When configuring diagnostic settings, enabled one of the following:</p> <ul> <li><code>AuditEvent</code> category.</li> <li><code>audit</code> category group.</li> <li><code>allLogs</code> category group.</li> </ul> <p>Management operations for Automation Account is captured automatically within Azure Activity Logs.</p>","tags":["Azure.Automation.AuditLogs","AZR-000088"]},{"location":"en/rules/Azure.Automation.AuditLogs/#recommendation","title":"Recommendation","text":"<p>Consider configuring diagnostic settings to record interactions with data or the settings of the Automation Account.</p>","tags":["Azure.Automation.AuditLogs","AZR-000088"]},{"location":"en/rules/Azure.Automation.AuditLogs/#examples","title":"Examples","text":"","tags":["Azure.Automation.AuditLogs","AZR-000088"]},{"location":"en/rules/Azure.Automation.AuditLogs/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Automation accounts that pass this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource (extension resource).</li> <li>Enable <code>AuditEvent</code> category or <code>audit</code> category group or <code>allLogs</code> category group.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"parameters\": {\n        \"automationAccountName\": {\n            \"defaultValue\": \"automation-account1\",\n            \"type\": \"String\"\n        },\n        \"location\": {\n          \"type\": \"String\"\n        },\n        \"workspaceId\": {\n          \"type\": \"String\"\n        }\n    },\n    \"variables\": {},\n    \"resources\": [\n        {\n            \"type\": \"Microsoft.Automation/automationAccounts\",\n            \"apiVersion\": \"2021-06-22\",\n            \"name\": \"[parameters('automationAccountName')]\",\n            \"location\": \"[parameters('location')]\",\n            \"identity\": {\n                \"type\": \"SystemAssigned\"\n            },\n            \"properties\": {\n                \"disableLocalAuth\": false,\n                \"sku\": {\n                    \"name\": \"Basic\"\n                },\n                \"encryption\": {\n                    \"keySource\": \"Microsoft.Automation\",\n                    \"identity\": {}\n                }\n            }\n        },\n        {\n            \"comments\": \"Enable monitoring of Automation Account operations.\",\n            \"type\": \"Microsoft.Insights/diagnosticSettings\",\n            \"name\": \"[concat(parameters('automationAccountName'), '/Microsoft.Insights/service')]\",\n            \"apiVersion\": \"2021-05-01-preview\",\n            \"dependsOn\": [\n                \"[concat('Microsoft.Automation/automationAccounts/', parameters('automationAccountName'))]\"\n            ],\n            \"properties\": {\n                \"workspaceId\": \"[parameters('workspaceId')]\",\n                \"logs\": [\n                    {\n                        \"category\": \"AuditEvent\",\n                        \"enabled\": true,\n                        \"retentionPolicy\": {\n                            \"days\": 0,\n                            \"enabled\": false\n                        }\n                    }\n                ]\n            }\n        }\n    ]\n}\n</code></pre>","tags":["Azure.Automation.AuditLogs","AZR-000088"]},{"location":"en/rules/Azure.Automation.AuditLogs/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Automation accounts that pass this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource (extension resource).</li> <li>Enable <code>AuditEvent</code> category or <code>audit</code> category group or <code>allLogs</code> category group.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>param automationAccountName string = 'automation-account1'\nparam location string\nparam workspaceId string\n\nresource automationAccountResource 'Microsoft.Automation/automationAccounts@2021-06-22' = {\n  name: automationAccountName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    disableLocalAuth: false\n    sku: {\n      name: 'Basic'\n    }\n    encryption: {\n      keySource: 'Microsoft.Automation'\n      identity: {}\n    }\n  }\n}\n\nresource automationAccountName_Microsoft_Insights_service 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  name: 'diagnosticSettings'\n  properties: {\n    workspaceId: workspaceId\n    logs: [\n      {\n        category: 'AuditEvent'\n        enabled: true\n        retentionPolicy: {\n          days: 0\n          enabled: false\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    automationAccountResource\n  ]\n}\n</code></pre>","tags":["Azure.Automation.AuditLogs","AZR-000088"]},{"location":"en/rules/Azure.Automation.AuditLogs/#links","title":"Links","text":"<ul> <li>Security audits</li> <li>Template Reference</li> </ul>","tags":["Azure.Automation.AuditLogs","AZR-000088"]},{"location":"en/rules/Azure.Automation.EncryptVariables/","title":"Encrypt automation variables","text":"Azure.Automation.EncryptVariablesAZR-000086Error <p> Security  \u00b7  Automation Account  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Azure Automation variables should be encrypted.</p>","tags":["Azure.Automation.EncryptVariables","AZR-000086"]},{"location":"en/rules/Azure.Automation.EncryptVariables/#description","title":"Description","text":"<p>Azure Automation allows configuration properties to be saved as variables. Variables are a key/ value pairs, which may contain sensitive information.</p> <p>When variables are encrypted they can only be access from within the runbook context. Variables not encrypted are visible to anyone with read permissions.</p>","tags":["Azure.Automation.EncryptVariables","AZR-000086"]},{"location":"en/rules/Azure.Automation.EncryptVariables/#recommendation","title":"Recommendation","text":"<p>Consider encrypting all automation account variables.</p> <p>Additionally consider, using Key Vault to store secrets. Key Vault improves security by tightly controlling access to secrets and improving management controls.</p>","tags":["Azure.Automation.EncryptVariables","AZR-000086"]},{"location":"en/rules/Azure.Automation.EncryptVariables/#links","title":"Links","text":"<ul> <li>Variable assets in Azure Automation</li> </ul>","tags":["Azure.Automation.EncryptVariables","AZR-000086"]},{"location":"en/rules/Azure.Automation.ManagedIdentity/","title":"Use managed identity for authentication","text":"Azure.Automation.ManagedIdentityAZR-000090Error <p> Security  \u00b7  Automation Account  \u00b7  Rule  \u00b7  2021_12  \u00b7  Important</p> <p>Ensure Managed Identity is used for authentication.</p>","tags":["Azure.Automation.ManagedIdentity","AZR-000090"]},{"location":"en/rules/Azure.Automation.ManagedIdentity/#description","title":"Description","text":"<p>Azure automation can use Managed Identities to authenticate to Azure resources without storing credentials.</p> <p>Using managed identities have the following benefits:</p> <ul> <li>Using a managed identity instead of the Automation Run As account simplifies management.   You don't have to renew the certificate used by a Run As account.</li> <li>Managed Identities can be used without any additional cost.</li> <li>You don't have to specify the Run As connection object in your runbook code.   You can access resources using your Automation Account's Managed Identity from a runbook.</li> </ul>","tags":["Azure.Automation.ManagedIdentity","AZR-000090"]},{"location":"en/rules/Azure.Automation.ManagedIdentity/#recommendation","title":"Recommendation","text":"<p>Consider configure a managed identity for each Automation Account.</p>","tags":["Azure.Automation.ManagedIdentity","AZR-000090"]},{"location":"en/rules/Azure.Automation.ManagedIdentity/#examples","title":"Examples","text":"","tags":["Azure.Automation.ManagedIdentity","AZR-000090"]},{"location":"en/rules/Azure.Automation.ManagedIdentity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Automation Accounts that pass this rule:</p> <ul> <li>Set <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Automation/automationAccounts\",\n    \"apiVersion\": \"2021-06-22\",\n    \"name\": \"[parameters('automation_account_name')]\",\n    \"location\": \"australiaeast\",\n    \"identity\": {\n        \"type\": \"SystemAssigned\"\n    },\n    \"properties\": {\n        \"disableLocalAuth\": false,\n        \"sku\": {\n            \"name\": \"Basic\"\n        },\n        \"encryption\": {\n            \"keySource\": \"Microsoft.Automation\",\n            \"identity\": {}\n        }\n    }\n}\n</code></pre>","tags":["Azure.Automation.ManagedIdentity","AZR-000090"]},{"location":"en/rules/Azure.Automation.ManagedIdentity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Automation Accounts that pass this rule:</p> <ul> <li>Set <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource automation_account_name_resource 'Microsoft.Automation/automationAccounts@2021-06-22' = {\n  name: automation_account_name\n  location: 'australiaeast'\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    disableLocalAuth: false\n    sku: {\n      name: 'Basic'\n    }\n    encryption: {\n      keySource: 'Microsoft.Automation'\n      identity: {}\n    }\n  }\n}\n</code></pre>","tags":["Azure.Automation.ManagedIdentity","AZR-000090"]},{"location":"en/rules/Azure.Automation.ManagedIdentity/#links","title":"Links","text":"<ul> <li>Use identity-based authentication</li> <li>Managed identities</li> <li>Using a system-assigned managed identity for an Azure Automation account</li> <li>Using a user-assigned managed identity for an Azure Automation account</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Automation.ManagedIdentity","AZR-000090"]},{"location":"en/rules/Azure.Automation.PlatformLogs/","title":"Automation accounts should collect platform diagnostic logs","text":"Azure.Automation.PlatformLogsAZR-000089Error <p> Operational Excellence  \u00b7  Automation Account  \u00b7  Rule  \u00b7  2021_12  \u00b7  Important</p> <p>Ensure automation account platform diagnostic logs are enabled.</p>","tags":["Azure.Automation.PlatformLogs","AZR-000089"]},{"location":"en/rules/Azure.Automation.PlatformLogs/#description","title":"Description","text":"<p>To capture platform logs from Automation Accounts, the following diagnostic log categories should be enabled:</p> <ul> <li>JobLogs</li> <li>JobStreams</li> <li>DSCNodeStatus</li> </ul> <p>We can also enable all the above with the <code>allLogs</code> category group.</p> <p>To capture metric log categories, th following must be enabled as well:</p> <ul> <li>AllMetrics - Total Jobs, Total Update Deployment Machine Runs, Total Update Deployment Runs</li> </ul>","tags":["Azure.Automation.PlatformLogs","AZR-000089"]},{"location":"en/rules/Azure.Automation.PlatformLogs/#recommendation","title":"Recommendation","text":"<p>Consider configuring diagnostic settings to capture platform logs from Automation accounts.</p>","tags":["Azure.Automation.PlatformLogs","AZR-000089"]},{"location":"en/rules/Azure.Automation.PlatformLogs/#notes","title":"Notes","text":"<p>Configure <code>AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST</code> to enable selective log categories. By default all log categories are selected, as shown below.</p> <pre><code># YAML: The default AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option\nconfiguration:\n  AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST: ['JobLogs', 'JobStreams', 'DscNodeStatus', 'AllMetrics']\n</code></pre>","tags":["Azure.Automation.PlatformLogs","AZR-000089"]},{"location":"en/rules/Azure.Automation.PlatformLogs/#examples","title":"Examples","text":"","tags":["Azure.Automation.PlatformLogs","AZR-000089"]},{"location":"en/rules/Azure.Automation.PlatformLogs/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Automation accounts that pass this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource.</li> <li>Enable logging for the <code>JobLogs</code>, <code>JobStreams</code>, <code>DSCNodeStatus</code> and <code>AllMetrics</code> categories.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"parameters\": {\n        \"automationAccountName\": {\n            \"defaultValue\": \"automation-account1\",\n            \"type\": \"String\"\n        },\n        \"location\": {\n          \"type\": \"String\"\n        },\n        \"workspaceId\": {\n          \"type\": \"String\"\n        }\n    },\n    \"variables\": {},\n    \"resources\": [\n        {\n            \"type\": \"Microsoft.Automation/automationAccounts\",\n            \"apiVersion\": \"2021-06-22\",\n            \"name\": \"[parameters('automationAccountName')]\",\n            \"location\": \"[parameters('location')]\",\n            \"identity\": {\n                \"type\": \"SystemAssigned\"\n            },\n            \"properties\": {\n                \"disableLocalAuth\": false,\n                \"sku\": {\n                    \"name\": \"Basic\"\n                },\n                \"encryption\": {\n                    \"keySource\": \"Microsoft.Automation\",\n                    \"identity\": {}\n                }\n            }\n        },\n        {\n            \"comments\": \"Enable monitoring of Automation Account operations.\",\n            \"type\": \"Microsoft.Insights/diagnosticSettings\",\n            \"name\": \"[concat(parameters('automationAccountName'), '/Microsoft.Insights/service')]\",\n            \"apiVersion\": \"2021-05-01-preview\",\n            \"dependsOn\": [\n                \"[concat('Microsoft.Automation/automationAccounts/', parameters('automationAccountName'))]\"\n            ],\n            \"properties\": {\n                \"workspaceId\": \"[parameters('workspaceId')]\",\n                \"logs\": [\n                    {\n                        \"category\": \"JobLogs\",\n                        \"enabled\": true,\n                        \"retentionPolicy\": {\n                            \"days\": 0,\n                            \"enabled\": false\n                        }\n                    },\n                    {\n                        \"category\": \"JobStreams\",\n                        \"enabled\": true,\n                        \"retentionPolicy\": {\n                            \"days\": 0,\n                            \"enabled\": false\n                        }\n                    },\n                    {\n                        \"category\": \"DSCNodeStatus\",\n                        \"enabled\": true,\n                        \"retentionPolicy\": {\n                            \"days\": 0,\n                            \"enabled\": false\n                        }\n                    }\n                ],\n                \"metrics\": [\n                  {\n                        \"category\": \"AllMetrics\",\n                        \"enabled\": true,\n                        \"retentionPolicy\": {\n                            \"days\": 0,\n                            \"enabled\": false\n                        }\n                    }\n                ]\n            }\n        }\n    ]\n}\n</code></pre>","tags":["Azure.Automation.PlatformLogs","AZR-000089"]},{"location":"en/rules/Azure.Automation.PlatformLogs/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Automation accounts that pass this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource.</li> <li>Enable logging for the <code>JobLogs</code>, <code>JobStreams</code>, <code>DSCNodeStatus</code> and <code>AllMetrics</code> categories.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>param automationAccountName string = 'automation-account1'\nparam location string\nparam workspaceId string\n\nresource automationAccountResource 'Microsoft.Automation/automationAccounts@2021-06-22' = {\n  name: automationAccountName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    disableLocalAuth: false\n    sku: {\n      name: 'Basic'\n    }\n    encryption: {\n      keySource: 'Microsoft.Automation'\n      identity: {}\n    }\n  }\n}\n\nresource automationAccountName_Microsoft_Insights_service 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  name: 'diagnosticSettings'\n  properties: {\n    workspaceId: workspaceId\n    logs: [\n      {\n        category: 'JobLogs'\n        enabled: true\n        retentionPolicy: {\n          days: 0\n          enabled: false\n        }\n      },\n      {\n        category: 'JobStreams'\n        enabled: true\n        retentionPolicy: {\n          days: 0\n          enabled: false\n        }\n      },\n      {\n        category: 'DSCNodeStatus'\n        enabled: true\n        retentionPolicy: {\n          days: 0\n          enabled: false\n        }\n      }\n    ]\n    metrics: [\n      {\n        category: 'AllMetrics'\n        enabled: true\n        retentionPolicy: {\n          days: 0\n          enabled: false\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    automationAccountResource\n  ]\n}\n</code></pre>","tags":["Azure.Automation.PlatformLogs","AZR-000089"]},{"location":"en/rules/Azure.Automation.PlatformLogs/#links","title":"Links","text":"<ul> <li>Platform Monitoring</li> <li>Forward Azure Automation job data to Azure Monitor logs</li> <li>Template Reference</li> </ul>","tags":["Azure.Automation.PlatformLogs","AZR-000089"]},{"location":"en/rules/Azure.Automation.WebHookExpiry/","title":"Use short lived web hooks","text":"Azure.Automation.WebHookExpiryAZR-000087Error <p> Security  \u00b7  Automation Account  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Do not create webhooks with an expiry time greater than 1 year (default).</p>","tags":["Azure.Automation.WebHookExpiry","AZR-000087"]},{"location":"en/rules/Azure.Automation.WebHookExpiry/#description","title":"Description","text":"<p>Do not create webhooks with an expiry time greater than 1 year (default).</p>","tags":["Azure.Automation.WebHookExpiry","AZR-000087"]},{"location":"en/rules/Azure.Automation.WebHookExpiry/#recommendation","title":"Recommendation","text":"<p>An expiry time of 1 year is the default for webhook creation. Webhooks should be programmatically rotated at regular intervals - Microsoft recommends setting a shorter time than the default of 1 year. If authentication is required for a webhook consider implementing a pre-shared key in the header - or using an Azure Function.</p>","tags":["Azure.Automation.WebHookExpiry","AZR-000087"]},{"location":"en/rules/Azure.BV.Immutable/","title":"Immutability","text":"Azure.BV.ImmutableAZR-000398Error <p> Security  \u00b7  Backup Vault  \u00b7  Rule  \u00b7  2023_09  \u00b7  Important</p> <p>Ensure immutability is configured to protect backup data.</p>","tags":["Azure.BV.Immutable","AZR-000398"]},{"location":"en/rules/Azure.BV.Immutable/#description","title":"Description","text":"<p>Immutability is supported for Backup vaults by configuring the Immutable vault setting.</p> <p>Immutable vault helps protecting backup data by blocking any operations that could lead to loss of recovery points. Additionally, locking the Immutable vault setting makes it irreversible to prevent any malicious actors from disabling immutability and deleting backups.</p> <p>For example, an malicious attack may attempt to remove data or delete vaults to prevent recovery to a known good state.</p> <p>The Immutable vault setting is not enabled per default.</p>","tags":["Azure.BV.Immutable","AZR-000398"]},{"location":"en/rules/Azure.BV.Immutable/#recommendation","title":"Recommendation","text":"<p>Consider configuring immutability to protect backup data from accidental or malicious deletion.</p>","tags":["Azure.BV.Immutable","AZR-000398"]},{"location":"en/rules/Azure.BV.Immutable/#examples","title":"Examples","text":"","tags":["Azure.BV.Immutable","AZR-000398"]},{"location":"en/rules/Azure.BV.Immutable/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Backup vaults that pass this rule:</p> <ul> <li>Set <code>properties.securitySettings.immutabilitySettings.state</code> to <code>Unlocked</code> or <code>Locked</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DataProtection/backupVaults\",\n  \"apiVersion\": \"2022-11-01-preview\",\n  \"name\": \"[parameters('vaultName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"securitySettings\": {\n      \"immutabilitySettings\": {\n        \"state\": \"Locked\"\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.BV.Immutable","AZR-000398"]},{"location":"en/rules/Azure.BV.Immutable/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Backup vaults that pass this rule:</p> <ul> <li>Set <code>properties.securitySettings.immutabilitySettings.state</code> to <code>Unlocked</code> or <code>Locked</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource backupVault 'Microsoft.DataProtection/backupVaults@2022-11-01-preview' = {\n  name: vaultName\n  location: location\n  properties: {\n    securitySettings: {\n      immutabilitySettings: {\n        state: 'Locked'\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.BV.Immutable","AZR-000398"]},{"location":"en/rules/Azure.BV.Immutable/#notes","title":"Notes","text":"<p>Note that immutability locking <code>Locked</code> is irreversible, so ensure to take a well-informed decision when opting to lock. For example, for vaults containing production workloads consider using <code>Locked</code>. For cases where you are creating and destroying backups and vaults on a regulary basis such as temporary environments consider <code>Unlocked</code>.</p>","tags":["Azure.BV.Immutable","AZR-000398"]},{"location":"en/rules/Azure.BV.Immutable/#links","title":"Links","text":"<ul> <li>Security design principles</li> <li>Immutable vault for Azure Backup</li> <li>Restricted operations</li> <li>Manage Azure Backup Immutable vault operations</li> <li>Azure security baseline for Azure Backup</li> <li>Backup and restore plan to protect against ransomware</li> <li>BR-2: Protect backup and recovery data</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.BV.Immutable","AZR-000398"]},{"location":"en/rules/Azure.Bastion.Name/","title":"Use valid names","text":"Azure.Bastion.NameAZR-000349Error <p> Operational Excellence  \u00b7  Bastion  \u00b7  Rule  \u00b7  2022_12  \u00b7  Awareness</p> <p>Bastion hosts should meet naming requirements.</p>","tags":["Azure.Bastion.Name","AZR-000349"]},{"location":"en/rules/Azure.Bastion.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Bastion host names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods and hyphens.</li> <li>Start with alphanumeric.</li> <li>End with alphanumeric or underscore.</li> </ul>","tags":["Azure.Bastion.Name","AZR-000349"]},{"location":"en/rules/Azure.Bastion.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Bastion host naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.Bastion.Name","AZR-000349"]},{"location":"en/rules/Azure.Bastion.Name/#notes","title":"Notes","text":"<p>This rule does not check if Bastion host names are unique.</p>","tags":["Azure.Bastion.Name","AZR-000349"]},{"location":"en/rules/Azure.Bastion.Name/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Bastion host</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Bastion.Name","AZR-000349"]},{"location":"en/rules/Azure.CDN.EndpointName/","title":"Use valid CDN endpoint names","text":"Azure.CDN.EndpointNameAZR-000091Error <p> Operational Excellence  \u00b7  Content Delivery Network  \u00b7  Rule  \u00b7  2020_09  \u00b7  Awareness</p> <p>Azure CDN Endpoint names should meet naming requirements.</p>","tags":["Azure.CDN.EndpointName","AZR-000091"]},{"location":"en/rules/Azure.CDN.EndpointName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for CDN endpoint names are:</p> <ul> <li>Between 1 and 50 characters long.</li> <li>Alphanumerics and hyphens.</li> <li>Start and end with a letter or number.</li> <li>CDN endpoint names must be globally unique.</li> </ul>","tags":["Azure.CDN.EndpointName","AZR-000091"]},{"location":"en/rules/Azure.CDN.EndpointName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet CDN endpoint naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.CDN.EndpointName","AZR-000091"]},{"location":"en/rules/Azure.CDN.EndpointName/#notes","title":"Notes","text":"<p>This rule does not check if CDN endpoint names are unique.</p>","tags":["Azure.CDN.EndpointName","AZR-000091"]},{"location":"en/rules/Azure.CDN.EndpointName/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.CDN.EndpointName","AZR-000091"]},{"location":"en/rules/Azure.CDN.HTTP/","title":"CDN endpoint allows unencrypted traffic","text":"Azure.CDN.HTTPAZR-000093Error <p> Security  \u00b7  Content Delivery Network  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Unencrypted communication could allow disclosure of information to an untrusted party.</p>","tags":["Azure.CDN.HTTP","AZR-000093"]},{"location":"en/rules/Azure.CDN.HTTP/#description","title":"Description","text":"<p>When a client connect to CDN content it can use HTTP or HTTPS. Support for both HTTP and HTTPS is enabled by default. When using HTTP, sensitive information may be exposed to an untrusted party.</p>","tags":["Azure.CDN.HTTP","AZR-000093"]},{"location":"en/rules/Azure.CDN.HTTP/#recommendation","title":"Recommendation","text":"<p>Consider disabling HTTP support on the CDN endpoint origin.</p>","tags":["Azure.CDN.HTTP","AZR-000093"]},{"location":"en/rules/Azure.CDN.HTTP/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Configure HTTPS on an Azure CDN custom domain</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.CDN.HTTP","AZR-000093"]},{"location":"en/rules/Azure.CDN.MinTLS/","title":"Azure CDN endpoint minimum TLS version","text":"Azure.CDN.MinTLSAZR-000092Error <p> Security  \u00b7  Content Delivery Network  \u00b7  Rule  \u00b7  2020_09  \u00b7  Important</p> <p>Azure CDN endpoints should reject TLS versions older than 1.2.</p>","tags":["Azure.CDN.MinTLS","AZR-000092"]},{"location":"en/rules/Azure.CDN.MinTLS/#description","title":"Description","text":"<p>The minimum version of TLS that Azure CDN endpoints accept is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS.</p> <p>Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted.</p> <p>To configure the minimum TLS version, a custom domain must be configured.</p>","tags":["Azure.CDN.MinTLS","AZR-000092"]},{"location":"en/rules/Azure.CDN.MinTLS/#recommendation","title":"Recommendation","text":"<p>Consider configuring a custom domain and setting the minimum supported TLS version to be 1.2.</p>","tags":["Azure.CDN.MinTLS","AZR-000092"]},{"location":"en/rules/Azure.CDN.MinTLS/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Preparing for TLS 1.2 in Microsoft Azure</li> <li>REST API Custom Domains - Enable Custom Https</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.CDN.MinTLS","AZR-000092"]},{"location":"en/rules/Azure.CDN.UseFrontDoor/","title":"Use Front Door Standard Or Premium SKU","text":"Azure.CDN.UseFrontDoorAZR-000286Error <p> Performance Efficiency  \u00b7  Front Door  \u00b7  Rule  \u00b7  2022_09  \u00b7  Important</p> <p>Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities.</p>","tags":["Azure.CDN.UseFrontDoor","AZR-000286"]},{"location":"en/rules/Azure.CDN.UseFrontDoor/#description","title":"Description","text":"<p>Using a CDN is a good way to minimize the load on your application, and maximize availability and performance.</p> <p>Standard content delivery network (CDN) capability includes the ability to cache files closer to end users to speed up delivery of static files. However, with dynamic web applications, caching that content in edge locations isn't possible because the server generates the content in response to user behavior. Speeding up the delivery of such content is more complex than traditional edge caching and requires an end-to-end solution that finely tunes each element along the entire data path from inception to delivery. With Azure CDN dynamic site acceleration (DSA) optimization, the performance of web pages with dynamic content is measurably improved.</p> <p>Azure Front Door Standard or Premium SKU offers modern cloud Content Delivery Network (CDN). These SKUs in particular provides fast, reliable, and secure access between users and dynamic web content across the globe.</p> <p>Azure CDN Standard from Microsoft (classic) will be retired on September 30, 2027.</p>","tags":["Azure.CDN.UseFrontDoor","AZR-000286"]},{"location":"en/rules/Azure.CDN.UseFrontDoor/#recommendation","title":"Recommendation","text":"<p>Consider using Front Door Standard or Premium SKU to improve performance.</p>","tags":["Azure.CDN.UseFrontDoor","AZR-000286"]},{"location":"en/rules/Azure.CDN.UseFrontDoor/#examples","title":"Examples","text":"","tags":["Azure.CDN.UseFrontDoor","AZR-000286"]},{"location":"en/rules/Azure.CDN.UseFrontDoor/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy an front door profile that pass this rule:</p> <ul> <li>Set <code>sku.name</code> to <code>Standard_AzureFrontDoor</code> or <code>Premium_AzureFrontDoor</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Cdn/profiles\",\n  \"apiVersion\": \"2022-05-01-preview\",\n  \"name\": \"myFrontDoor\",\n  \"location\": \"global\",\n  \"sku\": {\n    \"name\": \"Standard_AzureFrontDoor\"\n  }\n}\n</code></pre>","tags":["Azure.CDN.UseFrontDoor","AZR-000286"]},{"location":"en/rules/Azure.CDN.UseFrontDoor/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy an front door profile that pass this rule:</p> <ul> <li>Set <code>sku.name</code> to <code>Standard_AzureFrontDoor</code> or <code>Premium_AzureFrontDoor</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource frontDoorProfile 'Microsoft.Cdn/profiles@2021-06-01' = {\n  name: 'myFrontDoor'\n  location: 'global'\n  sku: {\n    name: 'Standard_AzureFrontDoor'\n  }\n}\n</code></pre>","tags":["Azure.CDN.UseFrontDoor","AZR-000286"]},{"location":"en/rules/Azure.CDN.UseFrontDoor/#links","title":"Links","text":"<ul> <li>Performance efficiency checklist</li> <li>Azure Front Door tiers</li> <li>What are the comparisons between Azure CDN product features?</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.CDN.UseFrontDoor","AZR-000286"]},{"location":"en/rules/Azure.ContainerApp.APIVersion/","title":"Retired API version","text":"Azure.ContainerApp.APIVersionAZR-000400Error <p> Operational Excellence  \u00b7  Container App  \u00b7  Rule  \u00b7  2023_09  \u00b7  Important</p> <p>Migrate from retired API version to a supported version.</p>","tags":["Azure.ContainerApp.APIVersion","AZR-000400"]},{"location":"en/rules/Azure.ContainerApp.APIVersion/#description","title":"Description","text":"<p>The API Azure Container Apps control plane API versions <code>2022-06-01-preview</code> and <code>2022-11-01-preview</code> are deprecated. These API versions will be retired on the November 16, 2023.</p> <p>This means you'll no longer be able to create or update your Azure Container Apps using your existing templates, tools, scripts and programs until they've been updated to a supported API version.</p>","tags":["Azure.ContainerApp.APIVersion","AZR-000400"]},{"location":"en/rules/Azure.ContainerApp.APIVersion/#recommendation","title":"Recommendation","text":"<p>Consider migrating from a retired API version to a newer supported version by updating your Infrastructure as Code.</p>","tags":["Azure.ContainerApp.APIVersion","AZR-000400"]},{"location":"en/rules/Azure.ContainerApp.APIVersion/#examples","title":"Examples","text":"","tags":["Azure.ContainerApp.APIVersion","AZR-000400"]},{"location":"en/rules/Azure.ContainerApp.APIVersion/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Container Apps that pass this rule:</p> <ul> <li>Set <code>apiVersion</code> to a newer supported version such as <code>2024-03-01</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.App/containerApps\",\n  \"apiVersion\": \"2024-03-01\",\n  \"name\": \"[parameters('appName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"environmentId\": \"[resourceId('Microsoft.App/managedEnvironments', parameters('envName'))]\",\n    \"template\": {\n      \"revisionSuffix\": \"[parameters('revision')]\",\n      \"containers\": \"[variables('containers')]\",\n      \"scale\": {\n        \"minReplicas\": 2\n      }\n    },\n    \"configuration\": {\n      \"ingress\": {\n        \"allowInsecure\": false,\n        \"external\": false,\n        \"ipSecurityRestrictions\": \"[variables('ipSecurityRestrictions')]\",\n        \"stickySessions\": {\n          \"affinity\": \"none\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.App/managedEnvironments', parameters('envName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.ContainerApp.APIVersion","AZR-000400"]},{"location":"en/rules/Azure.ContainerApp.APIVersion/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Container Apps that pass this rule:</p> <ul> <li>Set <code>apiVersion</code> to a newer supported version such as <code>2024-03-01</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource containerApp 'Microsoft.App/containerApps@2024-03-01' = {\n  name: appName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    environmentId: containerEnv.id\n    template: {\n      revisionSuffix: revision\n      containers: containers\n      scale: {\n        minReplicas: 2\n      }\n    }\n    configuration: {\n      ingress: {\n        allowInsecure: false\n        external: false\n        ipSecurityRestrictions: ipSecurityRestrictions\n        stickySessions: {\n          affinity: 'none'\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/app/container-app:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/app/container-app:0.11.0\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/app/container-app:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ContainerApp.APIVersion","AZR-000400"]},{"location":"en/rules/Azure.ContainerApp.APIVersion/#links","title":"Links","text":"<ul> <li>OE:04 Tools and processes</li> <li>Azure Container Apps API versions retirements</li> <li>Azure Container Apps latest API versions</li> <li>Azure Container Apps API change log</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ContainerApp.APIVersion","AZR-000400"]},{"location":"en/rules/Azure.ContainerApp.AvailabilityZone/","title":"Use zone redundant Container App environments","text":"Azure.ContainerApp.AvailabilityZoneAZR-000414Error <p> Reliability  \u00b7  Container App  \u00b7  Rule  \u00b7  2024_06  \u00b7  Important</p> <p>Use Container Apps environments that are zone redundant to improve reliability.</p>","tags":["Azure.ContainerApp.AvailabilityZone","AZR-000414"]},{"location":"en/rules/Azure.ContainerApp.AvailabilityZone/#description","title":"Description","text":"<p>Container App environments can be configured to be zone redundant in regions that support availability zones. Zone redundancy is supported in both the workload profiles and consumption only environments. When configured, replicas of each Container App are spread across availability zones automatically. A Container App must have multiple replicas to be zone redundant.</p> <p>For example:</p> <ul> <li>If a Container App has three replicas, each replica is placed in a different availability zone.</li> <li>If a Container App has one replica, it is only available in a single zone.</li> </ul> <p>Zone redundancy can only be enabled at initial environment creation. Additionally, the Container App environment must be deployed with an infrastructure subnet configured.</p>","tags":["Azure.ContainerApp.AvailabilityZone","AZR-000414"]},{"location":"en/rules/Azure.ContainerApp.AvailabilityZone/#recommendation","title":"Recommendation","text":"<p>Consider configuring Container App environments to be zone redundant to improve workload resiliency.</p>","tags":["Azure.ContainerApp.AvailabilityZone","AZR-000414"]},{"location":"en/rules/Azure.ContainerApp.AvailabilityZone/#examples","title":"Examples","text":"","tags":["Azure.ContainerApp.AvailabilityZone","AZR-000414"]},{"location":"en/rules/Azure.ContainerApp.AvailabilityZone/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Container App environments that pass this rule:</p> <ul> <li>Set the <code>properties.zoneRedundant</code> property to <code>true</code>.</li> <li>Set the <code>properties.vnetConfiguration.infrastructureSubnetId</code> property to reference a valid subnet.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.App/managedEnvironments\",\n  \"apiVersion\": \"2023-05-01\",\n  \"name\": \"[parameters('envName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"appLogsConfiguration\": {\n      \"destination\": \"log-analytics\",\n      \"logAnalyticsConfiguration\": {\n        \"customerId\": \"[reference(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspaceId')), '2022-10-01').customerId]\",\n        \"sharedKey\": \"[listKeys(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspaceId')), '2022-10-01').primarySharedKey]\"\n      }\n    },\n    \"zoneRedundant\": true,\n    \"workloadProfiles\": [\n      {\n        \"name\": \"Consumption\",\n        \"workloadProfileType\": \"Consumption\"\n      }\n    ],\n    \"vnetConfiguration\": {\n      \"infrastructureSubnetId\": \"[parameters('subnetId')]\",\n      \"internal\": true\n    }\n  }\n}\n</code></pre>","tags":["Azure.ContainerApp.AvailabilityZone","AZR-000414"]},{"location":"en/rules/Azure.ContainerApp.AvailabilityZone/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Container App environments that pass this rule:</p> <ul> <li>Set the <code>properties.zoneRedundant</code> property to <code>true</code>.</li> <li>Set the <code>properties.vnetConfiguration.infrastructureSubnetId</code> property to reference a valid subnet.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource containerEnv 'Microsoft.App/managedEnvironments@2023-05-01' = {\n  name: envName\n  location: location\n  properties: {\n    appLogsConfiguration: {\n      destination: 'log-analytics'\n      logAnalyticsConfiguration: {\n        customerId: workspace.properties.customerId\n        sharedKey: workspace.listKeys().primarySharedKey\n      }\n    }\n    zoneRedundant: true\n    workloadProfiles: [\n      {\n        name: 'Consumption'\n        workloadProfileType: 'Consumption'\n      }\n    ]\n    vnetConfiguration: {\n      infrastructureSubnetId: subnetId\n      internal: true\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/app/managed-environment:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/app/managed-environment:0.8.0\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/app/managed-environment:0.8.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ContainerApp.AvailabilityZone","AZR-000414"]},{"location":"en/rules/Azure.ContainerApp.AvailabilityZone/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>Reliability in Azure Container Apps</li> <li>What are availability zones?</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ContainerApp.AvailabilityZone","AZR-000414"]},{"location":"en/rules/Azure.ContainerApp.DisableAffinity/","title":"Disable session affinity","text":"Azure.ContainerApp.DisableAffinityAZR-000378Error <p> Performance Efficiency  \u00b7  Container App  \u00b7  Rule  \u00b7  2023_09  \u00b7  Awareness</p> <p>Disable session affinity to prevent unbalanced distribution.</p>","tags":["Azure.ContainerApp.DisableAffinity","AZR-000378"]},{"location":"en/rules/Azure.ContainerApp.DisableAffinity/#description","title":"Description","text":"<p>Container apps allows you to configure session affinity (sticky sessions). When enabled, this feature route requests from the same client to the same replica. This feature might be useful for stateful applications that require a consistent connection to the same replica.</p> <p>However, for stateless applications there is drawbacks to using session affinity. As connections are opened and closed, a subset of replicas might become overloaded with requests, while others are dormant. This can lead to: poor performance and resource utilization; less predictable scaling.</p>","tags":["Azure.ContainerApp.DisableAffinity","AZR-000378"]},{"location":"en/rules/Azure.ContainerApp.DisableAffinity/#recommendation","title":"Recommendation","text":"<p>Consider using stateless application design and disabling session affinity to evenly distribute requests across each replica.</p>","tags":["Azure.ContainerApp.DisableAffinity","AZR-000378"]},{"location":"en/rules/Azure.ContainerApp.DisableAffinity/#examples","title":"Examples","text":"","tags":["Azure.ContainerApp.DisableAffinity","AZR-000378"]},{"location":"en/rules/Azure.ContainerApp.DisableAffinity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Container Apps that pass this rule:</p> <ul> <li>Set <code>properties.configuration.ingress.stickySessions.affinity</code> to <code>none</code> or don't specify the property at all.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.App/containerApps\",\n  \"apiVersion\": \"2024-03-01\",\n  \"name\": \"[parameters('appName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"environmentId\": \"[resourceId('Microsoft.App/managedEnvironments', parameters('envName'))]\",\n    \"template\": {\n      \"revisionSuffix\": \"[parameters('revision')]\",\n      \"containers\": \"[variables('containers')]\",\n      \"scale\": {\n        \"minReplicas\": 2\n      }\n    },\n    \"configuration\": {\n      \"ingress\": {\n        \"allowInsecure\": false,\n        \"external\": false,\n        \"ipSecurityRestrictions\": \"[variables('ipSecurityRestrictions')]\",\n        \"stickySessions\": {\n          \"affinity\": \"none\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.App/managedEnvironments', parameters('envName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.ContainerApp.DisableAffinity","AZR-000378"]},{"location":"en/rules/Azure.ContainerApp.DisableAffinity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Container Apps that pass this rule:</p> <ul> <li>Set <code>properties.configuration.ingress.stickySessions.affinity</code> to <code>none</code> or don't specify the property at all.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource containerApp 'Microsoft.App/containerApps@2024-03-01' = {\n  name: appName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    environmentId: containerEnv.id\n    template: {\n      revisionSuffix: revision\n      containers: containers\n      scale: {\n        minReplicas: 2\n      }\n    }\n    configuration: {\n      ingress: {\n        allowInsecure: false\n        external: false\n        ipSecurityRestrictions: ipSecurityRestrictions\n        stickySessions: {\n          affinity: 'none'\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/app/container-app:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/app/container-app:0.11.0\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/app/container-app:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ContainerApp.DisableAffinity","AZR-000378"]},{"location":"en/rules/Azure.ContainerApp.DisableAffinity/#notes","title":"Notes","text":"<p>This rule may generate false positive results for stateful applications.</p>","tags":["Azure.ContainerApp.DisableAffinity","AZR-000378"]},{"location":"en/rules/Azure.ContainerApp.DisableAffinity/#links","title":"Links","text":"<ul> <li>PE:05 Scaling and partitioning</li> <li>Session Affinity in Azure Container Apps</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ContainerApp.DisableAffinity","AZR-000378"]},{"location":"en/rules/Azure.ContainerApp.ExternalIngress/","title":"Disable external ingress","text":"Azure.ContainerApp.ExternalIngressAZR-000362Error <p> Security  \u00b7  Container App  \u00b7  Rule  \u00b7  2023_03  \u00b7  Important</p> <p>Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment.</p>","tags":["Azure.ContainerApp.ExternalIngress","AZR-000362"]},{"location":"en/rules/Azure.ContainerApp.ExternalIngress/#description","title":"Description","text":"<p>Inbound access to a Container App is configured by enabling ingress. Container Apps can be configured to allow external ingress or not. External ingress permits communication outside the Container App environment from a private VNET or the Internet. To restrict communication to a private VNET your Container App Environment must be:</p> <ul> <li>Configured with a custom VNET.</li> <li>Configured with an internal load balancer.</li> </ul> <p>Applications that do batch processing or consume events may not require ingress to be enabled. If communication outside your Container Apps Environment is not required, disable external ingress.</p>","tags":["Azure.ContainerApp.ExternalIngress","AZR-000362"]},{"location":"en/rules/Azure.ContainerApp.ExternalIngress/#recommendation","title":"Recommendation","text":"<p>Consider disabling external ingress.</p>","tags":["Azure.ContainerApp.ExternalIngress","AZR-000362"]},{"location":"en/rules/Azure.ContainerApp.ExternalIngress/#examples","title":"Examples","text":"","tags":["Azure.ContainerApp.ExternalIngress","AZR-000362"]},{"location":"en/rules/Azure.ContainerApp.ExternalIngress/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Container Apps that pass this rule:</p> <ul> <li>Set <code>properties.configuration.ingress.external</code> to <code>false</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.App/containerApps\",\n  \"apiVersion\": \"2024-03-01\",\n  \"name\": \"[parameters('appName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"environmentId\": \"[resourceId('Microsoft.App/managedEnvironments', parameters('envName'))]\",\n    \"template\": {\n      \"revisionSuffix\": \"[parameters('revision')]\",\n      \"containers\": \"[variables('containers')]\",\n      \"scale\": {\n        \"minReplicas\": 2\n      }\n    },\n    \"configuration\": {\n      \"ingress\": {\n        \"allowInsecure\": false,\n        \"external\": false,\n        \"ipSecurityRestrictions\": \"[variables('ipSecurityRestrictions')]\",\n        \"stickySessions\": {\n          \"affinity\": \"none\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.App/managedEnvironments', parameters('envName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.ContainerApp.ExternalIngress","AZR-000362"]},{"location":"en/rules/Azure.ContainerApp.ExternalIngress/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Container Apps that pass this rule:</p> <ul> <li>Set <code>properties.configuration.ingress.external</code> to <code>false</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource containerApp 'Microsoft.App/containerApps@2024-03-01' = {\n  name: appName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    environmentId: containerEnv.id\n    template: {\n      revisionSuffix: revision\n      containers: containers\n      scale: {\n        minReplicas: 2\n      }\n    }\n    configuration: {\n      ingress: {\n        allowInsecure: false\n        external: false\n        ipSecurityRestrictions: ipSecurityRestrictions\n        stickySessions: {\n          affinity: 'none'\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/app/container-app:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/app/container-app:0.11.0\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/app/container-app:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ContainerApp.ExternalIngress","AZR-000362"]},{"location":"en/rules/Azure.ContainerApp.ExternalIngress/#notes","title":"Notes","text":"<p>This rule is skipped by default because there are common cases where external ingress is required. If you don't need external ingress, enable this rule by:</p> <ul> <li>Setting the <code>AZURE_CONTAINERAPPS_RESTRICT_INGRESS</code> configuration option to <code>true</code>.</li> </ul>","tags":["Azure.ContainerApp.ExternalIngress","AZR-000362"]},{"location":"en/rules/Azure.ContainerApp.ExternalIngress/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Networking in Azure Container Apps environment</li> <li>Ingress in Azure Container Apps</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ContainerApp.ExternalIngress","AZR-000362"]},{"location":"en/rules/Azure.ContainerApp.Insecure/","title":"Disable insecure container app ingress","text":"Azure.ContainerApp.InsecureAZR-000094Error <p> Security  \u00b7  Container App  \u00b7  Rule  \u00b7  2023_06  \u00b7  Important</p> <p>Ensure insecure inbound traffic is not permitted to the container app.</p>","tags":["Azure.ContainerApp.Insecure","AZR-000094"]},{"location":"en/rules/Azure.ContainerApp.Insecure/#description","title":"Description","text":"<p>Container Apps by default will automatically redirect any HTTP requests to HTTPS. In this default configuration any inbound requests will occur over a minimum of TLS 1.2. This secure by default behavior can be overridden by allowing insecure HTTP traffic.</p> <p>Unencrypted communication to Container Apps could allow disclosure of information to an untrusted party.</p>","tags":["Azure.ContainerApp.Insecure","AZR-000094"]},{"location":"en/rules/Azure.ContainerApp.Insecure/#recommendation","title":"Recommendation","text":"<p>Consider disabling insecure traffic and require all inbound traffic to be over TLS 1.2.</p>","tags":["Azure.ContainerApp.Insecure","AZR-000094"]},{"location":"en/rules/Azure.ContainerApp.Insecure/#examples","title":"Examples","text":"","tags":["Azure.ContainerApp.Insecure","AZR-000094"]},{"location":"en/rules/Azure.ContainerApp.Insecure/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy resource that pass this rule:</p> <ul> <li>Set <code>properties.configuration.ingress.allowInsecure</code> to <code>false</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.App/containerApps\",\n  \"apiVersion\": \"2024-03-01\",\n  \"name\": \"[parameters('appName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"environmentId\": \"[resourceId('Microsoft.App/managedEnvironments', parameters('envName'))]\",\n    \"template\": {\n      \"revisionSuffix\": \"[parameters('revision')]\",\n      \"containers\": \"[variables('containers')]\",\n      \"scale\": {\n        \"minReplicas\": 2\n      }\n    },\n    \"configuration\": {\n      \"ingress\": {\n        \"allowInsecure\": false,\n        \"external\": false,\n        \"ipSecurityRestrictions\": \"[variables('ipSecurityRestrictions')]\",\n        \"stickySessions\": {\n          \"affinity\": \"none\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.App/managedEnvironments', parameters('envName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.ContainerApp.Insecure","AZR-000094"]},{"location":"en/rules/Azure.ContainerApp.Insecure/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy resource that pass this rule:</p> <ul> <li>Set <code>properties.configuration.ingress.allowInsecure</code> to <code>false</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource containerApp 'Microsoft.App/containerApps@2024-03-01' = {\n  name: appName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    environmentId: containerEnv.id\n    template: {\n      revisionSuffix: revision\n      containers: containers\n      scale: {\n        minReplicas: 2\n      }\n    }\n    configuration: {\n      ingress: {\n        allowInsecure: false\n        external: false\n        ipSecurityRestrictions: ipSecurityRestrictions\n        stickySessions: {\n          affinity: 'none'\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/app/container-app:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/app/container-app:0.11.0\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/app/container-app:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ContainerApp.Insecure","AZR-000094"]},{"location":"en/rules/Azure.ContainerApp.Insecure/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Container Apps should only be accessible over HTTPS <code>/providers/Microsoft.Authorization/policyDefinitions/0e80e269-43a4-4ae9-b5bc-178126b8a5cb</code></li> </ul>","tags":["Azure.ContainerApp.Insecure","AZR-000094"]},{"location":"en/rules/Azure.ContainerApp.Insecure/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Ingress in Azure Container Apps</li> <li>Container Apps ARM template API specification</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ContainerApp.Insecure","AZR-000094"]},{"location":"en/rules/Azure.ContainerApp.ManagedIdentity/","title":"Use managed identity for authentication","text":"Azure.ContainerApp.ManagedIdentityAZR-000361Error <p> Security  \u00b7  Container App  \u00b7  Rule  \u00b7  2023_03  \u00b7  Important</p> <p>Ensure managed identity is used for authentication.</p>","tags":["Azure.ContainerApp.ManagedIdentity","AZR-000361"]},{"location":"en/rules/Azure.ContainerApp.ManagedIdentity/#description","title":"Description","text":"<p>Using managed identities have the following benefits:</p> <ul> <li>Your app connects to resources with the managed identity.   You don't need to manage credentials in your container app.</li> <li>You can use role-based access control to grant specific permissions to a managed identity.</li> <li>System-assigned identities are automatically created and managed.   They're deleted when your container app is deleted.</li> <li>You can add and delete user-assigned identities and assign them to multiple resources.   They're independent of your container app's life cycle.</li> <li>You can use managed identity to authenticate with a private Azure Container Registry without a username and password to pull containers for your Container App.</li> <li>You can use managed identity to create connections for Dapr-enabled applications via Dapr components.</li> </ul>","tags":["Azure.ContainerApp.ManagedIdentity","AZR-000361"]},{"location":"en/rules/Azure.ContainerApp.ManagedIdentity/#recommendation","title":"Recommendation","text":"<p>Consider configure a managed identity for each container app.</p>","tags":["Azure.ContainerApp.ManagedIdentity","AZR-000361"]},{"location":"en/rules/Azure.ContainerApp.ManagedIdentity/#examples","title":"Examples","text":"","tags":["Azure.ContainerApp.ManagedIdentity","AZR-000361"]},{"location":"en/rules/Azure.ContainerApp.ManagedIdentity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Container Apps that pass this rule:</p> <ul> <li>Set <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code> or <code>SystemAssigned,UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code> or <code>SystemAssigned,UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.App/containerApps\",\n  \"apiVersion\": \"2023-05-01\",\n  \"name\": \"[parameters('appName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"environmentId\": \"[resourceId('Microsoft.App/managedEnvironments', parameters('envName'))]\",\n    \"template\": {\n      \"revisionSuffix\": \"[parameters('revision')]\",\n      \"containers\": \"[variables('containers')]\",\n      \"scale\": {\n        \"minReplicas\": 2\n      }\n    },\n    \"configuration\": {\n      \"ingress\": {\n        \"allowInsecure\": false,\n        \"stickySessions\": {\n          \"affinity\": \"none\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.App/managedEnvironments', parameters('envName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.ContainerApp.ManagedIdentity","AZR-000361"]},{"location":"en/rules/Azure.ContainerApp.ManagedIdentity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Container Apps that pass this rule:</p> <ul> <li>Set <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code> or <code>SystemAssigned,UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code> or <code>SystemAssigned,UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource containerApp 'Microsoft.App/containerApps@2023-05-01' = {\n  name: appName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    environmentId: containerEnv.id\n    template: {\n      revisionSuffix: revision\n      containers: containers\n      scale: {\n        minReplicas: 2\n      }\n    }\n    configuration: {\n      ingress: {\n        allowInsecure: false\n        stickySessions: {\n          affinity: 'none'\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/app/container-app:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/app/container-app:0.11.0\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/app/container-app:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ContainerApp.ManagedIdentity","AZR-000361"]},{"location":"en/rules/Azure.ContainerApp.ManagedIdentity/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Managed Identity should be enabled for Container Apps <code>/providers/Microsoft.Authorization/policyDefinitions/b874ab2d-72dd-47f1-8cb5-4a306478a4e7</code></li> </ul>","tags":["Azure.ContainerApp.ManagedIdentity","AZR-000361"]},{"location":"en/rules/Azure.ContainerApp.ManagedIdentity/#notes","title":"Notes","text":"<p>Using managed identities in scale rules isn't supported. Init containers can't access managed identities.</p>","tags":["Azure.ContainerApp.ManagedIdentity","AZR-000361"]},{"location":"en/rules/Azure.ContainerApp.ManagedIdentity/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Managed identities in Azure Container Apps</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ContainerApp.ManagedIdentity","AZR-000361"]},{"location":"en/rules/Azure.ContainerApp.MinReplicas/","title":"Use a minimum number of replicas","text":"Azure.ContainerApp.MinReplicasAZR-000413Error <p> Reliability  \u00b7  Container App  \u00b7  Rule  \u00b7  2024_06  \u00b7  Important</p> <p>Use multiple replicas to remove a single point of failure.</p>","tags":["Azure.ContainerApp.MinReplicas","AZR-000413"]},{"location":"en/rules/Azure.ContainerApp.MinReplicas/#description","title":"Description","text":"<p>When a Container App is deployed Azure create one or more instances or replicas of the application. The number of replicas is configurable and can be automatically scaled up or down based on demand using scaling rules.</p> <p>When a single instance of the application is deployed, in the event of a failure Azure will replace the instance. However, this can lead to downtime while the instance is replaced with this single point of failure.</p> <p>To ensure that the application is highly available, it is recommended to configure a minimum number of replicas. The minimum number of replicas required will depend on the criticality of the application and the expected demand.</p> <p>For a production application, consider configuring a minimum of two (2) replicas. When zone redundancy is configured, use a minimum of three (3) replicas to spread the replicas across all availability zones.</p>","tags":["Azure.ContainerApp.MinReplicas","AZR-000413"]},{"location":"en/rules/Azure.ContainerApp.MinReplicas/#recommendation","title":"Recommendation","text":"<p>Consider configuring a minimum number of replicas for the Container App to remove a single point of failure on a single instance.</p>","tags":["Azure.ContainerApp.MinReplicas","AZR-000413"]},{"location":"en/rules/Azure.ContainerApp.MinReplicas/#examples","title":"Examples","text":"","tags":["Azure.ContainerApp.MinReplicas","AZR-000413"]},{"location":"en/rules/Azure.ContainerApp.MinReplicas/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Container Apps that pass this rule:</p> <ul> <li>Set the <code>properties.template.scale.minReplicas</code> property to a minimum of <code>2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.App/containerApps\",\n  \"apiVersion\": \"2024-03-01\",\n  \"name\": \"[parameters('appName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"environmentId\": \"[resourceId('Microsoft.App/managedEnvironments', parameters('envName'))]\",\n    \"template\": {\n      \"revisionSuffix\": \"[parameters('revision')]\",\n      \"containers\": \"[variables('containers')]\",\n      \"scale\": {\n        \"minReplicas\": 2\n      }\n    },\n    \"configuration\": {\n      \"ingress\": {\n        \"allowInsecure\": false,\n        \"external\": false,\n        \"ipSecurityRestrictions\": \"[variables('ipSecurityRestrictions')]\",\n        \"stickySessions\": {\n          \"affinity\": \"none\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.App/managedEnvironments', parameters('envName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.ContainerApp.MinReplicas","AZR-000413"]},{"location":"en/rules/Azure.ContainerApp.MinReplicas/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Container Apps that pass this rule:</p> <ul> <li>Set the <code>properties.template.scale.minReplicas</code> property to a minimum of <code>2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource containerApp 'Microsoft.App/containerApps@2024-03-01' = {\n  name: appName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    environmentId: containerEnv.id\n    template: {\n      revisionSuffix: revision\n      containers: containers\n      scale: {\n        minReplicas: 2\n      }\n    }\n    configuration: {\n      ingress: {\n        allowInsecure: false\n        external: false\n        ipSecurityRestrictions: ipSecurityRestrictions\n        stickySessions: {\n          affinity: 'none'\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/app/container-app:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/app/container-app:0.11.0\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/app/container-app:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ContainerApp.MinReplicas","AZR-000413"]},{"location":"en/rules/Azure.ContainerApp.MinReplicas/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az containerapp update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --min-replicas 2 --max-replicas 10\n</code></pre>","tags":["Azure.ContainerApp.MinReplicas","AZR-000413"]},{"location":"en/rules/Azure.ContainerApp.MinReplicas/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Update-AzContainerApp -Name '&lt;name&gt;' -ResourceGroupName '&lt;resource_group&gt;' -ScaleMinReplica 2 -ScaleMaxReplica 10\n</code></pre>","tags":["Azure.ContainerApp.MinReplicas","AZR-000413"]},{"location":"en/rules/Azure.ContainerApp.MinReplicas/#links","title":"Links","text":"<ul> <li>RE:05 Redundancy</li> <li>Reliability in Azure Container Apps</li> <li>Set scaling rules in Azure Container Apps</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ContainerApp.MinReplicas","AZR-000413"]},{"location":"en/rules/Azure.ContainerApp.Name/","title":"Use valid container app names","text":"Azure.ContainerApp.NameAZR-000360Error <p> Operational Excellence  \u00b7  Container App  \u00b7  Rule  \u00b7  2023_03  \u00b7  Awareness</p> <p>Container Apps should meet naming requirements.</p>","tags":["Azure.ContainerApp.Name","AZR-000360"]},{"location":"en/rules/Azure.ContainerApp.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for container app names are:</p> <ul> <li>Between 2 and 32 characters long.</li> <li>Lowercase letters, numbers, and hyphens.</li> <li>Start with letter and end with alphanumeric.</li> </ul>","tags":["Azure.ContainerApp.Name","AZR-000360"]},{"location":"en/rules/Azure.ContainerApp.Name/#recommendation","title":"Recommendation","text":"<p>Consider using container app names that meets naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.ContainerApp.Name","AZR-000360"]},{"location":"en/rules/Azure.ContainerApp.Name/#examples","title":"Examples","text":"","tags":["Azure.ContainerApp.Name","AZR-000360"]},{"location":"en/rules/Azure.ContainerApp.Name/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Container Apps that pass this rule:</p> <ul> <li>Configuring a <code>minLength</code> and <code>maxLength</code> constraint for the resource name parameter.</li> <li>Optionally, you could also use a <code>uniqueString()</code> function to generate a unique name.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"envName\": {\n      \"type\": \"string\",\n      \"metadata\": {\n        \"description\": \"The name of the app environment.\"\n      }\n    },\n    \"appName\": {\n      \"type\": \"string\",\n      \"minLength\": 2,\n      \"maxLength\": 32,\n      \"metadata\": {\n        \"description\": \"The name of the container app.\"\n      }\n    },\n    \"location\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"[resourceGroup().location]\",\n      \"metadata\": {\n        \"description\": \"The location resources will be deployed.\"\n      }\n    },\n    \"workspaceId\": {\n      \"type\": \"string\",\n      \"metadata\": {\n        \"description\": \"The name of a Log Analytics workspace\"\n      }\n    },\n    \"subnetId\": {\n      \"type\": \"string\",\n      \"metadata\": {\n        \"description\": \"The resource ID of a VNET subnet.\"\n      }\n    },\n    \"revision\": {\n      \"type\": \"string\",\n      \"metadata\": {\n        \"description\": \"The revision of the container app.\"\n      }\n    }\n  },\n  \"variables\": {\n    \"containers\": [\n      {\n        \"name\": \"simple-hello-world-container\",\n        \"image\": \"mcr.microsoft.com/azuredocs/containerapps-helloworld:latest\",\n        \"resources\": {\n          \"cpu\": \"[json('0.25')]\",\n          \"memory\": \".5Gi\"\n        }\n      }\n    ]\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.App/containerApps\",\n      \"apiVersion\": \"2023-05-01\",\n      \"name\": \"[parameters('appName')]\",\n      \"location\": \"[parameters('location')]\",\n      \"identity\": {\n        \"type\": \"SystemAssigned\"\n      },\n      \"properties\": {\n        \"environmentId\": \"[resourceId('Microsoft.App/managedEnvironments', parameters('envName'))]\",\n        \"template\": {\n          \"revisionSuffix\": \"[parameters('revision')]\",\n          \"containers\": \"[variables('containers')]\",\n          \"scale\": {\n            \"minReplicas\": 2\n          }\n        },\n        \"configuration\": {\n          \"ingress\": {\n            \"allowInsecure\": false,\n            \"stickySessions\": {\n              \"affinity\": \"none\"\n            }\n          }\n        }\n      }\n    }\n  ]\n}\n</code></pre>","tags":["Azure.ContainerApp.Name","AZR-000360"]},{"location":"en/rules/Azure.ContainerApp.Name/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Container Apps that pass this rule:</p> <ul> <li>Configuring a <code>minLength</code> and <code>maxLength</code> constraint for the resource name parameter.</li> <li>Optionally, you could also use a <code>uniqueString()</code> function to generate a unique name.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>@minLength(2)\n@maxLength(32)\n@description('The name of the container app.')\nparam appName string\n\nresource containerApp 'Microsoft.App/containerApps@2023-05-01' = {\n  name: appName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    environmentId: containerEnv.id\n    template: {\n      revisionSuffix: revision\n      containers: containers\n      scale: {\n        minReplicas: 2\n      }\n    }\n    configuration: {\n      ingress: {\n        allowInsecure: false\n        stickySessions: {\n          affinity: 'none'\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/app/container-app:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/app/container-app:0.11.0\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/app/container-app:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ContainerApp.Name","AZR-000360"]},{"location":"en/rules/Azure.ContainerApp.Name/#notes","title":"Notes","text":"<p>This rule does not check if container app names are unique.</p>","tags":["Azure.ContainerApp.Name","AZR-000360"]},{"location":"en/rules/Azure.ContainerApp.Name/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for container app resource</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ContainerApp.Name","AZR-000360"]},{"location":"en/rules/Azure.ContainerApp.PublicAccess/","title":"Disable public access","text":"Azure.ContainerApp.PublicAccessAZR-000363Error <p> Security  \u00b7  Container App  \u00b7  Rule  \u00b7  2023_03  \u00b7  Important</p> <p>Ensure public network access for Container Apps environment is disabled.</p>","tags":["Azure.ContainerApp.PublicAccess","AZR-000363"]},{"location":"en/rules/Azure.ContainerApp.PublicAccess/#description","title":"Description","text":"<p>Container apps environments allows you to expose your container app to the Internet.</p> <p>Container apps environments deployed as external resources are available for public requests. External environments are deployed with a virtual IP on an external, public facing IP address.</p> <p>Disable public network access to improve security by exposing the Container Apps environment through an internal load balancer.</p> <p>This removes the need for a public IP address and prevents internet access to all Container Apps within the environment.</p> <p>To provide secure access externally, instead consider using:</p> <ul> <li>An Application Gateway in front of your Container Apps using your private VNET.</li> <li>A Azure Front Door premium profile with private link to your Container Apps.   This currently only applies to Container Apps using consumption without workload profiles.</li> </ul>","tags":["Azure.ContainerApp.PublicAccess","AZR-000363"]},{"location":"en/rules/Azure.ContainerApp.PublicAccess/#recommendation","title":"Recommendation","text":"<p>Consider disabling public network access by deploying an internal-only container apps to reduce the attack surface.</p>","tags":["Azure.ContainerApp.PublicAccess","AZR-000363"]},{"location":"en/rules/Azure.ContainerApp.PublicAccess/#examples","title":"Examples","text":"","tags":["Azure.ContainerApp.PublicAccess","AZR-000363"]},{"location":"en/rules/Azure.ContainerApp.PublicAccess/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Container Apps environments that pass this rule:</p> <ul> <li>Set a custom VNET by configuring <code>properties.vnetConfiguration.infrastructureSubnetId</code> with the resource Id of a subnet.</li> <li>Set <code>properties.vnetConfiguration.internal</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.App/managedEnvironments\",\n  \"apiVersion\": \"2024-03-01\",\n  \"name\": \"[parameters('envName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"appLogsConfiguration\": {\n      \"destination\": \"log-analytics\",\n      \"logAnalyticsConfiguration\": {\n        \"customerId\": \"[reference(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspaceId')), '2022-10-01').customerId]\",\n        \"sharedKey\": \"[listKeys(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspaceId')), '2022-10-01').primarySharedKey]\"\n      }\n    },\n    \"zoneRedundant\": true,\n    \"workloadProfiles\": [\n      {\n        \"name\": \"Consumption\",\n        \"workloadProfileType\": \"Consumption\"\n      }\n    ],\n    \"vnetConfiguration\": {\n      \"infrastructureSubnetId\": \"[parameters('subnetId')]\",\n      \"internal\": true\n    }\n  }\n}\n</code></pre>","tags":["Azure.ContainerApp.PublicAccess","AZR-000363"]},{"location":"en/rules/Azure.ContainerApp.PublicAccess/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Container Apps environments that pass this rule:</p> <ul> <li>Set a custom VNET by configuring <code>properties.vnetConfiguration.infrastructureSubnetId</code> with the resource Id of a subnet.</li> <li>Set <code>properties.vnetConfiguration.internal</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource containerEnv 'Microsoft.App/managedEnvironments@2024-03-01' = {\n  name: envName\n  location: location\n  properties: {\n    appLogsConfiguration: {\n      destination: 'log-analytics'\n      logAnalyticsConfiguration: {\n        customerId: workspace.properties.customerId\n        sharedKey: workspace.listKeys().primarySharedKey\n      }\n    }\n    zoneRedundant: true\n    workloadProfiles: [\n      {\n        name: 'Consumption'\n        workloadProfileType: 'Consumption'\n      }\n    ]\n    vnetConfiguration: {\n      infrastructureSubnetId: subnetId\n      internal: true\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/app/managed-environment:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/app/managed-environment:0.8.0\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/app/managed-environment:0.8.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ContainerApp.PublicAccess","AZR-000363"]},{"location":"en/rules/Azure.ContainerApp.PublicAccess/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>NS-2: Secure cloud services with network controls</li> <li>Networking in Azure Container Apps environment</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ContainerApp.PublicAccess","AZR-000363"]},{"location":"en/rules/Azure.ContainerApp.RestrictIngress/","title":"IP ingress restrictions mode","text":"Azure.ContainerApp.RestrictIngressAZR-000380Error <p> Security  \u00b7  Container App  \u00b7  Rule  \u00b7  2023_06  \u00b7  Important</p> <p>IP ingress restrictions mode should be set to allow action for all rules defined.</p>","tags":["Azure.ContainerApp.RestrictIngress","AZR-000380"]},{"location":"en/rules/Azure.ContainerApp.RestrictIngress/#description","title":"Description","text":"<p>Container apps supports restricting inbound traffic by IP addresses.</p> <p>This allows container apps to restrict inbound HTTP or TCP traffic by allowing or denying access to a specific list of IP address ranges.</p> <p>However, configuring a rule with the <code>Deny</code> action leads to traffic being denied from the IPv4 address or range, but allows all other traffic.</p> <p>Instead by configuring a rule or multiple rules with the <code>Allow</code> action traffic is allowed from the IPv4 address or range, but denies all other traffic.</p> <p>When no IP restriction rules are defined, all inbound traffic is allowed.</p> <p>IP ingress restrictions mode can be used for container apps within external and internal environments, but internal ones are limited to private addresses only, where external ones supports both public and private addresses.</p>","tags":["Azure.ContainerApp.RestrictIngress","AZR-000380"]},{"location":"en/rules/Azure.ContainerApp.RestrictIngress/#recommendation","title":"Recommendation","text":"<p>Consider configuring IP restrictions to limit ingress traffic to allowed IP addresses.</p>","tags":["Azure.ContainerApp.RestrictIngress","AZR-000380"]},{"location":"en/rules/Azure.ContainerApp.RestrictIngress/#examples","title":"Examples","text":"","tags":["Azure.ContainerApp.RestrictIngress","AZR-000380"]},{"location":"en/rules/Azure.ContainerApp.RestrictIngress/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Container Apps that pass this rule:</p> <ul> <li>Create one or more rules to allow traffic by configuring <code>properties.configuration.ingress.ipSecurityRestrictions</code>.</li> <li>For each rule defined in <code>properties.configuration.ingress.ipSecurityRestrictions</code> to action <code>Allow</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.App/containerApps\",\n  \"apiVersion\": \"2024-03-01\",\n  \"name\": \"[parameters('appName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"environmentId\": \"[resourceId('Microsoft.App/managedEnvironments', parameters('envName'))]\",\n    \"template\": {\n      \"revisionSuffix\": \"[parameters('revision')]\",\n      \"containers\": \"[variables('containers')]\",\n      \"scale\": {\n        \"minReplicas\": 2\n      }\n    },\n    \"configuration\": {\n      \"ingress\": {\n        \"allowInsecure\": false,\n        \"ipSecurityRestrictions\": [\n          {\n            \"action\": \"Allow\",\n            \"description\": \"Allowed IP address range\",\n            \"ipAddressRange\": \"10.1.1.1/32\",\n            \"name\": \"ClientIPAddress_1\"\n          },\n          {\n            \"action\": \"Allow\",\n            \"description\": \"Allowed IP address range\",\n            \"ipAddressRange\": \"10.1.2.1/32\",\n            \"name\": \"ClientIPAddress_2\"\n          }\n        ],\n        \"stickySessions\": {\n          \"affinity\": \"none\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.App/managedEnvironments', parameters('envName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.ContainerApp.RestrictIngress","AZR-000380"]},{"location":"en/rules/Azure.ContainerApp.RestrictIngress/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Container Apps that pass this rule:</p> <ul> <li>Create one or more rules to allow traffic by configuring <code>properties.configuration.ingress.ipSecurityRestrictions</code>.</li> <li>For each rule defined in <code>properties.configuration.ingress.ipSecurityRestrictions</code> to action <code>Allow</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource containerApp 'Microsoft.App/containerApps@2024-03-01' = {\n  name: appName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    environmentId: containerEnv.id\n    template: {\n      revisionSuffix: revision\n      containers: containers\n      scale: {\n        minReplicas: 2\n      }\n    }\n    configuration: {\n      ingress: {\n        allowInsecure: false\n        ipSecurityRestrictions: [\n          {\n            action: 'Allow'\n            description: 'Allowed IP address range'\n            ipAddressRange: '10.1.1.1/32'\n            name: 'ClientIPAddress_1'\n          }\n          {\n            action: 'Allow'\n            description: 'Allowed IP address range'\n            ipAddressRange: '10.1.2.1/32'\n            name: 'ClientIPAddress_2'\n          }\n        ]\n        stickySessions: {\n          affinity: 'none'\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/app/container-app:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/app/container-app:0.11.0\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/app/container-app:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ContainerApp.RestrictIngress","AZR-000380"]},{"location":"en/rules/Azure.ContainerApp.RestrictIngress/#notes","title":"Notes","text":"<p>All rules must be the same type. It is not supported to combine allow rules and deny rules. If no rules are defined at all, the rule will not pass as it expects at least one allow rule to be configured.</p>","tags":["Azure.ContainerApp.RestrictIngress","AZR-000380"]},{"location":"en/rules/Azure.ContainerApp.RestrictIngress/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>NS-2: Secure cloud services with network controls</li> <li>Networking in Azure Container Apps environment</li> <li>IP restrictions</li> <li>Set up IP ingress restrictions in Azure Container Apps</li> <li>Azure security baseline for Azure Container Apps</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ContainerApp.RestrictIngress","AZR-000380"]},{"location":"en/rules/Azure.ContainerApp.Storage/","title":"Persistant storage","text":"Azure.ContainerApp.StorageAZR-000364Error <p> Reliability  \u00b7  Container App  \u00b7  Rule  \u00b7  2023_03  \u00b7  Awareness</p> <p>Use of Azure Files volume mounts to persistent storage container data.</p>","tags":["Azure.ContainerApp.Storage","AZR-000364"]},{"location":"en/rules/Azure.ContainerApp.Storage/#description","title":"Description","text":"<p>Container apps allows you to use different types of storage. This can be achieved by using volume mounts.</p> <p>There are considerations to be taken, whether persistent storage is suitable for your app or if non-persistent storage is suitable. Apps may require no storage.</p> <p>By default all files created inside a container are stored on a writable container layer.</p> <p>Some considerations when using container file system storage:</p> <ul> <li>The data doesn't persist when that container no longer exists, and it can be difficult to get the data out of the container if another process needs it.</li> <li>There are no capacity guarantees. The available storage depends on the amount of disk space available in the container.</li> </ul> <p>Usage examples for this can be a stateless web API or a single page application (that just calls APIs).</p> <p>Some considerations when using storage volume mounts:</p> <ul> <li>Ephemeral volume<ul> <li>Files are persisted for the lifetime of the replica.<ul> <li>If a container in a replica restarts, the files in the volume remain.</li> </ul> </li> <li>Any containers in the replica can mount the same volume.</li> <li>A container can mount multiple ephemeral volumes.</li> </ul> </li> <li>Azure Files volume<ul> <li>Files written under the mount location are persisted to the file share.</li> <li>Files in the share are available via the mount location.</li> <li>Multiple containers can mount the same file share, including ones that are in another replica, revision, or container app.</li> <li>All containers that mount the share can access files written by any other container or method.</li> <li>More than one Azure Files volume can be mounted in a single container.</li> </ul> </li> </ul> <p>Usage examples for this can be a main app container that write log files that are processed by a sidecar container or writing files to a file share to make data accessible by other systems.</p>","tags":["Azure.ContainerApp.Storage","AZR-000364"]},{"location":"en/rules/Azure.ContainerApp.Storage/#recommendation","title":"Recommendation","text":"<p>Consider using Azure File volume mounts to persistent storage across containers and replicas.</p>","tags":["Azure.ContainerApp.Storage","AZR-000364"]},{"location":"en/rules/Azure.ContainerApp.Storage/#examples","title":"Examples","text":"","tags":["Azure.ContainerApp.Storage","AZR-000364"]},{"location":"en/rules/Azure.ContainerApp.Storage/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Container Apps that pass this rule:</p> <ul> <li>Configure the <code>properties.template.volumes</code> array to define a volume or several volumes.</li> <li>For each volume use the <code>storageType</code> of <code>AzureFile</code>.</li> <li>For each container in the template that you want to mount storage, define a volume mount in the <code>properties.template.containers.volumeMounts</code> array.</li> </ul> <p>For example with an Azure Files volume:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.App/containerApps\",\n  \"apiVersion\": \"2022-10-01\",\n  \"name\": \"[parameters('appName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\",\n    \"userAssignedIdentities\": {}\n  },\n  \"properties\": {\n    \"environmentId\": \"[parameters('environmentId')]\",\n    \"template\": {\n      \"revisionSuffix\": \"\",\n      \"containers\": [\n        {\n          \"image\": \"mcr.microsoft.com/azuredocs/containerapps-helloworld:latest\",\n          \"name\": \"simple-hello-world-container\",\n          \"resources\": {\n            \"cpu\": \"[json('.25')]\",\n            \"memory\": \".5Gi\"\n          },\n          \"volumeMounts\": [\n            {\n              \"mountPath\": \"/myfiles\",\n              \"volumeName\": \"azure-files-volume\"\n            }\n          ]\n        }\n      ],\n      \"scale\": {\n        \"minReplicas\": 1,\n        \"maxReplicas\": 3\n      },\n      \"volumes\": [\n        {\n          \"name\": \"azure-files-volume\",\n          \"storageType\": \"AzureFile\",\n          \"storageName\": \"myazurefiles\"\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.ContainerApp.Storage","AZR-000364"]},{"location":"en/rules/Azure.ContainerApp.Storage/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Container Apps that pass this rule:</p> <ul> <li>Configure the <code>properties.template.volumes</code> array to define a volume or several volumes.</li> <li>For each volume use the <code>storageType</code> of <code>AzureFile</code>.</li> <li>For each container in the template that you want to mount storage, define a volume mount in the <code>properties.template.containers.volumeMounts</code> array.</li> </ul> <p>For example with an Azure Files volume:</p> Azure Bicep snippet<pre><code>resource containerApp 'Microsoft.App/containerApps@2022-10-01' = {\n  name: appName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n    userAssignedIdentities: {}\n  }\n  properties: {\n    environmentId: environmentId\n    template: {\n      revisionSuffix: ''\n      containers: [\n        {\n          image: 'mcr.microsoft.com/azuredocs/containerapps-helloworld:latest'\n          name: 'simple-hello-world-container'\n          resources: {\n            cpu: json('.25')\n            memory: '.5Gi'\n          }\n          volumeMounts: [\n            {\n              mountPath: '/myfiles'\n              volumeName: 'azure-files-volume'\n            }\n          ]\n        }\n      ]\n      scale: {\n        minReplicas: 1\n        maxReplicas: 3\n      }\n      volumes: [\n        {\n          name: 'azure-files-volume'\n          storageType: 'AzureFile'\n          storageName: 'myazurefiles'\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.ContainerApp.Storage","AZR-000364"]},{"location":"en/rules/Azure.ContainerApp.Storage/#notes","title":"Notes","text":"<p>To enable Azure Files storage, a storage definition must be defined in the Container Apps Environment.</p>","tags":["Azure.ContainerApp.Storage","AZR-000364"]},{"location":"en/rules/Azure.ContainerApp.Storage/#links","title":"Links","text":"<ul> <li>RE:05 Redundancy</li> <li>Use storage mounts in Azure Container Apps</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ContainerApp.Storage","AZR-000364"]},{"location":"en/rules/Azure.Cosmos.AccountName/","title":"Use valid Cosmos DB account names","text":"Azure.Cosmos.AccountNameAZR-000096Error <p> Operational Excellence  \u00b7  Cosmos DB  \u00b7  Rule  \u00b7  2021_09  \u00b7  Awareness</p> <p>Cosmos DB account names should meet naming requirements.</p>","tags":["Azure.Cosmos.AccountName","AZR-000096"]},{"location":"en/rules/Azure.Cosmos.AccountName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Cosmos DB account names are:</p> <ul> <li>Between 3 and 44 characters long.</li> <li>Lowercase letters, numbers, and hyphens.</li> <li>Start and end with letters and numbers.</li> <li>Cosmos DB account names must be globally unique.</li> </ul>","tags":["Azure.Cosmos.AccountName","AZR-000096"]},{"location":"en/rules/Azure.Cosmos.AccountName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Cosmos DB account naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.Cosmos.AccountName","AZR-000096"]},{"location":"en/rules/Azure.Cosmos.AccountName/#notes","title":"Notes","text":"<p>This rule does not check if Cosmos DB account names are unique.</p>","tags":["Azure.Cosmos.AccountName","AZR-000096"]},{"location":"en/rules/Azure.Cosmos.AccountName/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> <li>Recommended abbreviations for Azure resource types</li> </ul>","tags":["Azure.Cosmos.AccountName","AZR-000096"]},{"location":"en/rules/Azure.Cosmos.ContinuousBackup/","title":"Enable continuous backup policy","text":"Azure.Cosmos.ContinuousBackupAZR-000439Error <p> Reliability  \u00b7  Cosmos DB  \u00b7  Rule  \u00b7  2024_09  \u00b7  Important</p> <p>Enable continuous backup on Cosmos DB accounts.</p>","tags":["Azure.Cosmos.ContinuousBackup","AZR-000439"]},{"location":"en/rules/Azure.Cosmos.ContinuousBackup/#description","title":"Description","text":"<p>Continuous backup for Azure Cosmos DB captures changes in near real-time, ensuring that you always have the most up-to-date backup. Data can be restored to any restorable timestamp within the retention period.</p> <p>Benefits of continuous backup include:</p> <ul> <li>Accidental Write or Delete Recovery: Quickly recover from unintended changes within a container.</li> <li>Comprehensive Restoration: Restore deleted accounts, databases, or containers.</li> <li>Regional Flexibility: Restore data into any region where backups existed at the desired restore point.</li> <li>Ease of Use: Restore data directly through the Azure portal without needing support requests.</li> </ul> <p>These features typically improve your:</p> <ul> <li>Recovery Time Objective (RTO): How long it take to recover, and systems are back online.</li> <li>Recovery Point Objective (RPO): The point in time you can recover to.</li> </ul> <p>Continuous backup involves additional costs, so it is recommended for mission-critical applications with frequent data changes.</p> <p>Check the documentation below for important information and limitations.</p>","tags":["Azure.Cosmos.ContinuousBackup","AZR-000439"]},{"location":"en/rules/Azure.Cosmos.ContinuousBackup/#recommendation","title":"Recommendation","text":"<p>Consider configuring Azure Cosmos DB with continuous backup mode for enhanced data protection (RTO &amp; RPO) and easier recovery.</p>","tags":["Azure.Cosmos.ContinuousBackup","AZR-000439"]},{"location":"en/rules/Azure.Cosmos.ContinuousBackup/#examples","title":"Examples","text":"","tags":["Azure.Cosmos.ContinuousBackup","AZR-000439"]},{"location":"en/rules/Azure.Cosmos.ContinuousBackup/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure continuous backup for Cosmos DB:</p> <ul> <li>Set the <code>properties.backupPolicy.type</code> property to <code>Continuous</code>.</li> <li>Set the <code>properties.backupPolicy.continuousModeProperties.tier</code> property to a valid tier.   Valid tiers include <code>Continuous7Days</code> and <code>Continuous30Days</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DocumentDB/databaseAccounts\",\n  \"apiVersion\": \"2024-05-15\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"kind\": \"GlobalDocumentDB\",\n  \"properties\": {\n    \"disableLocalAuth\": true,\n    \"locations\": [\n      {\n        \"locationName\": \"[parameters('location')]\",\n        \"failoverPriority\": 0,\n        \"isZoneRedundant\": true\n      }\n    ],\n    \"backupPolicy\": {\n      \"type\": \"Continuous\",\n      \"continuousModeProperties\": {\n        \"tier\": \"Continuous7Days\"\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.Cosmos.ContinuousBackup","AZR-000439"]},{"location":"en/rules/Azure.Cosmos.ContinuousBackup/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure continuous backup for Cosmos DB:</p> <ul> <li>Set the <code>properties.backupPolicy.type</code> property to <code>Continuous</code>.</li> <li>Set the <code>properties.backupPolicy.continuousModeProperties.tier</code> property to a valid tier.   Valid tiers include <code>Continuous7Days</code> and <code>Continuous30Days</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource account 'Microsoft.DocumentDB/databaseAccounts@2024-05-15' = {\n  name: name\n  location: location\n  kind: 'GlobalDocumentDB'\n  properties: {\n    disableLocalAuth: true\n    locations: [\n      {\n        locationName: location\n        failoverPriority: 0\n        isZoneRedundant: true\n      }\n    ]\n    backupPolicy: {\n      type: 'Continuous'\n      continuousModeProperties: {\n        tier: 'Continuous30Days'\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.Cosmos.ContinuousBackup","AZR-000439"]},{"location":"en/rules/Azure.Cosmos.ContinuousBackup/#notes","title":"Notes","text":"<p>Azure Cosmos DB API for Cassandra does not support continuous backup mode currently.</p>","tags":["Azure.Cosmos.ContinuousBackup","AZR-000439"]},{"location":"en/rules/Azure.Cosmos.ContinuousBackup/#links","title":"Links","text":"<ul> <li>RE:06 Data partitioning</li> <li>Continuous backup with point-in-time restore in Azure Cosmos DB</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Cosmos.ContinuousBackup","AZR-000439"]},{"location":"en/rules/Azure.Cosmos.DefenderCloud/","title":"Enable Microsoft Defender","text":"Azure.Cosmos.DefenderCloudAZR-000382Error <p> Security  \u00b7  Cosmos DB  \u00b7  Rule  \u00b7  2023_06  \u00b7  Critical</p> <p>Enable Microsoft Defender for Azure Cosmos DB.</p>","tags":["Azure.Cosmos.DefenderCloud","AZR-000382"]},{"location":"en/rules/Azure.Cosmos.DefenderCloud/#description","title":"Description","text":"<p>Microsoft Defender for Azure Cosmos DB provides additional security insight for Azure Cosmos DB accounts.</p> <p>Protection is provided by analyzing onboarded Cosmos DB accounts for unusual and potentially harmful attempts to access or exploit the accounts. Which allows Microsoft Defender for Cloud to produce security alerts that are triggered when anomalies in activity occur.</p> <p>Security alerts for onboarded Cosmos DB accounts shows up in Defender for Cloud with details of the suspicious activity and recommendations on how to investigate and remediate the threats.</p> <p>Microsoft Defender for Cosmos DB can be enabled at the resource level, but the general recommendation is to enable it at the subscription level and by doing so ensures all Cosmos DB accounts in the subscription will be protected, including future ones. However, enabling it at resource level can be done to protect a specific Azure Cosmos DB account.</p>","tags":["Azure.Cosmos.DefenderCloud","AZR-000382"]},{"location":"en/rules/Azure.Cosmos.DefenderCloud/#recommendation","title":"Recommendation","text":"<p>Consider using Microsoft Defender for Azure Cosmos DB to provide additional security insights for Azure Cosmos DB accounts.</p>","tags":["Azure.Cosmos.DefenderCloud","AZR-000382"]},{"location":"en/rules/Azure.Cosmos.DefenderCloud/#examples","title":"Examples","text":"","tags":["Azure.Cosmos.DefenderCloud","AZR-000382"]},{"location":"en/rules/Azure.Cosmos.DefenderCloud/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable Microsoft Defender for Azure Cosmos DB accounts:</p> <ul> <li>Deploy a <code>Microsoft.DBforMySQL/servers/securityAlertPolicies</code> sub-resource (extension resource).</li> <li>Set the <code>properties.isEnabled</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/advancedThreatProtectionSettings\",\n  \"apiVersion\": \"2019-01-01\",\n  \"scope\": \"[format('Microsoft.DocumentDB/databaseAccounts/{0}', parameters('accountName'))]\",\n  \"name\": \"current\",\n  \"properties\": {\n    \"isEnabled\": true\n  },\n  \"dependsOn\": [\n    \"cosmosDbAccount\"\n  ]\n}\n</code></pre>","tags":["Azure.Cosmos.DefenderCloud","AZR-000382"]},{"location":"en/rules/Azure.Cosmos.DefenderCloud/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable Microsoft Defender for Azure Cosmos DB accounts:</p> <ul> <li>Deploy a <code>Microsoft.DBforMySQL/servers/securityAlertPolicies</code> sub-resource (extension resource).</li> <li>Set the <code>properties.isEnabled</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForCosmosDb 'Microsoft.Security/advancedThreatProtectionSettings@2019-01-01' = {\n  scope: cosmosDbAccount\n  name: 'current'\n  properties: {\n    isEnabled: true\n  }\n}\n</code></pre>","tags":["Azure.Cosmos.DefenderCloud","AZR-000382"]},{"location":"en/rules/Azure.Cosmos.DefenderCloud/#notes","title":"Notes","text":"<p>Microsoft Defender for Azure Cosmos DB is currently available only for the NoSQL API. When Microsoft Defender for Cosmos DB is enabled at the subscription level, the resource level enablement has no effect as it will be handled by the plan at the subscription level.</p>","tags":["Azure.Cosmos.DefenderCloud","AZR-000382"]},{"location":"en/rules/Azure.Cosmos.DefenderCloud/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>What is Microsoft Defender for Cloud?</li> <li>Overview of Microsoft Defender for Azure Cosmos DB</li> <li>Enable Microsoft Defender for Azure Cosmos DB</li> <li>Quickstart: Enable enhanced security features</li> <li>Azure security baseline for Azure Cosmos DB</li> <li>DP-2: Monitor anomalies and threats targeting sensitive data</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure Policy built-in policy definitions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Cosmos.DefenderCloud","AZR-000382"]},{"location":"en/rules/Azure.Cosmos.DisableLocalAuth/","title":"Cosmos DB account access keys are enabled","text":"Azure.Cosmos.DisableLocalAuthAZR-000420Error <p> Security  \u00b7  Cosmos DB  \u00b7  Rule  \u00b7  2024_06  \u00b7  Critical</p> <p>Access keys allow depersonalized access to Cosmos DB accounts using a shared secret.</p>","tags":["Azure.Cosmos.DisableLocalAuth","AZR-000420"]},{"location":"en/rules/Azure.Cosmos.DisableLocalAuth/#description","title":"Description","text":"<p>Every request to an Cosmos DB Account resource must be authenticated. Cosmos DB supports authenticating requests using either Entra ID (previously Azure AD) identities or local authentication. Local authentication uses accounts keys that are granted permissions to the entire Cosmos DB Account.</p> <p>Using Entra ID, provides consistency as a single authoritative source which:</p> <ul> <li>Increases clarity and reduces security risks from human errors and configuration complexity.</li> <li>Allows granting of permissions using role-based access control (RBAC).</li> <li>Provides support for advanced identity security and governance features.</li> </ul> <p>Disabling local authentication ensures that Entra ID is used exclusively for authentication. Any subsequent requests to the resource using account keys will be rejected.</p>","tags":["Azure.Cosmos.DisableLocalAuth","AZR-000420"]},{"location":"en/rules/Azure.Cosmos.DisableLocalAuth/#recommendation","title":"Recommendation","text":"<p>Consider disabling local authentication on Cosmos DB account and using Entra ID.</p>","tags":["Azure.Cosmos.DisableLocalAuth","AZR-000420"]},{"location":"en/rules/Azure.Cosmos.DisableLocalAuth/#examples","title":"Examples","text":"","tags":["Azure.Cosmos.DisableLocalAuth","AZR-000420"]},{"location":"en/rules/Azure.Cosmos.DisableLocalAuth/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy database accounts that pass this rule:</p> <ul> <li>Set the <code>properties.disableLocalAuth</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DocumentDB/databaseAccounts\",\n  \"apiVersion\": \"2023-11-15\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"kind\": \"GlobalDocumentDB\",\n  \"properties\": {\n    \"disableLocalAuth\": true,\n    \"locations\": [\n      {\n        \"locationName\": \"[parameters('location')]\",\n        \"failoverPriority\": 0,\n        \"isZoneRedundant\": true\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.Cosmos.DisableLocalAuth","AZR-000420"]},{"location":"en/rules/Azure.Cosmos.DisableLocalAuth/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy database accounts that pass this rule:</p> <ul> <li>Set the <code>properties.disableLocalAuth</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource account 'Microsoft.DocumentDB/databaseAccounts@2023-11-15' = {\n  name: name\n  location: location\n  kind: 'GlobalDocumentDB'\n  properties: {\n    disableLocalAuth: true\n    locations: [\n      {\n        locationName: location\n        failoverPriority: 0\n        isZoneRedundant: true\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.Cosmos.DisableLocalAuth","AZR-000420"]},{"location":"en/rules/Azure.Cosmos.DisableLocalAuth/#notes","title":"Notes","text":"<p>Enforcing role-based access control as the only authentication method is currently only supported for the <code>NoSQL API</code>.</p>","tags":["Azure.Cosmos.DisableLocalAuth","AZR-000420"]},{"location":"en/rules/Azure.Cosmos.DisableLocalAuth/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Enforcing role-based access control as the only authentication method</li> <li>Configure role-based access control with Microsoft Entra ID for your Azure Cosmos DB account management plane</li> <li>Configure role-based access control with Microsoft Entra ID for your Azure Cosmos DB account data plane</li> <li>Azure security baseline for Azure Cosmos DB</li> <li>IM-1: Use centralized identity and authentication system</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Cosmos.DisableLocalAuth","AZR-000420"]},{"location":"en/rules/Azure.Cosmos.DisableMetadataWrite/","title":"Restrict user access to data operations in Azure Cosmos DB","text":"Azure.Cosmos.DisableMetadataWriteAZR-000095Error <p> Security  \u00b7  Cosmos DB  \u00b7  Rule  \u00b7  2021_09  \u00b7  Important</p> <p>Use Entra ID identities for management place operations in Azure Cosmos DB.</p>","tags":["Azure.Cosmos.DisableMetadataWrite","AZR-000095"]},{"location":"en/rules/Azure.Cosmos.DisableMetadataWrite/#description","title":"Description","text":"<p>Cosmos DB provides two authorization options for interacting with the database:</p> <ul> <li>Entra ID identities (previously known as Azure AD).   Can be used to authorize account and resource management operations.</li> <li>Keys and resource tokens.   Can be used to authorize resource management and data operations.</li> </ul> <p>Resource management operations include management of databases, indexes, and containers. By default, keys are permitted to perform resource management operations. You can restrict these operations to Azure Resource Manager (ARM) calls only.</p>","tags":["Azure.Cosmos.DisableMetadataWrite","AZR-000095"]},{"location":"en/rules/Azure.Cosmos.DisableMetadataWrite/#recommendation","title":"Recommendation","text":"<p>Consider limiting key and resource tokens to data plane operations only. Use Microsoft Entra ID identities for authorizing account and resource management operations.</p>","tags":["Azure.Cosmos.DisableMetadataWrite","AZR-000095"]},{"location":"en/rules/Azure.Cosmos.DisableMetadataWrite/#examples","title":"Examples","text":"","tags":["Azure.Cosmos.DisableMetadataWrite","AZR-000095"]},{"location":"en/rules/Azure.Cosmos.DisableMetadataWrite/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Cosmos DB accounts that pass this rule:</p> <ul> <li>Set the <code>Properties.disableKeyBasedMetadataWriteAccess</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DocumentDB/databaseAccounts\",\n  \"apiVersion\": \"2023-04-15\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"enableFreeTier\": false,\n    \"consistencyPolicy\": {\n      \"defaultConsistencyLevel\": \"Session\"\n    },\n    \"databaseAccountOfferType\": \"Standard\",\n    \"locations\": [\n      {\n        \"locationName\": \"[parameters('location')]\",\n        \"failoverPriority\": 0,\n        \"isZoneRedundant\": true\n      }\n    ],\n    \"disableKeyBasedMetadataWriteAccess\": true\n  }\n}\n</code></pre>","tags":["Azure.Cosmos.DisableMetadataWrite","AZR-000095"]},{"location":"en/rules/Azure.Cosmos.DisableMetadataWrite/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Cosmos DB accounts that pass this rule:</p> <ul> <li>Set the <code>Properties.disableKeyBasedMetadataWriteAccess</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource account 'Microsoft.DocumentDB/databaseAccounts@2023-04-15' = {\n  name: name\n  location: location\n  properties: {\n    enableFreeTier: false\n    consistencyPolicy: {\n      defaultConsistencyLevel: 'Session'\n    }\n    databaseAccountOfferType: 'Standard'\n    locations: [\n      {\n        locationName: location\n        failoverPriority: 0\n        isZoneRedundant: true\n      }\n    ]\n    disableKeyBasedMetadataWriteAccess: true\n  }\n}\n</code></pre>","tags":["Azure.Cosmos.DisableMetadataWrite","AZR-000095"]},{"location":"en/rules/Azure.Cosmos.DisableMetadataWrite/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Azure Cosmos DB key based metadata write access should be disabled <code>/providers/Microsoft.Authorization/policyDefinitions/4750c32b-89c0-46af-bfcb-2e4541a818d5</code></li> </ul>","tags":["Azure.Cosmos.DisableMetadataWrite","AZR-000095"]},{"location":"en/rules/Azure.Cosmos.DisableMetadataWrite/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Restrict user access to data operations in Azure Cosmos DB</li> <li>Secure access to data in Azure Cosmos DB</li> <li>How does Azure Cosmos DB secure my database?</li> <li>Access control in the Azure Cosmos DB SQL API</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.Cosmos.DisableMetadataWrite","AZR-000095"]},{"location":"en/rules/Azure.Cosmos.MinTLS/","title":"Cosmos DB account minimum TLS version","text":"Azure.Cosmos.MinTLSAZR-000415Error <p> Security  \u00b7  Cosmos DB  \u00b7  Rule  \u00b7  2024_06  \u00b7  Critical</p> <p>Cosmos DB accounts should reject TLS versions older than 1.2.</p>","tags":["Azure.Cosmos.MinTLS","AZR-000415"]},{"location":"en/rules/Azure.Cosmos.MinTLS/#description","title":"Description","text":"<p>The minimum version of TLS that Azure Cosmos DB accepts for client communication is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS.</p> <p>Azure Cosmos DB lets you disable outdated protocols and enforce TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted.</p>","tags":["Azure.Cosmos.MinTLS","AZR-000415"]},{"location":"en/rules/Azure.Cosmos.MinTLS/#recommendation","title":"Recommendation","text":"<p>Consider configuring the minimum supported TLS version to be 1.2. Also consider enforcing this setting using Azure Policy.</p>","tags":["Azure.Cosmos.MinTLS","AZR-000415"]},{"location":"en/rules/Azure.Cosmos.MinTLS/#examples","title":"Examples","text":"","tags":["Azure.Cosmos.MinTLS","AZR-000415"]},{"location":"en/rules/Azure.Cosmos.MinTLS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy database accounts that pass this rule:</p> <ul> <li>Set the <code>properties.minimalTlsVersion</code> property to <code>Tls12</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DocumentDB/databaseAccounts\",\n  \"apiVersion\": \"2023-11-15\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"enableFreeTier\": false,\n    \"consistencyPolicy\": {\n      \"defaultConsistencyLevel\": \"Session\"\n    },\n    \"databaseAccountOfferType\": \"Standard\",\n    \"locations\": [\n      {\n        \"locationName\": \"[parameters('location')]\",\n        \"failoverPriority\": 0,\n        \"isZoneRedundant\": true\n      }\n    ],\n    \"disableKeyBasedMetadataWriteAccess\": true,\n    \"minimalTlsVersion\": \"Tls12\"\n  }\n}\n</code></pre>","tags":["Azure.Cosmos.MinTLS","AZR-000415"]},{"location":"en/rules/Azure.Cosmos.MinTLS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy database accounts that pass this rule:</p> <ul> <li>Set the <code>properties.minimalTlsVersion</code> property to <code>Tls12</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource account 'Microsoft.DocumentDB/databaseAccounts@2023-11-15' = {\n  name: name\n  location: location\n  properties: {\n    enableFreeTier: false\n    consistencyPolicy: {\n      defaultConsistencyLevel: 'Session'\n    }\n    databaseAccountOfferType: 'Standard'\n    locations: [\n      {\n        locationName: location\n        failoverPriority: 0\n        isZoneRedundant: true\n      }\n    ]\n    disableKeyBasedMetadataWriteAccess: true\n    minimalTlsVersion: 'Tls12'\n  }\n}\n</code></pre>","tags":["Azure.Cosmos.MinTLS","AZR-000415"]},{"location":"en/rules/Azure.Cosmos.MinTLS/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Self-serve minimum TLS version enforcement in Azure Cosmos DB</li> <li>TLS encryption in Azure</li> <li>Preparing for TLS 1.2 in Microsoft Azure</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.Cosmos.MinTLS","AZR-000415"]},{"location":"en/rules/Azure.Cosmos.PublicAccess/","title":"Disable public network access on Cosmos DB","text":"Azure.Cosmos.PublicAccessAZR-000421Error <p> Security  \u00b7  Cosmos DB  \u00b7  Rule  \u00b7  2024_06  \u00b7  Critical</p> <p>Azure Cosmos DB should have public network access disabled.</p>","tags":["Azure.Cosmos.PublicAccess","AZR-000421"]},{"location":"en/rules/Azure.Cosmos.PublicAccess/#description","title":"Description","text":"<p>Disabling public network access improves security by ensuring that the resource isn't exposed on the public internet. You can control exposure of your resources by creating private endpoints instead.</p>","tags":["Azure.Cosmos.PublicAccess","AZR-000421"]},{"location":"en/rules/Azure.Cosmos.PublicAccess/#recommendation","title":"Recommendation","text":"<p>Consider disabling public network access on Cosmos DB, using private endpoints to control connectivity for data plane operations.</p>","tags":["Azure.Cosmos.PublicAccess","AZR-000421"]},{"location":"en/rules/Azure.Cosmos.PublicAccess/#examples","title":"Examples","text":"","tags":["Azure.Cosmos.PublicAccess","AZR-000421"]},{"location":"en/rules/Azure.Cosmos.PublicAccess/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy database accounts that pass this rule:</p> <ul> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DocumentDB/databaseAccounts\",\n  \"apiVersion\": \"2023-11-15\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"kind\": \"GlobalDocumentDB\",\n  \"properties\": {\n    \"publicNetworkAccess\": \"Disabled\",\n    \"locations\": [\n      {\n        \"locationName\": \"[parameters('location')]\",\n        \"failoverPriority\": 0,\n        \"isZoneRedundant\": true\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.Cosmos.PublicAccess","AZR-000421"]},{"location":"en/rules/Azure.Cosmos.PublicAccess/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy database accounts that pass this rule:</p> <ul> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource account 'Microsoft.DocumentDB/databaseAccounts@2023-11-15' = {\n  name: name\n  location: location\n  kind: 'GlobalDocumentDB'\n  properties: {\n    publicNetworkAccess: 'Disabled'\n    locations: [\n      {\n        locationName: location\n        failoverPriority: 0\n        isZoneRedundant: true\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.Cosmos.PublicAccess","AZR-000421"]},{"location":"en/rules/Azure.Cosmos.PublicAccess/#links","title":"Links","text":"<ul> <li>SE:06 Network controls </li> <li>Configure Azure Private Link for an Azure Cosmos DB account</li> <li>Azure security baseline for Azure Cosmos DB</li> <li>NS-2: Secure cloud services with network controls</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Cosmos.PublicAccess","AZR-000421"]},{"location":"en/rules/Azure.Cosmos.SLA/","title":"Use paid tier for production workloads","text":"Azure.Cosmos.SLAAZR-000419Error <p> Reliability  \u00b7  Cosmos DB  \u00b7  Rule  \u00b7  2024_06  \u00b7  Important</p> <p>Use a paid tier to qualify for a Service Level Agreement (SLA).</p>","tags":["Azure.Cosmos.SLA","AZR-000419"]},{"location":"en/rules/Azure.Cosmos.SLA/#description","title":"Description","text":"<p>Cosmos DB offers one account on selected subscriptions to be marked to use a free tier allowance of 1000 DTUs. This free tier is intended for developers to try Cosmos DB during early development and proof of concepts (PoC). Using the free tier offer is not intended to be used for production level workloads.</p> <p>When using the free tier, the SLA for Cosmos DB does not apply.</p>","tags":["Azure.Cosmos.SLA","AZR-000419"]},{"location":"en/rules/Azure.Cosmos.SLA/#recommendation","title":"Recommendation","text":"<p>Consider using a paid SKU to qualify for a Service Level Agreement (SLA).</p>","tags":["Azure.Cosmos.SLA","AZR-000419"]},{"location":"en/rules/Azure.Cosmos.SLA/#examples","title":"Examples","text":"","tags":["Azure.Cosmos.SLA","AZR-000419"]},{"location":"en/rules/Azure.Cosmos.SLA/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Cosmos DB accounts that pass this rule:</p> <ul> <li>Set the <code>properties.enableFreeTier</code> property to <code>false</code> or do not configure the property.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DocumentDB/databaseAccounts\",\n  \"apiVersion\": \"2023-04-15\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"enableFreeTier\": false,\n    \"consistencyPolicy\": {\n      \"defaultConsistencyLevel\": \"Session\"\n    },\n    \"databaseAccountOfferType\": \"Standard\",\n    \"locations\": [\n      {\n        \"locationName\": \"[parameters('location')]\",\n        \"failoverPriority\": 0,\n        \"isZoneRedundant\": true\n      }\n    ],\n    \"disableKeyBasedMetadataWriteAccess\": true\n  }\n}\n</code></pre>","tags":["Azure.Cosmos.SLA","AZR-000419"]},{"location":"en/rules/Azure.Cosmos.SLA/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Cosmos DB accounts that pass this rule:</p> <ul> <li>Set the <code>properties.enableFreeTier</code> property to <code>false</code> or do not configure the property.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource account 'Microsoft.DocumentDB/databaseAccounts@2023-04-15' = {\n  name: name\n  location: location\n  properties: {\n    enableFreeTier: false\n    consistencyPolicy: {\n      defaultConsistencyLevel: 'Session'\n    }\n    databaseAccountOfferType: 'Standard'\n    locations: [\n      {\n        locationName: location\n        failoverPriority: 0\n        isZoneRedundant: true\n      }\n    ]\n    disableKeyBasedMetadataWriteAccess: true\n  }\n}\n</code></pre>","tags":["Azure.Cosmos.SLA","AZR-000419"]},{"location":"en/rules/Azure.Cosmos.SLA/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Try Azure Cosmos DB free</li> <li>Azure Cosmos DB pricing</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Cosmos.SLA","AZR-000419"]},{"location":"en/rules/Azure.DataFactory.Version/","title":"Use Data Factory v2","text":"Azure.DataFactory.VersionAZR-000097Error <p> Reliability  \u00b7  Data Factory  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Consider migrating to DataFactory v2.</p>","tags":["Azure.DataFactory.Version","AZR-000097"]},{"location":"en/rules/Azure.DataFactory.Version/#description","title":"Description","text":"<p>Consider migrating to DataFactory v2.</p>","tags":["Azure.DataFactory.Version","AZR-000097"]},{"location":"en/rules/Azure.DataFactory.Version/#recommendation","title":"Recommendation","text":"<p>Consider migrating to DataFactory v2.</p>","tags":["Azure.DataFactory.Version","AZR-000097"]},{"location":"en/rules/Azure.DataFactory.Version/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> </ul>","tags":["Azure.DataFactory.Version","AZR-000097"]},{"location":"en/rules/Azure.Databricks.PublicAccess/","title":"Azure Databricks workspaces should disable public network access","text":"Azure.Databricks.PublicAccessAZR-000410Error <p> Security  \u00b7  Databricks  \u00b7  Rule  \u00b7  2024_03  \u00b7  Critical</p> <p>Azure Databricks workspaces should disable public network access.</p>","tags":["Azure.Databricks.PublicAccess","AZR-000410"]},{"location":"en/rules/Azure.Databricks.PublicAccess/#description","title":"Description","text":"<p>Disabling public network access improves security by ensuring that the resource isn't exposed on the public internet. You can control exposure of your resources by creating private endpoints instead.</p>","tags":["Azure.Databricks.PublicAccess","AZR-000410"]},{"location":"en/rules/Azure.Databricks.PublicAccess/#recommendation","title":"Recommendation","text":"<p>Consider configuring Databricks workspaces to disable public network access, using private endpoints to control connectivity.</p>","tags":["Azure.Databricks.PublicAccess","AZR-000410"]},{"location":"en/rules/Azure.Databricks.PublicAccess/#examples","title":"Examples","text":"","tags":["Azure.Databricks.PublicAccess","AZR-000410"]},{"location":"en/rules/Azure.Databricks.PublicAccess/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy workspaces that pass this rule:</p> <ul> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Databricks/workspaces\",\n  \"apiVersion\": \"2023-02-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"standard\"\n  },\n  \"properties\": {\n    \"managedResourceGroupId\": \"[subscriptionResourceId('Microsoft.Resources/resourceGroups', 'example-mg')]\",\n    \"publicNetworkAccess\": \"Disabled\",\n    \"parameters\": {\n      \"enableNoPublicIp\": {\n        \"value\": true\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.Databricks.PublicAccess","AZR-000410"]},{"location":"en/rules/Azure.Databricks.PublicAccess/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy workspaces that pass this rule:</p> <ul> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource databricks 'Microsoft.Databricks/workspaces@2023-02-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'standard'\n  }\n  properties: {\n    managedResourceGroupId: managedRg.id\n    publicNetworkAccess: 'Disabled'\n    parameters: {\n      enableNoPublicIp: {\n        value: true\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.Databricks.PublicAccess","AZR-000410"]},{"location":"en/rules/Azure.Databricks.PublicAccess/#links","title":"Links","text":"<ul> <li>SE:06 Network controls </li> <li>Azure Databricks WorkspaceProperties</li> <li>Azure Databricks Private Link Overview</li> <li>Network access</li> <li>Azure Databricks architecture overview</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.Databricks.PublicAccess","AZR-000410"]},{"location":"en/rules/Azure.Databricks.SKU/","title":"Ensure Databricks workspaces are non-trial SKUs for production workloads","text":"Azure.Databricks.SKUAZR-000409Error <p> Performance Efficiency  \u00b7  Databricks  \u00b7  Rule  \u00b7  2024_03  \u00b7  Critical</p> <p>Ensure Databricks workspaces are non-trial SKUs for production workloads.</p>","tags":["Azure.Databricks.SKU","AZR-000409"]},{"location":"en/rules/Azure.Databricks.SKU/#description","title":"Description","text":"<p>An Azure Databricks workspace has three available SKU types to support the compute demands of a workspace.</p> <p>The Trial SKU is a time-bound offer which has feature and compute limitations, making it unsuitable for production workloads. NB - The Trial SKU is a strong candidate for non-production or innovation workloads which can accept the tiers constraints.</p>","tags":["Azure.Databricks.SKU","AZR-000409"]},{"location":"en/rules/Azure.Databricks.SKU/#recommendation","title":"Recommendation","text":"<p>Consider configuring Databricks workspaces to use either Standard or Premium tiers, dependant on the workload demands and non-functional requirements (NFRs).</p>","tags":["Azure.Databricks.SKU","AZR-000409"]},{"location":"en/rules/Azure.Databricks.SKU/#examples","title":"Examples","text":"","tags":["Azure.Databricks.SKU","AZR-000409"]},{"location":"en/rules/Azure.Databricks.SKU/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy workspaces that pass this rule:</p> <ul> <li>Set the <code>sku.name</code> to a a non-trial tier, i.e. <code>standard</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Databricks/workspaces\",\n  \"apiVersion\": \"2023-02-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"standard\"\n  },\n  \"properties\": {\n    \"managedResourceGroupId\": \"[subscriptionResourceId('Microsoft.Resources/resourceGroups', 'example-mg')]\",\n    \"publicNetworkAccess\": \"Disabled\",\n    \"parameters\": {\n      \"enableNoPublicIp\": {\n        \"value\": true\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.Databricks.SKU","AZR-000409"]},{"location":"en/rules/Azure.Databricks.SKU/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy workspaces that pass this rule:</p> <ul> <li>Set the <code>sku.name</code> to a a non-trial tier, i.e. <code>standard</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource databricks 'Microsoft.Databricks/workspaces@2023-02-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'standard'\n  }\n  properties: {\n    managedResourceGroupId: managedRg.id\n    publicNetworkAccess: 'Disabled'\n    parameters: {\n      enableNoPublicIp: {\n        value: true\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.Databricks.SKU","AZR-000409"]},{"location":"en/rules/Azure.Databricks.SKU/#links","title":"Links","text":"<ul> <li>PE:03 Selecting services</li> <li>Databricks Setup</li> <li>Databricks Tier Features</li> <li>Databricks Workspace API</li> <li>Azure Databricks architecture overview</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.Databricks.SKU","AZR-000409"]},{"location":"en/rules/Azure.Databricks.SecureConnectivity/","title":"Enable secure connectivity for Databricks workspaces","text":"Azure.Databricks.SecureConnectivityAZR-000393Error <p> Security  \u00b7  Databricks  \u00b7  Rule  \u00b7  2023_09  \u00b7  Critical</p> <p>Use Databricks workspaces configured for secure cluster connectivity.</p>","tags":["Azure.Databricks.SecureConnectivity","AZR-000393"]},{"location":"en/rules/Azure.Databricks.SecureConnectivity/#description","title":"Description","text":"<p>An Azure Databricks workspace uses one or more runtime clusters to execute data processing workloads.</p> <p>When configuring Databricks workspaces, runtime clusters can be configured with or without public IP addresses. Secure cluster connectivity is used when a Databricks workspace is deployed without public IP addresses. Use secure cluster connectivity to simplify security and administration of Databricks networking within Azure.</p> <p>With secure cluster connectivity enabled:</p> <ul> <li>An outbound connection over HTTPS from the runtime cluster is used to communicate to the control plane.</li> <li>No open ports or IP public addressing is required.</li> </ul>","tags":["Azure.Databricks.SecureConnectivity","AZR-000393"]},{"location":"en/rules/Azure.Databricks.SecureConnectivity/#recommendation","title":"Recommendation","text":"<p>Consider configuring Databricks workspaces to use secure cluster connectivity.</p>","tags":["Azure.Databricks.SecureConnectivity","AZR-000393"]},{"location":"en/rules/Azure.Databricks.SecureConnectivity/#examples","title":"Examples","text":"","tags":["Azure.Databricks.SecureConnectivity","AZR-000393"]},{"location":"en/rules/Azure.Databricks.SecureConnectivity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy workspaces that pass this rule:</p> <ul> <li>Set the <code>properties.parameters.enableNoPublicIp.value</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Databricks/workspaces\",\n  \"apiVersion\": \"2023-02-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"standard\"\n  },\n  \"properties\": {\n    \"managedResourceGroupId\": \"[subscriptionResourceId('Microsoft.Resources/resourceGroups', 'example-mg')]\",\n    \"publicNetworkAccess\": \"Disabled\",\n    \"parameters\": {\n      \"enableNoPublicIp\": {\n        \"value\": true\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.Databricks.SecureConnectivity","AZR-000393"]},{"location":"en/rules/Azure.Databricks.SecureConnectivity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy workspaces that pass this rule:</p> <ul> <li>Set the <code>properties.parameters.enableNoPublicIp.value</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource databricks 'Microsoft.Databricks/workspaces@2023-02-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'standard'\n  }\n  properties: {\n    managedResourceGroupId: managedRg.id\n    publicNetworkAccess: 'Disabled'\n    parameters: {\n      enableNoPublicIp: {\n        value: true\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.Databricks.SecureConnectivity","AZR-000393"]},{"location":"en/rules/Azure.Databricks.SecureConnectivity/#links","title":"Links","text":"<ul> <li>SE:06 Network controls </li> <li>Secure cluster connectivity (No Public IP / NPIP)</li> <li>Network access</li> <li>Azure Databricks architecture overview</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.Databricks.SecureConnectivity","AZR-000393"]},{"location":"en/rules/Azure.Defender.Api/","title":"Set Microsoft Defender for APIs to the Standard tier","text":"Azure.Defender.ApiAZR-000377Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  2023_12  \u00b7  Critical</p> <p>Enable Microsoft Defender for APIs.</p>","tags":["Azure.Defender.Api","AZR-000377"]},{"location":"en/rules/Azure.Defender.Api/#description","title":"Description","text":"<p>Microsoft Defender for APIs provides additional security for APIs published in Azure API Management.</p> <p>Protection is provided by analyzing onboarded APIs. Which allows Microsoft Defender for Cloud to produce security findings.</p> <p>The inventory and security findings for onboarded APIs is reviewed in the Defender for Cloud API Security dashboard.</p> <p>These security findings includes API recommendations and runtime threats.</p> <p>Defender for APIs can be enabled together with the Defender CSPM plan, offering further capabilities.</p> <p>Microsoft Defender for APIs can be enabled at the subscription level.</p>","tags":["Azure.Defender.Api","AZR-000377"]},{"location":"en/rules/Azure.Defender.Api/#recommendation","title":"Recommendation","text":"<p>Consider using Microsoft Defender for APIs to provide additional security for APIs published in Azure API Management.</p>","tags":["Azure.Defender.Api","AZR-000377"]},{"location":"en/rules/Azure.Defender.Api/#examples","title":"Examples","text":"","tags":["Azure.Defender.Api","AZR-000377"]},{"location":"en/rules/Azure.Defender.Api/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy and enable Defender for APIs configurations that pass this rule:</p> <ul> <li>Set the <code>properties.pricingTier</code> property to to <code>Standard</code>.</li> <li>Set the <code>properties.subPlan</code> property to a plan such as <code>P1</code>.   Other plans are available, currently these are: <code>P1</code>, <code>P2</code>, <code>P3</code>, <code>P4</code>, and <code>P5</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/pricings\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"Api\",\n  \"properties\": {\n    \"subPlan\": \"P1\",\n    \"pricingTier\": \"Standard\"\n  }\n}\n</code></pre>","tags":["Azure.Defender.Api","AZR-000377"]},{"location":"en/rules/Azure.Defender.Api/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy and enable Defender for APIs configurations that pass this rule:</p> <ul> <li>Set the <code>properties.pricingTier</code> property to to <code>Standard</code>.</li> <li>Set the <code>properties.subPlan</code> property to a plan such as <code>P1</code>.   Other plans are available, currently these are: <code>P1</code>, <code>P2</code>, <code>P3</code>, <code>P4</code>, and <code>P5</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForApi 'Microsoft.Security/pricings@2023-01-01' = {\n  name: 'Api'\n  properties: {\n    subPlan: 'P1'\n    pricingTier: 'Standard'\n  }\n}\n</code></pre>","tags":["Azure.Defender.Api","AZR-000377"]},{"location":"en/rules/Azure.Defender.Api/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"<p>To enable Microsoft Defender for APIs:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for APIs.</li> </ul> <p>For example:</p> Azure CLI snippet<pre><code>az security pricing create -n Api --tier standard --subplan P1\n</code></pre>","tags":["Azure.Defender.Api","AZR-000377"]},{"location":"en/rules/Azure.Defender.Api/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"<p>To enable Microsoft Defender for APIs:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for APIs.</li> </ul> <p>For example:</p> Azure PowerShell snippet<pre><code>Set-AzSecurityPricing -Name 'Api' -PricingTier 'Standard' -SubPlan 'P1'\n</code></pre>","tags":["Azure.Defender.Api","AZR-000377"]},{"location":"en/rules/Azure.Defender.Api/#notes","title":"Notes","text":"<p>Currently only REST APIs published in Azure API Management is supported. Not all regions are supported.</p>","tags":["Azure.Defender.Api","AZR-000377"]},{"location":"en/rules/Azure.Defender.Api/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>What is Microsoft Defender for Cloud?</li> <li>Overview of Microsoft Defender for APIs</li> <li>Support and prerequisites for Defender for APIs</li> <li>Onboard Defender for APIs</li> <li>Quickstart: Enable enhanced security features</li> <li>Azure security baseline for API Management</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure Policy built-in policy definitions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Defender.Api","AZR-000377"]},{"location":"en/rules/Azure.Defender.AppServices/","title":"Configure Microsoft Defender for App Services to the Standard tier","text":"Azure.Defender.AppServicesAZR-000295Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  2022_09  \u00b7  Critical</p> <p>Enable Microsoft Defender for App Service.</p>","tags":["Azure.Defender.AppServices","AZR-000295"]},{"location":"en/rules/Azure.Defender.AppServices/#description","title":"Description","text":"<p>Many attacks are performed first by probing web applications to find and exploit weaknesses. It is crucial to secure your applications, even while running in PaaS services like App Service.</p> <p>Microsoft Defender for App Service identifies attacks over App Service thanks to cloud scale data analysis. It offers:</p> <ul> <li>Hardening capabilities for your App Services through assessments and security recommendations.</li> <li>Detection of threats at different levels such as underlying VMs, internal logs, I/O to your App Service, etc.</li> <li>Protection against common attack patterns like MITRE ATT&amp;CK or even dangling DNS.</li> </ul> <p>The solution is particularly efficient as it can can identify attack methodologies applying to multiple targets. The log data and the infrastructure together are used to enhance Defender for App Service globally.</p>","tags":["Azure.Defender.AppServices","AZR-000295"]},{"location":"en/rules/Azure.Defender.AppServices/#recommendation","title":"Recommendation","text":"<p>Consider using Microsoft Defender for App Service to protect your web apps and APIs.</p>","tags":["Azure.Defender.AppServices","AZR-000295"]},{"location":"en/rules/Azure.Defender.AppServices/#examples","title":"Examples","text":"","tags":["Azure.Defender.AppServices","AZR-000295"]},{"location":"en/rules/Azure.Defender.AppServices/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable Defender for App Service:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for App Service.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/pricings\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"AppServices\",\n  \"properties\": {\n    \"pricingTier\": \"Standard\"\n  }\n}\n</code></pre>","tags":["Azure.Defender.AppServices","AZR-000295"]},{"location":"en/rules/Azure.Defender.AppServices/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable Defender for App Service:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for App Service.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForAppServices 'Microsoft.Security/pricings@2024-01-01' = {\n  name: 'AppServices'\n  properties: {\n    pricingTier: 'Standard'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/ptn/security/security-center:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/ptn/security/security-center:0.1.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Defender.AppServices","AZR-000295"]},{"location":"en/rules/Azure.Defender.AppServices/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az security pricing create -n 'AppServices' --tier 'standard'\n</code></pre>","tags":["Azure.Defender.AppServices","AZR-000295"]},{"location":"en/rules/Azure.Defender.AppServices/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Set-AzSecurityPricing -Name 'AppServices' -PricingTier 'Standard'\n</code></pre>","tags":["Azure.Defender.AppServices","AZR-000295"]},{"location":"en/rules/Azure.Defender.AppServices/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>Securing applications and PaaS deployments</li> <li>Introduction to Microsoft Defender for App Service</li> <li>App Service security best practices</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Defender.AppServices","AZR-000295"]},{"location":"en/rules/Azure.Defender.Arm/","title":"Set Microsoft Defender for ARM to the Standard tier","text":"Azure.Defender.ArmAZR-000354Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  2023_03  \u00b7  Critical</p> <p>Enable Microsoft Defender for Azure Resource Manager (ARM).</p>","tags":["Azure.Defender.Arm","AZR-000354"]},{"location":"en/rules/Azure.Defender.Arm/#description","title":"Description","text":"<p>Microsoft Defender for ARM provides additional protection for control plane activities. It does this by detecting suspicious activities such as disabling security features or attempts at lateral movement.</p> <p>Protection is provided by analyzing telemetry from Azure Resource Manager operations. Which allows Microsoft Defender for Cloud to detect anomalous activities regardless of the tool used to perform the operation. For example: Azure CLI, Azure Portal, PowerShell, REST API, Terraform, etc.</p> <p>When anomalous activities occur, Microsoft Defender for ARM shows alerts to relevant members of your organization. These alerts include the details of the suspicious activity and recommendations on how to investigate and remediate threats.</p> <p>Microsoft Defender for ARM can be enabled at the subscription level.</p>","tags":["Azure.Defender.Arm","AZR-000354"]},{"location":"en/rules/Azure.Defender.Arm/#recommendation","title":"Recommendation","text":"<p>Consider using Microsoft Defender for Resource Manager to provide additional protection to control plane activities.</p>","tags":["Azure.Defender.Arm","AZR-000354"]},{"location":"en/rules/Azure.Defender.Arm/#examples","title":"Examples","text":"","tags":["Azure.Defender.Arm","AZR-000354"]},{"location":"en/rules/Azure.Defender.Arm/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable Microsoft Defender for Resource Manager:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Resource Manager.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/pricings\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"Arm\",\n  \"properties\": {\n    \"pricingTier\": \"Standard\"\n  }\n}\n</code></pre>","tags":["Azure.Defender.Arm","AZR-000354"]},{"location":"en/rules/Azure.Defender.Arm/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable Microsoft Defender for Resource Manager:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Resource Manager.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForArm 'Microsoft.Security/pricings@2024-01-01' = {\n  name: 'Arm'\n  properties: {\n    pricingTier: 'Standard'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/ptn/security/security-center:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/ptn/security/security-center:0.1.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Defender.Arm","AZR-000354"]},{"location":"en/rules/Azure.Defender.Arm/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"<p>To enable Microsoft Defender for Resource Manager:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Resource Manager.</li> </ul> <p>For example:</p> Azure CLI snippet<pre><code>az security pricing create -n 'Arm' --tier 'standard'\n</code></pre>","tags":["Azure.Defender.Arm","AZR-000354"]},{"location":"en/rules/Azure.Defender.Arm/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"<p>To enable Microsoft Defender for Resource Manager:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Resource Manager.</li> </ul> <p>For example:</p> Azure PowerShell snippet<pre><code>Set-AzSecurityPricing -Name 'Arm' -PricingTier 'Standard'\n</code></pre>","tags":["Azure.Defender.Arm","AZR-000354"]},{"location":"en/rules/Azure.Defender.Arm/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>What is Microsoft Defender for Cloud?</li> <li>Overview of Microsoft Defender for Resource Manager</li> <li>Quickstart: Enable enhanced security features</li> <li>Azure security baseline for Azure Resource Manager</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure Policy built-in policy definitions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Defender.Arm","AZR-000354"]},{"location":"en/rules/Azure.Defender.Containers/","title":"Set Microsoft Defender for Containers to the Standard tier","text":"Azure.Defender.ContainersAZR-000290Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  2022_09  \u00b7  Critical</p> <p>Enable Microsoft Defender for Containers.</p>","tags":["Azure.Defender.Containers","AZR-000290"]},{"location":"en/rules/Azure.Defender.Containers/#description","title":"Description","text":"<p>Container-based workloads should be carefully monitored the following three core security aspects:</p> <ul> <li>Environment hardening : continuously assess your clusters to provide visibility into misconfigurations and threats.</li> <li>Runtime threat protection : to generate security alerts for suspicious activities.</li> <li>Vulnerability assessment : for images stored in ACR registries and running in Azure Kubernetes Service.</li> </ul> <p>It is important to adopt a strategy to actively perform those three aspects. One option for doing so is to use Microsoft Defender for Containers.</p> <p>Defender for Cloud continuously assesses the configurations of your clusters. If any misconfigurations is found, it generates security recommendations. The recommendations available in the Recommendations page allow you to investigate and remediate issues.</p> <p>Defender for Containers also provides real-time threat protection for your containerized environments. If any suspicious activities is detected, Defender for Container generates an alert. Threat protection at the cluster level is provided by the Defender agent and analysis of the Kubernetes audit logs.</p> <p>Defender for Containers scans images on push, import, and recently pulled images. Recently pulled images are scanned on a regular basis when they have been pulled within the last 30 days. When scanned, the container image is pulled and executed in an isolated sandbox for scanning. Any detected vulnerabilities are reported to Microsoft Defender for Cloud.</p>","tags":["Azure.Defender.Containers","AZR-000290"]},{"location":"en/rules/Azure.Defender.Containers/#recommendation","title":"Recommendation","text":"<p>Consider using Microsoft Defender for Containers to protect your container-based workloads.</p>","tags":["Azure.Defender.Containers","AZR-000290"]},{"location":"en/rules/Azure.Defender.Containers/#examples","title":"Examples","text":"","tags":["Azure.Defender.Containers","AZR-000290"]},{"location":"en/rules/Azure.Defender.Containers/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable Microsoft Defender for Containers:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Containers.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/pricings\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"Containers\",\n  \"properties\": {\n    \"pricingTier\": \"Standard\"\n  }\n}\n</code></pre>","tags":["Azure.Defender.Containers","AZR-000290"]},{"location":"en/rules/Azure.Defender.Containers/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable Microsoft Defender for Containers:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Containers.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForContainers 'Microsoft.Security/pricings@2024-01-01' = {\n  name: 'Containers'\n  properties: {\n    pricingTier: 'Standard'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/ptn/security/security-center:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/ptn/security/security-center:0.1.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Defender.Containers","AZR-000290"]},{"location":"en/rules/Azure.Defender.Containers/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"<p>To enable Microsoft Defender for Containers:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Containers.</li> </ul> <p>For example:</p> Azure CLI snippet<pre><code>az security pricing create -n 'Containers' --tier 'standard'\n</code></pre>","tags":["Azure.Defender.Containers","AZR-000290"]},{"location":"en/rules/Azure.Defender.Containers/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"<p>To enable Microsoft Defender for Containers:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Containers.</li> </ul> <p>For example:</p> Azure PowerShell snippet<pre><code>Set-AzSecurityPricing -Name 'Containers' -PricingTier 'Standard'\n</code></pre>","tags":["Azure.Defender.Containers","AZR-000290"]},{"location":"en/rules/Azure.Defender.Containers/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>Introduction to Microsoft Defender for Containers</li> <li>Secure the images and run time</li> <li>Azure security baseline for Container Registry</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure Policy built-in policy definitions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Defender.Containers","AZR-000290"]},{"location":"en/rules/Azure.Defender.CosmosDb/","title":"Set Microsoft Defender for Cosmos DB to the Standard tier","text":"Azure.Defender.CosmosDbAZR-000379Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  2023_06  \u00b7  Critical</p> <p>Enable Microsoft Defender for Azure Cosmos DB.</p>","tags":["Azure.Defender.CosmosDb","AZR-000379"]},{"location":"en/rules/Azure.Defender.CosmosDb/#description","title":"Description","text":"<p>Microsoft Defender for Azure Cosmos DB provides additional security insight for Azure Cosmos DB accounts.</p> <p>Protection is provided by analyzing onboarded Cosmos DB accounts for unusual and potentially harmful attempts to access or exploit the accounts. Which allows Microsoft Defender for Cloud to produce security alerts that are triggered when anomalies in activity occur.</p> <p>Security alerts for onboarded Cosmos DB accounts shows up in Defender for Cloud with details of the suspicious activity and recommendations on how to investigate and remediate the threats.</p> <p>Microsoft Defender for Cosmos DB can be enabled at the subscription level and by doing so ensures all Cosmos DB accounts in the subscription will be protected, including future ones.</p>","tags":["Azure.Defender.CosmosDb","AZR-000379"]},{"location":"en/rules/Azure.Defender.CosmosDb/#recommendation","title":"Recommendation","text":"<p>Consider using Microsoft Defender for Azure Cosmos DB to provide additional security insights for Azure Cosmos DB accounts.</p>","tags":["Azure.Defender.CosmosDb","AZR-000379"]},{"location":"en/rules/Azure.Defender.CosmosDb/#examples","title":"Examples","text":"","tags":["Azure.Defender.CosmosDb","AZR-000379"]},{"location":"en/rules/Azure.Defender.CosmosDb/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable Microsoft Defender for Azure Cosmos DB accounts:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Azure Cosmos DB.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/pricings\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"CosmosDbs\",\n  \"properties\": {\n    \"pricingTier\": \"Standard\"\n  }\n}\n</code></pre>","tags":["Azure.Defender.CosmosDb","AZR-000379"]},{"location":"en/rules/Azure.Defender.CosmosDb/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable Microsoft Defender for Azure Cosmos DB accounts:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Azure Cosmos DB.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForCosmosDbs 'Microsoft.Security/pricings@2024-01-01' = {\n  name: 'CosmosDbs'\n  properties: {\n    pricingTier: 'Standard'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/ptn/security/security-center:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/ptn/security/security-center:0.1.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Defender.CosmosDb","AZR-000379"]},{"location":"en/rules/Azure.Defender.CosmosDb/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"<p>To enable Microsoft Defender for Azure Cosmos DB accounts:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Azure Cosmos DB.</li> </ul> <p>For example:</p> Azure CLI snippet<pre><code>az security pricing create -n 'CosmosDbs' --tier 'standard'\n</code></pre>","tags":["Azure.Defender.CosmosDb","AZR-000379"]},{"location":"en/rules/Azure.Defender.CosmosDb/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"<p>To enable Microsoft Defender for Azure Cosmos DB accounts:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Azure Cosmos DB.</li> </ul> <p>For example:</p> Azure PowerShell snippet<pre><code>Set-AzSecurityPricing -Name 'CosmosDbs' -PricingTier 'Standard'\n</code></pre>","tags":["Azure.Defender.CosmosDb","AZR-000379"]},{"location":"en/rules/Azure.Defender.CosmosDb/#notes","title":"Notes","text":"<p>Microsoft Defender for Azure Cosmos DB is currently available only for the NoSQL API.</p>","tags":["Azure.Defender.CosmosDb","AZR-000379"]},{"location":"en/rules/Azure.Defender.CosmosDb/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>What is Microsoft Defender for Cloud?</li> <li>Overview of Microsoft Defender for Azure Cosmos DB</li> <li>Enable Microsoft Defender for Azure Cosmos DB</li> <li>Quickstart: Enable enhanced security features</li> <li>Azure security baseline for Azure Cosmos DB</li> <li>DP-2: Monitor anomalies and threats targeting sensitive data</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure Policy built-in policy definitions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Defender.CosmosDb","AZR-000379"]},{"location":"en/rules/Azure.Defender.Cspm/","title":"Set Microsoft Defender Cloud Security Posture Management to the Standard plan","text":"Azure.Defender.CspmAZR-000372Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  2023_06  \u00b7  Critical</p> <p>Enable Microsoft Defender Cloud Security Posture Management Standard plan.</p>","tags":["Azure.Defender.Cspm","AZR-000372"]},{"location":"en/rules/Azure.Defender.Cspm/#description","title":"Description","text":"<p>Microsoft Defender Cloud Security Posture Management (CSPM) provides additional visibility across cloud environments to quickly detect configuration errors and remediate them through automation. It does this by keeping constant eye on the security state of your cloud resources in different environments.</p> <p>By enabling the Defender Cloud CSPM Standard plan, Microsoft Defender provides advanced posture management capabilities such as:</p> <ul> <li>Attack path analysis</li> <li>Cloud security explorer</li> <li>Advanced threat hunting</li> <li>Security governance capabilities</li> <li>Tools to assess your security compliance with a wide range of benchmarks, regulatory standards, and any custom security policies required in your organization, industry, or region</li> </ul> <p>Microsoft Defender Cloud Security Posture Management (CSPM) can be enabled at the subscription level.</p>","tags":["Azure.Defender.Cspm","AZR-000372"]},{"location":"en/rules/Azure.Defender.Cspm/#recommendation","title":"Recommendation","text":"<p>Consider using Microsoft Defender Cloud Security Posture Management (CSPM) Standard plan to provide additional visibility across cloud environments.</p>","tags":["Azure.Defender.Cspm","AZR-000372"]},{"location":"en/rules/Azure.Defender.Cspm/#examples","title":"Examples","text":"","tags":["Azure.Defender.Cspm","AZR-000372"]},{"location":"en/rules/Azure.Defender.Cspm/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable Microsoft Defender Cloud Security Posture Management Standard plan:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender Cloud Security Posture Management.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/pricings\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"CloudPosture\",\n  \"properties\": {\n    \"pricingTier\": \"Standard\"\n  }\n}\n</code></pre>","tags":["Azure.Defender.Cspm","AZR-000372"]},{"location":"en/rules/Azure.Defender.Cspm/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable Microsoft Defender Cloud Security Posture Management Standard plan:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender Cloud Security Posture Management.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForCloudPosture 'Microsoft.Security/pricings@2024-01-01' = {\n  name: 'CloudPosture'\n  properties: {\n    pricingTier: 'Standard'\n  }\n}\n</code></pre>","tags":["Azure.Defender.Cspm","AZR-000372"]},{"location":"en/rules/Azure.Defender.Cspm/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"<p>TTo enable Microsoft Defender Cloud Security Posture Management Standard plan:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender Cloud Security Posture Management.</li> </ul> <p>For example:</p> Azure CLI snippet<pre><code>az security pricing create -n 'CloudPosture' --tier 'standard'\n</code></pre>","tags":["Azure.Defender.Cspm","AZR-000372"]},{"location":"en/rules/Azure.Defender.Cspm/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"<p>To enable Microsoft Defender Cloud Security Posture Management Standard plan:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender Cloud Security Posture Management.</li> </ul> <p>For example:</p> Azure PowerShell snippet<pre><code>Set-AzSecurityPricing -Name 'CloudPosture' -PricingTier 'Standard'\n</code></pre>","tags":["Azure.Defender.Cspm","AZR-000372"]},{"location":"en/rules/Azure.Defender.Cspm/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>What is Microsoft Defender for Cloud?</li> <li>Cloud Security Posture Management (CSPM)</li> <li>Quickstart: Enable enhanced security features</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure Policy built-in policy definitions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Defender.Cspm","AZR-000372"]},{"location":"en/rules/Azure.Defender.Dns/","title":"Set Microsoft Defender for DNS to the Standard tier","text":"Azure.Defender.DnsAZR-000353Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  2023_03  \u00b7  Critical</p> <p>Enable Microsoft Defender for DNS.</p>","tags":["Azure.Defender.Dns","AZR-000353"]},{"location":"en/rules/Azure.Defender.Dns/#description","title":"Description","text":"<p>Microsoft Defender for DNS provides additional protection for virtual networks and resources. It does this by monitoring Azure-provided DNS for suspicious and anomalous activity. By analyzing telemetry for DNS, Microsoft Defender for DNS can detect and alert on persistent threats such as:</p> <ul> <li>Data exfiltration from your Azure resources using DNS tunneling.</li> <li>Malware communicating with command and control servers.</li> <li>DNS attacks - communication with malicious DNS resolvers.</li> <li>Communication with domains used for malicious activities such as phishing and crypto mining.</li> </ul> <p>Microsoft Defender for DNS can be enabled at the subscription level.</p>","tags":["Azure.Defender.Dns","AZR-000353"]},{"location":"en/rules/Azure.Defender.Dns/#recommendation","title":"Recommendation","text":"<p>Consider using Microsoft Defender for DNS to provide additional protection to virtual network and resources.</p>","tags":["Azure.Defender.Dns","AZR-000353"]},{"location":"en/rules/Azure.Defender.Dns/#examples","title":"Examples","text":"","tags":["Azure.Defender.Dns","AZR-000353"]},{"location":"en/rules/Azure.Defender.Dns/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable Microsoft Defender for DNS:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for DNS.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Security/pricings\",\n    \"apiVersion\": \"2022-03-01\",\n    \"name\": \"Dns\",\n    \"properties\": {\n        \"pricingTier\": \"Standard\"\n    }\n}\n</code></pre>","tags":["Azure.Defender.Dns","AZR-000353"]},{"location":"en/rules/Azure.Defender.Dns/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable Microsoft Defender for DNS:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for DNS.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForDns 'Microsoft.Security/pricings@2022-03-01' = {\n  name: 'Dns'\n  properties: {\n    pricingTier: 'Standard'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/ptn/security/security-center:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/ptn/security/security-center:0.1.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Defender.Dns","AZR-000353"]},{"location":"en/rules/Azure.Defender.Dns/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"<p>To enable Microsoft Defender for DNS:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for DNS.</li> </ul> <p>For example:</p> Azure CLI snippet<pre><code>az security pricing create -n 'Dns' --tier 'standard'\n</code></pre>","tags":["Azure.Defender.Dns","AZR-000353"]},{"location":"en/rules/Azure.Defender.Dns/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"<p>To enable Microsoft Defender for DNS:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for DNS.</li> </ul> <p>For example:</p> Azure PowerShell snippet<pre><code>Set-AzSecurityPricing -Name 'Dns' -PricingTier 'Standard'\n</code></pre>","tags":["Azure.Defender.Dns","AZR-000353"]},{"location":"en/rules/Azure.Defender.Dns/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>What is Microsoft Defender for Cloud?</li> <li>Overview of Microsoft Defender for DNS</li> <li>Quickstart: Enable enhanced security features</li> <li>Azure security baseline for Azure DNS</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure Policy built-in policy definitions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Defender.Dns","AZR-000353"]},{"location":"en/rules/Azure.Defender.KeyVault/","title":"Set Microsoft Defender for Key Vault to the Standard tier","text":"Azure.Defender.KeyVaultAZR-000352Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  2023_03  \u00b7  Critical</p> <p>Enable Microsoft Defender for Key Vault.</p>","tags":["Azure.Defender.KeyVault","AZR-000352"]},{"location":"en/rules/Azure.Defender.KeyVault/#description","title":"Description","text":"<p>Microsoft Defender for Key Vault provides additional protection for keys and secrets stored in Key Vaults. It does this by detecting unusual and potentially harmful attempts to access or exploit Key Vault accounts. This protection is provided by analyzing telemetry from Key Vault and Microsoft Defender for Cloud.</p> <p>When anomalous activities occur, Defender for Key Vault shows alerts to relevant members of your organization. These alerts include the details of the suspicious activity and recommendations on how to investigate and remediate threats.</p> <p>Microsoft Defender for Key Vault can be enabled at the subscription level for all Key Vaults in the subscription. Azure Policy can be used to automatically enable Microsoft Defender for Key Vault a subscription.</p>","tags":["Azure.Defender.KeyVault","AZR-000352"]},{"location":"en/rules/Azure.Defender.KeyVault/#recommendation","title":"Recommendation","text":"<p>Consider using Microsoft Defender for Key Vault to provide additional protection to Key Vaults.</p>","tags":["Azure.Defender.KeyVault","AZR-000352"]},{"location":"en/rules/Azure.Defender.KeyVault/#examples","title":"Examples","text":"","tags":["Azure.Defender.KeyVault","AZR-000352"]},{"location":"en/rules/Azure.Defender.KeyVault/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable Microsoft Defender for Key Vault:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Key Vault.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/pricings\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"KeyVaults\",\n  \"properties\": {\n    \"pricingTier\": \"Standard\"\n  }\n}\n</code></pre>","tags":["Azure.Defender.KeyVault","AZR-000352"]},{"location":"en/rules/Azure.Defender.KeyVault/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable Microsoft Defender for Key Vault:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Key Vault.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForKeyVaults 'Microsoft.Security/pricings@2024-01-01' = {\n  name: 'KeyVaults'\n  properties: {\n    pricingTier: 'Standard'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/ptn/security/security-center:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/ptn/security/security-center:0.1.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Defender.KeyVault","AZR-000352"]},{"location":"en/rules/Azure.Defender.KeyVault/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"<p>To enable Microsoft Defender for Key Vault:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Key Vault.</li> </ul> <p>For example:</p> Azure CLI snippet<pre><code>az security pricing create -n 'KeyVaults' --tier 'standard'\n</code></pre>","tags":["Azure.Defender.KeyVault","AZR-000352"]},{"location":"en/rules/Azure.Defender.KeyVault/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"<p>To enable Microsoft Defender for Key Vault:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Key Vault.</li> </ul> <p>For example:</p> Azure PowerShell snippet<pre><code>Set-AzSecurityPricing -Name 'KeyVaults' -PricingTier 'Standard'\n</code></pre>","tags":["Azure.Defender.KeyVault","AZR-000352"]},{"location":"en/rules/Azure.Defender.KeyVault/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>What is Microsoft Defender for Cloud?</li> <li>Overview of Microsoft Defender for Key Vault</li> <li>Quickstart: Enable enhanced security features</li> <li>Azure security baseline for Key Vault</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure Policy built-in policy definitions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Defender.KeyVault","AZR-000352"]},{"location":"en/rules/Azure.Defender.OssRdb/","title":"Set Microsoft Defender for open-source relational databases to the Standard tier","text":"Azure.Defender.OssRdbAZR-000381Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  2023_06  \u00b7  Critical</p> <p>Enable Microsoft Defender for open-source relational databases.</p>","tags":["Azure.Defender.OssRdb","AZR-000381"]},{"location":"en/rules/Azure.Defender.OssRdb/#description","title":"Description","text":"<p>Microsoft Defender for open-source relational databases provides additional security for open-source relational databases.</p> <p>The following open-source relational databases are supported:</p> <ul> <li>Azure Database for PostgreSQL</li> <li>Azure Database for MySQL</li> <li>Azure Database for MariaDB</li> </ul> <p>Protection is provided by analyzing onboarded databases for unusual and potentially harmful attempts to access or exploit databases. Which allows Microsoft Defender for Cloud to produce security alerts that are triggered when anomalies in activity occur.</p> <p>Security alerts for onboarded databases shows up in Defender for Cloud with details of the suspicious activity and recommendations on how to investigate and remediate the threats.</p> <p>Microsoft Defender for open-source relational databases can be enabled at the subscription level and by doing so ensures all supported databases in the subscription will be protected, including future ones.</p>","tags":["Azure.Defender.OssRdb","AZR-000381"]},{"location":"en/rules/Azure.Defender.OssRdb/#recommendation","title":"Recommendation","text":"<p>Consider using Microsoft Defender for for open-source relational databases to provide additional security for open-source relational databases.</p>","tags":["Azure.Defender.OssRdb","AZR-000381"]},{"location":"en/rules/Azure.Defender.OssRdb/#examples","title":"Examples","text":"","tags":["Azure.Defender.OssRdb","AZR-000381"]},{"location":"en/rules/Azure.Defender.OssRdb/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable Microsoft Defender for open-source relational databases:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for open-source relational databases.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/pricings\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"OpenSourceRelationalDatabases\",\n  \"properties\": {\n    \"pricingTier\": \"Standard\"\n  }\n}\n</code></pre>","tags":["Azure.Defender.OssRdb","AZR-000381"]},{"location":"en/rules/Azure.Defender.OssRdb/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable Microsoft Defender for open-source relational databases:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for open-source relational databases.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForOssRdb 'Microsoft.Security/pricings@2024-01-01' = {\n  name: 'OpenSourceRelationalDatabases'\n  properties: {\n    pricingTier: 'Standard'\n  }\n}\n</code></pre>","tags":["Azure.Defender.OssRdb","AZR-000381"]},{"location":"en/rules/Azure.Defender.OssRdb/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"<p>To enable Microsoft Defender for open-source relational databases:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for open-source relational databases.</li> </ul> <p>For example:</p> Azure CLI snippet<pre><code>az security pricing create -n 'OpenSourceRelationalDatabases' --tier 'standard'\n</code></pre>","tags":["Azure.Defender.OssRdb","AZR-000381"]},{"location":"en/rules/Azure.Defender.OssRdb/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"<p>To enable Microsoft Defender for open-source relational databases:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for open-source relational databases.</li> </ul> <p>For example:</p> Azure PowerShell snippet<pre><code>Set-AzSecurityPricing -Name 'OpenSourceRelationalDatabases' -PricingTier 'Standard'\n</code></pre>","tags":["Azure.Defender.OssRdb","AZR-000381"]},{"location":"en/rules/Azure.Defender.OssRdb/#notes","title":"Notes","text":"<p>Microsoft Defender for open-source relational databases is currently available only for the single server deployment model for PostgreSQL and the single server deployment model for MySQL. For PostgreSQL, MySQL and MariaDB <code>General Purpose</code> and <code>Memory Optimized</code> tiers are required in order to be protected.</p>","tags":["Azure.Defender.OssRdb","AZR-000381"]},{"location":"en/rules/Azure.Defender.OssRdb/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>What is Microsoft Defender for Cloud?</li> <li>Overview of Microsoft Defender for open-source relational databases</li> <li>Enable Defender for OSS RDBs</li> <li>Quickstart: Enable enhanced security features</li> <li>Azure security baseline for Azure Database for PostgreSQL - Single Server</li> <li>Azure security baseline for Azure Database for MySQL - Single Server</li> <li>Azure security baseline for Azure Database for MariaDB</li> <li>Azure Policy built-in policy definitions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Defender.OssRdb","AZR-000381"]},{"location":"en/rules/Azure.Defender.SQL/","title":"Configure Microsoft Defender for SQL to the Standard tier","text":"Azure.Defender.SQLAZR-000294Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  2022_09  \u00b7  Critical</p> <p>Enable Microsoft Defender for SQL servers.</p>","tags":["Azure.Defender.SQL","AZR-000294"]},{"location":"en/rules/Azure.Defender.SQL/#description","title":"Description","text":"<p>SQL databases are used to store critical and strategic assets for your company and should be carefully secured. Microsoft Defender for SQL represents a single go-to location to manage security capabilities.</p> <p>Enabling Defender for SQL automatically enables the following advanced SQL security capabilities:</p> <ul> <li>Vulnerability Assessment: discover, track, and provide guidance to remediate potential database vulnerabilities.</li> <li>Advanced Threat Protection: continuous monitoring of your databases, detection of suspect activities and more.</li> </ul> <p>When enable at subscription level, all databases in Azure SQL Database and Azure SQL Managed Instance are protected.</p>","tags":["Azure.Defender.SQL","AZR-000294"]},{"location":"en/rules/Azure.Defender.SQL/#recommendation","title":"Recommendation","text":"<p>Consider using Microsoft Defender for SQL to protect your SQL databases.</p>","tags":["Azure.Defender.SQL","AZR-000294"]},{"location":"en/rules/Azure.Defender.SQL/#examples","title":"Examples","text":"","tags":["Azure.Defender.SQL","AZR-000294"]},{"location":"en/rules/Azure.Defender.SQL/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable Microsoft Defender for SQL:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for SQL.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/pricings\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"SqlServers\",\n  \"properties\": {\n    \"pricingTier\": \"Standard\"\n  }\n}\n</code></pre>","tags":["Azure.Defender.SQL","AZR-000294"]},{"location":"en/rules/Azure.Defender.SQL/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable Microsoft Defender for SQL:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for SQL.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForSQL 'Microsoft.Security/pricings@2024-01-01' = {\n  name: 'SqlServers'\n  properties: {\n    pricingTier: 'Standard'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/ptn/security/security-center:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/ptn/security/security-center:0.1.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Defender.SQL","AZR-000294"]},{"location":"en/rules/Azure.Defender.SQL/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"<p>To enable Microsoft Defender for SQL:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for SQL.</li> </ul> <p>For example:</p> Azure CLI snippet<pre><code>az security pricing create -n 'SqlServers' --tier 'standard'\n</code></pre>","tags":["Azure.Defender.SQL","AZR-000294"]},{"location":"en/rules/Azure.Defender.SQL/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"<p>To enable Microsoft Defender for SQL:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for SQL.</li> </ul> <p>For example:</p> Azure PowerShell snippet<pre><code>Set-AzSecurityPricing -Name 'SqlServers' -PricingTier 'Standard'\n</code></pre>","tags":["Azure.Defender.SQL","AZR-000294"]},{"location":"en/rules/Azure.Defender.SQL/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>Azure SQL Database and security</li> <li>Introduction to Microsoft Defender for SQL</li> <li>Azure security baseline for Azure SQL</li> <li>DP-2: Monitor anomalies and threats targeting sensitive data</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure Policy built-in policy definitions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Defender.SQL","AZR-000294"]},{"location":"en/rules/Azure.Defender.SQLOnVM/","title":"Configure Microsoft Defender for SQL Servers on machines to the Standard tier","text":"Azure.Defender.SQLOnVMAZR-000297Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  2022_09  \u00b7  Critical</p> <p>Enable Microsoft Defender for SQL servers on machines.</p>","tags":["Azure.Defender.SQLOnVM","AZR-000297"]},{"location":"en/rules/Azure.Defender.SQLOnVM/#description","title":"Description","text":"<p>SQL databases are used to store critical and strategic assets for your company and should be carefully secured. Microsoft Defender for SQL Servers on machines represents a single go-to location to manage security capabilities.</p> <p>Enabling Defender for SQL automatically enables vulnerability Assessment for your SQL databases hosted in a VM. It discovers, tracks, and provides guidance to remediate potential database vulnerabilities.</p> <p>Enabling at subscription level doesn't protect all your SQL servers. A Log Analytics agent must be deployed on the machine and the Log Analytics workspace must have Defender for SQL enabled.</p>","tags":["Azure.Defender.SQLOnVM","AZR-000297"]},{"location":"en/rules/Azure.Defender.SQLOnVM/#recommendation","title":"Recommendation","text":"<p>Consider using Microsoft Defender for SQL Servers on machines to protect your SQL servers running on VMs.</p>","tags":["Azure.Defender.SQLOnVM","AZR-000297"]},{"location":"en/rules/Azure.Defender.SQLOnVM/#examples","title":"Examples","text":"","tags":["Azure.Defender.SQLOnVM","AZR-000297"]},{"location":"en/rules/Azure.Defender.SQLOnVM/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable Defender for SQL servers on machines:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for SQL servers on machines.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/pricings\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"SqlServerVirtualMachines\",\n  \"properties\": {\n    \"pricingTier\": \"Standard\"\n  }\n}\n</code></pre>","tags":["Azure.Defender.SQLOnVM","AZR-000297"]},{"location":"en/rules/Azure.Defender.SQLOnVM/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable Defender for SQL servers on machines:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for SQL servers on machines.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForSQLOnVM 'Microsoft.Security/pricings@2024-01-01' = {\n  name: 'SqlServerVirtualMachines'\n  properties: {\n    pricingTier: 'Standard'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/ptn/security/security-center:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/ptn/security/security-center:0.1.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Defender.SQLOnVM","AZR-000297"]},{"location":"en/rules/Azure.Defender.SQLOnVM/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az security pricing create -n 'SqlServerVirtualMachines' --tier 'standard'\n</code></pre>","tags":["Azure.Defender.SQLOnVM","AZR-000297"]},{"location":"en/rules/Azure.Defender.SQLOnVM/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Set-AzSecurityPricing -Name 'SqlServerVirtualMachines' -PricingTier 'Standard'\n</code></pre>","tags":["Azure.Defender.SQLOnVM","AZR-000297"]},{"location":"en/rules/Azure.Defender.SQLOnVM/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>Introduction to Microsoft Defender for SQL Servers on machines</li> <li>Security considerations for SQL Server on Azure Virtual Machines</li> <li>Azure Security Benchmark - Data protection</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Defender.SQLOnVM","AZR-000297"]},{"location":"en/rules/Azure.Defender.SecurityContact/","title":"Defender for Cloud notification contact not set","text":"Azure.Defender.SecurityContactAZR-000209Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  2024_12  \u00b7  Important</p> <p>Important security notifications may be lost or not processed in a timely manner when a clear security contact is not identified.</p>","tags":["Azure.Defender.SecurityContact","AZR-000209"]},{"location":"en/rules/Azure.Defender.SecurityContact/#description","title":"Description","text":"<p>Microsoft Defender for Cloud allows one or more email addresses to be specified for receiving security alerts. This is in addition to subscription owners or other configured role.</p> <p>Directing security notifications to the correct party enables triage and response to security incidents in a timely manner.</p>","tags":["Azure.Defender.SecurityContact","AZR-000209"]},{"location":"en/rules/Azure.Defender.SecurityContact/#recommendation","title":"Recommendation","text":"<p>Consider configuring a security notification email address to assist timely notification and incident response.</p>","tags":["Azure.Defender.SecurityContact","AZR-000209"]},{"location":"en/rules/Azure.Defender.SecurityContact/#examples","title":"Examples","text":"","tags":["Azure.Defender.SecurityContact","AZR-000209"]},{"location":"en/rules/Azure.Defender.SecurityContact/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy subscriptions that pass this rule:</p> <ul> <li>Set the <code>properties.emails</code> property to an email address for security incident response.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/securityContacts\",\n  \"apiVersion\": \"2023-12-01-preview\",\n  \"name\": \"default\",\n  \"properties\": {\n    \"isEnabled\": true,\n    \"notificationsByRole\": {\n      \"roles\": [\n        \"Owner\"\n      ],\n      \"state\": \"On\"\n    },\n    \"emails\": \"security@contoso.com\",\n    \"notificationsSources\": [\n      {\n        \"sourceType\": \"Alert\",\n        \"minimalSeverity\": \"High\"\n      },\n      {\n        \"sourceType\": \"AttackPath\",\n        \"minimalRiskLevel\": \"High\"\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.Defender.SecurityContact","AZR-000209"]},{"location":"en/rules/Azure.Defender.SecurityContact/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy subscriptions that pass this rule:</p> <ul> <li>Set the <code>properties.emails</code> property to an email address for security incident response.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource securityContact 'Microsoft.Security/securityContacts@2023-12-01-preview' = {\n  name: 'default'\n  properties: {\n    isEnabled: true\n    notificationsByRole: {\n      roles: [\n        'Owner'\n      ]\n      state: 'On'\n    }\n    emails: 'security@contoso.com'\n    notificationsSources: [\n      {\n        sourceType: 'Alert'\n        minimalSeverity: 'High'\n      }\n      {\n        sourceType: 'AttackPath'\n        minimalRiskLevel: 'High'\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.Defender.SecurityContact","AZR-000209"]},{"location":"en/rules/Azure.Defender.SecurityContact/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az security contact update -n 'default' --emails 'security@contoso.com'\n</code></pre>","tags":["Azure.Defender.SecurityContact","AZR-000209"]},{"location":"en/rules/Azure.Defender.SecurityContact/#links","title":"Links","text":"<ul> <li>SE:12 Incident response</li> <li>Quickstart: Configure email notifications for security alerts</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Defender.SecurityContact","AZR-000209"]},{"location":"en/rules/Azure.Defender.Servers/","title":"Configure Microsoft Defender for Servers to the Standard tier and P2","text":"Azure.Defender.ServersAZR-000293Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  2022_09  \u00b7  Critical</p> <p>Enable Microsoft Defender for Servers.</p>","tags":["Azure.Defender.Servers","AZR-000293"]},{"location":"en/rules/Azure.Defender.Servers/#description","title":"Description","text":"<p>Microsoft Defender for Servers automatically deploys an agent into your Windows and Linux machines to protect them.</p> <p>With the unified integration of Microsoft Defender for Endpoint (MDE) you benefit from features like:</p> <ul> <li>Threat and vulnerability management : to discover vulnerabilities and misconfigurations in real time</li> <li>Security Policy and Regulatory Compliance integration</li> <li>Qualys integration for real time identification of vulnerabilities without any license needed</li> <li>Threat detection at OS level, network layer and control plane</li> <li>Just-in-time (JIT) access : to reduce your machine's surface attack</li> <li>And more.</li> </ul>","tags":["Azure.Defender.Servers","AZR-000293"]},{"location":"en/rules/Azure.Defender.Servers/#recommendation","title":"Recommendation","text":"<p>Consider using Microsoft Defender for Servers P2 to protect your virtual machines.</p>","tags":["Azure.Defender.Servers","AZR-000293"]},{"location":"en/rules/Azure.Defender.Servers/#examples","title":"Examples","text":"","tags":["Azure.Defender.Servers","AZR-000293"]},{"location":"en/rules/Azure.Defender.Servers/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable Defender for Servers:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Servers and set the <code>P2</code> sub plan.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/pricings\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"VirtualMachines\",\n  \"properties\": {\n    \"pricingTier\": \"Standard\",\n    \"subPlan\": \"P2\"\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/ptn/security/security-center:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/ptn/security/security-center:0.1.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Defender.Servers","AZR-000293"]},{"location":"en/rules/Azure.Defender.Servers/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable Defender for Servers:</p> <ul> <li>Set the <code>Standard</code> pricing tier for Microsoft Defender for Servers and set the <code>P2</code> sub plan.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForServers 'Microsoft.Security/pricings@2024-01-01' = {\n  name: 'VirtualMachines'\n  properties: {\n    pricingTier: 'Standard',\n    subPlan: 'P2'\n  }\n}\n</code></pre>","tags":["Azure.Defender.Servers","AZR-000293"]},{"location":"en/rules/Azure.Defender.Servers/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az security pricing create -n 'VirtualMachines' --tier 'standard'\n</code></pre>","tags":["Azure.Defender.Servers","AZR-000293"]},{"location":"en/rules/Azure.Defender.Servers/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Set-AzSecurityPricing -Name 'VirtualMachines' -PricingTier 'Standard'\n</code></pre>","tags":["Azure.Defender.Servers","AZR-000293"]},{"location":"en/rules/Azure.Defender.Servers/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>Introduction to Microsoft Defender for Containers</li> <li>Azure Monitor agent auto-provisioning</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Defender.Servers","AZR-000293"]},{"location":"en/rules/Azure.Defender.Storage.DataScan/","title":"Sensitive data threat detection","text":"Azure.Defender.Storage.DataScanAZR-000385Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  Preview  \u00b7  2023_06  \u00b7  Critical</p> <p>Enable sensitive data threat detection in Microsoft Defender for Storage.</p>","tags":["Azure.Defender.Storage.DataScan","AZR-000385"]},{"location":"en/rules/Azure.Defender.Storage.DataScan/#description","title":"Description","text":"<p>Sensitive data threat detection is an additional security feature for Microsoft Defender for Storage. When enabled Defender for Storage provides alerts when sensitive data is discovered.</p> <p>The sensitive data threat detection capability helps teams:</p> <ul> <li>Identity where sensitive data is stored.</li> <li>Detect possible security incidents resulting is data exposure.</li> </ul> <p>When enabling sensitive data threat detection, the sensitive data categories include built-in sensitive information types (SITs) in the default list of Microsoft Purview. It is possible to customize the Data Sensitivity Discovery for a organization, by creating custom sensitive information types (SITs).</p> <p>Sensitive data threat detection in Microsoft Defender for Storage can be enabled at the subscription level and by doing so ensures all storage accounts in the subscription will be protected, including future ones.</p>","tags":["Azure.Defender.Storage.DataScan","AZR-000385"]},{"location":"en/rules/Azure.Defender.Storage.DataScan/#recommendation","title":"Recommendation","text":"<p>Consider using sensitive data threat detection in Microsoft Defender for Storage for all storage accounts in the subscription.</p>","tags":["Azure.Defender.Storage.DataScan","AZR-000385"]},{"location":"en/rules/Azure.Defender.Storage.DataScan/#examples","title":"Examples","text":"","tags":["Azure.Defender.Storage.DataScan","AZR-000385"]},{"location":"en/rules/Azure.Defender.Storage.DataScan/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable sensitive data threat detection in Microsoft Defender for Storage:</p> <ul> <li>Set the <code>properties.pricingTier</code> property to <code>Standard</code>.</li> <li>Set the <code>properties.subPlan</code> property to <code>DefenderForStorageV2</code>.</li> <li>Configure settings for the <code>SensitiveDataDiscovery</code> extension.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/pricings\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"StorageAccounts\",\n  \"properties\": {\n    \"pricingTier\": \"Standard\",\n    \"subPlan\": \"DefenderForStorageV2\",\n    \"extensions\": [\n      {\n        \"name\": \"OnUploadMalwareScanning\",\n        \"isEnabled\": \"True\",\n        \"additionalExtensionProperties\": {\n          \"CapGBPerMonthPerStorageAccount\": \"5000\"\n        }\n      },\n      {\n        \"name\": \"SensitiveDataDiscovery\",\n        \"isEnabled\": \"True\"\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.Defender.Storage.DataScan","AZR-000385"]},{"location":"en/rules/Azure.Defender.Storage.DataScan/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable sensitive data threat detection in Microsoft Defender for Storage:</p> <ul> <li>Set the <code>properties.pricingTier</code> property to <code>Standard</code>.</li> <li>Set the <code>properties.subPlan</code> property to <code>DefenderForStorageV2</code>.</li> <li>Configure settings for the <code>SensitiveDataDiscovery</code> extension.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForStorage 'Microsoft.Security/pricings@2024-01-01' = {\n  name: 'StorageAccounts'\n  properties: {\n    pricingTier: 'Standard'\n    subPlan: 'DefenderForStorageV2'\n    extensions: [\n      {\n        name: 'OnUploadMalwareScanning'\n        isEnabled: 'True'\n        additionalExtensionProperties: {\n          CapGBPerMonthPerStorageAccount: '5000'\n        }\n      }\n      {\n        name: 'SensitiveDataDiscovery'\n        isEnabled: 'True'\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.Defender.Storage.DataScan","AZR-000385"]},{"location":"en/rules/Azure.Defender.Storage.DataScan/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Microsoft Defender for Storage should be enabled <code>/providers/Microsoft.Authorization/policyDefinitions/640d2586-54d2-465f-877f-9ffc1d2109f4</code></li> <li>Configure Microsoft Defender for Storage to be enabled <code>/providers/Microsoft.Authorization/policyDefinitions/cfdc5972-75b3-4418-8ae1-7f5c36839390</code></li> </ul>","tags":["Azure.Defender.Storage.DataScan","AZR-000385"]},{"location":"en/rules/Azure.Defender.Storage.DataScan/#notes","title":"Notes","text":"<p>This feature is currently in preview.</p> <p>Sensitive data threat detection is only available in the <code>DefenderForStorageV2</code> sub plan for Defender for Storage, which offers new features that aren't included in the classic plan.</p> <p>Not all services and blob types within storage accounts are currently supported. See limitations for more information.</p>","tags":["Azure.Defender.Storage.DataScan","AZR-000385"]},{"location":"en/rules/Azure.Defender.Storage.DataScan/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>What is Microsoft Defender for Cloud?</li> <li>Sensitive data threat detection in Defender for Storage</li> <li>Support and prerequisites for data-aware security posture</li> <li>Overview of Microsoft Defender for Storage</li> <li>Enable and configure Microsoft Defender for Storage</li> <li>Quickstart: Enable enhanced security features</li> <li>Azure security baseline for Storage</li> <li>DP-2: Monitor anomalies and threats targeting sensitive data</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure Policy built-in policy definitions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Defender.Storage.DataScan","AZR-000385"]},{"location":"en/rules/Azure.Defender.Storage.MalwareScan/","title":"Malware Scanning","text":"Azure.Defender.Storage.MalwareScanAZR-000383Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  2024_03  \u00b7  Critical</p> <p>Enable Malware Scanning in Microsoft Defender for Storage.</p>","tags":["Azure.Defender.Storage.MalwareScan","AZR-000383"]},{"location":"en/rules/Azure.Defender.Storage.MalwareScan/#description","title":"Description","text":"<p>Microsoft Defender for Storage provides additional security for storage accounts. One of the features in the Defender for Storage service is malware scanning that is powered by Microsoft Defender Antivirus.</p> <p>Content uploaded to cloud storage could be malware. Storage accounts can be an entry point and distribution point for malware in the organization. To protect organizations from this threat, content in cloud storage must be scanned for malware before it's accessed.</p> <p>Malware scanning in Defender for Storage helps protect storage accounts from malicious content by, performing a malware scan on uploaded content in near real time. When the malware scan identifies a malicious file, detailed Microsoft Defenders for Cloud security alerts are generated.</p> <p>Malware Scanning in Microsoft Defender for Storage can be enabled at the subscription level. This ensures all storage accounts in the subscription will be protected, including future ones.</p> <p>This can be helpful:</p> <ul> <li>To protect storage accounts from malicious content.   Especially when content in the storage account is uploaded from untrusted sources.</li> <li>To meet compliance standard controls that require on-upload malware scanning for non-compute resources.   Including standards such as NIST, SWIFT, and UK GOV.</li> </ul>","tags":["Azure.Defender.Storage.MalwareScan","AZR-000383"]},{"location":"en/rules/Azure.Defender.Storage.MalwareScan/#recommendation","title":"Recommendation","text":"<p>Consider using malware scanning in Microsoft Defender for Storage for all storage accounts in the subscription.</p>","tags":["Azure.Defender.Storage.MalwareScan","AZR-000383"]},{"location":"en/rules/Azure.Defender.Storage.MalwareScan/#examples","title":"Examples","text":"","tags":["Azure.Defender.Storage.MalwareScan","AZR-000383"]},{"location":"en/rules/Azure.Defender.Storage.MalwareScan/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable malware scanning in Microsoft Defender for Storage:</p> <ul> <li>Set the <code>properties.pricingTier</code> property to <code>Standard</code>.</li> <li>Set the <code>properties.subPlan</code> property to <code>DefenderForStorageV2</code>.</li> <li>Configure settings for the <code>OnUploadMalwareScanning</code> extension.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/pricings\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"StorageAccounts\",\n  \"properties\": {\n    \"pricingTier\": \"Standard\",\n    \"subPlan\": \"DefenderForStorageV2\",\n    \"extensions\": [\n      {\n        \"name\": \"OnUploadMalwareScanning\",\n        \"isEnabled\": \"True\",\n        \"additionalExtensionProperties\": {\n          \"CapGBPerMonthPerStorageAccount\": \"5000\"\n        }\n      },\n      {\n        \"name\": \"SensitiveDataDiscovery\",\n        \"isEnabled\": \"True\"\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.Defender.Storage.MalwareScan","AZR-000383"]},{"location":"en/rules/Azure.Defender.Storage.MalwareScan/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable malware scanning in Microsoft Defender for Storage:</p> <ul> <li>Set the <code>properties.pricingTier</code> property to <code>Standard</code>.</li> <li>Set the <code>properties.subPlan</code> property to <code>DefenderForStorageV2</code>.</li> <li>Configure settings for the <code>OnUploadMalwareScanning</code> extension.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForStorage 'Microsoft.Security/pricings@2024-01-01' = {\n  name: 'StorageAccounts'\n  properties: {\n    pricingTier: 'Standard'\n    subPlan: 'DefenderForStorageV2'\n    extensions: [\n      {\n        name: 'OnUploadMalwareScanning'\n        isEnabled: 'True'\n        additionalExtensionProperties: {\n          CapGBPerMonthPerStorageAccount: '5000'\n        }\n      }\n      {\n        name: 'SensitiveDataDiscovery'\n        isEnabled: 'True'\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.Defender.Storage.MalwareScan","AZR-000383"]},{"location":"en/rules/Azure.Defender.Storage.MalwareScan/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Microsoft Defender for Storage should be enabled <code>/providers/Microsoft.Authorization/policyDefinitions/640d2586-54d2-465f-877f-9ffc1d2109f4</code></li> <li>Configure Microsoft Defender for Storage to be enabled <code>/providers/Microsoft.Authorization/policyDefinitions/cfdc5972-75b3-4418-8ae1-7f5c36839390</code></li> </ul>","tags":["Azure.Defender.Storage.MalwareScan","AZR-000383"]},{"location":"en/rules/Azure.Defender.Storage.MalwareScan/#notes","title":"Notes","text":"<p>Malware scanning is only available in the <code>DefenderForStorageV2</code> sub plan for Defender for Storage, which offers new features that aren't included in the classic plan.</p> <p>Not all services and blob types within storage accounts are currently supported. See limitations for more information.</p>","tags":["Azure.Defender.Storage.MalwareScan","AZR-000383"]},{"location":"en/rules/Azure.Defender.Storage.MalwareScan/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>What is Microsoft Defender for Cloud?</li> <li>Malware Scanning in Defender for Storage</li> <li>Limitations</li> <li>Setting up response to Malware Scanning</li> <li>Overview of Microsoft Defender for Storage</li> <li>Enable and configure Microsoft Defender for Storage</li> <li>Quickstart: Enable enhanced security features</li> <li>Azure security baseline for Storage</li> <li>DP-2: Monitor anomalies and threats targeting sensitive data</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure Policy built-in policy definitions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Defender.Storage.MalwareScan","AZR-000383"]},{"location":"en/rules/Azure.Defender.Storage/","title":"Configure Microsoft Defender for Storage to the Standard tier","text":"Azure.Defender.StorageAZR-000296Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  2023_06  \u00b7  Critical</p> <p>Enable Microsoft Defender for Storage.</p>","tags":["Azure.Defender.Storage","AZR-000296"]},{"location":"en/rules/Azure.Defender.Storage/#description","title":"Description","text":"<p>Microsoft Defender for Storage provides additional security for storage accounts.</p> <p>Protection is provided by the following which allows Microsoft Defender for Cloud to discover and mitigate potential threats:</p> <ul> <li>Continuously analyzing data and control plane logs from protected storage accounts.</li> <li>Malware scanning on uploaded content in near real time, leveraging Microsoft Defender Antivirus capabilities.</li> <li>Sensitive data threat detection by a smart sampling method to find resources with sensitive data.</li> </ul> <p>Security findings for on-boarded storage accounts shows up in Defender for Cloud with details of the security threats with contextual information.</p> <p>Defender for Storage can be enabled at the subscription level. This ensures all storage accounts in the subscription will be protected, including future ones.</p>","tags":["Azure.Defender.Storage","AZR-000296"]},{"location":"en/rules/Azure.Defender.Storage/#recommendation","title":"Recommendation","text":"<p>Consider using Microsoft Defender for Storage to protect your data hosted in storage accounts.</p>","tags":["Azure.Defender.Storage","AZR-000296"]},{"location":"en/rules/Azure.Defender.Storage/#examples","title":"Examples","text":"","tags":["Azure.Defender.Storage","AZR-000296"]},{"location":"en/rules/Azure.Defender.Storage/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To enable Defender for Storage:</p> <ul> <li>Set the <code>properties.pricingTier</code> property to <code>Standard</code>.</li> <li>Set the <code>properties.subPlan</code> property to <code>DefenderForStorageV2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/pricings\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"StorageAccounts\",\n  \"properties\": {\n    \"pricingTier\": \"Standard\",\n    \"subPlan\": \"DefenderForStorageV2\",\n    \"extensions\": [\n      {\n        \"name\": \"OnUploadMalwareScanning\",\n        \"isEnabled\": \"True\",\n        \"additionalExtensionProperties\": {\n          \"CapGBPerMonthPerStorageAccount\": \"5000\"\n        }\n      },\n      {\n        \"name\": \"SensitiveDataDiscovery\",\n        \"isEnabled\": \"True\"\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.Defender.Storage","AZR-000296"]},{"location":"en/rules/Azure.Defender.Storage/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To enable Defender for Storage:</p> <ul> <li>Set the <code>properties.pricingTier</code> property to <code>Standard</code>.</li> <li>Set the <code>properties.subPlan</code> property to <code>DefenderForStorageV2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForStorage 'Microsoft.Security/pricings@2024-01-01' = {\n  name: 'StorageAccounts'\n  properties: {\n    pricingTier: 'Standard'\n    subPlan: 'DefenderForStorageV2'\n    extensions: [\n      {\n        name: 'OnUploadMalwareScanning'\n        isEnabled: 'True'\n        additionalExtensionProperties: {\n          CapGBPerMonthPerStorageAccount: '5000'\n        }\n      }\n      {\n        name: 'SensitiveDataDiscovery'\n        isEnabled: 'True'\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.Defender.Storage","AZR-000296"]},{"location":"en/rules/Azure.Defender.Storage/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Set-AzSecurityPricing -Name 'StorageAccounts' -PricingTier 'Standard' -SubPlan 'DefenderForStorageV2'\n</code></pre>","tags":["Azure.Defender.Storage","AZR-000296"]},{"location":"en/rules/Azure.Defender.Storage/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Microsoft Defender for Storage should be enabled <code>/providers/Microsoft.Authorization/policyDefinitions/640d2586-54d2-465f-877f-9ffc1d2109f4</code></li> <li>Configure Microsoft Defender for Storage to be enabled <code>/providers/Microsoft.Authorization/policyDefinitions/cfdc5972-75b3-4418-8ae1-7f5c36839390</code></li> </ul>","tags":["Azure.Defender.Storage","AZR-000296"]},{"location":"en/rules/Azure.Defender.Storage/#notes","title":"Notes","text":"<p>The <code>DefenderForStorageV2</code> sub plan represents the new Defender for Storage plan which offers several new benefits that aren't included in the classic plan. The new plan includes more advanced capabilities that can help improve the security of the data and help prevent malicious file uploads, sensitive data exfiltration, and data corruption.</p> <p>Currently only the <code>Blob Storage</code>, <code>Azure Files</code> and <code>Azure Data Lake Storage Gen2</code> service is supported by Defender for Storage.</p>","tags":["Azure.Defender.Storage","AZR-000296"]},{"location":"en/rules/Azure.Defender.Storage/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>Storage security guide</li> <li>What is Microsoft Defender for Cloud?</li> <li>Overview of Microsoft Defender for Storage</li> <li>Migrate from Defender for Storage (classic) to the new plan</li> <li>Enable and configure Microsoft Defender for Storage</li> <li>Quickstart: Enable enhanced security features</li> <li>Azure security baseline for Storage</li> <li>DP-2: Monitor anomalies and threats targeting sensitive data</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure Policy built-in policy definitions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Defender.Storage","AZR-000296"]},{"location":"en/rules/Azure.DefenderCloud.Provisioning/","title":"Enable Microsoft Defender for Cloud auto-provisioning","text":"Azure.DefenderCloud.ProvisioningAZR-000210Error <p> Security  \u00b7  Microsoft Defender for Cloud  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Enable auto-provisioning on to improve Microsoft Defender for Cloud insights.</p>","tags":["Azure.DefenderCloud.Provisioning","AZR-000210"]},{"location":"en/rules/Azure.DefenderCloud.Provisioning/#description","title":"Description","text":"<p>Select resources such as virtual machines (VMs) and VM scale sets require an agent to be installed to collect additional information from the operating system (OS). This information is used to identify missing security updates and additional threats.</p> <p>By turning auto-provisioning on, Microsoft Defender for Cloud automatically deploys an Azure Monitor agent to VMs on a regular basis.</p>","tags":["Azure.DefenderCloud.Provisioning","AZR-000210"]},{"location":"en/rules/Azure.DefenderCloud.Provisioning/#recommendation","title":"Recommendation","text":"<p>Consider enabling auto-provisioning to improve Azure Microsoft Defender for Cloud VM insights.</p>","tags":["Azure.DefenderCloud.Provisioning","AZR-000210"]},{"location":"en/rules/Azure.DefenderCloud.Provisioning/#notes","title":"Notes","text":"<p>This rule applies when analyzing resources deployed (in-flight) to Azure.</p>","tags":["Azure.DefenderCloud.Provisioning","AZR-000210"]},{"location":"en/rules/Azure.DefenderCloud.Provisioning/#links","title":"Links","text":"<ul> <li>Quickstart: Configure auto provisioning for agents and extensions from Microsoft Defender for Cloud</li> </ul>","tags":["Azure.DefenderCloud.Provisioning","AZR-000210"]},{"location":"en/rules/Azure.Deployment.AdminUsername/","title":"Deployment uses deterministic credential values","text":"Azure.Deployment.AdminUsernameAZR-000284Error <p> Security  \u00b7  Deployment  \u00b7  Rule  \u00b7  2022_09  \u00b7  Awareness</p> <p>A sensitive property set from deterministic or hardcoded values is not secure.</p>","tags":["Azure.Deployment.AdminUsername","AZR-000284"]},{"location":"en/rules/Azure.Deployment.AdminUsername/#description","title":"Description","text":"<p>Resource properties can be configured using a hardcoded value or Azure Bicep/ template expressions. When specifying sensitive values use secure parameters. Secure parameters use the <code>@secure</code> decorator in Bicep or the <code>secureString</code> / <code>secureObject</code> type.</p> <p>Sensitive values that use deterministic expressions such as hardcoded string literals or variables are not secure. These values can be read by anyone with read access to deployment history or logs. Logs are often exposed at multiple levels including CI pipeline logs, Azure Activity Logs, and SIEM systems.</p> <p>Secret rotation \u2014 SE:09 Application secrets</p> <p>If a secret has already been exposed by a previous insecure deployment, rotate it immediately to prevent unauthorized access to your resources.</p> <p>Rotating a secret involves changing or regenerating the secret value and updating all dependent resources with the new value. This process should be done in a secure manner to prevent the new secret from being exposed.</p>","tags":["Azure.Deployment.AdminUsername","AZR-000284"]},{"location":"en/rules/Azure.Deployment.AdminUsername/#recommendation","title":"Recommendation","text":"<p>Sensitive properties should be passed as parameters. Avoid using deterministic or hardcoded values for sensitive properties.</p>","tags":["Azure.Deployment.AdminUsername","AZR-000284"]},{"location":"en/rules/Azure.Deployment.AdminUsername/#examples","title":"Examples","text":"","tags":["Azure.Deployment.AdminUsername","AZR-000284"]},{"location":"en/rules/Azure.Deployment.AdminUsername/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure deployments that pass this rule:</p> <ul> <li>Set the <code>type</code> of parameters used set sensitive resource properties to <code>secureString</code> or <code>secureObject</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Compute/virtualMachines\",\n  \"apiVersion\": \"2022-03-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"zones\": [\n    \"1\"\n  ],\n  \"properties\": {\n    \"hardwareProfile\": {\n      \"vmSize\": \"Standard_D2s_v3\"\n    },\n    \"osProfile\": {\n      \"computerName\": \"[parameters('name')]\",\n      \"adminUsername\": \"[parameters('adminUsername')]\",\n      \"adminPassword\": \"[parameters('adminPassword')]\"\n    },\n    \"storageProfile\": {\n      \"imageReference\": {\n        \"publisher\": \"MicrosoftWindowsServer\",\n        \"offer\": \"WindowsServer\",\n        \"sku\": \"[parameters('sku')]\",\n        \"version\": \"latest\"\n      },\n      \"osDisk\": {\n        \"name\": \"[format('{0}-disk0', parameters('name'))]\",\n        \"caching\": \"ReadWrite\",\n        \"createOption\": \"FromImage\",\n        \"managedDisk\": {\n          \"storageAccountType\": \"Premium_LRS\"\n        }\n      }\n    },\n    \"licenseType\": \"Windows_Server\",\n    \"networkProfile\": {\n      \"networkInterfaces\": [\n        {\n          \"id\": \"[resourceId('Microsoft.Network/networkInterfaces', format('{0}-nic0', parameters('name')))]\"\n        }\n      ]\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Network/networkInterfaces', format('{0}-nic0', parameters('name')))]\"\n  ]\n}\n</code></pre>","tags":["Azure.Deployment.AdminUsername","AZR-000284"]},{"location":"en/rules/Azure.Deployment.AdminUsername/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure deployments that pass this rule:</p> <ul> <li>Add the <code>@secure()</code> decorators on parameters used to set sensitive resource properties.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>@secure()\n@description('The name of the local administrator account.')\nparam adminUsername string\n\n@secure()\n@description('A password for the local administrator account.')\nparam adminPassword string\n\nresource vm1 'Microsoft.Compute/virtualMachines@2022-03-01' = {\n  name: name\n  location: location\n  zones: [\n    '1'\n  ]\n  properties: {\n    hardwareProfile: {\n      vmSize: 'Standard_D2s_v3'\n    }\n    osProfile: {\n      computerName: name\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: sku\n        version: 'latest'\n      }\n      osDisk: {\n        name: '${name}-disk0'\n        caching: 'ReadWrite'\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: 'Premium_LRS'\n        }\n      }\n    }\n    licenseType: 'Windows_Server'\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: nic.id\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.Deployment.AdminUsername","AZR-000284"]},{"location":"en/rules/Azure.Deployment.AdminUsername/#notes","title":"Notes","text":"","tags":["Azure.Deployment.AdminUsername","AZR-000284"]},{"location":"en/rules/Azure.Deployment.AdminUsername/#rule-configuration","title":"Rule configuration","text":"<p>AZURE_DEPLOYMENT_SENSITIVE_PROPERTY_NAMES</p> <p>Configure <code>AZURE_DEPLOYMENT_SENSITIVE_PROPERTY_NAMES</code> to specify sensitive property names. By default, the following values are used:</p> <ul> <li><code>adminUsername</code></li> <li><code>administratorLogin</code></li> <li><code>administratorLoginPassword</code></li> </ul>","tags":["Azure.Deployment.AdminUsername","AZR-000284"]},{"location":"en/rules/Azure.Deployment.AdminUsername/#links","title":"Links","text":"<ul> <li>SE:02 Secured development lifecycle</li> <li>Use Azure Key Vault to pass secure parameter value during Bicep deployment</li> <li>Integrate Azure Key Vault in your ARM template deployment</li> </ul>","tags":["Azure.Deployment.AdminUsername","AZR-000284"]},{"location":"en/rules/Azure.Deployment.Name/","title":"Use valid nested deployments names","text":"Azure.Deployment.NameAZR-000359Error <p> Operational Excellence  \u00b7  Deployment  \u00b7  Rule  \u00b7  2023_03  \u00b7  Awareness</p> <p>Nested deployments should meet naming requirements of deployments.</p>","tags":["Azure.Deployment.Name","AZR-000359"]},{"location":"en/rules/Azure.Deployment.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Azure deployments names are:</p> <ul> <li>Between 1 and 64 characters long.</li> <li>Alphanumerics, underscores, parentheses, hyphens, and periods.</li> </ul>","tags":["Azure.Deployment.Name","AZR-000359"]},{"location":"en/rules/Azure.Deployment.Name/#recommendation","title":"Recommendation","text":"<p>Consider using nested deployment names thas meets naming requirements of deployments. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.Deployment.Name","AZR-000359"]},{"location":"en/rules/Azure.Deployment.Name/#notes","title":"Notes","text":"<p>This rule does not check if nested deployment names are unique.</p>","tags":["Azure.Deployment.Name","AZR-000359"]},{"location":"en/rules/Azure.Deployment.Name/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions deployments resource</li> <li>Using linked and nested templates when deploying Azure resources</li> <li>Template reference</li> </ul>","tags":["Azure.Deployment.Name","AZR-000359"]},{"location":"en/rules/Azure.Deployment.OuterSecret/","title":"Deployment exposes secrets with outer deployment","text":"Azure.Deployment.OuterSecretAZR-000331Error <p> Security  \u00b7  Deployment  \u00b7  Rule  \u00b7  2022_12  \u00b7  Critical</p> <p>Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments.</p>","tags":["Azure.Deployment.OuterSecret","AZR-000331"]},{"location":"en/rules/Azure.Deployment.OuterSecret/#description","title":"Description","text":"<p>Template child deployments can be scoped as either <code>outer</code> or <code>inner</code>. When using <code>outer</code> scope evaluated deployments, parameters from the parent template are used directly within nested templates instead of enforcing <code>secureString</code> and <code>secureObject</code> types.</p> <p>When passing secure values to nested deployments always use <code>inner</code> scope deployments to ensure secure values are not logging. Bicep modules always use <code>inner</code> scope evaluated deployments.</p> <p>Secret rotation \u2014 SE:09 Application secrets</p> <p>If a secret has already been exposed by a previous insecure deployment, rotate it immediately to prevent unauthorized access to your resources.</p> <p>Rotating a secret involves changing or regenerating the secret value and updating all dependent resources with the new value. This process should be done in a secure manner to prevent the new secret from being exposed.</p>","tags":["Azure.Deployment.OuterSecret","AZR-000331"]},{"location":"en/rules/Azure.Deployment.OuterSecret/#recommendation","title":"Recommendation","text":"<p>Consider using <code>inner</code> deployments to prevent secure values from being exposed.</p>","tags":["Azure.Deployment.OuterSecret","AZR-000331"]},{"location":"en/rules/Azure.Deployment.OuterSecret/#examples","title":"Examples","text":"","tags":["Azure.Deployment.OuterSecret","AZR-000331"]},{"location":"en/rules/Azure.Deployment.OuterSecret/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>Nested Deployments within an ARM template need the property <code>expressionEvaluationOptions.Scope</code> to be set to <code>inner</code>.</p> Azure Template snippet<pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": {\n        \"adminUsername\": {\n            \"type\": \"securestring\",\n            \"defaultValue\": \"admin\"\n        }\n    },\n    \"resources\": [\n         {\n            \"name\": \"nestedDeployment-A\",\n            \"type\": \"Microsoft.Resources/deployments\",\n            \"apiVersion\": \"2020-10-01\",\n            \"properties\": {\n                \"expressionEvaluationOptions\": {\n                    \"scope\": \"inner\"\n                },\n                \"mode\": \"Incremental\",\n                \"template\": {\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n                    \"contentVersion\": \"1.0.0.0\",\n                    \"parameters\": {\n                        \"adminUsername\": {\n                            \"type\": \"securestring\",\n                            \"defaultValue\": \"password\"\n                        }\n                    },\n                    \"variables\": {},\n                    \"resources\": [\n                        {\n                            \"apiVersion\": \"2019-12-01\",\n                            \"type\": \"Microsoft.Compute/virtualMachines\",\n                            \"name\": \"vm-example\",\n                            \"location\": \"australiaeast\",\n                            \"properties\": {\n                                \"osProfile\": {\n                                    \"computerName\": \"vm-example\",\n                                    \"adminUsername\": \"[parameters('adminUsername')]\"\n                                }\n                            }\n                        }\n                    ]\n                }\n            }\n        }\n    ]\n}\n</code></pre>","tags":["Azure.Deployment.OuterSecret","AZR-000331"]},{"location":"en/rules/Azure.Deployment.OuterSecret/#configure-with-bicep","title":"Configure with Bicep","text":"<p>This does not apply to Bicep code as under normal circumstances. If you use the <code>module</code> keyword your deployments always use the <code>inner</code> evaluation mode.</p>","tags":["Azure.Deployment.OuterSecret","AZR-000331"]},{"location":"en/rules/Azure.Deployment.OuterSecret/#links","title":"Links","text":"<ul> <li>SE:02 Secured development lifecycle</li> <li>Azure deployment reference</li> <li>Deployment Function Scopes</li> </ul>","tags":["Azure.Deployment.OuterSecret","AZR-000331"]},{"location":"en/rules/Azure.Deployment.OutputSecretValue/","title":"Deployment exposes a secret in output","text":"Azure.Deployment.OutputSecretValueAZR-000279Error <p> Security  \u00b7  Deployment  \u00b7  Rule  \u00b7  2022_06  \u00b7  Critical</p> <p>Outputting a sensitive value from deployment may leak secrets into deployment history or logs.</p>","tags":["Azure.Deployment.OutputSecretValue","AZR-000279"]},{"location":"en/rules/Azure.Deployment.OutputSecretValue/#description","title":"Description","text":"<p>Don't include any values in an ARM template or Bicep output that could potentially expose secrets. The output from a template is stored in the deployment history, so a malicious user could find that information.</p> <p>Examples of secrets are:</p> <ul> <li>Parameters using the <code>secureString</code> or <code>secureObject</code> type.</li> <li>Output from <code>list*</code> functions such as <code>listKeys</code>.</li> </ul> <p>Outputs are recorded in clear texts within deployment history and logs. Logs are often exposed at multiple levels including CI pipeline logs, Azure Activity Logs, and SIEM systems.</p> <p>Secret rotation \u2014 SE:09 Application secrets</p> <p>If a secret has already been exposed by a previous insecure deployment, rotate it immediately to prevent unauthorized access to your resources.</p> <p>Rotating a secret involves changing or regenerating the secret value and updating all dependent resources with the new value. This process should be done in a secure manner to prevent the new secret from being exposed.</p>","tags":["Azure.Deployment.OutputSecretValue","AZR-000279"]},{"location":"en/rules/Azure.Deployment.OutputSecretValue/#recommendation","title":"Recommendation","text":"<p>Consider removing any output values that return secret values in code.</p>","tags":["Azure.Deployment.OutputSecretValue","AZR-000279"]},{"location":"en/rules/Azure.Deployment.OutputSecretValue/#examples","title":"Examples","text":"","tags":["Azure.Deployment.OutputSecretValue","AZR-000279"]},{"location":"en/rules/Azure.Deployment.OutputSecretValue/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy securely pass secrets within Infrastructure as Code:</p> <ul> <li>Define parameters with the <code>secureString</code> or <code>secureObject</code> type.</li> <li>Avoid returning a secret in output values.</li> </ul> <p>Example using <code>secureString</code> type:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"adminPassword\": {\n      \"type\": \"secureString\",\n      \"metadata\": {\n        \"description\": \"Local administrator password for virtual machine.\"\n      }\n    }\n  },\n  \"resources\": []\n}\n</code></pre> <p>The following example fails because it returns a secret:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"adminPassword\": {\n      \"type\": \"secureString\",\n      \"metadata\": {\n        \"description\": \"Local administrator password for virtual machine.\"\n      }\n    }\n  },\n  \"resources\": [],\n  \"outputs\": {\n    \"accountPassword\": {\n      \"type\": \"string\",\n      \"value\": \"[parameters('adminPassword')]\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.Deployment.OutputSecretValue","AZR-000279"]},{"location":"en/rules/Azure.Deployment.OutputSecretValue/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy securely pass secrets within Infrastructure as Code:</p> <ul> <li>Add the <code>@secure()</code> decorators on sensitive parameters.</li> <li>Avoid returning a secret in output values.</li> </ul> <p>Example using <code>@secure()</code> annotation:</p> Azure Bicep snippet<pre><code>@secure()\n@description('Local administrator password for virtual machine.')\nparam adminPassword string\n</code></pre> <p>The following example fails because it returns a secret:</p> Azure Bicep snippet<pre><code>output accountPassword string = adminPassword\n</code></pre>","tags":["Azure.Deployment.OutputSecretValue","AZR-000279"]},{"location":"en/rules/Azure.Deployment.OutputSecretValue/#links","title":"Links","text":"<ul> <li>SE:02 Secured development lifecycle</li> <li>Test cases for ARM templates</li> <li>Outputs should not contain secrets</li> <li>List function</li> </ul>","tags":["Azure.Deployment.OutputSecretValue","AZR-000279"]},{"location":"en/rules/Azure.Deployment.SecureParameter/","title":"Deployment parameter name implies it is secret but is a non-secure value","text":"Azure.Deployment.SecureParameterAZR-000408Error <p> Security  \u00b7  Deployment  \u00b7  Rule  \u00b7  2023_12  \u00b7  Critical</p> <p>Sensitive parameters that have been not been marked as secure may leak the secret into deployment history or logs.</p>","tags":["Azure.Deployment.SecureParameter","AZR-000408"]},{"location":"en/rules/Azure.Deployment.SecureParameter/#description","title":"Description","text":"<p>Azure Bicep and Azure Resource Manager (ARM) templates can be used to deploy resources to Azure. When deploying Azure resources, sensitive values such as passwords, certificates, and keys should be passed as secure parameters. Secure parameters use the <code>@secure</code> decorator in Bicep or the <code>secureString</code> / <code>secureObject</code> type.</p> <p>Parameters that do not use secure types are recorded in deployment history and logs. These values can be retrieved by anyone with read access to the deployment history and logs.</p> <p>Secret rotation \u2014 SE:09 Application secrets</p> <p>If a secret has already been exposed by a previous insecure deployment, rotate it immediately to prevent unauthorized access to your resources.</p> <p>Rotating a secret involves changing or regenerating the secret value and updating all dependent resources with the new value. This process should be done in a secure manner to prevent the new secret from being exposed.</p>","tags":["Azure.Deployment.SecureParameter","AZR-000408"]},{"location":"en/rules/Azure.Deployment.SecureParameter/#recommendation","title":"Recommendation","text":"<p>Consider using secure parameters for any parameter that contain sensitive information.</p>","tags":["Azure.Deployment.SecureParameter","AZR-000408"]},{"location":"en/rules/Azure.Deployment.SecureParameter/#examples","title":"Examples","text":"","tags":["Azure.Deployment.SecureParameter","AZR-000408"]},{"location":"en/rules/Azure.Deployment.SecureParameter/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure deployments that pass this rule:</p> <ul> <li>Set the type of sensitive parameters to <code>secureString</code> or <code>secureObject</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"secret\": {\n      \"type\": \"secureString\"\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.KeyVault/vaults/secrets\",\n      \"apiVersion\": \"2022-07-01\",\n      \"name\": \"keyvault/good\",\n      \"properties\": {\n        \"value\": \"[parameters('secret')]\"\n      }\n    }\n  ]\n}\n</code></pre>","tags":["Azure.Deployment.SecureParameter","AZR-000408"]},{"location":"en/rules/Azure.Deployment.SecureParameter/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure deployments that pass this rule:</p> <ul> <li>Add the <code>@secure()</code> decorators on sensitive parameters.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>@secure()\nparam secret string\n\nresource goodSecret 'Microsoft.KeyVault/vaults/secrets@2022-07-01' = {\n  parent: vault\n  name: 'good'\n  properties: {\n    value: secret\n  }\n}\n</code></pre>","tags":["Azure.Deployment.SecureParameter","AZR-000408"]},{"location":"en/rules/Azure.Deployment.SecureParameter/#notes","title":"Notes","text":"<p>This rule uses a heuristics to determine if a parameter should use a secure type:</p> <ul> <li>Parameters with the type <code>int</code> or <code>bool</code> are ignored regardless of how they are named.</li> <li>Parameters named ending with <code>name</code>, <code>uri</code>, <code>url</code>, <code>path</code>, <code>type</code>, <code>id</code>, or <code>options</code> are ignored.</li> <li>Any remaining parameters with a name containing <code>password</code>, <code>secret</code>, or <code>token</code> will be considered sensitive.   Except if they contains any of the following in sequences in their name:     <code>length</code>, <code>interval</code>, <code>secretname</code>, <code>secreturl</code>, <code>secreturi</code>, <code>secrettype</code>, <code>secretrotation</code>,     <code>secretprovider</code>, <code>secretsprovider</code>, <code>secretref</code>, <code>secretid</code>, <code>disablepassword</code>, <code>sync*passwords</code>,     <code>tokenname</code>, <code>tokentype</code>, <code>keyvaultpath</code>, <code>keyvaultname</code>, or <code>keyvaulturi</code>.</li> <li>Any remaining parameters with a name ending in <code>key</code> or <code>keys</code> will be considered sensitive.   Except for:<ul> <li>The <code>customermanagedkey</code> parameter.</li> <li>Parameter names ending in <code>publickey</code> or <code>publickeys</code>.</li> </ul> </li> </ul>","tags":["Azure.Deployment.SecureParameter","AZR-000408"]},{"location":"en/rules/Azure.Deployment.SecureParameter/#rule-configuration","title":"Rule configuration","text":"<p>AZURE_DEPLOYMENT_NONSENSITIVE_PARAMETER_NAMES</p> <p>If you identify a parameter that is not sensitive, and is incorrectly flagged by this rule, you can override the rule. To override this rule:</p> <ul> <li>Set the <code>AZURE_DEPLOYMENT_NONSENSITIVE_PARAMETER_NAMES</code> configuration value to identify parameters that are not sensitive.</li> </ul>","tags":["Azure.Deployment.SecureParameter","AZR-000408"]},{"location":"en/rules/Azure.Deployment.SecureParameter/#links","title":"Links","text":"<ul> <li>SE:02 Secured development lifecycle</li> <li>Secure parameters</li> <li>Use Azure Key Vault to pass secure parameter value during Bicep deployment</li> <li>Integrate Azure Key Vault in your ARM template deployment</li> </ul>","tags":["Azure.Deployment.SecureParameter","AZR-000408"]},{"location":"en/rules/Azure.Deployment.SecureValue/","title":"Deployment sets a secret property with a non-secure value","text":"Azure.Deployment.SecureValueAZR-000316Error <p> Security  \u00b7  Deployment  \u00b7  Rule  \u00b7  2024_12  \u00b7  Critical</p> <p>A secret property set from a non-secure value may leak the secret into deployment history or logs.</p>","tags":["Azure.Deployment.SecureValue","AZR-000316"]},{"location":"en/rules/Azure.Deployment.SecureValue/#description","title":"Description","text":"<p>Azure Bicep and Azure Resource Manager (ARM) templates can be used to deploy resources to Azure. When deploying Azure resources, sensitive values such as passwords, certificates, and keys should be passed as secure parameters. Secure parameters use the <code>@secure</code> decorator in Bicep or the <code>secureString</code> / <code>secureObject</code> type.</p> <p>Parameters that do not use secure types are recorded in deployment history and logs. These values can be retrieved by anyone with read access to the deployment history and logs. Logs are often exposed at multiple levels including CI pipeline logs, Azure Activity Logs, and SIEM systems.</p> <p>Secret rotation \u2014 SE:09 Application secrets</p> <p>If a secret has already been exposed by a previous insecure deployment, rotate it immediately to prevent unauthorized access to your resources.</p> <p>Rotating a secret involves changing or regenerating the secret value and updating all dependent resources with the new value. This process should be done in a secure manner to prevent the new secret from being exposed.</p>","tags":["Azure.Deployment.SecureValue","AZR-000316"]},{"location":"en/rules/Azure.Deployment.SecureValue/#recommendation","title":"Recommendation","text":"<p>Consider using secure parameters for setting the value of any sensitive resource properties.</p>","tags":["Azure.Deployment.SecureValue","AZR-000316"]},{"location":"en/rules/Azure.Deployment.SecureValue/#examples","title":"Examples","text":"","tags":["Azure.Deployment.SecureValue","AZR-000316"]},{"location":"en/rules/Azure.Deployment.SecureValue/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure deployments that pass this rule:</p> <ul> <li>Set the <code>type</code> of parameters used set sensitive resource properties to <code>secureString</code> or <code>secureObject</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"secret\": {\n      \"type\": \"secureString\"\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.KeyVault/vaults/secrets\",\n      \"apiVersion\": \"2022-07-01\",\n      \"name\": \"keyvault/good\",\n      \"properties\": {\n        \"value\": \"[parameters('secret')]\"\n      }\n    }\n  ]\n}\n</code></pre>","tags":["Azure.Deployment.SecureValue","AZR-000316"]},{"location":"en/rules/Azure.Deployment.SecureValue/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure deployments that pass this rule:</p> <ul> <li>Add the <code>@secure()</code> decorators on parameters used to set sensitive resource properties.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>@secure()\nparam secret string\n\nresource goodSecret 'Microsoft.KeyVault/vaults/secrets@2022-07-01' = {\n  name: 'keyvault/good'\n  properties: {\n    value: secret\n  }\n}\n</code></pre>","tags":["Azure.Deployment.SecureValue","AZR-000316"]},{"location":"en/rules/Azure.Deployment.SecureValue/#notes","title":"Notes","text":"<p>For a list of resource types and properties that are checked by this rule see secret properties. If you find properties that are missing, please let us know by logging an issue on GitHub.</p>","tags":["Azure.Deployment.SecureValue","AZR-000316"]},{"location":"en/rules/Azure.Deployment.SecureValue/#links","title":"Links","text":"<ul> <li>SE:02 Secured development lifecycle</li> <li>Secure parameters</li> <li>Use Azure Key Vault to pass secure parameter value during Bicep deployment</li> <li>Integrate Azure Key Vault in your ARM template deployment</li> </ul>","tags":["Azure.Deployment.SecureValue","AZR-000316"]},{"location":"en/rules/Azure.DevBox.ProjectLimit/","title":"Limit number of Dev Boxes per user","text":"Azure.DevBox.ProjectLimitAZR-000411Error <p> Cost Optimization  \u00b7  Dev Box  \u00b7  Rule  \u00b7  2024_03  \u00b7  Important</p> <p>Limit the number of Dev Boxes a single user can create for a project.</p>","tags":["Azure.DevBox.ProjectLimit","AZR-000411"]},{"location":"en/rules/Azure.DevBox.ProjectLimit/#description","title":"Description","text":"<p>Microsoft Dev Box is a service that allows users to create and manage a developer workstation in the cloud (Dev Boxes). Dev Boxes are virtual machines with specifications and configuration designed for developers. Each Dev Box is billed based on usage to a capped amount per month.</p> <p>Dev Box Projects are used to manage Dev Boxes. By default, a single user can create multiple Dev Boxes for a single Dev Box Project. This can lead to unexpected costs.</p> <p>Organizations should consider how many Dev Boxes are required for a single user and set reasonable limits.</p>","tags":["Azure.DevBox.ProjectLimit","AZR-000411"]},{"location":"en/rules/Azure.DevBox.ProjectLimit/#recommendation","title":"Recommendation","text":"<p>Consider limiting the number of Dev Boxes a single user can create for any projects. Additional consider, configuring budgets and alerts to monitor cost exceptions.</p>","tags":["Azure.DevBox.ProjectLimit","AZR-000411"]},{"location":"en/rules/Azure.DevBox.ProjectLimit/#examples","title":"Examples","text":"","tags":["Azure.DevBox.ProjectLimit","AZR-000411"]},{"location":"en/rules/Azure.DevBox.ProjectLimit/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Dev Box Projects that pass this rule:</p> <ul> <li>Set the <code>properties.maxDevBoxesPerUser</code> property to limit the number of Dev Box a single user can create.   E.g. <code>2</code></li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DevCenter/projects\",\n  \"apiVersion\": \"2023-04-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"devCenterId\": \"[resourceId('Microsoft.DevCenter/devcenters', parameters('name'))]\",\n    \"maxDevBoxesPerUser\": 2\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.DevCenter/devcenters', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.DevBox.ProjectLimit","AZR-000411"]},{"location":"en/rules/Azure.DevBox.ProjectLimit/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Dev Box Projects that pass this rule:</p> <ul> <li>Set the <code>properties.maxDevBoxesPerUser</code> property to limit the number of Dev Box a single user can create.   E.g. <code>2</code></li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource project 'Microsoft.DevCenter/projects@2023-04-01' = {\n  name: name\n  location: location\n  properties: {\n    devCenterId: center.id\n    maxDevBoxesPerUser: 2\n  }\n}\n</code></pre>","tags":["Azure.DevBox.ProjectLimit","AZR-000411"]},{"location":"en/rules/Azure.DevBox.ProjectLimit/#notes","title":"Notes","text":"<p>The <code>properties.maxDevBoxesPerUser</code> property does not limit the number of Dev Boxes a user can create across multiple projects.</p>","tags":["Azure.DevBox.ProjectLimit","AZR-000411"]},{"location":"en/rules/Azure.DevBox.ProjectLimit/#links","title":"Links","text":"<ul> <li>CO:04 Spending guardrails</li> <li>Tutorial: Control costs by setting dev box limits on a project</li> <li>Tutorial: Create and manage budgets</li> <li>Quickstart: Create a budget with Bicep</li> <li>Use cost alerts to monitor usage and spending</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.DevBox.ProjectLimit","AZR-000411"]},{"location":"en/rules/Azure.EntraDS.NTLM/","title":"Disable NTLM v1","text":"Azure.EntraDS.NTLMAZR-000416Error <p> Security  \u00b7  Entra Domain Services  \u00b7  Rule  \u00b7  2024_06  \u00b7  Critical</p> <p>Disable NTLM v1 for Microsoft Entra Domain Services.</p>","tags":["Azure.EntraDS.NTLM","AZR-000416"]},{"location":"en/rules/Azure.EntraDS.NTLM/#description","title":"Description","text":"<p>By default, Microsoft Entra Domain Services enables the use of ciphers and protocols such as NTLM v1. These ciphers may be required for some legacy applications, but are considered weak and can be disabled if not required.</p>","tags":["Azure.EntraDS.NTLM","AZR-000416"]},{"location":"en/rules/Azure.EntraDS.NTLM/#recommendation","title":"Recommendation","text":"<p>Consider disabling NTLM v1 which is considered weak and can be disabled if not required.</p>","tags":["Azure.EntraDS.NTLM","AZR-000416"]},{"location":"en/rules/Azure.EntraDS.NTLM/#examples","title":"Examples","text":"","tags":["Azure.EntraDS.NTLM","AZR-000416"]},{"location":"en/rules/Azure.EntraDS.NTLM/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy domains that pass this rule:</p> <ul> <li>Set the <code>properties.domainSecuritySettings.ntlmV1</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.AAD/domainServices\",\n  \"apiVersion\": \"2022-12-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"ldapsSettings\": {\n      \"ldaps\": \"Enabled\"\n    },\n    \"domainSecuritySettings\": {\n      \"ntlmV1\": \"Disabled\",\n      \"tlsV1\": \"Disabled\",\n      \"kerberosRc4Encryption\": \"Disabled\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.EntraDS.NTLM","AZR-000416"]},{"location":"en/rules/Azure.EntraDS.NTLM/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy domains that pass this rule:</p> <ul> <li>Set the <code>properties.domainSecuritySettings.ntlmV1</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource ds 'Microsoft.AAD/domainServices@2022-12-01' = {\n  name: name\n  location: location\n  properties: {\n    ldapsSettings: {\n      ldaps: 'Enabled'\n    }\n    domainSecuritySettings: {\n      ntlmV1: 'Disabled'\n      tlsV1: 'Disabled'\n      kerberosRc4Encryption: 'Disabled'\n    }\n  }\n}\n</code></pre>","tags":["Azure.EntraDS.NTLM","AZR-000416"]},{"location":"en/rules/Azure.EntraDS.NTLM/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Harden a Microsoft Entra Domain Services managed domain</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.EntraDS.NTLM","AZR-000416"]},{"location":"en/rules/Azure.EntraDS.RC4/","title":"Disable RC4 encryption","text":"Azure.EntraDS.RC4AZR-000418Error <p> Security  \u00b7  Entra Domain Services  \u00b7  Rule  \u00b7  2024_06  \u00b7  Critical</p> <p>Disable RC4 encryption for Microsoft Entra Domain Services.</p>","tags":["Azure.EntraDS.RC4","AZR-000418"]},{"location":"en/rules/Azure.EntraDS.RC4/#description","title":"Description","text":"<p>By default, Microsoft Entra Domain Services enables the use of ciphers and protocols such as RC4. These ciphers may be required for some legacy applications, but are considered weak and can be disabled if not required.</p>","tags":["Azure.EntraDS.RC4","AZR-000418"]},{"location":"en/rules/Azure.EntraDS.RC4/#recommendation","title":"Recommendation","text":"<p>Consider disabling RC4 encryption which is considered weak and can be disabled if not required.</p>","tags":["Azure.EntraDS.RC4","AZR-000418"]},{"location":"en/rules/Azure.EntraDS.RC4/#examples","title":"Examples","text":"","tags":["Azure.EntraDS.RC4","AZR-000418"]},{"location":"en/rules/Azure.EntraDS.RC4/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy domains that pass this rule:</p> <ul> <li>Set the <code>properties.domainSecuritySettings.kerberosRc4Encryption</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.AAD/domainServices\",\n  \"apiVersion\": \"2022-12-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"ldapsSettings\": {\n      \"ldaps\": \"Enabled\"\n    },\n    \"domainSecuritySettings\": {\n      \"ntlmV1\": \"Disabled\",\n      \"tlsV1\": \"Disabled\",\n      \"kerberosRc4Encryption\": \"Disabled\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.EntraDS.RC4","AZR-000418"]},{"location":"en/rules/Azure.EntraDS.RC4/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy domains that pass this rule:</p> <ul> <li>Set the <code>properties.domainSecuritySettings.kerberosRc4Encryption</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource ds 'Microsoft.AAD/domainServices@2022-12-01' = {\n  name: name\n  location: location\n  properties: {\n    ldapsSettings: {\n      ldaps: 'Enabled'\n    }\n    domainSecuritySettings: {\n      ntlmV1: 'Disabled'\n      tlsV1: 'Disabled'\n      kerberosRc4Encryption: 'Disabled'\n    }\n  }\n}\n</code></pre>","tags":["Azure.EntraDS.RC4","AZR-000418"]},{"location":"en/rules/Azure.EntraDS.RC4/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Harden a Microsoft Entra Domain Services managed domain</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.EntraDS.RC4","AZR-000418"]},{"location":"en/rules/Azure.EntraDS.TLS/","title":"Disable TLS v1","text":"Azure.EntraDS.TLSAZR-000417Error <p> Security  \u00b7  Entra Domain Services  \u00b7  Rule  \u00b7  2024_06  \u00b7  Critical</p> <p>Disable TLS v1 for Microsoft Entra Domain Services.</p>","tags":["Azure.EntraDS.TLS","AZR-000417"]},{"location":"en/rules/Azure.EntraDS.TLS/#description","title":"Description","text":"<p>By default, Microsoft Entra Domain Services enables the use of ciphers and protocols such as TLS v1. These ciphers may be required for some legacy applications, but are considered weak and can be disabled if not required.</p> <p>Older TLS versions such as 1.0 and 1.1 are no longer considered secure by industry standards, such as PCI DSS.</p>","tags":["Azure.EntraDS.TLS","AZR-000417"]},{"location":"en/rules/Azure.EntraDS.TLS/#recommendation","title":"Recommendation","text":"<p>Consider disabling TLS v1 which is considered weak and can be disabled if not required.</p>","tags":["Azure.EntraDS.TLS","AZR-000417"]},{"location":"en/rules/Azure.EntraDS.TLS/#examples","title":"Examples","text":"","tags":["Azure.EntraDS.TLS","AZR-000417"]},{"location":"en/rules/Azure.EntraDS.TLS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy domains that pass this rule:</p> <ul> <li>Set the <code>properties.domainSecuritySettings.tlsV1</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.AAD/domainServices\",\n  \"apiVersion\": \"2022-12-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"ldapsSettings\": {\n      \"ldaps\": \"Enabled\"\n    },\n    \"domainSecuritySettings\": {\n      \"ntlmV1\": \"Disabled\",\n      \"tlsV1\": \"Disabled\",\n      \"kerberosRc4Encryption\": \"Disabled\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.EntraDS.TLS","AZR-000417"]},{"location":"en/rules/Azure.EntraDS.TLS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy domains that pass this rule:</p> <ul> <li>Set the <code>properties.domainSecuritySettings.tlsV1</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource ds 'Microsoft.AAD/domainServices@2022-12-01' = {\n  name: name\n  location: location\n  properties: {\n    ldapsSettings: {\n      ldaps: 'Enabled'\n    }\n    domainSecuritySettings: {\n      ntlmV1: 'Disabled'\n      tlsV1: 'Disabled'\n      kerberosRc4Encryption: 'Disabled'\n    }\n  }\n}\n</code></pre>","tags":["Azure.EntraDS.TLS","AZR-000417"]},{"location":"en/rules/Azure.EntraDS.TLS/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Harden a Microsoft Entra Domain Services managed domain</li> <li>DP-3: Encrypt sensitive data in transit</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.EntraDS.TLS","AZR-000417"]},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/","title":"Use identity-based authentication for Event Grid topics","text":"Azure.EventGrid.DisableLocalAuthAZR-000100Error <p> Security  \u00b7  Event Grid  \u00b7  Rule  \u00b7  2022_09  \u00b7  Important</p> <p>Authenticate publishing clients with Azure AD identities.</p>","tags":["Azure.EventGrid.DisableLocalAuth","AZR-000100"]},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/#description","title":"Description","text":"<p>To publish events to Event Grid access keys, SAS tokens, or Azure AD identities can be used. With Azure AD authentication, the identity is validated against the Microsoft Identity Platform. Using Azure AD identities centralizes identity management and auditing.</p> <p>Once you decide to use Azure AD authentication, you can disable authentication using keys or SAS tokens.</p>","tags":["Azure.EventGrid.DisableLocalAuth","AZR-000100"]},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/#recommendation","title":"Recommendation","text":"<p>Consider only using Azure AD identities to publish events to Event Grid. Then disable authentication based on access keys or SAS tokens.</p>","tags":["Azure.EventGrid.DisableLocalAuth","AZR-000100"]},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/#examples","title":"Examples","text":"","tags":["Azure.EventGrid.DisableLocalAuth","AZR-000100"]},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Event Grid Topics that pass this rule:</p> <ul> <li>Set the <code>properties.disableLocalAuth</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.EventGrid/topics\",\n  \"apiVersion\": \"2022-06-15\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"disableLocalAuth\": true,\n    \"publicNetworkAccess\": \"Disabled\",\n    \"inputSchema\": \"CloudEventSchemaV1_0\"\n  }\n}\n</code></pre>","tags":["Azure.EventGrid.DisableLocalAuth","AZR-000100"]},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Event Grid Topics that pass this rule:</p> <ul> <li>Set the <code>properties.disableLocalAuth</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource eventGrid 'Microsoft.EventGrid/topics@2022-06-15' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    disableLocalAuth: true\n    publicNetworkAccess: 'Disabled'\n    inputSchema: 'CloudEventSchemaV1_0'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/event-grid/topic:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/event-grid/topic:0.6.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.EventGrid.DisableLocalAuth","AZR-000100"]},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Azure Event Grid topics should have local authentication methods disabled</li> <li>Configure Azure Event Grid topics to disable local authentication</li> </ul>","tags":["Azure.EventGrid.DisableLocalAuth","AZR-000100"]},{"location":"en/rules/Azure.EventGrid.DisableLocalAuth/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>IM-1: Use centralized identity and authentication system</li> <li>Authentication and authorization with Microsoft Entra ID</li> <li>Disable key and shared access signature authentication</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.EventGrid.DisableLocalAuth","AZR-000100"]},{"location":"en/rules/Azure.EventGrid.ManagedIdentity/","title":"Use Managed Identity for Event Grid Topics","text":"Azure.EventGrid.ManagedIdentityAZR-000099Error <p> Security  \u00b7  Event Grid  \u00b7  Rule  \u00b7  2021_12  \u00b7  Important</p> <p>Use managed identities to deliver Event Grid Topic events.</p>","tags":["Azure.EventGrid.ManagedIdentity","AZR-000099"]},{"location":"en/rules/Azure.EventGrid.ManagedIdentity/#description","title":"Description","text":"<p>When delivering events you can use Managed Identities to authenticate event delivery. You can enable either system-assigned identity or user-assigned identity but not both. You can have at most two user-assigned identities assigned to a topic or domain.</p>","tags":["Azure.EventGrid.ManagedIdentity","AZR-000099"]},{"location":"en/rules/Azure.EventGrid.ManagedIdentity/#recommendation","title":"Recommendation","text":"<p>Consider configuring a managed identity for each Event Grid Topic.</p>","tags":["Azure.EventGrid.ManagedIdentity","AZR-000099"]},{"location":"en/rules/Azure.EventGrid.ManagedIdentity/#examples","title":"Examples","text":"","tags":["Azure.EventGrid.ManagedIdentity","AZR-000099"]},{"location":"en/rules/Azure.EventGrid.ManagedIdentity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Event Grid Topics that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.EventGrid/topics\",\n  \"apiVersion\": \"2022-06-15\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"disableLocalAuth\": true,\n    \"publicNetworkAccess\": \"Disabled\",\n    \"inputSchema\": \"CloudEventSchemaV1_0\"\n  }\n}\n</code></pre>","tags":["Azure.EventGrid.ManagedIdentity","AZR-000099"]},{"location":"en/rules/Azure.EventGrid.ManagedIdentity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Event Grid Topics that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource eventGrid 'Microsoft.EventGrid/topics@2022-06-15' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    disableLocalAuth: true\n    publicNetworkAccess: 'Disabled'\n    inputSchema: 'CloudEventSchemaV1_0'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/event-grid/topic:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/event-grid/topic:0.6.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.EventGrid.ManagedIdentity","AZR-000099"]},{"location":"en/rules/Azure.EventGrid.ManagedIdentity/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Assign a managed identity to an Event Grid custom topic or domain</li> <li>Authenticate event delivery to event handlers</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.EventGrid.ManagedIdentity","AZR-000099"]},{"location":"en/rules/Azure.EventGrid.TopicPublicAccess/","title":"Use Event Grid Private Endpoints","text":"Azure.EventGrid.TopicPublicAccessAZR-000098Error <p> Security  \u00b7  Event Grid  \u00b7  Rule  \u00b7  2021_12  \u00b7  Important</p> <p>Use Private Endpoints to access Event Grid topics and domains.</p>","tags":["Azure.EventGrid.TopicPublicAccess","AZR-000098"]},{"location":"en/rules/Azure.EventGrid.TopicPublicAccess/#description","title":"Description","text":"<p>By default, public network access is enabled for an Event Grid topic or domain. To allow access via private endpoints only, disable public network access.</p>","tags":["Azure.EventGrid.TopicPublicAccess","AZR-000098"]},{"location":"en/rules/Azure.EventGrid.TopicPublicAccess/#recommendation","title":"Recommendation","text":"<p>Consider using Private Endpoints to access Event Grid topics and domains. To limit access to Event Grid topics and domains, disable public access.</p>","tags":["Azure.EventGrid.TopicPublicAccess","AZR-000098"]},{"location":"en/rules/Azure.EventGrid.TopicPublicAccess/#examples","title":"Examples","text":"","tags":["Azure.EventGrid.TopicPublicAccess","AZR-000098"]},{"location":"en/rules/Azure.EventGrid.TopicPublicAccess/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Event Grid Topics that pass this rule:</p> <ul> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.EventGrid/topics\",\n  \"apiVersion\": \"2022-06-15\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"disableLocalAuth\": true,\n    \"publicNetworkAccess\": \"Disabled\",\n    \"inputSchema\": \"CloudEventSchemaV1_0\"\n  }\n}\n</code></pre>","tags":["Azure.EventGrid.TopicPublicAccess","AZR-000098"]},{"location":"en/rules/Azure.EventGrid.TopicPublicAccess/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Event Grid Topics that pass this rule:</p> <ul> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource eventGrid 'Microsoft.EventGrid/topics@2022-06-15' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    disableLocalAuth: true\n    publicNetworkAccess: 'Disabled'\n    inputSchema: 'CloudEventSchemaV1_0'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/event-grid/topic:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/event-grid/topic:0.6.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.EventGrid.TopicPublicAccess","AZR-000098"]},{"location":"en/rules/Azure.EventGrid.TopicPublicAccess/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Private Endpoints</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.EventGrid.TopicPublicAccess","AZR-000098"]},{"location":"en/rules/Azure.EventHub.DisableLocalAuth/","title":"Use identity-based authentication for Event Hub namespaces","text":"Azure.EventHub.DisableLocalAuthAZR-000102Error <p> Security  \u00b7  Event Hub  \u00b7  Rule  \u00b7  2022_03  \u00b7  Important</p> <p>Authenticate Event Hub publishers and consumers with Entra ID identities.</p>","tags":["Azure.EventHub.DisableLocalAuth","AZR-000102"]},{"location":"en/rules/Azure.EventHub.DisableLocalAuth/#description","title":"Description","text":"<p>To publish or consume events from Event Hubs cryptographic keys, or Entra ID (previously Azure AD) identities can be used. Cryptographic keys include Shared Access Policy keys or Shared Access Signature (SAS) tokens. With Entra ID authentication, the identity is validated against Azure AD. Using Entra ID identities centralizes identity management and auditing.</p> <p>Once you decide to use Entra ID authentication, you can disable authentication using keys or SAS tokens.</p>","tags":["Azure.EventHub.DisableLocalAuth","AZR-000102"]},{"location":"en/rules/Azure.EventHub.DisableLocalAuth/#recommendation","title":"Recommendation","text":"<p>Consider only using Entra ID identities to publish or consume events from Event Hub. Then disable authentication based on access keys or SAS tokens.</p>","tags":["Azure.EventHub.DisableLocalAuth","AZR-000102"]},{"location":"en/rules/Azure.EventHub.DisableLocalAuth/#examples","title":"Examples","text":"","tags":["Azure.EventHub.DisableLocalAuth","AZR-000102"]},{"location":"en/rules/Azure.EventHub.DisableLocalAuth/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Event Hub namespaces that pass this rule:</p> <ul> <li>Set the <code>properties.disableLocalAuth</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.EventHub/namespaces\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"sku\": {\n    \"name\": \"Standard\"\n  },\n  \"properties\": {\n    \"disableLocalAuth\": true,\n    \"minimumTlsVersion\": \"1.2\",\n    \"publicNetworkAccess\": \"Disabled\",\n    \"isAutoInflateEnabled\": true,\n    \"maximumThroughputUnits\": 10,\n    \"zoneRedundant\": true\n  }\n}\n</code></pre>","tags":["Azure.EventHub.DisableLocalAuth","AZR-000102"]},{"location":"en/rules/Azure.EventHub.DisableLocalAuth/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Event Hub namespaces that pass this rule:</p> <ul> <li>Set the <code>properties.disableLocalAuth</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource ns 'Microsoft.EventHub/namespaces@2024-01-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    disableLocalAuth: true\n    minimumTlsVersion: '1.2'\n    publicNetworkAccess: 'Disabled'\n    isAutoInflateEnabled: true\n    maximumThroughputUnits: 10\n    zoneRedundant: true\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/event-hub/namespace:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/event-hub/namespace:0.7.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.EventHub.DisableLocalAuth","AZR-000102"]},{"location":"en/rules/Azure.EventHub.DisableLocalAuth/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Azure Event Hub namespaces should have local authentication methods disabled</li> <li>Configure Azure Event Hub namespaces to disable local authentication</li> </ul>","tags":["Azure.EventHub.DisableLocalAuth","AZR-000102"]},{"location":"en/rules/Azure.EventHub.DisableLocalAuth/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Authorize access to Event Hubs resources using Microsoft Entra ID</li> <li>Disabling Local/SAS Key authentication</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.EventHub.DisableLocalAuth","AZR-000102"]},{"location":"en/rules/Azure.EventHub.Firewall/","title":"Access to the namespace endpoints should be restricted to only allowed sources","text":"Azure.EventHub.FirewallAZR-000422Error <p> Security  \u00b7  Event Hub  \u00b7  Rule  \u00b7  2024_06  \u00b7  Critical</p> <p>Access to the namespace endpoints should be restricted to only allowed sources.</p>","tags":["Azure.EventHub.Firewall","AZR-000422"]},{"location":"en/rules/Azure.EventHub.Firewall/#description","title":"Description","text":"<p>By default, Event Hub namespaces are accessible from public internet.</p> <p>With the firewall feature, it is possible to either fully disabling public network access by ensuring that the namespace endpoints isn't exposed on the public internet or configure rules to only accept traffic from specific addresses.</p>","tags":["Azure.EventHub.Firewall","AZR-000422"]},{"location":"en/rules/Azure.EventHub.Firewall/#recommendation","title":"Recommendation","text":"<p>Consider restricting network access to the Event Hub namespace by requiring private endpoints or by limiting access to permitted client addresses with the service firewall.</p>","tags":["Azure.EventHub.Firewall","AZR-000422"]},{"location":"en/rules/Azure.EventHub.Firewall/#examples","title":"Examples","text":"","tags":["Azure.EventHub.Firewall","AZR-000422"]},{"location":"en/rules/Azure.EventHub.Firewall/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Event Hub namespaces that pass this rule:</p> <ul> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code> to require private endpoints. OR</li> <li>Alternatively, you can configure the <code>Microsoft.EventHub/namespaces/networkRuleSets</code> sub-resource by:<ul> <li>Setting the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code> to require private endpoints. OR</li> <li>Setting the <code>properties.defaultAction</code> property to <code>Deny</code> to restrict network access to the service by default.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.EventHub/namespaces\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"sku\": {\n    \"name\": \"Standard\"\n  },\n  \"properties\": {\n    \"disableLocalAuth\": true,\n    \"minimumTlsVersion\": \"1.2\",\n    \"publicNetworkAccess\": \"Disabled\",\n    \"zoneRedundant\": true\n  }\n}\n</code></pre>","tags":["Azure.EventHub.Firewall","AZR-000422"]},{"location":"en/rules/Azure.EventHub.Firewall/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Event Hub namespaces that pass this rule:</p> <ul> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code> to require private endpoints. OR</li> <li>Alternatively, you can configure the <code>Microsoft.EventHub/namespaces/networkRuleSets</code> sub-resource by:<ul> <li>Setting the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code> to require private endpoints. OR</li> <li>Setting the <code>properties.defaultAction</code> property to <code>Deny</code> to restrict network access to the service by default.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource ns 'Microsoft.EventHub/namespaces@2024-01-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    disableLocalAuth: true\n    minimumTlsVersion: '1.2'\n    publicNetworkAccess: 'Disabled'\n    zoneRedundant: true\n  }\n}\n</code></pre>","tags":["Azure.EventHub.Firewall","AZR-000422"]},{"location":"en/rules/Azure.EventHub.Firewall/#notes","title":"Notes","text":"<p>If there are no IP and virtual network rules, all the traffic flows into the namespace even if you set the defaultAction to <code>deny</code> on the firewall. The namespace can be accessed over the public internet. Specify at least one IP rule or virtual network rule for the namespace to activate the default action on the firewall.</p> <p>The firewall feature isn't supported in the <code>basic</code> tier.</p>","tags":["Azure.EventHub.Firewall","AZR-000422"]},{"location":"en/rules/Azure.EventHub.Firewall/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Azure security baseline for Event Hub</li> <li>NS-1: Establish network segmentation boundaries</li> <li>NS-2: Secure cloud services with network controls</li> <li>Allow access to Azure Event Hub namespaces from specific IP addresses or ranges</li> <li>Allow access to Azure Event Hub namespaces from specific virtual networks</li> <li>Allow access to Azure Event Hub namespaces via private endpoints</li> <li>Azure resource deployment</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.EventHub.Firewall","AZR-000422"]},{"location":"en/rules/Azure.EventHub.MinTLS/","title":"Minimum TLS version","text":"Azure.EventHub.MinTLSAZR-000356Error <p> Security  \u00b7  Event Hub  \u00b7  Rule  \u00b7  2023_03  \u00b7  Critical</p> <p>Event Hub namespaces should reject TLS versions older than 1.2.</p>","tags":["Azure.EventHub.MinTLS","AZR-000356"]},{"location":"en/rules/Azure.EventHub.MinTLS/#description","title":"Description","text":"<p>The minimum version of TLS that Event Hub namespaces accept is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS.</p> <p>Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted.</p> <p>When clients connect using an older version of TLS that is disabled, the connection will fail.</p>","tags":["Azure.EventHub.MinTLS","AZR-000356"]},{"location":"en/rules/Azure.EventHub.MinTLS/#recommendation","title":"Recommendation","text":"<p>Configure the minimum supported TLS version to be 1.2. Also consider enforcing this setting using Azure Policy.</p>","tags":["Azure.EventHub.MinTLS","AZR-000356"]},{"location":"en/rules/Azure.EventHub.MinTLS/#examples","title":"Examples","text":"","tags":["Azure.EventHub.MinTLS","AZR-000356"]},{"location":"en/rules/Azure.EventHub.MinTLS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Event Hub namespaces that pass this rule:</p> <ul> <li>Set the <code>properties.minimumTlsVersion</code> property to <code>1.2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.EventHub/namespaces\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"sku\": {\n    \"name\": \"Standard\"\n  },\n  \"properties\": {\n    \"disableLocalAuth\": true,\n    \"minimumTlsVersion\": \"1.2\",\n    \"publicNetworkAccess\": \"Disabled\",\n    \"isAutoInflateEnabled\": true,\n    \"maximumThroughputUnits\": 10,\n    \"zoneRedundant\": true\n  }\n}\n</code></pre>","tags":["Azure.EventHub.MinTLS","AZR-000356"]},{"location":"en/rules/Azure.EventHub.MinTLS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Event Hub namespaces that pass this rule:</p> <ul> <li>Set the <code>properties.minimumTlsVersion</code> property to <code>1.2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource ns 'Microsoft.EventHub/namespaces@2024-01-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    disableLocalAuth: true\n    minimumTlsVersion: '1.2'\n    publicNetworkAccess: 'Disabled'\n    isAutoInflateEnabled: true\n    maximumThroughputUnits: 10\n    zoneRedundant: true\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/event-hub/namespace:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/event-hub/namespace:0.7.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.EventHub.MinTLS","AZR-000356"]},{"location":"en/rules/Azure.EventHub.MinTLS/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>DP-3: Encrypt sensitive data in transit</li> <li>Enforce a minimum required version of Transport Layer Security (TLS) for requests to an Event Hubs namespace</li> <li>Preparing for TLS 1.2 in Microsoft Azure</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.EventHub.MinTLS","AZR-000356"]},{"location":"en/rules/Azure.EventHub.Usage/","title":"Remove unused Event Hub namespaces","text":"Azure.EventHub.UsageAZR-000101Error <p> Cost Optimization  \u00b7  Event Hub  \u00b7  Rule  \u00b7  2022_03  \u00b7  Important</p> <p>Regularly remove unused resources to reduce costs.</p>","tags":["Azure.EventHub.Usage","AZR-000101"]},{"location":"en/rules/Azure.EventHub.Usage/#description","title":"Description","text":"<p>Billing starts for an Event Hub namespace after it is provisioned. To receive events in a Event Hub namespace, you must first create an Event Hub. Namespaces without any Event Hubs are considered unused.</p>","tags":["Azure.EventHub.Usage","AZR-000101"]},{"location":"en/rules/Azure.EventHub.Usage/#recommendation","title":"Recommendation","text":"<p>Consider removing Event Hub namespaces that are not used.</p>","tags":["Azure.EventHub.Usage","AZR-000101"]},{"location":"en/rules/Azure.EventHub.Usage/#notes","title":"Notes","text":"<p>This rule applies when analyzing resources deployed (in-flight) to Azure.</p>","tags":["Azure.EventHub.Usage","AZR-000101"]},{"location":"en/rules/Azure.EventHub.Usage/#links","title":"Links","text":"<ul> <li>CO:14 Consolidation</li> <li>Design review checklist for Cost Optimization</li> <li>Pricing</li> </ul>","tags":["Azure.EventHub.Usage","AZR-000101"]},{"location":"en/rules/Azure.Firewall.AvailabilityZone/","title":"Deploy firewall instances using availability zones","text":"Azure.Firewall.AvailabilityZoneAZR-000429Error <p> Reliability  \u00b7  Firewall  \u00b7  Rule  \u00b7  2024_09  \u00b7  Important</p> <p>Deploy firewall instances using availability zones in supported regions to ensure high availability and resilience.</p>","tags":["Azure.Firewall.AvailabilityZone","AZR-000429"]},{"location":"en/rules/Azure.Firewall.AvailabilityZone/#description","title":"Description","text":"<p>Azure Firewall supports the use of availability zones to provide zone redundancy. Zone redundancy enhances the resiliency and high availability of the firewall by deploying instances across data centers in physically separated zones.</p> <p>Azure Firewall utilizes auto-scaling, and as the firewall scales, it creates instances within the zones it is configured to use. If the firewall is configured to use only Zone 1, all new instances will be created in Zone 1. However, if the firewall is configured to use all three zones (Zone 1, Zone 2, and Zone 3), new instances will be distributed across these zones as it scales, ensuring balanced distribution and improved resilience.</p>","tags":["Azure.Firewall.AvailabilityZone","AZR-000429"]},{"location":"en/rules/Azure.Firewall.AvailabilityZone/#recommendation","title":"Recommendation","text":"<p>To improve the resiliency of firewall instances against zone failures, it is recommended to use at least two (2) availability zones. This configuration enhances fault tolerance and ensures continued operation even if one zone experiences an outage.</p>","tags":["Azure.Firewall.AvailabilityZone","AZR-000429"]},{"location":"en/rules/Azure.Firewall.AvailabilityZone/#examples","title":"Examples","text":"","tags":["Azure.Firewall.AvailabilityZone","AZR-000429"]},{"location":"en/rules/Azure.Firewall.AvailabilityZone/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To set availability zones for a firewall:</p> <ul> <li>Set <code>zones</code> to a minimum of two zones from <code>[\"1\", \"2\", \"3\"]</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/azureFirewalls\",\n  \"apiVersion\": \"2023-11-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"sku\": {\n      \"name\": \"AZFW_VNet\",\n      \"tier\": \"Premium\"\n    },\n    \"firewallPolicy\": {\n      \"id\": \"[resourceId('Microsoft.Network/firewallPolicies', format('{0}_policy', parameters('name')))]\"\n    }\n  },\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ],\n  \"dependsOn\": [\n    \"firewall_policy\"\n  ]\n}\n</code></pre>","tags":["Azure.Firewall.AvailabilityZone","AZR-000429"]},{"location":"en/rules/Azure.Firewall.AvailabilityZone/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To set availability zones for a firewall:</p> <ul> <li>Set <code>zones</code> to a minimum of two zones from <code>[\"1\", \"2\", \"3\"]</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource firewall 'Microsoft.Network/azureFirewalls@2023-11-01' = {\n  name: name\n  location: location\n  properties: {\n    sku: {\n      name: 'AZFW_VNet'\n      tier: 'Premium'\n    }\n    firewallPolicy: {\n      id: firewall_policy.id\n    }\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n}\n</code></pre>","tags":["Azure.Firewall.AvailabilityZone","AZR-000429"]},{"location":"en/rules/Azure.Firewall.AvailabilityZone/#notes","title":"Notes","text":"<p>Availability zones must be configured during the initial deployment. It is not possible to modify an existing firewall to include availability zones after it has been deployed.</p>","tags":["Azure.Firewall.AvailabilityZone","AZR-000429"]},{"location":"en/rules/Azure.Firewall.AvailabilityZone/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>Availability zone support for Azure Firewall</li> <li>Azure regions with availability zone support</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.Firewall.AvailabilityZone","AZR-000429"]},{"location":"en/rules/Azure.Firewall.Mode/","title":"Configure deny on threat intel for classic managed Azure Firewalls","text":"Azure.Firewall.ModeAZR-000105Error <p> Security  \u00b7  Firewall  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls.</p>","tags":["Azure.Firewall.Mode","AZR-000105"]},{"location":"en/rules/Azure.Firewall.Mode/#description","title":"Description","text":"<p>Threat intelligence-based filtering can optionally be enabled on Azure Firewall. When enabled, Azure Firewall alerts and deny traffic to/ from known malicious IP addresses and domains.</p> <p>By default, Azure Firewall alerts on triggered threat intelligence rules.</p> <p>Specifically, this rule only applies using an Azure Firewall in classic management mode. If the Azure Firewall is connected to a Secured Virtual Hub this rule will not apply.</p> <p>Classic managed Azure Firewalls are standalone. Alternatively you can manage Azure Firewalls at scale through Firewall Manager by using policy. When using firewall policies, threat intelligence is configured centrally instead of on each firewall.</p>","tags":["Azure.Firewall.Mode","AZR-000105"]},{"location":"en/rules/Azure.Firewall.Mode/#recommendation","title":"Recommendation","text":"<p>Consider configuring Azure Firewall to alert and deny IP addresses and domains detected as malicious. Alternatively, consider using firewall policies to manage Azure Firewalls at scale.</p>","tags":["Azure.Firewall.Mode","AZR-000105"]},{"location":"en/rules/Azure.Firewall.Mode/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Firewalls that pass this rule:</p> <ul> <li>Set the <code>properties.threatIntelMode</code> property to <code>Deny</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Network/azureFirewalls\",\n    \"apiVersion\": \"2021-05-01\",\n    \"name\": \"[format('{0}_classic', parameters('name'))]\",\n    \"location\": \"[parameters('location')]\",\n    \"properties\": {\n        \"sku\": {\n            \"name\": \"AZFW_VNet\"\n        },\n        \"threatIntelMode\": \"Deny\"\n    }\n}\n</code></pre>","tags":["Azure.Firewall.Mode","AZR-000105"]},{"location":"en/rules/Azure.Firewall.Mode/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Firewalls that pass this rule:</p> <ul> <li>Set the <code>properties.threatIntelMode</code> property to <code>Deny</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource firewall_classic 'Microsoft.Network/azureFirewalls@2021-05-01' = {\n  name: '${name}_classic'\n  location: location\n  properties: {\n    sku: {\n      name: 'AZFW_VNet'\n    }\n    threatIntelMode: 'Deny'\n  }\n}\n</code></pre>","tags":["Azure.Firewall.Mode","AZR-000105"]},{"location":"en/rules/Azure.Firewall.Mode/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>Azure Firewall threat intelligence-based filtering</li> <li>Azure network security overview</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Firewall.Mode","AZR-000105"]},{"location":"en/rules/Azure.Firewall.Name/","title":"Use valid Firewall names","text":"Azure.Firewall.NameAZR-000103Error <p> Operational Excellence  \u00b7  Firewall  \u00b7  Rule  \u00b7  2021_12  \u00b7  Awareness</p> <p>Firewall names should meet naming requirements.</p>","tags":["Azure.Firewall.Name","AZR-000103"]},{"location":"en/rules/Azure.Firewall.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Firewall names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>Firewall names must be unique within a resource group.</li> </ul>","tags":["Azure.Firewall.Name","AZR-000103"]},{"location":"en/rules/Azure.Firewall.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Firewall naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.Firewall.Name","AZR-000103"]},{"location":"en/rules/Azure.Firewall.Name/#examples","title":"Examples","text":"","tags":["Azure.Firewall.Name","AZR-000103"]},{"location":"en/rules/Azure.Firewall.Name/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy firewalls that pass this rule:</p> <ul> <li>Set the <code>name</code> property to align to resource naming requirements.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/azureFirewalls\",\n  \"apiVersion\": \"2023-02-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"sku\": {\n      \"name\": \"AZFW_VNet\",\n      \"tier\": \"Premium\"\n    },\n    \"firewallPolicy\": {\n      \"id\": \"[resourceId('Microsoft.Network/firewallPolicies', format('{0}_policy', parameters('name')))]\"\n    }\n  },\n  \"dependsOn\": [\n    \"firewall_policy\"\n  ]\n}\n</code></pre>","tags":["Azure.Firewall.Name","AZR-000103"]},{"location":"en/rules/Azure.Firewall.Name/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy firewalls that pass this rule:</p> <ul> <li>Set the <code>name</code> property to align to resource naming requirements.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource firewall 'Microsoft.Network/azureFirewalls@2023-02-01' = {\n  name: name\n  location: location\n  properties: {\n    sku: {\n      name: 'AZFW_VNet'\n      tier: 'Premium'\n    }\n    firewallPolicy: {\n      id: firewall_policy.id\n    }\n  }\n}\n</code></pre>","tags":["Azure.Firewall.Name","AZR-000103"]},{"location":"en/rules/Azure.Firewall.Name/#notes","title":"Notes","text":"<p>This rule does not check if Firewall names are unique.</p>","tags":["Azure.Firewall.Name","AZR-000103"]},{"location":"en/rules/Azure.Firewall.Name/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> <li>Define your naming convention</li> <li>Resource naming and tagging decision guide</li> <li>Abbreviation examples for Azure resources</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Firewall.Name","AZR-000103"]},{"location":"en/rules/Azure.Firewall.PolicyMode/","title":"Threat intelligence-based filtering","text":"Azure.Firewall.PolicyModeAZR-000399Error <p> Security  \u00b7  Firewall  \u00b7  Rule  \u00b7  2023_09  \u00b7  Critical</p> <p>Deny high confidence malicious IP addresses, domains and URLs.</p>","tags":["Azure.Firewall.PolicyMode","AZR-000399"]},{"location":"en/rules/Azure.Firewall.PolicyMode/#description","title":"Description","text":"<p>Threat intelligence-based filtering can optionally be enabled on Azure Firewall, by associating one or more policies with threat intelligence-based filtering configured.</p> <p>When configured, Azure Firewall alerts and deny traffic to/from known malicious IP addresses, domains and URLs.</p> <p>By default, threat intelligence-based filtering is enabled and in <code>alert</code> mode on each policy unless otherwise is specified.</p> <p>By configuring threat intelligence-based filtering in <code>alert and deny</code> mode, threat intelligence-based filtering may deny traffic before any configured rules are processed.</p>","tags":["Azure.Firewall.PolicyMode","AZR-000399"]},{"location":"en/rules/Azure.Firewall.PolicyMode/#recommendation","title":"Recommendation","text":"<p>Consider configuring Azure Firewall to alert and deny IP addresses, domains and URLs detected as malicious.</p>","tags":["Azure.Firewall.PolicyMode","AZR-000399"]},{"location":"en/rules/Azure.Firewall.PolicyMode/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Firewall polices that pass this rule:</p> <ul> <li>Set the <code>properties.threatIntelMode</code> property to <code>Deny</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/firewallPolicies\",\n  \"apiVersion\": \"2023-04-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"sku\": {\n      \"tier\": \"Premium\"\n    },\n    \"threatIntelMode\": \"Deny\"\n  }\n}\n</code></pre>","tags":["Azure.Firewall.PolicyMode","AZR-000399"]},{"location":"en/rules/Azure.Firewall.PolicyMode/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Firewall polices that pass this rule:</p> <ul> <li>Set the <code>properties.threatIntelMode</code> property to <code>Deny</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource firewallPolicy 'Microsoft.Network/firewallPolicies@2023-04-01' = {\n  name: name\n  location: location\n  properties: {\n    sku: {\n      tier: 'Premium'\n    }\n    threatIntelMode: 'Deny'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/network/firewall-policy:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/network/firewall-policy:0.2.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Firewall.PolicyMode","AZR-000399"]},{"location":"en/rules/Azure.Firewall.PolicyMode/#notes","title":"Notes","text":"<p>Azure Firewall Premium SKU is required for associating standalone resource firewall policies. Only Standard and Premium firewall policies supports threat intelligence-based filtering in <code>alert and deny</code> mode.</p> <p>In order to take advantage of URL filtering with <code>HTTPS</code> traffic included in threat intelligence-based filtering, TLS inspection must be configured first.</p>","tags":["Azure.Firewall.PolicyMode","AZR-000399"]},{"location":"en/rules/Azure.Firewall.PolicyMode/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>NS-1: Establish network segmentation boundaries</li> <li>Azure Firewall threat intelligence-based filtering</li> <li>Rule processing logic</li> <li>Azure security baseline for Azure Firewall</li> <li>Azure network security overview</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Firewall.PolicyMode","AZR-000399"]},{"location":"en/rules/Azure.Firewall.PolicyName/","title":"Use valid Firewall policy names","text":"Azure.Firewall.PolicyNameAZR-000104Error <p> Operational Excellence  \u00b7  Firewall  \u00b7  Rule  \u00b7  2021_12  \u00b7  Awareness</p> <p>Firewall policy names should meet naming requirements.</p>","tags":["Azure.Firewall.PolicyName","AZR-000104"]},{"location":"en/rules/Azure.Firewall.PolicyName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Firewall policy names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>Firewall policy names must be unique within a resource group.</li> </ul>","tags":["Azure.Firewall.PolicyName","AZR-000104"]},{"location":"en/rules/Azure.Firewall.PolicyName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Firewall policy naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.Firewall.PolicyName","AZR-000104"]},{"location":"en/rules/Azure.Firewall.PolicyName/#notes","title":"Notes","text":"<p>This rule does not check if Firewall policy names are unique.</p>","tags":["Azure.Firewall.PolicyName","AZR-000104"]},{"location":"en/rules/Azure.Firewall.PolicyName/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> <li>Recommended abbreviations for Azure resource types</li> </ul>","tags":["Azure.Firewall.PolicyName","AZR-000104"]},{"location":"en/rules/Azure.FrontDoor.Logs/","title":"Audit Front Door Access","text":"Azure.FrontDoor.LogsAZR-000107Error <p> Security  \u00b7  Front Door  \u00b7  Rule  \u00b7  2024_03  \u00b7  Important</p> <p>Audit and monitor access through Azure Front Door profiles.</p>","tags":["Azure.FrontDoor.Logs","AZR-000107"]},{"location":"en/rules/Azure.FrontDoor.Logs/#description","title":"Description","text":"<p>Azure Front Door (AFD) supports logging network access to resources through the service. This includes access logs and web application firewall logs. Capturing these logs can help detect and respond to security threats as part of a security monitoring strategy. Additionally, many compliance standards require logging and monitoring of network access.</p> <p>Like all security monitoring, it is only effective if the logs are reviewed and correlated with other security events. Microsoft Sentinel can be used to analyze and correlate logs, or third-party solutions can be used.</p> <p>To capture network access events through Front Door, diagnostic settings must be configured. When configuring diagnostics settings enable collection of the following logs:</p> <ul> <li><code>FrontdoorAccessLog</code> - Can be used to monitor network activity and access through Front Door.</li> <li><code>FrontdoorWebApplicationFirewallLog</code> - Can be used to detect potential attacks, or false positive detections.   This log will be empty if a WAF policy is not configured.</li> </ul> <p>Management operations for Front Door is captured automatically within Azure Activity Logs.</p>","tags":["Azure.FrontDoor.Logs","AZR-000107"]},{"location":"en/rules/Azure.FrontDoor.Logs/#recommendation","title":"Recommendation","text":"<p>Consider configuring diagnostics setting to log network activity and access through Azure Front Door (AFD). Also consider correlating logs with other security events to detect and respond to security threats.</p>","tags":["Azure.FrontDoor.Logs","AZR-000107"]},{"location":"en/rules/Azure.FrontDoor.Logs/#examples","title":"Examples","text":"","tags":["Azure.FrontDoor.Logs","AZR-000107"]},{"location":"en/rules/Azure.FrontDoor.Logs/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Front Door Premium/ Standard profiles that passes this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource.<ul> <li>Enable logging for the <code>FrontdoorAccessLog</code> category.</li> <li>Enable logging for the <code>FrontdoorWebApplicationFirewallLog</code> category if a WAF policy is configured.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Insights/diagnosticSettings\",\n  \"apiVersion\": \"2021-05-01-preview\",\n  \"scope\": \"[format('Microsoft.Cdn/profiles/{0}', parameters('name'))]\",\n  \"name\": \"audit\",\n  \"properties\": {\n    \"workspaceId\": \"[parameters('workspaceId')]\",\n    \"logs\": [\n      {\n        \"category\": \"FrontdoorAccessLog\",\n        \"enabled\": true\n      },\n      {\n        \"category\": \"FrontdoorWebApplicationFirewallLog\",\n        \"enabled\": true\n      }\n    ]\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Cdn/profiles', parameters('name'))]\"\n  ]\n}\n</code></pre> <p>To deploy Azure Front Door Classic profiles that passes this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource.<ul> <li>Enable logging for the <code>FrontdoorAccessLog</code> category.</li> <li>Enable logging for the <code>FrontdoorWebApplicationFirewallLog</code> category if a WAF policy is configured.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Insights/diagnosticSettings\",\n  \"apiVersion\": \"2021-05-01-preview\",\n  \"scope\": \"[format('Microsoft.Network/frontDoors/{0}', parameters('name'))]\",\n  \"name\": \"audit\",\n  \"properties\": {\n    \"workspaceId\": \"[parameters('workspaceId')]\",\n    \"logs\": [\n      {\n        \"category\": \"FrontdoorAccessLog\",\n        \"enabled\": true\n      },\n      {\n        \"category\": \"FrontdoorWebApplicationFirewallLog\",\n        \"enabled\": true\n      }\n    ]\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Network/frontDoors', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.FrontDoor.Logs","AZR-000107"]},{"location":"en/rules/Azure.FrontDoor.Logs/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Front Door Premium/ Standard profiles that passes this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource.<ul> <li>Enable logging for the <code>FrontdoorAccessLog</code> category.</li> <li>Enable logging for the <code>FrontdoorWebApplicationFirewallLog</code> category.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource audit 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  name: 'audit'\n  scope: afd_profile\n  properties: {\n    workspaceId: workspaceId\n    logs: [\n      {\n        category: 'FrontdoorAccessLog'\n        enabled: true\n      }\n      {\n        category: 'FrontdoorWebApplicationFirewallLog'\n        enabled: true\n      }\n    ]\n  }\n}\n</code></pre> <p>To deploy Azure Front Door Classic profiles that passes this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource.<ul> <li>Enable logging for the <code>FrontdoorAccessLog</code> category.</li> <li>Enable logging for the <code>FrontdoorWebApplicationFirewallLog</code> category.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource audit_classic 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  name: 'audit'\n  scope: afd_classic\n  properties: {\n    workspaceId: workspaceId\n    logs: [\n      {\n        category: 'FrontdoorAccessLog'\n        enabled: true\n      }\n      {\n        category: 'FrontdoorWebApplicationFirewallLog'\n        enabled: true\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.FrontDoor.Logs","AZR-000107"]},{"location":"en/rules/Azure.FrontDoor.Logs/#notes","title":"Notes","text":"<p>This rule applies to Azure Front Door Premium/ Standard/ Classic profiles.</p>","tags":["Azure.FrontDoor.Logs","AZR-000107"]},{"location":"en/rules/Azure.FrontDoor.Logs/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>LT-4: Enable logging for security investigation</li> <li>Monitor metrics and logs in Azure Front Door</li> <li>Monitor metrics and logs in Azure Front Door Classic</li> <li>What is Microsoft Sentinel?</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.FrontDoor.Logs","AZR-000107"]},{"location":"en/rules/Azure.FrontDoor.ManagedIdentity/","title":"Managed identity","text":"Azure.FrontDoor.ManagedIdentityAZR-000396Error <p> Security  \u00b7  Front Door  \u00b7  Rule  \u00b7  2023_09  \u00b7  Important</p> <p>Ensure Front Door uses a managed identity to authorize access to Azure resources.</p>","tags":["Azure.FrontDoor.ManagedIdentity","AZR-000396"]},{"location":"en/rules/Azure.FrontDoor.ManagedIdentity/#description","title":"Description","text":"<p>When configuring a Standard or Premium SKU with a custom domain using bring your own certificate (BYOC) access to a Key Vault is required. Standard and Premium Front Door profiles support two methods for authorizing access to Azure resources:</p> <ol> <li>Using the Microsoft managed multi-tenant app registration.<ul> <li>Standard SKU profiles use the client ID <code>205478c0-bd83-4e1b-a9d6-db63a3e1e1c8</code>.</li> <li>Premium SKU profiles use the client ID <code>d4631ece-daab-479b-be77-ccb713491fc0</code>.</li> </ul> </li> <li>With a system or user assigned managed identity.</li> </ol> <p>The multi-tenant app registration has a number of challenges:</p> <ul> <li>Only a single client ID is used for each SKU for all Azure Front Door profiles.   If multiple Front Door profiles are deployed into a single subscription,   it is not possible to restrict access so that each profile has access to it's own Key Vault.</li> <li>A Entra ID (Azure AD) Global Administrator of must register the multi-tenant application for each tenant once before it can be used.</li> </ul> <p>Using an managed identity allows access to Key Vault to be granted using RBAC on an individual basis.</p>","tags":["Azure.FrontDoor.ManagedIdentity","AZR-000396"]},{"location":"en/rules/Azure.FrontDoor.ManagedIdentity/#recommendation","title":"Recommendation","text":"<p>Consider configure a managed identity to allow support for Azure AD authentication.</p>","tags":["Azure.FrontDoor.ManagedIdentity","AZR-000396"]},{"location":"en/rules/Azure.FrontDoor.ManagedIdentity/#examples","title":"Examples","text":"","tags":["Azure.FrontDoor.ManagedIdentity","AZR-000396"]},{"location":"en/rules/Azure.FrontDoor.ManagedIdentity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Front Door instances that pass this rule:</p> <ul> <li>Set <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code> or <code>SystemAssigned,UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code> or <code>SystemAssigned,UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Cdn/profiles\",\n  \"apiVersion\": \"2022-11-01-preview\",\n  \"name\": \"myFrontDoor\",\n  \"location\": \"global\",\n  \"sku\": {\n    \"name\": \"Standard_AzureFrontDoor\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\",\n    \"userAssignedIdentities\": {}\n  }\n}\n</code></pre>","tags":["Azure.FrontDoor.ManagedIdentity","AZR-000396"]},{"location":"en/rules/Azure.FrontDoor.ManagedIdentity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Front Door instances that pass this rule:</p> <ul> <li>Set <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code> or <code>SystemAssigned,UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code> or <code>SystemAssigned,UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource frontDoorProfile 'Microsoft.Cdn/profiles@2022-11-01-preview' = {\n  name: 'myFrontDoor'\n  location: 'global'\n  sku: {\n    name: 'Standard_AzureFrontDoor'\n  }\n  identity: {\n    type: 'SystemAssigned'\n    userAssignedIdentities: {}\n  }\n}\n</code></pre>","tags":["Azure.FrontDoor.ManagedIdentity","AZR-000396"]},{"location":"en/rules/Azure.FrontDoor.ManagedIdentity/#notes","title":"Notes","text":"<p>Currently Azure Front Door only supports authentication using an Entra ID (Azure AD) to Key Vault. To use a managed identity, the Standard or Premium SKU is required. Managed identities are not supported with the Classic SKU.</p> <p>If you only use Azure Front Door (AFD) managed certificates for custom domains, a managed identity is not required.</p>","tags":["Azure.FrontDoor.ManagedIdentity","AZR-000396"]},{"location":"en/rules/Azure.FrontDoor.ManagedIdentity/#links","title":"Links","text":"<ul> <li>Use identity-based authentication</li> <li>Managed identities for Azure Front Door</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.FrontDoor.ManagedIdentity","AZR-000396"]},{"location":"en/rules/Azure.FrontDoor.MinTLS/","title":"Front Door Minimum TLS","text":"Azure.FrontDoor.MinTLSAZR-000106Error <p> Security  \u00b7  Front Door  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Front Door Classic instances should reject TLS versions older than 1.2.</p>","tags":["Azure.FrontDoor.MinTLS","AZR-000106"]},{"location":"en/rules/Azure.FrontDoor.MinTLS/#description","title":"Description","text":"<p>The minimum version of TLS that Azure Front Door accepts is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS.</p> <p>Front Door lets you disable outdated protocols and enforce TLS 1.2. By default, a minimum of TLS 1.2 is enforced.</p>","tags":["Azure.FrontDoor.MinTLS","AZR-000106"]},{"location":"en/rules/Azure.FrontDoor.MinTLS/#recommendation","title":"Recommendation","text":"<p>Consider configuring the minimum supported TLS version to be 1.2 for each endpoint. This applies to Azure Front Door Classic instances only.</p>","tags":["Azure.FrontDoor.MinTLS","AZR-000106"]},{"location":"en/rules/Azure.FrontDoor.MinTLS/#examples","title":"Examples","text":"","tags":["Azure.FrontDoor.MinTLS","AZR-000106"]},{"location":"en/rules/Azure.FrontDoor.MinTLS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy a Front Door resource that passes this rule:</p> <ul> <li>Set each <code>properties.frontendEndpoints[*].properties.customHttpsConfiguration.minimumTlsVersion</code> property to <code>1.2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/frontDoors\",\n  \"apiVersion\": \"2021-06-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"global\",\n  \"properties\": {\n    \"enabledState\": \"Enabled\",\n    \"frontendEndpoints\": [\n      {\n        \"name\": \"[variables('frontEndEndpointName')]\",\n        \"properties\": {\n          \"hostName\": \"[format('{0}.azurefd.net', parameters('name'))]\",\n          \"sessionAffinityEnabledState\": \"Disabled\",\n          \"customHttpsConfiguration\": {\n            \"minimumTlsVersion\": \"1.2\"\n          }\n        }\n      }\n    ],\n    \"loadBalancingSettings\": \"[variables('loadBalancingSettings')]\",\n    \"backendPools\": \"[variables('backendPools')]\",\n    \"healthProbeSettings\": \"[variables('healthProbeSettings')]\",\n    \"routingRules\": \"[variables('routingRules')]\"\n  }\n}\n</code></pre>","tags":["Azure.FrontDoor.MinTLS","AZR-000106"]},{"location":"en/rules/Azure.FrontDoor.MinTLS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy a Front Door resource that passes this rule:</p> <ul> <li>Set each <code>properties.frontendEndpoints[*].properties.customHttpsConfiguration.minimumTlsVersion</code> property to <code>1.2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource afd_classic 'Microsoft.Network/frontDoors@2021-06-01' = {\n  name: name\n  location: 'global'\n  properties: {\n    enabledState: 'Enabled'\n    frontendEndpoints: [\n      {\n        name: frontEndEndpointName\n        properties: {\n          hostName: '${name}.azurefd.net'\n          sessionAffinityEnabledState: 'Disabled'\n          customHttpsConfiguration: {\n            minimumTlsVersion: '1.2'\n          }\n        }\n      }\n    ]\n    loadBalancingSettings: loadBalancingSettings\n    backendPools: backendPools\n    healthProbeSettings: healthProbeSettings\n    routingRules: routingRules\n  }\n}\n</code></pre>","tags":["Azure.FrontDoor.MinTLS","AZR-000106"]},{"location":"en/rules/Azure.FrontDoor.MinTLS/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Preparing for TLS 1.2 in Microsoft Azure</li> <li>Supported TLS versions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.FrontDoor.MinTLS","AZR-000106"]},{"location":"en/rules/Azure.FrontDoor.Name/","title":"Use valid Front Door names","text":"Azure.FrontDoor.NameAZR-000113Error <p> Operational Excellence  \u00b7  Front Door  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Front Door names should meet naming requirements.</p>","tags":["Azure.FrontDoor.Name","AZR-000113"]},{"location":"en/rules/Azure.FrontDoor.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Front Door names are:</p> <ul> <li>Between 5 and 64 characters long.</li> <li>Alphanumerics and hyphens.</li> <li>Start and end with alphanumeric.</li> <li>Front Door names must be globally unique.</li> </ul>","tags":["Azure.FrontDoor.Name","AZR-000113"]},{"location":"en/rules/Azure.FrontDoor.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Front Door naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.FrontDoor.Name","AZR-000113"]},{"location":"en/rules/Azure.FrontDoor.Name/#notes","title":"Notes","text":"<p>This rule does not check if Front Door names are unique.</p>","tags":["Azure.FrontDoor.Name","AZR-000113"]},{"location":"en/rules/Azure.FrontDoor.Name/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> <li>Recommended abbreviations for Azure resource types</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.FrontDoor.Name","AZR-000113"]},{"location":"en/rules/Azure.FrontDoor.Probe/","title":"Use Health Probes for Front Door backends","text":"Azure.FrontDoor.ProbeAZR-000108Error <p> Reliability  \u00b7  Front Door  \u00b7  Rule  \u00b7  2021_03  \u00b7  Important</p> <p>Use health probes to check the health of each backend.</p>","tags":["Azure.FrontDoor.Probe","AZR-000108"]},{"location":"en/rules/Azure.FrontDoor.Probe/#description","title":"Description","text":"<p>The health and performance of an application can degrade over time. Degradation might not be noticeable until the application fails.</p> <p>Azure Front Door can use periodic health probes against backend endpoints to determine health status. When one or more backend in a pool is healthy traffic is routed to healthy endpoints only. If all endpoints in a pool is unhealthy Front Door sends the request to any enabled endpoint.</p> <p>Health probes allow Front Door to select a backend endpoint able to respond to the request.</p>","tags":["Azure.FrontDoor.Probe","AZR-000108"]},{"location":"en/rules/Azure.FrontDoor.Probe/#recommendation","title":"Recommendation","text":"<p>Consider configuring and enabling a health probe for each Front Door backend.</p>","tags":["Azure.FrontDoor.Probe","AZR-000108"]},{"location":"en/rules/Azure.FrontDoor.Probe/#examples","title":"Examples","text":"","tags":["Azure.FrontDoor.Probe","AZR-000108"]},{"location":"en/rules/Azure.FrontDoor.Probe/#configure-with-azure-template","title":"Configure with Azure template","text":"Premium / StandardClassic <p>To deploy a Front Door resource that passes this rule:</p> <ul> <li>Configure the <code>properties.healthProbeSettings</code> property of the <code>originGroups</code> sub-resource.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Cdn/profiles\",\n  \"apiVersion\": \"2021-06-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"Global\",\n  \"sku\": {\n    \"name\": \"Premium_AzureFrontDoor\"\n  }\n},\n{\n  \"type\": \"Microsoft.Cdn/profiles/originGroups\",\n  \"apiVersion\": \"2021-06-01\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), parameters('name'))]\",\n  \"properties\": {\n    \"loadBalancingSettings\": {\n      \"sampleSize\": 4,\n      \"successfulSamplesRequired\": 3\n    },\n    \"healthProbeSettings\": {\n      \"probePath\": \"/healthz\",\n      \"probeRequestType\": \"HEAD\",\n      \"probeProtocol\": \"Http\",\n      \"probeIntervalInSeconds\": 100\n    }\n  },\n  \"dependsOn\": [\n    \"[parameters('name')]\"\n  ]\n}\n</code></pre> <p>To deploy a Front Door resource that passes this rule:</p> <ul> <li>Set each <code>properties.healthProbeSettings[*].properties.enabledState</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/frontDoors\",\n  \"apiVersion\": \"2021-06-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"global\",\n  \"properties\": {\n    \"enabledState\": \"Enabled\",\n    \"frontendEndpoints\": \"[variables('frontendEndpoints')]\",\n    \"loadBalancingSettings\": \"[variables('loadBalancingSettings')]\",\n    \"backendPools\": \"[variables('backendPools')]\",\n    \"healthProbeSettings\": [\n      {\n        \"name\": \"[variables('healthProbeSettingsName')]\",\n        \"properties\": {\n          \"enabledState\": \"Enabled\",\n          \"path\": \"/healthz\",\n          \"protocol\": \"Http\",\n          \"intervalInSeconds\": 120,\n          \"healthProbeMethod\": \"HEAD\"\n        }\n      }\n    ],\n    \"routingRules\": \"[variables('routingRules')]\"\n  }\n}\n</code></pre>","tags":["Azure.FrontDoor.Probe","AZR-000108"]},{"location":"en/rules/Azure.FrontDoor.Probe/#configure-with-bicep","title":"Configure with Bicep","text":"Premium / StandardClassic <p>To deploy a Front Door resource that passes this rule:</p> <ul> <li>Configure the <code>properties.healthProbeSettings</code> property of the <code>originGroups</code> sub-resource.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource afd_premium 'Microsoft.Cdn/profiles@2021-06-01' = {\n  name: name\n  location: 'Global'\n  sku: {\n    name: 'Premium_AzureFrontDoor'\n  }\n}\n\nresource frontDoorOriginGroup 'Microsoft.Cdn/profiles/originGroups@2021-06-01' = {\n  name: name\n  parent: afd_premium\n  properties: {\n    loadBalancingSettings: {\n      sampleSize: 4\n      successfulSamplesRequired: 3\n    }\n    healthProbeSettings: {\n      probePath: '/healthz'\n      probeRequestType: 'HEAD'\n      probeProtocol: 'Http'\n      probeIntervalInSeconds: 100\n    }\n  }\n}\n</code></pre> <p>To deploy a Front Door resource that passes this rule:</p> <ul> <li>Set each <code>properties.healthProbeSettings[*].properties.enabledState</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource afd_classic 'Microsoft.Network/frontDoors@2021-06-01' = {\n  name: name\n  location: 'global'\n  properties: {\n    enabledState: 'Enabled'\n    frontendEndpoints: frontendEndpoints\n    loadBalancingSettings: loadBalancingSettings\n    backendPools: backendPools\n    healthProbeSettings: [\n      {\n        name: healthProbeSettingsName\n        properties: {\n          enabledState: 'Enabled'\n          path: '/healthz'\n          protocol: 'Http'\n          intervalInSeconds: 120\n          healthProbeMethod: 'HEAD'\n        }\n      }\n    ]\n    routingRules: routingRules\n  }\n}\n</code></pre>","tags":["Azure.FrontDoor.Probe","AZR-000108"]},{"location":"en/rules/Azure.FrontDoor.Probe/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az network front-door probe update --front-door-name '&lt;front_door&gt;' -n '&lt;probe_name&gt;' -g '&lt;resource_group&gt;' --enabled 'Enabled' --path '/healthz'\n</code></pre>","tags":["Azure.FrontDoor.Probe","AZR-000108"]},{"location":"en/rules/Azure.FrontDoor.Probe/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>$probeSetting = New-AzFrontDoorHealthProbeSettingObject -Name '&lt;probe_name&gt;' -EnabledState 'Enabled' -Path '/healthz'\nSet-AzFrontDoor -Name '&lt;front_door&gt;' -ResourceGroupName '&lt;resource_group&gt;' -HealthProbeSetting $probeSetting\n</code></pre>","tags":["Azure.FrontDoor.Probe","AZR-000108"]},{"location":"en/rules/Azure.FrontDoor.Probe/#links","title":"Links","text":"<ul> <li>Creating good health probes</li> <li>Health probes</li> <li>Supported HTTP methods for health probes</li> <li>How Front Door determines backend health</li> <li>Health Endpoint Monitoring pattern</li> <li>Azure deployment reference (Premium / Standard)</li> <li>Azure deployment reference (Classic)</li> </ul>","tags":["Azure.FrontDoor.Probe","AZR-000108"]},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/","title":"Use HEAD health probes for Front Door backends","text":"Azure.FrontDoor.ProbeMethodAZR-000109Error <p> Reliability  \u00b7  Front Door  \u00b7  Rule  \u00b7  2021_03  \u00b7  Important</p> <p>Configure health probes to use <code>HEAD</code> requests to reduce performance overhead.</p>","tags":["Azure.FrontDoor.ProbeMethod","AZR-000109"]},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/#description","title":"Description","text":"<p>Azure Front Door supports sending <code>HEAD</code> or <code>GET</code> requests for health probes to backend endpoints. HTTP <code>HEAD</code> requests are identical to <code>GET</code> requests except that the server does not send a response body. As a result, <code>HEAD</code> request typically have a lower performance impact then <code>GET</code> request.</p> <p>By eliminating a response body:</p> <ul> <li>The server has a smaller payload to return.</li> <li>May be able to further optimize the request by reducing calls to APIs or databases.</li> </ul>","tags":["Azure.FrontDoor.ProbeMethod","AZR-000109"]},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/#recommendation","title":"Recommendation","text":"<p>Consider configuring health probes to query backend health endpoints using <code>HEAD</code> requests to reduce performance overhead.</p>","tags":["Azure.FrontDoor.ProbeMethod","AZR-000109"]},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/#examples","title":"Examples","text":"","tags":["Azure.FrontDoor.ProbeMethod","AZR-000109"]},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/#configure-with-azure-template","title":"Configure with Azure template","text":"Premium / StandardClassic <p>To deploy a Front Door resource that passes this rule:</p> <ul> <li>Set the <code>properties.healthProbeSettings.probeRequestType</code> property to <code>HEAD</code> of the <code>originGroups</code> sub-resource.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Cdn/profiles\",\n  \"apiVersion\": \"2021-06-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"Global\",\n  \"sku\": {\n    \"name\": \"Premium_AzureFrontDoor\"\n  }\n},\n{\n  \"type\": \"Microsoft.Cdn/profiles/originGroups\",\n  \"apiVersion\": \"2021-06-01\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), parameters('name'))]\",\n  \"properties\": {\n    \"loadBalancingSettings\": {\n      \"sampleSize\": 4,\n      \"successfulSamplesRequired\": 3\n    },\n    \"healthProbeSettings\": {\n      \"probePath\": \"/healthz\",\n      \"probeRequestType\": \"HEAD\",\n      \"probeProtocol\": \"Http\",\n      \"probeIntervalInSeconds\": 100\n    }\n  },\n  \"dependsOn\": [\n    \"[parameters('name')]\"\n  ]\n}\n</code></pre> <p>To deploy a Front Door resource that passes this rule:</p> <ul> <li>Set each <code>properties.healthProbeSettings[*].properties.healthProbeMethod</code> property to <code>HEAD</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/frontDoors\",\n  \"apiVersion\": \"2021-06-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"global\",\n  \"properties\": {\n    \"enabledState\": \"Enabled\",\n    \"frontendEndpoints\": \"[variables('frontendEndpoints')]\",\n    \"loadBalancingSettings\": \"[variables('loadBalancingSettings')]\",\n    \"backendPools\": \"[variables('backendPools')]\",\n    \"healthProbeSettings\": [\n      {\n        \"name\": \"[variables('healthProbeSettingsName')]\",\n        \"properties\": {\n          \"enabledState\": \"Enabled\",\n          \"path\": \"/healthz\",\n          \"protocol\": \"Http\",\n          \"intervalInSeconds\": 120,\n          \"healthProbeMethod\": \"HEAD\"\n        }\n      }\n    ],\n    \"routingRules\": \"[variables('routingRules')]\"\n  }\n}\n</code></pre>","tags":["Azure.FrontDoor.ProbeMethod","AZR-000109"]},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/#configure-with-bicep","title":"Configure with Bicep","text":"Premium / StandardClassic <p>To deploy a Front Door resource that passes this rule:</p> <ul> <li>Set the <code>properties.healthProbeSettings.probeRequestType</code> property to <code>HEAD</code> of the <code>originGroups</code> sub-resource.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource afd_premium 'Microsoft.Cdn/profiles@2021-06-01' = {\n  name: name\n  location: 'Global'\n  sku: {\n    name: 'Premium_AzureFrontDoor'\n  }\n}\n\nresource frontDoorOriginGroup 'Microsoft.Cdn/profiles/originGroups@2021-06-01' = {\n  name: name\n  parent: afd_premium\n  properties: {\n    loadBalancingSettings: {\n      sampleSize: 4\n      successfulSamplesRequired: 3\n    }\n    healthProbeSettings: {\n      probePath: '/healthz'\n      probeRequestType: 'HEAD'\n      probeProtocol: 'Http'\n      probeIntervalInSeconds: 100\n    }\n  }\n}\n</code></pre> <p>To deploy a Front Door resource that passes this rule:</p> <ul> <li>Set each <code>properties.healthProbeSettings[*].properties.healthProbeMethod</code> property to <code>HEAD</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource afd_classic 'Microsoft.Network/frontDoors@2021-06-01' = {\n  name: name\n  location: 'global'\n  properties: {\n    enabledState: 'Enabled'\n    frontendEndpoints: frontendEndpoints\n    loadBalancingSettings: loadBalancingSettings\n    backendPools: backendPools\n    healthProbeSettings: [\n      {\n        name: healthProbeSettingsName\n        properties: {\n          enabledState: 'Enabled'\n          path: '/healthz'\n          protocol: 'Http'\n          intervalInSeconds: 120\n          healthProbeMethod: 'HEAD'\n        }\n      }\n    ]\n    routingRules: routingRules\n  }\n}\n</code></pre>","tags":["Azure.FrontDoor.ProbeMethod","AZR-000109"]},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az network front-door probe update --front-door-name '&lt;front_door&gt;' -n '&lt;probe_name&gt;' -g '&lt;resource_group&gt;' --probeMethod 'HEAD' --path '/healthz'\n</code></pre>","tags":["Azure.FrontDoor.ProbeMethod","AZR-000109"]},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>$probeSetting = New-AzFrontDoorHealthProbeSettingObject -Name '&lt;probe_name&gt;' -HealthProbeMethod 'HEAD' -Path '/healthz'\nSet-AzFrontDoor -Name '&lt;front_door&gt;' -ResourceGroupName '&lt;resource_group&gt;' -HealthProbeSetting $probeSetting\n</code></pre>","tags":["Azure.FrontDoor.ProbeMethod","AZR-000109"]},{"location":"en/rules/Azure.FrontDoor.ProbeMethod/#links","title":"Links","text":"<ul> <li>Creating good health probes</li> <li>Health probes</li> <li>Supported HTTP methods for health probes</li> <li>How Front Door determines backend health</li> <li>Health Endpoint Monitoring pattern</li> <li>Azure deployment reference (Premium / Standard)</li> <li>Azure deployment reference (Classic)</li> </ul>","tags":["Azure.FrontDoor.ProbeMethod","AZR-000109"]},{"location":"en/rules/Azure.FrontDoor.ProbePath/","title":"Use a Dedicated Health Endpoint for Front Door backends","text":"Azure.FrontDoor.ProbePathAZR-000110Error <p> Reliability  \u00b7  Front Door  \u00b7  Rule  \u00b7  2021_03  \u00b7  Important</p> <p>Configure a dedicated path for health probe requests.</p>","tags":["Azure.FrontDoor.ProbePath","AZR-000110"]},{"location":"en/rules/Azure.FrontDoor.ProbePath/#description","title":"Description","text":"<p>Azure Front Door monitors a specific path for each backend to determine health status. The monitored path should implement functional checks to determine if the backend is performing correctly. The checks should include dependencies including those that may not be regularly called.</p> <p>Regular checks of the monitored path allow Front Door to make load balancing decisions based on status.</p>","tags":["Azure.FrontDoor.ProbePath","AZR-000110"]},{"location":"en/rules/Azure.FrontDoor.ProbePath/#recommendation","title":"Recommendation","text":"<p>Consider using a dedicated health probe endpoint that implements functional checks.</p>","tags":["Azure.FrontDoor.ProbePath","AZR-000110"]},{"location":"en/rules/Azure.FrontDoor.ProbePath/#examples","title":"Examples","text":"","tags":["Azure.FrontDoor.ProbePath","AZR-000110"]},{"location":"en/rules/Azure.FrontDoor.ProbePath/#configure-with-azure-template","title":"Configure with Azure template","text":"Premium / StandardClassic <p>To deploy a Front Door resource that passes this rule:</p> <ul> <li>Set the <code>properties.healthProbeSettings.probePath</code> property to a dedicated path of the <code>originGroups</code> sub-resource.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Cdn/profiles\",\n  \"apiVersion\": \"2021-06-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"Global\",\n  \"sku\": {\n    \"name\": \"Premium_AzureFrontDoor\"\n  }\n},\n{\n  \"type\": \"Microsoft.Cdn/profiles/originGroups\",\n  \"apiVersion\": \"2021-06-01\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), parameters('name'))]\",\n  \"properties\": {\n    \"loadBalancingSettings\": {\n      \"sampleSize\": 4,\n      \"successfulSamplesRequired\": 3\n    },\n    \"healthProbeSettings\": {\n      \"probePath\": \"/healthz\",\n      \"probeRequestType\": \"HEAD\",\n      \"probeProtocol\": \"Http\",\n      \"probeIntervalInSeconds\": 100\n    }\n  },\n  \"dependsOn\": [\n    \"[parameters('name')]\"\n  ]\n}\n</code></pre> <p>To deploy a Front Door resource that passes this rule:</p> <ul> <li>Set each <code>properties.healthProbeSettings[*].properties.path</code> property to a dedicated path.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/frontDoors\",\n  \"apiVersion\": \"2021-06-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"global\",\n  \"properties\": {\n    \"enabledState\": \"Enabled\",\n    \"frontendEndpoints\": \"[variables('frontendEndpoints')]\",\n    \"loadBalancingSettings\": \"[variables('loadBalancingSettings')]\",\n    \"backendPools\": \"[variables('backendPools')]\",\n    \"healthProbeSettings\": [\n      {\n        \"name\": \"[variables('healthProbeSettingsName')]\",\n        \"properties\": {\n          \"enabledState\": \"Enabled\",\n          \"path\": \"/healthz\",\n          \"protocol\": \"Http\",\n          \"intervalInSeconds\": 120,\n          \"healthProbeMethod\": \"HEAD\"\n        }\n      }\n    ],\n    \"routingRules\": \"[variables('routingRules')]\"\n  }\n}\n</code></pre>","tags":["Azure.FrontDoor.ProbePath","AZR-000110"]},{"location":"en/rules/Azure.FrontDoor.ProbePath/#configure-with-bicep","title":"Configure with Bicep","text":"Premium / StandardClassic <p>To deploy a Front Door resource that passes this rule:</p> <ul> <li>Set the <code>properties.healthProbeSettings.probePath</code> property to a dedicated path of the <code>originGroups</code> sub-resource.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource afd_premium 'Microsoft.Cdn/profiles@2021-06-01' = {\n  name: name\n  location: 'Global'\n  sku: {\n    name: 'Premium_AzureFrontDoor'\n  }\n}\n\nresource frontDoorOriginGroup 'Microsoft.Cdn/profiles/originGroups@2021-06-01' = {\n  name: name\n  parent: afd_premium\n  properties: {\n    loadBalancingSettings: {\n      sampleSize: 4\n      successfulSamplesRequired: 3\n    }\n    healthProbeSettings: {\n      probePath: '/healthz'\n      probeRequestType: 'HEAD'\n      probeProtocol: 'Http'\n      probeIntervalInSeconds: 100\n    }\n  }\n}\n</code></pre> <p>To deploy a Front Door resource that passes this rule:</p> <ul> <li>Set each <code>properties.healthProbeSettings[*].properties.path</code> property to a dedicated path.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource afd_classic 'Microsoft.Network/frontDoors@2021-06-01' = {\n  name: name\n  location: 'global'\n  properties: {\n    enabledState: 'Enabled'\n    frontendEndpoints: frontendEndpoints\n    loadBalancingSettings: loadBalancingSettings\n    backendPools: backendPools\n    healthProbeSettings: [\n      {\n        name: healthProbeSettingsName\n        properties: {\n          enabledState: 'Enabled'\n          path: '/healthz'\n          protocol: 'Http'\n          intervalInSeconds: 120\n          healthProbeMethod: 'HEAD'\n        }\n      }\n    ]\n    routingRules: routingRules\n  }\n}\n</code></pre>","tags":["Azure.FrontDoor.ProbePath","AZR-000110"]},{"location":"en/rules/Azure.FrontDoor.ProbePath/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az network front-door probe update --front-door-name '&lt;front_door&gt;' -n '&lt;probe_name&gt;' -g '&lt;resource_group&gt;' --path '/healthz'\n</code></pre>","tags":["Azure.FrontDoor.ProbePath","AZR-000110"]},{"location":"en/rules/Azure.FrontDoor.ProbePath/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>$probeSetting = New-AzFrontDoorHealthProbeSettingObject -Name '&lt;probe_name&gt;' -Path '/healthz'\nSet-AzFrontDoor -Name '&lt;front_door&gt;' -ResourceGroupName '&lt;resource_group&gt;' -HealthProbeSetting $probeSetting\n</code></pre>","tags":["Azure.FrontDoor.ProbePath","AZR-000110"]},{"location":"en/rules/Azure.FrontDoor.ProbePath/#links","title":"Links","text":"<ul> <li>Creating good health probes</li> <li>Health probes</li> <li>Supported HTTP methods for health probes</li> <li>How Front Door determines backend health</li> <li>Health Endpoint Monitoring pattern</li> <li>Azure deployment reference (Premium / Standard)</li> <li>Azure deployment reference (Classic)</li> </ul>","tags":["Azure.FrontDoor.ProbePath","AZR-000110"]},{"location":"en/rules/Azure.FrontDoor.State/","title":"Enable Front Door Classic instance","text":"Azure.FrontDoor.StateAZR-000112Error <p> Cost Optimization  \u00b7  Front Door  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Enable Azure Front Door Classic instance.</p>","tags":["Azure.FrontDoor.State","AZR-000112"]},{"location":"en/rules/Azure.FrontDoor.State/#description","title":"Description","text":"<p>The operational state of a Front Door Classic instance is configurable, either enabled or disabled. By default, a Front Door is enabled.</p> <p>Optionally, a Front Door Classic instance may be disabled to temporarily prevent traffic being processed.</p>","tags":["Azure.FrontDoor.State","AZR-000112"]},{"location":"en/rules/Azure.FrontDoor.State/#recommendation","title":"Recommendation","text":"<p>Consider enabling the Front Door service or remove the instance if it is no longer required. This applies to Azure Front Door Classic instances only.</p>","tags":["Azure.FrontDoor.State","AZR-000112"]},{"location":"en/rules/Azure.FrontDoor.State/#examples","title":"Examples","text":"","tags":["Azure.FrontDoor.State","AZR-000112"]},{"location":"en/rules/Azure.FrontDoor.State/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy a Front Door resource that passes this rule:</p> <ul> <li>Set the <code>properties.enabledState</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/frontDoors\",\n  \"apiVersion\": \"2021-06-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"global\",\n  \"properties\": {\n    \"enabledState\": \"Enabled\",\n    \"frontendEndpoints\": \"[variables('frontendEndpoints')]\",\n    \"loadBalancingSettings\": \"[variables('loadBalancingSettings')]\",\n    \"backendPools\": \"[variables('backendPools')]\",\n    \"healthProbeSettings\": \"[variables('healthProbeSettings')]\",\n    \"routingRules\": \"[variables('routingRules')]\"\n  }\n}\n</code></pre>","tags":["Azure.FrontDoor.State","AZR-000112"]},{"location":"en/rules/Azure.FrontDoor.State/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy a Front Door resource that passes this rule:</p> <ul> <li>Set the <code>properties.enabledState</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource afd_classic 'Microsoft.Network/frontDoors@2021-06-01' = {\n  name: name\n  location: 'global'\n  properties: {\n    enabledState: 'Enabled'\n    frontendEndpoints: frontendEndpoints\n    loadBalancingSettings: loadBalancingSettings\n    backendPools: backendPools\n    healthProbeSettings: healthProbeSettings\n    routingRules: routingRules\n  }\n}\n</code></pre>","tags":["Azure.FrontDoor.State","AZR-000112"]},{"location":"en/rules/Azure.FrontDoor.State/#links","title":"Links","text":"<ul> <li>CO:14 Consolidation</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.FrontDoor.State","AZR-000112"]},{"location":"en/rules/Azure.FrontDoor.UseCaching/","title":"Use caching","text":"Azure.FrontDoor.UseCachingAZR-000320Error <p> Performance Efficiency  \u00b7  Front Door  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Use caching to reduce retrieving contents from origins.</p>","tags":["Azure.FrontDoor.UseCaching","AZR-000320"]},{"location":"en/rules/Azure.FrontDoor.UseCaching/#description","title":"Description","text":"<p>Azure Front Door delivers large files without a cap on file size. Front Door uses a technique called object chunking. When a large file is requested, Front Door retrieves smaller pieces of the file from the backend. After receiving a full or byte-range file request, the Front Door environment requests the file from the backend in chunks of 8 MB.</p> <p>After the chunk arrives at the Front Door environment, it's cached and immediately served to the user. Front Door then pre-fetches the next chunk in parallel. This pre-fetch ensures that the content stays one chunk ahead of the user, which reduces latency. This process continues until the entire file gets downloaded (if requested) or the client closes the connection.</p> <p>For more information on the byte-range request, read RFC 7233. Front Door caches any chunks as they're received so the entire file doesn't need to be cached on the Front Door cache. Ensuing requests for the file or byte ranges are served from the cache. If the chunks aren't all cached, pre-fetching is used to request chunks from the backend. This optimization relies on the backend's ability to support byte-range requests. If the backend doesn't support byte-range requests, this optimization isn't effective.</p>","tags":["Azure.FrontDoor.UseCaching","AZR-000320"]},{"location":"en/rules/Azure.FrontDoor.UseCaching/#recommendation","title":"Recommendation","text":"<p>Use caching to reduce retrieving contents from origins and improve overall performance.</p>","tags":["Azure.FrontDoor.UseCaching","AZR-000320"]},{"location":"en/rules/Azure.FrontDoor.UseCaching/#examples","title":"Examples","text":"","tags":["Azure.FrontDoor.UseCaching","AZR-000320"]},{"location":"en/rules/Azure.FrontDoor.UseCaching/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy front door instances pass this rule:</p> <ul> <li>Configure <code>properties.routingRules.properties.routeConfiguration.cacheConfiguration</code>.</li> </ul> <p>Important The rule checks also for rule sets (child resources) that are overwriting the cache configuration from routing rules. Check the link <code>Routing architecture overview</code> for more information around this.</p> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/frontDoors\",\n  \"apiVersion\": \"2021-06-01\",\n  \"name\": \"[parameters('frontDoorName')]\",\n  \"location\": \"global\",\n  \"properties\": {\n    \"enabledState\": \"Enabled\",\n    \"frontendEndpoints\": [\n      {\n        \"name\": \"[variables('frontEndEndpointName')]\",\n        \"properties\": {\n          \"hostName\": \"[format('{0}.azurefd.net', parameters('frontDoorName'))]\",\n          \"sessionAffinityEnabledState\": \"Disabled\"\n        }\n      }\n    ],\n    \"loadBalancingSettings\": [\n      {\n        \"name\": \"[variables('loadBalancingSettingsName')]\",\n        \"properties\": {\n          \"sampleSize\": 4,\n          \"successfulSamplesRequired\": 2\n        }\n      }\n    ],\n    \"healthProbeSettings\": [\n      {\n        \"name\": \"[variables('healthProbeSettingsName')]\",\n        \"properties\": {\n          \"path\": \"/\",\n          \"protocol\": \"Http\",\n          \"intervalInSeconds\": 120\n        }\n      }\n    ],\n    \"backendPools\": [\n      {\n        \"name\": \"[variables('backendPoolName')]\",\n        \"properties\": {\n          \"backends\": [\n            {\n              \"address\": \"[parameters('backendAddress')]\",\n              \"backendHostHeader\": \"[parameters('backendAddress')]\",\n              \"httpPort\": 80,\n              \"httpsPort\": 443,\n              \"weight\": 50,\n              \"priority\": 1,\n              \"enabledState\": \"Enabled\"\n            }\n          ],\n          \"loadBalancingSettings\": {\n            \"id\": \"[resourceId('Microsoft.Network/frontDoors/loadBalancingSettings', parameters('frontDoorName'), variables('loadBalancingSettingsName'))]\"\n          },\n          \"healthProbeSettings\": {\n            \"id\": \"[resourceId('Microsoft.Network/frontDoors/healthProbeSettings', parameters('frontDoorName'), variables('healthProbeSettingsName'))]\"\n          }\n        }\n      }\n    ],\n    \"routingRules\": [\n      {\n        \"name\": \"[variables('routingRuleName')]\",\n        \"properties\": {\n          \"frontendEndpoints\": [\n            {\n              \"id\": \"[resourceId('Microsoft.Network/frontDoors/frontEndEndpoints', parameters('frontDoorName'), variables('frontEndEndpointName'))]\"\n            }\n          ],\n          \"acceptedProtocols\": [\n            \"Http\",\n            \"Https\"\n          ],\n          \"patternsToMatch\": [\n            \"/*\"\n          ],\n          \"routeConfiguration\": {\n            \"@odata.type\": \"#Microsoft.Azure.FrontDoor.Models.FrontdoorForwardingConfiguration\",\n            \"cacheConfiguration\": {\n              \"cacheDuration\": \"P12DT1H\",\n              \"dynamicCompression\": \"Disabled\",\n              \"queryParameters\": \"customerId\",\n              \"queryParameterStripDirective\": \"StripAll\"\n            },\n            \"forwardingProtocol\": \"MatchRequest\",\n            \"backendPool\": {\n              \"id\": \"[resourceId('Microsoft.Network/frontDoors/backEndPools', parameters('frontDoorName'), variables('backendPoolName'))]\"\n            }\n          },\n          \"enabledState\": \"Enabled\"\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.FrontDoor.UseCaching","AZR-000320"]},{"location":"en/rules/Azure.FrontDoor.UseCaching/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy front door instances pass this rule:</p> <ul> <li>Configure <code>properties.routingRules.properties.routeConfiguration.cacheConfiguration</code>.</li> </ul> <p>Important The rule checks also for rule sets (child resources) that are overwriting the cache configuration from routing rules. Check the link <code>Routing architecture overview</code> for more information around this.</p> <p>For example:</p> Azure Bicep snippet<pre><code>@description('The name of the Front Door profile.')\nparam frontDoorName string\n\n@description('The hostname of the backend. Must be an IP address or FQDN.')\nparam backendAddress string\n\nvar frontEndEndpointName = 'frontEndEndpoint'\nvar loadBalancingSettingsName = 'loadBalancingSettings'\nvar healthProbeSettingsName = 'healthProbeSettings'\nvar routingRuleName = 'routingRule'\nvar backendPoolName = 'backendPool'\n\nresource frontDoor 'Microsoft.Network/frontDoors@2021-06-01' = {\n  name: frontDoorName\n  location: 'global'\n  properties: {\n    enabledState: 'Enabled'\n\n    frontendEndpoints: [\n      {\n        name: frontEndEndpointName\n        properties: {\n          hostName: '${frontDoorName}.azurefd.net'\n          sessionAffinityEnabledState: 'Disabled'\n        }\n      }\n    ]\n\n    loadBalancingSettings: [\n      {\n        name: loadBalancingSettingsName\n        properties: {\n          sampleSize: 4\n          successfulSamplesRequired: 2\n        }\n      }\n    ]\n\n    healthProbeSettings: [\n      {\n        name: healthProbeSettingsName\n        properties: {\n          path: '/'\n          protocol: 'Http'\n          intervalInSeconds: 120\n        }\n      }\n    ]\n\n    backendPools: [\n      {\n        name: backendPoolName\n        properties: {\n          backends: [\n            {\n              address: backendAddress\n              backendHostHeader: backendAddress\n              httpPort: 80\n              httpsPort: 443\n              weight: 50\n              priority: 1\n              enabledState: 'Enabled'\n            }\n          ]\n          loadBalancingSettings: {\n            id: resourceId('Microsoft.Network/frontDoors/loadBalancingSettings', frontDoorName, loadBalancingSettingsName)\n          }\n          healthProbeSettings: {\n            id: resourceId('Microsoft.Network/frontDoors/healthProbeSettings', frontDoorName, healthProbeSettingsName)\n          }\n        }\n      }\n    ]\n\n    routingRules: [\n      {\n        name: routingRuleName\n        properties: {\n          frontendEndpoints: [\n            {\n              id: resourceId('Microsoft.Network/frontDoors/frontEndEndpoints', frontDoorName, frontEndEndpointName)\n            }\n          ]\n          acceptedProtocols: [\n            'Http'\n            'Https'\n          ]\n          patternsToMatch: [\n            '/*'\n          ]\n          routeConfiguration: {\n            '@odata.type': '#Microsoft.Azure.FrontDoor.Models.FrontdoorForwardingConfiguration'\n            cacheConfiguration: {\n              cacheDuration: 'P12DT1H'\n              dynamicCompression: 'Disabled'\n              queryParameters: 'customerId'\n              queryParameterStripDirective: 'StripAll'\n            }\n            forwardingProtocol: 'MatchRequest'\n            backendPool: {\n              id: resourceId('Microsoft.Network/frontDoors/backEndPools', frontDoorName, backendPoolName)\n            }\n          }\n          enabledState: 'Enabled'\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.FrontDoor.UseCaching","AZR-000320"]},{"location":"en/rules/Azure.FrontDoor.UseCaching/#notes","title":"Notes","text":"<p>This rule only applies to Azure Front Door Classic profiles (<code>Microsoft.Network/frontDoors</code>).</p>","tags":["Azure.FrontDoor.UseCaching","AZR-000320"]},{"location":"en/rules/Azure.FrontDoor.UseCaching/#links","title":"Links","text":"<ul> <li>PE:08 Data performance</li> <li>Caching with Azure Front Door</li> <li>Routing architecture overview</li> <li>Azure deployment reference - Classic Profile</li> <li>Azure deployment reference - Classic Rules engine</li> </ul>","tags":["Azure.FrontDoor.UseCaching","AZR-000320"]},{"location":"en/rules/Azure.FrontDoor.UseWAF/","title":"Front Door endpoints should use WAF","text":"Azure.FrontDoor.UseWAFAZR-000111Error <p> Security  \u00b7  Front Door  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Enable Web Application Firewall (WAF) policies on each Front Door endpoint.</p>","tags":["Azure.FrontDoor.UseWAF","AZR-000111"]},{"location":"en/rules/Azure.FrontDoor.UseWAF/#description","title":"Description","text":"<p>Front Door endpoints can optionally be configured with a WAF policy. When configured, every incoming request through Front Door is filtered by the WAF policy.</p>","tags":["Azure.FrontDoor.UseWAF","AZR-000111"]},{"location":"en/rules/Azure.FrontDoor.UseWAF/#recommendation","title":"Recommendation","text":"<p>Consider enabling a WAF policy on each Front Door endpoint.</p>","tags":["Azure.FrontDoor.UseWAF","AZR-000111"]},{"location":"en/rules/Azure.FrontDoor.UseWAF/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Securing PaaS deployments</li> <li>Azure Web Application Firewall on Azure Front Door</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.FrontDoor.UseWAF","AZR-000111"]},{"location":"en/rules/Azure.FrontDoor.WAF.Enabled/","title":"Enable Front Door WAF policy","text":"Azure.FrontDoor.WAF.EnabledAZR-000115Error <p> Security  \u00b7  Front Door  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources.</p>","tags":["Azure.FrontDoor.WAF.Enabled","AZR-000115"]},{"location":"en/rules/Azure.FrontDoor.WAF.Enabled/#description","title":"Description","text":"<p>The operational state of a Front Door WAF policy instance is configurable, either enabled or disabled. By default, a WAF policy is enabled.</p> <p>When disabled, incoming requests bypass the WAF policy and are sent to back ends based on routing rules.</p>","tags":["Azure.FrontDoor.WAF.Enabled","AZR-000115"]},{"location":"en/rules/Azure.FrontDoor.WAF.Enabled/#recommendation","title":"Recommendation","text":"<p>Consider enabling WAF policy.</p>","tags":["Azure.FrontDoor.WAF.Enabled","AZR-000115"]},{"location":"en/rules/Azure.FrontDoor.WAF.Enabled/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Securing PaaS deployments</li> <li>Policy settings for Web Application Firewall on Azure Front Door</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.FrontDoor.WAF.Enabled","AZR-000115"]},{"location":"en/rules/Azure.FrontDoor.WAF.Mode/","title":"Use Front Door WAF policy in prevention mode","text":"Azure.FrontDoor.WAF.ModeAZR-000114Error <p> Security  \u00b7  Front Door  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources.</p>","tags":["Azure.FrontDoor.WAF.Mode","AZR-000114"]},{"location":"en/rules/Azure.FrontDoor.WAF.Mode/#description","title":"Description","text":"<p>Front Door WAF policies support two modes of operation, detection and prevention. By default, prevention is configured.</p> <ul> <li>Detection - monitors and logs all requests which match a WAF rule. In this mode, the WAF doesn't take action against incoming requests. To log requests, diagnostics on the Front Door instance must be configured.</li> <li>Protection - log and takes action against requests which match a WAF rule. The action to perform is configurable for each WAF rule.</li> </ul>","tags":["Azure.FrontDoor.WAF.Mode","AZR-000114"]},{"location":"en/rules/Azure.FrontDoor.WAF.Mode/#recommendation","title":"Recommendation","text":"<p>Consider setting Front Door WAF policy to use protection mode.</p>","tags":["Azure.FrontDoor.WAF.Mode","AZR-000114"]},{"location":"en/rules/Azure.FrontDoor.WAF.Mode/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Securing PaaS deployments</li> <li>Policy settings for Web Application Firewall on Azure Front Door</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.FrontDoor.WAF.Mode","AZR-000114"]},{"location":"en/rules/Azure.FrontDoor.WAF.Name/","title":"Use valid Front Door WAF policy names","text":"Azure.FrontDoor.WAF.NameAZR-000116Error <p> Operational Excellence  \u00b7  Front Door  \u00b7  Rule  \u00b7  2020_12  \u00b7  Awareness</p> <p>Front Door WAF policy names should meet naming requirements.</p>","tags":["Azure.FrontDoor.WAF.Name","AZR-000116"]},{"location":"en/rules/Azure.FrontDoor.WAF.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Front Door Web Application Firewall (WAF) policy names are:</p> <ul> <li>Between 1 and 128 characters long.</li> <li>Letters or numbers.</li> <li>Start with a letter.</li> <li>Unique within a resource group.</li> </ul>","tags":["Azure.FrontDoor.WAF.Name","AZR-000116"]},{"location":"en/rules/Azure.FrontDoor.WAF.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Front Door WAF policy naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.FrontDoor.WAF.Name","AZR-000116"]},{"location":"en/rules/Azure.FrontDoor.WAF.Name/#notes","title":"Notes","text":"<p>This rule does not check if Front Door WAF policy names are unique.</p>","tags":["Azure.FrontDoor.WAF.Name","AZR-000116"]},{"location":"en/rules/Azure.FrontDoor.WAF.Name/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> <li>Tagging and resource naming</li> </ul>","tags":["Azure.FrontDoor.WAF.Name","AZR-000116"]},{"location":"en/rules/Azure.FrontDoorWAF.Enabled/","title":"Enable Front Door WAF policy","text":"Azure.FrontDoorWAF.EnabledAZR-000305Error <p> Security  \u00b7  Front Door  \u00b7  Rule  \u00b7  2022_09  \u00b7  Critical</p> <p>Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources.</p>","tags":["Azure.FrontDoorWAF.Enabled","AZR-000305"]},{"location":"en/rules/Azure.FrontDoorWAF.Enabled/#description","title":"Description","text":"<p>The operational state of a Front Door WAF policy instance is configurable, either enabled or disabled. By default, a WAF policy is enabled.</p> <p>When disabled, incoming requests bypass the WAF policy and are sent to back ends based on routing rules.</p>","tags":["Azure.FrontDoorWAF.Enabled","AZR-000305"]},{"location":"en/rules/Azure.FrontDoorWAF.Enabled/#recommendation","title":"Recommendation","text":"<p>Consider enabling WAF policy.</p>","tags":["Azure.FrontDoorWAF.Enabled","AZR-000305"]},{"location":"en/rules/Azure.FrontDoorWAF.Enabled/#examples","title":"Examples","text":"","tags":["Azure.FrontDoorWAF.Enabled","AZR-000305"]},{"location":"en/rules/Azure.FrontDoorWAF.Enabled/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy WAF policies that pass this rule:</p> <ul> <li>Set the <code>properties.policySettings.enabledState</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/FrontDoorWebApplicationFirewallPolicies\",\n  \"apiVersion\": \"2022-05-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"Global\",\n  \"sku\": {\n    \"name\": \"Premium_AzureFrontDoor\"\n  },\n  \"properties\": {\n    \"managedRules\": {\n      \"managedRuleSets\": [\n        {\n          \"ruleSetType\": \"Microsoft_DefaultRuleSet\",\n          \"ruleSetVersion\": \"2.0\",\n          \"ruleSetAction\": \"Block\",\n          \"exclusions\": [],\n          \"ruleGroupOverrides\": []\n        },\n        {\n          \"ruleSetType\": \"Microsoft_BotManagerRuleSet\",\n          \"ruleSetVersion\": \"1.0\",\n          \"ruleSetAction\": \"Block\",\n          \"exclusions\": [],\n          \"ruleGroupOverrides\": []\n        }\n      ]\n    },\n    \"policySettings\": {\n      \"enabledState\": \"Enabled\",\n      \"mode\": \"Prevention\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.FrontDoorWAF.Enabled","AZR-000305"]},{"location":"en/rules/Azure.FrontDoorWAF.Enabled/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy WAF policies that pass this rule:</p> <ul> <li>Set the <code>properties.policySettings.enabledState</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource waf 'Microsoft.Network/FrontDoorWebApplicationFirewallPolicies@2022-05-01' = {\n  name: name\n  location: 'Global'\n  sku: {\n    name: 'Premium_AzureFrontDoor'\n  }\n  properties: {\n    managedRules: {\n      managedRuleSets: [\n        {\n          ruleSetType: 'Microsoft_DefaultRuleSet'\n          ruleSetVersion: '2.0'\n          ruleSetAction: 'Block'\n          exclusions: []\n          ruleGroupOverrides: []\n        }\n        {\n          ruleSetType: 'Microsoft_BotManagerRuleSet'\n          ruleSetVersion: '1.0'\n          ruleSetAction: 'Block'\n          exclusions: []\n          ruleGroupOverrides: []\n        }\n      ]\n    }\n    policySettings: {\n      enabledState: 'Enabled'\n      mode: 'Prevention'\n    }\n  }\n}\n</code></pre>","tags":["Azure.FrontDoorWAF.Enabled","AZR-000305"]},{"location":"en/rules/Azure.FrontDoorWAF.Enabled/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Securing PaaS deployments</li> <li>Policy settings for Web Application Firewall on Azure Front Door</li> <li>Web Application Firewall best practices</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.FrontDoorWAF.Enabled","AZR-000305"]},{"location":"en/rules/Azure.FrontDoorWAF.Exclusions/","title":"Avoid configuring Front Door WAF rule exclusions","text":"Azure.FrontDoorWAF.ExclusionsAZR-000307Error <p> Security  \u00b7  Front Door  \u00b7  Rule  \u00b7  2022_09  \u00b7  Critical</p> <p>Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions.</p>","tags":["Azure.FrontDoorWAF.Exclusions","AZR-000307"]},{"location":"en/rules/Azure.FrontDoorWAF.Exclusions/#description","title":"Description","text":"<p>Front Door WAF supports exclusions lists.</p> <p>Sometimes Web Application Firewall (WAF) might block a request that you want to allow for your application. WAF exclusion lists allow you to omit certain request attributes from a WAF evaluation. However, it should be allowed and only used as a last resort.</p>","tags":["Azure.FrontDoorWAF.Exclusions","AZR-000307"]},{"location":"en/rules/Azure.FrontDoorWAF.Exclusions/#recommendation","title":"Recommendation","text":"<p>Avoid configuring Front Door WAF rule exclusions.</p>","tags":["Azure.FrontDoorWAF.Exclusions","AZR-000307"]},{"location":"en/rules/Azure.FrontDoorWAF.Exclusions/#examples","title":"Examples","text":"","tags":["Azure.FrontDoorWAF.Exclusions","AZR-000307"]},{"location":"en/rules/Azure.FrontDoorWAF.Exclusions/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy WAF policies that pass this rule:</p> <ul> <li>Remove any rule exclusions by:<ul> <li>Set the <code>exclusions</code> property for each managed rule group to an empty array. OR</li> <li>Remove the <code>exclusions</code> property for each managed rule group.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/FrontDoorWebApplicationFirewallPolicies\",\n  \"apiVersion\": \"2022-05-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"Global\",\n  \"sku\": {\n    \"name\": \"Premium_AzureFrontDoor\"\n  },\n  \"properties\": {\n    \"managedRules\": {\n      \"managedRuleSets\": [\n        {\n          \"ruleSetType\": \"Microsoft_DefaultRuleSet\",\n          \"ruleSetVersion\": \"2.0\",\n          \"ruleSetAction\": \"Block\",\n          \"exclusions\": [],\n          \"ruleGroupOverrides\": []\n        },\n        {\n          \"ruleSetType\": \"Microsoft_BotManagerRuleSet\",\n          \"ruleSetVersion\": \"1.0\",\n          \"ruleSetAction\": \"Block\",\n          \"exclusions\": [],\n          \"ruleGroupOverrides\": []\n        }\n      ]\n    },\n    \"policySettings\": {\n      \"enabledState\": \"Enabled\",\n      \"mode\": \"Prevention\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.FrontDoorWAF.Exclusions","AZR-000307"]},{"location":"en/rules/Azure.FrontDoorWAF.Exclusions/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy WAF policies that pass this rule:</p> <ul> <li>Remove any rule exclusions by:<ul> <li>Set the <code>exclusions</code> property for each managed rule group to an empty array. OR</li> <li>Remove the <code>exclusions</code> property for each managed rule group.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource waf 'Microsoft.Network/FrontDoorWebApplicationFirewallPolicies@2022-05-01' = {\n  name: name\n  location: 'Global'\n  sku: {\n    name: 'Premium_AzureFrontDoor'\n  }\n  properties: {\n    managedRules: {\n      managedRuleSets: [\n        {\n          ruleSetType: 'Microsoft_DefaultRuleSet'\n          ruleSetVersion: '2.0'\n          ruleSetAction: 'Block'\n          exclusions: []\n          ruleGroupOverrides: []\n        }\n        {\n          ruleSetType: 'Microsoft_BotManagerRuleSet'\n          ruleSetVersion: '1.0'\n          ruleSetAction: 'Block'\n          exclusions: []\n          ruleGroupOverrides: []\n        }\n      ]\n    }\n    policySettings: {\n      enabledState: 'Enabled'\n      mode: 'Prevention'\n    }\n  }\n}\n</code></pre>","tags":["Azure.FrontDoorWAF.Exclusions","AZR-000307"]},{"location":"en/rules/Azure.FrontDoorWAF.Exclusions/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Securing PaaS deployments</li> <li>Policy settings for Web Application Firewall on Azure Front Door</li> <li>Web Application Firewall CRS rule groups and rules</li> <li>Bot protection overview</li> <li>Web Application Firewall best practices</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.FrontDoorWAF.Exclusions","AZR-000307"]},{"location":"en/rules/Azure.FrontDoorWAF.PreventionMode/","title":"Use Front Door WAF policy in prevention mode","text":"Azure.FrontDoorWAF.PreventionModeAZR-000306Error <p> Security  \u00b7  Front Door  \u00b7  Rule  \u00b7  2022_09  \u00b7  Critical</p> <p>Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources.</p>","tags":["Azure.FrontDoorWAF.PreventionMode","AZR-000306"]},{"location":"en/rules/Azure.FrontDoorWAF.PreventionMode/#description","title":"Description","text":"<p>Front Door WAF policies support two modes of operation, detection and prevention. By default, prevention is configured.</p> <ul> <li>Detection - monitors and logs all requests which match a WAF rule. In this mode, the WAF doesn't take action against incoming requests. To log requests, diagnostics on the Front Door instance must be configured.</li> <li>Protection - log and takes action against requests which match a WAF rule. The action to perform is configurable for each WAF rule.</li> </ul>","tags":["Azure.FrontDoorWAF.PreventionMode","AZR-000306"]},{"location":"en/rules/Azure.FrontDoorWAF.PreventionMode/#recommendation","title":"Recommendation","text":"<p>Consider setting Front Door WAF policy to use protection mode.</p>","tags":["Azure.FrontDoorWAF.PreventionMode","AZR-000306"]},{"location":"en/rules/Azure.FrontDoorWAF.PreventionMode/#examples","title":"Examples","text":"","tags":["Azure.FrontDoorWAF.PreventionMode","AZR-000306"]},{"location":"en/rules/Azure.FrontDoorWAF.PreventionMode/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy WAF policies that pass this rule:</p> <ul> <li>Set the <code>properties.policySettings.mode</code> property to <code>Prevention</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/FrontDoorWebApplicationFirewallPolicies\",\n  \"apiVersion\": \"2022-05-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"Global\",\n  \"sku\": {\n    \"name\": \"Premium_AzureFrontDoor\"\n  },\n  \"properties\": {\n    \"managedRules\": {\n      \"managedRuleSets\": [\n        {\n          \"ruleSetType\": \"Microsoft_DefaultRuleSet\",\n          \"ruleSetVersion\": \"2.0\",\n          \"ruleSetAction\": \"Block\",\n          \"exclusions\": [],\n          \"ruleGroupOverrides\": []\n        },\n        {\n          \"ruleSetType\": \"Microsoft_BotManagerRuleSet\",\n          \"ruleSetVersion\": \"1.0\",\n          \"ruleSetAction\": \"Block\",\n          \"exclusions\": [],\n          \"ruleGroupOverrides\": []\n        }\n      ]\n    },\n    \"policySettings\": {\n      \"enabledState\": \"Enabled\",\n      \"mode\": \"Prevention\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.FrontDoorWAF.PreventionMode","AZR-000306"]},{"location":"en/rules/Azure.FrontDoorWAF.PreventionMode/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy WAF policies that pass this rule:</p> <ul> <li>Set the <code>properties.policySettings.mode</code> property to <code>Prevention</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource waf 'Microsoft.Network/FrontDoorWebApplicationFirewallPolicies@2022-05-01' = {\n  name: name\n  location: 'Global'\n  sku: {\n    name: 'Premium_AzureFrontDoor'\n  }\n  properties: {\n    managedRules: {\n      managedRuleSets: [\n        {\n          ruleSetType: 'Microsoft_DefaultRuleSet'\n          ruleSetVersion: '2.0'\n          ruleSetAction: 'Block'\n          exclusions: []\n          ruleGroupOverrides: []\n        }\n        {\n          ruleSetType: 'Microsoft_BotManagerRuleSet'\n          ruleSetVersion: '1.0'\n          ruleSetAction: 'Block'\n          exclusions: []\n          ruleGroupOverrides: []\n        }\n      ]\n    }\n    policySettings: {\n      enabledState: 'Enabled'\n      mode: 'Prevention'\n    }\n  }\n}\n</code></pre>","tags":["Azure.FrontDoorWAF.PreventionMode","AZR-000306"]},{"location":"en/rules/Azure.FrontDoorWAF.PreventionMode/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Securing PaaS deployments</li> <li>Policy settings for Web Application Firewall on Azure Front Door</li> <li>Web Application Firewall best practices</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.FrontDoorWAF.PreventionMode","AZR-000306"]},{"location":"en/rules/Azure.FrontDoorWAF.RuleGroups/","title":"Use Recommended Front Door WAF policy rule groups","text":"Azure.FrontDoorWAF.RuleGroupsAZR-000308Error <p> Security  \u00b7  Front Door  \u00b7  Rule  \u00b7  2022_09  \u00b7  Critical</p> <p>Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources.</p>","tags":["Azure.FrontDoorWAF.RuleGroups","AZR-000308"]},{"location":"en/rules/Azure.FrontDoorWAF.RuleGroups/#description","title":"Description","text":"<p>Front Door WAF policies support two main Rule Groups.</p> <ul> <li>OWASP - Front Door web application firewall (WAF) protects web applications from common vulnerabilities and exploits. This is done through rules that are defined based on the OWASP core rule sets 3.2, 3.1, 3.0. It is recommended to use the latest rule set.</li> <li>Bot protection - Enable a managed bot protection rule set to block or log requests from known malicious IP addresses.</li> </ul>","tags":["Azure.FrontDoorWAF.RuleGroups","AZR-000308"]},{"location":"en/rules/Azure.FrontDoorWAF.RuleGroups/#recommendation","title":"Recommendation","text":"<p>Consider configuring Front Door WAF policy to use the recommended rule sets.</p>","tags":["Azure.FrontDoorWAF.RuleGroups","AZR-000308"]},{"location":"en/rules/Azure.FrontDoorWAF.RuleGroups/#examples","title":"Examples","text":"","tags":["Azure.FrontDoorWAF.RuleGroups","AZR-000308"]},{"location":"en/rules/Azure.FrontDoorWAF.RuleGroups/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy WAF policies that pass this rule:</p> <ul> <li>Add the <code>Microsoft_DefaultRuleSet</code> rule set to the <code>properties.managedRules.managedRuleSets</code> property.<ul> <li>Use the rule set version <code>2.0</code> or greater.</li> </ul> </li> <li>Add the <code>Microsoft_BotManagerRuleSet</code> rule set to the <code>properties.managedRules.managedRuleSets</code> property.<ul> <li>Use the rule set version <code>1.0</code> or greater.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/FrontDoorWebApplicationFirewallPolicies\",\n  \"apiVersion\": \"2022-05-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"Global\",\n  \"sku\": {\n    \"name\": \"Premium_AzureFrontDoor\"\n  },\n  \"properties\": {\n    \"managedRules\": {\n      \"managedRuleSets\": [\n        {\n          \"ruleSetType\": \"Microsoft_DefaultRuleSet\",\n          \"ruleSetVersion\": \"2.0\",\n          \"ruleSetAction\": \"Block\",\n          \"exclusions\": [],\n          \"ruleGroupOverrides\": []\n        },\n        {\n          \"ruleSetType\": \"Microsoft_BotManagerRuleSet\",\n          \"ruleSetVersion\": \"1.0\",\n          \"ruleSetAction\": \"Block\",\n          \"exclusions\": [],\n          \"ruleGroupOverrides\": []\n        }\n      ]\n    },\n    \"policySettings\": {\n      \"enabledState\": \"Enabled\",\n      \"mode\": \"Prevention\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.FrontDoorWAF.RuleGroups","AZR-000308"]},{"location":"en/rules/Azure.FrontDoorWAF.RuleGroups/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy WAF policies that pass this rule:</p> <ul> <li>Add the <code>Microsoft_DefaultRuleSet</code> rule set to the <code>properties.managedRules.managedRuleSets</code> property.<ul> <li>Use the rule set version <code>2.0</code> or greater.</li> </ul> </li> <li>Add the <code>Microsoft_BotManagerRuleSet</code> rule set to the <code>properties.managedRules.managedRuleSets</code> property.<ul> <li>Use the rule set version <code>1.0</code> or greater.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource waf 'Microsoft.Network/FrontDoorWebApplicationFirewallPolicies@2022-05-01' = {\n  name: name\n  location: 'Global'\n  sku: {\n    name: 'Premium_AzureFrontDoor'\n  }\n  properties: {\n    managedRules: {\n      managedRuleSets: [\n        {\n          ruleSetType: 'Microsoft_DefaultRuleSet'\n          ruleSetVersion: '2.0'\n          ruleSetAction: 'Block'\n          exclusions: []\n          ruleGroupOverrides: []\n        }\n        {\n          ruleSetType: 'Microsoft_BotManagerRuleSet'\n          ruleSetVersion: '1.0'\n          ruleSetAction: 'Block'\n          exclusions: []\n          ruleGroupOverrides: []\n        }\n      ]\n    }\n    policySettings: {\n      enabledState: 'Enabled'\n      mode: 'Prevention'\n    }\n  }\n}\n</code></pre>","tags":["Azure.FrontDoorWAF.RuleGroups","AZR-000308"]},{"location":"en/rules/Azure.FrontDoorWAF.RuleGroups/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Securing PaaS deployments</li> <li>Policy settings for Web Application Firewall on Azure Front Door</li> <li>Web Application Firewall CRS rule groups and rules</li> <li>Bot protection overview</li> <li>Web Application Firewall best practices</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.FrontDoorWAF.RuleGroups","AZR-000308"]},{"location":"en/rules/Azure.Grafana.Version/","title":"Upgrade Grafana version","text":"Azure.Grafana.VersionAZR-000424Error <p> Reliability  \u00b7  Azure Managed Grafana  \u00b7  Rule  \u00b7  2024_06  \u00b7  Important</p> <p>Grafana workspaces should be on Grafana version 10.</p>","tags":["Azure.Grafana.Version","AZR-000424"]},{"location":"en/rules/Azure.Grafana.Version/#description","title":"Description","text":"<p>Support for Grafana version 9 within Azure Managed Grafana is deprecated and will retire on 31 August 2024. To avoid support disruptions, upgrade to Grafana version 10.</p>","tags":["Azure.Grafana.Version","AZR-000424"]},{"location":"en/rules/Azure.Grafana.Version/#recommendation","title":"Recommendation","text":"<p>Upgrade to Grafana version 10 for Azure Managed Grafana workspaces to avoid support disruptions.</p>","tags":["Azure.Grafana.Version","AZR-000424"]},{"location":"en/rules/Azure.Grafana.Version/#examples","title":"Examples","text":"","tags":["Azure.Grafana.Version","AZR-000424"]},{"location":"en/rules/Azure.Grafana.Version/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Managed Grafana workspaces that pass this rule:</p> <ul> <li>Set the <code>properties.grafanaMajorVersion</code> property to <code>10</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Dashboard/grafana\",\n  \"apiVersion\": \"2023-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"grafanaMajorVersion\": \"10\"\n  }\n}\n</code></pre>","tags":["Azure.Grafana.Version","AZR-000424"]},{"location":"en/rules/Azure.Grafana.Version/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Managed Grafana workspaces that pass this rule:</p> <ul> <li>Set the <code>properties.grafanaMajorVersion</code> property to <code>10</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource grafana 'Microsoft.Dashboard/grafana@2023-09-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    grafanaMajorVersion: '10'\n  }\n}\n</code></pre>","tags":["Azure.Grafana.Version","AZR-000424"]},{"location":"en/rules/Azure.Grafana.Version/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az grafana update --name &lt;azure-managed-grafana-workspace&gt; --major-version 10\n</code></pre>","tags":["Azure.Grafana.Version","AZR-000424"]},{"location":"en/rules/Azure.Grafana.Version/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Update to using Grafana version 10 for Azure Managed Grafana</li> <li>Upgrade to Grafana 10</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.Grafana.Version","AZR-000424"]},{"location":"en/rules/Azure.Identity.UserAssignedName/","title":"Use valid Managed Identity names","text":"Azure.Identity.UserAssignedNameAZR-000117Error <p> Operational Excellence  \u00b7  User Assigned Managed Identity  \u00b7  Rule  \u00b7  2021_12  \u00b7  Awareness</p> <p>Managed Identity names should meet naming requirements.</p>","tags":["Azure.Identity.UserAssignedName","AZR-000117"]},{"location":"en/rules/Azure.Identity.UserAssignedName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Managed Identity names are:</p> <ul> <li>Between 3 and 128 characters long.</li> <li>Letters, numbers, underscores, and hyphens.</li> <li>Start with letters and numbers.</li> <li>Managed Identity names must be unique within a resource group.</li> </ul>","tags":["Azure.Identity.UserAssignedName","AZR-000117"]},{"location":"en/rules/Azure.Identity.UserAssignedName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Managed Identity naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.Identity.UserAssignedName","AZR-000117"]},{"location":"en/rules/Azure.Identity.UserAssignedName/#notes","title":"Notes","text":"<p>This rule does not check if Managed Identity names are unique.</p>","tags":["Azure.Identity.UserAssignedName","AZR-000117"]},{"location":"en/rules/Azure.Identity.UserAssignedName/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> <li>Recommended abbreviations for Azure resource types</li> </ul>","tags":["Azure.Identity.UserAssignedName","AZR-000117"]},{"location":"en/rules/Azure.IoTHub.MinTLS/","title":"Minimum TLS version","text":"Azure.IoTHub.MinTLSAZR-000357Error <p> Security  \u00b7  IoT Hub  \u00b7  Rule  \u00b7  2023_03  \u00b7  Critical</p> <p>IoT Hubs should reject TLS versions older than 1.2.</p>","tags":["Azure.IoTHub.MinTLS","AZR-000357"]},{"location":"en/rules/Azure.IoTHub.MinTLS/#description","title":"Description","text":"<p>The minimum version of TLS that IoT Hubs accept is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS.</p> <p>Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted.</p>","tags":["Azure.IoTHub.MinTLS","AZR-000357"]},{"location":"en/rules/Azure.IoTHub.MinTLS/#recommendation","title":"Recommendation","text":"<p>Configure the minimum supported TLS version to be 1.2.</p>","tags":["Azure.IoTHub.MinTLS","AZR-000357"]},{"location":"en/rules/Azure.IoTHub.MinTLS/#examples","title":"Examples","text":"","tags":["Azure.IoTHub.MinTLS","AZR-000357"]},{"location":"en/rules/Azure.IoTHub.MinTLS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy IoT Hubs that pass this rule:</p> <ul> <li>Set the <code>properties.minTlsVersion</code> property to <code>1.2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Devices/IotHubs\",\n  \"apiVersion\": \"2022-04-30-preview\",\n  \"name\": \"[parameters('iotHubName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"S1\",\n    \"capacity\": 1,\n  },\n  \"properties\": {\n    \"minimumTlsVersion\": \"1.2\",\n  }\n}\n</code></pre>","tags":["Azure.IoTHub.MinTLS","AZR-000357"]},{"location":"en/rules/Azure.IoTHub.MinTLS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy IoT Hubs that pass this rule:</p> <ul> <li>Set the <code>properties.minTlsVersion</code> property to <code>1.2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource IoTHub 'Microsoft.Devices/IotHubs@2022-04-30-preview' = {\n  name: iotHubName\n  location: location\n  sku: {\n    name: 'S1'\n    capacity: 1\n  }\n  properties: {\n    minTlsVersion: '1.2'\n  }\n}\n</code></pre>","tags":["Azure.IoTHub.MinTLS","AZR-000357"]},{"location":"en/rules/Azure.IoTHub.MinTLS/#notes","title":"Notes","text":"<p>The minimum TLS version feature is currently only supported in these regions: - East US - South Central US - West US 2 - US Gov Arizona - US Gov Virginia</p> <p>The <code>minTlsVersion</code> property is read-only and cannot be changed once your IoT Hub resource is created. It is therefore important to properly test and validate that all oT devices and services are compatible with TLS 1.2 and the recommended ciphers in advance.</p>","tags":["Azure.IoTHub.MinTLS","AZR-000357"]},{"location":"en/rules/Azure.IoTHub.MinTLS/#links","title":"Links","text":"<ul> <li>Data encryption in Azure</li> <li>Transport Layer Security (TLS) support in IoT Hub</li> <li>Preparing for TLS 1.2 in Microsoft Azure</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.IoTHub.MinTLS","AZR-000357"]},{"location":"en/rules/Azure.KeyVault.AccessPolicy/","title":"Limit access to Key Vault data","text":"Azure.KeyVault.AccessPolicyAZR-000118Error <p> Security  \u00b7  Key Vault  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Use the principal of least privilege when assigning access to Key Vault.</p>","tags":["Azure.KeyVault.AccessPolicy","AZR-000118"]},{"location":"en/rules/Azure.KeyVault.AccessPolicy/#description","title":"Description","text":"<p>Key Vault is a service designed to securely store sensitive items such as secrets, keys and certificates. Access Policies determine the permissions user accounts, groups or applications have to Key Vaults items.</p> <p>The ability for applications and administrators to get, set and list within a Key Vault is commonly required. However should only be assigned to security principals that require access. The purge permission should be rarely assigned.</p>","tags":["Azure.KeyVault.AccessPolicy","AZR-000118"]},{"location":"en/rules/Azure.KeyVault.AccessPolicy/#recommendation","title":"Recommendation","text":"<p>Consider assigning access to Key Vault data based on the principle of least privilege.</p>","tags":["Azure.KeyVault.AccessPolicy","AZR-000118"]},{"location":"en/rules/Azure.KeyVault.AccessPolicy/#examples","title":"Examples","text":"","tags":["Azure.KeyVault.AccessPolicy","AZR-000118"]},{"location":"en/rules/Azure.KeyVault.AccessPolicy/#azure-templates","title":"Azure templates","text":"<p>To deploy Key Vaults that pass this rule:</p> <ul> <li>Use Azure RBAC as the authorization system instead. OR</li> <li>Configure the access policies by setting <code>properties.accessPolicies</code>:<ul> <li>Avoid assigning <code>purge</code> and <code>all</code> permissions for Key Vault objects.   Use specific permissions such as <code>get</code> and <code>set</code>.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.KeyVault/vaults\",\n  \"apiVersion\": \"2023-07-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"sku\": {\n      \"family\": \"A\",\n      \"name\": \"premium\"\n    },\n    \"tenantId\": \"[tenant().tenantId]\",\n    \"softDeleteRetentionInDays\": 90,\n    \"enableSoftDelete\": true,\n    \"enablePurgeProtection\": true,\n    \"accessPolicies\": [\n      {\n        \"objectId\": \"[parameters('objectId')]\",\n        \"permissions\": {\n          \"secrets\": [\n            \"get\",\n            \"list\",\n            \"set\"\n          ]\n        },\n        \"tenantId\": \"[tenant().tenantId]\"\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.KeyVault.AccessPolicy","AZR-000118"]},{"location":"en/rules/Azure.KeyVault.AccessPolicy/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Key Vaults that pass this rule:</p> <ul> <li>Use Azure RBAC as the authorization system instead. OR</li> <li>Configure the access policies by setting <code>properties.accessPolicies</code>:<ul> <li>Avoid assigning <code>purge</code> and <code>all</code> permissions for Key Vault objects.   Use specific permissions such as <code>get</code> and <code>set</code>.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vault 'Microsoft.KeyVault/vaults@2023-07-01' = {\n  name: name\n  location: location\n  properties: {\n    sku: {\n      family: 'A'\n      name: 'premium'\n    }\n    tenantId: tenant().tenantId\n    softDeleteRetentionInDays: 90\n    enableSoftDelete: true\n    enablePurgeProtection: true\n    accessPolicies: [\n      {\n        objectId: objectId\n        permissions: {\n          secrets: [\n            'get'\n            'list'\n            'set'\n          ]\n        }\n        tenantId: tenant().tenantId\n      }\n    ]\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/key-vault/vault:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/key-vault/vault:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.KeyVault.AccessPolicy","AZR-000118"]},{"location":"en/rules/Azure.KeyVault.AccessPolicy/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Provide access to Key Vault keys, certificates, and secrets with an Azure role-based access control</li> <li>Azure role-based access control vs. access policies</li> <li>Migrate from vault access policy to an Azure role-based access control permission model</li> <li>Best practices to use Key Vault</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.KeyVault.AccessPolicy","AZR-000118"]},{"location":"en/rules/Azure.KeyVault.AutoRotationPolicy/","title":"Enable Key Vault key auto-rotation","text":"Azure.KeyVault.AutoRotationPolicyAZR-000123Error <p> Security  \u00b7  Key Vault  \u00b7  Rule  \u00b7  2022_09  \u00b7  Important</p> <p>Key Vault keys should have auto-rotation enabled.</p>","tags":["Azure.KeyVault.AutoRotationPolicy","AZR-000123"]},{"location":"en/rules/Azure.KeyVault.AutoRotationPolicy/#description","title":"Description","text":"<p>Automated key rotation in Key Vault allows users to configure Key Vault to automatically generate a new key version at a specified frequency.</p> <p>Key rotation is often a cause of many application outages. It's critical that the rotation of keys be scheduled and automated to ensure effectiveness.</p>","tags":["Azure.KeyVault.AutoRotationPolicy","AZR-000123"]},{"location":"en/rules/Azure.KeyVault.AutoRotationPolicy/#recommendation","title":"Recommendation","text":"<p>Consider enabling auto-rotation on Key Vault keys.</p>","tags":["Azure.KeyVault.AutoRotationPolicy","AZR-000123"]},{"location":"en/rules/Azure.KeyVault.AutoRotationPolicy/#examples","title":"Examples","text":"","tags":["Azure.KeyVault.AutoRotationPolicy","AZR-000123"]},{"location":"en/rules/Azure.KeyVault.AutoRotationPolicy/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To set auto-rotation for a key:</p> <ul> <li>Set the <code>properties.rotationPolicy.lifetimeActions[*].action.type</code> property to <code>Rotate</code>.</li> <li>Set the <code>properties.rotationPolicy.lifetimeActions[*].trigger.timeAfterCreate</code> property to a time duration such as <code>P30D</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.KeyVault/vaults/keys\",\n  \"apiVersion\": \"2021-06-01-preview\",\n  \"name\": \"[concat(parameters('vaultName'), '/', 'key1')]\",\n  \"properties\": {\n    \"keyOps\": [\n      \"sign\",\n      \"verify\",\n      \"wrapKey\",\n      \"unwrapKey\",\n      \"encrypt\",\n      \"decrypt\"\n    ],\n    \"keySize\": 2048,\n    \"kty\": \"RSA\",\n    \"rotationPolicy\": {\n      \"lifetimeActions\": [\n        {\n          \"action\": {\n            \"type\": \"Rotate\"\n          },\n          \"trigger\": {\n            \"timeAfterCreate\": \"P18D\"\n          }\n        },\n        {\n          \"action\": {\n            \"type\": \"Notify\"\n          },\n          \"trigger\": {\n            \"timeAfterCreate\": \"P30D\"\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.KeyVault.AutoRotationPolicy","AZR-000123"]},{"location":"en/rules/Azure.KeyVault.AutoRotationPolicy/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To set auto-rotation for a key:</p> <ul> <li>Set the <code>properties.rotationPolicy.lifetimeActions[*].action.type</code> property to <code>Rotate</code>.</li> <li>Set the <code>properties.rotationPolicy.lifetimeActions[*].trigger.timeAfterCreate</code> property to a time duration such as <code>P30D</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vaultName_key1 'Microsoft.KeyVault/vaults/keys@2021-06-01-preview' = {\n  parent: vaultName_resource\n  name: 'key1'\n  properties: {\n    keyOps: [\n      'sign'\n      'verify'\n      'wrapKey'\n      'unwrapKey'\n      'encrypt'\n      'decrypt'\n    ]\n    keySize: 2048\n    kty: 'RSA'\n    rotationPolicy: {\n      lifetimeActions: [\n        {\n          action: {\n            type: 'rotate'\n          }\n          trigger: {\n            timeAfterCreate: 'P18D'\n          }\n        }\n        {\n          action: {\n            type: 'notify'\n          }\n          trigger: {\n            timeAfterCreate: 'P30D'\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.KeyVault.AutoRotationPolicy","AZR-000123"]},{"location":"en/rules/Azure.KeyVault.AutoRotationPolicy/#links","title":"Links","text":"<ul> <li>SE:09 Application secrets</li> <li>IM-3: Manage application identities securely and automatically</li> <li>Configure cryptographic key auto-rotation in Azure Key Vault</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.KeyVault.AutoRotationPolicy","AZR-000123"]},{"location":"en/rules/Azure.KeyVault.Firewall/","title":"Configure Azure Key Vault firewall","text":"Azure.KeyVault.FirewallAZR-000355Error <p> Security  \u00b7  Key Vault  \u00b7  Rule  \u00b7  2023_03  \u00b7  Important</p> <p>Key Vault should only accept explicitly allowed traffic.</p>","tags":["Azure.KeyVault.Firewall","AZR-000355"]},{"location":"en/rules/Azure.KeyVault.Firewall/#description","title":"Description","text":"<p>By default, Key Vault accept connections from clients on any network. To limit access to selected networks, you must first change the default action.</p> <p>After changing the default action from <code>Allow</code> to <code>Deny</code>, configure one or more rules to allow traffic. Traffic can be allowed from:</p> <ul> <li>Azure services on the trusted service list.</li> <li>IP address or CIDR range.</li> <li>Private endpoint connections.</li> <li>Azure virtual network subnets with a Service Endpoint.</li> </ul> <p>If any of the following options are enabled you must also enable Allow trusted Microsoft services to bypass this firewall:</p> <ul> <li><code>enabledForDeployment</code> - Azure Virtual Machines for deployment.</li> <li><code>enabledForDiskEncryption</code> - Azure Disk Encryption for volume encryption.</li> <li><code>enabledForTemplateDeployment</code> - Azure Resource Manager for template deployment.</li> </ul>","tags":["Azure.KeyVault.Firewall","AZR-000355"]},{"location":"en/rules/Azure.KeyVault.Firewall/#recommendation","title":"Recommendation","text":"<p>Consider configuring Key Vault firewall to restrict network access to permitted clients only. Also consider enforcing this setting using Azure Policy.</p>","tags":["Azure.KeyVault.Firewall","AZR-000355"]},{"location":"en/rules/Azure.KeyVault.Firewall/#examples","title":"Examples","text":"","tags":["Azure.KeyVault.Firewall","AZR-000355"]},{"location":"en/rules/Azure.KeyVault.Firewall/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Key Vaults that pass this rule:</p> <ul> <li>Set the <code>properties.networkAcls.defaultAction</code> property to <code>Deny</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.KeyVault/vaults\",\n  \"apiVersion\": \"2023-02-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"sku\": {\n      \"family\": \"A\",\n      \"name\": \"premium\"\n    },\n    \"tenantId\": \"[tenant().tenantId]\",\n    \"softDeleteRetentionInDays\": 90,\n    \"enableSoftDelete\": true,\n    \"enablePurgeProtection\": true,\n    \"enableRbacAuthorization\": true,\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\",\n      \"bypass\": \"AzureServices\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.KeyVault.Firewall","AZR-000355"]},{"location":"en/rules/Azure.KeyVault.Firewall/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Key Vaults that pass this rule:</p> <ul> <li>Set the <code>properties.networkAcls.defaultAction</code> property to <code>Deny</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vault 'Microsoft.KeyVault/vaults@2023-02-01' = {\n  name: name\n  location: location\n  properties: {\n    sku: {\n      family: 'A'\n      name: 'premium'\n    }\n    tenantId: tenant().tenantId\n    softDeleteRetentionInDays: 90\n    enableSoftDelete: true\n    enablePurgeProtection: true\n    enableRbacAuthorization: true\n    networkAcls: {\n      defaultAction: 'Deny'\n      bypass: 'AzureServices'\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/key-vault/vault:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/key-vault/vault:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.KeyVault.Firewall","AZR-000355"]},{"location":"en/rules/Azure.KeyVault.Firewall/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Azure Key Vault should have firewall enabled <code>/providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490</code>.</li> <li>Configure key vaults to enable firewall <code>/providers/Microsoft.Authorization/policyDefinitions/ac673a9a-f77d-4846-b2d8-a57f8e1c01dc</code>.</li> </ul>","tags":["Azure.KeyVault.Firewall","AZR-000355"]},{"location":"en/rules/Azure.KeyVault.Firewall/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>NS-2: Secure cloud services with network controls</li> <li>Configure Azure Key Vault firewalls and virtual networks</li> <li>Trusted services</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.KeyVault.Firewall","AZR-000355"]},{"location":"en/rules/Azure.KeyVault.KeyName/","title":"Use valid Key Vault Key names","text":"Azure.KeyVault.KeyNameAZR-000122Error <p> Operational Excellence  \u00b7  Key Vault  \u00b7  Rule  \u00b7  2021_03  \u00b7  Awareness</p> <p>Key Vault Key names should meet naming requirements.</p>","tags":["Azure.KeyVault.KeyName","AZR-000122"]},{"location":"en/rules/Azure.KeyVault.KeyName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Key Vault Key names are:</p> <ul> <li>Between 1 and 127 characters long.</li> <li>Alphanumerics and hyphens (dash).</li> <li>Keys must be unique within a Key Vault.</li> </ul>","tags":["Azure.KeyVault.KeyName","AZR-000122"]},{"location":"en/rules/Azure.KeyVault.KeyName/#recommendation","title":"Recommendation","text":"<p>Consider using key names that meet Key Vault naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.KeyVault.KeyName","AZR-000122"]},{"location":"en/rules/Azure.KeyVault.KeyName/#notes","title":"Notes","text":"<p>This rule does not check if Key names are unique.</p>","tags":["Azure.KeyVault.KeyName","AZR-000122"]},{"location":"en/rules/Azure.KeyVault.KeyName/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Azure resources</li> <li>Tagging and resource naming</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.KeyVault.KeyName","AZR-000122"]},{"location":"en/rules/Azure.KeyVault.Logs/","title":"Audit Key Vault Data Access","text":"Azure.KeyVault.LogsAZR-000119Error <p> Security  \u00b7  Key Vault  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Ensure audit diagnostics logs are enabled to audit Key Vault access.</p>","tags":["Azure.KeyVault.Logs","AZR-000119"]},{"location":"en/rules/Azure.KeyVault.Logs/#description","title":"Description","text":"<p>To capture logs that record interactions with data or the settings of key vault, diagnostic settings must be configured.</p> <p>When configuring diagnostics settings, enable one of the following:</p> <ul> <li><code>AuditEvent</code> category.</li> <li><code>audit</code> category group.</li> <li><code>allLogs</code> category group.</li> </ul> <p>Management operations for Key Vault is captured automatically within Azure Activity Logs.</p>","tags":["Azure.KeyVault.Logs","AZR-000119"]},{"location":"en/rules/Azure.KeyVault.Logs/#recommendation","title":"Recommendation","text":"<p>Configure audit diagnostics logs to audit Key Vault access.</p>","tags":["Azure.KeyVault.Logs","AZR-000119"]},{"location":"en/rules/Azure.KeyVault.Logs/#examples","title":"Examples","text":"","tags":["Azure.KeyVault.Logs","AZR-000119"]},{"location":"en/rules/Azure.KeyVault.Logs/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy key vaults that pass this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource (extension resource).</li> <li>Enable <code>AuditEvent</code> category or <code>audit</code> category group or <code>allLogs</code> category group.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.KeyVault/vaults\",\n  \"apiVersion\": \"2023-02-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"sku\": {\n      \"family\": \"A\",\n      \"name\": \"premium\"\n    },\n    \"tenantId\": \"[tenant().tenantId]\",\n    \"softDeleteRetentionInDays\": 90,\n    \"enableSoftDelete\": true,\n    \"enablePurgeProtection\": true,\n    \"enableRbacAuthorization\": true,\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\",\n      \"bypass\": \"AzureServices\"\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.Insights/diagnosticSettings\",\n      \"apiVersion\": \"2021-05-01-preview\",\n      \"scope\": \"[format('Microsoft.KeyVault/vaults/{0}', parameters('name'))]\",\n      \"name\": \"logs\",\n      \"properties\": {\n        \"workspaceId\": \"[parameters('workspaceId')]\",\n        \"logs\": [\n          {\n            \"category\": \"AuditEvent\",\n            \"enabled\": true\n          }\n        ]\n      },\n      \"dependsOn\": [\n        \"[parameters('name')]\"\n      ]\n    }\n  ]\n}\n</code></pre>","tags":["Azure.KeyVault.Logs","AZR-000119"]},{"location":"en/rules/Azure.KeyVault.Logs/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy key vaults that pass this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource (extension resource).</li> <li>Enable <code>AuditEvent</code> category or <code>audit</code> category group or <code>allLogs</code> category group.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vault 'Microsoft.KeyVault/vaults@2023-02-01' = {\n  name: name\n  location: location\n  properties: {\n    sku: {\n      family: 'A'\n      name: 'premium'\n    }\n    tenantId: tenant().tenantId\n    softDeleteRetentionInDays: 90\n    enableSoftDelete: true\n    enablePurgeProtection: true\n    enableRbacAuthorization: true\n    networkAcls: {\n      defaultAction: 'Deny'\n      bypass: 'AzureServices'\n    }\n  }\n}\n\nresource logs 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  name: 'logs'\n  scope: vault\n  properties: {\n    workspaceId: workspaceId\n    logs: [\n      {\n        category: 'AuditEvent'\n        enabled: true\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.KeyVault.Logs","AZR-000119"]},{"location":"en/rules/Azure.KeyVault.Logs/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>LT-4: Enable logging for security investigation</li> <li>Best practices to use Key Vault</li> <li>Azure Key Vault logging</li> <li>Azure Key Vault security</li> <li>Monitoring your Key Vault service with Key Vault insights</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.KeyVault.Logs","AZR-000119"]},{"location":"en/rules/Azure.KeyVault.Name/","title":"Use valid Key Vault names","text":"Azure.KeyVault.NameAZR-000120Error <p> Operational Excellence  \u00b7  Key Vault  \u00b7  Rule  \u00b7  2021_03  \u00b7  Awareness</p> <p>Key Vault names should meet naming requirements.</p>","tags":["Azure.KeyVault.Name","AZR-000120"]},{"location":"en/rules/Azure.KeyVault.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Key Vault names are:</p> <ul> <li>Between 3 and 24 characters long.</li> <li>Alphanumerics and hyphens (dash).</li> <li>Start with a letter.</li> <li>End with a letter or digit.</li> <li>Can not contain consecutive hyphens.</li> <li>Key Vault names must be globally unique.</li> </ul>","tags":["Azure.KeyVault.Name","AZR-000120"]},{"location":"en/rules/Azure.KeyVault.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Key Vault naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.KeyVault.Name","AZR-000120"]},{"location":"en/rules/Azure.KeyVault.Name/#notes","title":"Notes","text":"<p>This rule does not check if Key Vault names are unique.</p>","tags":["Azure.KeyVault.Name","AZR-000120"]},{"location":"en/rules/Azure.KeyVault.Name/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> <li>Tagging and resource naming</li> </ul>","tags":["Azure.KeyVault.Name","AZR-000120"]},{"location":"en/rules/Azure.KeyVault.PurgeProtect/","title":"Use Key Vault Purge Protection","text":"Azure.KeyVault.PurgeProtectAZR-000125Error <p> Reliability  \u00b7  Key Vault  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items.</p>","tags":["Azure.KeyVault.PurgeProtect","AZR-000125"]},{"location":"en/rules/Azure.KeyVault.PurgeProtect/#description","title":"Description","text":"<p>Purge Protection is a feature of Key Vault that prevents purging of vaults and vault items. When soft delete is configured without purge protection, deleted vaults and vault items can be purged. Purging deletes the vault and/ or vault items immediately, and is irreversible.</p> <p>When purge protection is enabled, vaults and vault items can no longer be purged. Deleted vaults and vault items will be recoverable until the configured retention period. By default, the retention period is 90 days.</p> <p>Purge protection is not enabled by default.</p>","tags":["Azure.KeyVault.PurgeProtect","AZR-000125"]},{"location":"en/rules/Azure.KeyVault.PurgeProtect/#recommendation","title":"Recommendation","text":"<p>Consider enabling purge protection on Key Vaults to enforce retention of vaults and vault items for up to 90 days.</p>","tags":["Azure.KeyVault.PurgeProtect","AZR-000125"]},{"location":"en/rules/Azure.KeyVault.PurgeProtect/#examples","title":"Examples","text":"","tags":["Azure.KeyVault.PurgeProtect","AZR-000125"]},{"location":"en/rules/Azure.KeyVault.PurgeProtect/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Key Vaults that pass this rule:</p> <ul> <li>Set the <code>properties.enablePurgeProtection</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.KeyVault/vaults\",\n  \"apiVersion\": \"2023-07-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"sku\": {\n      \"family\": \"A\",\n      \"name\": \"premium\"\n    },\n    \"tenantId\": \"[tenant().tenantId]\",\n    \"softDeleteRetentionInDays\": 90,\n    \"enableSoftDelete\": true,\n    \"enablePurgeProtection\": true,\n    \"enableRbacAuthorization\": true,\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\",\n      \"bypass\": \"AzureServices\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.KeyVault.PurgeProtect","AZR-000125"]},{"location":"en/rules/Azure.KeyVault.PurgeProtect/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Key Vaults that pass this rule:</p> <ul> <li>Set the <code>properties.enablePurgeProtection</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vault 'Microsoft.KeyVault/vaults@2023-07-01' = {\n  name: name\n  location: location\n  properties: {\n    sku: {\n      family: 'A'\n      name: 'premium'\n    }\n    tenantId: tenant().tenantId\n    softDeleteRetentionInDays: 90\n    enableSoftDelete: true\n    enablePurgeProtection: true\n    enableRbacAuthorization: true\n    networkAcls: {\n      defaultAction: 'Deny'\n      bypass: 'AzureServices'\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/key-vault/vault:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/key-vault/vault:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.KeyVault.PurgeProtect","AZR-000125"]},{"location":"en/rules/Azure.KeyVault.PurgeProtect/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az keyvault update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --enable-purge-protection\n</code></pre>","tags":["Azure.KeyVault.PurgeProtect","AZR-000125"]},{"location":"en/rules/Azure.KeyVault.PurgeProtect/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Update-AzKeyVault -ResourceGroupName '&lt;resource_group&gt;' -Name '&lt;name&gt;' -EnablePurgeProtection\n</code></pre>","tags":["Azure.KeyVault.PurgeProtect","AZR-000125"]},{"location":"en/rules/Azure.KeyVault.PurgeProtect/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Key vaults should have deletion protection enabled <code>/providers/Microsoft.Authorization/policyDefinitions/0b60c0b2-2dc2-4e1c-b5c9-abbed971de53</code>.</li> </ul>","tags":["Azure.KeyVault.PurgeProtect","AZR-000125"]},{"location":"en/rules/Azure.KeyVault.PurgeProtect/#links","title":"Links","text":"<ul> <li>RE:07 Self-preservation</li> <li>Azure Key Vault soft-delete overview</li> <li>Azure Key Vault security</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.KeyVault.PurgeProtect","AZR-000125"]},{"location":"en/rules/Azure.KeyVault.RBAC/","title":"Use Azure role-based access control","text":"Azure.KeyVault.RBACAZR-000388Warning <p> Security  \u00b7  Key Vault  \u00b7  Rule  \u00b7  2023_06  \u00b7  Awareness</p> <p>Key Vaults should use Azure RBAC as the authorization system for the data plane.</p>","tags":["Azure.KeyVault.RBAC","AZR-000388"]},{"location":"en/rules/Azure.KeyVault.RBAC/#description","title":"Description","text":"<p>Azure RBAC is the recommended authorization system for the Azure Key Vault data plane.</p> <p>Azure RBAC allows users to manage key, secrets, and certificates permissions. It provides one place to manage all permissions across all Key Vaults.</p> <p>Azure RBAC for Key Vault also allows users to have separate permissions on individual keys, secrets, and certificates.</p> <p>The Azure RBAC permission model is not enabled by default.</p>","tags":["Azure.KeyVault.RBAC","AZR-000388"]},{"location":"en/rules/Azure.KeyVault.RBAC/#recommendation","title":"Recommendation","text":"<p>Consider using Azure RBAC as the authorization system on Key Vaults for the data plane.</p>","tags":["Azure.KeyVault.RBAC","AZR-000388"]},{"location":"en/rules/Azure.KeyVault.RBAC/#examples","title":"Examples","text":"","tags":["Azure.KeyVault.RBAC","AZR-000388"]},{"location":"en/rules/Azure.KeyVault.RBAC/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Key Vaults that pass this rule:</p> <ul> <li>Set the <code>properties.enableRbacAuthorization</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.KeyVault/vaults\",\n  \"apiVersion\": \"2023-07-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"sku\": {\n      \"family\": \"A\",\n      \"name\": \"premium\"\n    },\n    \"tenantId\": \"[tenant().tenantId]\",\n    \"softDeleteRetentionInDays\": 90,\n    \"enableSoftDelete\": true,\n    \"enablePurgeProtection\": true,\n    \"enableRbacAuthorization\": true,\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\",\n      \"bypass\": \"AzureServices\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.KeyVault.RBAC","AZR-000388"]},{"location":"en/rules/Azure.KeyVault.RBAC/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Key Vaults that pass this rule:</p> <ul> <li>Set the <code>properties.enableRbacAuthorization</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vault 'Microsoft.KeyVault/vaults@2023-07-01' = {\n  name: name\n  location: location\n  properties: {\n    sku: {\n      family: 'A'\n      name: 'premium'\n    }\n    tenantId: tenant().tenantId\n    softDeleteRetentionInDays: 90\n    enableSoftDelete: true\n    enablePurgeProtection: true\n    enableRbacAuthorization: true\n    networkAcls: {\n      defaultAction: 'Deny'\n      bypass: 'AzureServices'\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/key-vault/vault:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/key-vault/vault:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.KeyVault.RBAC","AZR-000388"]},{"location":"en/rules/Azure.KeyVault.RBAC/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az keyvault update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --enable-rbac-authorization\n</code></pre>","tags":["Azure.KeyVault.RBAC","AZR-000388"]},{"location":"en/rules/Azure.KeyVault.RBAC/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Update-AzKeyVault -ResourceGroupName '&lt;resource_group&gt;' -Name '&lt;name&gt;' -EnableRbacAuthorization\n</code></pre>","tags":["Azure.KeyVault.RBAC","AZR-000388"]},{"location":"en/rules/Azure.KeyVault.RBAC/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Azure Key Vault should use RBAC permission model <code>/providers/Microsoft.Authorization/policyDefinitions/12d4fa5e-1f9f-4c21-97a9-b99b3c6611b5</code>.</li> </ul>","tags":["Azure.KeyVault.RBAC","AZR-000388"]},{"location":"en/rules/Azure.KeyVault.RBAC/#notes","title":"Notes","text":"<p>The RBAC permission model may not be suitable for all use cases. If this rule is not suitable for your use case, you can exclude or suppress the rule. For information about limitations see Azure role-based access control vs. access policies in the <code>LINKS</code> section.</p>","tags":["Azure.KeyVault.RBAC","AZR-000388"]},{"location":"en/rules/Azure.KeyVault.RBAC/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>IM-1: Use centralized identity and authentication system</li> <li>What is Azure role-based access control?</li> <li>Provide access to Key Vault keys, certificates, and secrets with an Azure role-based access control</li> <li>Azure role-based access control vs. access policies</li> <li>Migrate from vault access policy to an Azure role-based access control permission model</li> <li>Azure Key Vault security</li> <li>Azure security baseline for Key Vault</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.KeyVault.RBAC","AZR-000388"]},{"location":"en/rules/Azure.KeyVault.SecretName/","title":"Use valid Key Vault Secret names","text":"Azure.KeyVault.SecretNameAZR-000121Error <p> Operational Excellence  \u00b7  Key Vault  \u00b7  Rule  \u00b7  2021_03  \u00b7  Awareness</p> <p>Key Vault Secret names should meet naming requirements.</p>","tags":["Azure.KeyVault.SecretName","AZR-000121"]},{"location":"en/rules/Azure.KeyVault.SecretName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Key Vault Secret names are:</p> <ul> <li>Between 1 and 127 characters long.</li> <li>Alphanumerics and hyphens (dash).</li> <li>Secrets must be unique within a Key Vault.</li> </ul>","tags":["Azure.KeyVault.SecretName","AZR-000121"]},{"location":"en/rules/Azure.KeyVault.SecretName/#recommendation","title":"Recommendation","text":"<p>Consider using secret names that meet Key Vault naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.KeyVault.SecretName","AZR-000121"]},{"location":"en/rules/Azure.KeyVault.SecretName/#notes","title":"Notes","text":"<p>This rule does not check if Secret names are unique.</p>","tags":["Azure.KeyVault.SecretName","AZR-000121"]},{"location":"en/rules/Azure.KeyVault.SecretName/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> <li>Tagging and resource naming</li> </ul>","tags":["Azure.KeyVault.SecretName","AZR-000121"]},{"location":"en/rules/Azure.KeyVault.SoftDelete/","title":"Use Key Vault Soft Delete","text":"Azure.KeyVault.SoftDeleteAZR-000124Error <p> Reliability  \u00b7  Key Vault  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion.</p>","tags":["Azure.KeyVault.SoftDelete","AZR-000124"]},{"location":"en/rules/Azure.KeyVault.SoftDelete/#description","title":"Description","text":"<p>Soft Delete is a feature of Key Vault that retains Key Vaults and Key Vault items after initial deletion. A soft deleted vault or vault item can be restored within the configured retention period.</p> <p>By default, new Key Vaults created through the portal will have soft delete for 90 days configured.</p> <p>Once enabled, soft delete can not be disabled. When soft delete is enabled, it is possible to purge soft deleted vaults and vault items.</p>","tags":["Azure.KeyVault.SoftDelete","AZR-000124"]},{"location":"en/rules/Azure.KeyVault.SoftDelete/#recommendation","title":"Recommendation","text":"<p>Consider enabling soft delete on Key Vaults to enable recovery of vaults and vault items.</p>","tags":["Azure.KeyVault.SoftDelete","AZR-000124"]},{"location":"en/rules/Azure.KeyVault.SoftDelete/#examples","title":"Examples","text":"","tags":["Azure.KeyVault.SoftDelete","AZR-000124"]},{"location":"en/rules/Azure.KeyVault.SoftDelete/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Key Vaults that pass this rule:</p> <ul> <li>Set the <code>properties.enableSoftDelete</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.KeyVault/vaults\",\n  \"apiVersion\": \"2023-07-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"sku\": {\n      \"family\": \"A\",\n      \"name\": \"premium\"\n    },\n    \"tenantId\": \"[tenant().tenantId]\",\n    \"softDeleteRetentionInDays\": 90,\n    \"enableSoftDelete\": true,\n    \"enablePurgeProtection\": true,\n    \"enableRbacAuthorization\": true,\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\",\n      \"bypass\": \"AzureServices\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.KeyVault.SoftDelete","AZR-000124"]},{"location":"en/rules/Azure.KeyVault.SoftDelete/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Key Vaults that pass this rule:</p> <ul> <li>Set the <code>properties.enableSoftDelete</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vault 'Microsoft.KeyVault/vaults@2023-07-01' = {\n  name: name\n  location: location\n  properties: {\n    sku: {\n      family: 'A'\n      name: 'premium'\n    }\n    tenantId: tenant().tenantId\n    softDeleteRetentionInDays: 90\n    enableSoftDelete: true\n    enablePurgeProtection: true\n    enableRbacAuthorization: true\n    networkAcls: {\n      defaultAction: 'Deny'\n      bypass: 'AzureServices'\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/key-vault/vault:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/key-vault/vault:0.9.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.KeyVault.SoftDelete","AZR-000124"]},{"location":"en/rules/Azure.KeyVault.SoftDelete/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az keyvault update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --retention-days 90\n</code></pre>","tags":["Azure.KeyVault.SoftDelete","AZR-000124"]},{"location":"en/rules/Azure.KeyVault.SoftDelete/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Key vaults should have soft delete enabled <code>/providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d</code>.</li> </ul>","tags":["Azure.KeyVault.SoftDelete","AZR-000124"]},{"location":"en/rules/Azure.KeyVault.SoftDelete/#links","title":"Links","text":"<ul> <li>RE:07 Self-preservation</li> <li>Azure Key Vault soft-delete overview</li> <li>Soft-delete will be enabled on all key vaults</li> <li>Azure Key Vault security</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.KeyVault.SoftDelete","AZR-000124"]},{"location":"en/rules/Azure.LB.AvailabilityZone/","title":"Internal load balancers should be zone-redundant","text":"Azure.LB.AvailabilityZoneAZR-000127Error <p> Reliability  \u00b7  Load Balancer  \u00b7  Rule  \u00b7  2021_09  \u00b7  Important</p> <p>Load balancers deployed with Standard SKU should be zone-redundant for high availability.</p>","tags":["Azure.LB.AvailabilityZone","AZR-000127"]},{"location":"en/rules/Azure.LB.AvailabilityZone/#description","title":"Description","text":"<p>A load balancer is an Azure service that distributes traffic among instances of a service in a backend pool (such as VMs). Load balancers route traffic to healthy instances in the backend pool based on configured rules. However if the load balancer itself becomes unavailable, traffic sent through the load balancer may become disrupted.</p> <p>In a region that supports availability zones, Standard Load Balancers can be deployed across multiple zones (zone-redundant). A zone-redundant Load Balancer allows traffic to be served by a single frontend IP address that can survive zone failure.</p> <p>Also consider the data path to the backend pool, and ensure that the backend pool is deployed with zone-redundancy in mind.</p> <p>In a region that supports availability zones, Standard Load Balancers should be deployed with zone-redundancy.</p>","tags":["Azure.LB.AvailabilityZone","AZR-000127"]},{"location":"en/rules/Azure.LB.AvailabilityZone/#recommendation","title":"Recommendation","text":"<p>Consider using load balancers deployed across at least two availability zones.</p>","tags":["Azure.LB.AvailabilityZone","AZR-000127"]},{"location":"en/rules/Azure.LB.AvailabilityZone/#examples","title":"Examples","text":"","tags":["Azure.LB.AvailabilityZone","AZR-000127"]},{"location":"en/rules/Azure.LB.AvailabilityZone/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure zone-redundancy for a load balancer.</p> <ul> <li>Set the <code>sku.name</code> property to <code>Standard</code>.</li> <li>Set the <code>properties.frontendIPConfigurations[*].zones</code> property to at least two availability zones.   e.g. <code>1</code>, <code>2</code>, <code>3</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/loadBalancers\",\n  \"apiVersion\": \"2023-09-01\",\n  \"name\": \"[parameters('lbName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard\",\n    \"tier\": \"Regional\"\n  },\n  \"properties\": {\n    \"frontendIPConfigurations\": [\n      {\n        \"name\": \"frontendIPConfig\",\n        \"properties\": {\n          \"privateIPAllocationMethod\": \"Dynamic\",\n          \"subnet\": {\n            \"id\": \"[reference(resourceId('Microsoft.Network/virtualNetworks', parameters('name')), '2023-09-01').subnets[1].id]\"\n          }\n        },\n        \"zones\": [\n          \"1\",\n          \"2\",\n          \"3\"\n        ]\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.LB.AvailabilityZone","AZR-000127"]},{"location":"en/rules/Azure.LB.AvailabilityZone/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure zone-redundancy for a load balancer.</p> <ul> <li>Set the <code>sku.name</code> property to <code>Standard</code>.</li> <li>Set the <code>properties.frontendIPConfigurations[*].zones</code> property to at least two availability zones.   e.g. <code>1</code>, <code>2</code>, <code>3</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource internal_lb 'Microsoft.Network/loadBalancers@2023-09-01' = {\n  name: lbName\n  location: location\n  sku: {\n    name: 'Standard'\n    tier: 'Regional'\n  }\n  properties: {\n    frontendIPConfigurations: [\n      {\n        name: 'frontendIPConfig'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: vnet.properties.subnets[1].id\n          }\n        }\n        zones: [\n          '1'\n          '2'\n          '3'\n        ]\n      }\n    ]\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/network/load-balancer:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/network/load-balancer:0.4.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.LB.AvailabilityZone","AZR-000127"]},{"location":"en/rules/Azure.LB.AvailabilityZone/#notes","title":"Notes","text":"<p>This rule applies to internal load balancers deployed with Standard SKU. Internal load balancers do not have a public IP address and are used to load balance traffic inside a virtual network.</p> <p>The <code>zones</code> property is not supported with:</p> <ul> <li>Public load balancers, which are load balancers with a public IP address.   To address availability zones for public load balancers, use a Standard tier zone-redundant public IP address.</li> <li>Load balancers deployed with Basic SKU, which are not zone-redundant.</li> </ul> <p>For regions that support availability zones, the <code>zones</code> property should be set to at least two zones.</p>","tags":["Azure.LB.AvailabilityZone","AZR-000127"]},{"location":"en/rules/Azure.LB.AvailabilityZone/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>What is Azure Load Balancer?</li> <li>Azure Load Balancer components</li> <li>Reliability in Load Balancer</li> <li>Zone redundant load balancer</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.LB.AvailabilityZone","AZR-000127"]},{"location":"en/rules/Azure.LB.Name/","title":"Use valid Load Balancer names","text":"Azure.LB.NameAZR-000129Error <p> Operational Excellence  \u00b7  Load Balancer  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Load Balancer names should meet naming requirements.</p>","tags":["Azure.LB.Name","AZR-000129"]},{"location":"en/rules/Azure.LB.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Load Balancer names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>Load Balancer names must be unique within a resource group.</li> </ul>","tags":["Azure.LB.Name","AZR-000129"]},{"location":"en/rules/Azure.LB.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Load Balancer naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.LB.Name","AZR-000129"]},{"location":"en/rules/Azure.LB.Name/#notes","title":"Notes","text":"<p>This rule does not check if Load Balancer names are unique.</p>","tags":["Azure.LB.Name","AZR-000129"]},{"location":"en/rules/Azure.LB.Name/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> <li>Recommended abbreviations for Azure resource types</li> </ul>","tags":["Azure.LB.Name","AZR-000129"]},{"location":"en/rules/Azure.LB.Probe/","title":"Use a specific load balancer probe","text":"Azure.LB.ProbeAZR-000126Error <p> Reliability  \u00b7  Load Balancer  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Use a specific probe for web protocols.</p>","tags":["Azure.LB.Probe","AZR-000126"]},{"location":"en/rules/Azure.LB.Probe/#description","title":"Description","text":"<p>A load balancer is an Azure service that distributes traffic among instances of a service in a backend pool (such as VMs). Load balancers route traffic to instances in the backend pool based on configured rules.</p> <p>In additional to routing traffic, load balancers can also monitor the health of backend instances with a health probe. Monitoring the health of backend instances allows the load balancer to route traffic towards health instances. For example, if one instance is unavailable, the load balancer can route traffic to another instance that is available.</p> <p>To monitor the health of backend instances, the load balancer sends periodic requests and checks the response from the backend. Azure Load Balancer supports health probes for TCP, HTTP, and HTTPS.</p> <p>If your backend is communicating over HTTP or HTTPS, you should:</p> <ul> <li>Use HTTP/ HTTPS probes \u2014 instead of a TCP port.   For example, if a web server process is running it may not be able to respond to a TCP probe.   However, that does not indicate that the application is working correctly, as it could be returning a <code>5XX</code> error.   Using HTTP/ HTTPS probes allows you to check for a HTTP 200 status code.</li> <li>Use a dedicated health check endpoint \u2014 such as <code>/health</code>  or <code>/healthz</code> for health probes.   Commonly the main landing page of an application <code>/</code> is not a good health check endpoint.   By design, it may only serve static content and not execute any application logic, such as a login page.</li> </ul>","tags":["Azure.LB.Probe","AZR-000126"]},{"location":"en/rules/Azure.LB.Probe/#recommendation","title":"Recommendation","text":"<p>Consider using a dedicated health check endpoint for HTTP or HTTPS health probes.</p>","tags":["Azure.LB.Probe","AZR-000126"]},{"location":"en/rules/Azure.LB.Probe/#examples","title":"Examples","text":"","tags":["Azure.LB.Probe","AZR-000126"]},{"location":"en/rules/Azure.LB.Probe/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy load balancers that pass this rule:</p> <ul> <li>Configure HTTP or HTTPS based probes on ports that commonly use HTTP or HTTPS protocols.<ul> <li>Set the <code>properties.probes[*]</code> property to include a probe with the following properties:<ul> <li><code>properties.probes[*].properties.protocol</code> set to <code>HTTPS</code>.</li> <li><code>properties.probes[*].properties.requestPath</code> set to <code>/health</code>.</li> </ul> </li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/loadBalancers\",\n  \"apiVersion\": \"2023-09-01\",\n  \"name\": \"[parameters('lbName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard\"\n  },\n  \"properties\": {\n    \"frontendIPConfigurations\": [\n      {\n        \"name\": \"frontend1\",\n        \"properties\": {\n          \"privateIPAddressVersion\": \"IPv4\",\n          \"privateIPAllocationMethod\": \"Dynamic\",\n          \"subnet\": {\n            \"id\": \"[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('name'), 'GatewaySubnet')]\"\n          }\n        },\n        \"zones\": [\n          \"2\",\n          \"3\",\n          \"1\"\n        ]\n      }\n    ],\n    \"backendAddressPools\": [\n      {\n        \"name\": \"backend1\"\n      }\n    ],\n    \"probes\": [\n      {\n        \"name\": \"https\",\n        \"properties\": {\n          \"protocol\": \"HTTPS\",\n          \"port\": 443,\n          \"requestPath\": \"/health\",\n          \"intervalInSeconds\": 5,\n          \"numberOfProbes\": 1\n        }\n      }\n    ],\n    \"loadBalancingRules\": [\n      {\n        \"name\": \"https\",\n        \"properties\": {\n          \"frontendIPConfiguration\": {\n            \"id\": \"[resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations', parameters('lbName'), 'frontend1')]\"\n          },\n          \"frontendPort\": 443,\n          \"backendPort\": 443,\n          \"enableFloatingIP\": false,\n          \"idleTimeoutInMinutes\": 4,\n          \"protocol\": \"TCP\",\n          \"loadDistribution\": \"Default\",\n          \"probe\": {\n            \"id\": \"[resourceId('Microsoft.Network/loadBalancers/probes', parameters('lbName'), 'https')]\"\n          },\n          \"disableOutboundSnat\": true,\n          \"enableTcpReset\": false,\n          \"backendAddressPools\": [\n            {\n              \"id\": \"[resourceId('Microsoft.Network/loadBalancers/backendAddressPools', parameters('lbName'), 'backend1')]\"\n            }\n          ]\n        }\n      }\n    ],\n    \"inboundNatRules\": [],\n    \"outboundRules\": []\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('name'), 'GatewaySubnet')]\"\n  ]\n}\n</code></pre>","tags":["Azure.LB.Probe","AZR-000126"]},{"location":"en/rules/Azure.LB.Probe/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy load balancers that pass this rule:</p> <ul> <li>Configure HTTP or HTTPS based probes on ports that commonly use HTTP or HTTPS protocols.<ul> <li>Set the <code>properties.probes[*]</code> property to include a probe with the following properties:<ul> <li><code>properties.probes[*].properties.protocol</code> set to <code>HTTPS</code>.</li> <li><code>properties.probes[*].properties.requestPath</code> set to <code>/health</code>.</li> </ul> </li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource https_lb 'Microsoft.Network/loadBalancers@2023-09-01' = {\n  name: lbName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    frontendIPConfigurations: [\n      {\n        name: 'frontend1'\n        properties: {\n          privateIPAddressVersion: 'IPv4'\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: subnet01.id\n          }\n        }\n        zones: [\n          '2'\n          '3'\n          '1'\n        ]\n      }\n    ]\n    backendAddressPools: [\n      {\n        name: 'backend1'\n      }\n    ]\n    probes: [\n      {\n        name: 'https'\n        properties: {\n          protocol: 'HTTPS'\n          port: 443\n          requestPath: '/health'\n          intervalInSeconds: 5\n          numberOfProbes: 1\n        }\n      }\n    ]\n    loadBalancingRules: [\n      {\n        name: 'https'\n        properties: {\n          frontendIPConfiguration: {\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations', lbName, 'frontend1')\n          }\n          frontendPort: 443\n          backendPort: 443\n          enableFloatingIP: false\n          idleTimeoutInMinutes: 4\n          protocol: 'TCP'\n          loadDistribution: 'Default'\n          probe: {\n            id: resourceId('Microsoft.Network/loadBalancers/probes', lbName, 'https')\n          }\n          disableOutboundSnat: true\n          enableTcpReset: false\n          backendAddressPools: [\n            {\n              id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', lbName, 'backend1')\n            }\n          ]\n        }\n      }\n    ]\n    inboundNatRules: []\n    outboundRules: []\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/network/load-balancer:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/network/load-balancer:0.4.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.LB.Probe","AZR-000126"]},{"location":"en/rules/Azure.LB.Probe/#notes","title":"Notes","text":"<p>This rule only applies to probes for ports that commonly use HTTP or HTTPS protocols.</p>","tags":["Azure.LB.Probe","AZR-000126"]},{"location":"en/rules/Azure.LB.Probe/#links","title":"Links","text":"<ul> <li>RE:05 Redundancy</li> <li>Load Balancer health probes</li> <li>Health Endpoint Monitoring pattern</li> <li>Reliability in Load Balancer</li> <li>Health Probes</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.LB.Probe","AZR-000126"]},{"location":"en/rules/Azure.LB.StandardSKU/","title":"Load balancers should use Standard SKU","text":"Azure.LB.StandardSKUAZR-000128Error <p> Reliability  \u00b7  Load Balancer  \u00b7  Rule  \u00b7  2021_09  \u00b7  Important</p> <p>Load balancers should be deployed with Standard SKU for production workloads.</p>","tags":["Azure.LB.StandardSKU","AZR-000128"]},{"location":"en/rules/Azure.LB.StandardSKU/#description","title":"Description","text":"<p>Standard Load Balancer enables you to scale your applications and create high availability for small scale deployments to large and complex multi-zone architectures. It supports inbound as well as outbound connections, provides low latency and high throughput, and scales up to millions of flows for all TCP and UDP applications. It enables Availability Zones with zone-redundant and zonal front ends as well as cross-zone load balancing for public and internal scenarios. You can scale Network Virtual Appliance scenarios and make them more resilient by using internal HA Ports load balancing rules. It also provides new diagnostics insights with multi-dimensional metrics in Azure Monitor.</p>","tags":["Azure.LB.StandardSKU","AZR-000128"]},{"location":"en/rules/Azure.LB.StandardSKU/#recommendation","title":"Recommendation","text":"<p>Consider using Standard SKU for load balancers deployed in production.</p>","tags":["Azure.LB.StandardSKU","AZR-000128"]},{"location":"en/rules/Azure.LB.StandardSKU/#examples","title":"Examples","text":"","tags":["Azure.LB.StandardSKU","AZR-000128"]},{"location":"en/rules/Azure.LB.StandardSKU/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure Standard SKU for a load balancer.</p> <ul> <li>Set <code>sku.name</code> to <code>Standard</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/loadBalancers\",\n  \"apiVersion\": \"2023-09-01\",\n  \"name\": \"[parameters('lbName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard\",\n    \"tier\": \"Regional\"\n  },\n  \"properties\": {\n    \"frontendIPConfigurations\": [\n      {\n        \"name\": \"frontendIPConfig\",\n        \"properties\": {\n          \"privateIPAllocationMethod\": \"Dynamic\",\n          \"subnet\": {\n            \"id\": \"[reference(resourceId('Microsoft.Network/virtualNetworks', parameters('name')), '2023-09-01').subnets[1].id]\"\n          }\n        },\n        \"zones\": [\n          \"1\",\n          \"2\",\n          \"3\"\n        ]\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.LB.StandardSKU","AZR-000128"]},{"location":"en/rules/Azure.LB.StandardSKU/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure Standard SKU for a load balancer.</p> <ul> <li>Set <code>sku.name</code> to <code>Standard</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource internal_lb 'Microsoft.Network/loadBalancers@2023-09-01' = {\n  name: lbName\n  location: location\n  sku: {\n    name: 'Standard'\n    tier: 'Regional'\n  }\n  properties: {\n    frontendIPConfigurations: [\n      {\n        name: 'frontendIPConfig'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: vnet.properties.subnets[1].id\n          }\n        }\n        zones: [\n          '1'\n          '2'\n          '3'\n        ]\n      }\n    ]\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/network/load-balancer:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/network/load-balancer:0.4.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.LB.StandardSKU","AZR-000128"]},{"location":"en/rules/Azure.LB.StandardSKU/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Why use Azure Load Balancer?</li> <li>Azure Load Balancer SKUs</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.LB.StandardSKU","AZR-000128"]},{"location":"en/rules/Azure.LogAnalytics.Replication/","title":"Replicate workspaces across regions","text":"Azure.LogAnalytics.ReplicationAZR-000425Error <p> Reliability  \u00b7  Log Analytics  \u00b7  Rule  \u00b7  Preview  \u00b7  2024_06  \u00b7  Important</p> <p>Log Analytics workspaces should have workspace replication enabled to improve service availability.</p>","tags":["Azure.LogAnalytics.Replication","AZR-000425"]},{"location":"en/rules/Azure.LogAnalytics.Replication/#description","title":"Description","text":"<p>In the event of a service disruption, access to monitoring data and collection of new data in a workspace may be temporarily impacted.</p> <p>Log Analytics workspaces support replication of monitoring data to a workspace to a secondary region. When relication is enabled, new monitoring data is replicated to the secondary region in addition to the primary region. Failover to the workspace in the secondary region can be triggered manually.</p> <p>Some limitations apply:</p> <ul> <li>Failover occurs by updating DNS records to point to the secondary region.   As a result, failover won't occur immediately and clients with open connections won't update until a new connection is established.</li> <li>Failover is a customer initiated action.   Failover to the secondard region does not occur automatically.</li> <li>Data collection rules need to be updated to point to the system data collection endpoint for ingested data to be replicated.</li> <li>See documentation references below for additional limitations and important information.</li> </ul>","tags":["Azure.LogAnalytics.Replication","AZR-000425"]},{"location":"en/rules/Azure.LogAnalytics.Replication/#recommendation","title":"Recommendation","text":"<p>Consider replicating Log Analytics workspaces across regions to improve access to monitoring data in the event of a regional service disruption.</p>","tags":["Azure.LogAnalytics.Replication","AZR-000425"]},{"location":"en/rules/Azure.LogAnalytics.Replication/#examples","title":"Examples","text":"","tags":["Azure.LogAnalytics.Replication","AZR-000425"]},{"location":"en/rules/Azure.LogAnalytics.Replication/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Log Analytics workspaces that pass this rule:</p> <ul> <li>Set the <code>properties.replication.enabled</code> property to <code>true</code>.</li> <li>Set the <code>properties.replication.location</code> property to a supported region in the same region group as the workspace primary region.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.OperationalInsights/workspaces\",\n  \"apiVersion\": \"2023-01-01-preview\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"westeurope\",\n  \"properties\": {\n    \"replication\": {\n      \"enabled\": true,\n      \"location\": \"northeurope\"\n    },\n    \"publicNetworkAccessForIngestion\": \"Enabled\",\n    \"publicNetworkAccessForQuery\": \"Enabled\",\n    \"retentionInDays\": 30,\n    \"sku\": {\n      \"name\": \"PERGB2018\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.LogAnalytics.Replication","AZR-000425"]},{"location":"en/rules/Azure.LogAnalytics.Replication/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Log Analytics workspaces that pass this rule:</p> <ul> <li>Set the <code>properties.replication.enabled</code> property to <code>true</code>.</li> <li>Set the <code>properties.replication.location</code> property to a supported region in the same region group as the workspace primary region.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource workspace 'Microsoft.OperationalInsights/workspaces@2023-01-01-preview' = {\n  name: name\n  location: 'westeurope'\n  properties: {\n    replication: {\n      enabled: true\n      location: 'northeurope'\n    }\n    publicNetworkAccessForIngestion: 'Enabled'\n    publicNetworkAccessForQuery: 'Enabled'\n    retentionInDays: 30\n    sku: {\n      name: 'PERGB2018'\n    }\n  }\n}\n</code></pre>","tags":["Azure.LogAnalytics.Replication","AZR-000425"]},{"location":"en/rules/Azure.LogAnalytics.Replication/#notes","title":"Notes","text":"<p>This feature for Log Analytics workspaces is currently in preview.</p> <p>Replication of Log Analytics workspaces linked to a dedicated cluster is currently not supported.</p>","tags":["Azure.LogAnalytics.Replication","AZR-000425"]},{"location":"en/rules/Azure.LogAnalytics.Replication/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>Replicate workspace across regions</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.LogAnalytics.Replication","AZR-000425"]},{"location":"en/rules/Azure.LogicApp.LimitHTTPTrigger/","title":"Limit Logic App HTTP request triggers","text":"Azure.LogicApp.LimitHTTPTriggerAZR-000130Error <p> Security  \u00b7  Logic App  \u00b7  Rule  \u00b7  2020_12  \u00b7  Critical</p> <p>Limit HTTP request trigger access to trusted IP addresses.</p>","tags":["Azure.LogicApp.LimitHTTPTrigger","AZR-000130"]},{"location":"en/rules/Azure.LogicApp.LimitHTTPTrigger/#description","title":"Description","text":"<p>When a Logic App uses a HTTP request trigger by default any source IP address can trigger the workflow. Logic Apps can be configured to limit the IP addresses that are accepted to trigger the workflow.</p>","tags":["Azure.LogicApp.LimitHTTPTrigger","AZR-000130"]},{"location":"en/rules/Azure.LogicApp.LimitHTTPTrigger/#recommendation","title":"Recommendation","text":"<p>Consider limiting Logic Apps with HTTP request triggers to trusted IP addresses.</p>","tags":["Azure.LogicApp.LimitHTTPTrigger","AZR-000130"]},{"location":"en/rules/Azure.LogicApp.LimitHTTPTrigger/#links","title":"Links","text":"<ul> <li>Secure access and data in Azure Logic Apps</li> <li>Azure security baseline for Logic Apps</li> </ul>","tags":["Azure.LogicApp.LimitHTTPTrigger","AZR-000130"]},{"location":"en/rules/Azure.ML.ComputeIdleShutdown/","title":"Configure idle shutdown for compute instances","text":"Azure.ML.ComputeIdleShutdownAZR-000403Error <p> Cost Optimization  \u00b7  Machine Learning  \u00b7  Rule  \u00b7  2023_12  \u00b7  Critical</p> <p>Configure an idle shutdown timeout for Machine Learning compute instances.</p>","tags":["Azure.ML.ComputeIdleShutdown","AZR-000403"]},{"location":"en/rules/Azure.ML.ComputeIdleShutdown/#description","title":"Description","text":"<p>Machine Learning uses compute instances as a training or inference compute for development and testing. It's similar to a virtual machine on the cloud.</p> <p>To avoid getting charged for a compute instance that is switched on but not being actively used, you can configure when to automatically shutdown compute instances due to inactivity.</p>","tags":["Azure.ML.ComputeIdleShutdown","AZR-000403"]},{"location":"en/rules/Azure.ML.ComputeIdleShutdown/#recommendation","title":"Recommendation","text":"<p>Consider configuring ML - Compute Instances to automatically shutdown after a period of inactivity to optimize compute costs.</p>","tags":["Azure.ML.ComputeIdleShutdown","AZR-000403"]},{"location":"en/rules/Azure.ML.ComputeIdleShutdown/#examples","title":"Examples","text":"","tags":["Azure.ML.ComputeIdleShutdown","AZR-000403"]},{"location":"en/rules/Azure.ML.ComputeIdleShutdown/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy compute instances that passes this rule:</p> <ul> <li>Set the <code>properties.properties.idleTimeBeforeShutdown</code> property with a ISO 8601 formatted string.   i.e. For an idle shutdown time of 15 minutes use <code>PT15M</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.MachineLearningServices/workspaces/computes\",\n  \"apiVersion\": \"2023-06-01-preview\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), parameters('name'))]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"computeType\": \"ComputeInstance\",\n    \"disableLocalAuth\": true,\n    \"properties\": {\n      \"vmSize\": \"[parameters('vmSize')]\",\n      \"idleTimeBeforeShutdown\": \"PT15M\"\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.ML.ComputeIdleShutdown","AZR-000403"]},{"location":"en/rules/Azure.ML.ComputeIdleShutdown/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy compute instances that passes this rule:</p> <ul> <li>Set the <code>properties.properties.idleTimeBeforeShutdown</code> property with a ISO 8601 formatted string.   i.e. For an idle shutdown time of 15 minutes use <code>PT15M</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource compute_instance 'Microsoft.MachineLearningServices/workspaces/computes@2023-06-01-preview' = {\n  parent: workspace\n  name: name\n  location: location\n  properties: {\n    computeType: 'ComputeInstance'\n    disableLocalAuth: true\n    properties: {\n      vmSize: vmSize\n      idleTimeBeforeShutdown: 'PT15M'\n    }\n  }\n}\n</code></pre>","tags":["Azure.ML.ComputeIdleShutdown","AZR-000403"]},{"location":"en/rules/Azure.ML.ComputeIdleShutdown/#links","title":"Links","text":"<ul> <li>CO:06 Usage and billing increments</li> <li>AI + Machine Learning cost estimates</li> <li>Configure idle shutdown</li> <li>ML Compute</li> <li>Azure deployment reference - Compute objects</li> <li>Azure deployment reference - Workspaces</li> </ul>","tags":["Azure.ML.ComputeIdleShutdown","AZR-000403"]},{"location":"en/rules/Azure.ML.ComputeVnet/","title":"Host ML Compute in VNet","text":"Azure.ML.ComputeVnetAZR-000405Error <p> Security  \u00b7  Machine Learning  \u00b7  Rule  \u00b7  2023_12  \u00b7  Critical</p> <p>Azure Machine Learning Computes should be hosted in a virtual network (VNet).</p>","tags":["Azure.ML.ComputeVnet","AZR-000405"]},{"location":"en/rules/Azure.ML.ComputeVnet/#description","title":"Description","text":"<p>When using Azure Machine Learning (ML), you can configure compute instances to be private or accessible from the public Internet. By default, the ML compute is configured to be accessible from the public Internet.</p> <p>ML compute can be deployed into an virtual network (VNet) to provide private connectivity, enhanaced security, and isolation. Using a VNet reduces the attack surface for your solution, and the chances of data exfiltration. Additionally, network controls such as Network Security Groups (NSGs) can be used to further restrict access.</p>","tags":["Azure.ML.ComputeVnet","AZR-000405"]},{"location":"en/rules/Azure.ML.ComputeVnet/#recommendation","title":"Recommendation","text":"<p>Consider using ML - compute hosted in a VNet to provide private connectivity, enhanaced security, and isolation.</p>","tags":["Azure.ML.ComputeVnet","AZR-000405"]},{"location":"en/rules/Azure.ML.ComputeVnet/#examples","title":"Examples","text":"","tags":["Azure.ML.ComputeVnet","AZR-000405"]},{"location":"en/rules/Azure.ML.ComputeVnet/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy an ML - compute that passes this rule:</p> <ul> <li>Set the <code>properties.properties.subnet.id</code> property with a resource Id of a specific VNET subnet.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.MachineLearningServices/workspaces/computes\",\n  \"apiVersion\": \"2023-06-01-preview\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), parameters('name'))]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"computeType\": \"ComputeInstance\",\n    \"disableLocalAuth\": true,\n    \"properties\": {\n      \"vmSize\": \"[parameters('vmSize')]\",\n      \"idleTimeBeforeShutdown\": \"PT15M\",\n      \"subnet\": {\n        \"id\": \"[resourceId('Microsoft.Network/virtualNetworks/subnets', split('vnet/subnet', '/')[0], split('vnet/subnet', '/')[1])]\"\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.ML.ComputeVnet","AZR-000405"]},{"location":"en/rules/Azure.ML.ComputeVnet/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy an ML - compute that passes this rule:</p> <ul> <li>Set the <code>properties.properties.subnet.id</code> property with a resource Id of a specific VNET subnet.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource compute_instance 'Microsoft.MachineLearningServices/workspaces/computes@2023-06-01-preview' = {\n  parent: workspace\n  name: name\n  location: location\n  properties: {\n    computeType: 'ComputeInstance'\n    disableLocalAuth: true\n    properties: {\n      vmSize: vmSize\n      idleTimeBeforeShutdown: 'PT15M'\n      subnet: {\n        id: subnet.id\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ML.ComputeVnet","AZR-000405"]},{"location":"en/rules/Azure.ML.ComputeVnet/#links","title":"Links","text":"<ul> <li>WAF - Azure services for securing network connectivity</li> <li>Managed compute in a managed virtual network</li> <li>ML - Network security and isolation</li> <li>ML Compute</li> <li>NS-1: Establish network segmentation boundaries</li> <li>Azure deployment reference - Compute objects</li> <li>Azure deployment reference - Workspaces</li> </ul>","tags":["Azure.ML.ComputeVnet","AZR-000405"]},{"location":"en/rules/Azure.ML.DisableLocalAuth/","title":"Disable local authentication on ML Compute","text":"Azure.ML.DisableLocalAuthAZR-000404Error <p> Security  \u00b7  Machine Learning  \u00b7  Rule  \u00b7  2023_12  \u00b7  Critical</p> <p>Azure Machine Learning compute resources should have local authentication methods disabled.</p>","tags":["Azure.ML.DisableLocalAuth","AZR-000404"]},{"location":"en/rules/Azure.ML.DisableLocalAuth/#description","title":"Description","text":"<p>Azure Machine Learning (ML) compute can have local authenication enabled or disabled. When enabled local authentication methods must be managed and audited separately.</p> <p>Disabling local authentication ensures that Entra ID (previously Azure Active Directory) is used exclusively for authentication. Using Entra ID, provides consistency as a single authoritative source which:</p> <ul> <li>Increases clarity and reduces security risks from human errors and configuration complexity.</li> <li>Provides support for advanced identity security and governance features.</li> </ul>","tags":["Azure.ML.DisableLocalAuth","AZR-000404"]},{"location":"en/rules/Azure.ML.DisableLocalAuth/#recommendation","title":"Recommendation","text":"<p>Consider disabling local authentication on ML - Compute as part of a broader security strategy.</p>","tags":["Azure.ML.DisableLocalAuth","AZR-000404"]},{"location":"en/rules/Azure.ML.DisableLocalAuth/#examples","title":"Examples","text":"","tags":["Azure.ML.DisableLocalAuth","AZR-000404"]},{"location":"en/rules/Azure.ML.DisableLocalAuth/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy ML - compute that passes this rule:</p> <ul> <li>Set the <code>properties.disableLocalAuth</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.MachineLearningServices/workspaces/computes\",\n  \"apiVersion\": \"2023-06-01-preview\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), parameters('name'))]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"computeType\": \"ComputeInstance\",\n    \"disableLocalAuth\": true,\n    \"properties\": {\n      \"vmSize\": \"[parameters('vmSize')]\",\n      \"idleTimeBeforeShutdown\": \"PT15M\"\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.ML.DisableLocalAuth","AZR-000404"]},{"location":"en/rules/Azure.ML.DisableLocalAuth/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy ML - compute that passes this rule:</p> <ul> <li>Set the <code>properties.disableLocalAuth</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource compute_instance 'Microsoft.MachineLearningServices/workspaces/computes@2023-06-01-preview' = {\n  parent: workspace\n  name: name\n  location: location\n  properties: {\n    computeType: 'ComputeInstance'\n    disableLocalAuth: true\n    properties: {\n      vmSize: vmSize\n      idleTimeBeforeShutdown: 'PT15M'\n      subnet: {\n        id: subnet.id\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ML.DisableLocalAuth","AZR-000404"]},{"location":"en/rules/Azure.ML.DisableLocalAuth/#links","title":"Links","text":"<ul> <li>WAF - Authentication with Azure AD</li> <li>Disable local authentication</li> <li>ML Compute</li> <li>Azure Policy Regulatory Compliance controls for Azure Machine Learning</li> <li>Azure deployment reference - Compute objects</li> <li>Azure deployment reference - Workspaces</li> </ul>","tags":["Azure.ML.DisableLocalAuth","AZR-000404"]},{"location":"en/rules/Azure.ML.PublicAccess/","title":"ML Workspace has public access disabled","text":"Azure.ML.PublicAccessAZR-000406Error <p> Security  \u00b7  Machine Learning  \u00b7  Rule  \u00b7  2023_12  \u00b7  Critical</p> <p>Disable public network access from a Azure Machine Learning workspace.</p>","tags":["Azure.ML.PublicAccess","AZR-000406"]},{"location":"en/rules/Azure.ML.PublicAccess/#description","title":"Description","text":"<p>Disabling public network access improves security by ensuring that the Machine Learning Workspaces aren't exposed on the public internet. You can control exposure of your workspaces by creating private endpoints instead. By default, a public endpoint is enabled for Machine Learning workspaces. The public endpoint is used for all access except for requests that use a Private Endpoint. Access through the public endpoint can be disabled or restricted to authorized virtual networks.</p> <p>Data exfiltration is an attack where an malicious actor does an unauthorized data transfer. Private Endpoints help control exposure of a workspace to data exfiltration by an internal or external malicious actor. They do this by providing clear separation between public and private endpoints. As a result, broad access to public endpoints which could be operated by a malicious actor are not required.</p>","tags":["Azure.ML.PublicAccess","AZR-000406"]},{"location":"en/rules/Azure.ML.PublicAccess/#recommendation","title":"Recommendation","text":"<p>Consider disabling access from public endpoints by setting the <code>publicNetworkAccess</code> property to <code>Disabled</code> as part of a broader security strategy.</p>","tags":["Azure.ML.PublicAccess","AZR-000406"]},{"location":"en/rules/Azure.ML.PublicAccess/#examples","title":"Examples","text":"","tags":["Azure.ML.PublicAccess","AZR-000406"]},{"location":"en/rules/Azure.ML.PublicAccess/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy an ML - Workspace that passes this rule:</p> <ul> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code>.</li> <li>If the <code>properties.allowPublicAccessWhenBehindVnet</code> property is defined remove the property.   Switch to using the <code>properties.publicNetworkAccess</code> property instead.   Configuring both properties is not required.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.MachineLearningServices/workspaces\",\n  \"apiVersion\": \"2023-04-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"basic\",\n    \"tier\": \"basic\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"friendlyName\": \"[parameters('name')]\",\n    \"keyVault\": \"[resourceId('Microsoft.KeyVault/vaults', parameters('KeyVaultName'))]\",\n    \"storageAccount\": \"[resourceId('Microsoft.Storage/storageAccounts', parameters('StorageAccountName'))]\",\n    \"applicationInsights\": \"[resourceId('Microsoft.Insights/components', parameters('AppInsightsName'))]\",\n    \"containerRegistry\": \"[resourceId('Microsoft.ContainerRegistry/registries', parameters('ContainerRegistryName'))]\",\n    \"publicNetworkAccess\": \"Disabled\"\n  }\n}\n</code></pre>","tags":["Azure.ML.PublicAccess","AZR-000406"]},{"location":"en/rules/Azure.ML.PublicAccess/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy an ML - Workspace that passes this rule:</p> <ul> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code>.</li> <li>If the <code>properties.allowPublicAccessWhenBehindVnet</code> property is defined remove the property.   Switch to using the <code>properties.publicNetworkAccess</code> property instead.   Configuring both properties is not required.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource workspace 'Microsoft.MachineLearningServices/workspaces@2023-04-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'basic'\n    tier: 'basic'\n  }\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    friendlyName: friendlyName\n    keyVault: keyVault.id\n    storageAccount: storageAccount.id\n    applicationInsights: appInsights.id\n    containerRegistry: containerRegistry.id\n    publicNetworkAccess: 'Disabled'\n    primaryUserAssignedIdentity: identity.id\n  }\n}\n</code></pre>","tags":["Azure.ML.PublicAccess","AZR-000406"]},{"location":"en/rules/Azure.ML.PublicAccess/#links","title":"Links","text":"<ul> <li>WAF - Azure services for securing network connectivity</li> <li>Configure a private endpoint for an Azure Machine Learning workspace</li> <li>ML - Public access to Workspaces</li> <li>NS-2: Secure cloud services with network controls</li> <li>Security and governance for ML</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ML.PublicAccess","AZR-000406"]},{"location":"en/rules/Azure.ML.UserManagedIdentity/","title":"Azure Machine Learning workspaces should use user-assigned managed identity","text":"Azure.ML.UserManagedIdentityAZR-000407Error <p> Security  \u00b7  Machine Learning  \u00b7  Rule  \u00b7  2023_12  \u00b7  Important</p> <p>ML workspaces should use user-assigned managed identity, rather than the default system-assigned managed identity.</p>","tags":["Azure.ML.UserManagedIdentity","AZR-000407"]},{"location":"en/rules/Azure.ML.UserManagedIdentity/#description","title":"Description","text":"<p>Manange access to Azure ML workspace and associated resources, Azure Container Registry, KeyVault, Storage, and App Insights using user-assigned managed identity. By default, system-assigned managed identity is used by Azure ML workspace to access the associated resources. User-assigned managed identity allows you to create the identity as an Azure resource and maintain the life cycle of that identity.</p>","tags":["Azure.ML.UserManagedIdentity","AZR-000407"]},{"location":"en/rules/Azure.ML.UserManagedIdentity/#recommendation","title":"Recommendation","text":"<p>Consider using a User-Assigned Managed Identity, as part of a broader security and lifecycle management strategy.</p>","tags":["Azure.ML.UserManagedIdentity","AZR-000407"]},{"location":"en/rules/Azure.ML.UserManagedIdentity/#examples","title":"Examples","text":"","tags":["Azure.ML.UserManagedIdentity","AZR-000407"]},{"location":"en/rules/Azure.ML.UserManagedIdentity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy an ML - Workspace that passes this rule:</p> <ul> <li>Set the <code>identity.type</code> property to <code>UserAssigned</code>.</li> <li>Reference the identity with <code>identity.userAssignedIdentities</code>.</li> <li>Set the <code>properties.primaryUserAssignedIdentity</code> property value to the User-Assigned Managed Identity.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.MachineLearningServices/workspaces\",\n  \"apiVersion\": \"2023-04-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"basic\",\n    \"tier\": \"basic\"\n  },\n  \"identity\": {\n    \"type\": \"UserAssigned\",\n    \"userAssignedIdentities\": {\n      \"[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', 'example'))]\": {}\n    }\n  },\n  \"properties\": {\n    \"friendlyName\": \"[parameters('friendlyName')]\",\n    \"keyVault\": \"[resourceId('Microsoft.KeyVault/vaults', 'example')]\",\n    \"storageAccount\": \"[resourceId('Microsoft.Storage/storageAccounts', 'example')]\",\n    \"applicationInsights\": \"[resourceId('Microsoft.Insights/components', 'example')]\",\n    \"containerRegistry\": \"[resourceId('Microsoft.ContainerRegistry/registries', 'example')]\",\n    \"publicNetworkAccess\": \"Disabled\",\n    \"primaryUserAssignedIdentity\": \"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', 'example')]\"\n  }\n}\n</code></pre>","tags":["Azure.ML.UserManagedIdentity","AZR-000407"]},{"location":"en/rules/Azure.ML.UserManagedIdentity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy an ML - Workspace that passes this rule:</p> <ul> <li>Set the <code>identity.type</code> property to <code>UserAssigned</code>.</li> <li>Reference the identity with <code>identity.userAssignedIdentities</code>.</li> <li>Set the <code>properties.primaryUserAssignedIdentity</code> property value to the User-Assigned Managed Identity.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource workspace 'Microsoft.MachineLearningServices/workspaces@2023-04-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'basic'\n    tier: 'basic'\n  }\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${identity.id}': {}\n    }\n  }\n  properties: {\n    friendlyName: friendlyName\n    keyVault: keyVault.id\n    storageAccount: storageAccount.id\n    applicationInsights: appInsights.id\n    containerRegistry: containerRegistry.id\n    publicNetworkAccess: 'Disabled'\n    primaryUserAssignedIdentity: identity.id\n  }\n}\n</code></pre>","tags":["Azure.ML.UserManagedIdentity","AZR-000407"]},{"location":"en/rules/Azure.ML.UserManagedIdentity/#links","title":"Links","text":"<ul> <li>WAF - Authentication with Azure AD</li> <li>Set up authentication between Azure Machine Learning and other services</li> <li>IM-3: Manage application identities securely and automatically</li> <li>Azure Policy Regulatory Compliance controls for Azure Machine Learning</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ML.UserManagedIdentity","AZR-000407"]},{"location":"en/rules/Azure.MariaDB.AllowAzureAccess/","title":"Disable MariaDB Allow access to Azure services firewall rule","text":"Azure.MariaDB.AllowAzureAccessAZR-000342Error <p> Security  \u00b7  Azure Database for MariaDB  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Determine if access from Azure services is required.</p>","tags":["Azure.MariaDB.AllowAzureAccess","AZR-000342"]},{"location":"en/rules/Azure.MariaDB.AllowAzureAccess/#description","title":"Description","text":"<p>Allow access to Azure services, permits any Azure service including other Azure customers, network based-access to databases on the same Azure Database for MariaDB server instance. If network based access is permitted, authentication is still required.</p> <p>Enabling access from Azure services is useful in certain cases where fixed outgoing IP addresses isn't available for the services.</p>","tags":["Azure.MariaDB.AllowAzureAccess","AZR-000342"]},{"location":"en/rules/Azure.MariaDB.AllowAzureAccess/#recommendation","title":"Recommendation","text":"<p>Where fixed outgoing IP addresses are available for the Azure services, configure IP or virtual network based firewall rules instead of using Allow access to Azure services.</p> <p>Determine if access from Azure services is required for the services connecting to the hosted databases.</p>","tags":["Azure.MariaDB.AllowAzureAccess","AZR-000342"]},{"location":"en/rules/Azure.MariaDB.AllowAzureAccess/#examples","title":"Examples","text":"","tags":["Azure.MariaDB.AllowAzureAccess","AZR-000342"]},{"location":"en/rules/Azure.MariaDB.AllowAzureAccess/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Database for MariaDB Servers that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.DBforMariaDB servers/firewallRules</code> sub-resource (child resource).</li> <li>Set the <code>properties.startIpAddress</code> and <code>properties.endIpAddress</code> property to a valid IPv4 address format.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforMariaDB/servers\",\n  \"apiVersion\": \"2018-06-01\",\n  \"name\": \"[parameters('serverName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"[parameters('skuName')]\",\n    \"tier\": \"[parameters('skuTier')]\",\n    \"capacity\": \"[parameters('skuCapacity')]\",\n    \"size\": \"[format('{0}', parameters('skuSizeMB'))]\",\n    \"family\": \"[parameters('skuFamily')]\"\n  },\n  \"properties\": {\n    \"createMode\": \"Default\",\n    \"version\": \"[parameters('mariadbVersion')]\",\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"storageProfile\": {\n      \"storageMB\": \"[parameters('skuSizeMB')]\",\n      \"backupRetentionDays\": \"[parameters('backupRetentionDays')]\",\n      \"geoRedundantBackup\": \"[parameters('geoRedundantBackup')]\"\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.DBforMariaDB/servers/firewallRules\",\n      \"apiVersion\": \"2018-06-01\",\n      \"name\": \"MariaDbServer001/FunctionApp\",\n      \"properties\": {\n        \"startIpAddress\": \"20.67.176.40\",\n        \"endIpAddress\": \"20.67.176.40\"\n      },\n      \"dependsOn\": [\n        \"[resourceId('Microsoft.DBforMariaDB/servers', parameters('serverName'))]\"\n      ]\n    }\n  ]\n}\n</code></pre>","tags":["Azure.MariaDB.AllowAzureAccess","AZR-000342"]},{"location":"en/rules/Azure.MariaDB.AllowAzureAccess/#configure-with-bicep","title":"Configure with Bicep","text":"<ul> <li>Deploy a <code>Microsoft.DBforMariaDB servers/firewallRules</code> sub-resource (child resource).</li> <li>Set the <code>properties.startIpAddress</code> and <code>properties.endIpAddress</code> property to a valid IPv4 address format.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource mariaDbServer 'Microsoft.DBforMariaDB/servers@2018-06-01' = {\n  name: serverName\n  location: location\n  sku: {\n    name: skuName\n    tier: skuTier\n    capacity: skuCapacity\n    size: '${skuSizeMB}' \n    family: skuFamily\n  }\n  properties: {\n    createMode: 'Default'\n    version: mariadbVersion\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    storageProfile: {\n      storageMB: skuSizeMB\n      backupRetentionDays: backupRetentionDays\n      geoRedundantBackup: geoRedundantBackup\n    }\n  }\n}\n\nresource mariaDbServerFirewallRule 'Microsoft.DBforMariaDB/servers/firewallRules@2018-06-01' = {\n  name: 'MariaDbServer001/FunctionApp'\n  parent: mariaDbServer\n  properties: {\n    startIpAddress: '20.67.176.40'\n    endIpAddress: '20.67.176.40'\n  }\n}\n</code></pre>","tags":["Azure.MariaDB.AllowAzureAccess","AZR-000342"]},{"location":"en/rules/Azure.MariaDB.AllowAzureAccess/#links","title":"Links","text":"<ul> <li>Network security and containment</li> <li>Azure Database for MariaDB firewall rules</li> <li>Template reference</li> </ul>","tags":["Azure.MariaDB.AllowAzureAccess","AZR-000342"]},{"location":"en/rules/Azure.MariaDB.DatabaseName/","title":"Use valid database names","text":"Azure.MariaDB.DatabaseNameAZR-000337Error <p> Operational Excellence  \u00b7  Azure Database for MariaDB  \u00b7  Rule  \u00b7  2022_12  \u00b7  Awareness</p> <p>Azure Database for MariaDB databases should meet naming requirements.</p>","tags":["Azure.MariaDB.DatabaseName","AZR-000337"]},{"location":"en/rules/Azure.MariaDB.DatabaseName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Azure Database for MariaDB database names are:</p> <ul> <li>Between 1 and 63 characters long.</li> <li>Alphanumerics and hyphens.</li> </ul>","tags":["Azure.MariaDB.DatabaseName","AZR-000337"]},{"location":"en/rules/Azure.MariaDB.DatabaseName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Azure Database for MariaDB database naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.MariaDB.DatabaseName","AZR-000337"]},{"location":"en/rules/Azure.MariaDB.DatabaseName/#notes","title":"Notes","text":"<p>This rule does not check if Azure Database for MariaDB database names are unique.</p>","tags":["Azure.MariaDB.DatabaseName","AZR-000337"]},{"location":"en/rules/Azure.MariaDB.DatabaseName/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions Azure Database for MariaDB resources</li> <li>Define your naming convention</li> <li>Resource naming and tagging decision guide</li> <li>Abbreviation examples for Azure resources</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.MariaDB.DatabaseName","AZR-000337"]},{"location":"en/rules/Azure.MariaDB.DefenderCloud/","title":"Use Microsoft Defender","text":"Azure.MariaDB.DefenderCloudAZR-000330Error <p> Security  \u00b7  Azure Database for MariaDB  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Enable Microsoft Defender for Cloud for Azure Database for MariaDB.</p>","tags":["Azure.MariaDB.DefenderCloud","AZR-000330"]},{"location":"en/rules/Azure.MariaDB.DefenderCloud/#description","title":"Description","text":"<p>Defender for Cloud detects anomalous activities indicating unusual and potentially harmful attempts to access or exploit databases.</p>","tags":["Azure.MariaDB.DefenderCloud","AZR-000330"]},{"location":"en/rules/Azure.MariaDB.DefenderCloud/#recommendation","title":"Recommendation","text":"<p>Enable Microsoft Defender for Cloud for Azure Database for MariaDB.</p>","tags":["Azure.MariaDB.DefenderCloud","AZR-000330"]},{"location":"en/rules/Azure.MariaDB.DefenderCloud/#examples","title":"Examples","text":"","tags":["Azure.MariaDB.DefenderCloud","AZR-000330"]},{"location":"en/rules/Azure.MariaDB.DefenderCloud/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Database for MariaDB Servers that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.DBforMariaDB/servers/securityAlertPolicies</code> sub-resource (child resource).</li> <li>Set the <code>properties.state</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforMariaDB/servers\",\n  \"apiVersion\": \"2018-06-01\",\n  \"name\": \"[parameters('serverName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"[parameters('skuName')]\",\n    \"tier\": \"GeneralPurpose\",\n    \"capacity\": \"[parameters('SkuCapacity')]\",\n    \"size\": \"[format('{0}', parameters('skuSizeMB'))]\",\n    \"family\": \"[parameters('skuFamily')]\"\n  },\n  \"properties\": {\n    \"createMode\": \"Default\",\n    \"version\": \"[parameters('mariadbVersion')]\",\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"storageProfile\": {\n      \"storageMB\": \"[parameters('skuSizeMB')]\",\n      \"backupRetentionDays\": 7,\n      \"geoRedundantBackup\": \"Enabled\"\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.DBforMariaDB/servers/securityAlertPolicies\",\n      \"apiVersion\": \"2018-06-01\",\n      \"name\": \"Default\",\n      \"dependsOn\": [\"[parameters('serverName')]\"],\n      \"properties\": {\n        \"emailAccountAdmins\": true,\n        \"emailAddresses\": [\"soc@contoso.com\"],\n        \"retentionDays\": 14,\n        \"state\": \"Enabled\",\n        \"storageAccountAccessKey\": \"account-key\",\n        \"storageEndpoint\": \"https://contoso.blob.core.windows.net\"\n      }\n    }\n  ]\n}\n</code></pre>","tags":["Azure.MariaDB.DefenderCloud","AZR-000330"]},{"location":"en/rules/Azure.MariaDB.DefenderCloud/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Database for MariaDB Servers that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.DBforMariaDB/servers/securityAlertPolicies</code> sub-resource (child resource).</li> <li>Set the <code>properties.state</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource mariaDbServer 'Microsoft.DBforMariaDB/servers@2018-06-01' = {\n  name: serverName\n  location: location\n  sku: {\n    name: skuName\n    tier: 'GeneralPurpose'\n    capacity: skuCapacity\n    size: '${skuSizeMB}' \n    family: skuFamily\n  }\n  properties: {\n    createMode: 'Default'\n    version: mariadbVersion\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    storageProfile: {\n      storageMB: skuSizeMB\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Enabled'\n    }\n  }\n}\n\nresource mariaDbDefender 'Microsoft.DBforMariaDB/servers/securityAlertPolicies@2018-06-01' = {\n  name: 'Default'\n  parent: MariaDbServer\n  properties: {\n    emailAccountAdmins: true\n    emailAddresses: ['soc@contoso.com']\n    retentionDays: 14\n    state: 'Enabled'\n    storageAccountAccessKey: 'account-key'\n    storageEndpoint: 'https://contoso.blob.core.windows.net'\n  }\n}\n</code></pre>","tags":["Azure.MariaDB.DefenderCloud","AZR-000330"]},{"location":"en/rules/Azure.MariaDB.DefenderCloud/#links","title":"Links","text":"<ul> <li>Security operations</li> <li>Enable Microsoft Defender for open-source relational databases</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.MariaDB.DefenderCloud","AZR-000330"]},{"location":"en/rules/Azure.MariaDB.FirewallIPRange/","title":"Review Azure MariaDB server firewall permitted public IP addresses","text":"Azure.MariaDB.FirewallIPRangeAZR-000344Error <p> Security  \u00b7  Azure Database for MariaDB  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Determine if there is an excessive number of permitted IP addresses.</p>","tags":["Azure.MariaDB.FirewallIPRange","AZR-000344"]},{"location":"en/rules/Azure.MariaDB.FirewallIPRange/#description","title":"Description","text":"<p>Typically the number of IP address rules permitted through the firewall is minimal, with management connectivity from on-premises and cloud application connectivity.</p> <p>Server-level firewall permitted IP addresses apply to all databases on the Azure Database for MariaDB server.</p>","tags":["Azure.MariaDB.FirewallIPRange","AZR-000344"]},{"location":"en/rules/Azure.MariaDB.FirewallIPRange/#recommendation","title":"Recommendation","text":"<p>Review the number of Azure for MariaDB server firewall permitted public IP addresses configured. Consider to removing IP addresses that are no longer needed.</p>","tags":["Azure.MariaDB.FirewallIPRange","AZR-000344"]},{"location":"en/rules/Azure.MariaDB.FirewallIPRange/#notes","title":"Notes","text":"<p>This rule fails when the number of configured public IP addresses exceeds ten (10).</p>","tags":["Azure.MariaDB.FirewallIPRange","AZR-000344"]},{"location":"en/rules/Azure.MariaDB.FirewallIPRange/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Azure Database for MariaDB server firewall rules</li> <li>Create and manage Azure Database for MariaDB firewall rules by using the Azure portal</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.MariaDB.FirewallIPRange","AZR-000344"]},{"location":"en/rules/Azure.MariaDB.FirewallRuleCount/","title":"Review Azure MariaDB server firewall rules","text":"Azure.MariaDB.FirewallRuleCountAZR-000343Error <p> Security  \u00b7  Azure Database for MariaDB  \u00b7  Rule  \u00b7  2022_12  \u00b7  Awareness</p> <p>Determine if there is an excessive number of firewall rules.</p>","tags":["Azure.MariaDB.FirewallRuleCount","AZR-000343"]},{"location":"en/rules/Azure.MariaDB.FirewallRuleCount/#description","title":"Description","text":"<p>Typically the number of firewall rules required is minimal, with management connectivity from on-premises and cloud application connectivity.</p> <p>Server-level firewall rules apply to all databases on the Azure Database for MariaDB server.</p>","tags":["Azure.MariaDB.FirewallRuleCount","AZR-000343"]},{"location":"en/rules/Azure.MariaDB.FirewallRuleCount/#recommendation","title":"Recommendation","text":"<p>Review the number of Azure for MariaDB server firewall rules configured. Consider to removing rules that are no longer needed.</p>","tags":["Azure.MariaDB.FirewallRuleCount","AZR-000343"]},{"location":"en/rules/Azure.MariaDB.FirewallRuleCount/#notes","title":"Notes","text":"<p>This rule fails when the number of configured firewall rules exceeds ten (10).</p>","tags":["Azure.MariaDB.FirewallRuleCount","AZR-000343"]},{"location":"en/rules/Azure.MariaDB.FirewallRuleCount/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Azure Database for MariaDB server firewall rules</li> <li>Create and manage Azure Database for MariaDB firewall rules by using the Azure portal</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.MariaDB.FirewallRuleCount","AZR-000343"]},{"location":"en/rules/Azure.MariaDB.FirewallRuleName/","title":"Use valid firewall rule names","text":"Azure.MariaDB.FirewallRuleNameAZR-000338Error <p> Operational Excellence  \u00b7  Azure Database for MariaDB  \u00b7  Rule  \u00b7  2022_12  \u00b7  Awareness</p> <p>Azure Database for MariaDB firewall rules should meet naming requirements.</p>","tags":["Azure.MariaDB.FirewallRuleName","AZR-000338"]},{"location":"en/rules/Azure.MariaDB.FirewallRuleName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Azure Database for MariaDB firewall rule names are:</p> <ul> <li>Between 1 and 128 characters long.</li> <li>Alphanumerics, hyphens, and underscores.</li> </ul>","tags":["Azure.MariaDB.FirewallRuleName","AZR-000338"]},{"location":"en/rules/Azure.MariaDB.FirewallRuleName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Azure Database for MariaDB firewall rule naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.MariaDB.FirewallRuleName","AZR-000338"]},{"location":"en/rules/Azure.MariaDB.FirewallRuleName/#notes","title":"Notes","text":"<p>This rule does not check if Azure Database for MariaDB firewall rule names are unique.</p>","tags":["Azure.MariaDB.FirewallRuleName","AZR-000338"]},{"location":"en/rules/Azure.MariaDB.FirewallRuleName/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions Azure Database for MariaDB resources</li> <li>Template reference</li> </ul>","tags":["Azure.MariaDB.FirewallRuleName","AZR-000338"]},{"location":"en/rules/Azure.MariaDB.GeoRedundantBackup/","title":"Configure geo-redundant backup","text":"Azure.MariaDB.GeoRedundantBackupAZR-000329Error <p> Reliability  \u00b7  Azure Database for MariaDB  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Azure Database for MariaDB should store backups in a geo-redundant storage.</p>","tags":["Azure.MariaDB.GeoRedundantBackup","AZR-000329"]},{"location":"en/rules/Azure.MariaDB.GeoRedundantBackup/#description","title":"Description","text":"<p>Geo-redundant backup helps to protect your Azure Database for MariaDB Servers against outages impacting backup storage in the primary region and allows you to restore your server to the geo-paired region in the event of a disaster.</p> <p>When the backups are stored in geo-redundant backup storage, they are not only stored within the region in which your server is hosted, but are also replicated to a paired data center.</p> <p>Check out the <code>NOTES</code> and the <code>LINKS</code> section for more details about geo-redundant backup.</p>","tags":["Azure.MariaDB.GeoRedundantBackup","AZR-000329"]},{"location":"en/rules/Azure.MariaDB.GeoRedundantBackup/#recommendation","title":"Recommendation","text":"<p>Configure geo-redundant backup for Azure Database for MariaDB.</p>","tags":["Azure.MariaDB.GeoRedundantBackup","AZR-000329"]},{"location":"en/rules/Azure.MariaDB.GeoRedundantBackup/#examples","title":"Examples","text":"","tags":["Azure.MariaDB.GeoRedundantBackup","AZR-000329"]},{"location":"en/rules/Azure.MariaDB.GeoRedundantBackup/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Database for MariaDB Servers that pass this rule:</p> <ul> <li>Set the <code>properties.storageProfile.geoRedundantBackup</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforMariaDB/servers\",\n  \"apiVersion\": \"2018-06-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"[parameters('sku')]\",\n    \"tier\": \"GeneralPurpose\",\n    \"capacity\": \"[parameters('skuCapacity')]\",\n    \"size\": \"[format('{0}', parameters('skuSizeMB'))]\",\n    \"family\": \"Gen5\"\n  },\n  \"properties\": {\n    \"sslEnforcement\": \"Enabled\",\n    \"minimalTlsVersion\": \"TLS1_2\",\n    \"createMode\": \"Default\",\n    \"version\": \"10.3\",\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"publicNetworkAccess\": \"Disabled\",\n    \"storageProfile\": {\n      \"storageMB\": \"[parameters('skuSizeMB')]\",\n      \"backupRetentionDays\": 7,\n      \"geoRedundantBackup\": \"Enabled\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.MariaDB.GeoRedundantBackup","AZR-000329"]},{"location":"en/rules/Azure.MariaDB.GeoRedundantBackup/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Database for MariaDB Servers that pass this rule:</p> <ul> <li>Set the <code>properties.storageProfile.geoRedundantBackup</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource server 'Microsoft.DBforMariaDB/servers@2018-06-01' = {\n  name: name\n  location: location\n  sku: {\n    name: sku\n    tier: 'GeneralPurpose'\n    capacity: skuCapacity\n    size: '${skuSizeMB}'\n    family: 'Gen5'\n  }\n  properties: {\n    sslEnforcement: 'Enabled'\n    minimalTlsVersion: 'TLS1_2'\n    createMode: 'Default'\n    version: '10.3'\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    publicNetworkAccess: 'Disabled'\n    storageProfile: {\n      storageMB: skuSizeMB\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Enabled'\n    }\n  }\n}\n</code></pre>","tags":["Azure.MariaDB.GeoRedundantBackup","AZR-000329"]},{"location":"en/rules/Azure.MariaDB.GeoRedundantBackup/#notes","title":"Notes","text":"<p>This rule is only applicable for Azure Database for Maria DB Servers with <code>General Purpose</code> and <code>Memory Optimized</code> tiers. The <code>Basic</code> tier does not support geo-redundant backup storage.</p>","tags":["Azure.MariaDB.GeoRedundantBackup","AZR-000329"]},{"location":"en/rules/Azure.MariaDB.GeoRedundantBackup/#links","title":"Links","text":"<ul> <li>Target and non-functional requirements</li> <li>Backup and restore in Azure Database for MariaDB</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.MariaDB.GeoRedundantBackup","AZR-000329"]},{"location":"en/rules/Azure.MariaDB.MinTLS/","title":"Minimum TLS version","text":"Azure.MariaDB.MinTLSAZR-000335Error <p> Security  \u00b7  Azure Database for MariaDB  \u00b7  Rule  \u00b7  2022_12  \u00b7  Critical</p> <p>Azure Database for MariaDB servers should reject TLS versions older than 1.2.</p>","tags":["Azure.MariaDB.MinTLS","AZR-000335"]},{"location":"en/rules/Azure.MariaDB.MinTLS/#description","title":"Description","text":"<p>The minimum version of TLS that Azure Database for MariaDB servers accept is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS.</p> <p>Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted.</p>","tags":["Azure.MariaDB.MinTLS","AZR-000335"]},{"location":"en/rules/Azure.MariaDB.MinTLS/#recommendation","title":"Recommendation","text":"<p>Configure the minimum supported TLS version to be 1.2.</p>","tags":["Azure.MariaDB.MinTLS","AZR-000335"]},{"location":"en/rules/Azure.MariaDB.MinTLS/#examples","title":"Examples","text":"","tags":["Azure.MariaDB.MinTLS","AZR-000335"]},{"location":"en/rules/Azure.MariaDB.MinTLS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Database for MariaDB Servers that pass this rule:</p> <ul> <li>Set the <code>properties.minimalTlsVersion</code> property to <code>TLS1_2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforMariaDB/servers\",\n  \"apiVersion\": \"2018-06-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"[parameters('sku')]\",\n    \"tier\": \"GeneralPurpose\",\n    \"capacity\": \"[parameters('skuCapacity')]\",\n    \"size\": \"[format('{0}', parameters('skuSizeMB'))]\",\n    \"family\": \"Gen5\"\n  },\n  \"properties\": {\n    \"sslEnforcement\": \"Enabled\",\n    \"minimalTlsVersion\": \"TLS1_2\",\n    \"createMode\": \"Default\",\n    \"version\": \"10.3\",\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"publicNetworkAccess\": \"Disabled\",\n    \"storageProfile\": {\n      \"storageMB\": \"[parameters('skuSizeMB')]\",\n      \"backupRetentionDays\": 7,\n      \"geoRedundantBackup\": \"Enabled\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.MariaDB.MinTLS","AZR-000335"]},{"location":"en/rules/Azure.MariaDB.MinTLS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Database for MariaDB Servers that pass this rule:</p> <ul> <li>Set the <code>properties.minimalTlsVersion</code> property to <code>TLS1_2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource server 'Microsoft.DBforMariaDB/servers@2018-06-01' = {\n  name: name\n  location: location\n  sku: {\n    name: sku\n    tier: 'GeneralPurpose'\n    capacity: skuCapacity\n    size: '${skuSizeMB}'\n    family: 'Gen5'\n  }\n  properties: {\n    sslEnforcement: 'Enabled'\n    minimalTlsVersion: 'TLS1_2'\n    createMode: 'Default'\n    version: '10.3'\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    publicNetworkAccess: 'Disabled'\n    storageProfile: {\n      storageMB: skuSizeMB\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Enabled'\n    }\n  }\n}\n</code></pre>","tags":["Azure.MariaDB.MinTLS","AZR-000335"]},{"location":"en/rules/Azure.MariaDB.MinTLS/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>TLS enforcement in Azure Database for MariaDB</li> <li>Set TLS configurations for Azure Database for MariaDB</li> <li>TLS encryption in Azure</li> <li>Preparing for TLS 1.2 in Microsoft Azure</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.MariaDB.MinTLS","AZR-000335"]},{"location":"en/rules/Azure.MariaDB.ServerName/","title":"Use valid server names","text":"Azure.MariaDB.ServerNameAZR-000336Error <p> Operational Excellence  \u00b7  Azure Database for MariaDB  \u00b7  Rule  \u00b7  2022_12  \u00b7  Awareness</p> <p>Azure Database for MariaDB servers should meet naming requirements.</p>","tags":["Azure.MariaDB.ServerName","AZR-000336"]},{"location":"en/rules/Azure.MariaDB.ServerName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Azure Database for MariaDB server names are:</p> <ul> <li>Between 3 and 63 characters long.</li> <li>Lowercase letters, numbers, and hyphens.</li> <li>Can't start or end with a hyphen.</li> <li>MariaDB server names must be globally unique.</li> </ul>","tags":["Azure.MariaDB.ServerName","AZR-000336"]},{"location":"en/rules/Azure.MariaDB.ServerName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Azure Database for MariaDB server naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.MariaDB.ServerName","AZR-000336"]},{"location":"en/rules/Azure.MariaDB.ServerName/#examples","title":"Examples","text":"","tags":["Azure.MariaDB.ServerName","AZR-000336"]},{"location":"en/rules/Azure.MariaDB.ServerName/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy servers that pass this rule:</p> <ul> <li>Set the <code>name</code> property to align to resource naming requirements.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforMariaDB/servers\",\n  \"apiVersion\": \"2018-06-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"[parameters('sku')]\",\n    \"tier\": \"GeneralPurpose\",\n    \"capacity\": \"[parameters('skuCapacity')]\",\n    \"size\": \"[format('{0}', parameters('skuSizeMB'))]\",\n    \"family\": \"Gen5\"\n  },\n  \"properties\": {\n    \"sslEnforcement\": \"Enabled\",\n    \"minimalTlsVersion\": \"TLS1_2\",\n    \"createMode\": \"Default\",\n    \"version\": \"10.3\",\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"publicNetworkAccess\": \"Disabled\",\n    \"storageProfile\": {\n      \"storageMB\": \"[parameters('skuSizeMB')]\",\n      \"backupRetentionDays\": 7,\n      \"geoRedundantBackup\": \"Enabled\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.MariaDB.ServerName","AZR-000336"]},{"location":"en/rules/Azure.MariaDB.ServerName/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy servers that pass this rule:</p> <ul> <li>Set the <code>name</code> property to align to resource naming requirements.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource server 'Microsoft.DBforMariaDB/servers@2018-06-01' = {\n  name: name\n  location: location\n  sku: {\n    name: sku\n    tier: 'GeneralPurpose'\n    capacity: skuCapacity\n    size: '${skuSizeMB}'\n    family: 'Gen5'\n  }\n  properties: {\n    sslEnforcement: 'Enabled'\n    minimalTlsVersion: 'TLS1_2'\n    createMode: 'Default'\n    version: '10.3'\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    publicNetworkAccess: 'Disabled'\n    storageProfile: {\n      storageMB: skuSizeMB\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Enabled'\n    }\n  }\n}\n</code></pre>","tags":["Azure.MariaDB.ServerName","AZR-000336"]},{"location":"en/rules/Azure.MariaDB.ServerName/#notes","title":"Notes","text":"<p>This rule does not check if Azure Database for MariaDB server names are unique.</p>","tags":["Azure.MariaDB.ServerName","AZR-000336"]},{"location":"en/rules/Azure.MariaDB.ServerName/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions Azure Database for MariaDB resources</li> <li>Define your naming convention</li> <li>Resource naming and tagging decision guide</li> <li>Abbreviation examples for Azure resources</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.MariaDB.ServerName","AZR-000336"]},{"location":"en/rules/Azure.MariaDB.UseSSL/","title":"Encrypted connections","text":"Azure.MariaDB.UseSSLAZR-000334Error <p> Security  \u00b7  Azure Database for MariaDB  \u00b7  Rule  \u00b7  2022_12  \u00b7  Critical</p> <p>Azure Database for MariaDB servers should only accept encrypted connections.</p>","tags":["Azure.MariaDB.UseSSL","AZR-000334"]},{"location":"en/rules/Azure.MariaDB.UseSSL/#description","title":"Description","text":"<p>Azure Database for MariaDB is configured to only accept encrypted connections by default. When the setting enforce SSL connections is disabled, encrypted and unencrypted connections are permitted. This does not indicate that unencrypted connections are being used.</p> <p>Unencrypted communication to MariaDB server instances could allow disclosure of information to an untrusted party.</p>","tags":["Azure.MariaDB.UseSSL","AZR-000334"]},{"location":"en/rules/Azure.MariaDB.UseSSL/#recommendation","title":"Recommendation","text":"<p>Azure Database for MariaDB should be configured to only accept encrypted connections. Unless explicitly required, consider enabling enforce SSL connections.</p> <p>Also consider using Azure Policy to audit or enforce this configuration.</p>","tags":["Azure.MariaDB.UseSSL","AZR-000334"]},{"location":"en/rules/Azure.MariaDB.UseSSL/#examples","title":"Examples","text":"","tags":["Azure.MariaDB.UseSSL","AZR-000334"]},{"location":"en/rules/Azure.MariaDB.UseSSL/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Database for MariaDB Servers that pass this rule:</p> <ul> <li>Set the <code>properties.sslEnforcement</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforMariaDB/servers\",\n  \"apiVersion\": \"2018-06-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"[parameters('sku')]\",\n    \"tier\": \"GeneralPurpose\",\n    \"capacity\": \"[parameters('skuCapacity')]\",\n    \"size\": \"[format('{0}', parameters('skuSizeMB'))]\",\n    \"family\": \"Gen5\"\n  },\n  \"properties\": {\n    \"sslEnforcement\": \"Enabled\",\n    \"minimalTlsVersion\": \"TLS1_2\",\n    \"createMode\": \"Default\",\n    \"version\": \"10.3\",\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"publicNetworkAccess\": \"Disabled\",\n    \"storageProfile\": {\n      \"storageMB\": \"[parameters('skuSizeMB')]\",\n      \"backupRetentionDays\": 7,\n      \"geoRedundantBackup\": \"Enabled\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.MariaDB.UseSSL","AZR-000334"]},{"location":"en/rules/Azure.MariaDB.UseSSL/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Database for MariaDB Servers that pass this rule:</p> <ul> <li>Set the <code>properties.sslEnforcement</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource server 'Microsoft.DBforMariaDB/servers@2018-06-01' = {\n  name: name\n  location: location\n  sku: {\n    name: sku\n    tier: 'GeneralPurpose'\n    capacity: skuCapacity\n    size: '${skuSizeMB}'\n    family: 'Gen5'\n  }\n  properties: {\n    sslEnforcement: 'Enabled'\n    minimalTlsVersion: 'TLS1_2'\n    createMode: 'Default'\n    version: '10.3'\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    publicNetworkAccess: 'Disabled'\n    storageProfile: {\n      storageMB: skuSizeMB\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Enabled'\n    }\n  }\n}\n</code></pre>","tags":["Azure.MariaDB.UseSSL","AZR-000334"]},{"location":"en/rules/Azure.MariaDB.UseSSL/#links","title":"Links","text":"<ul> <li>Data encryption in Azure</li> <li>SSL connectivity in Azure Database for MariaDB</li> <li>Template reference</li> </ul>","tags":["Azure.MariaDB.UseSSL","AZR-000334"]},{"location":"en/rules/Azure.MariaDB.VNETRuleName/","title":"Use valid VNET rule names","text":"Azure.MariaDB.VNETRuleNameAZR-000339Error <p> Operational Excellence  \u00b7  Azure Database for MariaDB  \u00b7  Rule  \u00b7  2022_12  \u00b7  Awareness</p> <p>Azure Database for MariaDB VNET rules should meet naming requirements.</p>","tags":["Azure.MariaDB.VNETRuleName","AZR-000339"]},{"location":"en/rules/Azure.MariaDB.VNETRuleName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Azure Database for MariaDB VNET rule names are:</p> <ul> <li>Between 1 and 128 characters long.</li> <li>Alphanumerics and hyphens.</li> </ul>","tags":["Azure.MariaDB.VNETRuleName","AZR-000339"]},{"location":"en/rules/Azure.MariaDB.VNETRuleName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Azure Database for MariaDB VNET rule naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.MariaDB.VNETRuleName","AZR-000339"]},{"location":"en/rules/Azure.MariaDB.VNETRuleName/#notes","title":"Notes","text":"<p>This rule does not check if Azure Database for MariaDB VNET rule names are unique.</p>","tags":["Azure.MariaDB.VNETRuleName","AZR-000339"]},{"location":"en/rules/Azure.MariaDB.VNETRuleName/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions Azure Database for MariaDB resources</li> <li>Define your naming convention</li> <li>Resource naming and tagging decision guide</li> <li>Abbreviation examples for Azure resources</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.MariaDB.VNETRuleName","AZR-000339"]},{"location":"en/rules/Azure.Monitor.ServiceHealth/","title":"Alert on service events","text":"Azure.Monitor.ServiceHealthAZR-000211Error <p> Reliability  \u00b7  Monitor  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Configure Service Health alerts to notify administrators.</p>","tags":["Azure.Monitor.ServiceHealth","AZR-000211"]},{"location":"en/rules/Azure.Monitor.ServiceHealth/#description","title":"Description","text":"<p>Azure provides events and can alert administrators when one of the following occurs in your subscriptions:</p> <ul> <li>Service issue</li> <li>Planned maintenance</li> <li>Health advisories</li> <li>Security advisory</li> </ul>","tags":["Azure.Monitor.ServiceHealth","AZR-000211"]},{"location":"en/rules/Azure.Monitor.ServiceHealth/#recommendation","title":"Recommendation","text":"<p>Consider configuring an alert to notify administrators when services you are using are potentially impacted.</p>","tags":["Azure.Monitor.ServiceHealth","AZR-000211"]},{"location":"en/rules/Azure.Monitor.ServiceHealth/#links","title":"Links","text":"<ul> <li>RE:10 Monitoring and alerting</li> <li>Service Health overview</li> <li>Create activity log alerts on service notifications</li> </ul>","tags":["Azure.Monitor.ServiceHealth","AZR-000211"]},{"location":"en/rules/Azure.MySQL.AAD/","title":"Use Entra ID authentication with MySQL databases","text":"Azure.MySQL.AADAZR-000392Error <p> Security  \u00b7  Azure Database for MySQL  \u00b7  Rule  \u00b7  2023_06  \u00b7  Critical</p> <p>Use Entra ID authentication with Azure Database for MySQL databases.</p>","tags":["Azure.MySQL.AAD","AZR-000392"]},{"location":"en/rules/Azure.MySQL.AAD/#description","title":"Description","text":"<p>Azure Database for MySQL offer two authentication models, Entra ID (previously Azure AD) and MySQL logins. AAD authentication supports centralized identity management in addition to modern password protections. Some of the benefits of Entra ID authentication over MySQL authentication including:</p> <ul> <li>Support for Azure Multi-Factor Authentication (MFA).</li> <li>Conditional-based access with Conditional Access.</li> </ul> <p>It is also possible to disable MySQL authentication entirely for the flexible server deployment model.</p>","tags":["Azure.MySQL.AAD","AZR-000392"]},{"location":"en/rules/Azure.MySQL.AAD/#recommendation","title":"Recommendation","text":"<p>Consider using Entra ID authentication with Azure Database for MySQL databases. Additionally, consider disabling MySQL authentication.</p>","tags":["Azure.MySQL.AAD","AZR-000392"]},{"location":"en/rules/Azure.MySQL.AAD/#examples","title":"Examples","text":"","tags":["Azure.MySQL.AAD","AZR-000392"]},{"location":"en/rules/Azure.MySQL.AAD/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Database for MySQL flexible servers that pass this rule:</p> <ul> <li>Configure the <code>Microsoft.DBforMySQL/flexibleServers/administrators</code> sub-resource.</li> <li>Set the <code>properties.administratorType</code> to <code>ActiveDirectory</code>.</li> <li>Set the <code>properties.identityResourceId</code> to the resource ID of the user-assigned identity used for Entra ID authentication.</li> <li>Set the <code>properties.login</code> to the Entra ID administrator login object name.</li> <li>Set the <code>properties.sid</code> to the object ID GUID of the Entra ID administrator user, group, or application.</li> <li>Set the <code>properties.tenantId</code> to the tenant ID of the Entra ID administrator user, group, or application.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforMySQL/flexibleServers/administrators\",\n  \"apiVersion\": \"2022-12-01-preview\",\n  \"name\": \"[format('{0}/{1}', parameters('serverName'), 'activeDirectory')]\",\n  \"properties\": {\n    \"administratorType\": \"ActiveDirectory\",\n    \"identityResourceId\": \"[parameters('identityResourceId')]\",\n    \"login\": \"[parameters('login')]\",\n    \"sid\": \"[parameters('sid')]\",\n    \"tenantId\": \"[parameters('tenantId')]\"\n  },\n  \"dependsOn\": [\n    \"mySqlFlexibleServer\"\n  ]\n}\n</code></pre> <p>To deploy Azure Database for MySQL single servers that pass this rule:</p> <ul> <li>Configure the <code>Microsoft.DBforMySQL/servers/administrators</code> sub-resource.</li> <li>Set the <code>properties.administratorType</code> to <code>ActiveDirectory</code>.</li> <li>Set the <code>properties.login</code> to the Entra ID administrator login object name.</li> <li>Set the <code>properties.sid</code> to the object ID GUID of the Entra ID administrator user, group, or application.</li> <li>Set the <code>properties.tenantId</code> to the tenant ID of the Entra ID administrator user, group, or application.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforMySQL/servers/administrators\",\n  \"apiVersion\": \"2017-12-01\",\n  \"name\": \"[format('{0}/{1}', parameters('serverName'), 'activeDirectory')]\",\n  \"properties\": {\n    \"administratorType\": \"ActiveDirectory\",\n    \"login\": \"[parameters('login')]\",\n    \"sid\": \"[parameters('sid')]\",\n    \"tenantId\": \"[parameters('tenantId')]\"\n  },\n  \"dependsOn\": [\n    \"mySqlSingleServer\"\n  ]\n}\n</code></pre>","tags":["Azure.MySQL.AAD","AZR-000392"]},{"location":"en/rules/Azure.MySQL.AAD/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Database for MySQL flexible servers that pass this rule:</p> <ul> <li>Configure the <code>Microsoft.DBforMySQL/flexibleServers/administrators</code> sub-resource.</li> <li>Set the <code>properties.administratorType</code> to <code>ActiveDirectory</code>.</li> <li>Set the <code>properties.identityResourceId</code> to the resource ID of the user-assigned identity used for Entra ID authentication.</li> <li>Set the <code>properties.login</code> to the Entra ID administrator login object name.</li> <li>Set the <code>properties.sid</code> to the object ID GUID of the Entra ID administrator user, group, or application.</li> <li>Set the <code>properties.tenantId</code> to the tenant ID of the Entra ID administrator user, group, or application.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource aadAdmin 'Microsoft.DBforMySQL/flexibleServers/administrators@2021-12-01-preview' = {\n  name: 'activeDirectory'\n  parent: mySqlFlexibleServer\n  properties: {\n    administratorType: 'ActiveDirectory'\n    identityResourceId: identityResourceId\n    login: login\n    sid: sid\n    tenantId: tenantId\n  }\n}\n</code></pre> <p>To deploy Azure Database for MySQL single servers that pass this rule:</p> <ul> <li>Configure the <code>Microsoft.DBforMySQL/servers/administrators</code> sub-resource.</li> <li>Set the <code>properties.administratorType</code> to <code>ActiveDirectory</code>.</li> <li>Set the <code>properties.login</code> to the Entra ID administrator login object name.</li> <li>Set the <code>properties.sid</code> to the object ID GUID of the Entra ID administrator user, group, or application.</li> <li>Set the <code>properties.tenantId</code> to the tenant ID of the Entra ID administrator user, group, or application.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource aadAdmin 'Microsoft.DBforMySQL/servers/administrators@2017-12-01' = {\n  name: 'activeDirectory'\n  parent: mySqlSingleServer\n  properties: {\n    administratorType: 'ActiveDirectory'\n    login: login\n    sid: sid\n    tenantId: tenantId\n  }\n}\n</code></pre>","tags":["Azure.MySQL.AAD","AZR-000392"]},{"location":"en/rules/Azure.MySQL.AAD/#notes","title":"Notes","text":"<p>For the flexible server deployment model a user-assigned identity is required in order to use Entra ID authentication. The single server deployment model does not support enforcing Entra ID authentication only.</p>","tags":["Azure.MySQL.AAD","AZR-000392"]},{"location":"en/rules/Azure.MySQL.AAD/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>IM-1: Use centralized identity and authentication system</li> <li>Microsoft Entra authentication for Azure Database for MySQL - Flexible Server</li> <li>Use Microsoft Entra ID for authenticating with MySQL - Single Server</li> <li>Azure security baseline for Azure Database for MySQL - Flexible Server</li> <li>Azure deployment reference Flexible Server</li> <li>Azure deployment reference Single Server</li> </ul>","tags":["Azure.MySQL.AAD","AZR-000392"]},{"location":"en/rules/Azure.MySQL.AADOnly/","title":"Entra ID only authentication","text":"Azure.MySQL.AADOnlyAZR-000394Error <p> Security  \u00b7  Azure Database for MySQL  \u00b7  Rule  \u00b7  2023_09  \u00b7  Important</p> <p>Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases.</p>","tags":["Azure.MySQL.AADOnly","AZR-000394"]},{"location":"en/rules/Azure.MySQL.AADOnly/#description","title":"Description","text":"<p>Azure Database for MySQL supports authentication with MySQL logins and Entra ID (previously Azure AD) authentication.</p> <p>By default, authentication with MySQL logins is enabled. MySQL logins are unable to provide sufficient protection for identities. Entra ID authentication provides:</p> <ul> <li>Strong protection controls including conditional access.</li> <li>Identity governance.</li> <li>Privileged identity management.</li> </ul> <p>Once you decide to use Entra ID authentication, you can disable authentication with MySQL logins.</p> <p>Entra ID only authentication is only supported for the flexible server deployment model with MySQL 5.7 and newer.</p>","tags":["Azure.MySQL.AADOnly","AZR-000394"]},{"location":"en/rules/Azure.MySQL.AADOnly/#recommendation","title":"Recommendation","text":"<p>Consider using Entra ID only authentication. Also consider using Azure Policy for Entra ID only authentication with Azure Database for MySQL.</p>","tags":["Azure.MySQL.AADOnly","AZR-000394"]},{"location":"en/rules/Azure.MySQL.AADOnly/#examples","title":"Examples","text":"","tags":["Azure.MySQL.AADOnly","AZR-000394"]},{"location":"en/rules/Azure.MySQL.AADOnly/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Database for MySQL flexible servers that pass this rule:</p> <ul> <li>Configure the <code>Microsoft.DBforMySQL/flexibleServers/configurations</code> sub-resource.</li> <li>Set the <code>name</code> to <code>aad_auth_only</code>.</li> <li>Set the <code>properties.value</code> to <code>ON</code>.</li> <li>Set the <code>properties.source</code> to <code>user-override</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforMySQL/flexibleServers/configurations\",\n  \"apiVersion\": \"2022-01-01\",\n  \"name\": \"[format('{0}/{1}', parameters('serverName'), 'aad_auth_only')]\",\n  \"properties\": {\n    \"value\": \"ON\",\n    \"source\": \"user-override\"\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.DBforMySQL/flexibleServers', parameters('serverName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.MySQL.AADOnly","AZR-000394"]},{"location":"en/rules/Azure.MySQL.AADOnly/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Database for MySQL flexible servers that pass this rule:</p> <ul> <li>Configure the <code>Microsoft.DBforMySQL/flexibleServers/configurations</code> sub-resource.</li> <li>Set the <code>name</code> to <code>aad_auth_only</code>.</li> <li>Set the <code>properties.value</code> to <code>ON</code>.</li> <li>Set the <code>properties.source</code> to <code>user-override</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource aadOnly 'Microsoft.DBforMySQL/flexibleServers/configurations@2022-01-01' = {\n  name: 'aad_auth_only'\n  parent: mySqlFlexibleServer\n  properties: {\n    value: 'ON'\n    source: 'user-override'\n  }\n}\n</code></pre>","tags":["Azure.MySQL.AADOnly","AZR-000394"]},{"location":"en/rules/Azure.MySQL.AADOnly/#notes","title":"Notes","text":"<p>The Entra ID admin must be set before enabling Entra ID only authentication. Entra ID only authentication is only supported for the flexible server deployment model.</p>","tags":["Azure.MySQL.AADOnly","AZR-000394"]},{"location":"en/rules/Azure.MySQL.AADOnly/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>IM-1: Use centralized identity and authentication system</li> <li>Microsoft Entra authentication for Azure Database for MySQL - Flexible Server</li> <li>Azure security baseline for Azure Database for MySQL - Flexible Server</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.MySQL.AADOnly","AZR-000394"]},{"location":"en/rules/Azure.MySQL.AllowAzureAccess/","title":"Disable MySQL Allow Azure access firewall rule","text":"Azure.MySQL.AllowAzureAccessAZR-000134Error <p> Security  \u00b7  Azure Database for MySQL  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Determine if access from Azure services is required.</p>","tags":["Azure.MySQL.AllowAzureAccess","AZR-000134"]},{"location":"en/rules/Azure.MySQL.AllowAzureAccess/#description","title":"Description","text":"<p>Allow access to Azure services, permits any Azure service including other Azure customers, network based-access to databases on the same MySQL server instance. If network based access is permitted, authentication is still required.</p> <p>Enabling access from Azure Services is useful in certain cases for serverless PaaS workloads where configuring a stable IP address is not possible. For example Azure Functions, Container Instances and Logic Apps.</p>","tags":["Azure.MySQL.AllowAzureAccess","AZR-000134"]},{"location":"en/rules/Azure.MySQL.AllowAzureAccess/#recommendation","title":"Recommendation","text":"<p>Where a stable IP addresses are able to be configured, configure IP or virtual network based firewall rules instead of using Allow access to Azure services. Determine if access from Azure services is required for the services connecting to the hosted databases.</p>","tags":["Azure.MySQL.AllowAzureAccess","AZR-000134"]},{"location":"en/rules/Azure.MySQL.AllowAzureAccess/#notes","title":"Notes","text":"<p>This rule is only applicable for the Azure Database for MySQL Single Server deployment model.</p>","tags":["Azure.MySQL.AllowAzureAccess","AZR-000134"]},{"location":"en/rules/Azure.MySQL.AllowAzureAccess/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Azure Database for MySQL server firewall rules</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.MySQL.AllowAzureAccess","AZR-000134"]},{"location":"en/rules/Azure.MySQL.DefenderCloud/","title":"Use Microsoft Defender","text":"Azure.MySQL.DefenderCloudAZR-000328Error <p> Security  \u00b7  Azure Database for MySQL  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Enable Microsoft Defender for Cloud for Azure Database for MySQL.</p>","tags":["Azure.MySQL.DefenderCloud","AZR-000328"]},{"location":"en/rules/Azure.MySQL.DefenderCloud/#description","title":"Description","text":"<p>Defender for Cloud detects anomalous activities indicating unusual and potentially harmful attempts to access or exploit databases.</p>","tags":["Azure.MySQL.DefenderCloud","AZR-000328"]},{"location":"en/rules/Azure.MySQL.DefenderCloud/#recommendation","title":"Recommendation","text":"<p>Enable Microsoft Defender for Cloud for Azure Database for MySQL.</p>","tags":["Azure.MySQL.DefenderCloud","AZR-000328"]},{"location":"en/rules/Azure.MySQL.DefenderCloud/#examples","title":"Examples","text":"","tags":["Azure.MySQL.DefenderCloud","AZR-000328"]},{"location":"en/rules/Azure.MySQL.DefenderCloud/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Database for MySQL Single Servers that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.DBforMySQL/servers/securityAlertPolicies</code> sub-resource (child resource).</li> <li>Set the <code>properties.state</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforMySQL/servers\",\n  \"apiVersion\": \"2017-12-01\",\n  \"name\": \"[parameters('serverName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"[parameters('skuName')]\",\n    \"tier\": \"GeneralPurpose\",\n    \"capacity\": \"[parameters('skuCapacity')]\",\n    \"size\": \"[format('{0}', parameters('SkuSizeMB'))]\",\n    \"family\": \"[parameters('skuFamily')]\"\n  },\n  \"properties\": {\n    \"createMode\": \"Default\",\n    \"version\": \"[parameters('mysqlVersion')]\",\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"storageProfile\": {\n      \"storageMB\": \"[parameters('SkuSizeMB')]\",\n      \"backupRetentionDays\": 7,\n      \"geoRedundantBackup\": \"Enabled\"\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.DBforMySQL/servers/securityAlertPolicies\",\n      \"apiVersion\": \"2017-12-01\",\n      \"name\": \"Default\",\n      \"dependsOn\": [\"[parameters('serverName')]\"],\n      \"properties\": {\n        \"emailAccountAdmins\": true,\n        \"emailAddresses\": [\"soc@contoso.com\"],\n        \"retentionDays\": 14,\n        \"state\": \"Enabled\",\n        \"storageAccountAccessKey\": \"account-key\",\n        \"storageEndpoint\": \"https://contoso.blob.core.windows.net\"\n      }\n    }\n  ]\n}\n</code></pre>","tags":["Azure.MySQL.DefenderCloud","AZR-000328"]},{"location":"en/rules/Azure.MySQL.DefenderCloud/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Database for MySQL Single Servers that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.DBforMySQL/servers/securityAlertPolicies</code> sub-resource (child resource).</li> <li>Set the <code>properties.state</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource mysqlDbServer 'Microsoft.DBforMySQL/servers@2017-12-01' = {\n  name: serverName\n  location: location\n  sku: {\n    name: skuName\n    tier: 'GeneralPurpose'\n    capacity: skuCapacity\n    size: '${SkuSizeMB}'\n    family: skuFamily\n  }\n  properties: {\n    createMode: 'Default'\n    version: mysqlVersion\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    storageProfile: {\n      storageMB: SkuSizeMB\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Enabled'\n    }\n  }\n}\n\nresource mysqlDefender 'Microsoft.DBforMySQL/servers/securityAlertPolicies@2017-12-01' = {\n  name: 'Default'\n  parent: mysqlDbServer\n  properties: {\n    emailAccountAdmins: true\n    emailAddresses: ['soc@contoso.com']\n    retentionDays: 14\n    state: 'Enabled'\n    storageAccountAccessKey: 'account-key'\n    storageEndpoint: 'https://contoso.blob.core.windows.net'\n  }\n}\n</code></pre>","tags":["Azure.MySQL.DefenderCloud","AZR-000328"]},{"location":"en/rules/Azure.MySQL.DefenderCloud/#notes","title":"Notes","text":"<p>This rule is only applicable for the Azure Database for MySQL Single Server deployment model.</p> <p>Azure Database for MySQL Flexible Server deployment model does not currently support Microsoft Defender for Cloud.</p>","tags":["Azure.MySQL.DefenderCloud","AZR-000328"]},{"location":"en/rules/Azure.MySQL.DefenderCloud/#links","title":"Links","text":"<ul> <li>Security operations</li> <li>Enable Microsoft Defender for open-source relational databases</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.MySQL.DefenderCloud","AZR-000328"]},{"location":"en/rules/Azure.MySQL.FirewallIPRange/","title":"MySQL service firewall exposes a broad range of addresses","text":"Azure.MySQL.FirewallIPRangeAZR-000135Error <p> Security  \u00b7  Azure Database for MySQL  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Determine if there is an excessive number of permitted IP addresses.</p>","tags":["Azure.MySQL.FirewallIPRange","AZR-000135"]},{"location":"en/rules/Azure.MySQL.FirewallIPRange/#description","title":"Description","text":"<p>Typically the number of IP address rules permitted through the firewall is minimal, with management connectivity from on-premises and cloud application connectivity the most common.</p>","tags":["Azure.MySQL.FirewallIPRange","AZR-000135"]},{"location":"en/rules/Azure.MySQL.FirewallIPRange/#recommendation","title":"Recommendation","text":"<p>The MySQL server has greater then ten (10) public IP addresses that are permitted network access. Some rules may not be needed or can be reduced.</p>","tags":["Azure.MySQL.FirewallIPRange","AZR-000135"]},{"location":"en/rules/Azure.MySQL.FirewallIPRange/#notes","title":"Notes","text":"<p>This rule is only applicable for the Azure Database for MySQL Single Server deployment model.</p>","tags":["Azure.MySQL.FirewallIPRange","AZR-000135"]},{"location":"en/rules/Azure.MySQL.FirewallIPRange/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Create and manage Azure Database for MySQL firewall rules by using the Azure portal</li> <li>Create and manage Azure Database for MySQL VNet service endpoints and VNet rules by using the Azure portal</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.MySQL.FirewallIPRange","AZR-000135"]},{"location":"en/rules/Azure.MySQL.FirewallRuleCount/","title":"Cleanup MySQL server firewall rules","text":"Azure.MySQL.FirewallRuleCountAZR-000133Error <p> Security  \u00b7  Azure Database for MySQL  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Determine if there is an excessive number of firewall rules.</p>","tags":["Azure.MySQL.FirewallRuleCount","AZR-000133"]},{"location":"en/rules/Azure.MySQL.FirewallRuleCount/#description","title":"Description","text":"<p>Typically the number of firewall rules required is minimal, with management connectivity from on-premises and cloud application connectivity the most common.</p>","tags":["Azure.MySQL.FirewallRuleCount","AZR-000133"]},{"location":"en/rules/Azure.MySQL.FirewallRuleCount/#recommendation","title":"Recommendation","text":"<p>The MySQL server has greater then ten (10) firewall rules. Some rules may not be needed.</p>","tags":["Azure.MySQL.FirewallRuleCount","AZR-000133"]},{"location":"en/rules/Azure.MySQL.FirewallRuleCount/#notes","title":"Notes","text":"<p>This rule is only applicable for the Azure Database for MySQL Single Server deployment model.</p> <p>This rule fails when the number of configured firewall rules exceeds ten (10).</p>","tags":["Azure.MySQL.FirewallRuleCount","AZR-000133"]},{"location":"en/rules/Azure.MySQL.FirewallRuleCount/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Create and manage Azure Database for MySQL firewall rules by using the Azure portal</li> <li>Create and manage Azure Database for MySQL VNet service endpoints and VNet rules by using the Azure portal</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.MySQL.FirewallRuleCount","AZR-000133"]},{"location":"en/rules/Azure.MySQL.GeoRedundantBackup/","title":"Configure geo-redundant backup","text":"Azure.MySQL.GeoRedundantBackupAZR-000323Error <p> Reliability  \u00b7  Azure Database for MySQL  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Azure Database for MySQL should store backups in a geo-redundant storage.</p>","tags":["Azure.MySQL.GeoRedundantBackup","AZR-000323"]},{"location":"en/rules/Azure.MySQL.GeoRedundantBackup/#description","title":"Description","text":"<p>Geo-redundant backup helps to protect your Azure Database for MySQL Servers against outages impacting backup storage in the primary region and allows you to restore your server to the geo-paired region in the event of a disaster.</p> <p>When the backups are stored in geo-redundant backup storage, they are not only stored within the region in which your server is hosted, but are also replicated to a paired data center. Both the Azure Database for MySQL Flexible Server and the Azure Database for MySQL Single Server deployment model supports geo-redundant backup.</p> <p>For the flexible deployment model the geo-redundant backup is supported for all tiers, but for the single deployment model either <code>General Purpose</code> or <code>Memory Optimized</code> tier is required.</p> <p>Check out the <code>NOTES</code> section for more details about geo-redundant backup for each of the deployment models.</p>","tags":["Azure.MySQL.GeoRedundantBackup","AZR-000323"]},{"location":"en/rules/Azure.MySQL.GeoRedundantBackup/#recommendation","title":"Recommendation","text":"<p>Configure geo-redundant backup for Azure Database for MySQL.</p>","tags":["Azure.MySQL.GeoRedundantBackup","AZR-000323"]},{"location":"en/rules/Azure.MySQL.GeoRedundantBackup/#examples","title":"Examples","text":"","tags":["Azure.MySQL.GeoRedundantBackup","AZR-000323"]},{"location":"en/rules/Azure.MySQL.GeoRedundantBackup/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Database for MySQL Flexible Servers that pass this rule:</p> <ul> <li>Set the <code>properties.backup.geoRedundantBackup</code> property to the value <code>'Enabled'</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforMySQL/flexibleServers\",\n  \"apiVersion\": \"2021-12-01-preview\",\n  \"name\": \"[parameters('serverName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_D16as\",\n    \"tier\": \"GeneralPurpose\"\n  },\n  \"properties\": {\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"storage\": {\n      \"autoGrow\": \"Enabled\",\n      \"iops\": \"[parameters('StorageIops')]\",\n      \"storageSizeGB\": \"[parameters('StorageSizeGB')]\"\n    },\n    \"createMode\": \"Default\",\n    \"version\": \"[parameters('mysqlVersion')]\",\n    \"backup\": {\n      \"backupRetentionDays\": 7,\n      \"geoRedundantBackup\": \"Enabled\"\n    },\n    \"highAvailability\": {\n      \"mode\": \"Disabled\"\n    }\n  }\n}\n</code></pre> <p>To deploy Azure Database for MySQL Single Servers that pass this rule:</p> <ul> <li>Set the <code>properties.storageProfile.geoRedundantBackup</code> property to the value <code>'Enabled'</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforMySQL/servers\",\n  \"apiVersion\": \"2017-12-01\",\n  \"name\": \"[parameters('serverName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"[parameters('skuName')]\",\n    \"tier\": \"GeneralPurpose\",\n    \"capacity\": \"[parameters('skuCapacity')]\",\n    \"size\": \"[format('{0}', parameters('SkuSizeMB'))]\",\n    \"family\": \"[parameters('skuFamily')]\"\n  },\n  \"properties\": {\n    \"createMode\": \"Default\",\n    \"version\": \"[parameters('mysqlVersion')]\",\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"storageProfile\": {\n      \"storageMB\": \"[parameters('SkuSizeMB')]\",\n      \"backupRetentionDays\": 7,\n      \"geoRedundantBackup\": \"Enabled\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.MySQL.GeoRedundantBackup","AZR-000323"]},{"location":"en/rules/Azure.MySQL.GeoRedundantBackup/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Database for MySQL Flexible Servers that pass this rule:</p> <ul> <li>Set the <code>properties.backup.geoRedundantBackup</code> property to the value <code>'Enabled'</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource mysqlDbServer 'Microsoft.DBforMySQL/flexibleServers@2021-12-01-preview' = {\n  name: serverName\n  location: location\n  sku: {\n    name: 'Standard_D16as'\n    tier: 'GeneralPurpose'\n  }\n  properties: {\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    storage: {\n      autoGrow: 'Enabled'\n      iops: StorageIops\n      storageSizeGB: StorageSizeGB\n    }\n    createMode: 'Default'\n    version: mysqlVersion\n    backup: {\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Enabled'\n    }\n    highAvailability: {\n      mode: 'Disabled'\n    }\n  }\n}\n</code></pre> <p>To deploy Azure Database for MySQL Single Servers that pass this rule:</p> <ul> <li>Set the <code>properties.storageProfile.geoRedundantBackup</code> property to the value <code>'Enabled'</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource mysqlDbServer 'Microsoft.DBforMySQL/servers@2017-12-01' = {\n  name: serverName\n  location: location\n  sku: {\n    name: skuName\n    tier: 'GeneralPurpose'\n    capacity: skuCapacity\n    size: '${SkuSizeMB}'\n    family: skuFamily\n  }\n  properties: {\n    createMode: 'Default'\n    version: mysqlVersion\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    storageProfile: {\n      storageMB: SkuSizeMB\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Enabled'\n    }\n  }\n}\n</code></pre>","tags":["Azure.MySQL.GeoRedundantBackup","AZR-000323"]},{"location":"en/rules/Azure.MySQL.GeoRedundantBackup/#notes","title":"Notes","text":"<p>This rule is applicable for both the Azure Database for MySQL Flexible Server deployment model and the Azure Database for MySQL Single Server deployment model.</p> <p>For the Single Server deployment model, it runs only against <code>'General Purpose'</code> and <code>'Memory Optimized'</code> tiers. The <code>'Basic'</code> tier does not support geo-redundant backup storage.</p>","tags":["Azure.MySQL.GeoRedundantBackup","AZR-000323"]},{"location":"en/rules/Azure.MySQL.GeoRedundantBackup/#links","title":"Links","text":"<ul> <li>Target and non-functional requirements</li> <li>Backup and restore in Azure Database for MySQL flexible servers</li> <li>Backup and restore in Azure Database for MySQL single servers</li> <li>Azure deployment reference flexible servers</li> <li>Azure deployment reference single servers</li> </ul>","tags":["Azure.MySQL.GeoRedundantBackup","AZR-000323"]},{"location":"en/rules/Azure.MySQL.MaintenanceWindow/","title":"Customer-controlled maintenance window configuration","text":"Azure.MySQL.MaintenanceWindowAZR-000431Error <p> Reliability  \u00b7  Azure Database for MySQL  \u00b7  Rule  \u00b7  2024_06  \u00b7  Important</p> <p>Configure a customer-controlled maintenance window for Azure Database for MySQL servers.</p>","tags":["Azure.MySQL.MaintenanceWindow","AZR-000431"]},{"location":"en/rules/Azure.MySQL.MaintenanceWindow/#description","title":"Description","text":"<p>Azure Database for MySQL flexible servers undergo periodic maintenance to ensure your managed database remains secure, stable, and up-to-date. This maintenance includes applying security updates, system upgrades, and software patches.</p> <p>Maintenance windows can be scheduled in two ways for each flexible server:</p> <ul> <li>System-Managed Schedule: The system automatically selects a one-hour window between 11 PM and 7 AM in your server\u2019s regional time.</li> <li>Custom Schedule: You can specify a preferred maintenance window by choosing the day of the week and a one-hour time window.</li> </ul> <p>By configuring a customer-controlled maintenance window, you can schedule updates to occur during a preferred time, ideally outside business hours, minimizing disruptions.</p> <p>Only the flexible server deployment model supports customer-controlled maintenance windows.</p>","tags":["Azure.MySQL.MaintenanceWindow","AZR-000431"]},{"location":"en/rules/Azure.MySQL.MaintenanceWindow/#recommendation","title":"Recommendation","text":"<p>Consider using a customer-controlled maintenance window to efficiently schedule updates and minimize disruptions.</p>","tags":["Azure.MySQL.MaintenanceWindow","AZR-000431"]},{"location":"en/rules/Azure.MySQL.MaintenanceWindow/#examples","title":"Examples","text":"","tags":["Azure.MySQL.MaintenanceWindow","AZR-000431"]},{"location":"en/rules/Azure.MySQL.MaintenanceWindow/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure servers that pass this rule:</p> <ul> <li>Set the <code>properties.maintenanceWindow.customWindow</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforMySQL/flexibleServers\",\n  \"apiVersion\": \"2023-10-01-preview\",\n  \"name\": \"[parameters('serverName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_D16as\",\n    \"tier\": \"GeneralPurpose\"\n  },\n  \"properties\": {\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"createMode\": \"Default\",\n    \"version\": \"[parameters('mysqlVersion')]\",\n    \"maintenanceWindow\": {\n      \"customWindow\": \"Enabled\",\n      \"dayOfWeek\": \"0\",\n      \"startHour\": \"1\",\n      \"startMinute\": \"0\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.MySQL.MaintenanceWindow","AZR-000431"]},{"location":"en/rules/Azure.MySQL.MaintenanceWindow/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure servers that pass this rule:</p> <ul> <li>Set the <code>properties.maintenanceWindow.customWindow</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource mysqlDbServer 'Microsoft.DBforMySQL/flexibleServers@2023-10-01-preview' = {\n  name: serverName\n  location: location\n  sku: {\n    name: 'Standard_D16as'\n    tier: 'GeneralPurpose'\n  }\n  properties: {\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    createMode: 'Default'\n    version: mysqlVersion\n     maintenanceWindow: {\n      customWindow: 'Enabled'\n      dayOfWeek: 0\n      startHour: 1\n      startMinute: 0\n    }\n  }\n}\n</code></pre>","tags":["Azure.MySQL.MaintenanceWindow","AZR-000431"]},{"location":"en/rules/Azure.MySQL.MaintenanceWindow/#notes","title":"Notes","text":"<p>The custom schedule maintenance window feature is only available for the flexible server deployment model.</p>","tags":["Azure.MySQL.MaintenanceWindow","AZR-000431"]},{"location":"en/rules/Azure.MySQL.MaintenanceWindow/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Scheduled maintenance in Azure Database for MySQL</li> <li>Select a maintenance window</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.MySQL.MaintenanceWindow","AZR-000431"]},{"location":"en/rules/Azure.MySQL.MinTLS/","title":"MySQL DB server minimum TLS version","text":"Azure.MySQL.MinTLSAZR-000132Error <p> Security  \u00b7  Azure Database for MySQL  \u00b7  Rule  \u00b7  2020_09  \u00b7  Critical</p> <p>MySQL DB servers should reject TLS versions older than 1.2.</p>","tags":["Azure.MySQL.MinTLS","AZR-000132"]},{"location":"en/rules/Azure.MySQL.MinTLS/#description","title":"Description","text":"<p>The minimum version of TLS that MySQL DB servers accept is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS.</p> <p>Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted.</p>","tags":["Azure.MySQL.MinTLS","AZR-000132"]},{"location":"en/rules/Azure.MySQL.MinTLS/#recommendation","title":"Recommendation","text":"<p>Consider configuring the minimum supported TLS version to be 1.2.</p>","tags":["Azure.MySQL.MinTLS","AZR-000132"]},{"location":"en/rules/Azure.MySQL.MinTLS/#examples","title":"Examples","text":"","tags":["Azure.MySQL.MinTLS","AZR-000132"]},{"location":"en/rules/Azure.MySQL.MinTLS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy servers that pass this rule:</p> <ul> <li>Set the <code>properties.minimalTlsVersion</code> property to <code>TLS1_2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforMySQL/servers\",\n  \"apiVersion\": \"2017-12-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"GP_Gen5_2\",\n    \"tier\": \"GeneralPurpose\",\n    \"capacity\": 2,\n    \"size\": \"5120\",\n    \"family\": \"Gen5\"\n  },\n  \"properties\": {\n    \"createMode\": \"Default\",\n    \"version\": \"8.0\",\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"minimalTlsVersion\": \"TLS1_2\",\n    \"sslEnforcement\": \"Enabled\",\n    \"publicNetworkAccess\": \"Disabled\",\n    \"storageProfile\": {\n      \"storageMB\": 5120,\n      \"backupRetentionDays\": 7,\n      \"geoRedundantBackup\": \"Enabled\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.MySQL.MinTLS","AZR-000132"]},{"location":"en/rules/Azure.MySQL.MinTLS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy servers that pass this rule:</p> <ul> <li>Set the <code>properties.minimalTlsVersion</code> property to <code>TLS1_2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource singleServer 'Microsoft.DBforMySQL/servers@2017-12-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'GP_Gen5_2'\n    tier: 'GeneralPurpose'\n    capacity: 2\n    size: '5120'\n    family: 'Gen5'\n  }\n  properties: {\n    createMode: 'Default'\n    version: '8.0'\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    minimalTlsVersion: 'TLS1_2'\n    sslEnforcement: 'Enabled'\n    publicNetworkAccess: 'Disabled'\n    storageProfile: {\n      storageMB: 5120\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Enabled'\n    }\n  }\n}\n</code></pre>","tags":["Azure.MySQL.MinTLS","AZR-000132"]},{"location":"en/rules/Azure.MySQL.MinTLS/#notes","title":"Notes","text":"<p>This rule is only applicable for the Azure Database for MySQL Single Server deployment model.</p>","tags":["Azure.MySQL.MinTLS","AZR-000132"]},{"location":"en/rules/Azure.MySQL.MinTLS/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>TLS enforcement in Azure Database for MySQL</li> <li>Set TLS configurations for Azure Database for MySQL</li> <li>TLS encryption in Azure</li> <li>Preparing for TLS 1.2 in Microsoft Azure</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.MySQL.MinTLS","AZR-000132"]},{"location":"en/rules/Azure.MySQL.ServerName/","title":"Use valid MySQL DB server names","text":"Azure.MySQL.ServerNameAZR-000136Error <p> Operational Excellence  \u00b7  Azure Database for MySQL  \u00b7  Rule  \u00b7  2020_12  \u00b7  Awareness</p> <p>Azure MySQL DB server names should meet naming requirements.</p>","tags":["Azure.MySQL.ServerName","AZR-000136"]},{"location":"en/rules/Azure.MySQL.ServerName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for MySQL DB server names are:</p> <ul> <li>Between 3 and 63 characters long.</li> <li>Lowercase letters, numbers, and hyphens.</li> <li>Can't start or end with a hyphen.</li> <li>MySQL DB server names must be globally unique.</li> </ul>","tags":["Azure.MySQL.ServerName","AZR-000136"]},{"location":"en/rules/Azure.MySQL.ServerName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Azure MySQL DB server naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.MySQL.ServerName","AZR-000136"]},{"location":"en/rules/Azure.MySQL.ServerName/#notes","title":"Notes","text":"<p>This rule does not check if Azure MySQL DB server names are unique.</p>","tags":["Azure.MySQL.ServerName","AZR-000136"]},{"location":"en/rules/Azure.MySQL.ServerName/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> </ul>","tags":["Azure.MySQL.ServerName","AZR-000136"]},{"location":"en/rules/Azure.MySQL.UseFlexible/","title":"Use Azure Database for MySQL Flexible Server","text":"Azure.MySQL.UseFlexibleAZR-000325Warning <p> Reliability  \u00b7  Azure Database for MySQL  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Use Azure Database for MySQL Flexible Server deployment model.</p>","tags":["Azure.MySQL.UseFlexible","AZR-000325"]},{"location":"en/rules/Azure.MySQL.UseFlexible/#description","title":"Description","text":"<p>Azure Database for MySQL Single Server is on the retirement path. Upgrade to Azure Database for MySQL Flexible Server.</p> <p>Azure Database for MySQL Flexible Server provides additional options for resilience and scalability above the Single Server deployment model.</p>","tags":["Azure.MySQL.UseFlexible","AZR-000325"]},{"location":"en/rules/Azure.MySQL.UseFlexible/#recommendation","title":"Recommendation","text":"<p>Consider migrating to Azure Database for MySQL Flexible Server deployment model.</p>","tags":["Azure.MySQL.UseFlexible","AZR-000325"]},{"location":"en/rules/Azure.MySQL.UseFlexible/#links","title":"Links","text":"<ul> <li>RE:05 Redundancy</li> <li>Azure Database for MySQL Single Server deployment model retirement</li> <li>Migrate from Single Server to Flexible Server</li> <li>Comparing the MySQL deployment options in Azure</li> <li>Azure deployment reference flexible servers</li> </ul>","tags":["Azure.MySQL.UseFlexible","AZR-000325"]},{"location":"en/rules/Azure.MySQL.UseSSL/","title":"Enforce encrypted MySQL connections","text":"Azure.MySQL.UseSSLAZR-000131Error <p> Security  \u00b7  Azure Database for MySQL  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Enforce encrypted MySQL connections.</p>","tags":["Azure.MySQL.UseSSL","AZR-000131"]},{"location":"en/rules/Azure.MySQL.UseSSL/#description","title":"Description","text":"<p>Azure Database for MySQL is configured to only accept encrypted connections by default. When the setting enforce SSL connections is disabled, encrypted and unencrypted connections are permitted. This does not indicate that unencrypted connections are being used.</p> <p>Unencrypted communication to MySQL server instances could allow disclosure of information to an untrusted party.</p>","tags":["Azure.MySQL.UseSSL","AZR-000131"]},{"location":"en/rules/Azure.MySQL.UseSSL/#recommendation","title":"Recommendation","text":"<p>Azure Database for MySQL should be configured to only accept encrypted connections. Unless explicitly required, consider enabling enforce SSL connections.</p> <p>Also consider using Azure Policy to audit or enforce this configuration.</p>","tags":["Azure.MySQL.UseSSL","AZR-000131"]},{"location":"en/rules/Azure.MySQL.UseSSL/#examples","title":"Examples","text":"","tags":["Azure.MySQL.UseSSL","AZR-000131"]},{"location":"en/rules/Azure.MySQL.UseSSL/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy servers that pass this rule:</p> <ul> <li>Set the <code>properties.sslEnforcement</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforMySQL/servers\",\n  \"apiVersion\": \"2017-12-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"GP_Gen5_2\",\n    \"tier\": \"GeneralPurpose\",\n    \"capacity\": 2,\n    \"size\": \"5120\",\n    \"family\": \"Gen5\"\n  },\n  \"properties\": {\n    \"createMode\": \"Default\",\n    \"version\": \"8.0\",\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"minimalTlsVersion\": \"TLS1_2\",\n    \"sslEnforcement\": \"Enabled\",\n    \"publicNetworkAccess\": \"Disabled\",\n    \"storageProfile\": {\n      \"storageMB\": 5120,\n      \"backupRetentionDays\": 7,\n      \"geoRedundantBackup\": \"Enabled\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.MySQL.UseSSL","AZR-000131"]},{"location":"en/rules/Azure.MySQL.UseSSL/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy servers that pass this rule:</p> <ul> <li>Set the <code>properties.sslEnforcement</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource singleServer 'Microsoft.DBforMySQL/servers@2017-12-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'GP_Gen5_2'\n    tier: 'GeneralPurpose'\n    capacity: 2\n    size: '5120'\n    family: 'Gen5'\n  }\n  properties: {\n    createMode: 'Default'\n    version: '8.0'\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    minimalTlsVersion: 'TLS1_2'\n    sslEnforcement: 'Enabled'\n    publicNetworkAccess: 'Disabled'\n    storageProfile: {\n      storageMB: 5120\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Enabled'\n    }\n  }\n}\n</code></pre>","tags":["Azure.MySQL.UseSSL","AZR-000131"]},{"location":"en/rules/Azure.MySQL.UseSSL/#notes","title":"Notes","text":"<p>This rule is only applicable for the Azure Database for MySQL Single Server deployment model.</p>","tags":["Azure.MySQL.UseSSL","AZR-000131"]},{"location":"en/rules/Azure.MySQL.UseSSL/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>SSL connectivity in Azure Database for MySQL</li> </ul>","tags":["Azure.MySQL.UseSSL","AZR-000131"]},{"location":"en/rules/Azure.MySQL.ZoneRedundantHA/","title":"Zone-Redundant High Availability","text":"Azure.MySQL.ZoneRedundantHAAZR-000432Error <p> Reliability  \u00b7  Azure Database for MySQL  \u00b7  Rule  \u00b7  2024_09  \u00b7  Important</p> <p>Deploy Azure Database for MySQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience.</p>","tags":["Azure.MySQL.ZoneRedundantHA","AZR-000432"]},{"location":"en/rules/Azure.MySQL.ZoneRedundantHA/#description","title":"Description","text":"<p>Azure Database for MySQL flexible servers allows configuration high availability (HA) across availability zones in supported regions. Using availability zones improves resiliency of your solution to failures or disruptions isolated to a zone or data center.</p> <p>Zone-redundant HA works by:</p> <ul> <li>Deploying two servers; a primary in one zone, and a secondary in a physically separate zone.</li> <li>Database and backup storage is also configured across zones and replicated.</li> </ul> <p>The failover process ensures continuous operation by switching from the primary server to the standby replica server. This process can be:</p> <ul> <li>Manual (Planned) Failover: Initiated by the user for maintenance or other operational reasons.</li> <li>Automatic (Unplanned) Failover: Triggered by Azure in response to failures such as hardware or network issues affecting the primary server.</li> </ul> <p>Before opting for the zone-redundant HA model, review the documentation for additional limitations and critical information. This includes understanding the latency impact between zones, cost implications, and any specific regional support constraints.</p>","tags":["Azure.MySQL.ZoneRedundantHA","AZR-000432"]},{"location":"en/rules/Azure.MySQL.ZoneRedundantHA/#recommendation","title":"Recommendation","text":"<p>Consider deploying flexible servers using zone-redundant high-availability to improve the resiliency of your databases.</p>","tags":["Azure.MySQL.ZoneRedundantHA","AZR-000432"]},{"location":"en/rules/Azure.MySQL.ZoneRedundantHA/#examples","title":"Examples","text":"","tags":["Azure.MySQL.ZoneRedundantHA","AZR-000432"]},{"location":"en/rules/Azure.MySQL.ZoneRedundantHA/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure servers that pass this rule:</p> <ul> <li>Set the <code>properties.highAvailability.mode</code> property to <code>ZoneRedundant</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforMySQL/flexibleServers\",\n  \"apiVersion\": \"2023-10-01-preview\",\n  \"name\": \"[parameters('serverName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_D16as\",\n    \"tier\": \"GeneralPurpose\"\n  },\n  \"properties\": {\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"createMode\": \"Default\",\n    \"version\": \"[parameters('mysqlVersion')]\",\n    \"availabilityZone\": \"1\",\n    \"highAvailability\": {\n      \"mode\": \"ZoneRedundant\",\n      \"standbyAvailabilityZone\": \"2\"\n     }\n  }\n}\n</code></pre>","tags":["Azure.MySQL.ZoneRedundantHA","AZR-000432"]},{"location":"en/rules/Azure.MySQL.ZoneRedundantHA/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure servers that pass this rule:</p> <ul> <li>Set the <code>properties.highAvailability.mode</code> property to <code>ZoneRedundant</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource mysqlDbServer 'Microsoft.DBforMySQL/flexibleServers@2023-10-01-preview' = {\n  name: serverName\n  location: location\n  sku: {\n    name: 'Standard_D16as'\n    tier: 'GeneralPurpose'\n  }\n  properties: {\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    createMode: 'Default'\n    version: mysqlVersion\n    availabilityZone: 1\n    highAvailability: {\n      mode: 'ZoneRedundant'\n      standbyAvailabilityZone: 2\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/db-for-my-sql/flexible-server:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/db-for-my-sql/flexible-server:0.4.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.MySQL.ZoneRedundantHA","AZR-000432"]},{"location":"en/rules/Azure.MySQL.ZoneRedundantHA/#notes","title":"Notes","text":"<p>The zone-redundant HA model must be configured during the initial deployment. It is not possible to modify an existing server to include zone-redundant HA after it has been deployed.</p> <p>The <code>Burstable</code> SKU tier is not supported.</p> <p>Only a certain set of regions currently support the zone-redundant HA model.</p>","tags":["Azure.MySQL.ZoneRedundantHA","AZR-000432"]},{"location":"en/rules/Azure.MySQL.ZoneRedundantHA/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>High availability concepts in Azure Database for MySQL</li> <li>Zone-redundant HA architecture</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.MySQL.ZoneRedundantHA","AZR-000432"]},{"location":"en/rules/Azure.NIC.Attached/","title":"Attach NIC or clean up","text":"Azure.NIC.AttachedAZR-000257Error <p> Cost Optimization  \u00b7  Network Interface  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Network interfaces (NICs) that are not used should be removed.</p>","tags":["Azure.NIC.Attached","AZR-000257"]},{"location":"en/rules/Azure.NIC.Attached/#description","title":"Description","text":"<p>Network interfaces (NICs) are used to attach services to a virtual network (VNET). Each NIC is deployed as a separate resource, however they are intended to be used with a related service. A NIC that is not attached to a related service performs no purpose.</p> <p>Keeping unused resources in code or deployed in Azure can lead to confusion and distract attention away from active resources. Avoid unnecessary complexity that can increase the time required to develop, test, and maintain the workload.</p> <p>Example of services that use NICs include:</p> <ul> <li>Virtual Machines.</li> <li>Private Endpoints.</li> <li>Private Link Services.</li> </ul>","tags":["Azure.NIC.Attached","AZR-000257"]},{"location":"en/rules/Azure.NIC.Attached/#recommendation","title":"Recommendation","text":"<p>Consider removing network interfaces that are not required to keep deployments lean and focus personnel time on active resources. Also consider using Resource Groups to help manage the lifecycle of related resources together.</p>","tags":["Azure.NIC.Attached","AZR-000257"]},{"location":"en/rules/Azure.NIC.Attached/#links","title":"Links","text":"<ul> <li>CO:13 Personnel time</li> <li>Design review checklist for Cost Optimization</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.NIC.Attached","AZR-000257"]},{"location":"en/rules/Azure.NIC.Name/","title":"Use valid NIC names","text":"Azure.NIC.NameAZR-000259Error <p> Operational Excellence  \u00b7  Network Interface  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Network Interface (NIC) names should meet naming requirements.</p>","tags":["Azure.NIC.Name","AZR-000259"]},{"location":"en/rules/Azure.NIC.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Network Interface names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>NIC names must be unique within a resource group.</li> </ul>","tags":["Azure.NIC.Name","AZR-000259"]},{"location":"en/rules/Azure.NIC.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Network Interface naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.NIC.Name","AZR-000259"]},{"location":"en/rules/Azure.NIC.Name/#examples","title":"Examples","text":"","tags":["Azure.NIC.Name","AZR-000259"]},{"location":"en/rules/Azure.NIC.Name/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy network interfaces that pass this rule:</p> <ul> <li>Configuring a <code>minLength</code> and <code>maxLength</code> constraint for the resource name parameter.</li> <li>Optionally, you could also use a <code>uniqueString()</code> function to generate a unique name.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"location\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"[resourceGroup().location]\",\n      \"metadata\": {\n        \"description\": \"The location resources will be deployed.\"\n      }\n    },\n    \"subnetId\": {\n      \"type\": \"string\",\n      \"metadata\": {\n        \"description\": \"A reference to the VNET subnet where the VM will be deployed.\"\n      }\n    },\n    \"nicName\": {\n      \"type\": \"string\",\n      \"minLength\": 1,\n      \"maxLength\": 80,\n      \"metadata\": {\n        \"description\": \"The name of the resource.\"\n      }\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.Network/networkInterfaces\",\n      \"apiVersion\": \"2023-05-01\",\n      \"name\": \"[parameters('nicName')]\",\n      \"location\": \"[parameters('location')]\",\n      \"properties\": {\n        \"ipConfigurations\": [\n          {\n            \"name\": \"ipconfig-1\",\n            \"properties\": {\n              \"privateIPAllocationMethod\": \"Dynamic\",\n              \"subnet\": {\n                \"id\": \"[parameters('subnetId')]\"\n              }\n            }\n          }\n        ]\n      }\n    }\n  ]\n}\n</code></pre>","tags":["Azure.NIC.Name","AZR-000259"]},{"location":"en/rules/Azure.NIC.Name/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy network interfaces that pass this rule:</p> <ul> <li>Configuring a <code>minLength</code> and <code>maxLength</code> constraint for the resource name parameter.</li> <li>Optionally, you could also use a <code>uniqueString()</code> function to generate a unique name.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>@minLength(1)\n@maxLength(80)\n@sys.description('The name of the resource.')\nparam nicName string\n\nresource nic 'Microsoft.Network/networkInterfaces@2023-05-01' = {\n  name: nicName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig-1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: subnetId\n          }\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.NIC.Name","AZR-000259"]},{"location":"en/rules/Azure.NIC.Name/#notes","title":"Notes","text":"<p>This rule does not check if Network Interface names are unique.</p>","tags":["Azure.NIC.Name","AZR-000259"]},{"location":"en/rules/Azure.NIC.Name/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Design review checklist for Operational Excellence</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.NIC.Name","AZR-000259"]},{"location":"en/rules/Azure.NIC.UniqueDns/","title":"NICs with custom DNS settings","text":"Azure.NIC.UniqueDnsAZR-000258Error <p> Operational Excellence  \u00b7  Network Interface  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Network interfaces (NICs) should inherit DNS from virtual networks.</p>","tags":["Azure.NIC.UniqueDns","AZR-000258"]},{"location":"en/rules/Azure.NIC.UniqueDns/#description","title":"Description","text":"<p>By default Virtual machine (VM) NICs automatically use a DNS configuration inherited from the virtual network they connect to. Optionally, DNS servers can be overridden on a per NIC basis with a custom configuration.</p> <p>Using network interfaces with individual DNS server settings may increase management overhead and complexity.</p>","tags":["Azure.NIC.UniqueDns","AZR-000258"]},{"location":"en/rules/Azure.NIC.UniqueDns/#recommendation","title":"Recommendation","text":"<p>Consider updating NIC DNS server settings to inherit from virtual network.</p>","tags":["Azure.NIC.UniqueDns","AZR-000258"]},{"location":"en/rules/Azure.NIC.UniqueDns/#links","title":"Links","text":"<ul> <li>Change DNS servers</li> </ul>","tags":["Azure.NIC.UniqueDns","AZR-000258"]},{"location":"en/rules/Azure.NSG.AKSRules/","title":"No custom NSG rules for AKS managed NSGs","text":"Azure.NSG.AKSRulesAZR-000292Error <p> Operational Excellence  \u00b7  Network Security Group  \u00b7  Rule  \u00b7  2022_09  \u00b7  Awareness</p> <p>AKS Network Security Group (NSG) should not have custom rules.</p>","tags":["Azure.NSG.AKSRules","AZR-000292"]},{"location":"en/rules/Azure.NSG.AKSRules/#description","title":"Description","text":"<p>AKS manages the Network Security Group (NSG) allocated to the cluster. There should be no custom rules added as it may cause conflicts, break the AKS cluster or have an unexpected result.</p>","tags":["Azure.NSG.AKSRules","AZR-000292"]},{"location":"en/rules/Azure.NSG.AKSRules/#recommendation","title":"Recommendation","text":"<p>Do not create custom Network Security Group (NSG) rules for an AKS managed NSG.</p>","tags":["Azure.NSG.AKSRules","AZR-000292"]},{"location":"en/rules/Azure.NSG.AKSRules/#links","title":"Links","text":"<ul> <li>AKS Network Security</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.NSG.AKSRules","AZR-000292"]},{"location":"en/rules/Azure.NSG.AnyInboundSource/","title":"Avoid rules that allow any as an inbound source","text":"Azure.NSG.AnyInboundSourceAZR-000137Error <p> Security  \u00b7  Network Security Group  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source.</p>","tags":["Azure.NSG.AnyInboundSource","AZR-000137"]},{"location":"en/rules/Azure.NSG.AnyInboundSource/#description","title":"Description","text":"<p>NSGs filter network traffic for Azure services connected to a virtual network subnet. In addition to the built-in security rules, a number of custom rules may be defined. Custom security rules can be defined that allow or deny inbound or outbound communication.</p> <p>When defining custom rules, avoid using rules that allow any as the inbound source. The intent of custom rules that allow any inbound source may not be clearly understood by support teams. Additionally, custom rules with any inbound source may expose services if a public IP address is attached.</p> <p>When inbound network traffic from the Internet is intended also consider the following:</p> <ul> <li>Use Application Gateway in-front of any web application workloads.</li> <li>Use DDoS Protection Standard to protect public IP addresses.</li> </ul>","tags":["Azure.NSG.AnyInboundSource","AZR-000137"]},{"location":"en/rules/Azure.NSG.AnyInboundSource/#recommendation","title":"Recommendation","text":"<p>Consider updating inbound rules to use a specified source such as an IP range, application security group, or service tag. If inbound access from Internet-based sources is intended, consider using the service tag <code>Internet</code>.</p>","tags":["Azure.NSG.AnyInboundSource","AZR-000137"]},{"location":"en/rules/Azure.NSG.AnyInboundSource/#examples","title":"Examples","text":"","tags":["Azure.NSG.AnyInboundSource","AZR-000137"]},{"location":"en/rules/Azure.NSG.AnyInboundSource/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Network Security Groups that pass this rule:</p> <ul> <li>Set the <code>sourceAddressPrefix</code> or <code>sourceAddressPrefixes</code> property to a value other then <code>*</code> for inbound allow rules.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/networkSecurityGroups\",\n  \"apiVersion\": \"2023-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"securityRules\": [\n      {\n        \"name\": \"AllowLoadBalancerHealthInbound\",\n        \"properties\": {\n          \"description\": \"Allow inbound Azure Load Balancer health check.\",\n          \"access\": \"Allow\",\n          \"direction\": \"Inbound\",\n          \"priority\": 100,\n          \"protocol\": \"*\",\n          \"sourcePortRange\": \"*\",\n          \"sourceAddressPrefix\": \"AzureLoadBalancer\",\n          \"destinationPortRange\": \"*\",\n          \"destinationAddressPrefix\": \"*\"\n        }\n      },\n      {\n        \"name\": \"AllowApplicationInbound\",\n        \"properties\": {\n          \"description\": \"Allow internal web traffic into application.\",\n          \"access\": \"Allow\",\n          \"direction\": \"Inbound\",\n          \"priority\": 300,\n          \"protocol\": \"Tcp\",\n          \"sourcePortRange\": \"*\",\n          \"sourceAddressPrefix\": \"10.0.0.0/8\",\n          \"destinationPortRange\": \"443\",\n          \"destinationAddressPrefix\": \"VirtualNetwork\"\n        }\n      },\n      {\n        \"name\": \"DenyAllInbound\",\n        \"properties\": {\n          \"description\": \"Deny all other inbound traffic.\",\n          \"access\": \"Deny\",\n          \"direction\": \"Inbound\",\n          \"priority\": 4000,\n          \"protocol\": \"*\",\n          \"sourcePortRange\": \"*\",\n          \"sourceAddressPrefix\": \"*\",\n          \"destinationPortRange\": \"*\",\n          \"destinationAddressPrefix\": \"*\"\n        }\n      },\n      {\n        \"name\": \"DenyTraversalOutbound\",\n        \"properties\": {\n          \"description\": \"Deny outbound double hop traversal.\",\n          \"access\": \"Deny\",\n          \"direction\": \"Outbound\",\n          \"priority\": 200,\n          \"protocol\": \"Tcp\",\n          \"sourcePortRange\": \"*\",\n          \"sourceAddressPrefix\": \"VirtualNetwork\",\n          \"destinationAddressPrefix\": \"*\",\n          \"destinationPortRanges\": [\n            \"3389\",\n            \"22\"\n          ]\n        }\n      }\n    ]\n  }\n}\n</code></pre> <p>To create an Application Security Group, use the <code>Microsoft.Network/applicationSecurityGroups</code> resource. For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/applicationSecurityGroups\",\n  \"apiVersion\": \"2023-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {}\n}\n</code></pre>","tags":["Azure.NSG.AnyInboundSource","AZR-000137"]},{"location":"en/rules/Azure.NSG.AnyInboundSource/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Network Security Groups that pass this rule:</p> <ul> <li>Set the <code>sourceAddressPrefix</code> or <code>sourceAddressPrefixes</code> property to a value other then <code>*</code> for inbound allow rules.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource nsg 'Microsoft.Network/networkSecurityGroups@2023-09-01' = {\n  name: name\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'AllowLoadBalancerHealthInbound'\n        properties: {\n          description: 'Allow inbound Azure Load Balancer health check.'\n          access: 'Allow'\n          direction: 'Inbound'\n          priority: 100\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'AzureLoadBalancer'\n          destinationPortRange: '*'\n          destinationAddressPrefix: '*'\n        }\n      }\n      {\n        name: 'AllowApplicationInbound'\n        properties: {\n          description: 'Allow internal web traffic into application.'\n          access: 'Allow'\n          direction: 'Inbound'\n          priority: 300\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '10.0.0.0/8'\n          destinationPortRange: '443'\n          destinationAddressPrefix: 'VirtualNetwork'\n        }\n      }\n      {\n        name: 'DenyAllInbound'\n        properties: {\n          description: 'Deny all other inbound traffic.'\n          access: 'Deny'\n          direction: 'Inbound'\n          priority: 4000\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationPortRange: '*'\n          destinationAddressPrefix: '*'\n        }\n      }\n      {\n        name: 'DenyTraversalOutbound'\n        properties: {\n          description: 'Deny outbound double hop traversal.'\n          access: 'Deny'\n          direction: 'Outbound'\n          priority: 200\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'VirtualNetwork'\n          destinationAddressPrefix: '*'\n          destinationPortRanges: [\n            '3389'\n            '22'\n          ]\n        }\n      }\n    ]\n  }\n}\n</code></pre> <p>To create an Application Security Group, use the <code>Microsoft.Network/applicationSecurityGroups</code> resource. For example:</p> Azure Bicep snippet<pre><code>resource asg 'Microsoft.Network/applicationSecurityGroups@2023-09-01' = {\n  name: name\n  location: location\n  properties: {}\n}\n</code></pre>","tags":["Azure.NSG.AnyInboundSource","AZR-000137"]},{"location":"en/rules/Azure.NSG.AnyInboundSource/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Network Security Groups</li> <li>Service Tags Overview</li> <li>Logically segment subnets</li> <li>What is Azure Application Gateway?</li> <li>What is Azure DDoS Protection?</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.NSG.AnyInboundSource","AZR-000137"]},{"location":"en/rules/Azure.NSG.Associated/","title":"Associate NSGs or clean them up","text":"Azure.NSG.AssociatedAZR-000140Error <p> Cost Optimization  \u00b7  Network Security Group  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Network Security Groups (NSGs) should be associated to a subnet or network interface.</p>","tags":["Azure.NSG.Associated","AZR-000140"]},{"location":"en/rules/Azure.NSG.Associated/#description","title":"Description","text":"<p>NSGs are basic stateful firewalls that are deployed as separate resources within your subscriptions. Each NSG can be associated to one or more network interfaces or subnets. NSGs that are not associated with a network interface or subnet perform no purpose and add to administration overhead.</p>","tags":["Azure.NSG.Associated","AZR-000140"]},{"location":"en/rules/Azure.NSG.Associated/#recommendation","title":"Recommendation","text":"<p>Consider cleaning up NSGs that are not required to reduce technical debt. Also consider using Resource Groups to help manage the lifecycle of related resources together. Apply tags to all resources to help identify resources that are attached to specific workloads.</p>","tags":["Azure.NSG.Associated","AZR-000140"]},{"location":"en/rules/Azure.NSG.Associated/#examples","title":"Examples","text":"","tags":["Azure.NSG.Associated","AZR-000140"]},{"location":"en/rules/Azure.NSG.Associated/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"<p>To find orphaned NSG's run the following Azure CLI command:</p> Azure CLI snippet<pre><code>az network nsg list -g $rgName --query \"[?(subnets==null) &amp;&amp; (networkInterfaces==null)].id\" -o tsv\n</code></pre>","tags":["Azure.NSG.Associated","AZR-000140"]},{"location":"en/rules/Azure.NSG.Associated/#links","title":"Links","text":"<ul> <li>CO:13 Personnel time</li> <li>Orphaned Resources Workbook</li> <li>Modify, create and delete NSG's using the CLI</li> <li>Network security groups</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.NSG.Associated","AZR-000140"]},{"location":"en/rules/Azure.NSG.DenyAllInbound/","title":"Network Security Group denies all inbound traffic","text":"Azure.NSG.DenyAllInboundAZR-000138Error <p> Reliability  \u00b7  Network Security Group  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected.</p>","tags":["Azure.NSG.DenyAllInbound","AZR-000138"]},{"location":"en/rules/Azure.NSG.DenyAllInbound/#description","title":"Description","text":"<p>Network Security Groups (NSGs) are can be configured to block or allow network traffic by defining security rules. Each security rule is processed in order from lowest priority to highest priority until the first match is found. Blocking all inbound traffic will fail load balancer health probes and other required traffic.</p> <p>When using a custom deny all inbound rule, also add rules to allow permitted traffic. To permit network traffic, add a custom allow rule with a lower priority number then the deny all rule. Rules with a lower priority number will be processed first. 100 is the lowest priority number.</p>","tags":["Azure.NSG.DenyAllInbound","AZR-000138"]},{"location":"en/rules/Azure.NSG.DenyAllInbound/#recommendation","title":"Recommendation","text":"<p>Consider using a higher priority number for deny all rules to allow permitted traffic rules to be added and processed first. Consider enabling Flow Logs on all critical subnets in your subscription as an auditability and security best practice.</p>","tags":["Azure.NSG.DenyAllInbound","AZR-000138"]},{"location":"en/rules/Azure.NSG.DenyAllInbound/#examples","title":"Examples","text":"","tags":["Azure.NSG.DenyAllInbound","AZR-000138"]},{"location":"en/rules/Azure.NSG.DenyAllInbound/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Network Security Groups that pass this rule:</p> <ul> <li>Set the priority of rules to a number less than a deny all rule.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/networkSecurityGroups\",\n  \"apiVersion\": \"2022-01-01\",\n  \"name\": \"[parameters('nsgName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"securityRules\": [\n      {\n        \"name\": \"AllowLoadBalancerHealthInbound\",\n        \"properties\": {\n          \"description\": \"Allow inbound Azure Load Balancer health check.\",\n          \"access\": \"Allow\",\n          \"direction\": \"Inbound\",\n          \"priority\": 100,\n          \"protocol\": \"*\",\n          \"sourcePortRange\": \"*\",\n          \"sourceAddressPrefix\": \"AzureLoadBalancer\",\n          \"destinationPortRange\": \"*\",\n          \"destinationAddressPrefix\": \"*\"\n        }\n      },\n      {\n        \"name\": \"AllowApplicationInbound\",\n        \"properties\": {\n          \"description\": \"Allow internal web traffic into application.\",\n          \"access\": \"Allow\",\n          \"direction\": \"Inbound\",\n          \"priority\": 300,\n          \"protocol\": \"Tcp\",\n          \"sourcePortRange\": \"*\",\n          \"sourceAddressPrefix\": \"10.0.0.0/8\",\n          \"destinationPortRange\": \"443\",\n          \"destinationAddressPrefix\": \"VirtualNetwork\"\n        }\n      },\n      {\n        \"name\": \"DenyAllInbound\",\n        \"properties\": {\n          \"description\": \"Deny all other inbound traffic.\",\n          \"access\": \"Deny\",\n          \"direction\": \"Inbound\",\n          \"priority\": 4000,\n          \"protocol\": \"*\",\n          \"sourcePortRange\": \"*\",\n          \"sourceAddressPrefix\": \"*\",\n          \"destinationPortRange\": \"*\",\n          \"destinationAddressPrefix\": \"*\"\n        }\n      },\n      {\n        \"name\": \"DenyTraversalOutbound\",\n        \"properties\": {\n          \"description\": \"Deny outbound double hop traversal.\",\n          \"access\": \"Deny\",\n          \"direction\": \"Outbound\",\n          \"priority\": 200,\n          \"protocol\": \"Tcp\",\n          \"sourcePortRange\": \"*\",\n          \"sourceAddressPrefix\": \"VirtualNetwork\",\n          \"destinationAddressPrefix\": \"*\",\n          \"destinationPortRanges\": [\n            \"3389\",\n            \"22\"\n          ]\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.NSG.DenyAllInbound","AZR-000138"]},{"location":"en/rules/Azure.NSG.DenyAllInbound/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Network Security Groups that pass this rule:</p> <ul> <li>Set the priority of rules to a number less than a deny all rule.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource nsg 'Microsoft.Network/networkSecurityGroups@2022-01-01' = {\n  name: nsgName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'AllowLoadBalancerHealthInbound'\n        properties: {\n          description: 'Allow inbound Azure Load Balancer health check.'\n          access: 'Allow'\n          direction: 'Inbound'\n          priority: 100\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'AzureLoadBalancer'\n          destinationPortRange: '*'\n          destinationAddressPrefix: '*'\n        }\n      }\n      {\n        name: 'AllowApplicationInbound'\n        properties: {\n          description: 'Allow internal web traffic into application.'\n          access: 'Allow'\n          direction: 'Inbound'\n          priority: 300\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '10.0.0.0/8'\n          destinationPortRange: '443'\n          destinationAddressPrefix: 'VirtualNetwork'\n        }\n      }\n      {\n        name: 'DenyAllInbound'\n        properties: {\n          description: 'Deny all other inbound traffic.'\n          access: 'Deny'\n          direction: 'Inbound'\n          priority: 4000\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationPortRange: '*'\n          destinationAddressPrefix: '*'\n        }\n      }\n      {\n        name: 'DenyTraversalOutbound'\n        properties: {\n          description: 'Deny outbound double hop traversal.'\n          access: 'Deny'\n          direction: 'Outbound'\n          priority: 200\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'VirtualNetwork'\n          destinationAddressPrefix: '*'\n          destinationPortRanges: [\n            '3389'\n            '22'\n          ]\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.NSG.DenyAllInbound","AZR-000138"]},{"location":"en/rules/Azure.NSG.DenyAllInbound/#links","title":"Links","text":"<ul> <li>RE:01 Simplicity and efficiency</li> <li>Network security groups</li> <li>Introduction to flow logging for network security groups</li> <li>Virtual network service tags</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.NSG.DenyAllInbound","AZR-000138"]},{"location":"en/rules/Azure.NSG.LateralTraversal/","title":"Limit lateral traversal within subnets","text":"Azure.NSG.LateralTraversalAZR-000139Error <p> Security  \u00b7  Network Security Group  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Deny outbound management connections from non-management hosts.</p>","tags":["Azure.NSG.LateralTraversal","AZR-000139"]},{"location":"en/rules/Azure.NSG.LateralTraversal/#description","title":"Description","text":"<p>Network Security Groups (NSGs) are basic stateful firewalls that provide network isolation and security. NSGs allow or deny network traffic to and from Azure resources in an Azure virtual network. i.e. Traffic between VMs on the same or different subnet can be restricted. NSGs do this by enforcing ordered access rules for all traffic in or out services attached to a subnet.</p> <p>This micro-segmentation approach provides a control to reduce lateral movement between services.</p> <p>Typically, a subset of trusted hosts such as privileged access workstations (PAWs), bastion hosts, or jump boxes will be used for management. Management protocols originating from application workload hosts should be blocked.</p> <p>For example:</p> <ul> <li>An SQL Server should not be used as a management host to manage other SQL Servers, or File Servers.</li> <li>Configure dedicated management hosts to manage other hosts.</li> </ul> <p>This helps improve security in two ways:</p> <ol> <li>Reduces the attack surface that can be used in lateral traversal attacks.</li> <li>Limits the likelihood that privileged credentials will be exposed for outbound management.</li> </ol>","tags":["Azure.NSG.LateralTraversal","AZR-000139"]},{"location":"en/rules/Azure.NSG.LateralTraversal/#recommendation","title":"Recommendation","text":"<p>Consider configuring NSGs rules to block common outbound management traffic from non-management hosts.</p>","tags":["Azure.NSG.LateralTraversal","AZR-000139"]},{"location":"en/rules/Azure.NSG.LateralTraversal/#examples","title":"Examples","text":"","tags":["Azure.NSG.LateralTraversal","AZR-000139"]},{"location":"en/rules/Azure.NSG.LateralTraversal/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy NSGs that pass this rule:</p> <ul> <li>Add an outbound security rule that denies TCP port 3389 and/ or 22.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Network/networkSecurityGroups\",\n    \"name\": \"[parameters('nsgName')]\",\n    \"apiVersion\": \"2019-04-01\",\n    \"location\": \"[resourceGroup().location]\",\n    \"properties\": {\n        \"securityRules\": [\n            {\n                \"name\": \"deny-hop-outbound\",\n                \"properties\": {\n                    \"protocol\": \"*\",\n                    \"sourcePortRange\": \"*\",\n                    \"destinationPortRanges\": [\n                        \"3389\",\n                        \"22\"\n                    ],\n                    \"access\": \"Deny\",\n                    \"priority\": 200,\n                    \"direction\": \"Outbound\",\n                    \"sourceAddressPrefix\": \"VirtualNetwork\",\n                    \"destinationAddressPrefix\": \"*\"\n                }\n            }\n        ]\n    }\n}\n</code></pre>","tags":["Azure.NSG.LateralTraversal","AZR-000139"]},{"location":"en/rules/Azure.NSG.LateralTraversal/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy NSGs that pass this rule:</p> <ul> <li>Add an outbound security rule that denies TCP port 3389 and/ or 22.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource nsg 'Microsoft.Network/networkSecurityGroups@2021-02-01' = {\n  name: 'nsg-001'\n  properties: {\n    securityRules: [\n      {\n        name: 'deny-hop-outbound'\n        properties: {\n          priority: 200\n          access: 'Deny'\n          protocol: 'Tcp'\n          direction: 'Outbound'\n          sourceAddressPrefix: 'VirtualNetwork'\n          destinationAddressPrefix: '*'\n          destinationPortRanges: [\n            '3389'\n            '22'\n          ]\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.NSG.LateralTraversal","AZR-000139"]},{"location":"en/rules/Azure.NSG.LateralTraversal/#notes","title":"Notes","text":"<p>Specifically this rule checks if either 3389 (RDP) or 22 (SSH) has been blocked for outbound traffic.</p> <p>To suppress this rule for NSGs protecting subnets expected to allow outbound management traffic see Permit outbound management.</p>","tags":["Azure.NSG.LateralTraversal","AZR-000139"]},{"location":"en/rules/Azure.NSG.LateralTraversal/#links","title":"Links","text":"<ul> <li>SE:04 Segmentation</li> <li>Logically segment subnets</li> <li>Plan virtual networks</li> <li>Network security groups</li> <li>Permit outbound management</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.NSG.LateralTraversal","AZR-000139"]},{"location":"en/rules/Azure.NSG.Name/","title":"Use valid NSG names","text":"Azure.NSG.NameAZR-000141Error <p> Operational Excellence  \u00b7  Network Security Group  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Network Security Group (NSG) names should meet naming requirements.</p>","tags":["Azure.NSG.Name","AZR-000141"]},{"location":"en/rules/Azure.NSG.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for NSG names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>NSG names must be unique within a resource group.</li> </ul>","tags":["Azure.NSG.Name","AZR-000141"]},{"location":"en/rules/Azure.NSG.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Network Security Group naming requirements. Additionally consider naming resources with a standard naming convention. If creating resources using CI/CD pipelines consider programmatically Generating Cloud Resource Names using PowerShell or Bicep</p>","tags":["Azure.NSG.Name","AZR-000141"]},{"location":"en/rules/Azure.NSG.Name/#notes","title":"Notes","text":"<p>This rule does not check if NSG names are unique.</p>","tags":["Azure.NSG.Name","AZR-000141"]},{"location":"en/rules/Azure.NSG.Name/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> <li>Recommended abbreviations for Azure resource types</li> </ul>","tags":["Azure.NSG.Name","AZR-000141"]},{"location":"en/rules/Azure.Policy.AssignmentAssignedBy/","title":"Use assigned by for policy assignments","text":"Azure.Policy.AssignmentAssignedByAZR-000144Error <p> Operational Excellence  \u00b7  Policy  \u00b7  Rule  \u00b7  2021_06  \u00b7  Awareness</p> <p>Policy assignments should use <code>assignedBy</code> metadata.</p>","tags":["Azure.Policy.AssignmentAssignedBy","AZR-000144"]},{"location":"en/rules/Azure.Policy.AssignmentAssignedBy/#description","title":"Description","text":"<p>When using the Azure Portal, policy assignment automatically set the <code>assignedBy</code> metadata. This metadata field is intended to indicate the person or team assigning the policy to a resource scope.</p> <p>When automating policy management, it may be helpful to identify assignments managed by code.</p>","tags":["Azure.Policy.AssignmentAssignedBy","AZR-000144"]},{"location":"en/rules/Azure.Policy.AssignmentAssignedBy/#recommendation","title":"Recommendation","text":"<p>Consider setting <code>assignedBy</code> metadata for each policy assignment.</p>","tags":["Azure.Policy.AssignmentAssignedBy","AZR-000144"]},{"location":"en/rules/Azure.Policy.AssignmentAssignedBy/#examples","title":"Examples","text":"","tags":["Azure.Policy.AssignmentAssignedBy","AZR-000144"]},{"location":"en/rules/Azure.Policy.AssignmentAssignedBy/#azure-templates","title":"Azure templates","text":"<p>To deploy policy assignments that pass this rule:</p> <ul> <li>Set the <code>properties.metadata.assignedBy</code> property with a valid value.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"comments\": \"Initiative assignment\",\n    \"name\": \"assignment-001\",\n    \"type\": \"Microsoft.Authorization/policyAssignments\",\n    \"apiVersion\": \"2019-06-01\",\n    \"properties\": {\n        \"displayName\": \"Assignment 001\",\n        \"description\": \"An example policy assignment.\",\n        \"metadata\": {\n            \"assignedBy\": \"DevOps pipeline\"\n        },\n        \"enforcementMode\": \"Default\"\n    }\n}\n</code></pre>","tags":["Azure.Policy.AssignmentAssignedBy","AZR-000144"]},{"location":"en/rules/Azure.Policy.AssignmentAssignedBy/#links","title":"Links","text":"<ul> <li>Azure Policy assignment structure</li> <li>Azure deployment reference</li> <li>Repeatable infrastructure</li> </ul>","tags":["Azure.Policy.AssignmentAssignedBy","AZR-000144"]},{"location":"en/rules/Azure.Policy.AssignmentDescriptors/","title":"Use descriptive policy assignments","text":"Azure.Policy.AssignmentDescriptorsAZR-000143Error <p> Operational Excellence  \u00b7  Policy  \u00b7  Rule  \u00b7  2021_06  \u00b7  Awareness</p> <p>Policy assignments should use a display name and description.</p>","tags":["Azure.Policy.AssignmentDescriptors","AZR-000143"]},{"location":"en/rules/Azure.Policy.AssignmentDescriptors/#description","title":"Description","text":"<p>Policy assignments can be configured with a display name and description. Use these additional properties to clearly convey the intent of the policy assignment.</p>","tags":["Azure.Policy.AssignmentDescriptors","AZR-000143"]},{"location":"en/rules/Azure.Policy.AssignmentDescriptors/#recommendation","title":"Recommendation","text":"<p>Consider setting a display name and description for each policy assignment.</p>","tags":["Azure.Policy.AssignmentDescriptors","AZR-000143"]},{"location":"en/rules/Azure.Policy.AssignmentDescriptors/#examples","title":"Examples","text":"","tags":["Azure.Policy.AssignmentDescriptors","AZR-000143"]},{"location":"en/rules/Azure.Policy.AssignmentDescriptors/#azure-templates","title":"Azure templates","text":"<p>To deploy policy assignments that pass this rule:</p> <ul> <li>Set the <code>properties.displayName</code> property with a valid value.</li> <li>Set the <code>properties.description</code> property with a valid value.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"comments\": \"Initiative assignment\",\n    \"name\": \"assignment-001\",\n    \"type\": \"Microsoft.Authorization/policyAssignments\",\n    \"apiVersion\": \"2019-06-01\",\n    \"properties\": {\n        \"displayName\": \"Assignment 001\",\n        \"description\": \"An example policy assignment.\",\n        \"metadata\": {\n            \"assignedBy\": \"DevOps pipeline\"\n        },\n        \"enforcementMode\": \"Default\"\n    }\n}\n</code></pre>","tags":["Azure.Policy.AssignmentDescriptors","AZR-000143"]},{"location":"en/rules/Azure.Policy.AssignmentDescriptors/#links","title":"Links","text":"<ul> <li>OE:04 Tools and processes</li> <li>Azure Policy assignment structure</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Policy.AssignmentDescriptors","AZR-000143"]},{"location":"en/rules/Azure.Policy.Descriptors/","title":"Use descriptive policies","text":"Azure.Policy.DescriptorsAZR-000142Error <p> Operational Excellence  \u00b7  Policy  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Policy and initiative definitions should use a display name, description, and category.</p>","tags":["Azure.Policy.Descriptors","AZR-000142"]},{"location":"en/rules/Azure.Policy.Descriptors/#description","title":"Description","text":"<p>Policy and initiative definitions can be configured with a display name, description, and category. Use these additional properties to clearly convey the purpose when creating custom definitions.</p>","tags":["Azure.Policy.Descriptors","AZR-000142"]},{"location":"en/rules/Azure.Policy.Descriptors/#recommendation","title":"Recommendation","text":"<p>Consider setting a display name, description and category for each policy and initiatives definition.</p>","tags":["Azure.Policy.Descriptors","AZR-000142"]},{"location":"en/rules/Azure.Policy.Descriptors/#examples","title":"Examples","text":"","tags":["Azure.Policy.Descriptors","AZR-000142"]},{"location":"en/rules/Azure.Policy.Descriptors/#azure-templates","title":"Azure templates","text":"<p>To deploy initiative and policy definitions that pass this rule:</p> <ul> <li>Set the <code>properties.displayName</code> property with a valid value.</li> <li>Set the <code>properties.description</code> property with a valid value.</li> <li>Set the <code>properties.metadata.category</code> property with a valid value.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"comments\": \"Initiative definition\",\n    \"name\": \"initiative-001\",\n    \"type\": \"Microsoft.Authorization/policySetDefinitions\",\n    \"apiVersion\": \"2019-06-01\",\n    \"properties\": {\n        \"policyType\": \"Custom\",\n        \"displayName\": \"Initiative 001\",\n        \"description\": \"An example initiative.\",\n        \"metadata\": {\n            \"category\": \"Security\"\n        },\n        \"policyDefinitions\": []\n    }\n}\n</code></pre>","tags":["Azure.Policy.Descriptors","AZR-000142"]},{"location":"en/rules/Azure.Policy.Descriptors/#links","title":"Links","text":"<ul> <li>OE:04 Tools and processes</li> <li>Azure Policy definition structure</li> <li>Common metadata properties</li> <li>Policy definition template reference</li> <li>Initiative definition template reference</li> </ul>","tags":["Azure.Policy.Descriptors","AZR-000142"]},{"location":"en/rules/Azure.Policy.ExemptionDescriptors/","title":"Use descriptive policy exemptions","text":"Azure.Policy.ExemptionDescriptorsAZR-000145Error <p> Operational Excellence  \u00b7  Policy  \u00b7  Rule  \u00b7  2021_06  \u00b7  Awareness</p> <p>Policy exemptions should use a display name and description.</p>","tags":["Azure.Policy.ExemptionDescriptors","AZR-000145"]},{"location":"en/rules/Azure.Policy.ExemptionDescriptors/#description","title":"Description","text":"<p>Policy assignments can be configured with a display name and description. Use these additional properties to clearly convey the reason for the policy exemption. Additionally, consider providing a link or reference to track exemption conditions and approval.</p>","tags":["Azure.Policy.ExemptionDescriptors","AZR-000145"]},{"location":"en/rules/Azure.Policy.ExemptionDescriptors/#recommendation","title":"Recommendation","text":"<p>Consider setting a display name and description for each policy exemption.</p>","tags":["Azure.Policy.ExemptionDescriptors","AZR-000145"]},{"location":"en/rules/Azure.Policy.ExemptionDescriptors/#examples","title":"Examples","text":"","tags":["Azure.Policy.ExemptionDescriptors","AZR-000145"]},{"location":"en/rules/Azure.Policy.ExemptionDescriptors/#azure-templates","title":"Azure templates","text":"<p>To deploy policy exemptions that pass this rule:</p> <ul> <li>Set the <code>properties.displayName</code> property with a valid value.</li> <li>Set the <code>properties.description</code> property with a valid value.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"comments\": \"An example exemption.\",\n    \"name\": \"exemption-001\",\n    \"type\": \"Microsoft.Authorization/policyExemptions\",\n    \"apiVersion\": \"2020-07-01-preview\",\n    \"properties\": {\n        \"policyAssignmentId\": \"&lt;assignment_id&gt;\",\n        \"policyDefinitionReferenceIds\": [],\n        \"exemptionCategory\": \"Waiver\",\n        \"expiresOn\": \"2021-04-27T14:00:00Z\",\n        \"displayName\": \"Exemption 001\",\n        \"description\": \"An example exemption.\",\n        \"metadata\": {\n            \"requestedBy\": \"Apps team\",\n            \"approvedBy\": \"Security team\",\n            \"createdBy\": \"DevOps pipeline\"\n        }\n    }\n}\n</code></pre>","tags":["Azure.Policy.ExemptionDescriptors","AZR-000145"]},{"location":"en/rules/Azure.Policy.ExemptionDescriptors/#links","title":"Links","text":"<ul> <li>OE:04 Tools and processes</li> <li>Azure Policy exemption structure</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Policy.ExemptionDescriptors","AZR-000145"]},{"location":"en/rules/Azure.Policy.WaiverExpiry/","title":"Policy waiver exemptions must expire","text":"Azure.Policy.WaiverExpiryAZR-000146Error <p> Security  \u00b7  Policy  \u00b7  Rule  \u00b7  2021_06  \u00b7  Awareness</p> <p>Configure policy waiver exemptions to expire.</p>","tags":["Azure.Policy.WaiverExpiry","AZR-000146"]},{"location":"en/rules/Azure.Policy.WaiverExpiry/#description","title":"Description","text":"<p>Azure Policy waiver exemptions are intended to be temporary acceptance of a non-compliance state. Use the <code>Mitigated</code> category when the issue intent has been met through an another method.</p>","tags":["Azure.Policy.WaiverExpiry","AZR-000146"]},{"location":"en/rules/Azure.Policy.WaiverExpiry/#recommendation","title":"Recommendation","text":"<p>Consider configuring an expiry for policy exemption waivers within the maximum threshold.</p>","tags":["Azure.Policy.WaiverExpiry","AZR-000146"]},{"location":"en/rules/Azure.Policy.WaiverExpiry/#examples","title":"Examples","text":"","tags":["Azure.Policy.WaiverExpiry","AZR-000146"]},{"location":"en/rules/Azure.Policy.WaiverExpiry/#azure-templates","title":"Azure templates","text":"<p>To deploy policy assignments that pass this rule:</p> <ul> <li>Set the <code>properties.expiresOn</code> property with a valid date earlier than the maximum number of days.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"comments\": \"An example exemption.\",\n    \"name\": \"exemption-001\",\n    \"type\": \"Microsoft.Authorization/policyExemptions\",\n    \"apiVersion\": \"2020-07-01-preview\",\n    \"properties\": {\n        \"policyAssignmentId\": \"&lt;assignment_id&gt;\",\n        \"policyDefinitionReferenceIds\": [],\n        \"exemptionCategory\": \"Waiver\",\n        \"expiresOn\": \"2021-04-27T14:00:00Z\",\n        \"displayName\": \"Exemption 001\",\n        \"description\": \"An example exemption.\",\n        \"metadata\": {\n            \"requestedBy\": \"Apps team\",\n            \"approvedBy\": \"Security team\",\n            \"createdBy\": \"DevOps pipeline\"\n        }\n    }\n}\n</code></pre>","tags":["Azure.Policy.WaiverExpiry","AZR-000146"]},{"location":"en/rules/Azure.Policy.WaiverExpiry/#notes","title":"Notes","text":"<p>This rule fails:</p> <ul> <li>When the exemption is configured not to expire.</li> <li>The exemption expiry date is greater than the maximum threshold.</li> </ul>","tags":["Azure.Policy.WaiverExpiry","AZR-000146"]},{"location":"en/rules/Azure.Policy.WaiverExpiry/#rule-configuration","title":"Rule configuration","text":"<p>AZURE_POLICY_WAIVER_MAX_EXPIRY</p> <p>Configure <code>AZURE_POLICY_WAIVER_MAX_EXPIRY</code> to set the maximum expiry date threshold.</p> <pre><code># YAML: The default AZURE_POLICY_WAIVER_MAX_EXPIRY configuration option\nconfiguration:\n  AZURE_POLICY_WAIVER_MAX_EXPIRY: 366\n</code></pre>","tags":["Azure.Policy.WaiverExpiry","AZR-000146"]},{"location":"en/rules/Azure.Policy.WaiverExpiry/#links","title":"Links","text":"<ul> <li>SE:01 Security baseline</li> <li>Azure Policy exemption structure</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Policy.WaiverExpiry","AZR-000146"]},{"location":"en/rules/Azure.PostgreSQL.AAD/","title":"Use Entra ID authentication with PostgreSQL databases","text":"Azure.PostgreSQL.AADAZR-000389Error <p> Security  \u00b7  Azure Database for PostgreSQL  \u00b7  Rule  \u00b7  2023_06  \u00b7  Critical</p> <p>Use Entra ID authentication with Azure Database for PostgreSQL databases.</p>","tags":["Azure.PostgreSQL.AAD","AZR-000389"]},{"location":"en/rules/Azure.PostgreSQL.AAD/#description","title":"Description","text":"<p>Azure Database for PostgreSQL offer two authentication models, Entra ID (previously known as Azure AD) and PostgreSQL logins. Entra ID authentication supports centralized identity management in addition to modern password protections. Some of the benefits of Entra ID authentication over PostgreSQL authentication including:</p> <ul> <li>Support for Azure Multi-Factor Authentication (MFA).</li> <li>Conditional-based access with Conditional Access.</li> </ul> <p>It is also possible to disable PostgreSQL authentication entirely for the flexible server deployment model.</p>","tags":["Azure.PostgreSQL.AAD","AZR-000389"]},{"location":"en/rules/Azure.PostgreSQL.AAD/#recommendation","title":"Recommendation","text":"<p>Consider using Entra ID authentication with Azure Database for PostgreSQL databases. Additionally, consider disabling PostgreSQL authentication.</p>","tags":["Azure.PostgreSQL.AAD","AZR-000389"]},{"location":"en/rules/Azure.PostgreSQL.AAD/#examples","title":"Examples","text":"","tags":["Azure.PostgreSQL.AAD","AZR-000389"]},{"location":"en/rules/Azure.PostgreSQL.AAD/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Database for PostgreSQL flexible servers that pass this rule:</p> <ul> <li>Configure the <code>Microsoft.DBforPostgreSQL/flexibleServers/administrators</code> sub-resource.</li> <li>Set the <code>properties.principalName</code> to the user principal name of the Entra ID administrator user, group, or application.</li> <li>Set the <code>properties.principalType</code> to the principal type used to represent the type of Entra ID administrator.</li> <li>Set the <code>properties.tenantId</code> to the tenant ID of the Entra ID administrator user, group, or application.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforPostgreSQL/flexibleServers/administrators\",\n  \"apiVersion\": \"2022-12-01\",\n  \"name\": \"[format('{0}/{1}', parameters('serverName'), parameters('name'))]\",\n  \"properties\": {\n    \"principalName\": \"[parameters('principalName')]\",\n    \"principalType\": \"[parameters('principalType')]\",\n    \"tenantId\": \"[parameters('tenantId')]\"\n  },\n  \"dependsOn\": [\n    \"postgreSqlFlexibleServer\"\n  ]\n}\n</code></pre> <p>To deploy Azure Database for PostgreSQL single servers that pass this rule:</p> <ul> <li>Configure the <code>Microsoft.DBforPostgreSQL/servers/administrators</code> sub-resource.</li> <li>Set the <code>properties.administratorType</code> to <code>ActiveDirectory</code>.</li> <li>Set the <code>properties.login</code> to the Entra ID administrator login object name.</li> <li>Set the <code>properties.sid</code> to the object ID GUID of the Entra ID administrator user, group, or application.</li> <li>Set the <code>properties.tenantId</code> to the tenant ID of the Entra ID administrator user, group, or application.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforPostgreSQL/servers/administrators\",\n  \"apiVersion\": \"2017-12-01\",\n  \"name\": \"[format('{0}/{1}', parameters('serverName'), 'activeDirectory')]\",\n  \"properties\": {\n    \"administratorType\": \"ActiveDirectory\",\n    \"login\": \"[parameters('login')]\",\n    \"sid\": \"[parameters('sid')]\",\n    \"tenantId\": \"[parameters('tenantId')]\"\n  },\n  \"dependsOn\": [\n    \"postgreSqlSingleServer\"\n  ]\n}\n</code></pre>","tags":["Azure.PostgreSQL.AAD","AZR-000389"]},{"location":"en/rules/Azure.PostgreSQL.AAD/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Database for PostgreSQL flexible servers that pass this rule:</p> <ul> <li>Configure the <code>Microsoft.DBforPostgreSQL/flexibleServers/administrators</code> sub-resource.</li> <li>Set the <code>properties.principalName</code> to the user principal name of the Entra ID administrator user, group, or application.</li> <li>Set the <code>properties.principalType</code> to the principal type used to represent the type of Entra ID administrator.</li> <li>Set the <code>properties.tenantId</code> to the tenant ID of the Entra ID administrator user, group, or application.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource aadAdmin 'Microsoft.DBforPostgreSQL/flexibleServers/administrators@2022-12-01' = {\n  name: name\n  parent: postgreSqlFlexibleServer\n  properties: {\n    principalName: principalName\n    principalType: principalType\n    tenantId: tenantId\n  }\n}\n</code></pre> <p>To deploy Azure Database for PostgreSQL single servers that pass this rule:</p> <ul> <li>Configure the <code>Microsoft.DBforPostgreSQL/servers/administrators</code> sub-resource.</li> <li>Set the <code>properties.administratorType</code> to <code>ActiveDirectory</code>.</li> <li>Set the <code>properties.login</code> to the Entra ID administrator login object name.</li> <li>Set the <code>properties.sid</code> to the object ID GUID of the Entra ID administrator user, group, or application.</li> <li>Set the <code>properties.tenantId</code> to the tenant ID of the Entra ID administrator user, group, or application.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource aadAdmin 'Microsoft.DBforPostgreSQL/servers/administrators@2017-12-01' = {\n  name: 'activeDirectory'\n  parent: postgreSqlSingleServer\n  properties: {\n    administratorType: 'ActiveDirectory'\n    login: login\n    sid: sid\n    tenantId: tenantId\n  }\n}\n</code></pre>","tags":["Azure.PostgreSQL.AAD","AZR-000389"]},{"location":"en/rules/Azure.PostgreSQL.AAD/#notes","title":"Notes","text":"<p>The single server deployment model is limited to:</p> <ul> <li>Only one Entra ID admin at a time.</li> <li>Does not support enforcing Entra ID authentication only.</li> </ul>","tags":["Azure.PostgreSQL.AAD","AZR-000389"]},{"location":"en/rules/Azure.PostgreSQL.AAD/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>How Microsoft Entra ID Works in Azure Database for PostgreSQL flexible server</li> <li>Use Microsoft Entra ID for authentication with Azure Database for PostgreSQL - Flexible Server</li> <li>Use Microsoft Entra ID for authentication with PostgreSQL</li> <li>Microsoft Entra authentication (Azure Database for PostgreSQL single Server vs Azure Database for PostgreSQL flexible server)</li> <li>Azure security baseline for Azure Database for PostgreSQL - Flexible Server</li> <li>Azure security baseline for Azure Database for PostgreSQL - Single Server</li> <li>IM-1: Use centralized identity and authentication system</li> <li>Azure deployment reference Flexible Server</li> <li>Azure deployment reference Single Server</li> </ul>","tags":["Azure.PostgreSQL.AAD","AZR-000389"]},{"location":"en/rules/Azure.PostgreSQL.AADOnly/","title":"Entra ID only authentication with PostgreSQL databases","text":"Azure.PostgreSQL.AADOnlyAZR-000390Error <p> Security  \u00b7  Azure Database for PostgreSQL  \u00b7  Rule  \u00b7  2023_06  \u00b7  Important</p> <p>Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases.</p>","tags":["Azure.PostgreSQL.AADOnly","AZR-000390"]},{"location":"en/rules/Azure.PostgreSQL.AADOnly/#description","title":"Description","text":"<p>Azure Database for PostgreSQL supports authentication with PostgreSQL logins and Entra ID authentication.</p> <p>By default, authentication with PostgreSQL logins is enabled. PostgreSQL logins are unable to provide sufficient protection for identities. Entra ID authentication provides strong protection controls including conditional access, identity governance, and privileged identity management.</p> <p>Once you decide to use Entra ID authentication, you can disable authentication with PostgreSQL logins.</p> <p>Entra ID only authentication is only supported for the flexible server deployment model.</p>","tags":["Azure.PostgreSQL.AADOnly","AZR-000390"]},{"location":"en/rules/Azure.PostgreSQL.AADOnly/#recommendation","title":"Recommendation","text":"<p>Consider using Entra ID only authentication. Also consider using Azure Policy for Entra ID only authentication with Azure Database for PostgreSQL.</p>","tags":["Azure.PostgreSQL.AADOnly","AZR-000390"]},{"location":"en/rules/Azure.PostgreSQL.AADOnly/#examples","title":"Examples","text":"","tags":["Azure.PostgreSQL.AADOnly","AZR-000390"]},{"location":"en/rules/Azure.PostgreSQL.AADOnly/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Database for PostgreSQL flexible servers that pass this rule:</p> <ul> <li>Set the <code>properties.authConfig.activeDirectoryAuth</code> property to <code>Enabled</code>.</li> <li>Set the <code>properties.authConfig.passwordAuth</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforPostgreSQL/flexibleServers\",\n  \"apiVersion\": \"2022-12-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_D2ds_v4\",\n    \"tier\": \"GeneralPurpose\"\n  },\n  \"properties\": {\n    \"createMode\": \"Default\",\n    \"authConfig\": {\n      \"activeDirectoryAuth\": \"Enabled\",\n      \"passwordAuth\": \"Disabled\",\n      \"tenantId\": \"[tenant().tenantId]\"\n    },\n    \"version\": \"14\",\n    \"storage\": {\n      \"storageSizeGB\": 32\n    },\n    \"backup\": {\n      \"backupRetentionDays\": 7,\n      \"geoRedundantBackup\": \"Enabled\"\n    },\n    \"highAvailability\": {\n      \"mode\": \"ZoneRedundant\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.PostgreSQL.AADOnly","AZR-000390"]},{"location":"en/rules/Azure.PostgreSQL.AADOnly/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Database for PostgreSQL flexible servers that pass this rule:</p> <ul> <li>Set the <code>properties.authConfig.activeDirectoryAuth</code> property to <code>Enabled</code>.</li> <li>Set the <code>properties.authConfig.passwordAuth</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource flexible 'Microsoft.DBforPostgreSQL/flexibleServers@2022-12-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard_D2ds_v4'\n    tier: 'GeneralPurpose'\n  }\n  properties: {\n    createMode: 'Default'\n    authConfig: {\n      activeDirectoryAuth: 'Enabled'\n      passwordAuth: 'Disabled'\n      tenantId: tenant().tenantId\n    }\n    version: '14'\n    storage: {\n      storageSizeGB: 32\n    }\n    backup: {\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Enabled'\n    }\n    highAvailability: {\n      mode: 'ZoneRedundant'\n    }\n  }\n}\n</code></pre>","tags":["Azure.PostgreSQL.AADOnly","AZR-000390"]},{"location":"en/rules/Azure.PostgreSQL.AADOnly/#notes","title":"Notes","text":"<p>The Entra ID admin must be set before enabling Entra ID only authentication. Entra ID only authentication is only supported for the flexible server deployment model.</p>","tags":["Azure.PostgreSQL.AADOnly","AZR-000390"]},{"location":"en/rules/Azure.PostgreSQL.AADOnly/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>How Microsoft Entra ID Works in Azure Database for PostgreSQL flexible server</li> <li>Use Microsoft Entra ID for authentication with Azure Database for PostgreSQL - Flexible Server</li> <li>Use Microsoft Entra ID for authentication with PostgreSQL</li> <li>Microsoft Entra authentication (Azure Database for PostgreSQL single Server vs Azure Database for PostgreSQL flexible server)</li> <li>IM-1: Use centralized identity and authentication system</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.PostgreSQL.AADOnly","AZR-000390"]},{"location":"en/rules/Azure.PostgreSQL.AllowAzureAccess/","title":"Disable PostgreSQL Allow Azure access firewall rule","text":"Azure.PostgreSQL.AllowAzureAccessAZR-000150Error <p> Security  \u00b7  Azure Database for PostgreSQL  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Determine if access from Azure services is required.</p>","tags":["Azure.PostgreSQL.AllowAzureAccess","AZR-000150"]},{"location":"en/rules/Azure.PostgreSQL.AllowAzureAccess/#description","title":"Description","text":"<p>Allow access to Azure services, permits any Azure service including other Azure customers, network based-access to databases on the same PostgreSQL server instance. If network based access is permitted, authentication is still required.</p> <p>Enabling access from Azure Services is useful in certain cases for serverless PaaS workloads where configuring a stable IP address is not possible. For example Azure Functions, Container Instances and Logic Apps.</p>","tags":["Azure.PostgreSQL.AllowAzureAccess","AZR-000150"]},{"location":"en/rules/Azure.PostgreSQL.AllowAzureAccess/#recommendation","title":"Recommendation","text":"<p>Where a stable IP addresses are able to be configured, configure IP or virtual network based firewall rules instead of using Allow access to Azure services. Determine if access from Azure services is required for the services connecting to the hosted databases.</p>","tags":["Azure.PostgreSQL.AllowAzureAccess","AZR-000150"]},{"location":"en/rules/Azure.PostgreSQL.AllowAzureAccess/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Firewall rules in Azure Database for PostgreSQL</li> </ul>","tags":["Azure.PostgreSQL.AllowAzureAccess","AZR-000150"]},{"location":"en/rules/Azure.PostgreSQL.DefenderCloud/","title":"Use Microsoft Defender","text":"Azure.PostgreSQL.DefenderCloudAZR-000327Error <p> Security  \u00b7  Azure Database for PostgreSQL  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL.</p>","tags":["Azure.PostgreSQL.DefenderCloud","AZR-000327"]},{"location":"en/rules/Azure.PostgreSQL.DefenderCloud/#description","title":"Description","text":"<p>Defender for Cloud detects anomalous activities indicating unusual and potentially harmful attempts to access or exploit databases.</p>","tags":["Azure.PostgreSQL.DefenderCloud","AZR-000327"]},{"location":"en/rules/Azure.PostgreSQL.DefenderCloud/#recommendation","title":"Recommendation","text":"<p>Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL.</p>","tags":["Azure.PostgreSQL.DefenderCloud","AZR-000327"]},{"location":"en/rules/Azure.PostgreSQL.DefenderCloud/#examples","title":"Examples","text":"","tags":["Azure.PostgreSQL.DefenderCloud","AZR-000327"]},{"location":"en/rules/Azure.PostgreSQL.DefenderCloud/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Database for PostgreSQL Single Servers that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.DBforPostgreSQL/servers/securityAlertPolicies</code> sub-resource (child resource).</li> <li>Set the <code>properties.state</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforPostgreSQL/servers\",\n  \"apiVersion\": \"2017-12-01\",\n  \"name\": \"[parameters('serverName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"[parameters('skuName')]\",\n    \"tier\": \"GeneralPurpose\",\n    \"capacity\": \"[parameters('SkuCapacity')]\",\n    \"size\": \"[format('{0}', parameters('skuSizeMB'))]\",\n    \"family\": \"[parameters('skuFamily')]\"\n  },\n  \"properties\": {\n    \"createMode\": \"Default\",\n    \"version\": \"[parameters('postgresqlVersion')]\",\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"storageProfile\": {\n      \"storageMB\": \"[parameters('skuSizeMB')]\",\n      \"backupRetentionDays\": 7,\n      \"geoRedundantBackup\": \"Enabled\"\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.DBforPostgreSQL/servers/securityAlertPolicies\",\n      \"apiVersion\": \"2017-12-01\",\n      \"name\": \"Default\",\n      \"dependsOn\": [\"[parameters('serverName')]\"],\n      \"properties\": {\n        \"emailAccountAdmins\": true,\n        \"emailAddresses\": [\"soc@contoso.com\"],\n        \"retentionDays\": 14,\n        \"state\": \"Enabled\",\n        \"storageAccountAccessKey\": \"account-key\",\n        \"storageEndpoint\": \"https://contoso.blob.core.windows.net\"\n      }\n    }\n  ]\n}\n</code></pre>","tags":["Azure.PostgreSQL.DefenderCloud","AZR-000327"]},{"location":"en/rules/Azure.PostgreSQL.DefenderCloud/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Database for PostgreSQL Single Servers that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.DBforPostgreSQL/servers/securityAlertPolicies</code> sub-resource (child resource).</li> <li>Set the <code>properties.state</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource postgresqlDbServer 'Microsoft.DBforPostgreSQL/servers@2017-12-01' = {\n  name: serverName\n  location: location\n  sku: {\n    name: skuName\n    tier: 'GeneralPurpose'\n    capacity: skuCapacity\n    size: '${skuSizeMB}'\n    family: skuFamily\n  }\n  properties: {\n    createMode: 'Default'\n    version: postgresqlVersion\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    storageProfile: {\n      storageMB: SkuSizeMB\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Enabled'\n    }\n  }\n}\n\nresource postgresqlDefender 'Microsoft.DBforPostgreSQL/servers/securityAlertPolicies@2017-12-01' = {\n  name: 'Default'\n  parent: postgresqlDbServer\n  properties: {\n    emailAccountAdmins: true\n    emailAddresses: ['soc@contoso.com']\n    retentionDays: 14\n    state: 'Enabled'\n    storageAccountAccessKey: 'account-key'\n    storageEndpoint: 'https://contoso.blob.core.windows.net'\n  }\n}\n</code></pre>","tags":["Azure.PostgreSQL.DefenderCloud","AZR-000327"]},{"location":"en/rules/Azure.PostgreSQL.DefenderCloud/#notes","title":"Notes","text":"<p>This rule is only applicable for the Azure Database for PostgreSQL Single Server deployment model.</p> <p>Azure Database for PostgreSQL Flexible Server deployment model does not currently support Microsoft Defender for Cloud.</p>","tags":["Azure.PostgreSQL.DefenderCloud","AZR-000327"]},{"location":"en/rules/Azure.PostgreSQL.DefenderCloud/#links","title":"Links","text":"<ul> <li>Security operations</li> <li>Enable Microsoft Defender for open-source relational databases</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.PostgreSQL.DefenderCloud","AZR-000327"]},{"location":"en/rules/Azure.PostgreSQL.FirewallIPRange/","title":"Limit PostgreSQL server firewall rule range","text":"Azure.PostgreSQL.FirewallIPRangeAZR-000151Error <p> Security  \u00b7  Azure Database for PostgreSQL  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Determine if there is an excessive number of permitted IP addresses.</p>","tags":["Azure.PostgreSQL.FirewallIPRange","AZR-000151"]},{"location":"en/rules/Azure.PostgreSQL.FirewallIPRange/#description","title":"Description","text":"<p>Typically the number of IP address rules permitted through the firewall is minimal, with management connectivity from on-premises and cloud application connectivity the most common.</p>","tags":["Azure.PostgreSQL.FirewallIPRange","AZR-000151"]},{"location":"en/rules/Azure.PostgreSQL.FirewallIPRange/#recommendation","title":"Recommendation","text":"<p>The PostgreSQL server has greater then ten (10) public IP addresses that are permitted network access. Some rules may not be needed or can be reduced.</p>","tags":["Azure.PostgreSQL.FirewallIPRange","AZR-000151"]},{"location":"en/rules/Azure.PostgreSQL.FirewallIPRange/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Firewall rules in Azure Database for PostgreSQL - Single Server</li> <li>Create and manage firewall rules for Azure Database for PostgreSQL - Single Server using the Azure portal</li> </ul>","tags":["Azure.PostgreSQL.FirewallIPRange","AZR-000151"]},{"location":"en/rules/Azure.PostgreSQL.FirewallRuleCount/","title":"Cleanup PostgreSQL server firewall rules","text":"Azure.PostgreSQL.FirewallRuleCountAZR-000149Error <p> Security  \u00b7  Azure Database for PostgreSQL  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Determine if there is an excessive number of firewall rules.</p>","tags":["Azure.PostgreSQL.FirewallRuleCount","AZR-000149"]},{"location":"en/rules/Azure.PostgreSQL.FirewallRuleCount/#description","title":"Description","text":"<p>Typically the number of firewall rules required is minimal, with management connectivity from on-premises and cloud application connectivity the most common.</p>","tags":["Azure.PostgreSQL.FirewallRuleCount","AZR-000149"]},{"location":"en/rules/Azure.PostgreSQL.FirewallRuleCount/#recommendation","title":"Recommendation","text":"<p>The PostgreSQL server has greater then ten (10) firewall rules. Some rules may not be needed.</p>","tags":["Azure.PostgreSQL.FirewallRuleCount","AZR-000149"]},{"location":"en/rules/Azure.PostgreSQL.FirewallRuleCount/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Firewall rules in Azure Database for PostgreSQL - Single Server</li> <li>Create and manage firewall rules for Azure Database for PostgreSQL - Single Server using the Azure portal</li> </ul>","tags":["Azure.PostgreSQL.FirewallRuleCount","AZR-000149"]},{"location":"en/rules/Azure.PostgreSQL.GeoRedundantBackup/","title":"Configure geo-redundant backup","text":"Azure.PostgreSQL.GeoRedundantBackupAZR-000326Error <p> Reliability  \u00b7  Azure Database for PostgreSQL  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Azure Database for PostgreSQL should store backups in a geo-redundant storage.</p>","tags":["Azure.PostgreSQL.GeoRedundantBackup","AZR-000326"]},{"location":"en/rules/Azure.PostgreSQL.GeoRedundantBackup/#description","title":"Description","text":"<p>Geo-redundant backup helps to protect your Azure Database for PostgreSQL Servers against outages impacting backup storage in the primary region and allows you to restore your server to the geo-paired region in the event of a disaster.</p> <p>When the backups are stored in geo-redundant backup storage, they are not only stored within the region in which your server is hosted, but are also replicated to a paired data center. Both the Azure Database for PostgreSQL Flexible Server and the Azure Database for PostgreSQL Single Server deployment model supports geo-redundant backup.</p> <p>For the flexible deployment model the geo-redundant backup is supported for all tiers, but for the single deployment model either <code>General Purpose</code> or <code>Memory Optimized</code> tier is required.</p> <p>Check out the <code>NOTES</code> and the <code>LINKS</code> section for more details about geo-redundant backup for each of the deployment models.</p>","tags":["Azure.PostgreSQL.GeoRedundantBackup","AZR-000326"]},{"location":"en/rules/Azure.PostgreSQL.GeoRedundantBackup/#recommendation","title":"Recommendation","text":"<p>Configure geo-redundant backup for Azure Database for PostgreSQL.</p>","tags":["Azure.PostgreSQL.GeoRedundantBackup","AZR-000326"]},{"location":"en/rules/Azure.PostgreSQL.GeoRedundantBackup/#examples","title":"Examples","text":"","tags":["Azure.PostgreSQL.GeoRedundantBackup","AZR-000326"]},{"location":"en/rules/Azure.PostgreSQL.GeoRedundantBackup/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Azure Database for PostgreSQL Flexible Servers that pass this rule:</p> <ul> <li>Set the <code>properties.backup.geoRedundantBackup</code> property to the value <code>'Enabled'</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforPostgreSQL/flexibleServers\",\n  \"apiVersion\": \"2022-01-20-preview\",\n  \"name\": \"[parameters('serverName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_D16as\",\n    \"tier\": \"GeneralPurpose\"\n  },\n  \"properties\": {\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"storage\": {\n      \"storageSizeGB\": \"[parameters('StorageSizeGB')]\"\n    },\n    \"createMode\": \"Default\",\n    \"version\": \"[parameters('postgresqlVersion')]\",\n    \"backup\": {\n      \"backupRetentionDays\": 7,\n      \"geoRedundantBackup\": \"Enabled\"\n    },\n    \"highAvailability\": {\n      \"mode\": \"Disabled\"\n    }\n  }\n}\n</code></pre> <p>To deploy Azure Database for PostgreSQL Single Servers that pass this rule:</p> <ul> <li>Set the <code>properties.storageProfile.geoRedundantBackup</code> property to the value <code>'Enabled'</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforPostgreSQL/servers\",\n  \"apiVersion\": \"2017-12-01\",\n  \"name\": \"[parameters('serverName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"[parameters('skuName')]\",\n    \"tier\": \"GeneralPurpose\",\n    \"capacity\": \"[parameters('SkuCapacity')]\",\n    \"size\": \"[format('{0}', parameters('skuSizeMB'))]\",\n    \"family\": \"[parameters('skuFamily')]\"\n  },\n  \"properties\": {\n    \"createMode\": \"Default\",\n    \"version\": \"[parameters('postgresqlVersion')]\",\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"storageProfile\": {\n      \"storageMB\": \"[parameters('skuSizeMB')]\",\n      \"backupRetentionDays\": 7,\n      \"geoRedundantBackup\": \"Enabled\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.PostgreSQL.GeoRedundantBackup","AZR-000326"]},{"location":"en/rules/Azure.PostgreSQL.GeoRedundantBackup/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Azure Database for PostgreSQL Flexible Servers that pass this rule:</p> <ul> <li>Set the <code>properties.backup.geoRedundantBackup</code> property to the value <code>'Enabled'</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource postgresqlDbServer 'Microsoft.DBforPostgreSQL/flexibleServers@2022-01-20-preview' = {\n  name: serverName\n  location: location\n  sku: {\n    name: 'Standard_D16as'\n    tier: 'GeneralPurpose'\n  }\n  properties: {\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    storage: {\n      storageSizeGB: StorageSizeGB\n    }\n    createMode: 'Default'\n    version: postgresqlVersion\n    backup: {\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Enabled'\n    }\n    highAvailability: {\n      mode: 'Disabled'\n    }\n  }\n}\n</code></pre> <p>To deploy Azure Database for PostgreSQL Single Servers that pass this rule:</p> <ul> <li>Set the <code>properties.storageProfile.geoRedundantBackup</code> property to the value <code>'Enabled'</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource postgresqlDbServer 'Microsoft.DBforPostgreSQL/servers@2017-12-01' = {\n  name: serverName\n  location: location\n  sku: {\n    name: skuName\n    tier: 'GeneralPurpose'\n    capacity: skuCapacity\n    size: '${skuSizeMB}'\n    family: skuFamily\n  }\n  properties: {\n    createMode: 'Default'\n    version: postgresqlVersion\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    storageProfile: {\n      storageMB: SkuSizeMB\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Enabled'\n    }\n  }\n}\n</code></pre>","tags":["Azure.PostgreSQL.GeoRedundantBackup","AZR-000326"]},{"location":"en/rules/Azure.PostgreSQL.GeoRedundantBackup/#notes","title":"Notes","text":"<p>This rule is applicable for both the Azure Database for PostgreSQL Flexible Server deployment model and the Azure Database for PostgreSQL Single Server deployment model.</p> <p>For the Single Server deployment model, it runs only against <code>'General Purpose'</code> and <code>'Memory Optimized'</code> tiers. The <code>'Basic'</code> tier does not support geo-redundant backup storage.</p>","tags":["Azure.PostgreSQL.GeoRedundantBackup","AZR-000326"]},{"location":"en/rules/Azure.PostgreSQL.GeoRedundantBackup/#links","title":"Links","text":"<ul> <li>Target and non-functional requirements</li> <li>Backup and restore in Azure Database for PostgreSQL flexible servers</li> <li>Backup and restore in Azure Database for PostgreSQL single servers</li> <li>Azure deployment reference flexible servers</li> <li>Azure deployment reference single servers</li> </ul>","tags":["Azure.PostgreSQL.GeoRedundantBackup","AZR-000326"]},{"location":"en/rules/Azure.PostgreSQL.MaintenanceWindow/","title":"Customer-controlled maintenance window configuration","text":"Azure.PostgreSQL.MaintenanceWindowAZR-000433Error <p> Reliability  \u00b7  Azure Database for PostgreSQL  \u00b7  Rule  \u00b7  2024_06  \u00b7  Important</p> <p>Configure a customer-controlled maintenance window for Azure Database for PostgreSQL servers.</p>","tags":["Azure.PostgreSQL.MaintenanceWindow","AZR-000433"]},{"location":"en/rules/Azure.PostgreSQL.MaintenanceWindow/#description","title":"Description","text":"<p>Azure Database for PostgreSQL flexible servers undergo periodic maintenance to ensure your managed database remains secure, stable, and up-to-date. This maintenance includes applying security updates, system upgrades, and software patches.</p> <p>Maintenance windows can be scheduled in two ways for each flexible server:</p> <ul> <li>System-Managed Schedule: The system automatically selects a one-hour window between 11 PM and 7 AM in your server\u2019s regional time.</li> <li>Custom Schedule: You can specify a preferred maintenance window by choosing the day of the week and a one-hour time window.</li> </ul> <p>By configuring a customer-controlled maintenance window, you can schedule updates to occur during a preferred time, ideally outside business hours, minimizing disruptions.</p> <p>Only the flexible server deployment model supports customer-controlled maintenance windows.</p>","tags":["Azure.PostgreSQL.MaintenanceWindow","AZR-000433"]},{"location":"en/rules/Azure.PostgreSQL.MaintenanceWindow/#recommendation","title":"Recommendation","text":"<p>Consider using a customer-controlled maintenance window to efficiently schedule updates and minimize disruptions.</p>","tags":["Azure.PostgreSQL.MaintenanceWindow","AZR-000433"]},{"location":"en/rules/Azure.PostgreSQL.MaintenanceWindow/#examples","title":"Examples","text":"","tags":["Azure.PostgreSQL.MaintenanceWindow","AZR-000433"]},{"location":"en/rules/Azure.PostgreSQL.MaintenanceWindow/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure servers that pass this rule:</p> <ul> <li>Set the <code>properties.maintenanceWindow.customWindow</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforPostgreSQL/flexibleServers\",\n  \"apiVersion\": \"2023-03-01-preview\",\n  \"name\": \"[parameters('serverName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_D16as\",\n    \"tier\": \"GeneralPurpose\"\n  },\n  \"properties\": {\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"createMode\": \"Default\",\n    \"version\": \"[parameters('postgresqlVersion')]\",\n    \"maintenanceWindow\": {\n      \"customWindow\": \"Enabled\",\n      \"dayOfWeek\": \"0\",\n      \"startHour\": \"1\",\n      \"startMinute\": \"0\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.PostgreSQL.MaintenanceWindow","AZR-000433"]},{"location":"en/rules/Azure.PostgreSQL.MaintenanceWindow/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure servers that pass this rule:</p> <ul> <li>Set the <code>properties.maintenanceWindow.customWindow</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource postgresqlDbServer 'Microsoft.DBforPostgreSQL/flexibleServers@2023-03-01-preview' = {\n  name: serverName\n  location: location\n  sku: {\n    name: 'Standard_D16as'\n    tier: 'GeneralPurpose'\n  }\n  properties: {\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    createMode: 'Default'\n    version: postgresqlVersion\n     maintenanceWindow: {\n      customWindow: 'Enabled'\n      dayOfWeek: 0\n      startHour: 1\n      startMinute: 0\n    }\n  }\n}\n</code></pre>","tags":["Azure.PostgreSQL.MaintenanceWindow","AZR-000433"]},{"location":"en/rules/Azure.PostgreSQL.MaintenanceWindow/#notes","title":"Notes","text":"<p>The custom schedule maintenance window feature is only available for the flexible server deployment model.</p>","tags":["Azure.PostgreSQL.MaintenanceWindow","AZR-000433"]},{"location":"en/rules/Azure.PostgreSQL.MaintenanceWindow/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Scheduled maintenance in Azure Database for PostgreSQL</li> <li>Select a maintenance window</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.PostgreSQL.MaintenanceWindow","AZR-000433"]},{"location":"en/rules/Azure.PostgreSQL.MinTLS/","title":"PostgreSQL DB server minimum TLS version","text":"Azure.PostgreSQL.MinTLSAZR-000148Error <p> Security  \u00b7  Azure Database for PostgreSQL  \u00b7  Rule  \u00b7  2020_09  \u00b7  Critical</p> <p>PostgreSQL DB servers should reject TLS versions older than 1.2.</p>","tags":["Azure.PostgreSQL.MinTLS","AZR-000148"]},{"location":"en/rules/Azure.PostgreSQL.MinTLS/#description","title":"Description","text":"<p>The minimum version of TLS that PostgreSQL DB servers accept is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS.</p> <p>Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted.</p>","tags":["Azure.PostgreSQL.MinTLS","AZR-000148"]},{"location":"en/rules/Azure.PostgreSQL.MinTLS/#recommendation","title":"Recommendation","text":"<p>Consider configuring the minimum supported TLS version to be 1.2.</p>","tags":["Azure.PostgreSQL.MinTLS","AZR-000148"]},{"location":"en/rules/Azure.PostgreSQL.MinTLS/#examples","title":"Examples","text":"","tags":["Azure.PostgreSQL.MinTLS","AZR-000148"]},{"location":"en/rules/Azure.PostgreSQL.MinTLS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy servers that pass this rule:</p> <ul> <li>Set the <code>properties.minimalTlsVersion</code> property to <code>TLS1_2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforPostgreSQL/servers\",\n  \"apiVersion\": \"2017-12-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"createMode\": \"Default\",\n    \"administratorLogin\": \"[parameters('localAdministrator')]\",\n    \"administratorLoginPassword\": \"[parameters('localAdministratorPassword')]\",\n    \"minimalTlsVersion\": \"TLS1_2\",\n    \"sslEnforcement\": \"Enabled\",\n    \"publicNetworkAccess\": \"Disabled\",\n    \"version\": \"11\"\n  }\n}\n</code></pre>","tags":["Azure.PostgreSQL.MinTLS","AZR-000148"]},{"location":"en/rules/Azure.PostgreSQL.MinTLS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy servers that pass this rule:</p> <ul> <li>Set the <code>properties.minimalTlsVersion</code> property to <code>TLS1_2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource single 'Microsoft.DBforPostgreSQL/servers@2017-12-01' = {\n  name: name\n  location: location\n  properties: {\n    createMode: 'Default'\n    administratorLogin: localAdministrator\n    administratorLoginPassword: localAdministratorPassword\n    minimalTlsVersion: 'TLS1_2'\n    sslEnforcement: 'Enabled'\n    publicNetworkAccess: 'Disabled'\n    version: '11'\n  }\n}\n</code></pre>","tags":["Azure.PostgreSQL.MinTLS","AZR-000148"]},{"location":"en/rules/Azure.PostgreSQL.MinTLS/#notes","title":"Notes","text":"<p>This rule is not applicable to PostgreSQL using the flexible server model.</p>","tags":["Azure.PostgreSQL.MinTLS","AZR-000148"]},{"location":"en/rules/Azure.PostgreSQL.MinTLS/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>TLS enforcement in Azure Database for PostgreSQL Single server</li> <li>Set TLS configurations for Azure Database for PostgreSQL - Single server</li> <li>Preparing for TLS 1.2 in Microsoft Azure</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.PostgreSQL.MinTLS","AZR-000148"]},{"location":"en/rules/Azure.PostgreSQL.ServerName/","title":"Use valid PostgreSQL DB server names","text":"Azure.PostgreSQL.ServerNameAZR-000152Error <p> Operational Excellence  \u00b7  Azure Database for PostgreSQL  \u00b7  Rule  \u00b7  2020_12  \u00b7  Awareness</p> <p>Azure PostgreSQL DB server names should meet naming requirements.</p>","tags":["Azure.PostgreSQL.ServerName","AZR-000152"]},{"location":"en/rules/Azure.PostgreSQL.ServerName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for PostgreSQL DB server names are:</p> <ul> <li>Between 3 and 63 characters long.</li> <li>Lowercase letters, numbers, and hyphens.</li> <li>Can't start or end with a hyphen.</li> <li>PostgreSQL DB server names must be globally unique.</li> </ul>","tags":["Azure.PostgreSQL.ServerName","AZR-000152"]},{"location":"en/rules/Azure.PostgreSQL.ServerName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Azure PostgreSQL DB server naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.PostgreSQL.ServerName","AZR-000152"]},{"location":"en/rules/Azure.PostgreSQL.ServerName/#notes","title":"Notes","text":"<p>This rule does not check if Azure PostgreSQL DB server names are unique.</p>","tags":["Azure.PostgreSQL.ServerName","AZR-000152"]},{"location":"en/rules/Azure.PostgreSQL.ServerName/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> </ul>","tags":["Azure.PostgreSQL.ServerName","AZR-000152"]},{"location":"en/rules/Azure.PostgreSQL.UseSSL/","title":"Enforce encrypted PostgreSQL connections","text":"Azure.PostgreSQL.UseSSLAZR-000147Error <p> Security  \u00b7  Azure Database for PostgreSQL  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Enforce encrypted PostgreSQL connections.</p>","tags":["Azure.PostgreSQL.UseSSL","AZR-000147"]},{"location":"en/rules/Azure.PostgreSQL.UseSSL/#description","title":"Description","text":"<p>Azure Database for PostgreSQL is configured to only accept encrypted connections by default. When the setting enforce SSL connections is disabled, encrypted and unencrypted connections are permitted. This does not indicate that unencrypted connections are being used.</p> <p>Unencrypted communication to PostgreSQL server instances could allow disclosure of information to an untrusted party.</p>","tags":["Azure.PostgreSQL.UseSSL","AZR-000147"]},{"location":"en/rules/Azure.PostgreSQL.UseSSL/#recommendation","title":"Recommendation","text":"<p>Azure Database for PostgreSQL should be configured to only accept encrypted connections. Unless explicitly required, consider enabling enforce SSL connections.</p> <p>Also consider using Azure Policy to audit or enforce this configuration.</p>","tags":["Azure.PostgreSQL.UseSSL","AZR-000147"]},{"location":"en/rules/Azure.PostgreSQL.UseSSL/#examples","title":"Examples","text":"","tags":["Azure.PostgreSQL.UseSSL","AZR-000147"]},{"location":"en/rules/Azure.PostgreSQL.UseSSL/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy servers that pass this rule:</p> <ul> <li>Set the <code>properties.sslEnforcement</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforPostgreSQL/servers\",\n  \"apiVersion\": \"2017-12-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"createMode\": \"Default\",\n    \"administratorLogin\": \"[parameters('localAdministrator')]\",\n    \"administratorLoginPassword\": \"[parameters('localAdministratorPassword')]\",\n    \"minimalTlsVersion\": \"TLS1_2\",\n    \"sslEnforcement\": \"Enabled\",\n    \"publicNetworkAccess\": \"Disabled\",\n    \"version\": \"11\"\n  }\n}\n</code></pre>","tags":["Azure.PostgreSQL.UseSSL","AZR-000147"]},{"location":"en/rules/Azure.PostgreSQL.UseSSL/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy servers that pass this rule:</p> <ul> <li>Set the <code>properties.sslEnforcement</code> property to <code>Enabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource single 'Microsoft.DBforPostgreSQL/servers@2017-12-01' = {\n  name: name\n  location: location\n  properties: {\n    createMode: 'Default'\n    administratorLogin: localAdministrator\n    administratorLoginPassword: localAdministratorPassword\n    minimalTlsVersion: 'TLS1_2'\n    sslEnforcement: 'Enabled'\n    publicNetworkAccess: 'Disabled'\n    version: '11'\n  }\n}\n</code></pre>","tags":["Azure.PostgreSQL.UseSSL","AZR-000147"]},{"location":"en/rules/Azure.PostgreSQL.UseSSL/#notes","title":"Notes","text":"<p>This rule is not applicable to PostgreSQL using the flexible server model.</p>","tags":["Azure.PostgreSQL.UseSSL","AZR-000147"]},{"location":"en/rules/Azure.PostgreSQL.UseSSL/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Configure SSL connectivity in Azure Database for PostgreSQL</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.PostgreSQL.UseSSL","AZR-000147"]},{"location":"en/rules/Azure.PostgreSQL.ZoneRedundantHA/","title":"Zone-Redundant High Availability","text":"Azure.PostgreSQL.ZoneRedundantHAAZR-000434Error <p> Reliability  \u00b7  Azure Database for PostgreSQL  \u00b7  Rule  \u00b7  2024_09  \u00b7  Important</p> <p>Deploy Azure Database for PostgreSQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience.</p>","tags":["Azure.PostgreSQL.ZoneRedundantHA","AZR-000434"]},{"location":"en/rules/Azure.PostgreSQL.ZoneRedundantHA/#description","title":"Description","text":"<p>Azure Database for PostgreSQL flexible servers allows configuration high availability (HA) across availability zones in supported regions. Using availability zones improves resiliency of your solution to failures or disruptions isolated to a zone or data center.</p> <p>Zone-redundant HA works by:</p> <ul> <li>Deploying two servers; a primary in one zone, and a secondary in a physically separate zone.</li> <li>Daily Data Backups: Performed from the primary server and stored using zone-redundant backup storage.</li> <li>Transaction Logs: Continuously archived in zone-redundant backup storage from the standby replica.</li> </ul> <p>The failover process ensures continuous operation by switching from the primary server to the standby replica server. This process can be:</p> <ul> <li>Manual (Planned) Failover: Initiated by the user for maintenance or other operational reasons.</li> <li>Automatic (Unplanned) Failover: Triggered by Azure in response to failures such as hardware or network issues affecting the primary server.</li> </ul> <p>Before opting for the zone-redundant HA model, review the documentation for additional limitations and critical information. This includes understanding the latency impact between zones, cost implications, and any specific regional support constraints.</p>","tags":["Azure.PostgreSQL.ZoneRedundantHA","AZR-000434"]},{"location":"en/rules/Azure.PostgreSQL.ZoneRedundantHA/#recommendation","title":"Recommendation","text":"<p>Consider deploying flexible servers using zone-redundant high-availability to improve the resiliency of your databases.</p>","tags":["Azure.PostgreSQL.ZoneRedundantHA","AZR-000434"]},{"location":"en/rules/Azure.PostgreSQL.ZoneRedundantHA/#examples","title":"Examples","text":"","tags":["Azure.PostgreSQL.ZoneRedundantHA","AZR-000434"]},{"location":"en/rules/Azure.PostgreSQL.ZoneRedundantHA/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure servers that pass this rule:</p> <ul> <li>Set the <code>properties.highAvailability.mode</code> property to <code>ZoneRedundant</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.DBforPostgreSQL/flexibleServers\",\n  \"apiVersion\": \"2023-03-01-preview\",\n  \"name\": \"[parameters('serverName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_D16as\",\n    \"tier\": \"GeneralPurpose\"\n  },\n  \"properties\": {\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"createMode\": \"Default\",\n    \"version\": \"[parameters('postgresqlVersion')]\",\n    \"availabilityZone\": \"1\",\n    \"highAvailability\": {\n      \"mode\": \"ZoneRedundant\",\n      \"standbyAvailabilityZone\": \"2\"\n     }\n  }\n}\n</code></pre>","tags":["Azure.PostgreSQL.ZoneRedundantHA","AZR-000434"]},{"location":"en/rules/Azure.PostgreSQL.ZoneRedundantHA/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure servers that pass this rule:</p> <ul> <li>Set the <code>properties.highAvailability.mode</code> property to <code>ZoneRedundant</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource postgresqlDbServer 'Microsoft.DBforPostgreSQL/flexibleServers@2023-03-01-preview' = {\n  name: serverName\n  location: location\n  sku: {\n    name: 'Standard_D16as'\n    tier: 'GeneralPurpose'\n  }\n  properties: {\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    createMode: 'Default'\n    version: postgresqlVersion\n    availabilityZone: 1\n    highAvailability: {\n      mode: 'ZoneRedundant'\n      standbyAvailabilityZone: 2\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/db-for-postgre-sql/flexible-server:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/db-for-postgre-sql/flexible-server:0.6.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.PostgreSQL.ZoneRedundantHA","AZR-000434"]},{"location":"en/rules/Azure.PostgreSQL.ZoneRedundantHA/#notes","title":"Notes","text":"<p>The <code>Burstable</code> SKU tier is not supported.</p> <p>The zone-redundancy HA model is only available in regions that support availability zones.</p>","tags":["Azure.PostgreSQL.ZoneRedundantHA","AZR-000434"]},{"location":"en/rules/Azure.PostgreSQL.ZoneRedundantHA/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>High availability concepts in Azure Database for PostgreSQL</li> <li>Zone-redundant HA architecture</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.PostgreSQL.ZoneRedundantHA","AZR-000434"]},{"location":"en/rules/Azure.PrivateEndpoint.Name/","title":"Use valid Private Endpoint names","text":"Azure.PrivateEndpoint.NameAZR-000153Error <p> Operational Excellence  \u00b7  Private Endpoint  \u00b7  Rule  \u00b7  2021_12  \u00b7  Awareness</p> <p>Private Endpoint names should meet naming requirements.</p>","tags":["Azure.PrivateEndpoint.Name","AZR-000153"]},{"location":"en/rules/Azure.PrivateEndpoint.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Private Endpoint names are:</p> <ul> <li>Between 2 and 64 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>Private Endpoint names must be unique within a resource group.</li> </ul>","tags":["Azure.PrivateEndpoint.Name","AZR-000153"]},{"location":"en/rules/Azure.PrivateEndpoint.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Private Endpoint naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.PrivateEndpoint.Name","AZR-000153"]},{"location":"en/rules/Azure.PrivateEndpoint.Name/#notes","title":"Notes","text":"<p>This rule does not check if Private Endpoint names are unique.</p>","tags":["Azure.PrivateEndpoint.Name","AZR-000153"]},{"location":"en/rules/Azure.PrivateEndpoint.Name/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> <li>Recommended abbreviations for Azure resource types</li> </ul>","tags":["Azure.PrivateEndpoint.Name","AZR-000153"]},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/","title":"Public IP addresses should use availability zones","text":"Azure.PublicIP.AvailabilityZoneAZR-000157Error <p> Reliability  \u00b7  Public IP address  \u00b7  Rule  \u00b7  2021_12  \u00b7  Important</p> <p>Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability.</p>","tags":["Azure.PublicIP.AvailabilityZone","AZR-000157"]},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/#description","title":"Description","text":"<p>Public IP addresses using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. A zone redundant Public IP address can spread across multiple availability zones, which ensures the Public IP address will continue running even if another zone has gone down. Furthermore, this ensures Public Standard Load balancer frontend IPs using a zone-redundant Public IP address can survive zone failure.</p>","tags":["Azure.PublicIP.AvailabilityZone","AZR-000157"]},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/#recommendation","title":"Recommendation","text":"<p>Consider using zone-redundant Public IP addresses deployed with Standard SKU.</p>","tags":["Azure.PublicIP.AvailabilityZone","AZR-000157"]},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/#examples","title":"Examples","text":"","tags":["Azure.PublicIP.AvailabilityZone","AZR-000157"]},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure zone-redundancy for a Public IP address.</p> <ul> <li>Set <code>sku.name</code> to <code>Standard</code>.</li> <li>Set <code>zones</code> to <code>[\"1\", \"2\", \"3\"]</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/publicIPAddresses\",\n  \"apiVersion\": \"2023-05-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard\",\n    \"tier\": \"Regional\"\n  },\n  \"properties\": {\n    \"publicIPAddressVersion\": \"IPv4\",\n    \"publicIPAllocationMethod\": \"Static\",\n    \"idleTimeoutInMinutes\": 4\n  },\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ]\n}\n</code></pre>","tags":["Azure.PublicIP.AvailabilityZone","AZR-000157"]},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure zone-redundancy for a Public IP address.</p> <ul> <li>Set <code>sku.name</code> to <code>Standard</code>.</li> <li>Set <code>zones</code> to <code>['1', '2', '3']</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource pip 'Microsoft.Network/publicIPAddresses@2023-05-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard'\n    tier: 'Regional'\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n    idleTimeoutInMinutes: 4\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n}\n</code></pre>","tags":["Azure.PublicIP.AvailabilityZone","AZR-000157"]},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/#notes","title":"Notes","text":"<p>This rule is not applicable for public IP addresses used for Azure Bastion. Azure Bastion does not currently support Availability Zones. Public IP addresses with the following tags are automatically excluded from this rule:</p> <ul> <li><code>resource-usage</code> tag set to <code>azure-bastion</code>.</li> </ul> <p>This rule fails when <code>\"zones\"</code> is constrained to a single(zonal) zone, or set to <code>null</code>, <code>[]</code> when there are supported availability zones for the given region.</p> <p>This rule passes if no zones exist for a given region or <code>\"zones\"</code> is set to <code>[\"1\", \"2\", \"3\"]</code>.</p> <p>Configure <code>AZURE_PUBLICIP_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST</code> to set additional availability zones that need to be supported which are not in the existing providers for namespace <code>Microsoft.Network</code> and resource type <code>publicIpAddresses</code>.</p> <pre><code># YAML: The default AZURE_PUBLICIP_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option\nconfiguration:\n  AZURE_PUBLICIP_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST: []\n</code></pre>","tags":["Azure.PublicIP.AvailabilityZone","AZR-000157"]},{"location":"en/rules/Azure.PublicIP.AvailabilityZone/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>Reliability in Load Balancer</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.PublicIP.AvailabilityZone","AZR-000157"]},{"location":"en/rules/Azure.PublicIP.DNSLabel/","title":"Use valid Public IP DNS labels","text":"Azure.PublicIP.DNSLabelAZR-000156Error <p> Operational Excellence  \u00b7  Public IP address  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Public IP domain name labels should meet naming requirements.</p>","tags":["Azure.PublicIP.DNSLabel","AZR-000156"]},{"location":"en/rules/Azure.PublicIP.DNSLabel/#description","title":"Description","text":"<p>When configuring Azure Public IP addresses domain name labels must meet naming requirements. The requirements for Public IP domain name labels are:</p> <ul> <li>Between 3 and 63 characters long.</li> <li>Lowercase letters, numbers, and hyphens.</li> <li>Start with a letter.</li> <li>End a letter or number.</li> <li>Domain name labels must be globally unique within a region.</li> </ul>","tags":["Azure.PublicIP.DNSLabel","AZR-000156"]},{"location":"en/rules/Azure.PublicIP.DNSLabel/#recommendation","title":"Recommendation","text":"<p>Consider using domain name labels that meet Public IP naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.PublicIP.DNSLabel","AZR-000156"]},{"location":"en/rules/Azure.PublicIP.DNSLabel/#notes","title":"Notes","text":"<p>This rule does not check if Public IP domain name labels are unique.</p>","tags":["Azure.PublicIP.DNSLabel","AZR-000156"]},{"location":"en/rules/Azure.PublicIP.DNSLabel/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.PublicIP.DNSLabel","AZR-000156"]},{"location":"en/rules/Azure.PublicIP.IsAttached/","title":"Remove unused Public IP addresses","text":"Azure.PublicIP.IsAttachedAZR-000154Error <p> Cost Optimization  \u00b7  Public IP address  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Public IP addresses should be attached or cleaned up if not in use.</p>","tags":["Azure.PublicIP.IsAttached","AZR-000154"]},{"location":"en/rules/Azure.PublicIP.IsAttached/#description","title":"Description","text":"<p>Unattached static Public IP address are charged when not in use.</p>","tags":["Azure.PublicIP.IsAttached","AZR-000154"]},{"location":"en/rules/Azure.PublicIP.IsAttached/#recommendation","title":"Recommendation","text":"<p>Consider removing Public IP addresses that are no used.</p>","tags":["Azure.PublicIP.IsAttached","AZR-000154"]},{"location":"en/rules/Azure.PublicIP.IsAttached/#notes","title":"Notes","text":"<p>This rule applies when analyzing public IP addresses (in-flight) running within Azure.</p>","tags":["Azure.PublicIP.IsAttached","AZR-000154"]},{"location":"en/rules/Azure.PublicIP.IsAttached/#links","title":"Links","text":"<ul> <li>CO:14 Consolidation</li> <li>Design review checklist for Cost Optimization</li> <li>Public IP address pricing</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.PublicIP.IsAttached","AZR-000154"]},{"location":"en/rules/Azure.PublicIP.MigrateStandard/","title":"Migrate to Standard SKU","text":"Azure.PublicIP.MigrateStandardAZR-000395Error <p> Operational Excellence  \u00b7  Public IP address  \u00b7  Rule  \u00b7  2023_09  \u00b7  Important</p> <p>Use the Standard SKU for Public IP addresses as the Basic SKU will be retired.</p>","tags":["Azure.PublicIP.MigrateStandard","AZR-000395"]},{"location":"en/rules/Azure.PublicIP.MigrateStandard/#description","title":"Description","text":"<p>The Basic SKU for Public IP addresses will be retired on September 30, 2025. To avoid service disruption, migrate to Standard SKU for Public IP addresses.</p> <p>The Standard SKU additionally offers security by default and supports redundancy.</p>","tags":["Azure.PublicIP.MigrateStandard","AZR-000395"]},{"location":"en/rules/Azure.PublicIP.MigrateStandard/#recommendation","title":"Recommendation","text":"<p>Migrate Basic SKU for Public IP addresses to the Standard SKU before retirement to avoid service disruption.</p>","tags":["Azure.PublicIP.MigrateStandard","AZR-000395"]},{"location":"en/rules/Azure.PublicIP.MigrateStandard/#examples","title":"Examples","text":"","tags":["Azure.PublicIP.MigrateStandard","AZR-000395"]},{"location":"en/rules/Azure.PublicIP.MigrateStandard/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Public IP addresses that pass this rule:</p> <ul> <li>Set <code>sku.name</code> to <code>Standard</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/publicIPAddresses\",\n  \"apiVersion\": \"2023-05-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard\",\n    \"tier\": \"Regional\"\n  },\n  \"properties\": {\n    \"publicIPAddressVersion\": \"IPv4\",\n    \"publicIPAllocationMethod\": \"Static\",\n    \"idleTimeoutInMinutes\": 4\n  },\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ]\n}\n</code></pre>","tags":["Azure.PublicIP.MigrateStandard","AZR-000395"]},{"location":"en/rules/Azure.PublicIP.MigrateStandard/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Public IP addresses that pass this rule:</p> <ul> <li>Set <code>sku.name</code> to <code>Standard</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource pip 'Microsoft.Network/publicIPAddresses@2023-05-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard'\n    tier: 'Regional'\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n    idleTimeoutInMinutes: 4\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n}\n</code></pre>","tags":["Azure.PublicIP.MigrateStandard","AZR-000395"]},{"location":"en/rules/Azure.PublicIP.MigrateStandard/#links","title":"Links","text":"<ul> <li>Infrastructure provisioning</li> <li>Basic SKU will be retired</li> <li>Migrate a Basic SKU Public IP address to Standard SKU</li> <li>Standard vs Basic SKU comparison</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.PublicIP.MigrateStandard","AZR-000395"]},{"location":"en/rules/Azure.PublicIP.Name/","title":"Use valid Public IP names","text":"Azure.PublicIP.NameAZR-000155Error <p> Operational Excellence  \u00b7  Public IP address  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Public IP names should meet naming requirements.</p>","tags":["Azure.PublicIP.Name","AZR-000155"]},{"location":"en/rules/Azure.PublicIP.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Public IP names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>Public IP names must be unique within a resource group.</li> </ul>","tags":["Azure.PublicIP.Name","AZR-000155"]},{"location":"en/rules/Azure.PublicIP.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Public IP naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.PublicIP.Name","AZR-000155"]},{"location":"en/rules/Azure.PublicIP.Name/#examples","title":"Examples","text":"","tags":["Azure.PublicIP.Name","AZR-000155"]},{"location":"en/rules/Azure.PublicIP.Name/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy public IPs that pass this rule, consider:</p> <ul> <li>Configuring a <code>minLength</code> and <code>maxLength</code> constraint for the resource name parameter.</li> <li>Optionally, you could also use a <code>uniqueString()</code> function to generate a unique name.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"name\": {\n      \"type\": \"string\",\n      \"minLength\": 1,\n      \"maxLength\": 80,\n      \"metadata\": {\n        \"description\": \"The name of the resource.\"\n      }\n    },\n    \"location\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"[resourceGroup().location]\",\n      \"metadata\": {\n        \"description\": \"The location resources will be deployed.\"\n      }\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.Network/publicIPAddresses\",\n      \"apiVersion\": \"2023-05-01\",\n      \"name\": \"[parameters('name')]\",\n      \"location\": \"[parameters('location')]\",\n      \"sku\": {\n        \"name\": \"Standard\",\n        \"tier\": \"Regional\"\n      },\n      \"properties\": {\n        \"publicIPAddressVersion\": \"IPv4\",\n        \"publicIPAllocationMethod\": \"Static\",\n        \"idleTimeoutInMinutes\": 4\n      },\n      \"zones\": [\n        \"1\",\n        \"2\",\n        \"3\"\n      ]\n    }\n  ]\n}\n</code></pre>","tags":["Azure.PublicIP.Name","AZR-000155"]},{"location":"en/rules/Azure.PublicIP.Name/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy public IPs that pass this rule, consider:</p> <ul> <li>Configuring a <code>minLength</code> and <code>maxLength</code> constraint for the resource name parameter.</li> <li>Optionally, you could also use a <code>uniqueString()</code> function to generate a unique name.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>@minLength(1)\n@maxLength(80)\n@sys.description('The name of the resource.')\nparam name string\n\n@sys.description('The location resources will be deployed.')\nparam location string = resourceGroup().location\n\nresource pip 'Microsoft.Network/publicIPAddresses@2023-05-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard'\n    tier: 'Regional'\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n    idleTimeoutInMinutes: 4\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n}\n</code></pre>","tags":["Azure.PublicIP.Name","AZR-000155"]},{"location":"en/rules/Azure.PublicIP.Name/#notes","title":"Notes","text":"<p>This rule does not check if Public IP names are unique.</p>","tags":["Azure.PublicIP.Name","AZR-000155"]},{"location":"en/rules/Azure.PublicIP.Name/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Azure resources</li> <li>Recommended abbreviations for Azure resource types</li> <li>Parameters in Bicep</li> <li>Bicep functions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.PublicIP.Name","AZR-000155"]},{"location":"en/rules/Azure.PublicIP.StandardSKU/","title":"Public IP address uses basic SKU","text":"Azure.PublicIP.StandardSKUAZR-000158Error <p> Reliability  \u00b7  Public IP address  \u00b7  Rule  \u00b7  2021_12  \u00b7  Important</p> <p>The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features.</p>","tags":["Azure.PublicIP.StandardSKU","AZR-000158"]},{"location":"en/rules/Azure.PublicIP.StandardSKU/#description","title":"Description","text":"<p>Public IP addresses allow Internet resources to communicate inbound to Azure resources. Currently two SKUs are supported: Basic and Standard.</p> <p>The Standard SKU additionally offers security and redundancy improvements over the Basic SKU. Including:</p> <ul> <li>Secure by default model and be closed to inbound traffic when used as a frontend.   Network security groups are required to allow inbound traffic.</li> <li>Support for zone-redundancy and zonal deployments at creation.   Zone-redundancy should mach the zone-redundancy of the resource it is attached to.</li> <li>Have an adjustable inbound originated flow idle timeout.</li> <li>More granular control of how traffic is routed between Azure and the Internet.</li> </ul>","tags":["Azure.PublicIP.StandardSKU","AZR-000158"]},{"location":"en/rules/Azure.PublicIP.StandardSKU/#recommendation","title":"Recommendation","text":"<p>Consider using Standard SKU for Public IP addresses deployed in production.</p>","tags":["Azure.PublicIP.StandardSKU","AZR-000158"]},{"location":"en/rules/Azure.PublicIP.StandardSKU/#examples","title":"Examples","text":"","tags":["Azure.PublicIP.StandardSKU","AZR-000158"]},{"location":"en/rules/Azure.PublicIP.StandardSKU/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure Standard SKU for a Public IP address.</p> <ul> <li>Set <code>sku.name</code> to <code>Standard</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/publicIPAddresses\",\n  \"apiVersion\": \"2024-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard\",\n    \"tier\": \"Regional\"\n  },\n  \"properties\": {\n    \"publicIPAddressVersion\": \"IPv4\",\n    \"publicIPAllocationMethod\": \"Static\",\n    \"idleTimeoutInMinutes\": 4\n  },\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ]\n}\n</code></pre>","tags":["Azure.PublicIP.StandardSKU","AZR-000158"]},{"location":"en/rules/Azure.PublicIP.StandardSKU/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure Standard SKU for a Public IP address.</p> <ul> <li>Set <code>sku.name</code> to <code>Standard</code>.</li> </ul> <p>For example:</p> <p>For example:</p> Azure Bicep snippet<pre><code>resource pip 'Microsoft.Network/publicIPAddresses@2024-01-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard'\n    tier: 'Regional'\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n    idleTimeoutInMinutes: 4\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/network/public-ip-address:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/network/public-ip-address:0.7.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.PublicIP.StandardSKU","AZR-000158"]},{"location":"en/rules/Azure.PublicIP.StandardSKU/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Standard Public IP addresses</li> <li>Load Balancer and Availability Zones</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.PublicIP.StandardSKU","AZR-000158"]},{"location":"en/rules/Azure.RBAC.CoAdministrator/","title":"Use role-based access control","text":"Azure.RBAC.CoAdministratorAZR-000206Error <p> Security  \u00b7  Subscription  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Delegate access to manage Azure resources using role-based access control (RBAC).</p>","tags":["Azure.RBAC.CoAdministrator","AZR-000206"]},{"location":"en/rules/Azure.RBAC.CoAdministrator/#description","title":"Description","text":"<p>Use of Co-administrator is intended to support management of resources deployed using the Classic deployment model. Resources deployed in the Resource Manager model do not require delegation of Co-administrators.</p> <p>Azure RBAC provides greater flexibility and control providing over 100 built-in roles. Additionally RBAC works with advanced advanced security features like Privileged Identity Management (PIM).</p>","tags":["Azure.RBAC.CoAdministrator","AZR-000206"]},{"location":"en/rules/Azure.RBAC.CoAdministrator/#recommendation","title":"Recommendation","text":"<p>Consider delegating access to manage Azure resources using RBAC instead of classic Co-administrator roles. Limit delegation of Co-administrator roles only to subscription that contain resources deployed in the Classic deployment model.</p>","tags":["Azure.RBAC.CoAdministrator","AZR-000206"]},{"location":"en/rules/Azure.RBAC.CoAdministrator/#links","title":"Links","text":"<ul> <li>Azure classic subscription administrators</li> <li>Classic subscription administrator roles, Azure RBAC roles, and Azure AD administrator roles</li> <li>What is Azure AD Privileged Identity Management?</li> </ul>","tags":["Azure.RBAC.CoAdministrator","AZR-000206"]},{"location":"en/rules/Azure.RBAC.LimitMGDelegation/","title":"Limit Management Group delegation","text":"Azure.RBAC.LimitMGDelegationAZR-000205Error <p> Security  \u00b7  Subscription  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Limit Role-Base Access Control (RBAC) inheritance from Management Groups.</p>","tags":["Azure.RBAC.LimitMGDelegation","AZR-000205"]},{"location":"en/rules/Azure.RBAC.LimitMGDelegation/#description","title":"Description","text":"<p>RBAC in Azure inherits from management group to subscription to resource group to resource. Management group RBAC assignments have broad impact.</p>","tags":["Azure.RBAC.LimitMGDelegation","AZR-000205"]},{"location":"en/rules/Azure.RBAC.LimitMGDelegation/#recommendation","title":"Recommendation","text":"<p>Consider limiting the number of assignment inherited from Management Groups by scoping permission to individual Resource Group.</p> <p>Azure Blueprints can be used to rollout standard RBAC assignments to common resources. Additionally RBAC assignments can be deployed using Azure Resource Manager templates.</p>","tags":["Azure.RBAC.LimitMGDelegation","AZR-000205"]},{"location":"en/rules/Azure.RBAC.LimitOwner/","title":"Limit use of subscription scoped Owner role","text":"Azure.RBAC.LimitOwnerAZR-000204Error <p> Security  \u00b7  Subscription  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Limit the number of subscription Owners.</p>","tags":["Azure.RBAC.LimitOwner","AZR-000204"]},{"location":"en/rules/Azure.RBAC.LimitOwner/#description","title":"Description","text":"<p>Azure provides a flexible delegation model using Role-Base Access Control (RBAC). RBAC allows administrators to grant fine grained permissions using roles to Azure resources. Over 100 built-in roles exist, and custom roles can be created to perform specific tasks. Permissions can be scoped to management group, subscription, resource group or individual resources.</p> <p>The Owner role provides the ability to create, delete, update and configure permissions for any resource. When assigned at the subscription scope, these permissions apply to the whole subscription and all resources in the subscription.</p>","tags":["Azure.RBAC.LimitOwner","AZR-000204"]},{"location":"en/rules/Azure.RBAC.LimitOwner/#recommendation","title":"Recommendation","text":"<p>Consider limiting the number of subscription Owners by using a more specific role or scoping Owner permission to a Resource Group.</p>","tags":["Azure.RBAC.LimitOwner","AZR-000204"]},{"location":"en/rules/Azure.RBAC.LimitOwner/#links","title":"Links","text":"<ul> <li>What is Azure role-based access control (Azure RBAC)?</li> <li>Limit the number of subscription owners</li> </ul>","tags":["Azure.RBAC.LimitOwner","AZR-000204"]},{"location":"en/rules/Azure.RBAC.PIM/","title":"Use JiT role activation with PIM","text":"Azure.RBAC.PIMAZR-000208Error <p> Security  \u00b7  Subscription  \u00b7  Rule  \u00b7  2020_09  \u00b7  Important</p> <p>Use just-in-time (JiT) activation of roles instead of persistent role assignment.</p>","tags":["Azure.RBAC.PIM","AZR-000208"]},{"location":"en/rules/Azure.RBAC.PIM/#description","title":"Description","text":"<p>PIM helps manage the impact of identity compromise or misuse of permissions by reducing persistent access. With PIM, eligible identities can activate time-bound role assignments on an as needed basis (just-in-time). Activation typically occurs before a schedule change or management operation.</p> <p>PIM is an Azure Active Directory (AD) feature included in Azure AD Premium P2.</p>","tags":["Azure.RBAC.PIM","AZR-000208"]},{"location":"en/rules/Azure.RBAC.PIM/#recommendation","title":"Recommendation","text":"<p>Consider using Privileged Identity Management (PIM) to activate privileged roles on an as needed basis.</p>","tags":["Azure.RBAC.PIM","AZR-000208"]},{"location":"en/rules/Azure.RBAC.PIM/#links","title":"Links","text":"<ul> <li>What is Azure AD Privileged Identity Management?</li> <li>Discover Azure resources to manage in Privileged Identity Management</li> <li>Configure Azure resource role settings in Privileged Identity Management</li> <li>Lower exposure of privileged accounts</li> <li>No standing access / Just in Time privileges</li> <li>Use Azure AD Privileged Identity Management</li> </ul>","tags":["Azure.RBAC.PIM","AZR-000208"]},{"location":"en/rules/Azure.RBAC.UseGroups/","title":"Use groups","text":"Azure.RBAC.UseGroupsAZR-000203Error <p> Security  \u00b7  Subscription  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Use groups for assigning permissions instead of individual user accounts.</p>","tags":["Azure.RBAC.UseGroups","AZR-000203"]},{"location":"en/rules/Azure.RBAC.UseGroups/#description","title":"Description","text":"<p>Granting access with individual user accounts can bypass existing on-premises identity management tools and processes.</p>","tags":["Azure.RBAC.UseGroups","AZR-000203"]},{"location":"en/rules/Azure.RBAC.UseGroups/#recommendation","title":"Recommendation","text":"<p>Consider using groups for assigning permissions instead of individual user accounts.</p>","tags":["Azure.RBAC.UseGroups","AZR-000203"]},{"location":"en/rules/Azure.RBAC.UseGroups/#links","title":"Links","text":"<ul> <li>Avoid granular and custom permissions</li> <li>What is Azure role-based access control (Azure RBAC)?</li> </ul>","tags":["Azure.RBAC.UseGroups","AZR-000203"]},{"location":"en/rules/Azure.RBAC.UseRGDelegation/","title":"Use Resource Group delegation","text":"Azure.RBAC.UseRGDelegationAZR-000207Error <p> Security  \u00b7  Subscription  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Use RBAC assignments on resource groups instead of individual resources.</p>","tags":["Azure.RBAC.UseRGDelegation","AZR-000207"]},{"location":"en/rules/Azure.RBAC.UseRGDelegation/#description","title":"Description","text":"<p>Azure provides a flexible delegation model using RBAC that allows administrators to grant fine grained permissions using roles to Azure resources. Permissions can be scoped to management group, subscription, resource group or individual resources.</p>","tags":["Azure.RBAC.UseRGDelegation","AZR-000207"]},{"location":"en/rules/Azure.RBAC.UseRGDelegation/#recommendation","title":"Recommendation","text":"<p>Consider using RBAC assignments on resource groups instead of individual resources.</p>","tags":["Azure.RBAC.UseRGDelegation","AZR-000207"]},{"location":"en/rules/Azure.RBAC.UseRGDelegation/#links","title":"Links","text":"<ul> <li>Avoid granular and custom permissions</li> <li>What is Azure role-based access control (Azure RBAC)?</li> <li>Best practices for Azure RBAC</li> </ul>","tags":["Azure.RBAC.UseRGDelegation","AZR-000207"]},{"location":"en/rules/Azure.RSV.Immutable/","title":"Immutability","text":"Azure.RSV.ImmutableAZR-000397Error <p> Security  \u00b7  Recovery Services Vault  \u00b7  Rule  \u00b7  2023_09  \u00b7  Important</p> <p>Ensure immutability is configured to protect backup data.</p>","tags":["Azure.RSV.Immutable","AZR-000397"]},{"location":"en/rules/Azure.RSV.Immutable/#description","title":"Description","text":"<p>Immutability is supported for Recovery Services vaults by configuring the Immutable vault setting.</p> <p>Immutable vault helps protecting backup data by blocking any operations that could lead to loss of recovery points. Additionally, locking the Immutable vault setting makes it irreversible to prevent any malicious actors from disabling immutability and deleting backups.</p> <p>For example, an malicious attack may attempt to remove data or delete vaults to prevent recovery to a known good state.</p> <p>The Immutable vault setting is not enabled per default.</p>","tags":["Azure.RSV.Immutable","AZR-000397"]},{"location":"en/rules/Azure.RSV.Immutable/#recommendation","title":"Recommendation","text":"<p>Consider configuring immutability to protect backup data from accidental or malicious deletion.</p>","tags":["Azure.RSV.Immutable","AZR-000397"]},{"location":"en/rules/Azure.RSV.Immutable/#examples","title":"Examples","text":"","tags":["Azure.RSV.Immutable","AZR-000397"]},{"location":"en/rules/Azure.RSV.Immutable/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Recovery Services vaults that pass this rule:</p> <ul> <li>Set <code>properties.securitySettings.immutabilitySettings.state</code> to <code>Unlocked</code> or <code>Locked</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.RecoveryServices/vaults\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('vaultName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"[parameters('skuName')]\",\n    \"tier\": \"[parameters('skuTier')]\"\n  },\n  \"properties\": {\n    \"securitySettings\": {\n      \"immutabilitySettings\": {\n        \"state\": \"Locked\"\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.RSV.Immutable","AZR-000397"]},{"location":"en/rules/Azure.RSV.Immutable/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Recovery Services vaults that pass this rule:</p> <ul> <li>Set <code>properties.securitySettings.immutabilitySettings.state</code> to <code>Unlocked</code> or <code>Locked</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource recoveryServicesVault 'Microsoft.RecoveryServices/vaults@2023-01-01' = {\n  name: vaultName\n  location: location\n  sku: {\n    name: skuName\n    tier: skuTier\n  }\n  properties: {\n    securitySettings: {\n      immutabilitySettings: {\n        state: 'Locked'\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.RSV.Immutable","AZR-000397"]},{"location":"en/rules/Azure.RSV.Immutable/#notes","title":"Notes","text":"<p>Note that immutability locking <code>Locked</code> is irreversible, so ensure to take a well-informed decision when opting to lock. For example, for vaults containing production workloads consider using <code>Locked</code>. For cases where you are creating and destroying backups and vaults on a regulary basis such as temporary environments consider <code>Unlocked</code>.</p>","tags":["Azure.RSV.Immutable","AZR-000397"]},{"location":"en/rules/Azure.RSV.Immutable/#links","title":"Links","text":"<ul> <li>Security design principles</li> <li>Immutable vault for Azure Backup</li> <li>Restricted operations</li> <li>Manage Azure Backup Immutable vault operations</li> <li>Azure security baseline for Azure Backup</li> <li>Backup and restore plan to protect against ransomware</li> <li>BR-2: Protect backup and recovery data</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.RSV.Immutable","AZR-000397"]},{"location":"en/rules/Azure.RSV.Name/","title":"Use valid names","text":"Azure.RSV.NameAZR-000350Error <p> Operational Excellence  \u00b7  Recovery Services Vault  \u00b7  Rule  \u00b7  2022_12  \u00b7  Awareness</p> <p>Recovery Services vaults should meet naming requirements.</p>","tags":["Azure.RSV.Name","AZR-000350"]},{"location":"en/rules/Azure.RSV.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Recovery Services vault names are:</p> <ul> <li>Between 2 and 50 characters long.</li> <li>Alphanumerics and hyphens.</li> <li>Start with letter.</li> </ul>","tags":["Azure.RSV.Name","AZR-000350"]},{"location":"en/rules/Azure.RSV.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Recovery Services vault naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.RSV.Name","AZR-000350"]},{"location":"en/rules/Azure.RSV.Name/#notes","title":"Notes","text":"<p>This rule does not check if Recovery Services vault names are unique.</p>","tags":["Azure.RSV.Name","AZR-000350"]},{"location":"en/rules/Azure.RSV.Name/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Recovery Services vault</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.RSV.Name","AZR-000350"]},{"location":"en/rules/Azure.RSV.ReplicationAlert/","title":"Use geo-replicated storage","text":"Azure.RSV.ReplicationAlertAZR-000171Error <p> Reliability  \u00b7  Recovery Services Vault  \u00b7  Rule  \u00b7  2022_03  \u00b7  Important</p> <p>Recovery Services Vaults (RSV) without replication alerts configured may be at risk.</p>","tags":["Azure.RSV.ReplicationAlert","AZR-000171"]},{"location":"en/rules/Azure.RSV.ReplicationAlert/#description","title":"Description","text":"<p>Recovery Services Vaults (RSV) can be used to replicate virtual machines between Azure Regions. Alerts can be configured to send notifications when replication issues occur.</p> <p>The replication alerts can be configured for:</p> <ul> <li>The resources owners (Based on RBAC permissions).</li> <li>A list of email addresses.</li> </ul>","tags":["Azure.RSV.ReplicationAlert","AZR-000171"]},{"location":"en/rules/Azure.RSV.ReplicationAlert/#recommendation","title":"Recommendation","text":"<p>Configure replication alerts for Recovery Service Vaults that are performing replication tasks.</p>","tags":["Azure.RSV.ReplicationAlert","AZR-000171"]},{"location":"en/rules/Azure.RSV.ReplicationAlert/#examples","title":"Examples","text":"","tags":["Azure.RSV.ReplicationAlert","AZR-000171"]},{"location":"en/rules/Azure.RSV.ReplicationAlert/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>By default a Recovery Services vaults does not have replication alerts setup. To define a replication alert via ARM templates either configure the <code>sendToOwners</code> or <code>CustomerEmailAddress</code> properties:</p> <ul> <li>Set <code>properties.sendToOwners</code> to <code>Send</code>.</li> <li>Set <code>properties.customEmailAddresses</code> to <code>[ \"example@email.com\" ]</code></li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.RecoveryServices/vaults/replicationAlertSettings\",\n  \"apiVersion\": \"2021-08-01\",\n  \"name\": \"replicationAlert\",\n  \"properties\": {\n    \"sendToOwners\": \"Send\",\n    \"customEmailAddresses\": [\n      \"example@email.com\"\n    ],\n    \"locale\": \"en-US\"\n  }\n}\n</code></pre>","tags":["Azure.RSV.ReplicationAlert","AZR-000171"]},{"location":"en/rules/Azure.RSV.ReplicationAlert/#configure-with-bicep","title":"Configure with Bicep","text":"<p>By default a Recovery Services vaults does not have replication alerts setup. To define a replication alert via a Bicep either configure the <code>sendToOwners</code> or <code>CustomerEmailAddress</code> properties:</p> <ul> <li>Set <code>properties.sendToOwners</code> to <code>Send</code>.</li> <li>Set <code>properties.customEmailAddresses</code> to <code>[ \"example@email.com\" ]</code></li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource testRecoveryServices 'Microsoft.RecoveryServices/vaults/replicationAlertSettings@2021-08-01' = {\n  name: 'replicationAlert'\n  parent: resourceSymbolicName\n  properties: {\n    sendToOwners: 'Sender'\n    customEmailAddresses: [\n      'example@email.com'\n    ]\n    locale: 'en-US'\n  }\n}\n</code></pre>","tags":["Azure.RSV.ReplicationAlert","AZR-000171"]},{"location":"en/rules/Azure.RSV.ReplicationAlert/#notes","title":"Notes","text":"<p>With the <code>locale</code> property you can define the locale for the email notification.</p>","tags":["Azure.RSV.ReplicationAlert","AZR-000171"]},{"location":"en/rules/Azure.RSV.ReplicationAlert/#links","title":"Links","text":"<ul> <li>Recovery Services Vault - Overview</li> <li>Recovery Services Vault - Replication Alerts</li> <li>Azure deployment reference</li> <li>Well Architected Framework - Reliability</li> </ul>","tags":["Azure.RSV.ReplicationAlert","AZR-000171"]},{"location":"en/rules/Azure.RSV.StorageType/","title":"Use geo-replicated storage","text":"Azure.RSV.StorageTypeAZR-000170Error <p> Reliability  \u00b7  Recovery Services Vault  \u00b7  Rule  \u00b7  2022_03  \u00b7  Important</p> <p>Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk.</p>","tags":["Azure.RSV.StorageType","AZR-000170"]},{"location":"en/rules/Azure.RSV.StorageType/#description","title":"Description","text":"<p>Recovery Services Vaults can be configured with several different durability options. Azure provides a number of geo-replicated options for storage including; Geo-redundant storage and read access geo-zone-redundant storage. The default storage type used will be Geo-redundant Geo-zone-redundant storage is only available in supported regions.</p> <p>The following geo-replicated options are available for recovery services vaults:</p> <ul> <li><code>GeoRedundant</code></li> <li><code>ReadAccessGeoZoneRedundant</code></li> </ul>","tags":["Azure.RSV.StorageType","AZR-000170"]},{"location":"en/rules/Azure.RSV.StorageType/#recommendation","title":"Recommendation","text":"<p>Consider using GeoRedundant for recovery services vaults that contain data.</p>","tags":["Azure.RSV.StorageType","AZR-000170"]},{"location":"en/rules/Azure.RSV.StorageType/#examples","title":"Examples","text":"","tags":["Azure.RSV.StorageType","AZR-000170"]},{"location":"en/rules/Azure.RSV.StorageType/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>The default storage type used by Recovery Services vaults is Geo-redundant. However if you're defining the backup config in an ARM template:</p> <ul> <li>Set <code>properties.storageType</code> to either <code>GeoRedundant</code> or <code>ReadAccessGeoZoneRedundant</code>. For example:</li> </ul> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.RecoveryServices/vaults/backupconfig\",\n  \"apiVersion\": \"2021-10-01\",\n  \"name\": \"vaultconfig-a\",\n  \"location\": \"australiaeast\",\n  \"tags\": {},\n  \"properties\": {\n    \"storageType\": \"GeoRedundant\"\n  }\n}\n</code></pre>","tags":["Azure.RSV.StorageType","AZR-000170"]},{"location":"en/rules/Azure.RSV.StorageType/#configure-with-bicep","title":"Configure with Bicep","text":"<p>The default storage type used by Recovery Services vaults is Geo-redundant. However if you're defining the backup config via Bicep:</p> <ul> <li>Set <code>properties.storageType</code> to either <code>GeoRedundant</code> or <code>ReadAccessGeoZoneRedundant</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource testRecoveryServices 'Microsoft.RecoveryServices/vaults/backupconfig@2021-10-01' = {\n  name: 'vaultconfig'\n  location: 'string'\n  parent: resourceSymbolicName\n  properties: {\n    storageType: 'GeoRedundant'\n  }\n}\n</code></pre>","tags":["Azure.RSV.StorageType","AZR-000170"]},{"location":"en/rules/Azure.RSV.StorageType/#links","title":"Links","text":"<ul> <li>RE:05 Redundancy</li> <li>Recovery Services Vault - Overview</li> <li>Recovery Services Vault - Storage Settings</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.RSV.StorageType","AZR-000170"]},{"location":"en/rules/Azure.Redis.AvailabilityZone/","title":"Redis cache should use Availability zones in supported regions","text":"Azure.Redis.AvailabilityZoneAZR-000161Error <p> Reliability  \u00b7  Azure Cache for Redis  \u00b7  Rule  \u00b7  2021_12  \u00b7  Important</p> <p>Premium Redis cache should be deployed with availability zones for high availability.</p>","tags":["Azure.Redis.AvailabilityZone","AZR-000161"]},{"location":"en/rules/Azure.Redis.AvailabilityZone/#description","title":"Description","text":"<p>Redis Cache using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. Nodes in one availability zone are physically separated from nodes defined in another availability zone. By spreading node pools across multiple zones, nodes in one node pool will continue running even if another zone has gone down.</p>","tags":["Azure.Redis.AvailabilityZone","AZR-000161"]},{"location":"en/rules/Azure.Redis.AvailabilityZone/#recommendation","title":"Recommendation","text":"<p>Consider using availability zones for Premium Redis Cache deployed in supported regions.</p>","tags":["Azure.Redis.AvailabilityZone","AZR-000161"]},{"location":"en/rules/Azure.Redis.AvailabilityZone/#examples","title":"Examples","text":"","tags":["Azure.Redis.AvailabilityZone","AZR-000161"]},{"location":"en/rules/Azure.Redis.AvailabilityZone/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To set availability zones for Premium SKU Redis Cache:</p> <ul> <li>Set <code>zones</code> to a minimum of two zones from <code>[\"1\", \"2\", \"3\"]</code>.</li> <li>Set <code>Properties.replicasPerMaster</code> to number of zones - 1, to ensure you have at least as many nodes as zones you are replicating to.</li> <li>Set <code>Properties.sku.name</code> to <code>Premium</code>.</li> <li>Set <code>Properties.sku.family</code> to <code>P</code>.</li> <li>Set <code>Properties.sku.capacity</code> to one of <code>[1, 2, 3, 4, 5]</code>, depending on the SKU you picked:<ul> <li><code>P1</code> - 6 GB</li> <li><code>P2</code> - 13 GB</li> <li><code>P3</code> - 26 GB</li> <li><code>P4</code> - 53 GB</li> <li><code>P5</code> - 120 GB</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Cache/redis\",\n  \"apiVersion\": \"2024-03-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"redisVersion\": \"6\",\n    \"sku\": {\n      \"name\": \"Premium\",\n      \"family\": \"P\",\n      \"capacity\": 1\n    },\n    \"redisConfiguration\": {\n      \"aad-enabled\": \"True\",\n      \"maxmemory-reserved\": \"615\"\n    },\n    \"enableNonSslPort\": false,\n    \"publicNetworkAccess\": \"Disabled\"\n  },\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ]\n}\n</code></pre>","tags":["Azure.Redis.AvailabilityZone","AZR-000161"]},{"location":"en/rules/Azure.Redis.AvailabilityZone/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To set availability zones for Premium SKU Redis Cache:</p> <ul> <li>Set <code>zones</code> to a minimum of two zones from <code>[\"1\", \"2\", \"3\"]</code>.</li> <li>Set <code>Properties.replicasPerMaster</code> to number of zones - 1, to ensure you have at least as many nodes as zones you are replicating to.</li> <li>Set <code>Properties.sku.name</code> to <code>Premium</code>.</li> <li>Set <code>Properties.sku.family</code> to <code>P</code>.</li> <li>Set <code>Properties.sku.capacity</code> to one of <code>[1, 2, 3, 4, 5]</code>, depending on the SKU you picked:<ul> <li><code>P1</code> - 6 GB</li> <li><code>P2</code> - 13 GB</li> <li><code>P3</code> - 26 GB</li> <li><code>P4</code> - 53 GB</li> <li><code>P5</code> - 120 GB</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cache 'Microsoft.Cache/redis@2024-03-01' = {\n  name: name\n  location: location\n  properties: {\n    redisVersion: '6'\n    sku: {\n      name: 'Premium'\n      family: 'P'\n      capacity: 1\n    }\n    redisConfiguration: {\n      'aad-enabled': 'True'\n      'maxmemory-reserved': '615'\n    }\n    enableNonSslPort: false\n    publicNetworkAccess: 'Disabled'\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/cache/redis:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/cache/redis:0.8.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Redis.AvailabilityZone","AZR-000161"]},{"location":"en/rules/Azure.Redis.AvailabilityZone/#notes","title":"Notes","text":"<p>This rule applies when analyzing resources deployed to Azure using pre-flight and in-flight data.</p> <p>This rule fails when <code>\"zones\"</code> is <code>null</code>, <code>[]</code> or less than two zones are used when there are availability zones for the given region.</p> <p>This rule fails when cache is not zone redundant(1, 2 and 3) when there are availability zones for the given region.</p> <p>Configure <code>AZURE_REDISCACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST</code> to set additional availability zones that need to be supported which are not in the existing providers for namespace <code>Microsoft.Cache</code> and resource type <code>Redis</code>.</p> <pre><code># YAML: The default AZURE_REDISCACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option\nconfiguration:\n  AZURE_REDISCACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST: []\n</code></pre>","tags":["Azure.Redis.AvailabilityZone","AZR-000161"]},{"location":"en/rules/Azure.Redis.AvailabilityZone/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>Enable zone redundancy for Azure Cache for Redis</li> <li>High availability for Azure Cache for Redis</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Redis.AvailabilityZone","AZR-000161"]},{"location":"en/rules/Azure.Redis.EntraID/","title":"Use Entra ID authentication with cache instances","text":"Azure.Redis.EntraIDAZR-000427Error <p> Security  \u00b7  Azure Cache for Redis  \u00b7  Rule  \u00b7  2024_06  \u00b7  Critical</p> <p>Use Entra ID authentication with cache instances.</p>","tags":["Azure.Redis.EntraID","AZR-000427"]},{"location":"en/rules/Azure.Redis.EntraID/#description","title":"Description","text":"<p>Azure Cache for Redis by default requires that all requests be authenticated. Two methods are supported for authenticating and authorizing requests to Redis cache instances.</p> <ul> <li>Access keys - Cryptographic keys are secret similar to a shared password,   and as a result have a number of limitations that impact security and maintainability.<ul> <li>Access keys have a long number of characters, so are not easily guessable but once exposed grant full access.</li> <li>Auditing based on user or application is not possible when using access keys.</li> <li>Each access key must be stored securely within any applications or scripts that use it.   This can introduce additional dependencies and code to maintain, that might not normally be required if using Entra ID.   Azure Key Vault provides a secure storage for access keys as a secret.</li> <li>You have two keys (primary/ secondary) to manage, each should be rotated independently on a regular basis.   Rotation should occur regularly using automation with a documented manual process as a backup.</li> </ul> </li> <li>Microsoft Entra ID - An OAuth2 access token issued by Microsoft Entra ID provides advantages over access keys including:<ul> <li>More granular access control instead of only full access.</li> <li>Strong identity protection methods such as Multi-Factor Authentication (MFA) and conditional access.</li> <li>Central management and auditing.</li> </ul> </li> </ul> <p>Currently Redis Enterprise and Redis Enterprise Flash tiers are not supported. Entra ID authentication is supported on <code>Basic</code>, <code>Standard</code>, and <code>Premium</code> tiers.</p>","tags":["Azure.Redis.EntraID","AZR-000427"]},{"location":"en/rules/Azure.Redis.EntraID/#recommendation","title":"Recommendation","text":"<p>Consider configuring and using Microsoft Entra ID to authenticate all connections to Redis cache instances.</p>","tags":["Azure.Redis.EntraID","AZR-000427"]},{"location":"en/rules/Azure.Redis.EntraID/#examples","title":"Examples","text":"","tags":["Azure.Redis.EntraID","AZR-000427"]},{"location":"en/rules/Azure.Redis.EntraID/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy cache instances that pass this rule:</p> <ul> <li>Set the <code>properties.redisConfiguration.aad-enabled</code> to <code>\"True\"</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Cache/redis\",\n  \"apiVersion\": \"2024-03-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"redisVersion\": \"6\",\n    \"sku\": {\n      \"name\": \"Premium\",\n      \"family\": \"P\",\n      \"capacity\": 1\n    },\n    \"redisConfiguration\": {\n      \"aad-enabled\": \"True\",\n      \"maxmemory-reserved\": \"615\"\n    },\n    \"enableNonSslPort\": false,\n    \"publicNetworkAccess\": \"Disabled\"\n  },\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ]\n}\n</code></pre>","tags":["Azure.Redis.EntraID","AZR-000427"]},{"location":"en/rules/Azure.Redis.EntraID/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy cache instances that pass this rule:</p> <ul> <li>Set the <code>properties.redisConfiguration.aad-enabled</code> to <code>'True'</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cache 'Microsoft.Cache/redis@2024-03-01' = {\n  name: name\n  location: location\n  properties: {\n    redisVersion: '6'\n    sku: {\n      name: 'Premium'\n      family: 'P'\n      capacity: 1\n    }\n    redisConfiguration: {\n      'aad-enabled': 'True'\n      'maxmemory-reserved': '615'\n    }\n    enableNonSslPort: false\n    publicNetworkAccess: 'Disabled'\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/cache/redis:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/cache/redis:0.8.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Redis.EntraID","AZR-000427"]},{"location":"en/rules/Azure.Redis.EntraID/#notes","title":"Notes","text":"<p>Microsoft Entra ID based authentication isn't supported in the Enterprise/ Enterprise Flash tiers.</p>","tags":["Azure.Redis.EntraID","AZR-000427"]},{"location":"en/rules/Azure.Redis.EntraID/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Use Microsoft Entra ID for cache authentication</li> <li>Configure role-based access control with Data Access Policy</li> <li>Azure security baseline for Azure Cache for Redis</li> <li>IM-1: Use centralized identity and authentication system</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.Redis.EntraID","AZR-000427"]},{"location":"en/rules/Azure.Redis.FirewallIPRange/","title":"Limit Redis cache number of IP addresses","text":"Azure.Redis.FirewallIPRangeAZR-000300Error <p> Security  \u00b7  Azure Cache for Redis  \u00b7  Rule  \u00b7  2022_09  \u00b7  Critical</p> <p>Determine if there is an excessive number of permitted IP addresses for the Redis cache.</p>","tags":["Azure.Redis.FirewallIPRange","AZR-000300"]},{"location":"en/rules/Azure.Redis.FirewallIPRange/#description","title":"Description","text":"<p>When using Azure Cache for Redis, injected into a VNET you are able to create firewall rules to limit access to the cache. Each firewall rules specifies a range of IP addresses that are allowed to access the cache.</p> <p>If no firewall rules are set and public access is not disabled, then all IP addresses are allowed to access the cache. By default, the cache is configured to allow access from all IP addresses.</p> <p>Consider using private endpoints to limit access to the cache. If this is not possible, use firewall rules to limit access to the cache. However, avoid using overly permissive firewall rules that are:</p> <ul> <li>Not needed.</li> <li>Too broad.</li> <li>Too many.</li> </ul>","tags":["Azure.Redis.FirewallIPRange","AZR-000300"]},{"location":"en/rules/Azure.Redis.FirewallIPRange/#recommendation","title":"Recommendation","text":"<p>The Redis cache has greater than ten (10) public IP addresses that are permitted network access. Some rules may not be needed or can be reduced.</p>","tags":["Azure.Redis.FirewallIPRange","AZR-000300"]},{"location":"en/rules/Azure.Redis.FirewallIPRange/#examples","title":"Examples","text":"","tags":["Azure.Redis.FirewallIPRange","AZR-000300"]},{"location":"en/rules/Azure.Redis.FirewallIPRange/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.startIP</code> property to the start of the IP address range.</li> <li>Set the <code>properties.endIP</code> property to the end of the IP address range.</li> <li>Limit the range of public IP address included in rules.</li> </ul> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Cache/redis/firewallRules\",\n  \"apiVersion\": \"2023-04-01\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), 'allow-on-premises')]\",\n  \"properties\": {\n    \"startIP\": \"10.0.1.1\",\n    \"endIP\": \"10.0.1.31\"\n  },\n  \"dependsOn\": [\n    \"cache\"\n  ]\n}\n</code></pre>","tags":["Azure.Redis.FirewallIPRange","AZR-000300"]},{"location":"en/rules/Azure.Redis.FirewallIPRange/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.startIP</code> property to the start of the IP address range.</li> <li>Set the <code>properties.endIP</code> property to the end of the IP address range.</li> <li>Limit the range of public IP address included in rules.</li> </ul> Azure Bicep snippet<pre><code>resource rule 'Microsoft.Cache/redis/firewallRules@2023-04-01' = {\n  parent: cache\n  name: 'allow-on-premises'\n  properties: {\n    startIP: '10.0.1.1'\n    endIP: '10.0.1.31'\n  }\n}\n</code></pre>","tags":["Azure.Redis.FirewallIPRange","AZR-000300"]},{"location":"en/rules/Azure.Redis.FirewallIPRange/#notes","title":"Notes","text":"<p>This rule is not applicable when Redis is configured to allow private connectivity by setting <code>properties.publicNetworkAccess</code> to <code>Disabled</code>. Firewall rules can be used with VNET injected caches, but not private endpoints.</p>","tags":["Azure.Redis.FirewallIPRange","AZR-000300"]},{"location":"en/rules/Azure.Redis.FirewallIPRange/#links","title":"Links","text":"<ul> <li>SE:08 Hardening resources</li> <li>Azure best practices for network security</li> <li>Azure Cache for Redis network isolation options</li> <li>Limitations of firewall rules</li> <li>Migrate from VNet injection caches to Private Link caches</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Redis.FirewallIPRange","AZR-000300"]},{"location":"en/rules/Azure.Redis.FirewallRuleCount/","title":"Cleanup Redis cache firewall rules","text":"Azure.Redis.FirewallRuleCountAZR-000299Error <p> Security  \u00b7  Azure Cache for Redis  \u00b7  Rule  \u00b7  2022_09  \u00b7  Awareness</p> <p>Determine if there is an excessive number of firewall rules for the Redis cache.</p>","tags":["Azure.Redis.FirewallRuleCount","AZR-000299"]},{"location":"en/rules/Azure.Redis.FirewallRuleCount/#description","title":"Description","text":"<p>When using Azure Cache for Redis, injected into a VNET you are able to create firewall rules to limit access to the cache. Each firewall rules specifies a range of IP addresses that are allowed to access the cache.</p> <p>If no firewall rules are set and public access is not disabled, then all IP addresses are allowed to access the cache. By default, the cache is configured to allow access from all IP addresses.</p> <p>Consider using private endpoints to limit access to the cache. If this is not possible, use firewall rules to limit access to the cache. However, avoid using overly permissive firewall rules that are:</p> <ul> <li>Not needed.</li> <li>Too broad.</li> <li>Too many.</li> </ul>","tags":["Azure.Redis.FirewallRuleCount","AZR-000299"]},{"location":"en/rules/Azure.Redis.FirewallRuleCount/#recommendation","title":"Recommendation","text":"<p>The Redis cache has more than ten (10) firewall rules. Some rules may not be needed.</p>","tags":["Azure.Redis.FirewallRuleCount","AZR-000299"]},{"location":"en/rules/Azure.Redis.FirewallRuleCount/#examples","title":"Examples","text":"","tags":["Azure.Redis.FirewallRuleCount","AZR-000299"]},{"location":"en/rules/Azure.Redis.FirewallRuleCount/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.startIP</code> property to the start of the IP address range.</li> <li>Set the <code>properties.endIP</code> property to the end of the IP address range.</li> <li>Configure a minimum number of firewall rules.   This rule will fail if more then ten (10) firewall rules are configured.</li> </ul> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Cache/redis/firewallRules\",\n  \"apiVersion\": \"2023-04-01\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), 'allow-on-premises')]\",\n  \"properties\": {\n    \"startIP\": \"10.0.1.1\",\n    \"endIP\": \"10.0.1.31\"\n  },\n  \"dependsOn\": [\n    \"cache\"\n  ]\n}\n</code></pre>","tags":["Azure.Redis.FirewallRuleCount","AZR-000299"]},{"location":"en/rules/Azure.Redis.FirewallRuleCount/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.startIP</code> property to the start of the IP address range.</li> <li>Set the <code>properties.endIP</code> property to the end of the IP address range.</li> <li>Configure a minimum number of firewall rules.   This rule will fail if more then ten (10) firewall rules are configured.</li> </ul> Azure Bicep snippet<pre><code>resource rule 'Microsoft.Cache/redis/firewallRules@2023-04-01' = {\n  parent: cache\n  name: 'allow-on-premises'\n  properties: {\n    startIP: '10.0.1.1'\n    endIP: '10.0.1.31'\n  }\n}\n</code></pre>","tags":["Azure.Redis.FirewallRuleCount","AZR-000299"]},{"location":"en/rules/Azure.Redis.FirewallRuleCount/#notes","title":"Notes","text":"<p>This rule is not applicable when Redis is configured to allow private connectivity by setting <code>properties.publicNetworkAccess</code> to <code>Disabled</code>. Firewall rules can be used with VNet injected caches, but not private endpoints.</p>","tags":["Azure.Redis.FirewallRuleCount","AZR-000299"]},{"location":"en/rules/Azure.Redis.FirewallRuleCount/#links","title":"Links","text":"<ul> <li>SE:08 Hardening resources</li> <li>Azure best practices for network security</li> <li>Azure Cache for Redis network isolation options</li> <li>Limitations of firewall rules</li> <li>Migrate from VNet injection caches to Private Link caches</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Redis.FirewallRuleCount","AZR-000299"]},{"location":"en/rules/Azure.Redis.MaxMemoryReserved/","title":"Configure cache maxmemory-reserved setting","text":"Azure.Redis.MaxMemoryReservedAZR-000160Error <p> Performance Efficiency  \u00b7  Azure Cache for Redis  \u00b7  Rule  \u00b7  2020_12  \u00b7  Important</p> <p>Configure <code>maxmemory-reserved</code> to reserve memory for non-cache operations.</p>","tags":["Azure.Redis.MaxMemoryReserved","AZR-000160"]},{"location":"en/rules/Azure.Redis.MaxMemoryReserved/#description","title":"Description","text":"<p>Azure Cache for Redis supports configuration of the <code>maxmemory-reserved</code> setting. The <code>maxmemory-reserved</code> setting configures the amount of memory reserved for non-cache operations. Non-cache operations include background tasks, eviction, and compaction.</p> <p>By reserving memory for these operations, you prevent Redis cache from using all available memory for cache. If enough memory is not reserved for these operations it can lead to performance degradation and instability.</p> <p>Setting this value allows you to have a more consistent experience when your load varies. This value should be set higher for workloads that are write heavy.</p> <p>When memory reserved by <code>maxmemory-reserved</code>, it is unavailable for storage of cached data.</p>","tags":["Azure.Redis.MaxMemoryReserved","AZR-000160"]},{"location":"en/rules/Azure.Redis.MaxMemoryReserved/#recommendation","title":"Recommendation","text":"<p>Consider configuring <code>maxmemory-reserved</code> to at least 10% of available cache memory.</p>","tags":["Azure.Redis.MaxMemoryReserved","AZR-000160"]},{"location":"en/rules/Azure.Redis.MaxMemoryReserved/#examples","title":"Examples","text":"","tags":["Azure.Redis.MaxMemoryReserved","AZR-000160"]},{"location":"en/rules/Azure.Redis.MaxMemoryReserved/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.redisConfiguration.maxmemory-reserved</code> property to at least 10% of the cache memory.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Cache/redis\",\n  \"apiVersion\": \"2024-03-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"redisVersion\": \"6\",\n    \"sku\": {\n      \"name\": \"Premium\",\n      \"family\": \"P\",\n      \"capacity\": 1\n    },\n    \"redisConfiguration\": {\n      \"aad-enabled\": \"True\",\n      \"maxmemory-reserved\": \"615\"\n    },\n    \"enableNonSslPort\": false,\n    \"publicNetworkAccess\": \"Disabled\"\n  },\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ]\n}\n</code></pre>","tags":["Azure.Redis.MaxMemoryReserved","AZR-000160"]},{"location":"en/rules/Azure.Redis.MaxMemoryReserved/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.redisConfiguration.maxmemory-reserved</code> property to at least 10% of the cache memory.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cache 'Microsoft.Cache/redis@2024-03-01' = {\n  name: name\n  location: location\n  properties: {\n    redisVersion: '6'\n    sku: {\n      name: 'Premium'\n      family: 'P'\n      capacity: 1\n    }\n    redisConfiguration: {\n      'aad-enabled': 'True'\n      'maxmemory-reserved': '615'\n    }\n    enableNonSslPort: false\n    publicNetworkAccess: 'Disabled'\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/cache/redis:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/cache/redis:0.8.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Redis.MaxMemoryReserved","AZR-000160"]},{"location":"en/rules/Azure.Redis.MaxMemoryReserved/#links","title":"Links","text":"<ul> <li>PE:05 Scaling and partitioning</li> <li>Choosing the right tier</li> <li>Scaling and memory</li> <li>Memory management</li> <li>SKU sizes</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Redis.MaxMemoryReserved","AZR-000160"]},{"location":"en/rules/Azure.Redis.MinSKU/","title":"Use at least Standard C1 cache instances","text":"Azure.Redis.MinSKUAZR-000159Error <p> Performance Efficiency  \u00b7  Azure Cache for Redis  \u00b7  Rule  \u00b7  2020_12  \u00b7  Important</p> <p>Use Azure Cache for Redis instances of at least Standard C1.</p>","tags":["Azure.Redis.MinSKU","AZR-000159"]},{"location":"en/rules/Azure.Redis.MinSKU/#description","title":"Description","text":"<p>Azure Cache for Redis supports a range of different scale options. Basic tier or Standard C0 caches are not suitable for production workloads.</p> <ul> <li>Basic tier is a single node system with no data replication and no SLA.</li> <li>Standard C0 caches used shared resources and subject to noisy neighbor issues.</li> </ul>","tags":["Azure.Redis.MinSKU","AZR-000159"]},{"location":"en/rules/Azure.Redis.MinSKU/#recommendation","title":"Recommendation","text":"<p>Consider using a minimum of a Standard C1 instance for production workloads.</p>","tags":["Azure.Redis.MinSKU","AZR-000159"]},{"location":"en/rules/Azure.Redis.MinSKU/#examples","title":"Examples","text":"","tags":["Azure.Redis.MinSKU","AZR-000159"]},{"location":"en/rules/Azure.Redis.MinSKU/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.sku.name</code> property to <code>Premium</code> or <code>Standard</code>.</li> <li>Set the <code>properties.sku.family</code> property to <code>P</code> or <code>C</code>.</li> <li>Set the <code>properties.sku.capacity</code> property to a capacity valid for the SKU <code>1</code> or higher.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Cache/redis\",\n  \"apiVersion\": \"2024-03-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"redisVersion\": \"6\",\n    \"sku\": {\n      \"name\": \"Premium\",\n      \"family\": \"P\",\n      \"capacity\": 1\n    },\n    \"redisConfiguration\": {\n      \"aad-enabled\": \"True\",\n      \"maxmemory-reserved\": \"615\"\n    },\n    \"enableNonSslPort\": false,\n    \"publicNetworkAccess\": \"Disabled\"\n  },\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ]\n}\n</code></pre>","tags":["Azure.Redis.MinSKU","AZR-000159"]},{"location":"en/rules/Azure.Redis.MinSKU/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.sku.name</code> property to <code>Premium</code> or <code>Standard</code>.</li> <li>Set the <code>properties.sku.family</code> property to <code>P</code> or <code>C</code>.</li> <li>Set the <code>properties.sku.capacity</code> property to a capacity valid for the SKU <code>1</code> or higher.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cache 'Microsoft.Cache/redis@2024-03-01' = {\n  name: name\n  location: location\n  properties: {\n    redisVersion: '6'\n    sku: {\n      name: 'Premium'\n      family: 'P'\n      capacity: 1\n    }\n    redisConfiguration: {\n      'aad-enabled': 'True'\n      'maxmemory-reserved': '615'\n    }\n    enableNonSslPort: false\n    publicNetworkAccess: 'Disabled'\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/cache/redis:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/cache/redis:0.8.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Redis.MinSKU","AZR-000159"]},{"location":"en/rules/Azure.Redis.MinSKU/#links","title":"Links","text":"<ul> <li>PE:03 Selecting services</li> <li>Choosing the right tier</li> <li>Scaling and memory</li> <li>Memory management</li> <li>SKU sizes</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Redis.MinSKU","AZR-000159"]},{"location":"en/rules/Azure.Redis.MinTLS/","title":"Redis Cache minimum TLS version","text":"Azure.Redis.MinTLSAZR-000164Error <p> Security  \u00b7  Azure Cache for Redis  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Redis Cache should reject TLS versions older than 1.2.</p>","tags":["Azure.Redis.MinTLS","AZR-000164"]},{"location":"en/rules/Azure.Redis.MinTLS/#description","title":"Description","text":"<p>The minimum version of TLS that Redis Cache accepts was previously configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS.</p> <p>Depending on when your cache was deployed you may be using a default that specifies an older version of TLS. Any new deployments do not allow TLS 1.0 or 1.1 to be specified, however existing cache deployment may require updating.</p> <p>Support for TLS 1.0 and TLS 1.1 will be removed in 1 November 2024.</p>","tags":["Azure.Redis.MinTLS","AZR-000164"]},{"location":"en/rules/Azure.Redis.MinTLS/#recommendation","title":"Recommendation","text":"<p>Consider configuring the minimum supported TLS version to be 1.2. No action is required for new cache deployments from March 2024, which only support a minimum of TLS 1.2.</p>","tags":["Azure.Redis.MinTLS","AZR-000164"]},{"location":"en/rules/Azure.Redis.MinTLS/#examples","title":"Examples","text":"","tags":["Azure.Redis.MinTLS","AZR-000164"]},{"location":"en/rules/Azure.Redis.MinTLS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.minimumTlsVersion</code> property to a minimum of <code>1.2</code> for existing caches with an old version of TLS configured.   It is not possible to set the <code>properties.minimumTlsVersion</code> on new cache deployments from March 2024.   New cache deployments only support a minimum TLS version of 1.2.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Cache/redis\",\n  \"apiVersion\": \"2024-03-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"minimumTlsVersion\": \"1.2\",\n    \"redisVersion\": \"latest\",\n    \"sku\": {\n      \"name\": \"Premium\",\n      \"family\": \"P\",\n      \"capacity\": 1\n    },\n    \"redisConfiguration\": {\n      \"maxmemory-reserved\": \"615\"\n    },\n    \"enableNonSslPort\": false,\n    \"publicNetworkAccess\": \"Disabled\"\n  },\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ]\n}\n</code></pre>","tags":["Azure.Redis.MinTLS","AZR-000164"]},{"location":"en/rules/Azure.Redis.MinTLS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.minimumTlsVersion</code> property to a minimum of <code>1.2</code> for existing caches with an old version of TLS configured.   It is not possible to set the <code>properties.minimumTlsVersion</code> on new cache deployments from March 2024.   New cache deployments only support a minimum TLS version of 1.2.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cache 'Microsoft.Cache/redis@2024-03-01' = {\n  name: name\n  location: location\n  properties: {\n    minimumTlsVersion: '1.2'\n    redisVersion: 'latest'\n    sku: {\n      name: 'Premium'\n      family: 'P'\n      capacity: 1\n    }\n    redisConfiguration: {\n      'maxmemory-reserved': '615'\n    }\n    enableNonSslPort: false\n    publicNetworkAccess: 'Disabled'\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/cache/redis:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/cache/redis:0.8.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Redis.MinTLS","AZR-000164"]},{"location":"en/rules/Azure.Redis.MinTLS/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Use the <code>--set</code> parameter.   This parameter only applies to old cache deployments using TLS 1.0 or TLS 1.1.</li> </ul> <p>For example:</p> Azure CLI snippet<pre><code>az redis update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --set minimumTlsVersion=1.2\n</code></pre>","tags":["Azure.Redis.MinTLS","AZR-000164"]},{"location":"en/rules/Azure.Redis.MinTLS/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Use the <code>-MinimumTlsVersion</code> parameter.   This parameter only applies to old cache deployments using TLS 1.0 or TLS 1.1.</li> </ul> <p>For example:</p> Azure PowerShell snippet<pre><code>Set-AzRedisCache -Name '&lt;name&gt;' -MinimumTlsVersion '1.2'\n</code></pre>","tags":["Azure.Redis.MinTLS","AZR-000164"]},{"location":"en/rules/Azure.Redis.MinTLS/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>DP-3: Encrypt sensitive data in transit</li> <li>Remove TLS 1.0 and 1.1 from use with Azure Cache for Redis</li> <li>Configure Azure Cache for Redis settings</li> <li>TLS encryption in Azure</li> <li>Preparing for TLS 1.2 in Microsoft Azure</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Redis.MinTLS","AZR-000164"]},{"location":"en/rules/Azure.Redis.NonSslPort/","title":"Use secure connections to Redis instances","text":"Azure.Redis.NonSslPortAZR-000163Error <p> Security  \u00b7  Azure Cache for Redis  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Azure Cache for Redis should only accept secure connections.</p>","tags":["Azure.Redis.NonSslPort","AZR-000163"]},{"location":"en/rules/Azure.Redis.NonSslPort/#description","title":"Description","text":"<p>Azure Cache for Redis can be configured to accept encrypted and unencrypted connections. By default, only encrypted communication is accepted. To accept unencrypted connections, the non-SSL port must be enabled. Using the non-SSL port for Azure Redis cache allows unencrypted communication to Redis cache.</p> <p>Unencrypted communication can potentially allow disclosure of sensitive information to an untrusted party.</p>","tags":["Azure.Redis.NonSslPort","AZR-000163"]},{"location":"en/rules/Azure.Redis.NonSslPort/#recommendation","title":"Recommendation","text":"<p>Consider only using secure connections to Redis cache by enabling SSL and disabling the non-SSL port.</p>","tags":["Azure.Redis.NonSslPort","AZR-000163"]},{"location":"en/rules/Azure.Redis.NonSslPort/#examples","title":"Examples","text":"","tags":["Azure.Redis.NonSslPort","AZR-000163"]},{"location":"en/rules/Azure.Redis.NonSslPort/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.enableNonSslPort</code> property to <code>false</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Cache/redis\",\n  \"apiVersion\": \"2024-03-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"redisVersion\": \"6\",\n    \"sku\": {\n      \"name\": \"Premium\",\n      \"family\": \"P\",\n      \"capacity\": 1\n    },\n    \"redisConfiguration\": {\n      \"aad-enabled\": \"True\",\n      \"maxmemory-reserved\": \"615\"\n    },\n    \"enableNonSslPort\": false,\n    \"publicNetworkAccess\": \"Disabled\"\n  },\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ]\n}\n</code></pre>","tags":["Azure.Redis.NonSslPort","AZR-000163"]},{"location":"en/rules/Azure.Redis.NonSslPort/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.enableNonSslPort</code> property to <code>false</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cache 'Microsoft.Cache/redis@2024-03-01' = {\n  name: name\n  location: location\n  properties: {\n    redisVersion: '6'\n    sku: {\n      name: 'Premium'\n      family: 'P'\n      capacity: 1\n    }\n    redisConfiguration: {\n      'aad-enabled': 'True'\n      'maxmemory-reserved': '615'\n    }\n    enableNonSslPort: false\n    publicNetworkAccess: 'Disabled'\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/cache/redis:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/cache/redis:0.8.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Redis.NonSslPort","AZR-000163"]},{"location":"en/rules/Azure.Redis.NonSslPort/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>How to configure Azure Cache for Redis</li> <li>DP-3: Encrypt sensitive data in transit</li> <li>Azure Policy Regulatory Compliance controls for Azure Cache for Redis</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Redis.NonSslPort","AZR-000163"]},{"location":"en/rules/Azure.Redis.PublicNetworkAccess/","title":"Use private endpoints with Azure Cache for Redis","text":"Azure.Redis.PublicNetworkAccessAZR-000165Error <p> Security  \u00b7  Azure Cache for Redis  \u00b7  Rule  \u00b7  2022_03  \u00b7  Critical</p> <p>Redis cache should disable public network access.</p>","tags":["Azure.Redis.PublicNetworkAccess","AZR-000165"]},{"location":"en/rules/Azure.Redis.PublicNetworkAccess/#description","title":"Description","text":"<p>When using Azure Cache for Redis, you can configure the cache to be private or accessible from the public Internet. By default, the cache is configured to be accessible from the public Internet.</p> <p>To limit network access to the cache you can use firewall rules or private endpoints. Using private endpoints with Azure Cache for Redis is the recommend approach for most scenarios.</p> <p>Use private endpoints to improve the security posture of your Redis cache and reduce the risk of data breaches.</p> <p>A private endpoint provides secure and private connectivity to Redis instances by:</p> <ul> <li>Using a private IP address from your VNET.</li> <li>Blocking all traffic from public networks.</li> </ul> <p>If you are using VNET injection, it is recommended to migrate to private endpoints.</p>","tags":["Azure.Redis.PublicNetworkAccess","AZR-000165"]},{"location":"en/rules/Azure.Redis.PublicNetworkAccess/#recommendation","title":"Recommendation","text":"<p>Consider using private endpoints to limit network connectivity to the cache and help reduce data exfiltration risks.</p>","tags":["Azure.Redis.PublicNetworkAccess","AZR-000165"]},{"location":"en/rules/Azure.Redis.PublicNetworkAccess/#examples","title":"Examples","text":"","tags":["Azure.Redis.PublicNetworkAccess","AZR-000165"]},{"location":"en/rules/Azure.Redis.PublicNetworkAccess/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Cache/redis\",\n  \"apiVersion\": \"2024-03-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"redisVersion\": \"6\",\n    \"sku\": {\n      \"name\": \"Premium\",\n      \"family\": \"P\",\n      \"capacity\": 1\n    },\n    \"redisConfiguration\": {\n      \"aad-enabled\": \"True\",\n      \"maxmemory-reserved\": \"615\"\n    },\n    \"enableNonSslPort\": false,\n    \"publicNetworkAccess\": \"Disabled\"\n  },\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ]\n}\n</code></pre>","tags":["Azure.Redis.PublicNetworkAccess","AZR-000165"]},{"location":"en/rules/Azure.Redis.PublicNetworkAccess/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.publicNetworkAccess</code> property to <code>Disabled</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cache 'Microsoft.Cache/redis@2024-03-01' = {\n  name: name\n  location: location\n  properties: {\n    redisVersion: '6'\n    sku: {\n      name: 'Premium'\n      family: 'P'\n      capacity: 1\n    }\n    redisConfiguration: {\n      'aad-enabled': 'True'\n      'maxmemory-reserved': '615'\n    }\n    enableNonSslPort: false\n    publicNetworkAccess: 'Disabled'\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/cache/redis:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/cache/redis:0.8.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Redis.PublicNetworkAccess","AZR-000165"]},{"location":"en/rules/Azure.Redis.PublicNetworkAccess/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Azure Cache for Redis with Azure Private Link</li> <li>Best practices for endpoint security on Azure</li> <li>Migrate from VNet injection caches to Private Link caches</li> <li>What is Azure Private Endpoint?</li> <li>NS-2: Secure cloud services with network controls</li> <li>Azure Policy Regulatory Compliance controls for Azure Cache for Redis</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Redis.PublicNetworkAccess","AZR-000165"]},{"location":"en/rules/Azure.Redis.Version/","title":"Redis version for Azure Cache for Redis","text":"Azure.Redis.VersionAZR-000347Error <p> Reliability  \u00b7  Azure Cache for Redis  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Azure Cache for Redis should use the latest supported version of Redis.</p>","tags":["Azure.Redis.Version","AZR-000347"]},{"location":"en/rules/Azure.Redis.Version/#description","title":"Description","text":"<p>Azure Cache for Redis supports Redis 6. Redis 6 brings new security features and better performance.</p> <p>Version 4 for Azure Cache for Redis instances will be retired on June 30, 3023.</p>","tags":["Azure.Redis.Version","AZR-000347"]},{"location":"en/rules/Azure.Redis.Version/#recommendation","title":"Recommendation","text":"<p>Consider upgrading Redis version for Azure Cache for Redis to the latest supported version (&gt;=6.0).</p>","tags":["Azure.Redis.Version","AZR-000347"]},{"location":"en/rules/Azure.Redis.Version/#examples","title":"Examples","text":"","tags":["Azure.Redis.Version","AZR-000347"]},{"location":"en/rules/Azure.Redis.Version/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.redisVersion</code> property to <code>latest</code> or <code>6</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Cache/redis\",\n  \"apiVersion\": \"2024-03-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"redisVersion\": \"6\",\n    \"sku\": {\n      \"name\": \"Premium\",\n      \"family\": \"P\",\n      \"capacity\": 1\n    },\n    \"redisConfiguration\": {\n      \"aad-enabled\": \"True\",\n      \"maxmemory-reserved\": \"615\"\n    },\n    \"enableNonSslPort\": false,\n    \"publicNetworkAccess\": \"Disabled\"\n  },\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ]\n}\n</code></pre>","tags":["Azure.Redis.Version","AZR-000347"]},{"location":"en/rules/Azure.Redis.Version/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.redisVersion</code> property to <code>latest</code> or <code>6</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cache 'Microsoft.Cache/redis@2024-03-01' = {\n  name: name\n  location: location\n  properties: {\n    redisVersion: '6'\n    sku: {\n      name: 'Premium'\n      family: 'P'\n      capacity: 1\n    }\n    redisConfiguration: {\n      'aad-enabled': 'True'\n      'maxmemory-reserved': '615'\n    }\n    enableNonSslPort: false\n    publicNetworkAccess: 'Disabled'\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/cache/redis:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/cache/redis:0.8.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Redis.Version","AZR-000347"]},{"location":"en/rules/Azure.Redis.Version/#notes","title":"Notes","text":"<p>This rule is only applicable for Azure Cache for Redis (OSS Redis) offering.</p>","tags":["Azure.Redis.Version","AZR-000347"]},{"location":"en/rules/Azure.Redis.Version/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Security operations</li> <li>Set Redis version for Azure Cache for Redis</li> <li>How to upgrade an existing Redis 4 cache to Redis 6</li> <li>Retirements from Azure Cache for Redis</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Redis.Version","AZR-000347"]},{"location":"en/rules/Azure.RedisEnterprise.MinTLS/","title":"Redis Cache minimum TLS version","text":"Azure.RedisEnterprise.MinTLSAZR-000301Error <p> Security  \u00b7  Azure Cache for Redis Enterprise  \u00b7  Rule  \u00b7  2022_09  \u00b7  Critical</p> <p>Redis Cache should reject TLS versions older than 1.2.</p>","tags":["Azure.RedisEnterprise.MinTLS","AZR-000301"]},{"location":"en/rules/Azure.RedisEnterprise.MinTLS/#description","title":"Description","text":"<p>The minimum version of TLS that Redis Cache accepts was previously configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS.</p> <p>Depending on when your cache was deployed you may be using a default that specifies an older version of TLS. Any new deployments do not allow TLS 1.0 or 1.1 to be specified, however existing cache deployment may require updating.</p> <p>Support for TLS 1.0 and TLS 1.1 will be removed in 1 November 2024.</p>","tags":["Azure.RedisEnterprise.MinTLS","AZR-000301"]},{"location":"en/rules/Azure.RedisEnterprise.MinTLS/#recommendation","title":"Recommendation","text":"<p>Consider configuring the minimum supported TLS version to be 1.2. No action is required for new cache deployments, which only support a minimum of TLS 1.2.</p>","tags":["Azure.RedisEnterprise.MinTLS","AZR-000301"]},{"location":"en/rules/Azure.RedisEnterprise.MinTLS/#examples","title":"Examples","text":"","tags":["Azure.RedisEnterprise.MinTLS","AZR-000301"]},{"location":"en/rules/Azure.RedisEnterprise.MinTLS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.minimumTlsVersion</code> property to a minimum of <code>1.2</code> for existing caches with an old version of TLS configured.   It is not possible to set the <code>properties.minimumTlsVersion</code> on new cache deployments.   New cache deployments only support a minimum TLS version of 1.2.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Cache/redisEnterprise\",\n  \"apiVersion\": \"2024-02-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Enterprise_E10\"\n  },\n  \"properties\": {\n    \"minimumTlsVersion\": \"1.2\"\n  }\n}\n</code></pre>","tags":["Azure.RedisEnterprise.MinTLS","AZR-000301"]},{"location":"en/rules/Azure.RedisEnterprise.MinTLS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Set the <code>properties.minimumTlsVersion</code> property to a minimum of <code>1.2</code> for existing caches with an old version of TLS configured.   It is not possible to set the <code>properties.minimumTlsVersion</code> on new cache deployments.   New cache deployments only support a minimum TLS version of 1.2.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource cache 'Microsoft.Cache/redisEnterprise@2024-02-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Enterprise_E10'\n  }\n  properties: {\n    minimumTlsVersion: '1.2'\n  }\n}\n</code></pre>","tags":["Azure.RedisEnterprise.MinTLS","AZR-000301"]},{"location":"en/rules/Azure.RedisEnterprise.MinTLS/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Use the <code>--set</code> parameter.   This parameter only applies to old cache deployments using TLS 1.0 or TLS 1.1.</li> </ul> <p>For example:</p> Azure CLI snippet<pre><code>az redis update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --set minimumTlsVersion=1.2\n</code></pre>","tags":["Azure.RedisEnterprise.MinTLS","AZR-000301"]},{"location":"en/rules/Azure.RedisEnterprise.MinTLS/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"<p>To deploy caches that pass this rule:</p> <ul> <li>Use the <code>-MinimumTlsVersion</code> parameter.   This parameter only applies to old cache deployments using TLS 1.0 or TLS 1.1.</li> </ul> <p>For example:</p> Azure PowerShell snippet<pre><code>Set-AzRedisCache -Name '&lt;name&gt;' -MinimumTlsVersion '1.2'\n</code></pre>","tags":["Azure.RedisEnterprise.MinTLS","AZR-000301"]},{"location":"en/rules/Azure.RedisEnterprise.MinTLS/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>DP-3: Encrypt sensitive data in transit</li> <li>Remove TLS 1.0 and 1.1 from use with Azure Cache for Redis</li> <li>Configure Azure Cache for Redis settings</li> <li>TLS encryption in Azure</li> <li>Preparing for TLS 1.2 in Microsoft Azure</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.RedisEnterprise.MinTLS","AZR-000301"]},{"location":"en/rules/Azure.RedisEnterprise.Zones/","title":"Enterprise Redis cache should use Availability zones in supported regions","text":"Azure.RedisEnterprise.ZonesAZR-000162Error <p> Reliability  \u00b7  Azure Cache for Redis Enterprise  \u00b7  Rule  \u00b7  2021_12  \u00b7  Important</p> <p>Enterprise Redis cache should be zone-redundant for high availability.</p>","tags":["Azure.RedisEnterprise.Zones","AZR-000162"]},{"location":"en/rules/Azure.RedisEnterprise.Zones/#description","title":"Description","text":"<p>Redis Cache using availability zones improve reliability and ensure availability during failure scenarios affecting a data center within a region. Nodes in one availability zone are physically separated from nodes defined in another availability zone. By spreading node pools across multiple zones, nodes in one node pool will continue running even if another zone has gone down.</p>","tags":["Azure.RedisEnterprise.Zones","AZR-000162"]},{"location":"en/rules/Azure.RedisEnterprise.Zones/#recommendation","title":"Recommendation","text":"<p>Consider using availability zones for Enterprise Redis Cache deployed in supported regions.</p>","tags":["Azure.RedisEnterprise.Zones","AZR-000162"]},{"location":"en/rules/Azure.RedisEnterprise.Zones/#examples","title":"Examples","text":"","tags":["Azure.RedisEnterprise.Zones","AZR-000162"]},{"location":"en/rules/Azure.RedisEnterprise.Zones/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To set availability zones for Enterprise SKU Redis Cache:</p> <ul> <li>Set <code>zones</code> to <code>[\"1\", \"2\", \"3\"]</code> or zone-redundancy.</li> <li>Set <code>Properties.sku.name</code> to one of:<ul> <li><code>Enterprise_E10</code> - 12 GB</li> <li><code>Enterprise_E20</code> - 25 GB</li> <li><code>Enterprise_E50</code> - 50 GB</li> <li><code>Enterprise_E100</code> - 100 GB</li> <li><code>EnterpriseFlash_F300</code> - 345 GB</li> <li><code>EnterpriseFlash_F700</code> - 715 GB</li> <li><code>EnterpriseFlash_F1500</code> - 1455 GB</li> </ul> </li> <li>Set <code>Properties.sku.capacity</code> to:<ul> <li>One of <code>[2, 4, 6, 8, 10]</code> if using <code>Enterprise_E10</code>, <code>Enterprise_E20</code>, <code>Enterprise_E50</code> or <code>Enterprise_E100</code>.</li> <li>Either <code>3</code> or <code>9</code> if using <code>EnterpriseFlash_F300</code>, <code>EnterpriseFlash_F700</code>, <code>EnterpriseFlash_F1500</code>.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"name\": \"testrediscache\",\n    \"type\": \"Microsoft.Cache/redisEnterprise\",\n    \"apiVersion\": \"2021-02-01-preview\",\n    \"properties\": {},\n    \"location\": \"australiaeast\",\n    \"dependsOn\": [],\n    \"sku\": {\n        \"name\": \"EnterpriseFlash_F700\",\n        \"capacity\": 3\n    },\n    \"zones\": [\n        \"1\",\n        \"2\",\n        \"3\"\n    ],\n    \"tags\": {},\n    \"resources\": [\n        {\n            \"name\": \"testrediscache/default\",\n            \"type\": \"Microsoft.Cache/redisEnterprise/databases\",\n            \"apiVersion\": \"2021-02-01-preview\",\n            \"properties\": {\n                \"clientProtocol\": \"Encrypted\",\n                \"evictionPolicy\": \"NoEviction\",\n                \"clusteringPolicy\": \"OSSCluster\",\n                \"persistence\": {\n                    \"aofEnabled\": false,\n                    \"rdbEnabled\": false\n                }\n            },\n            \"dependsOn\": [\n                \"Microsoft.Cache/redisEnterprise/testrediscache\"\n            ],\n            \"tags\": {}\n        }\n    ]\n}\n</code></pre>","tags":["Azure.RedisEnterprise.Zones","AZR-000162"]},{"location":"en/rules/Azure.RedisEnterprise.Zones/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To set availability zones for Enterprise SKU Redis Cache:</p> <ul> <li>Set <code>zones</code> to <code>[\"1\", \"2\", \"3\"]</code> or zone-redundancy.</li> <li>Set <code>Properties.sku.name</code> to one of:<ul> <li><code>Enterprise_E10</code> - 12 GB</li> <li><code>Enterprise_E20</code> - 25 GB</li> <li><code>Enterprise_E50</code> - 50 GB</li> <li><code>Enterprise_E100</code> - 100 GB</li> <li><code>EnterpriseFlash_F300</code> - 345 GB</li> <li><code>EnterpriseFlash_F700</code> - 715 GB</li> <li><code>EnterpriseFlash_F1500</code> - 1455 GB</li> </ul> </li> <li>Set <code>Properties.sku.capacity</code> to:<ul> <li>One of <code>[2, 4, 6, 8, 10]</code> if using <code>Enterprise_E10</code>, <code>Enterprise_E20</code>, <code>Enterprise_E50</code> or <code>Enterprise_E100</code>.</li> <li>Either <code>3</code> or <code>9</code> if using <code>EnterpriseFlash_F300</code>, <code>EnterpriseFlash_F700</code>, <code>EnterpriseFlash_F1500</code>.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource testrediscache 'Microsoft.Cache/redisEnterprise@2021-02-01-preview' = {\n  name: 'testrediscache'\n  properties: {}\n  location: 'australiaeast'\n  sku: {\n    name: 'EnterpriseFlash_F700'\n    capacity: 3\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n  tags: {}\n  dependsOn: []\n}\n\nresource testrediscache_default 'Microsoft.Cache/redisEnterprise/databases@2021-02-01-preview' = {\n  parent: testrediscache\n  name: 'default'\n  properties: {\n    clientProtocol: 'Encrypted'\n    evictionPolicy: 'NoEviction'\n    clusteringPolicy: 'OSSCluster'\n    persistence: {\n      aofEnabled: false\n      rdbEnabled: false\n    }\n  }\n  tags: {}\n}\n</code></pre>","tags":["Azure.RedisEnterprise.Zones","AZR-000162"]},{"location":"en/rules/Azure.RedisEnterprise.Zones/#notes","title":"Notes","text":"<p>This rule fails when cache is not zone redundant(1, 2 and 3) when there are availability zones for the given region.</p> <p>Configure <code>AZURE_REDISENTERPRISECACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST</code> to set additional availability zones that need to be supported which are not in the existing providers for namespace <code>Microsoft.Cache</code> and resource type <code>redisEnterprise</code>.</p> <pre><code># YAML: The default AZURE_REDISENTERPRISECACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option\nconfiguration:\n  AZURE_REDISENTERPRISECACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST: []\n</code></pre>","tags":["Azure.RedisEnterprise.Zones","AZR-000162"]},{"location":"en/rules/Azure.RedisEnterprise.Zones/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>Enable zone redundancy for Azure Cache for Redis</li> <li>High availability for Azure Cache for Redis</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.RedisEnterprise.Zones","AZR-000162"]},{"location":"en/rules/Azure.Resource.AllowedRegions/","title":"Use allowed regions","text":"Azure.Resource.AllowedRegionsAZR-000167Error <p> Security  \u00b7  All resources  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Resources should be deployed to allowed regions.</p>","tags":["Azure.Resource.AllowedRegions","AZR-000167"]},{"location":"en/rules/Azure.Resource.AllowedRegions/#description","title":"Description","text":"<p>Azure supports deployment to many locations around the world called regions. Many organizations have requirements that limit where data can be stored or processed. This is commonly known as data residency.</p> <p>Most Azure resources must be deployed to a specific region. To align with your organizational requirements, you may choose to limit the regions that resources can be deployed to.</p> <p>Some resources, particularly those related to preview services or features, may not be available in all regions.</p>","tags":["Azure.Resource.AllowedRegions","AZR-000167"]},{"location":"en/rules/Azure.Resource.AllowedRegions/#recommendation","title":"Recommendation","text":"<p>Consider deploying resources to allowed regions to align with your organizational requirements. Also consider using Azure Policy to enforce allowed regions at runtime.</p>","tags":["Azure.Resource.AllowedRegions","AZR-000167"]},{"location":"en/rules/Azure.Resource.AllowedRegions/#examples","title":"Examples","text":"","tags":["Azure.Resource.AllowedRegions","AZR-000167"]},{"location":"en/rules/Azure.Resource.AllowedRegions/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy resources that pass this rule:</p> <ul> <li>Set the <code>location</code> property to an allowed region. OR</li> <li>Instead of hard coding the location, use a parameter to allow the location to be specified at deployment time.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Storage/storageAccounts\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_GRS\"\n  },\n  \"kind\": \"StorageV2\",\n  \"properties\": {\n    \"allowBlobPublicAccess\": false,\n    \"supportsHttpsTrafficOnly\": true,\n    \"minimumTlsVersion\": \"TLS1_2\",\n    \"accessTier\": \"Hot\",\n    \"allowSharedKeyAccess\": false,\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.Resource.AllowedRegions","AZR-000167"]},{"location":"en/rules/Azure.Resource.AllowedRegions/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy resources that pass this rule:</p> <ul> <li>Set the <code>location</code> property to an allowed region. OR</li> <li>Instead of hard coding the location, use a parameter to allow the location to be specified at deployment time.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>@sys.description('The location resources will be deployed.')\nparam location string = resourceGroup().location\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard_GRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    allowBlobPublicAccess: false\n    supportsHttpsTrafficOnly: true\n    minimumTlsVersion: 'TLS1_2'\n    accessTier: 'Hot'\n    allowSharedKeyAccess: false\n    networkAcls: {\n      defaultAction: 'Deny'\n    }\n  }\n}\n</code></pre>","tags":["Azure.Resource.AllowedRegions","AZR-000167"]},{"location":"en/rules/Azure.Resource.AllowedRegions/#notes","title":"Notes","text":"<p>This rule requires one or more allowed regions to be configured. By default, all regions are allowed.</p>","tags":["Azure.Resource.AllowedRegions","AZR-000167"]},{"location":"en/rules/Azure.Resource.AllowedRegions/#rule-configuration","title":"Rule configuration","text":"<p>AZURE_RESOURCE_ALLOWED_LOCATIONS</p> <p>To configure this rule set the <code>AZURE_RESOURCE_ALLOWED_LOCATIONS</code> configuration value to a set of allowed regions.</p> <p>For example:</p> <pre><code>configuration:\n  AZURE_RESOURCE_ALLOWED_LOCATIONS:\n  - australiaeast\n  - australiasoutheast\n</code></pre> <p>If you configure this <code>AZURE_RESOURCE_ALLOWED_LOCATIONS</code> configuration value, also consider setting <code>AZURE_RESOURCE_GROUP</code> the configuration value to when resources use the location of the resource group.</p> <p>For example:</p> <pre><code>configuration:\n  AZURE_RESOURCE_GROUP:\n    location: australiaeast\n</code></pre>","tags":["Azure.Resource.AllowedRegions","AZR-000167"]},{"location":"en/rules/Azure.Resource.AllowedRegions/#links","title":"Links","text":"<ul> <li>SE:01 Security baseline</li> <li>Data residency in Azure</li> <li>Azure geographies</li> </ul>","tags":["Azure.Resource.AllowedRegions","AZR-000167"]},{"location":"en/rules/Azure.Resource.UseTags/","title":"Use resource tags","text":"Azure.Resource.UseTagsAZR-000166Error <p> Cost Optimization  \u00b7  All resources  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Azure resources should be tagged using a standard convention.</p>","tags":["Azure.Resource.UseTags","AZR-000166"]},{"location":"en/rules/Azure.Resource.UseTags/#description","title":"Description","text":"<p>Azure Resource Manager (ARM) supports a flexible tagging model that allows each resource to be tagged. Tags are additional metadata that improves identification of resources and aids lifecycle management.</p> <p>Azure stores tags as name/ value pairs such as <code>environment = production</code> or <code>costCode = 349921</code>.</p> <p>A well defined tagging approach improves the management, billing, and automation operations of resources. When planning tags, identify information that is meaningful to business and technical staff.</p> <p>Azure provides several built-in policies to managed tags. Using these policies help enforce a tagging standard can reduce overall management Resource tags can be inherited from subscriptions or resource groups using Azure Policy.</p>","tags":["Azure.Resource.UseTags","AZR-000166"]},{"location":"en/rules/Azure.Resource.UseTags/#recommendation","title":"Recommendation","text":"<p>Consider tagging resources using a standard convention. Identify mandatory and optional tags then tag all resources and resource groups using this standard.</p> <p>Also consider using Azure Policy to enforce mandatory tags.</p>","tags":["Azure.Resource.UseTags","AZR-000166"]},{"location":"en/rules/Azure.Resource.UseTags/#examples","title":"Examples","text":"","tags":["Azure.Resource.UseTags","AZR-000166"]},{"location":"en/rules/Azure.Resource.UseTags/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy resource that pass this rule:</p> <ul> <li>Set the <code>tags</code> property tags that align to your tagging standard.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Resources/resourceGroups\",\n  \"apiVersion\": \"2022-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"tags\": {\n    \"environment\": \"production\",\n    \"costCode\": \"349921\"\n  }\n}\n</code></pre>","tags":["Azure.Resource.UseTags","AZR-000166"]},{"location":"en/rules/Azure.Resource.UseTags/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy resource that pass this rule:</p> <ul> <li>Set the <code>tags</code> property tags that align to your tagging standard.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource rg 'Microsoft.Resources/resourceGroups@2022-09-01' = {\n  name: name\n  location: location\n  tags: {\n    environment: 'production'\n    costCode: '349921'\n  }\n}\n</code></pre>","tags":["Azure.Resource.UseTags","AZR-000166"]},{"location":"en/rules/Azure.Resource.UseTags/#notes","title":"Notes","text":"<p>Azure Policy includes several built-in policies to enforce tagging such as:</p> <ul> <li>Add a tag to resources</li> <li>Add a tag to resource groups</li> <li>Require a tag on resources</li> <li>Require a tag on resource groups</li> <li>Inherit a tag from the resource group</li> <li>Inherit a tag from the resource group if missing</li> <li>Inherit a tag from the subscription</li> </ul> <p>If you find resources that incorrectly report they should be tagged, please let us know by opening an issue.</p>","tags":["Azure.Resource.UseTags","AZR-000166"]},{"location":"en/rules/Azure.Resource.UseTags/#links","title":"Links","text":"<ul> <li>CO:03 Cost data and reporting</li> <li>Design review checklist for Cost Optimization</li> <li>Tag support for Azure resources</li> <li>Develop your naming and tagging strategy for Azure resources</li> <li>Define your tagging strategy</li> <li>Resource naming and tagging decision guide</li> <li>Assign policy definitions for tag compliance</li> <li>Enforcing custom tags</li> </ul>","tags":["Azure.Resource.UseTags","AZR-000166"]},{"location":"en/rules/Azure.ResourceGroup.Name/","title":"Use valid resource group names","text":"Azure.ResourceGroup.NameAZR-000168Error <p> Operational Excellence  \u00b7  Resource Group  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Resource Group names should meet naming requirements.</p>","tags":["Azure.ResourceGroup.Name","AZR-000168"]},{"location":"en/rules/Azure.ResourceGroup.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Resource Group names are:</p> <ul> <li>Between 1 and 90 characters long.</li> <li>Alphanumerics, underscores, parentheses, hyphens, periods.</li> <li>Can't end with period.</li> <li>Resource Group names must be unique within a subscription.</li> </ul>","tags":["Azure.ResourceGroup.Name","AZR-000168"]},{"location":"en/rules/Azure.ResourceGroup.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Resource Group naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.ResourceGroup.Name","AZR-000168"]},{"location":"en/rules/Azure.ResourceGroup.Name/#notes","title":"Notes","text":"<p>This rule does not check if Resource Group names are unique.</p>","tags":["Azure.ResourceGroup.Name","AZR-000168"]},{"location":"en/rules/Azure.ResourceGroup.Name/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> </ul>","tags":["Azure.ResourceGroup.Name","AZR-000168"]},{"location":"en/rules/Azure.Route.Name/","title":"Use valid Route table names","text":"Azure.Route.NameAZR-000169Error <p> Operational Excellence  \u00b7  Route table  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Route table names should meet naming requirements.</p>","tags":["Azure.Route.Name","AZR-000169"]},{"location":"en/rules/Azure.Route.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Route table names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>Route table names must be unique within a resource group.</li> </ul>","tags":["Azure.Route.Name","AZR-000169"]},{"location":"en/rules/Azure.Route.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Route table naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.Route.Name","AZR-000169"]},{"location":"en/rules/Azure.Route.Name/#notes","title":"Notes","text":"<p>This rule does not check if Route table names are unique.</p>","tags":["Azure.Route.Name","AZR-000169"]},{"location":"en/rules/Azure.Route.Name/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> <li>Recommended abbreviations for Azure resource types</li> </ul>","tags":["Azure.Route.Name","AZR-000169"]},{"location":"en/rules/Azure.SQL.AAD/","title":"Use Entra ID authentication with SQL databases","text":"Azure.SQL.AADAZR-000188Error <p> Security  \u00b7  SQL Database  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Use Entra ID authentication with Azure SQL databases.</p>","tags":["Azure.SQL.AAD","AZR-000188"]},{"location":"en/rules/Azure.SQL.AAD/#description","title":"Description","text":"<p>Azure SQL Database offer two authentication models, Entra ID (previously known as Azure AD) and SQL authentication. Entra ID authentication supports centralized identity management in addition to modern password protections. Some of the benefits of Entra ID authentication over SQL authentication including:</p> <ul> <li>Support for Azure Multi-Factor Authentication (MFA).</li> <li>Conditional-based access with Conditional Access.</li> </ul> <p>It is also possible to disable SQL authentication entirely and only use Entra ID authentication.</p>","tags":["Azure.SQL.AAD","AZR-000188"]},{"location":"en/rules/Azure.SQL.AAD/#recommendation","title":"Recommendation","text":"<p>Consider using Entra ID authentication with SQL databases. Additionally, consider disabling SQL authentication.</p>","tags":["Azure.SQL.AAD","AZR-000188"]},{"location":"en/rules/Azure.SQL.AAD/#examples","title":"Examples","text":"","tags":["Azure.SQL.AAD","AZR-000188"]},{"location":"en/rules/Azure.SQL.AAD/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy logical SQL Servers that pass this rule:</p> <ul> <li>Set the <code>properties.administrators.administratorType</code> to <code>ActiveDirectory</code>.</li> <li>Set the <code>properties.administrators.login</code> to the administrator login object name.</li> <li>Set the <code>properties.administrators.sid</code> to the object ID GUID of the administrator user, group, or application.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Sql/servers\",\n  \"apiVersion\": \"2022-11-01-preview\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"publicNetworkAccess\": \"Disabled\",\n    \"minimalTlsVersion\": \"1.2\",\n    \"administrators\": {\n      \"azureADOnlyAuthentication\": true,\n      \"administratorType\": \"ActiveDirectory\",\n      \"login\": \"[parameters('adminLogin')]\",\n      \"principalType\": \"Group\",\n      \"sid\": \"[parameters('adminPrincipalId')]\",\n      \"tenantId\": \"[tenant().tenantId]\"\n    }\n  }\n}\n</code></pre> <p>Alternatively, you can configure the <code>Microsoft.Sql/servers/administrators</code> sub-resource. To deploy <code>Microsoft.Sql/servers/administrators</code> sub-resources that pass this rule:</p> <ul> <li>Set the <code>properties.administratorType</code> to <code>ActiveDirectory</code>.</li> <li>Set the <code>properties.login</code> to the administrator login object name.</li> <li>Set the <code>properties.sid</code> to the object ID GUID of the administrator user, group, or application.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Sql/servers/administrators\",\n  \"apiVersion\": \"2022-02-01-preview\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), 'ActiveDirectory')]\",\n  \"properties\": {\n    \"administratorType\": \"ActiveDirectory\",\n    \"login\": \"[parameters('adminLogin')]\",\n    \"sid\": \"[parameters('adminPrincipalId')]\"\n  },\n  \"dependsOn\": [\n    \"server\"\n  ]\n}\n</code></pre>","tags":["Azure.SQL.AAD","AZR-000188"]},{"location":"en/rules/Azure.SQL.AAD/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy logical SQL Servers that pass this rule:</p> <ul> <li>Set the <code>properties.administrators.administratorType</code> to <code>ActiveDirectory</code>.</li> <li>Set the <code>properties.administrators.login</code> to the administrator login object name.</li> <li>Set the <code>properties.administrators.sid</code> to the object ID GUID of the administrator user, group, or application.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource server 'Microsoft.Sql/servers@2022-11-01-preview' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    publicNetworkAccess: 'Disabled'\n    minimalTlsVersion: '1.2'\n    administrators: {\n      azureADOnlyAuthentication: true\n      administratorType: 'ActiveDirectory'\n      login: adminLogin\n      principalType: 'Group'\n      sid: adminPrincipalId\n      tenantId: tenant().tenantId\n    }\n  }\n}\n</code></pre> <p>Alternatively, you can configure the <code>Microsoft.Sql/servers/administrators</code> sub-resource. To deploy <code>Microsoft.Sql/servers/administrators</code> sub-resources that pass this rule:</p> <ul> <li>Set the <code>properties.administratorType</code> to <code>ActiveDirectory</code>.</li> <li>Set the <code>properties.login</code> to the administrator login object name.</li> <li>Set the <code>properties.sid</code> to the object ID GUID of the administrator user, group, or application.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource sqlAdministrator 'Microsoft.Sql/servers/administrators@2022-02-01-preview' = {\n  parent: server\n  name: 'ActiveDirectory'\n  properties: {\n    administratorType: 'ActiveDirectory'\n    login: adminLogin\n    sid: adminPrincipalId\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/sql/server:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/sql/server:0.9.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.SQL.AAD","AZR-000188"]},{"location":"en/rules/Azure.SQL.AAD/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az sql server ad-admin create -s '&lt;server_name&gt;' -g '&lt;resource_group&gt;' -u '&lt;user_name&gt;' -i '&lt;object_id&gt;'\n</code></pre>","tags":["Azure.SQL.AAD","AZR-000188"]},{"location":"en/rules/Azure.SQL.AAD/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Set-AzSqlServerActiveDirectoryAdministrator -ResourceGroupName '&lt;resource_group&gt;' -ServerName '&lt;server_name&gt;' -DisplayName '&lt;user_name&gt;'\n</code></pre>","tags":["Azure.SQL.AAD","AZR-000188"]},{"location":"en/rules/Azure.SQL.AAD/#notes","title":"Notes","text":"<p>In newer API versions the <code>properties.administrators</code> property can be configured. Entra ID authentication can also be configured using the <code>Microsoft.Sql/servers/administrators</code> sub-resource.</p> <p>If both the <code>properties.administrators</code> property and <code>Microsoft.Sql/servers/administrators</code> are set, the sub-resource will override the property.</p>","tags":["Azure.SQL.AAD","AZR-000188"]},{"location":"en/rules/Azure.SQL.AAD/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>IM-1: Use centralized identity and authentication system</li> <li>Configure and manage Microsoft Entra authentication with Azure SQL</li> <li>Using Microsoft Entra multi-factor authentication</li> <li>Conditional Access with Azure SQL Database and Azure Synapse Analytics</li> <li>Microsoft Entra-only authentication with Azure SQL</li> <li>Azure Policy for Microsoft Entra-only authentication with Azure SQL</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.SQL.AAD","AZR-000188"]},{"location":"en/rules/Azure.SQL.AADOnly/","title":"Databases use Entra ID only authentication","text":"Azure.SQL.AADOnlyAZR-000369Error <p> Security  \u00b7  SQL Database  \u00b7  Rule  \u00b7  2023_03  \u00b7  Important</p> <p>Ensure Entra ID only authentication is enabled with Azure SQL Database.</p>","tags":["Azure.SQL.AADOnly","AZR-000369"]},{"location":"en/rules/Azure.SQL.AADOnly/#description","title":"Description","text":"<p>Azure SQL Database supports authentication with SQL logins and Entra ID (previously known as Azure AD) authentication. By default, authentication with SQL logins is enabled. SQL logins are unable to provide sufficient protection for identities.</p> <p>Entra ID authentication provides:</p> <ul> <li>Strong protection controls including conditional access, identity governance, and privileged identity management.</li> <li>Centralized identity management with Entra ID.</li> </ul> <p>Additionally you can disable SQL authentication entirely, by enabling Entra ID only authentication.</p> <p>Some features may have limitations when using Entra ID only authentication is enabled, including:</p> <ul> <li>Elastic jobs</li> <li>SQL Data Sync</li> <li>Change Data Capture (CDC)</li> <li>Transactional replication</li> <li>SQL insights</li> </ul>","tags":["Azure.SQL.AADOnly","AZR-000369"]},{"location":"en/rules/Azure.SQL.AADOnly/#recommendation","title":"Recommendation","text":"<p>Consider using Entra ID only authentication. Also consider using Azure Policy for Entra ID only authentication with SQL Database.</p>","tags":["Azure.SQL.AADOnly","AZR-000369"]},{"location":"en/rules/Azure.SQL.AADOnly/#examples","title":"Examples","text":"<p>Azure AD-only authentication can be enabled in two different ways.</p>","tags":["Azure.SQL.AADOnly","AZR-000369"]},{"location":"en/rules/Azure.SQL.AADOnly/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy SQL Logical Servers that pass this rule:</p> <ul> <li>Set the <code>properties.administrators.azureADOnlyAuthentication</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Sql/servers\",\n  \"apiVersion\": \"2022-05-01-preview\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\",\n    \"userAssignedIdentities\": {}\n  },\n  \"properties\": {\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"administrators\": {\n      \"administratorType\": \"ActiveDirectory\",\n      \"azureADOnlyAuthentication\": true,\n      \"login\": \"[parameters('login')]\",\n      \"principalType\": \"[parameters('principalType')]\",\n      \"sid\": \"[parameters('sid')]\",\n      \"tenantId\": \"[parameters('tenantId')]\"\n    }\n  }\n}\n</code></pre> <p>Alternatively, you can configure the <code>Microsoft.Sql/servers/azureADOnlyAuthentications</code> sub-resource. To deploy <code>Microsoft.Sql/servers/azureADOnlyAuthentications</code> sub-resources that pass this rule:</p> <ul> <li>Set the <code>properties.azureADOnlyAuthentication</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Sql/servers/azureADOnlyAuthentications\",\n  \"apiVersion\": \"2022-05-01-preview\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), 'Default')]\",\n  \"properties\": {\n    \"azureADOnlyAuthentication\": true\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Sql/servers', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.SQL.AADOnly","AZR-000369"]},{"location":"en/rules/Azure.SQL.AADOnly/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy SQL Logical Servers that pass this rule:</p> <ul> <li>Set the <code>properties.administrators.azureADOnlyAuthentication</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource logicalServer 'Microsoft.Sql/servers@2022-05-01-preview' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n    userAssignedIdentities: {}\n  }\n  properties: {\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    administrators: {\n      administratorType: 'ActiveDirectory'\n      azureADOnlyAuthentication: true\n      login: login\n      principalType: principalType\n      sid: sid\n      tenantId: tenantId\n    }\n  }\n}\n</code></pre> <p>Alternatively, you can configure the <code>Microsoft.Sql/servers/azureADOnlyAuthentications</code> sub-resource. To deploy <code>Microsoft.Sql/servers/azureADOnlyAuthentications</code> sub-resources that pass this rule:</p> <ul> <li>Set the <code>properties.azureADOnlyAuthentication</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource aadOnly 'Microsoft.Sql/servers/azureADOnlyAuthentications@2022-05-01-preview' = {\n  name: 'Default'\n  parent: logicalServer\n  properties: {\n    azureADOnlyAuthentication: true\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/sql/server:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/sql/server:0.9.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.SQL.AADOnly","AZR-000369"]},{"location":"en/rules/Azure.SQL.AADOnly/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Azure SQL Database should have Microsoft Entra-only authentication enabled during creation <code>/providers/Microsoft.Authorization/policyDefinitions/abda6d70-9778-44e7-84a8-06713e6db027</code></li> </ul>","tags":["Azure.SQL.AADOnly","AZR-000369"]},{"location":"en/rules/Azure.SQL.AADOnly/#notes","title":"Notes","text":"<p>The Entra ID admin must be set before enabling Entra ID only authentication. A managed identity is required if an Entra ID service principal (Entra ID application) oversees creating and managing Entra ID users, groups, or applications in the logical server.</p>","tags":["Azure.SQL.AADOnly","AZR-000369"]},{"location":"en/rules/Azure.SQL.AADOnly/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Microsoft Entra-only authentication with Azure SQL</li> <li>Configure and manage Microsoft Entra authentication with Azure SQL</li> <li>Limitations for Microsoft Entra-only authentication in SQL Database</li> <li>Azure Policy for Microsoft Entra-only authentication with Azure SQL</li> <li>Azure deployment reference</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.SQL.AADOnly","AZR-000369"]},{"location":"en/rules/Azure.SQL.AllowAzureAccess/","title":"Limit SQL database network access to trusted IP addresses","text":"Azure.SQL.AllowAzureAccessAZR-000184Error <p> Security  \u00b7  SQL Database  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Determine if access from Azure services is required.</p>","tags":["Azure.SQL.AllowAzureAccess","AZR-000184"]},{"location":"en/rules/Azure.SQL.AllowAzureAccess/#description","title":"Description","text":"<p>Allow access to Azure services, permits any Azure service network based access to databases. Network based access it not limited to a single customer, all Azure IP addresses are permitted. Network access can also be allowed/ blocked on individual databases, which takes precedence over server firewall rules.</p> <p>If network based access is permitted, authentication is still required.</p> <p>Enabling access from Azure Services is useful in certain cases for on demand PaaS workloads where configuring a stable IP address is not possible. For example Azure Functions, Container Instances and Logic Apps.</p>","tags":["Azure.SQL.AllowAzureAccess","AZR-000184"]},{"location":"en/rules/Azure.SQL.AllowAzureAccess/#recommendation","title":"Recommendation","text":"<p>Consider using a stable IP address or configure virtual network based firewall rules. Determine if access from Azure services is required for the services connecting to the hosted databases.</p>","tags":["Azure.SQL.AllowAzureAccess","AZR-000184"]},{"location":"en/rules/Azure.SQL.AllowAzureAccess/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Connections from inside Azure</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.SQL.AllowAzureAccess","AZR-000184"]},{"location":"en/rules/Azure.SQL.Auditing/","title":"Enable auditing for Azure SQL DB server","text":"Azure.SQL.AuditingAZR-000187Error <p> Security  \u00b7  SQL Database  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Enable auditing for Azure SQL logical server.</p>","tags":["Azure.SQL.Auditing","AZR-000187"]},{"location":"en/rules/Azure.SQL.Auditing/#description","title":"Description","text":"<p>Auditing for Azure SQL Database tracks database events and writes them to an audit log. Data collected from auditing can be used to help find suspicious events, unusual activity, and trends.</p> <p>When managing security events at scale, it is important to have a centralized location to store and analyze security data. A security information and event management (SIEM) system to consolidate security data in a central location. Once the security data is in a central location it can be correlated across various services. Security orchestration, automation, and response (SOAR) tools can be used to automate responses to security events.</p> <p>Microsoft Sentinel is a scalable, cloud-native solution that provides:</p> <ul> <li>Security information and event management (SIEM).</li> <li>Security orchestration, automation, and response (SOAR).</li> </ul>","tags":["Azure.SQL.Auditing","AZR-000187"]},{"location":"en/rules/Azure.SQL.Auditing/#recommendation","title":"Recommendation","text":"<p>Consider enabling auditing for each SQL Database logical server and review reports on a regular basis. Also consider enforcing this setting using Azure Policy.</p>","tags":["Azure.SQL.Auditing","AZR-000187"]},{"location":"en/rules/Azure.SQL.Auditing/#examples","title":"Examples","text":"","tags":["Azure.SQL.Auditing","AZR-000187"]},{"location":"en/rules/Azure.SQL.Auditing/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy logical servers that pass this rule:</p> <ul> <li>Define a <code>Microsoft.Sql/servers/auditingSettings</code> sub-resource with each logical server.</li> <li>Set the <code>properties.state</code> property to <code>Enabled</code> for the <code>Microsoft.Sql/servers/auditingSettings</code> sub-resource.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Sql/servers/auditingSettings\",\n  \"apiVersion\": \"2022-08-01-preview\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), 'default')]\",\n  \"properties\": {\n    \"isAzureMonitorTargetEnabled\": true,\n    \"state\": \"Enabled\",\n    \"retentionDays\": 7,\n    \"auditActionsAndGroups\": [\n      \"SUCCESSFUL_DATABASE_AUTHENTICATION_GROUP\",\n      \"FAILED_DATABASE_AUTHENTICATION_GROUP\",\n      \"BATCH_COMPLETED_GROUP\"\n    ]\n  },\n  \"dependsOn\": [\n    \"server\"\n  ]\n}\n</code></pre>","tags":["Azure.SQL.Auditing","AZR-000187"]},{"location":"en/rules/Azure.SQL.Auditing/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy logical servers that pass this rule:</p> <ul> <li>Define a <code>Microsoft.Sql/servers/auditingSettings</code> sub-resource with each logical server.</li> <li>Set the <code>properties.state</code> property to <code>Enabled</code> for the <code>Microsoft.Sql/servers/auditingSettings</code> sub-resource.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource server 'Microsoft.Sql/servers@2022-11-01-preview' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    publicNetworkAccess: 'Disabled'\n    minimalTlsVersion: '1.2'\n    administrators: {\n      azureADOnlyAuthentication: true\n      administratorType: 'ActiveDirectory'\n      login: adminLogin\n      principalType: 'Group'\n      sid: adminPrincipalId\n      tenantId: tenant().tenantId\n    }\n  }\n}\n\nresource sqlAuditSettings 'Microsoft.Sql/servers/auditingSettings@2022-08-01-preview' = {\n  name: 'default'\n  parent: server\n  properties: {\n    isAzureMonitorTargetEnabled: true\n    state: 'Enabled'\n    retentionDays: 7\n    auditActionsAndGroups: [\n      'SUCCESSFUL_DATABASE_AUTHENTICATION_GROUP'\n      'FAILED_DATABASE_AUTHENTICATION_GROUP'\n      'BATCH_COMPLETED_GROUP'\n    ]\n  }\n}\n</code></pre>","tags":["Azure.SQL.Auditing","AZR-000187"]},{"location":"en/rules/Azure.SQL.Auditing/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az sql server audit-policy update -g '&lt;resource_group&gt;' -n '&lt;server_name&gt;' --state Enabled --bsts Enabled --storage-account '&lt;storage_account_name&gt;'\n</code></pre>","tags":["Azure.SQL.Auditing","AZR-000187"]},{"location":"en/rules/Azure.SQL.Auditing/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Set-AzSqlServerAudit -ResourceGroupName '&lt;resource_group&gt;' -ServerName '&lt;server_name&gt;' -BlobStorageTargetState Enabled -StorageAccountResourceId '&lt;storage_resource_id&gt;'\n</code></pre>","tags":["Azure.SQL.Auditing","AZR-000187"]},{"location":"en/rules/Azure.SQL.Auditing/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Auditing on SQL server should be enabled <code>/providers/Microsoft.Authorization/policyDefinitions/a6fb4358-5bf4-4ad7-ba82-2cd2f41ce5e9</code></li> <li>Configure SQL servers to have auditing enabled <code>/providers/Microsoft.Authorization/policyDefinitions/f4c68484-132f-41f9-9b6d-3e4b1cb55036</code></li> </ul>","tags":["Azure.SQL.Auditing","AZR-000187"]},{"location":"en/rules/Azure.SQL.Auditing/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>LT-3: Enable logging for security investigation</li> <li>Auditing for Azure SQL Database and Azure Synapse Analytics</li> <li>What is Microsoft Sentinel?</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.SQL.Auditing","AZR-000187"]},{"location":"en/rules/Azure.SQL.DBName/","title":"Use valid SQL Database names","text":"Azure.SQL.DBNameAZR-000192Error <p> Operational Excellence  \u00b7  SQL Database  \u00b7  Rule  \u00b7  2020_12  \u00b7  Awareness</p> <p>Azure SQL Database names should meet naming requirements.</p>","tags":["Azure.SQL.DBName","AZR-000192"]},{"location":"en/rules/Azure.SQL.DBName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for SQL Database names are:</p> <ul> <li>Between 1 and 128 characters long.</li> <li>Letters, numbers, and special characters except: <code>&lt;&gt;*%&amp;:\\/?</code></li> <li>Can't end with period or a space.</li> <li>Azure SQL Database names must be unique for each logical server.</li> </ul> <p>The following reserved database names can not be used:</p> <ul> <li><code>master</code></li> <li><code>model</code></li> <li><code>tempdb</code></li> </ul>","tags":["Azure.SQL.DBName","AZR-000192"]},{"location":"en/rules/Azure.SQL.DBName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Azure SQL Database naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.SQL.DBName","AZR-000192"]},{"location":"en/rules/Azure.SQL.DBName/#notes","title":"Notes","text":"<p>This rule does not check if Azure SQL Database names are unique.</p>","tags":["Azure.SQL.DBName","AZR-000192"]},{"location":"en/rules/Azure.SQL.DBName/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> </ul>","tags":["Azure.SQL.DBName","AZR-000192"]},{"location":"en/rules/Azure.SQL.DefenderCloud/","title":"Use Advanced Threat Protection","text":"Azure.SQL.DefenderCloudAZR-000186Error <p> Security  \u00b7  SQL Database  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Enable Microsoft Defender for Azure SQL logical server.</p>","tags":["Azure.SQL.DefenderCloud","AZR-000186"]},{"location":"en/rules/Azure.SQL.DefenderCloud/#description","title":"Description","text":"<p>Enable Microsoft Defender for Azure SQL logical server.</p>","tags":["Azure.SQL.DefenderCloud","AZR-000186"]},{"location":"en/rules/Azure.SQL.DefenderCloud/#recommendation","title":"Recommendation","text":"<p>Consider enabling Advanced Data Security and configuring Microsoft Defender for SQL logical servers.</p>","tags":["Azure.SQL.DefenderCloud","AZR-000186"]},{"location":"en/rules/Azure.SQL.DefenderCloud/#examples","title":"Examples","text":"","tags":["Azure.SQL.DefenderCloud","AZR-000186"]},{"location":"en/rules/Azure.SQL.DefenderCloud/#configure-with-azure-template","title":"Configure with Azure template","text":"Azure Template snippet<pre><code>{\n  \"comments\": \"Create or update an Azure SQL logical server.\",\n  \"type\": \"Microsoft.Sql/servers\",\n  \"apiVersion\": \"2019-06-01-preview\",\n  \"name\": \"[parameters('serverName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"tags\": \"[parameters('tags')]\",\n  \"kind\": \"v12.0\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"administratorLogin\": \"[parameters('adminUsername')]\",\n    \"version\": \"12.0\",\n    \"publicNetworkAccess\": \"[if(parameters('allowPublicAccess'), 'Enabled', 'Disabled')]\",\n    \"administratorLoginPassword\": \"[parameters('adminPassword')]\",\n    \"minimalTLSVersion\": \"1.2\"\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.Sql/servers/securityAlertPolicies\",\n      \"apiVersion\": \"2020-02-02-preview\",\n      \"name\": \"[concat(parameters('serverName'), '/Default')]\",\n      \"dependsOn\": [\n        \"[resourceId('Microsoft.Sql/servers', parameters('serverName'))]\"\n      ],\n      \"properties\": {\n        \"state\": \"Enabled\"\n      }\n    }\n  ]\n}\n</code></pre>","tags":["Azure.SQL.DefenderCloud","AZR-000186"]},{"location":"en/rules/Azure.SQL.DefenderCloud/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Set-AzSqlDatabaseThreatDetectionPolicy -ResourceGroupName '&lt;resource_group&gt;' -ServerName '&lt;server_name&gt;' -DatabaseName '&lt;database&gt;' -StorageAccountName '&lt;account_name&gt;' -NotificationRecipientsEmails '&lt;email&gt;' -EmailAdmins $False\n</code></pre>","tags":["Azure.SQL.DefenderCloud","AZR-000186"]},{"location":"en/rules/Azure.SQL.DefenderCloud/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>SQL Advanced Threat Protection</li> <li>Microsoft Defender for SQL</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.SQL.DefenderCloud","AZR-000186"]},{"location":"en/rules/Azure.SQL.FGName/","title":"Use valid SQL failover group names","text":"Azure.SQL.FGNameAZR-000193Error <p> Operational Excellence  \u00b7  SQL Database  \u00b7  Rule  \u00b7  2020_12  \u00b7  Awareness</p> <p>Azure SQL failover group names should meet naming requirements.</p>","tags":["Azure.SQL.FGName","AZR-000193"]},{"location":"en/rules/Azure.SQL.FGName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for SQL failover group names are:</p> <ul> <li>Between 1 and 63 characters long.</li> <li>Lowercase letters, numbers, and hyphens.</li> <li>Can't start or end with a hyphen.</li> <li>SQL failover group names must be globally unique.</li> </ul>","tags":["Azure.SQL.FGName","AZR-000193"]},{"location":"en/rules/Azure.SQL.FGName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Azure SQL failover group naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.SQL.FGName","AZR-000193"]},{"location":"en/rules/Azure.SQL.FGName/#notes","title":"Notes","text":"<p>This rule does not check if Azure SQL failover group names are unique.</p>","tags":["Azure.SQL.FGName","AZR-000193"]},{"location":"en/rules/Azure.SQL.FGName/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> </ul>","tags":["Azure.SQL.FGName","AZR-000193"]},{"location":"en/rules/Azure.SQL.FirewallIPRange/","title":"SQL Database service firewall exposes a broad range of addresses","text":"Azure.SQL.FirewallIPRangeAZR-000185Error <p> Security  \u00b7  SQL Database  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server.</p>","tags":["Azure.SQL.FirewallIPRange","AZR-000185"]},{"location":"en/rules/Azure.SQL.FirewallIPRange/#description","title":"Description","text":"<p>The Azure SQL database service firewall is an important security control, that help restrict network access to data. Access to a database still requires an identity with permissions to read the data in addition to network access. Combining network and identity controls together further harden your environment against, use of compromised identities during lateral traversal and misuse of credentials.</p> <p>Typically the number of IP address rules permitted through the firewall is minimal, with management connectivity from on-premises and cloud application connectivity the most common. Excessive access from many IP addresses may indicate weak network security controls.</p>","tags":["Azure.SQL.FirewallIPRange","AZR-000185"]},{"location":"en/rules/Azure.SQL.FirewallIPRange/#recommendation","title":"Recommendation","text":"<p>Consider reducing the size or count of the IP ranges in the Firewall rules so that the total Allowed IPs are less than (10).</p>","tags":["Azure.SQL.FirewallIPRange","AZR-000185"]},{"location":"en/rules/Azure.SQL.FirewallIPRange/#notes","title":"Notes","text":"<p>This rule assesses the combined IP addresses from each Allowed IP firewall entry to check that the total allowed addresses is less than (10).</p>","tags":["Azure.SQL.FirewallIPRange","AZR-000185"]},{"location":"en/rules/Azure.SQL.FirewallIPRange/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Azure SQL Database and Azure Synapse IP firewall rules</li> <li>Create and manage IP firewall rules</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.SQL.FirewallIPRange","AZR-000185"]},{"location":"en/rules/Azure.SQL.FirewallRuleCount/","title":"Cleanup SQL logical server firewall rules","text":"Azure.SQL.FirewallRuleCountAZR-000183Error <p> Security  \u00b7  SQL Database  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Determine if there is an excessive number of firewall rules.</p>","tags":["Azure.SQL.FirewallRuleCount","AZR-000183"]},{"location":"en/rules/Azure.SQL.FirewallRuleCount/#description","title":"Description","text":"<p>Typically the number of firewall rules required is minimal, with management connectivity from on-premises and cloud application connectivity the most common.</p>","tags":["Azure.SQL.FirewallRuleCount","AZR-000183"]},{"location":"en/rules/Azure.SQL.FirewallRuleCount/#recommendation","title":"Recommendation","text":"<p>The logical SQL Server has greater then ten (10) firewall rules. Some rules may not be needed.</p>","tags":["Azure.SQL.FirewallRuleCount","AZR-000183"]},{"location":"en/rules/Azure.SQL.FirewallRuleCount/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Azure SQL Database and Azure Synapse IP firewall rules</li> <li>Create and manage IP firewall rules</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.SQL.FirewallRuleCount","AZR-000183"]},{"location":"en/rules/Azure.SQL.MaintenanceWindow/","title":"Customer-controlled maintenance window configuration","text":"Azure.SQL.MaintenanceWindowAZR-000440Error <p> Reliability  \u00b7  Azure Database  \u00b7  Rule  \u00b7  2024_09  \u00b7  Important</p> <p>Configure a customer-controlled maintenance window for Azure SQL databases.</p>","tags":["Azure.SQL.MaintenanceWindow","AZR-000440"]},{"location":"en/rules/Azure.SQL.MaintenanceWindow/#description","title":"Description","text":"<p>Azure SQL databases undergo periodic maintenance to ensure your managed database remains secure, stable, and up-to-date. This maintenance includes applying security updates, system upgrades, and software patches.</p> <p>Maintenance windows can be scheduled in two ways for each database:</p> <ul> <li>System-Managed Schedule: The system automatically selects a 9-hour maintenance window between 8:00 AM to 5:00 PM local time, Monday - Sunday.<ul> <li>Urgent updates may occur outside of it. To ensure all updates occur only during the maintenance window, select a non-default option.</li> </ul> </li> <li>Custom Schedule: You can specify a preferred 8-hour maintenance window by choosing between two non-default maintenance windows:<ul> <li>Weekday window: 10:00 PM to 6:00 AM local time, Monday - Thursday.</li> <li>Weekend window: 10:00 PM to 6:00 AM local time, Friday - Sunday.</li> </ul> </li> </ul> <p>By configuring a customer-controlled maintenance window, you can schedule updates to occur during a preferred time, ideally outside business hours, minimizing disruptions.</p> <p>There are limitations to the non-default maintenance windows. You can find more details about this in the documentation.</p>","tags":["Azure.SQL.MaintenanceWindow","AZR-000440"]},{"location":"en/rules/Azure.SQL.MaintenanceWindow/#recommendation","title":"Recommendation","text":"<p>Consider using a customer-controlled maintenance window to efficiently schedule updates and minimize disruptions.</p>","tags":["Azure.SQL.MaintenanceWindow","AZR-000440"]},{"location":"en/rules/Azure.SQL.MaintenanceWindow/#examples","title":"Examples","text":"","tags":["Azure.SQL.MaintenanceWindow","AZR-000440"]},{"location":"en/rules/Azure.SQL.MaintenanceWindow/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure databases that pass this rule:</p> <ul> <li>Set the <code>properties.maintenanceConfigurationId</code> property to <code>/subscriptions/&lt;subscriptionId&gt;/providers/Microsoft.Maintenance/publicMaintenanceConfigurations/SQL_&lt;RegionPlaceholder&gt;_DB_1</code> or <code>SQL_&lt;RegionPlaceholder&gt;_DB_2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Sql/servers/databases\",\n  \"apiVersion\": \"2023-05-01-preview\",\n  \"name\": \"[format('{0}/{1}', parameters('serverName'), parameters('sqlDbName'))]\",\n  \"location\": \"westeurope\",\n  \"sku\": {\n    \"name\": \"P1\",\n    \"tier\": \"Premium\"\n  },\n  \"properties\": {\n    \"maintenanceConfigurationId\": \"[subscriptionResourceId('Microsoft.Maintenance/publicMaintenanceConfigurations', 'SQL_WestEurope_DB_1')]\"\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Sql/servers', parameters('serverName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.SQL.MaintenanceWindow","AZR-000440"]},{"location":"en/rules/Azure.SQL.MaintenanceWindow/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure databases that pass this rule:</p> <ul> <li>Set the <code>properties.maintenanceConfigurationId</code> property to <code>/subscriptions/&lt;subscriptionId&gt;/providers/Microsoft.Maintenance/publicMaintenanceConfigurations/SQL_&lt;RegionPlaceholder&gt;_DB_1</code> or <code>SQL_&lt;RegionPlaceholder&gt;_DB_2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource maintenanceWindow 'Microsoft.Maintenance/publicMaintenanceConfigurations@2023-04-01' existing = {\n  scope: subscription()\n  name: 'SQL_WestEurope_DB_1'\n}\n\nresource sqlDb 'Microsoft.Sql/servers/databases@2023-05-01-preview' = {\n  parent: sqlServer\n  name: sqlDbName\n  location: 'westeurope'\n  sku: {\n    name: 'P1'\n    tier: 'Premium'\n  }\n  properties: {\n    maintenanceConfigurationId: maintenanceWindow.id\n  }\n}\n</code></pre>","tags":["Azure.SQL.MaintenanceWindow","AZR-000440"]},{"location":"en/rules/Azure.SQL.MaintenanceWindow/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Maintenance window in Azure SQL Database</li> <li>Configure maintenance window</li> <li>Azure deployment reference - Maintenance Configuration</li> <li>Azure deployment reference - Azure SQL Database</li> <li>Azure deployment reference - Elastic Pool</li> </ul>","tags":["Azure.SQL.MaintenanceWindow","AZR-000440"]},{"location":"en/rules/Azure.SQL.MinTLS/","title":"Azure SQL DB server minimum TLS version","text":"Azure.SQL.MinTLSAZR-000189Error <p> Security  \u00b7  SQL Database  \u00b7  Rule  \u00b7  2020_09  \u00b7  Critical</p> <p>Azure SQL Database servers should reject TLS versions older than 1.2.</p>","tags":["Azure.SQL.MinTLS","AZR-000189"]},{"location":"en/rules/Azure.SQL.MinTLS/#description","title":"Description","text":"<p>The minimum version of TLS that Azure SQL Database servers accept is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS.</p> <p>Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted.</p> <p>When clients connect using an older version of TLS that is disabled, the connection will fail.</p>","tags":["Azure.SQL.MinTLS","AZR-000189"]},{"location":"en/rules/Azure.SQL.MinTLS/#recommendation","title":"Recommendation","text":"<p>Consider configuring the minimum supported TLS version to be 1.2. Also consider enforcing this setting using Azure Policy.</p>","tags":["Azure.SQL.MinTLS","AZR-000189"]},{"location":"en/rules/Azure.SQL.MinTLS/#examples","title":"Examples","text":"","tags":["Azure.SQL.MinTLS","AZR-000189"]},{"location":"en/rules/Azure.SQL.MinTLS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy logical SQL Servers that pass this rule:</p> <ul> <li>Set the <code>properties.minimalTlsVersion</code> to <code>1.2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Sql/servers\",\n  \"apiVersion\": \"2023-08-01-preview\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"publicNetworkAccess\": \"Disabled\",\n    \"minimalTlsVersion\": \"1.2\",\n    \"administrators\": {\n      \"azureADOnlyAuthentication\": true,\n      \"administratorType\": \"ActiveDirectory\",\n      \"login\": \"[parameters('adminLogin')]\",\n      \"principalType\": \"Group\",\n      \"sid\": \"[parameters('adminPrincipalId')]\",\n      \"tenantId\": \"[tenant().tenantId]\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.SQL.MinTLS","AZR-000189"]},{"location":"en/rules/Azure.SQL.MinTLS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy logical SQL Servers that pass this rule:</p> <ul> <li>Set the <code>properties.minimalTlsVersion</code> to <code>1.2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource server 'Microsoft.Sql/servers@2023-08-01-preview' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    publicNetworkAccess: 'Disabled'\n    minimalTlsVersion: '1.2'\n    administrators: {\n      azureADOnlyAuthentication: true\n      administratorType: 'ActiveDirectory'\n      login: adminLogin\n      principalType: 'Group'\n      sid: adminPrincipalId\n      tenantId: tenant().tenantId\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/sql/server:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/sql/server:0.9.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.SQL.MinTLS","AZR-000189"]},{"location":"en/rules/Azure.SQL.MinTLS/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Azure SQL Database should be running TLS version 1.2 or newer <code>/providers/Microsoft.Authorization/policyDefinitions/32e6bbec-16b6-44c2-be37-c5b672d103cf</code></li> </ul>","tags":["Azure.SQL.MinTLS","AZR-000189"]},{"location":"en/rules/Azure.SQL.MinTLS/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>DP-3: Encrypt sensitive data in transit</li> <li>Minimal TLS Version</li> <li>TLS encryption in Azure</li> <li>Preparing for TLS 1.2 in Microsoft Azure</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.SQL.MinTLS","AZR-000189"]},{"location":"en/rules/Azure.SQL.ServerName/","title":"Use valid SQL logical server names","text":"Azure.SQL.ServerNameAZR-000190Error <p> Operational Excellence  \u00b7  SQL Database  \u00b7  Rule  \u00b7  2020_12  \u00b7  Awareness</p> <p>Azure SQL logical server names should meet naming requirements.</p>","tags":["Azure.SQL.ServerName","AZR-000190"]},{"location":"en/rules/Azure.SQL.ServerName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for SQL logical server names are:</p> <ul> <li>Between 1 and 63 characters long.</li> <li>Lowercase letters, numbers, and hyphens.</li> <li>Can't start or end with a hyphen.</li> <li>SQL logical server names must be globally unique.</li> </ul>","tags":["Azure.SQL.ServerName","AZR-000190"]},{"location":"en/rules/Azure.SQL.ServerName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Azure SQL logical server naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.SQL.ServerName","AZR-000190"]},{"location":"en/rules/Azure.SQL.ServerName/#notes","title":"Notes","text":"<p>This rule does not check if Azure SQL logical server names are unique.</p>","tags":["Azure.SQL.ServerName","AZR-000190"]},{"location":"en/rules/Azure.SQL.ServerName/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> </ul>","tags":["Azure.SQL.ServerName","AZR-000190"]},{"location":"en/rules/Azure.SQL.TDE/","title":"Use SQL database TDE","text":"Azure.SQL.TDEAZR-000191Error <p> Security  \u00b7  SQL Database  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Use Transparent Data Encryption (TDE) with Azure SQL Database.</p>","tags":["Azure.SQL.TDE","AZR-000191"]},{"location":"en/rules/Azure.SQL.TDE/#description","title":"Description","text":"<p>TDE helps protect Azure SQL Databases against malicious offline access by encrypting data at rest. SQL Databases perform real-time encryption and decryption of the database, backups, and log files. Encryption is perform at rest without requiring changes to the application.</p> <p>By default, TDE is enabled for all user-defined databases.</p>","tags":["Azure.SQL.TDE","AZR-000191"]},{"location":"en/rules/Azure.SQL.TDE/#recommendation","title":"Recommendation","text":"<p>Consider enabling Transparent Data Encryption (TDE) for Azure SQL Databases to perform encryption at rest.</p>","tags":["Azure.SQL.TDE","AZR-000191"]},{"location":"en/rules/Azure.SQL.TDE/#examples","title":"Examples","text":"","tags":["Azure.SQL.TDE","AZR-000191"]},{"location":"en/rules/Azure.SQL.TDE/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy databases that pass this rule:</p> <ul> <li>Configure a <code>Microsoft.Sql/servers/databases/transparentDataEncryption</code> sub-resource.<ul> <li>Set the <code>properties.state</code> to <code>Enabled</code>.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Sql/servers/databases/transparentDataEncryption\",\n  \"apiVersion\": \"2023-08-01-preview\",\n  \"name\": \"[format('{0}/{1}/{2}', parameters('name'), parameters('name'), 'current')]\",\n  \"properties\": {\n    \"state\": \"Enabled\"\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Sql/servers/databases', parameters('name'), parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.SQL.TDE","AZR-000191"]},{"location":"en/rules/Azure.SQL.TDE/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy databases that pass this rule:</p> <ul> <li>Configure a <code>Microsoft.Sql/servers/databases/transparentDataEncryption</code> sub-resource.<ul> <li>Set the <code>properties.state</code> to <code>Enabled</code>.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource tde 'Microsoft.Sql/servers/databases/transparentDataEncryption@2023-08-01-preview' = {\n  parent: database\n  name: 'current'\n  properties: {\n    state: 'Enabled'\n  }\n}\n</code></pre>","tags":["Azure.SQL.TDE","AZR-000191"]},{"location":"en/rules/Azure.SQL.TDE/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az sql db tde set --status Enabled -s '&lt;server_name&gt;' -d '&lt;database&gt;' -g '&lt;resource_group&gt;'\n</code></pre>","tags":["Azure.SQL.TDE","AZR-000191"]},{"location":"en/rules/Azure.SQL.TDE/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Set-AzSqlDatabaseTransparentDataEncryption -ResourceGroupName '&lt;resource_group&gt;' -ServerName '&lt;server_name&gt;' -DatabaseName '&lt;database&gt;' -State Enabled\n</code></pre>","tags":["Azure.SQL.TDE","AZR-000191"]},{"location":"en/rules/Azure.SQL.TDE/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Transparent Data Encryption on SQL databases should be enabled <code>/providers/Microsoft.Authorization/policyDefinitions/17k78e20-9358-41c9-923c-fb736d382a12</code></li> <li>Deploy SQL DB transparent data encryption <code>/providers/Microsoft.Authorization/policyDefinitions/86a912f6-9a06-4e26-b447-11b16ba8659f</code></li> </ul>","tags":["Azure.SQL.TDE","AZR-000191"]},{"location":"en/rules/Azure.SQL.TDE/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Transparent data encryption for SQL Database</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.SQL.TDE","AZR-000191"]},{"location":"en/rules/Azure.SQLMI.AAD/","title":"Use AAD authentication with SQL Managed Instance","text":"Azure.SQLMI.AADAZR-000368Error <p> Security  \u00b7  SQL Managed Instance  \u00b7  Rule  \u00b7  2023_03  \u00b7  Critical</p> <p>Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance.</p>","tags":["Azure.SQLMI.AAD","AZR-000368"]},{"location":"en/rules/Azure.SQLMI.AAD/#description","title":"Description","text":"<p>Azure SQL Managed Instance supports authentication with SQL logins and Azure AD authentication.</p> <p>By default, authentication with SQL logins is enabled. SQL logins are unable to provide sufficient protection for identities. Azure AD authentication provides strong protection controls including conditional access, identity governance, and privileged identity management.</p> <ul> <li>Support for Azure Multi-Factor Authentication (MFA).</li> <li>Conditional-based access with Conditional Access.</li> </ul> <p>Using Azure AD authentication requires an Azure AD administrator provisioned, if a instance does not have an Azure AD administrator, then Azure AD logins and users receive a <code>Cannot connect</code> to instance error.</p> <p>Once you decide to use Azure AD authentication, you can disable authentication with SQL logins.</p>","tags":["Azure.SQLMI.AAD","AZR-000368"]},{"location":"en/rules/Azure.SQLMI.AAD/#recommendation","title":"Recommendation","text":"<p>Consider using Azure Active Directory (AAD) authentication with SQL Managed Instance. Additionally, consider disabling SQL authentication.</p>","tags":["Azure.SQLMI.AAD","AZR-000368"]},{"location":"en/rules/Azure.SQLMI.AAD/#examples","title":"Examples","text":"<p>An Azure AD administrator can be provisioned in two different ways.</p>","tags":["Azure.SQLMI.AAD","AZR-000368"]},{"location":"en/rules/Azure.SQLMI.AAD/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy SQL Managed Instances that pass this rule:</p> <ul> <li>Set the <code>properties.administrators.administratorType</code> to <code>ActiveDirectory</code>.</li> <li>Set the <code>properties.administrators.login</code> to the administrator login object name.</li> <li>Set the <code>properties.administrators.sid</code> to the object ID GUID of the administrator user, group, or application.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Sql/managedInstances\",\n  \"apiVersion\": \"2022-05-01-preview\",\n  \"name\": \"[parameters('managedInstanceName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\",\n    \"userAssignedIdentities\": {}\n  },\n  \"properties\": {\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"administrators\": {\n      \"administratorType\": \"ActiveDirectory\",\n      \"azureADOnlyAuthentication\": true,\n      \"login\": \"[parameters('login')]\",\n      \"principalType\": \"[parameters('principalType')]\",\n      \"sid\": \"[parameters('sid')]\",\n      \"tenantId\": \"[parameters('tenantId')]\"\n    }\n  }\n}\n</code></pre> <p>Alternatively, you can configure the <code>Microsoft.Sql/managedInstances/administrators</code> sub-resource. To deploy <code>Microsoft.Sql/managedInstances/administrators</code> sub-resources that pass this rule:</p> <ul> <li>Set the <code>properties.administratorType</code> to <code>ActiveDirectory</code>.</li> <li>Set the <code>properties.login</code> to the administrator login object name.</li> <li>Set the <code>properties.sid</code> to the object ID GUID of the administrator user, group, or application.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Sql/managedInstances/administrators\",\n  \"apiVersion\": \"2022-05-01-preview\",\n  \"name\":  \"[format('{0}/{1}', parameters('managedInstanceName'), 'ActiveDirectory')]\",\n  \"properties\": {\n      \"administratorType\": \"ActiveDirectory\",\n      \"login\": \"[parameters('login')]\",\n      \"sid\": \"[parameters('sid')]\"\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Sql/managedInstances', parameters('managedInstanceName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.SQLMI.AAD","AZR-000368"]},{"location":"en/rules/Azure.SQLMI.AAD/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy SQL Managed Instances that pass this rule:</p> <ul> <li>Set the <code>properties.administrators.administratorType</code> to <code>ActiveDirectory</code>.</li> <li>Set the <code>properties.administrators.login</code> to the administrator login object name.</li> <li>Set the <code>properties.administrators.sid</code> to the object ID GUID of the administrator user, group, or application.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource managedInstance 'Microsoft.Sql/managedInstances@2022-05-01-preview' = {\n  name: managedInstanceName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n    userAssignedIdentities: {}\n  }\n  properties: {\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    administrators: {\n      administratorType: 'ActiveDirectory'\n      azureADOnlyAuthentication: true\n      login: login\n      principalType: principalType\n      sid: sid\n      tenantId: tenantId\n    }\n  }\n}\n</code></pre> <p>Alternatively, you can configure the <code>Microsoft.Sql/managedInstances/administrators</code> sub-resource. To deploy <code>Microsoft.Sql/managedInstances/administrators</code> sub-resources that pass this rule:</p> <ul> <li>Set the <code>properties.administratorType</code> to <code>ActiveDirectory</code>.</li> <li>Set the <code>properties.login</code> to the administrator login object name.</li> <li>Set the <code>properties.sid</code> to the object ID GUID of the administrator user, group, or application.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource sqlAdministrator 'Microsoft.Sql/managedInstances//administrators@2022-05-01-preview' = {\n  parent: managedInstance\n  name: 'ActiveDirectory'\n  properties: {\n    administratorType: 'ActiveDirectory'\n    login: login\n    sid: sid\n  }\n}\n</code></pre>","tags":["Azure.SQLMI.AAD","AZR-000368"]},{"location":"en/rules/Azure.SQLMI.AAD/#notes","title":"Notes","text":"<p>If both the <code>properties.administrators</code> property and <code>Microsoft.Sql/managedInstances/administrators</code> are set, the sub-resoure will override the property.</p> <p>Managed identity is required to allow support for Azure AD authentication in SQL Managed Instance.</p>","tags":["Azure.SQLMI.AAD","AZR-000368"]},{"location":"en/rules/Azure.SQLMI.AAD/#links","title":"Links","text":"<ul> <li>Use modern password protection</li> <li>Use Azure AD authentication</li> <li>Configure and manage Azure AD authentication</li> <li>Azure deployment reference</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.SQLMI.AAD","AZR-000368"]},{"location":"en/rules/Azure.SQLMI.AADOnly/","title":"Azure AD-only authentication","text":"Azure.SQLMI.AADOnlyAZR-000366Error <p> Security  \u00b7  SQL Managed Instance  \u00b7  Rule  \u00b7  2023_03  \u00b7  Important</p> <p>Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance.</p>","tags":["Azure.SQLMI.AADOnly","AZR-000366"]},{"location":"en/rules/Azure.SQLMI.AADOnly/#description","title":"Description","text":"<p>Azure SQL Managed Instance supports authentication with SQL logins and Azure AD authentication.</p> <p>By default, authentication with SQL logins is enabled. SQL logins are unable to provide sufficient protection for identities. Azure AD authentication provides strong protection controls including conditional access, identity governance, and privileged identity management.</p> <p>Once you decide to use Azure AD authentication, you can disable authentication with SQL logins.</p>","tags":["Azure.SQLMI.AADOnly","AZR-000366"]},{"location":"en/rules/Azure.SQLMI.AADOnly/#recommendation","title":"Recommendation","text":"<p>Consider using Azure AD-only authentication. Also consider using Azure Policy for Azure AD-only authentication with SQL Managed Instance.</p>","tags":["Azure.SQLMI.AADOnly","AZR-000366"]},{"location":"en/rules/Azure.SQLMI.AADOnly/#examples","title":"Examples","text":"<p>Azure AD-only authentication can be enabled in two different ways.</p>","tags":["Azure.SQLMI.AADOnly","AZR-000366"]},{"location":"en/rules/Azure.SQLMI.AADOnly/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy SQL Managed Instances that pass this rule:</p> <ul> <li>Set the <code>properties.administrators.azureADOnlyAuthentication</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Sql/managedInstances\",\n  \"apiVersion\": \"2022-05-01-preview\",\n  \"name\": \"[parameters('managedInstanceName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\",\n    \"userAssignedIdentities\": {}\n  },\n  \"properties\": {\n    \"administratorLogin\": \"[parameters('administratorLogin')]\",\n    \"administratorLoginPassword\": \"[parameters('administratorLoginPassword')]\",\n    \"administrators\": {\n      \"administratorType\": \"ActiveDirectory\",\n      \"azureADOnlyAuthentication\": true,\n      \"login\": \"[parameters('login')]\",\n      \"principalType\": \"[parameters('principalType')]\",\n      \"sid\": \"[parameters('sid')]\",\n      \"tenantId\": \"[parameters('tenantId')]\"\n    }\n  }\n}\n</code></pre> <p>Alternatively, you can configure the <code>Microsoft.Sql/managedInstances/azureADOnlyAuthentications</code> sub-resource. To deploy <code>Microsoft.Sql/managedInstances/azureADOnlyAuthentications</code> sub-resources that pass this rule:</p> <ul> <li>Set the <code>properties.azureADOnlyAuthentication</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Sql/managedInstances/azureADOnlyAuthentications\",\n  \"apiVersion\": \"2022-05-01-preview\",\n  \"name\": \"[format('{0}/{1}', parameters('managedInstanceName'), 'Default')]\",\n  \"properties\": {\n    \"azureADOnlyAuthentication\": true\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Sql/managedInstances', parameters('managedInstanceName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.SQLMI.AADOnly","AZR-000366"]},{"location":"en/rules/Azure.SQLMI.AADOnly/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy SQL Managed Instances that pass this rule:</p> <ul> <li>Set the <code>properties.administrators.azureADOnlyAuthentication</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource managedInstance 'Microsoft.Sql/managedInstances@2022-05-01-preview' = {\n  name: managedInstanceName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n    userAssignedIdentities: {}\n  }\n  properties: {\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    administrators: {\n      administratorType: 'ActiveDirectory'\n      azureADOnlyAuthentication: true\n      login: login\n      principalType: principalType\n      sid: sid\n      tenantId: tenantId\n    }\n  }\n}\n</code></pre> <p>Alternatively, you can configure the <code>Microsoft.Sql/managedInstances/azureADOnlyAuthentications</code> sub-resource. To deploy <code>Microsoft.Sql/managedInstances/azureADOnlyAuthentications</code> sub-resources that pass this rule:</p> <ul> <li>Set the <code>properties.azureADOnlyAuthentication</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource aadOnly 'Microsoft.Sql/managedInstances/azureADOnlyAuthentications@2022-05-01-preview' = {\n  name: 'Default'\n  parent: managedInstance\n  properties: {\n    azureADOnlyAuthentication: true\n  }\n}\n</code></pre>","tags":["Azure.SQLMI.AADOnly","AZR-000366"]},{"location":"en/rules/Azure.SQLMI.AADOnly/#notes","title":"Notes","text":"<p>The Azure AD admin must be set before enabling Azure AD-only authentication. Managed identity is required to allow support for Azure AD authentication in SQL Managed Instance.</p>","tags":["Azure.SQLMI.AADOnly","AZR-000366"]},{"location":"en/rules/Azure.SQLMI.AADOnly/#links","title":"Links","text":"<ul> <li>Use modern password protection</li> <li>Azure AD-only authentication with Azure SQL Managed Instance</li> <li>Configure and manage Azure AD authentication with Azure SQL Managed Instance</li> <li>Azure Policy for Azure AD-only authentication with Azure SQL Managed Instance</li> <li>Azure deployment reference</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.SQLMI.AADOnly","AZR-000366"]},{"location":"en/rules/Azure.SQLMI.MaintenanceWindow/","title":"Customer-controlled maintenance window configuration","text":"Azure.SQLMI.MaintenanceWindowAZR-000441Error <p> Reliability  \u00b7  SQL Managed Instance  \u00b7  Rule  \u00b7  2024_09  \u00b7  Important</p> <p>Configure a customer-controlled maintenance window for Azure SQL Managed Instances.</p>","tags":["Azure.SQLMI.MaintenanceWindow","AZR-000441"]},{"location":"en/rules/Azure.SQLMI.MaintenanceWindow/#description","title":"Description","text":"<p>Azure SQL Managed Instances undergo periodic maintenance to ensure your managed databases remains secure, stable, and up-to-date. This maintenance includes applying security updates, system upgrades, and software patches.</p> <p>Maintenance windows can be scheduled in two ways for each instance:</p> <ul> <li>System-Managed Schedule: The system automatically selects a 9-hour maintenance window between 8:00 AM to 5:00 PM local time, Monday - Sunday.<ul> <li>Urgent updates may occur outside of it. To ensure all updates occur only during the maintenance window, select a non-default option.</li> </ul> </li> <li>Custom Schedule: You can specify a preferred 8-hour maintenance window by choosing between two non-default maintenance windows:<ul> <li>Weekday window: 10:00 PM to 6:00 AM local time, Monday - Thursday.</li> <li>Weekend window: 10:00 PM to 6:00 AM local time, Friday - Sunday.</li> </ul> </li> </ul> <p>By configuring a customer-controlled maintenance window, you can schedule updates to occur during a preferred time, ideally outside business hours, minimizing disruptions.</p> <p>There are limitations to the non-default maintenance windows. You can find more details about this in the documentation.</p>","tags":["Azure.SQLMI.MaintenanceWindow","AZR-000441"]},{"location":"en/rules/Azure.SQLMI.MaintenanceWindow/#recommendation","title":"Recommendation","text":"<p>Consider using a customer-controlled maintenance window to efficiently schedule updates and minimize disruptions.</p>","tags":["Azure.SQLMI.MaintenanceWindow","AZR-000441"]},{"location":"en/rules/Azure.SQLMI.MaintenanceWindow/#examples","title":"Examples","text":"","tags":["Azure.SQLMI.MaintenanceWindow","AZR-000441"]},{"location":"en/rules/Azure.SQLMI.MaintenanceWindow/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure managed instances that pass this rule:</p> <ul> <li>Set the <code>properties.maintenanceConfigurationId</code> property to <code>/subscriptions/&lt;subscriptionId&gt;/providers/Microsoft.Maintenance/publicMaintenanceConfigurations/SQL_&lt;RegionPlaceholder&gt;_MI_1</code> or <code>SQL_&lt;RegionPlaceholder&gt;_MI_2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Sql/managedInstances\",\n  \"apiVersion\": \"2023-05-01-preview\",\n  \"name\": \"[parameters('sqlManagedInstanceName'))]\",\n  \"location\": \"westeurope\",\n  \"sku\": {\n    \"name\": \"GP_Gen5\",\n  },\n  \"properties\": {\n    \"maintenanceConfigurationId\": \"[subscriptionResourceId('Microsoft.Maintenance/publicMaintenanceConfigurations', 'SQL_WestEurope_MI_1')]\"\n  }\n}\n</code></pre>","tags":["Azure.SQLMI.MaintenanceWindow","AZR-000441"]},{"location":"en/rules/Azure.SQLMI.MaintenanceWindow/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure managed instances that pass this rule:</p> <ul> <li>Set the <code>properties.maintenanceConfigurationId</code> property to <code>/subscriptions/&lt;subscriptionId&gt;/providers/Microsoft.Maintenance/publicMaintenanceConfigurations/SQL_&lt;RegionPlaceholder&gt;_MI_1</code> or <code>SQL_&lt;RegionPlaceholder&gt;_MI_2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource maintenanceWindow 'Microsoft.Maintenance/publicMaintenanceConfigurations@2023-04-01' existing = {\n  scope: subscription()\n  name: 'SQL_WestEurope_MI_1'\n}\n\nresource sqlManagedInstance 'Microsoft.Sql/managedInstances@2023-05-01-preview' = {\n  name: sqlManagedInstanceName\n  location: 'westeurope'\n  sku: {\n    name: 'GP_Gen5'\n  }\n  properties: {\n    maintenanceConfigurationId: maintenanceWindow.id\n  }\n}\n</code></pre>","tags":["Azure.SQLMI.MaintenanceWindow","AZR-000441"]},{"location":"en/rules/Azure.SQLMI.MaintenanceWindow/#notes","title":"Notes","text":"<p>For managed instances within an instance pool, the maintenance configuration set at the instance pool level is inherited by all instances within that pool. However, instance pools do not support customer-controlled maintenance windows directly. To specify maintenance windows, you must configure them at the individual instance level, thereby overriding the inherited instance pool configuration.</p>","tags":["Azure.SQLMI.MaintenanceWindow","AZR-000441"]},{"location":"en/rules/Azure.SQLMI.MaintenanceWindow/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Maintenance window in Azure SQL Managed Instance</li> <li>Configure maintenance window</li> <li>Azure deployment reference - Maintenance Configuration</li> <li>Azure deployment reference - Azure SQL Managed Instance</li> </ul>","tags":["Azure.SQLMI.MaintenanceWindow","AZR-000441"]},{"location":"en/rules/Azure.SQLMI.ManagedIdentity/","title":"Managed identity","text":"Azure.SQLMI.ManagedIdentityAZR-000367Error <p> Security  \u00b7  SQL Managed Instance  \u00b7  Rule  \u00b7  2023_03  \u00b7  Important</p> <p>Ensure managed identity is used to allow support for Azure AD authentication.</p>","tags":["Azure.SQLMI.ManagedIdentity","AZR-000367"]},{"location":"en/rules/Azure.SQLMI.ManagedIdentity/#description","title":"Description","text":"<p>A managed identity is required for allowing support for Azure AD authentication in SQL Managed Instance.</p> <p>You must enable the instance identity (SMI or UMI) to allow support for Azure AD authentication in SQL Managed Instance. </p> <p>Additionally, a managed identity is required for transparent data encryption with customer-managed key.</p>","tags":["Azure.SQLMI.ManagedIdentity","AZR-000367"]},{"location":"en/rules/Azure.SQLMI.ManagedIdentity/#recommendation","title":"Recommendation","text":"<p>Consider configure a managed identity to allow support for Azure AD authentication.</p>","tags":["Azure.SQLMI.ManagedIdentity","AZR-000367"]},{"location":"en/rules/Azure.SQLMI.ManagedIdentity/#examples","title":"Examples","text":"","tags":["Azure.SQLMI.ManagedIdentity","AZR-000367"]},{"location":"en/rules/Azure.SQLMI.ManagedIdentity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy SQL Managed Instances that pass this rule:</p> <ul> <li>Set <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code> or <code>SystemAssigned,UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code> or <code>SystemAssigned,UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Sql/managedInstances\",\n  \"apiVersion\": \"2022-05-01-preview\",\n    \"name\": \"[parameters('managedInstanceName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\",\n    \"userAssignedIdentities\": {}\n  },\n  \"properties\": {}\n}\n</code></pre>","tags":["Azure.SQLMI.ManagedIdentity","AZR-000367"]},{"location":"en/rules/Azure.SQLMI.ManagedIdentity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy SQL Managed Instances that pass this rule:</p> <ul> <li>Set <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code> or <code>SystemAssigned,UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code> or <code>SystemAssigned,UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource managedInstance 'Microsoft.Sql/managedInstances@2022-05-01-preview' = {\n  name: appName\n  location: location\n  name: managedInstanceName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n    userAssignedIdentities: {}\n  }\n  properties: {}\n}\n</code></pre>","tags":["Azure.SQLMI.ManagedIdentity","AZR-000367"]},{"location":"en/rules/Azure.SQLMI.ManagedIdentity/#notes","title":"Notes","text":"<p>To grant permissions to access Microsoft Graph through an SMI or a UMI, you need to use PowerShell. You can't grant these permissions by using the Azure portal.</p>","tags":["Azure.SQLMI.ManagedIdentity","AZR-000367"]},{"location":"en/rules/Azure.SQLMI.ManagedIdentity/#links","title":"Links","text":"<ul> <li>Use identity-based authentication</li> <li>Managed identities in Azure AD for Azure SQL Managed Instance</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.SQLMI.ManagedIdentity","AZR-000367"]},{"location":"en/rules/Azure.SQLMI.Name/","title":"Use valid SQL Managed Instance names","text":"Azure.SQLMI.NameAZR-000194Error <p> Operational Excellence  \u00b7  SQL Managed Instance  \u00b7  Rule  \u00b7  2020_12  \u00b7  Awareness</p> <p>SQL Managed Instance names should meet naming requirements.</p>","tags":["Azure.SQLMI.Name","AZR-000194"]},{"location":"en/rules/Azure.SQLMI.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for SQL Managed Instance names are:</p> <ul> <li>Between 1 and 63 characters long.</li> <li>Lowercase letters, numbers, and hyphens.</li> <li>Can't start or end with a hyphen.</li> <li>SQL Managed Instance names must be globally unique.</li> </ul>","tags":["Azure.SQLMI.Name","AZR-000194"]},{"location":"en/rules/Azure.SQLMI.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet SQL Managed Instance naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.SQLMI.Name","AZR-000194"]},{"location":"en/rules/Azure.SQLMI.Name/#notes","title":"Notes","text":"<p>This rule does not check if SQL Managed Instance names are unique.</p>","tags":["Azure.SQLMI.Name","AZR-000194"]},{"location":"en/rules/Azure.SQLMI.Name/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> </ul>","tags":["Azure.SQLMI.Name","AZR-000194"]},{"location":"en/rules/Azure.Search.IndexSLA/","title":"Search index update SLA minimum replicas","text":"Azure.Search.IndexSLAAZR-000174Error <p> Reliability  \u00b7  AI Search  \u00b7  Rule  \u00b7  2021_06  \u00b7  Important</p> <p>Use a minimum of 3 replicas to receive an SLA for query and index updates.</p>","tags":["Azure.Search.IndexSLA","AZR-000174"]},{"location":"en/rules/Azure.Search.IndexSLA/#description","title":"Description","text":"<p>AI Search (Previously known as Cognitive Search) services support indexing and querying. Indexing is the process of loading content into the service to make it searchable. Querying is the process where a client searches for content by sending queries to the index.</p> <p>AI Search supports a configurable number of replicas. Having multiple replicas allows queries and index updates to load balance across multiple replicas.</p> <p>To receive a Service Level Agreement (SLA) for Search index updates a minimum of 3 replicas is required.</p>","tags":["Azure.Search.IndexSLA","AZR-000174"]},{"location":"en/rules/Azure.Search.IndexSLA/#recommendation","title":"Recommendation","text":"<p>Consider increasing the number of replicas to a minimum of 3 to receive an SLA on index update requests.</p>","tags":["Azure.Search.IndexSLA","AZR-000174"]},{"location":"en/rules/Azure.Search.IndexSLA/#examples","title":"Examples","text":"","tags":["Azure.Search.IndexSLA","AZR-000174"]},{"location":"en/rules/Azure.Search.IndexSLA/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AI Search services that pass this rule:</p> <ul> <li>Set the <code>properties.replicaCount</code> property to a minimum of <code>3</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Search/searchServices\",\n  \"apiVersion\": \"2022-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"sku\": {\n    \"name\": \"standard\"\n  },\n  \"properties\": {\n    \"replicaCount\": 3,\n    \"partitionCount\": 1,\n    \"hostingMode\": \"default\"\n  }\n}\n</code></pre>","tags":["Azure.Search.IndexSLA","AZR-000174"]},{"location":"en/rules/Azure.Search.IndexSLA/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AI Search services that pass this rule:</p> <ul> <li>Set the <code>properties.replicaCount</code> property to a minimum of <code>3</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource search 'Microsoft.Search/searchServices@2022-09-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'standard'\n  }\n  properties: {\n    replicaCount: 3\n    partitionCount: 1\n    hostingMode: 'default'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/search/search-service:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/search/search-service:0.8.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Search.IndexSLA","AZR-000174"]},{"location":"en/rules/Azure.Search.IndexSLA/#links","title":"Links","text":"<ul> <li>RE:06 Data partitioning</li> <li>Resiliency checklist for specific Azure services</li> <li>SLA for Azure AI Search</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Search.IndexSLA","AZR-000174"]},{"location":"en/rules/Azure.Search.ManagedIdentity/","title":"Search services uses a managed identity","text":"Azure.Search.ManagedIdentityAZR-000175Error <p> Security  \u00b7  AI Search  \u00b7  Rule  \u00b7  2021_06  \u00b7  Important</p> <p>Configure managed identities to access Azure resources.</p>","tags":["Azure.Search.ManagedIdentity","AZR-000175"]},{"location":"en/rules/Azure.Search.ManagedIdentity/#description","title":"Description","text":"<p>AI Search (Previously known as Cognitive Search) may require connection to other Azure resources. Connections to Azure resources are required to use some features including indexing and customer managed-keys. AI Search can use managed identities to authenticate to Azure resources without storing credentials.</p> <p>Using Azure managed identities have the following benefits:</p> <ul> <li>You don't need to store or manage credentials.   Azure automatically generates tokens and performs rotation.</li> <li>You can use managed identities to authenticate to any Azure service that supports Entra ID authentication.</li> <li>Managed identities can be used without any additional cost.</li> </ul>","tags":["Azure.Search.ManagedIdentity","AZR-000175"]},{"location":"en/rules/Azure.Search.ManagedIdentity/#recommendation","title":"Recommendation","text":"<p>Consider configuring a managed identity for each AI Search service. Also consider using managed identities to authenticate to related Azure services.</p>","tags":["Azure.Search.ManagedIdentity","AZR-000175"]},{"location":"en/rules/Azure.Search.ManagedIdentity/#examples","title":"Examples","text":"","tags":["Azure.Search.ManagedIdentity","AZR-000175"]},{"location":"en/rules/Azure.Search.ManagedIdentity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AI Search services that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> property to <code>SystemAssigned</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Search/searchServices\",\n  \"apiVersion\": \"2022-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"sku\": {\n    \"name\": \"standard\"\n  },\n  \"properties\": {\n    \"replicaCount\": 3,\n    \"partitionCount\": 1,\n    \"hostingMode\": \"default\"\n  }\n}\n</code></pre>","tags":["Azure.Search.ManagedIdentity","AZR-000175"]},{"location":"en/rules/Azure.Search.ManagedIdentity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AI Search Search services that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> property to <code>SystemAssigned</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource search 'Microsoft.Search/searchServices@2022-09-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'standard'\n  }\n  properties: {\n    replicaCount: 3\n    partitionCount: 1\n    hostingMode: 'default'\n  }\n}\n</code></pre>","tags":["Azure.Search.ManagedIdentity","AZR-000175"]},{"location":"en/rules/Azure.Search.ManagedIdentity/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>What are managed identities for Azure resources?</li> <li>Connect a search service to other Azure resources using a managed identity</li> <li>Make indexer connections to Azure Storage as a trusted service</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Search.ManagedIdentity","AZR-000175"]},{"location":"en/rules/Azure.Search.Name/","title":"Use valid Cognitive Search service names","text":"Azure.Search.NameAZR-000176Error <p> Operational Excellence  \u00b7  AI Search  \u00b7  Rule  \u00b7  2021_06  \u00b7  Awareness</p> <p>AI Search service names should meet naming requirements.</p>","tags":["Azure.Search.Name","AZR-000176"]},{"location":"en/rules/Azure.Search.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for AI Search (Previously known as Cognitive Search) service names are:</p> <ul> <li>Between 2 and 60 characters long.</li> <li>Lowercase letters, numbers, and hyphens.</li> <li>The first two and last one character must be a letter or a number.</li> <li>AI Search service names must be globally unique.</li> </ul>","tags":["Azure.Search.Name","AZR-000176"]},{"location":"en/rules/Azure.Search.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Azure AI Search service naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.Search.Name","AZR-000176"]},{"location":"en/rules/Azure.Search.Name/#notes","title":"Notes","text":"<p>This rule does not check if Azure AI Search service names are unique.</p>","tags":["Azure.Search.Name","AZR-000176"]},{"location":"en/rules/Azure.Search.Name/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>REST API reference</li> <li>Define your naming convention</li> <li>Recommended abbreviations for Azure resource types</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Search.Name","AZR-000176"]},{"location":"en/rules/Azure.Search.QuerySLA/","title":"Search query SLA minimum replicas","text":"Azure.Search.QuerySLAAZR-000173Error <p> Reliability  \u00b7  AI Search  \u00b7  Rule  \u00b7  2021_06  \u00b7  Important</p> <p>Use a minimum of 2 replicas to receive an SLA for index queries.</p>","tags":["Azure.Search.QuerySLA","AZR-000173"]},{"location":"en/rules/Azure.Search.QuerySLA/#description","title":"Description","text":"<p>AI Search (Previously known as Cognitive Search) services support indexing and querying. Indexing is the process of loading content into the service to make it searchable. Querying is the process where a client searches for content by sending queries to the index.</p> <p>AI Search supports a configurable number of replicas. Having multiple replicas allows queries and index updates to load balance across multiple replicas.</p> <p>To receive a Service Level Agreement (SLA) for Search index queries a minimum of 2 replicas is required.</p>","tags":["Azure.Search.QuerySLA","AZR-000173"]},{"location":"en/rules/Azure.Search.QuerySLA/#recommendation","title":"Recommendation","text":"<p>Consider increasing the number of replicas to a minimum of 2 to receive an SLA on index query requests.</p>","tags":["Azure.Search.QuerySLA","AZR-000173"]},{"location":"en/rules/Azure.Search.QuerySLA/#examples","title":"Examples","text":"","tags":["Azure.Search.QuerySLA","AZR-000173"]},{"location":"en/rules/Azure.Search.QuerySLA/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AI Search services that pass this rule:</p> <ul> <li>Set the <code>properties.replicaCount</code> property to a minimum of <code>2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Search/searchServices\",\n  \"apiVersion\": \"2022-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"sku\": {\n    \"name\": \"standard\"\n  },\n  \"properties\": {\n    \"replicaCount\": 3,\n    \"partitionCount\": 1,\n    \"hostingMode\": \"default\"\n  }\n}\n</code></pre>","tags":["Azure.Search.QuerySLA","AZR-000173"]},{"location":"en/rules/Azure.Search.QuerySLA/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AI Search services that pass this rule:</p> <ul> <li>Set the <code>properties.replicaCount</code> property to a minimum of <code>2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource search 'Microsoft.Search/searchServices@2022-09-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'standard'\n  }\n  properties: {\n    replicaCount: 3\n    partitionCount: 1\n    hostingMode: 'default'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/search/search-service:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/search/search-service:0.8.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Search.QuerySLA","AZR-000173"]},{"location":"en/rules/Azure.Search.QuerySLA/#links","title":"Links","text":"<ul> <li>RE:06 Data partitioning</li> <li>Resiliency checklist for specific Azure services</li> <li>SLA for Azure AI Search</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Search.QuerySLA","AZR-000173"]},{"location":"en/rules/Azure.Search.SKU/","title":"AI Search minimum SKU","text":"Azure.Search.SKUAZR-000172Error <p> Performance Efficiency  \u00b7  AI Search  \u00b7  Rule  \u00b7  2021_06  \u00b7  Critical</p> <p>Use the basic and standard tiers for entry level workloads.</p>","tags":["Azure.Search.SKU","AZR-000172"]},{"location":"en/rules/Azure.Search.SKU/#description","title":"Description","text":"<p>AI Search (Previously known as Cognitive Search) services using the Free tier run on resources shared across multiple subscribers. The Free tier is only suggested for limited small scale tests such as running code samples or tutorials.</p> <p>Running more demanding workloads on the Free tier may experience unpredictable performance or issues.</p> <p>To select a tier for your workload, estimate and test your required capacity.</p>","tags":["Azure.Search.SKU","AZR-000172"]},{"location":"en/rules/Azure.Search.SKU/#recommendation","title":"Recommendation","text":"<p>Consider deploying AI Search services using basic or higher tier.</p>","tags":["Azure.Search.SKU","AZR-000172"]},{"location":"en/rules/Azure.Search.SKU/#examples","title":"Examples","text":"","tags":["Azure.Search.SKU","AZR-000172"]},{"location":"en/rules/Azure.Search.SKU/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy AI Search services that pass this rule:</p> <ul> <li>Set the <code>sku.name</code> to a minimum of <code>basic</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Search/searchServices\",\n  \"apiVersion\": \"2022-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"sku\": {\n    \"name\": \"standard\"\n  },\n  \"properties\": {\n    \"replicaCount\": 3,\n    \"partitionCount\": 1,\n    \"hostingMode\": \"default\"\n  }\n}\n</code></pre>","tags":["Azure.Search.SKU","AZR-000172"]},{"location":"en/rules/Azure.Search.SKU/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy AI Search services that pass this rule:</p> <ul> <li>Set the <code>sku.name</code> to a minimum of <code>basic</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource search 'Microsoft.Search/searchServices@2022-09-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'standard'\n  }\n  properties: {\n    replicaCount: 3\n    partitionCount: 1\n    hostingMode: 'default'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/search/search-service:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/search/search-service:0.8.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Search.SKU","AZR-000172"]},{"location":"en/rules/Azure.Search.SKU/#links","title":"Links","text":"<ul> <li>PE:02 Capacity planning</li> <li>SLA for Azure AI Search</li> <li>Estimate and manage capacity of a search service</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Search.SKU","AZR-000172"]},{"location":"en/rules/Azure.ServiceBus.AuditLogs/","title":"Audit Service Bus data plane access","text":"Azure.ServiceBus.AuditLogsAZR-000358Error <p> Security  \u00b7  Service Bus  \u00b7  Rule  \u00b7  2023_03  \u00b7  Important</p> <p>Ensure namespaces audit diagnostic logs are enabled.</p>","tags":["Azure.ServiceBus.AuditLogs","AZR-000358"]},{"location":"en/rules/Azure.ServiceBus.AuditLogs/#description","title":"Description","text":"<p>To capture logs that record data plane access operations (such as send or receive messages) in the service bus, diagnostic settings must be configured.</p> <p>When configuring diagnostic settings, enabled one of the following:</p> <ul> <li><code>RuntimeAuditLogs</code> category.</li> <li><code>audit</code> category group.</li> <li><code>allLogs</code> category group.</li> </ul> <p>Management operations for Service Bus is captured automatically within Azure Activity Logs.</p>","tags":["Azure.ServiceBus.AuditLogs","AZR-000358"]},{"location":"en/rules/Azure.ServiceBus.AuditLogs/#recommendation","title":"Recommendation","text":"<p>Consider configuring diagnostic settings to record interactions with data of the Service Bus.</p>","tags":["Azure.ServiceBus.AuditLogs","AZR-000358"]},{"location":"en/rules/Azure.ServiceBus.AuditLogs/#examples","title":"Examples","text":"","tags":["Azure.ServiceBus.AuditLogs","AZR-000358"]},{"location":"en/rules/Azure.ServiceBus.AuditLogs/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Service Bus namespaces that pass this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource (extension resource).</li> <li>Enable <code>RuntimeAuditLogs</code> category or <code>audit</code> category group or <code>allLogs</code> category group.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ServiceBus/namespaces\",\n  \"apiVersion\": \"2022-10-01-preview\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"sku\": {\n    \"name\": \"Premium\"\n  },\n  \"properties\": {\n    \"disableLocalAuth\": true,\n    \"minimumTlsVersion\": \"1.2\"\n  }\n},\n{\n  \"type\": \"Microsoft.Insights/diagnosticSettings\",\n  \"apiVersion\": \"2021-05-01-preview\",\n  \"scope\": \"[format('Microsoft.ServiceBus/namespaces/{0}', parameters('name'))]\",\n  \"name\": \"[parameters('diagName')]\",\n  \"properties\": {\n    \"workspaceId\": \"[parameters('workspaceId')]\",\n    \"logs\": [\n      {\n        \"category\": \"RuntimeAuditLogs\",\n        \"enabled\": true,\n        \"retentionPolicy\": {\n          \"days\": 0,\n          \"enabled\": false\n        }\n      }\n    ]\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.ServiceBus/namespaces', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.ServiceBus.AuditLogs","AZR-000358"]},{"location":"en/rules/Azure.ServiceBus.AuditLogs/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Service Bus namespaces that pass this rule:</p> <ul> <li>Deploy a diagnostic settings sub-resource (extension resource).</li> <li>Enable <code>RuntimeAuditLogs</code> category or <code>audit</code> category group or <code>allLogs</code> category group.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource ns 'Microsoft.ServiceBus/namespaces@2022-10-01-preview' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'Premium'\n  }\n  properties: {\n    disableLocalAuth: true\n    minimumTlsVersion: '1.2'\n  }\n}\n\nresource nsDiagnosticSettings 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  name: diagName\n  properties: {\n    workspaceId: workspaceId\n    logs: [\n      {\n        category: 'RuntimeAuditLogs'\n        enabled: true\n        retentionPolicy: {\n          days: 0\n          enabled: false\n        }\n      }\n    ]\n  }\n  scope: ns\n}\n</code></pre>","tags":["Azure.ServiceBus.AuditLogs","AZR-000358"]},{"location":"en/rules/Azure.ServiceBus.AuditLogs/#notes","title":"Notes","text":"<p>This rule only applies to premium tier Service Bus instances. Runtime audit logs are currently available only in the <code>Premium</code> tier.</p>","tags":["Azure.ServiceBus.AuditLogs","AZR-000358"]},{"location":"en/rules/Azure.ServiceBus.AuditLogs/#links","title":"Links","text":"<ul> <li>Security audits</li> <li>Monitoring Azure Service Bus data reference</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ServiceBus.AuditLogs","AZR-000358"]},{"location":"en/rules/Azure.ServiceBus.DisableLocalAuth/","title":"Use identity-based authentication for Service Bus namespaces","text":"Azure.ServiceBus.DisableLocalAuthAZR-000178Error <p> Security  \u00b7  Service Bus  \u00b7  Rule  \u00b7  2022_03  \u00b7  Important</p> <p>Authenticate Service Bus publishers and consumers with Entra ID identities.</p>","tags":["Azure.ServiceBus.DisableLocalAuth","AZR-000178"]},{"location":"en/rules/Azure.ServiceBus.DisableLocalAuth/#description","title":"Description","text":"<p>To publish or consume messages from Service Bus cryptographic keys, or Entra ID identities can be used. Cryptographic keys include Shared Access Policy keys or Shared Access Signature (SAS) tokens. With Entra ID authentication, the identity is validated against Entra ID. Using Entra ID identities centralizes identity management and auditing.</p> <p>Once you decide to use Entra ID authentication, you can disable authentication using keys or SAS tokens.</p>","tags":["Azure.ServiceBus.DisableLocalAuth","AZR-000178"]},{"location":"en/rules/Azure.ServiceBus.DisableLocalAuth/#recommendation","title":"Recommendation","text":"<p>Consider only using Entra ID identities to publish or consume messages from Service Bus. Then disable authentication based on access keys or SAS tokens.</p>","tags":["Azure.ServiceBus.DisableLocalAuth","AZR-000178"]},{"location":"en/rules/Azure.ServiceBus.DisableLocalAuth/#examples","title":"Examples","text":"","tags":["Azure.ServiceBus.DisableLocalAuth","AZR-000178"]},{"location":"en/rules/Azure.ServiceBus.DisableLocalAuth/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy namespaces that pass this rule:</p> <ul> <li>Set the <code>properties.disableLocalAuth</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ServiceBus/namespaces\",\n  \"apiVersion\": \"2022-10-01-preview\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"sku\": {\n    \"name\": \"Standard\"\n  },\n  \"properties\": {\n    \"disableLocalAuth\": true,\n    \"minimumTlsVersion\": \"1.2\"\n  }\n}\n</code></pre>","tags":["Azure.ServiceBus.DisableLocalAuth","AZR-000178"]},{"location":"en/rules/Azure.ServiceBus.DisableLocalAuth/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy namespaces that pass this rule:</p> <ul> <li>Set the <code>properties.disableLocalAuth</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource ns 'Microsoft.ServiceBus/namespaces@2022-10-01-preview' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    disableLocalAuth: true\n    minimumTlsVersion: '1.2'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/service-bus/namespace:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/service-bus/namespace:0.9.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ServiceBus.DisableLocalAuth","AZR-000178"]},{"location":"en/rules/Azure.ServiceBus.DisableLocalAuth/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Azure Service Bus namespaces should have local authentication methods disabled <code>/providers/Microsoft.Authorization/policyDefinitions/cfb11c26-f069-4c14-8e36-56c394dae5af</code></li> <li>Configure Azure Service Bus namespaces to disable local authentication <code>/providers/Microsoft.Authorization/policyDefinitions/910711a6-8aa2-4f15-ae62-1e5b2ed3ef9e</code></li> </ul>","tags":["Azure.ServiceBus.DisableLocalAuth","AZR-000178"]},{"location":"en/rules/Azure.ServiceBus.DisableLocalAuth/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>IM-1: Use centralized identity and authentication system</li> <li>Service Bus authentication and authorization</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ServiceBus.DisableLocalAuth","AZR-000178"]},{"location":"en/rules/Azure.ServiceBus.GeoReplica/","title":"Geo-replication","text":"Azure.ServiceBus.GeoReplicaAZR-000444Error <p> Reliability  \u00b7  Service Bus  \u00b7  Rule  \u00b7  Preview  \u00b7  2024_09  \u00b7  Important</p> <p>Enhance resilience to regional outages by replicating namespaces.</p>","tags":["Azure.ServiceBus.GeoReplica","AZR-000444"]},{"location":"en/rules/Azure.ServiceBus.GeoReplica/#description","title":"Description","text":"<p>By default, an service bus namespace and its data and metadata is in a single region.</p> <p>The geo-replication feature ensures that the metadata and data of a namespace are continuously replicated from a primary region to one or more secondary regions.</p> <p>The following will be replicated:</p> <ul> <li>Queues, topics, subscriptions, filters.</li> <li>Data, which resides in the entities.</li> <li>All state changes and property changes executed against the messages within a namespace.</li> <li>Namespace configuration.</li> </ul> <p>Replicating your namespace adds the following benefits:</p> <ul> <li>Added resiliency for localized outages contained to a region.</li> <li>Regional compartmentalization.</li> </ul> <p>This feature allows promoting any secondary region to primary, reassigning the namespace name and switching roles between regions. Promotion is nearly instantaneous.</p> <p>There are currently several limitations to the feature. For more details, refer to the documentation.</p>","tags":["Azure.ServiceBus.GeoReplica","AZR-000444"]},{"location":"en/rules/Azure.ServiceBus.GeoReplica/#recommendation","title":"Recommendation","text":"<p>Consider replicating service bus namespaces to improve resiliency to region outages.</p>","tags":["Azure.ServiceBus.GeoReplica","AZR-000444"]},{"location":"en/rules/Azure.ServiceBus.GeoReplica/#examples","title":"Examples","text":"","tags":["Azure.ServiceBus.GeoReplica","AZR-000444"]},{"location":"en/rules/Azure.ServiceBus.GeoReplica/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy namespaces that pass this rule:</p> <ul> <li>Set the <code>sku.name</code> property to <code>Premium</code>. This only applies to new namespaces.<ul> <li>For existing namespaces first, migrate to a namespace deployed with a premium SKU.</li> </ul> </li> <li>Configure the <code>properties.geoDataReplication.locations</code> array with two or more supported region elements.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ServiceBus/namespaces\",\n  \"apiVersion\": \"2023-01-01-preview\",\n  \"name\": \"[parameters('serviceBusName')]\",\n  \"location\": \"[parameters('primaryLocation')]\",\n  \"sku\": {\n    \"name\": \"Premium\",\n    \"tier\": \"Premium\",\n    \"capacity\": 1\n  },\n  \"properties\": {\n    \"geoDataReplication\": {\n      \"maxReplicationLagDurationInSeconds\": \"[parameters('maxReplicationLagInSeconds')]\",\n      \"locations\": [\n        {\n          \"locationName\": \"[parameters('primaryLocation')]\",\n          \"roleType\": \"Primary\"\n        },\n        {\n          \"locationName\": \"[parameters('secondaryLocation')]\",\n          \"roleType\": \"Secondary\"\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.ServiceBus.GeoReplica","AZR-000444"]},{"location":"en/rules/Azure.ServiceBus.GeoReplica/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy namespaces that pass this rule:</p> <ul> <li>Set the <code>sku.name</code> property to <code>Premium</code>. This only applies to new namespaces.<ul> <li>For existing namespaces first, migrate to a namespace deployed with a premium SKU.</li> </ul> </li> <li>Configure the <code>properties.geoDataReplication.locations</code> array with two or more supported region elements.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource sb 'Microsoft.ServiceBus/namespaces@2023-01-01-preview' = {\n  name: serviceBusName\n  location: primaryLocation\n  sku: {\n    name: 'Premium'\n    tier: 'Premium'\n    capacity: 1\n  }\n  properties: {\n    geoDataReplication: {\n      maxReplicationLagDurationInSeconds: maxReplicationLagInSeconds\n      locations: [\n        {\n          locationName: primaryLocation\n          roleType: 'Primary'\n        }\n        {\n          locationName: secondaryLocation\n          roleType: 'Secondary'\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.ServiceBus.GeoReplica","AZR-000444"]},{"location":"en/rules/Azure.ServiceBus.GeoReplica/#notes","title":"Notes","text":"<p>This feature is only supported for the <code>Premium</code> SKU.</p> <p>This feature is currently in preview.</p>","tags":["Azure.ServiceBus.GeoReplica","AZR-000444"]},{"location":"en/rules/Azure.ServiceBus.GeoReplica/#links","title":"Links","text":"<ul> <li>RE:05 Redundancy</li> <li>Geo-replication</li> <li>Configure geo-replication</li> <li>Migrate existing Azure Service Bus standard namespaces to the premium tier</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ServiceBus.GeoReplica","AZR-000444"]},{"location":"en/rules/Azure.ServiceBus.MinTLS/","title":"Enforce namespaces to minimum use TLS 1.2 version","text":"Azure.ServiceBus.MinTLSAZR-000315Error <p> Security  \u00b7  Service Bus  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Service Bus namespaces should reject TLS versions older than 1.2.</p>","tags":["Azure.ServiceBus.MinTLS","AZR-000315"]},{"location":"en/rules/Azure.ServiceBus.MinTLS/#description","title":"Description","text":"<p>Clients connect to Azure Service Bus to send and receive messages over a Transport Layer Security (TLS) encrypted connection. The minimum version of TLS that Service Bus accepts is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS. Additionally, support for TLS 1.0 and 1.1 are on a deprecation path across Azure services.</p> <p>Azure lets you disable outdated protocols and require connections to use a minimum of TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 are accepted.</p> <p>When clients connect using an older version of TLS that is disabled, the connection will fail.</p>","tags":["Azure.ServiceBus.MinTLS","AZR-000315"]},{"location":"en/rules/Azure.ServiceBus.MinTLS/#recommendation","title":"Recommendation","text":"<p>Consider configuring the minimum supported TLS version for Service Bus clients to be 1.2. Also consider enforcing this setting using Azure Policy.</p>","tags":["Azure.ServiceBus.MinTLS","AZR-000315"]},{"location":"en/rules/Azure.ServiceBus.MinTLS/#examples","title":"Examples","text":"","tags":["Azure.ServiceBus.MinTLS","AZR-000315"]},{"location":"en/rules/Azure.ServiceBus.MinTLS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy namespaces that pass this rule:</p> <ul> <li>Set the <code>properties.minimumTlsVersion</code> property to <code>1.2</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ServiceBus/namespaces\",\n  \"apiVersion\": \"2022-10-01-preview\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"sku\": {\n    \"name\": \"Standard\"\n  },\n  \"properties\": {\n    \"disableLocalAuth\": true,\n    \"minimumTlsVersion\": \"1.2\"\n  }\n}\n</code></pre>","tags":["Azure.ServiceBus.MinTLS","AZR-000315"]},{"location":"en/rules/Azure.ServiceBus.MinTLS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy namespaces that pass this rule:</p> <ul> <li>Set the <code>properties.minimumTlsVersion</code> property to <code>1.2</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource ns 'Microsoft.ServiceBus/namespaces@2022-10-01-preview' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    disableLocalAuth: true\n    minimumTlsVersion: '1.2'\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/service-bus/namespace:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/service-bus/namespace:0.9.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.ServiceBus.MinTLS","AZR-000315"]},{"location":"en/rules/Azure.ServiceBus.MinTLS/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az servicebus namespace update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --minimum-tls-version '1.2'\n</code></pre>","tags":["Azure.ServiceBus.MinTLS","AZR-000315"]},{"location":"en/rules/Azure.ServiceBus.MinTLS/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>$ns = Get-AzServiceBusNamespace  -Name '&lt;name&gt;' -ResourceGroupName '&lt;resource_group&gt;'\nSet-AzServiceBusNamespace -InputObject $ns -MinimumTlsVersion '1.2'\n</code></pre>","tags":["Azure.ServiceBus.MinTLS","AZR-000315"]},{"location":"en/rules/Azure.ServiceBus.MinTLS/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>DP-3: Encrypt sensitive data in transit</li> <li>Enforce a minimum requires version of TLS</li> <li>Preparing for TLS 1.2 in Microsoft Azure</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ServiceBus.MinTLS","AZR-000315"]},{"location":"en/rules/Azure.ServiceBus.Usage/","title":"Remove unused Service Bus namespaces","text":"Azure.ServiceBus.UsageAZR-000177Error <p> Cost Optimization  \u00b7  Service Bus  \u00b7  Rule  \u00b7  2022_03  \u00b7  Important</p> <p>Regularly remove unused resources to reduce costs.</p>","tags":["Azure.ServiceBus.Usage","AZR-000177"]},{"location":"en/rules/Azure.ServiceBus.Usage/#description","title":"Description","text":"<p>Billing starts for a Standard or Premium Service Bus namespace after it is provisioned. To to receive messages you must first create at least one queue or topic. Namespaces without any queues or topics are considered unused.</p>","tags":["Azure.ServiceBus.Usage","AZR-000177"]},{"location":"en/rules/Azure.ServiceBus.Usage/#recommendation","title":"Recommendation","text":"<p>Consider removing Service Bus namespaces that are not used.</p>","tags":["Azure.ServiceBus.Usage","AZR-000177"]},{"location":"en/rules/Azure.ServiceBus.Usage/#notes","title":"Notes","text":"<p>This rule applies when analyzing resources deployed (in-flight) to Azure.</p>","tags":["Azure.ServiceBus.Usage","AZR-000177"]},{"location":"en/rules/Azure.ServiceBus.Usage/#links","title":"Links","text":"<ul> <li>CO:14 Consolidation</li> <li>Design review checklist for Cost Optimization</li> <li>Pricing</li> </ul>","tags":["Azure.ServiceBus.Usage","AZR-000177"]},{"location":"en/rules/Azure.ServiceFabric.AAD/","title":"Use Entra ID authentication with Service Fabric clusters","text":"Azure.ServiceFabric.AADAZR-000179Error <p> Security  \u00b7  Service Fabric  \u00b7  Rule  \u00b7  2021_03  \u00b7  Critical</p> <p>Use Entra ID client authentication for Service Fabric clusters.</p>","tags":["Azure.ServiceFabric.AAD","AZR-000179"]},{"location":"en/rules/Azure.ServiceFabric.AAD/#description","title":"Description","text":"<p>When deploying Service Fabric clusters on Azure, Entra ID (previously known as Azure AD) can optionally be used to secure management endpoints. If configured, client authentication (client-to-node security) uses Entra ID. Additionally Azure Role-based Access Control (RBAC) can be used to delegate cluster access.</p> <p>For Service Fabric clusters running on Azure, Entra ID is recommended to secure access to management endpoints.</p>","tags":["Azure.ServiceFabric.AAD","AZR-000179"]},{"location":"en/rules/Azure.ServiceFabric.AAD/#recommendation","title":"Recommendation","text":"<p>Consider enabling Entra ID client authentication for Service Fabric clusters.</p>","tags":["Azure.ServiceFabric.AAD","AZR-000179"]},{"location":"en/rules/Azure.ServiceFabric.AAD/#notes","title":"Notes","text":"<p>For Linux clusters, Entra ID authentication must be configured at cluster creation time. Windows cluster can be updated to support Entra ID authentication after initial deployment.</p>","tags":["Azure.ServiceFabric.AAD","AZR-000179"]},{"location":"en/rules/Azure.ServiceFabric.AAD/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Security recommendations</li> <li>Set up Microsoft Entra ID for client authentication</li> <li>Configure Azure Active Directory Authentication for Existing Cluster</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.ServiceFabric.AAD","AZR-000179"]},{"location":"en/rules/Azure.SignalR.ManagedIdentity/","title":"Use managed identities for SignalR Services","text":"Azure.SignalR.ManagedIdentityAZR-000181Error <p> Security  \u00b7  SignalR Service  \u00b7  Rule  \u00b7  2022_03  \u00b7  Important</p> <p>Configure SignalR Services to use managed identities to access Azure resources securely.</p>","tags":["Azure.SignalR.ManagedIdentity","AZR-000181"]},{"location":"en/rules/Azure.SignalR.ManagedIdentity/#description","title":"Description","text":"<p>A managed identity allows your service to access other Azure AD-protected resources such as Azure Functions. The identity is managed by the Azure platform and doesn't require you to provision or rotate any secrets.</p> <p>Using Azure managed identities have the following benefits:</p> <ul> <li>You don't need to store or manage credentials.   Azure automatically generates tokens and performs rotation.</li> <li>You can use managed identities to authenticate to any Azure service that supports Azure AD authentication.</li> <li>Managed identities can be used without any additional cost.</li> </ul>","tags":["Azure.SignalR.ManagedIdentity","AZR-000181"]},{"location":"en/rules/Azure.SignalR.ManagedIdentity/#recommendation","title":"Recommendation","text":"<p>Consider configuring a managed identity for each SignalR Service. Also consider using managed identities to authenticate to related Azure services.</p>","tags":["Azure.SignalR.ManagedIdentity","AZR-000181"]},{"location":"en/rules/Azure.SignalR.ManagedIdentity/#examples","title":"Examples","text":"","tags":["Azure.SignalR.ManagedIdentity","AZR-000181"]},{"location":"en/rules/Azure.SignalR.ManagedIdentity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy services that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.SignalRService/signalR\",\n    \"apiVersion\": \"2021-10-01\",\n    \"name\": \"[parameters('name')]\",\n    \"location\": \"[parameters('location')]\",\n    \"kind\": \"SignalR\",\n    \"sku\": {\n        \"name\": \"Standard_S1\"\n    },\n    \"identity\": {\n        \"type\": \"SystemAssigned\"\n    },\n    \"properties\": {\n        \"disableLocalAuth\": true,\n        \"features\": [\n            {\n                \"flag\": \"ServiceMode\",\n                \"value\": \"Serverless\"\n            }\n        ]\n    }\n}\n</code></pre>","tags":["Azure.SignalR.ManagedIdentity","AZR-000181"]},{"location":"en/rules/Azure.SignalR.ManagedIdentity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy services that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource service 'Microsoft.SignalRService/signalR@2021-10-01' = {\n  name: name\n  location: location\n  kind: 'SignalR'\n  sku: {\n    name: 'Standard_S1'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    disableLocalAuth: true\n    features: [\n      {\n        flag: 'ServiceMode'\n        value: 'Serverless'\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.SignalR.ManagedIdentity","AZR-000181"]},{"location":"en/rules/Azure.SignalR.ManagedIdentity/#links","title":"Links","text":"<ul> <li>Use identity-based authentication</li> <li>Managed identities for Azure SignalR Service</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.SignalR.ManagedIdentity","AZR-000181"]},{"location":"en/rules/Azure.SignalR.Name/","title":"Use valid SignalR service names","text":"Azure.SignalR.NameAZR-000180Error <p> Operational Excellence  \u00b7  SignalR Service  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>SignalR service instance names should meet naming requirements.</p>","tags":["Azure.SignalR.Name","AZR-000180"]},{"location":"en/rules/Azure.SignalR.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for SignalR service names are:</p> <ul> <li>Between 3 and 63 characters long.</li> <li>Alphanumerics and hyphens.</li> <li>Start with letter.</li> <li>End with letter or number.</li> <li>SignalR service names must be globally unique.</li> </ul>","tags":["Azure.SignalR.Name","AZR-000180"]},{"location":"en/rules/Azure.SignalR.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet SignalR service naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.SignalR.Name","AZR-000180"]},{"location":"en/rules/Azure.SignalR.Name/#notes","title":"Notes","text":"<p>This rule does not check if SignalR service names are unique.</p>","tags":["Azure.SignalR.Name","AZR-000180"]},{"location":"en/rules/Azure.SignalR.Name/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.SignalR.Name","AZR-000180"]},{"location":"en/rules/Azure.SignalR.SLA/","title":"Use an SLA for SignalR Services","text":"Azure.SignalR.SLAAZR-000182Error <p> Reliability  \u00b7  SignalR Service  \u00b7  Rule  \u00b7  2022_03  \u00b7  Important</p> <p>Use SKUs that include an SLA when configuring SignalR Services.</p>","tags":["Azure.SignalR.SLA","AZR-000182"]},{"location":"en/rules/Azure.SignalR.SLA/#description","title":"Description","text":"<p>When choosing a SKU for a SignalR Service you should consider the SLA that is included in the SKU. SignalR Services offer a range of SKU offerings:</p> <ul> <li><code>Free</code> - Are designed for early non-production use and do not include any SLA.</li> <li><code>Standard</code> - Are designed for production use and include an SLA.</li> <li><code>Premium</code> - Are designed for production use and include an SLA.   Additional, Premium SKUs support increased resilience with Availability Zones.</li> </ul>","tags":["Azure.SignalR.SLA","AZR-000182"]},{"location":"en/rules/Azure.SignalR.SLA/#recommendation","title":"Recommendation","text":"<p>Consider using a Standard or Premium SKU that includes an SLA.</p>","tags":["Azure.SignalR.SLA","AZR-000182"]},{"location":"en/rules/Azure.SignalR.SLA/#examples","title":"Examples","text":"","tags":["Azure.SignalR.SLA","AZR-000182"]},{"location":"en/rules/Azure.SignalR.SLA/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy services that pass this rule:</p> <ul> <li>Set the <code>sku.name</code> property to <code>Standard_S1</code> or <code>Premium_P1</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.SignalRService/signalR\",\n  \"apiVersion\": \"2023-02-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"kind\": \"SignalR\",\n  \"sku\": {\n    \"name\": \"Standard_S1\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"disableLocalAuth\": true,\n    \"features\": [\n      {\n        \"flag\": \"ServiceMode\",\n        \"value\": \"Serverless\"\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.SignalR.SLA","AZR-000182"]},{"location":"en/rules/Azure.SignalR.SLA/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy services that pass this rule:</p> <ul> <li>Set the <code>sku.name</code> property to <code>Standard_S1</code> or <code>Premium_P1</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource service 'Microsoft.SignalRService/signalR@2023-02-01' = {\n  name: name\n  location: location\n  kind: 'SignalR'\n  sku: {\n    name: 'Standard_S1'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    disableLocalAuth: true\n    features: [\n      {\n        flag: 'ServiceMode'\n        value: 'Serverless'\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.SignalR.SLA","AZR-000182"]},{"location":"en/rules/Azure.SignalR.SLA/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Azure SignalR Service pricing</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.SignalR.SLA","AZR-000182"]},{"location":"en/rules/Azure.Storage.BlobAccessType/","title":"Use private blob containers","text":"Azure.Storage.BlobAccessTypeAZR-000199Error <p> Security  \u00b7  Storage Account  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Use containers configured with a private access type that requires authorization.</p>","tags":["Azure.Storage.BlobAccessType","AZR-000199"]},{"location":"en/rules/Azure.Storage.BlobAccessType/#description","title":"Description","text":"<p>Azure Storage Account blob containers use the Private access type by default. Additional access types Blob and Container provide anonymous access to blobs without authorization. Blob and Container access types are not intended for access to customer data. When authorization is required, clients must use cryptographic keys or identity-based tokens to authenticate.</p> <p>Blob and Container access types are designed for public access scenarios. For example, storage of web assets like .css and .js files used in public websites.</p>","tags":["Azure.Storage.BlobAccessType","AZR-000199"]},{"location":"en/rules/Azure.Storage.BlobAccessType/#recommendation","title":"Recommendation","text":"<p>To provide secure access to data always use the Private access type (default). Also consider, disabling public access for the storage account.</p>","tags":["Azure.Storage.BlobAccessType","AZR-000199"]},{"location":"en/rules/Azure.Storage.BlobAccessType/#examples","title":"Examples","text":"","tags":["Azure.Storage.BlobAccessType","AZR-000199"]},{"location":"en/rules/Azure.Storage.BlobAccessType/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Storage Account blob containers that pass this rule:</p> <ul> <li>Set the <code>properties.publicAccess</code> property to <code>None</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Storage/storageAccounts/blobServices/containers\",\n  \"apiVersion\": \"2021-06-01\",\n  \"name\": \"[format('{0}/{1}/{2}', parameters('name'), 'default', variables('containerName'))]\",\n  \"properties\": {\n    \"publicAccess\": \"None\"\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('name'), 'default')]\",\n    \"[resourceId('Microsoft.Storage/storageAccounts', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.Storage.BlobAccessType","AZR-000199"]},{"location":"en/rules/Azure.Storage.BlobAccessType/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Storage Account blob containers that pass this rule:</p> <ul> <li>Set the <code>properties.publicAccess</code> property to <code>None</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource container 'Microsoft.Storage/storageAccounts/blobServices/containers@2021-06-01' = {\n  parent: blobService\n  name: containerName\n  properties: {\n    publicAccess: 'None'\n  }\n}\n</code></pre>","tags":["Azure.Storage.BlobAccessType","AZR-000199"]},{"location":"en/rules/Azure.Storage.BlobAccessType/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Use Microsoft Entra ID for storage authentication</li> <li>Configure anonymous read access for containers and blobs</li> <li>Remediate anonymous read access to blob data</li> <li>How a shared access signature works</li> <li>Authorize access to blobs using Microsoft Entra ID</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Storage.BlobAccessType","AZR-000199"]},{"location":"en/rules/Azure.Storage.BlobPublicAccess/","title":"Disallow anonymous access to blob service","text":"Azure.Storage.BlobPublicAccessAZR-000198Error <p> Security  \u00b7  Storage Account  \u00b7  Rule  \u00b7  2020_09  \u00b7  Important</p> <p>Storage Accounts should only accept authorized requests.</p>","tags":["Azure.Storage.BlobPublicAccess","AZR-000198"]},{"location":"en/rules/Azure.Storage.BlobPublicAccess/#description","title":"Description","text":"<p>Blob containers in Azure Storage Accounts can be configured for private or anonymous public access. By default, containers are private and only accessible with a credential or access token. When a container is configured with an access type other than private, anonymous access is permitted.</p> <p>Anonymous access to blobs or containers can be restricted by setting <code>allowBlobPublicAccess</code> to <code>false</code>. This enhanced security setting for a storage account overrides the individual settings for blob containers. When you disallow public access for a storage account, blobs are no longer accessible anonymously.</p>","tags":["Azure.Storage.BlobPublicAccess","AZR-000198"]},{"location":"en/rules/Azure.Storage.BlobPublicAccess/#recommendation","title":"Recommendation","text":"<p>Consider disallowing anonymous access to storage account blobs unless specifically required. Also consider enforcing this setting using Azure Policy.</p>","tags":["Azure.Storage.BlobPublicAccess","AZR-000198"]},{"location":"en/rules/Azure.Storage.BlobPublicAccess/#examples","title":"Examples","text":"","tags":["Azure.Storage.BlobPublicAccess","AZR-000198"]},{"location":"en/rules/Azure.Storage.BlobPublicAccess/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Set the <code>properties.allowBlobPublicAccess</code> property to <code>false</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Storage/storageAccounts\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_GRS\"\n  },\n  \"kind\": \"StorageV2\",\n  \"properties\": {\n    \"allowBlobPublicAccess\": false,\n    \"supportsHttpsTrafficOnly\": true,\n    \"minimumTlsVersion\": \"TLS1_2\",\n    \"accessTier\": \"Hot\",\n    \"allowSharedKeyAccess\": false,\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.Storage.BlobPublicAccess","AZR-000198"]},{"location":"en/rules/Azure.Storage.BlobPublicAccess/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Set the <code>properties.allowBlobPublicAccess</code> property to <code>false</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard_GRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    allowBlobPublicAccess: false\n    supportsHttpsTrafficOnly: true\n    minimumTlsVersion: 'TLS1_2'\n    accessTier: 'Hot'\n    allowSharedKeyAccess: false\n    networkAcls: {\n      defaultAction: 'Deny'\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/storage/storage-account:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/storage/storage-account:0.9.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Storage.BlobPublicAccess","AZR-000198"]},{"location":"en/rules/Azure.Storage.BlobPublicAccess/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Configure your Storage account public access to be disallowed <code>/providers/Microsoft.Authorization/policyDefinitions/13502221-8df0-4414-9937-de9c5c4e396b</code></li> </ul>","tags":["Azure.Storage.BlobPublicAccess","AZR-000198"]},{"location":"en/rules/Azure.Storage.BlobPublicAccess/#links","title":"Links","text":"<ul> <li>SE:05 Identity and access management</li> <li>Use Microsoft Entra ID for storage authentication</li> <li>Configure anonymous read access for containers and blobs</li> <li>Remediate anonymous read access to blob data</li> <li>Authorize access to blobs using Microsoft Entra ID</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Storage.BlobPublicAccess","AZR-000198"]},{"location":"en/rules/Azure.Storage.ContainerSoftDelete/","title":"Use container soft delete","text":"Azure.Storage.ContainerSoftDeleteAZR-000289Error <p> Reliability  \u00b7  Storage Account  \u00b7  Rule  \u00b7  2022_09  \u00b7  Important</p> <p>Enable container soft delete on Storage Accounts.</p>","tags":["Azure.Storage.ContainerSoftDelete","AZR-000289"]},{"location":"en/rules/Azure.Storage.ContainerSoftDelete/#description","title":"Description","text":"<p>Container soft delete protects your data from being accidentally or erroneously modified or deleted. When container soft delete is enabled for a storage account, a container and its contents may be recovered after it has been deleted, within a retention period that you specify.</p> <p>Blob container soft delete should be considered part of the strategy to protect and retain data. Also consider:</p> <ul> <li>Implementing role-based access control (RBAC).</li> <li>Configuring resource locks to protect against deletion.</li> <li>Configuring blob soft delete.</li> </ul> <p>Blob containers can be configured to retain deleted containers for a period of time between 1 and 365 days.</p>","tags":["Azure.Storage.ContainerSoftDelete","AZR-000289"]},{"location":"en/rules/Azure.Storage.ContainerSoftDelete/#recommendation","title":"Recommendation","text":"<p>Consider enabling container soft delete on storage accounts to protect blob containers from accidental deletion or modification.</p>","tags":["Azure.Storage.ContainerSoftDelete","AZR-000289"]},{"location":"en/rules/Azure.Storage.ContainerSoftDelete/#examples","title":"Examples","text":"","tags":["Azure.Storage.ContainerSoftDelete","AZR-000289"]},{"location":"en/rules/Azure.Storage.ContainerSoftDelete/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Set the <code>properties.containerDeleteRetentionPolicy.enabled</code> property to <code>true</code> on the blob services sub-resource.</li> <li>Configure the <code>properties.containerDeleteRetentionPolicy.days</code> property to the number of days to retain blobs.</li> </ul> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Storage/storageAccounts\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_GRS\"\n  },\n  \"kind\": \"StorageV2\",\n  \"properties\": {\n    \"allowBlobPublicAccess\": false,\n    \"supportsHttpsTrafficOnly\": true,\n    \"minimumTlsVersion\": \"TLS1_2\",\n    \"accessTier\": \"Hot\",\n    \"allowSharedKeyAccess\": false,\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\"\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.Storage/storageAccounts/blobServices\",\n      \"apiVersion\": \"2023-01-01\",\n      \"name\": \"[format('{0}/{1}', parameters('name'), 'default')]\",\n      \"properties\": {\n        \"deleteRetentionPolicy\": {\n          \"enabled\": true,\n          \"days\": 7\n        },\n        \"containerDeleteRetentionPolicy\": {\n          \"enabled\": true,\n          \"days\": 7\n        }\n      },\n      \"dependsOn\": [\n        \"[resourceId('Microsoft.Storage/storageAccounts', parameters('name'))]\"\n      ]\n    }\n  ]\n}\n</code></pre>","tags":["Azure.Storage.ContainerSoftDelete","AZR-000289"]},{"location":"en/rules/Azure.Storage.ContainerSoftDelete/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Set the <code>properties.containerDeleteRetentionPolicy.enabled</code> property to <code>true</code> on the blob services sub-resource.</li> <li>Configure the <code>properties.containerDeleteRetentionPolicy.days</code> property to the number of days to retain blobs.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard_GRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    allowBlobPublicAccess: false\n    supportsHttpsTrafficOnly: true\n    minimumTlsVersion: 'TLS1_2'\n    accessTier: 'Hot'\n    allowSharedKeyAccess: false\n    networkAcls: {\n      defaultAction: 'Deny'\n    }\n  }\n}\n\nresource blobService 'Microsoft.Storage/storageAccounts/blobServices@2023-01-01' = {\n  parent: storageAccount\n  name: 'default'\n  properties: {\n    deleteRetentionPolicy: {\n      enabled: true\n      days: 7\n    }\n    containerDeleteRetentionPolicy: {\n      enabled: true\n      days: 7\n    }\n  }\n}\n</code></pre>","tags":["Azure.Storage.ContainerSoftDelete","AZR-000289"]},{"location":"en/rules/Azure.Storage.ContainerSoftDelete/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az storage account blob-service-properties update --enable-container-delete-retention true --container-delete-retention-days 7 -n '&lt;name&gt;' -g '&lt;resource_group&gt;'\n</code></pre>","tags":["Azure.Storage.ContainerSoftDelete","AZR-000289"]},{"location":"en/rules/Azure.Storage.ContainerSoftDelete/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Enable-AzStorageContainerDeleteRetentionPolicy -ResourceGroupName '&lt;resource_group&gt;' -StorageAccountName '&lt;name&gt;' -RetentionDays 7\n</code></pre>","tags":["Azure.Storage.ContainerSoftDelete","AZR-000289"]},{"location":"en/rules/Azure.Storage.ContainerSoftDelete/#notes","title":"Notes","text":"<p>Cloud Shell storage with the tag <code>ms-resource-usage = 'azure-cloud-shell'</code> is excluded. Storage accounts used for Cloud Shell are not intended to store data.</p> <p>Storage accounts with:</p> <ul> <li>Hierarchical namespace enabled to not support blob soft delete.</li> <li>Deployed as a <code>FileStorage</code> storage account do not support blob soft delete.</li> </ul>","tags":["Azure.Storage.ContainerSoftDelete","AZR-000289"]},{"location":"en/rules/Azure.Storage.ContainerSoftDelete/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Storage Accounts and reliability</li> <li>Soft delete for containers</li> <li>Enable and manage soft delete for containers</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Storage.ContainerSoftDelete","AZR-000289"]},{"location":"en/rules/Azure.Storage.Defender.DataScan/","title":"Sensitive data threat detection","text":"Azure.Storage.Defender.DataScanAZR-000391Error <p> Security  \u00b7  Storage Account  \u00b7  Rule  \u00b7  Preview  \u00b7  2023_06  \u00b7  Critical</p> <p>Enable sensitive data threat detection in Microsoft Defender for Storage.</p>","tags":["Azure.Storage.Defender.DataScan","AZR-000391"]},{"location":"en/rules/Azure.Storage.Defender.DataScan/#description","title":"Description","text":"<p>Sensitive data threat detection is an additional security feature for Microsoft Defender for Storage. When enabled Defender for Storage provides alerts when sensitive data is discovered.</p> <p>The sensitive data threat detection capability helps teams:</p> <ul> <li>Identity where sensitive data is stored.</li> <li>Detect possible security incidents resulting is data exposure.</li> </ul> <p>When enabling sensitive data threat detection, the sensitive data categories include built-in sensitive information types (SITs) in the default list of Microsoft Purview. It is possible to customize the Data Sensitivity Discovery for a organization, by creating custom sensitive information types (SITs).</p> <p>Sensitive data threat detection in Microsoft Defender for Storage can be enabled at the subscription level and by doing so ensures all storage accounts in the subscription will be protected, including future ones.</p> <p>When overriding sensitive data threat detection on individual Storage Account it is possible to configure custom sensitive data threat detection settings that differ from the settings configured at the subscription level.</p>","tags":["Azure.Storage.Defender.DataScan","AZR-000391"]},{"location":"en/rules/Azure.Storage.Defender.DataScan/#recommendation","title":"Recommendation","text":"<p>Consider enabling sensitive data threat detection using Microsoft Defender for Storage on the Storage Account. Additionally, consider enabling sensitive data threat detection for all Storage Accounts within a subscription.</p>","tags":["Azure.Storage.Defender.DataScan","AZR-000391"]},{"location":"en/rules/Azure.Storage.Defender.DataScan/#examples","title":"Examples","text":"","tags":["Azure.Storage.Defender.DataScan","AZR-000391"]},{"location":"en/rules/Azure.Storage.Defender.DataScan/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.Security/DefenderForStorageSettings</code> sub-resource (extension resource).</li> <li>Set the <code>properties.sensitiveDataDiscovery.isEnabled</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/defenderForStorageSettings\",\n  \"apiVersion\": \"2022-12-01-preview\",\n  \"scope\": \"[format('Microsoft.Storage/storageAccounts/{0}', parameters('name'))]\",\n  \"name\": \"current\",\n  \"properties\": {\n    \"isEnabled\": true,\n    \"malwareScanning\": {\n      \"onUpload\": {\n        \"isEnabled\": true,\n        \"capGBPerMonth\": 5000\n      }\n    },\n    \"sensitiveDataDiscovery\": {\n      \"isEnabled\": true\n    },\n    \"overrideSubscriptionLevelSettings\": false\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Storage/storageAccounts', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.Storage.Defender.DataScan","AZR-000391"]},{"location":"en/rules/Azure.Storage.Defender.DataScan/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.Security/DefenderForStorageSettings</code> sub-resource (extension resource).</li> <li>Set the <code>properties.sensitiveDataDiscovery.isEnabled</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForStorageSettings 'Microsoft.Security/defenderForStorageSettings@2022-12-01-preview' = {\n  name: 'current'\n  scope: storageAccount\n  properties: {\n    isEnabled: true\n    malwareScanning: {\n      onUpload: {\n        isEnabled: true\n        capGBPerMonth: 5000\n      }\n    }\n    sensitiveDataDiscovery: {\n      isEnabled: true\n    }\n    overrideSubscriptionLevelSettings: false\n  }\n}\n</code></pre>","tags":["Azure.Storage.Defender.DataScan","AZR-000391"]},{"location":"en/rules/Azure.Storage.Defender.DataScan/#notes","title":"Notes","text":"<p>This feature is currently in preview.</p> <p>The following limitations currently apply for Microsoft Defender for Storage:</p> <ul> <li>Only Storage Accounts with public network access set to enabled are supported.</li> <li>Not all storage services within Storage Accounts are currently supported.</li> <li>When Microsoft Defender is enabled at subscription and resource level, the subscription configuration will take priority.   To override settings on a Storage Account, set the <code>properties.overrideSubscriptionLevelSettings</code> property to <code>true</code>.</li> <li>If there is no plan at the subscription level, Microsoft Defender for Storage can be configured without an override.</li> </ul>","tags":["Azure.Storage.Defender.DataScan","AZR-000391"]},{"location":"en/rules/Azure.Storage.Defender.DataScan/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>What is Microsoft Defender for Cloud?</li> <li>Sensitive data threat detection in Defender for Storage</li> <li>Support and prerequisites for data-aware security posture</li> <li>Overview of Microsoft Defender for Storage</li> <li>Enable and configure Microsoft Defender for Storage</li> <li>Quickstart: Enable enhanced security features</li> <li>Azure security baseline for Storage</li> <li>DP-2: Monitor anomalies and threats targeting sensitive data</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure Policy built-in policy definitions</li> </ul>","tags":["Azure.Storage.Defender.DataScan","AZR-000391"]},{"location":"en/rules/Azure.Storage.Defender.MalwareScan/","title":"Malware Scanning","text":"Azure.Storage.Defender.MalwareScanAZR-000384Error <p> Security  \u00b7  Storage Account  \u00b7  Rule  \u00b7  2024_03  \u00b7  Critical</p> <p>Enable Malware Scanning in Microsoft Defender for Storage.</p>","tags":["Azure.Storage.Defender.MalwareScan","AZR-000384"]},{"location":"en/rules/Azure.Storage.Defender.MalwareScan/#description","title":"Description","text":"<p>Microsoft Defender for Storage provides additional security for storage accounts.</p> <p>One of the features in the Defender for Storage service is malware scanning that is powered by Microsoft Defender Antivirus.</p> <p>Content uploaded to cloud storage could be malware. Storage accounts can be a malware entry point into the organization and a malware distribution point. To protect organizations from this threat, content in cloud storage must be scanned for malware before it's accessed.</p> <p>Malware Scanning in Defender for Storage helps protect storage accounts from malicious content by performing a full malware scan on uploaded content in near real time.</p> <p>This can be helpful when:</p> <ul> <li>To protect storage accounts from malicious content, especially when content in the storage account is uploaded from untrusted sources (customers and partners, anonymous users, etc.)</li> <li>To comply with compliance standards that require on-upload malware scanning for non-compute resources (NIST, SWIFT, UK GOV, and more), and collecting the necessary evidence for compliance audits.</li> </ul> <p>When the malware scan identifies a malicious file, detailed Microsoft Defenders for Cloud security alerts are generated.</p> <p>Malware Scanning in Microsoft Defender for Storage can be enabled at the resource level. However, the general recommendation is to enable it at the subscription level and by doing so ensures all storage accounts in the subscription will be protected, including future ones. Defender for Storage settings on each storage account is inherited by the subscription level settings.</p> <p>It is also worth to mention that the resource level enablement can be useful when:</p> <ul> <li>Override subscription level settings to configure specific storage accounts with custom malware scanning settings that differ from the settings configured at the subscription level.</li> </ul>","tags":["Azure.Storage.Defender.MalwareScan","AZR-000384"]},{"location":"en/rules/Azure.Storage.Defender.MalwareScan/#recommendation","title":"Recommendation","text":"<p>Consider enabling Malware Scanning using Microsoft Defender for Storage on the Storage Account. Alternatively, enable Malware Scanning for all Storage Accounts within a subscription.</p>","tags":["Azure.Storage.Defender.MalwareScan","AZR-000384"]},{"location":"en/rules/Azure.Storage.Defender.MalwareScan/#examples","title":"Examples","text":"","tags":["Azure.Storage.Defender.MalwareScan","AZR-000384"]},{"location":"en/rules/Azure.Storage.Defender.MalwareScan/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.Security/DefenderForStorageSettings</code> sub-resource (extension resource).</li> <li>Set the <code>properties.malwareScanning.onUpload.isEnabled</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/defenderForStorageSettings\",\n  \"apiVersion\": \"2022-12-01-preview\",\n  \"scope\": \"[format('Microsoft.Storage/storageAccounts/{0}', parameters('name'))]\",\n  \"name\": \"current\",\n  \"properties\": {\n    \"isEnabled\": true,\n    \"malwareScanning\": {\n      \"onUpload\": {\n        \"isEnabled\": true,\n        \"capGBPerMonth\": 5000\n      }\n    },\n    \"sensitiveDataDiscovery\": {\n      \"isEnabled\": true\n    },\n    \"overrideSubscriptionLevelSettings\": false\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Storage/storageAccounts', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.Storage.Defender.MalwareScan","AZR-000384"]},{"location":"en/rules/Azure.Storage.Defender.MalwareScan/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.Security/DefenderForStorageSettings</code> sub-resource (extension resource).</li> <li>Set the <code>properties.malwareScanning.onUpload.isEnabled</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForStorageSettings 'Microsoft.Security/defenderForStorageSettings@2022-12-01-preview' = {\n  name: 'current'\n  scope: storageAccount\n  properties: {\n    isEnabled: true\n    malwareScanning: {\n      onUpload: {\n        isEnabled: true\n        capGBPerMonth: 5000\n      }\n    }\n    sensitiveDataDiscovery: {\n      isEnabled: true\n    }\n    overrideSubscriptionLevelSettings: false\n  }\n}\n</code></pre>","tags":["Azure.Storage.Defender.MalwareScan","AZR-000384"]},{"location":"en/rules/Azure.Storage.Defender.MalwareScan/#notes","title":"Notes","text":"<p>Not all services within storage accounts are currently supported.</p> <ul> <li>When the plan is already enabled at the subscription level and the resource level override property <code>overrideSubscriptionLevelSettings</code> value is <code>false</code>, the resource level enablement will be ignored and the subscription level (plan) will still be used.</li> <li>If the override property <code>overrideSubscriptionLevelSettings</code> value is <code>true</code>, the resource level enablement will be honored and a dedicated plan will be configured for the storage account.</li> <li>If there is no plan at the subscription level, the resource level enablement will be honored and a dedicated plan will be configured for the storage account.</li> </ul>","tags":["Azure.Storage.Defender.MalwareScan","AZR-000384"]},{"location":"en/rules/Azure.Storage.Defender.MalwareScan/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>What is Microsoft Defender for Cloud?</li> <li>Malware Scanning in Defender for Storage</li> <li>Limitations</li> <li>Setting up response to Malware Scanning</li> <li>Overview of Microsoft Defender for Storage</li> <li>Enable and configure Microsoft Defender for Storage</li> <li>Quickstart: Enable enhanced security features</li> <li>Azure security baseline for Storage</li> <li>DP-2: Monitor anomalies and threats targeting sensitive data</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure Policy built-in policy definitions</li> </ul>","tags":["Azure.Storage.Defender.MalwareScan","AZR-000384"]},{"location":"en/rules/Azure.Storage.DefenderCloud/","title":"Enable Microsoft Defender","text":"Azure.Storage.DefenderCloudAZR-000386Error <p> Security  \u00b7  Storage Account  \u00b7  Rule  \u00b7  2023_06  \u00b7  Critical</p> <p>Enable Microsoft Defender for Storage for storage accounts.</p>","tags":["Azure.Storage.DefenderCloud","AZR-000386"]},{"location":"en/rules/Azure.Storage.DefenderCloud/#description","title":"Description","text":"<p>Microsoft Defender for Storage analyzes data and control plane logs from protected Storage Accounts. Which allows Microsoft Defender for Cloud to surface findings with details of the security threats and contextual information.</p> <p>Additionally, Microsoft Defender for Storage provides security extensions to analyze data stored within Storage Accounts:</p> <ul> <li>Anti-malware scanning of uploaded content in near real time, leveraging Microsoft Defender Antivirus capabilities.</li> <li>Sensitive data threat detection to find resources with sensitive data.</li> </ul> <p>Microsoft Defender for Storage can be enabled on a per subscription or per resource basis. Enabling at the subscription level is recommended because it protects current and future Storage Accounts. However, enabling at the resource level may be preferred for specific Storage Account to apply custom settings.</p>","tags":["Azure.Storage.DefenderCloud","AZR-000386"]},{"location":"en/rules/Azure.Storage.DefenderCloud/#recommendation","title":"Recommendation","text":"<p>Consider using Microsoft Defender for Storage to protect your data hosted in storage accounts. Additionally, consider using Microsoft Defender for Storage to protect all storage accounts within a subscription.</p>","tags":["Azure.Storage.DefenderCloud","AZR-000386"]},{"location":"en/rules/Azure.Storage.DefenderCloud/#examples","title":"Examples","text":"","tags":["Azure.Storage.DefenderCloud","AZR-000386"]},{"location":"en/rules/Azure.Storage.DefenderCloud/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy storage accounts that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.Security/DefenderForStorageSettings</code> sub-resource (extension resource).</li> <li>Set the <code>properties.isEnabled</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/defenderForStorageSettings\",\n  \"apiVersion\": \"2022-12-01-preview\",\n  \"scope\": \"[format('Microsoft.Storage/storageAccounts/{0}', parameters('name'))]\",\n  \"name\": \"current\",\n  \"properties\": {\n    \"isEnabled\": true,\n    \"malwareScanning\": {\n      \"onUpload\": {\n        \"isEnabled\": true,\n        \"capGBPerMonth\": 5000\n      }\n    },\n    \"sensitiveDataDiscovery\": {\n      \"isEnabled\": true\n    },\n    \"overrideSubscriptionLevelSettings\": false\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Storage/storageAccounts', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.Storage.DefenderCloud","AZR-000386"]},{"location":"en/rules/Azure.Storage.DefenderCloud/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy storage accounts that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.Security/DefenderForStorageSettings</code> sub-resource (extension resource).</li> <li>Set the <code>properties.isEnabled</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource defenderForStorageSettings 'Microsoft.Security/defenderForStorageSettings@2022-12-01-preview' = {\n  name: 'current'\n  scope: storageAccount\n  properties: {\n    isEnabled: true\n    malwareScanning: {\n      onUpload: {\n        isEnabled: true\n        capGBPerMonth: 5000\n      }\n    }\n    sensitiveDataDiscovery: {\n      isEnabled: true\n    }\n    overrideSubscriptionLevelSettings: false\n  }\n}\n</code></pre>","tags":["Azure.Storage.DefenderCloud","AZR-000386"]},{"location":"en/rules/Azure.Storage.DefenderCloud/#notes","title":"Notes","text":"<p>The following limitations currently apply for Microsoft Defender for Storage:</p> <ul> <li>Sensitive data discovery are preview features.</li> <li>Storage types supported are <code>Blob Storage</code>, <code>Azure Files</code> and <code>Azure Data Lake Storage Gen2</code>.   Other storage types are not supported.</li> <li>When Microsoft Defender is enabled at subscription and resource level, the subscription configuration will take priority.   To override settings on a Storage Account, set the <code>properties.overrideSubscriptionLevelSettings</code> property to <code>true</code>.</li> <li>If there is no plan at the subscription level, Microsoft Defender for Storage can be configured without an override.</li> </ul>","tags":["Azure.Storage.DefenderCloud","AZR-000386"]},{"location":"en/rules/Azure.Storage.DefenderCloud/#rule-configuration","title":"Rule configuration","text":"<p>AZURE_STORAGE_DEFENDER_PER_ACCOUNT</p> <p>This rule is not processed by default because configuration at the subscription level is recommended. To enable this rule, set the <code>AZURE_STORAGE_DEFENDER_PER_ACCOUNT</code> configuration value to <code>true</code>.</p>","tags":["Azure.Storage.DefenderCloud","AZR-000386"]},{"location":"en/rules/Azure.Storage.DefenderCloud/#links","title":"Links","text":"<ul> <li>SE:10 Monitoring and threat detection</li> <li>What is Microsoft Defender for Cloud?</li> <li>Overview of Microsoft Defender for Storage</li> <li>Enable and configure Microsoft Defender for Storage</li> <li>Quickstart: Enable enhanced security features</li> <li>Azure security baseline for Storage</li> <li>DP-2: Monitor anomalies and threats targeting sensitive data</li> <li>LT-1: Enable threat detection capabilities</li> <li>Azure Policy built-in policy definitions</li> </ul>","tags":["Azure.Storage.DefenderCloud","AZR-000386"]},{"location":"en/rules/Azure.Storage.FileShareSoftDelete/","title":"Use soft delete on files shares","text":"Azure.Storage.FileShareSoftDeleteAZR-000298Error <p> Reliability  \u00b7  Storage Account  \u00b7  Rule  \u00b7  2022_09  \u00b7  Important</p>","tags":["Azure.Storage.FileShareSoftDelete","AZR-000298"]},{"location":"en/rules/Azure.Storage.FileShareSoftDelete/#synopsis","title":"Synopsis","text":"<p>Enable soft delete on Storage Accounts file shares.</p>","tags":["Azure.Storage.FileShareSoftDelete","AZR-000298"]},{"location":"en/rules/Azure.Storage.FileShareSoftDelete/#description","title":"Description","text":"<p>Soft delete for Azure Files protects your shares from being accidentally deleted. This feature does not protect against individual files being deleted or modified. When soft delete is enabled for a Azure Files on a Storage Account, a share and its contents may be recovered after it has been deleted, within a retention period that you specify.</p> <p>Soft delete on file shares should be considered part of the strategy to protect and retain data for Azure Files. Also consider:</p> <ul> <li>Enabling Azure File Share Backup.</li> <li>Implementing role-based access control (RBAC).</li> </ul> <p>Storage Accounts can be configured to retain deleted share for a period of time between 1 and 365 days.</p>","tags":["Azure.Storage.FileShareSoftDelete","AZR-000298"]},{"location":"en/rules/Azure.Storage.FileShareSoftDelete/#recommendation","title":"Recommendation","text":"<p>Consider enabling soft delete on Azure Files to protect against accidental deletion of shares.</p>","tags":["Azure.Storage.FileShareSoftDelete","AZR-000298"]},{"location":"en/rules/Azure.Storage.FileShareSoftDelete/#examples","title":"Examples","text":"","tags":["Azure.Storage.FileShareSoftDelete","AZR-000298"]},{"location":"en/rules/Azure.Storage.FileShareSoftDelete/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Set the <code>properties.deleteRetentionPolicy.enabled</code> property to <code>true</code> on the <code>fileServices</code> sub-resource</li> <li>Configure the <code>properties.deleteRetentionPolicy.days</code> property to the number of days to retain files.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Storage/storageAccounts/fileServices\",\n  \"apiVersion\": \"2022-05-01\",\n  \"name\": \"default\",\n  \"properties\": {\n    \"shareDeleteRetentionPolicy\": {\n      \"days\": \"7\",\n      \"enabled\": \"true\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.Storage.FileShareSoftDelete","AZR-000298"]},{"location":"en/rules/Azure.Storage.FileShareSoftDelete/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Set the <code>properties.deleteRetentionPolicy.enabled</code> property to <code>true</code> on the <code>fileServices</code> sub-resource</li> <li>Configure the <code>properties.deleteRetentionPolicy.days</code> property to the number of days to retain files.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource fileServices 'Microsoft.Storage/storageAccounts/fileServices@2023-01-01' = {\n  parent: storageAccount\n  name: 'default'\n  properties: {\n    shareDeleteRetentionPolicy: {\n      enabled: true\n      days: 7\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/storage/storage-account:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/storage/storage-account:0.9.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Storage.FileShareSoftDelete","AZR-000298"]},{"location":"en/rules/Azure.Storage.FileShareSoftDelete/#notes","title":"Notes","text":"<p>Cloud Shell storage with the tag <code>ms-resource-usage = 'azure-cloud-shell'</code> is excluded. Storage accounts used for Cloud Shell are not intended to store data.</p>","tags":["Azure.Storage.FileShareSoftDelete","AZR-000298"]},{"location":"en/rules/Azure.Storage.FileShareSoftDelete/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Storage Accounts and reliability</li> <li>Enable soft delete on Azure file shares</li> <li>About Azure file share backup</li> <li>Authorize access to file data</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Storage.FileShareSoftDelete","AZR-000298"]},{"location":"en/rules/Azure.Storage.Firewall/","title":"Configure Azure Storage firewall","text":"Azure.Storage.FirewallAZR-000202Error <p> Security  \u00b7  Storage Account  \u00b7  Rule  \u00b7  2021_09  \u00b7  Important</p> <p>Storage Accounts should only accept explicitly allowed traffic.</p>","tags":["Azure.Storage.Firewall","AZR-000202"]},{"location":"en/rules/Azure.Storage.Firewall/#description","title":"Description","text":"<p>By default, storage accounts accept connections from clients on any network. To limit access to selected networks, you must first change the default action.</p> <p>After changing the default action from <code>Allow</code> to <code>Deny</code>, configure one or more rules to allow traffic. Traffic can be allowed from:</p> <ul> <li>Azure services on the trusted service list.</li> <li>IP address or CIDR range.</li> <li>Private endpoint connections.</li> <li>Azure virtual network subnets with a Service Endpoint.</li> </ul>","tags":["Azure.Storage.Firewall","AZR-000202"]},{"location":"en/rules/Azure.Storage.Firewall/#recommendation","title":"Recommendation","text":"<p>Consider configuring storage firewall to restrict network access to permitted clients only. Also consider enforcing this setting using Azure Policy.</p>","tags":["Azure.Storage.Firewall","AZR-000202"]},{"location":"en/rules/Azure.Storage.Firewall/#examples","title":"Examples","text":"","tags":["Azure.Storage.Firewall","AZR-000202"]},{"location":"en/rules/Azure.Storage.Firewall/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Set the <code>properties.networkAcls.defaultAction</code> property to <code>Deny</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Storage/storageAccounts\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_GRS\"\n  },\n  \"kind\": \"StorageV2\",\n  \"properties\": {\n    \"allowBlobPublicAccess\": false,\n    \"supportsHttpsTrafficOnly\": true,\n    \"minimumTlsVersion\": \"TLS1_2\",\n    \"accessTier\": \"Hot\",\n    \"allowSharedKeyAccess\": false,\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.Storage.Firewall","AZR-000202"]},{"location":"en/rules/Azure.Storage.Firewall/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Set the <code>properties.networkAcls.defaultAction</code> property to <code>Deny</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard_GRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    allowBlobPublicAccess: false\n    supportsHttpsTrafficOnly: true\n    minimumTlsVersion: 'TLS1_2'\n    accessTier: 'Hot'\n    allowSharedKeyAccess: false\n    networkAcls: {\n      defaultAction: 'Deny'\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/storage/storage-account:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/storage/storage-account:0.9.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Storage.Firewall","AZR-000202"]},{"location":"en/rules/Azure.Storage.Firewall/#notes","title":"Notes","text":"<p>Cloud Shell storage with the tag <code>ms-resource-usage = 'azure-cloud-shell'</code> is excluded. Azure storage firewall is not supported for Cloud Shell storage accounts.</p>","tags":["Azure.Storage.Firewall","AZR-000202"]},{"location":"en/rules/Azure.Storage.Firewall/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Configure Azure Storage firewalls and virtual networks</li> <li>Use private endpoints for Azure Storage</li> <li>Persist files in Azure Cloud Shell</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Storage.Firewall","AZR-000202"]},{"location":"en/rules/Azure.Storage.MinTLS/","title":"Storage Account minimum TLS version","text":"Azure.Storage.MinTLSAZR-000200Error <p> Security  \u00b7  Storage Account  \u00b7  Rule  \u00b7  2020_09  \u00b7  Critical</p> <p>Storage Accounts should reject TLS versions older than 1.2.</p>","tags":["Azure.Storage.MinTLS","AZR-000200"]},{"location":"en/rules/Azure.Storage.MinTLS/#description","title":"Description","text":"<p>The minimum version of TLS that Azure Storage Accounts accept for blob storage is configurable. Older TLS versions are no longer considered secure by industry standards, such as PCI DSS.</p> <p>Storage Accounts lets you disable outdated protocols and enforce TLS 1.2. By default, TLS 1.0, TLS 1.1, and TLS 1.2 is accepted.</p> <p>When clients connect using an older version of TLS that is disabled, the connection will fail.</p>","tags":["Azure.Storage.MinTLS","AZR-000200"]},{"location":"en/rules/Azure.Storage.MinTLS/#recommendation","title":"Recommendation","text":"<p>Consider configuring the minimum supported TLS version to be 1.2. Also consider enforcing this setting using Azure Policy.</p>","tags":["Azure.Storage.MinTLS","AZR-000200"]},{"location":"en/rules/Azure.Storage.MinTLS/#examples","title":"Examples","text":"","tags":["Azure.Storage.MinTLS","AZR-000200"]},{"location":"en/rules/Azure.Storage.MinTLS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Set the <code>properties.minimumTlsVersion</code> property to <code>TLS1_2</code> or newer.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Storage/storageAccounts\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_GRS\"\n  },\n  \"kind\": \"StorageV2\",\n  \"properties\": {\n    \"allowBlobPublicAccess\": false,\n    \"supportsHttpsTrafficOnly\": true,\n    \"minimumTlsVersion\": \"TLS1_2\",\n    \"accessTier\": \"Hot\",\n    \"allowSharedKeyAccess\": false,\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.Storage.MinTLS","AZR-000200"]},{"location":"en/rules/Azure.Storage.MinTLS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Set the <code>properties.minimumTlsVersion</code> property to <code>TLS1_2</code> or newer.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard_GRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    allowBlobPublicAccess: false\n    supportsHttpsTrafficOnly: true\n    minimumTlsVersion: 'TLS1_2'\n    accessTier: 'Hot'\n    allowSharedKeyAccess: false\n    networkAcls: {\n      defaultAction: 'Deny'\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/storage/storage-account:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/storage/storage-account:0.9.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Storage.MinTLS","AZR-000200"]},{"location":"en/rules/Azure.Storage.MinTLS/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Storage accounts should have the specified minimum TLS version <code>/providers/Microsoft.Authorization/policyDefinitions/fe83a0eb-a853-422d-aac2-1bffd182c5d0</code></li> </ul>","tags":["Azure.Storage.MinTLS","AZR-000200"]},{"location":"en/rules/Azure.Storage.MinTLS/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Enforce a minimum required version of Transport Layer Security (TLS) for requests to a storage account</li> <li>DP-3: Encrypt sensitive data in transit</li> <li>TLS encryption in Azure</li> <li>Preparing for TLS 1.2 in Microsoft Azure</li> <li>Use Azure Policy to enforce the minimum TLS version</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Storage.MinTLS","AZR-000200"]},{"location":"en/rules/Azure.Storage.Name/","title":"Use valid storage account names","text":"Azure.Storage.NameAZR-000201Error <p> Operational Excellence  \u00b7  Storage Account  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Storage Account names should meet naming requirements.</p>","tags":["Azure.Storage.Name","AZR-000201"]},{"location":"en/rules/Azure.Storage.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Storage Account names are:</p> <ul> <li>Between 3 and 24 characters long.</li> <li>Lowercase letters or numbers.</li> <li>Storage Account names must be globally unique.</li> </ul>","tags":["Azure.Storage.Name","AZR-000201"]},{"location":"en/rules/Azure.Storage.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Storage Account naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.Storage.Name","AZR-000201"]},{"location":"en/rules/Azure.Storage.Name/#notes","title":"Notes","text":"<p>This rule does not check if Storage Account names are unique.</p>","tags":["Azure.Storage.Name","AZR-000201"]},{"location":"en/rules/Azure.Storage.Name/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Azure resources</li> <li>Recommended abbreviations for Azure resource types</li> <li>Parameters in Bicep</li> <li>Bicep functions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Storage.Name","AZR-000201"]},{"location":"en/rules/Azure.Storage.SecureTransfer/","title":"Enforce encrypted Storage connections","text":"Azure.Storage.SecureTransferAZR-000196Error <p> Security  \u00b7  Storage Account  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Storage accounts should only accept encrypted connections.</p>","tags":["Azure.Storage.SecureTransfer","AZR-000196"]},{"location":"en/rules/Azure.Storage.SecureTransfer/#description","title":"Description","text":"<p>Azure Storage Accounts can be configured to allow unencrypted connections. Unencrypted communication could allow disclosure of information to an un-trusted party. Storage Accounts can be configured to require encrypted connections.</p> <p>To do this set the Secure transfer required option. When secure transfer required is enabled, attempts to connect to storage using HTTP or unencrypted SMB connections are rejected.</p> <p>Storage Accounts that are deployed with a newer API version will have this option enabled by default. However, this does not prevent the option from being disabled.</p>","tags":["Azure.Storage.SecureTransfer","AZR-000196"]},{"location":"en/rules/Azure.Storage.SecureTransfer/#recommendation","title":"Recommendation","text":"<p>Storage accounts should only accept secure traffic. Consider only accepting encrypted connections by setting the Secure transfer required option. Also consider using Azure Policy to audit or enforce this configuration.</p>","tags":["Azure.Storage.SecureTransfer","AZR-000196"]},{"location":"en/rules/Azure.Storage.SecureTransfer/#examples","title":"Examples","text":"","tags":["Azure.Storage.SecureTransfer","AZR-000196"]},{"location":"en/rules/Azure.Storage.SecureTransfer/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>For API versions older then 2019-04-01, set the <code>properties.supportsHttpsTrafficOnly</code> property to <code>true</code>.</li> <li>For API versions 2019-04-01 and newer:<ul> <li>Omit the <code>properties.supportsHttpsTrafficOnly</code> property OR</li> <li>Explicitly set the <code>properties.supportsHttpsTrafficOnly</code> property to <code>true</code>.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Storage/storageAccounts\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_GRS\"\n  },\n  \"kind\": \"StorageV2\",\n  \"properties\": {\n    \"allowBlobPublicAccess\": false,\n    \"supportsHttpsTrafficOnly\": true,\n    \"minimumTlsVersion\": \"TLS1_2\",\n    \"accessTier\": \"Hot\",\n    \"allowSharedKeyAccess\": false,\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.Storage.SecureTransfer","AZR-000196"]},{"location":"en/rules/Azure.Storage.SecureTransfer/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>For API versions older then 2019-04-01, set the <code>properties.supportsHttpsTrafficOnly</code> property to <code>true</code>.</li> <li>For API versions 2019-04-01 and newer:<ul> <li>Omit the <code>properties.supportsHttpsTrafficOnly</code> property OR</li> <li>Explicitly set the <code>properties.supportsHttpsTrafficOnly</code> property to <code>true</code>.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard_GRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    allowBlobPublicAccess: false\n    supportsHttpsTrafficOnly: true\n    minimumTlsVersion: 'TLS1_2'\n    accessTier: 'Hot'\n    allowSharedKeyAccess: false\n    networkAcls: {\n      defaultAction: 'Deny'\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/storage/storage-account:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/storage/storage-account:0.9.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Storage.SecureTransfer","AZR-000196"]},{"location":"en/rules/Azure.Storage.SecureTransfer/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Secure transfer to storage accounts should be enabled <code>/providers/Microsoft.Authorization/policyDefinitions/404c3081-a854-4457-ae30-26a93ef643f9</code></li> <li>Configure secure transfer of data on a storage account <code>/providers/Microsoft.Authorization/policyDefinitions/f81e3117-0093-4b17-8a60-82363134f0eb</code></li> </ul>","tags":["Azure.Storage.SecureTransfer","AZR-000196"]},{"location":"en/rules/Azure.Storage.SecureTransfer/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Require secure transfer in Azure Storage</li> <li>DP-3: Encrypt sensitive data in transit</li> <li>Sample policy for ensuring https traffic</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Storage.SecureTransfer","AZR-000196"]},{"location":"en/rules/Azure.Storage.SoftDelete/","title":"Use blob soft delete","text":"Azure.Storage.SoftDeleteAZR-000197Error <p> Reliability  \u00b7  Storage Account  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Enable blob soft delete on Storage Accounts.</p>","tags":["Azure.Storage.SoftDelete","AZR-000197"]},{"location":"en/rules/Azure.Storage.SoftDelete/#description","title":"Description","text":"<p>Soft delete provides an easy way to recover deleted or modified blob data stored within Storage Accounts. When soft delete is enabled, deleted blobs are kept and can be restored within the configured interval.</p> <p>Blob soft delete should be considered part of the strategy to protect and retain data. Also consider:</p> <ul> <li>Implementing role-based access control (RBAC).</li> <li>Configuring resource locks to protect against deletion.</li> <li>Configuring blob container soft delete.</li> </ul> <p>Blobs can be configured to retain deleted blobs for a period of time between 1 and 365 days.</p>","tags":["Azure.Storage.SoftDelete","AZR-000197"]},{"location":"en/rules/Azure.Storage.SoftDelete/#recommendation","title":"Recommendation","text":"<p>Consider enabling soft delete on storage accounts to protect blobs from accidental deletion or modification.</p>","tags":["Azure.Storage.SoftDelete","AZR-000197"]},{"location":"en/rules/Azure.Storage.SoftDelete/#examples","title":"Examples","text":"","tags":["Azure.Storage.SoftDelete","AZR-000197"]},{"location":"en/rules/Azure.Storage.SoftDelete/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Set the <code>properties.deleteRetentionPolicy.enabled</code> property to <code>true</code> on the blob services sub-resource.</li> <li>Configure the <code>properties.deleteRetentionPolicy.days</code> property to the number of days to retain blobs.</li> </ul> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Storage/storageAccounts\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_GRS\"\n  },\n  \"kind\": \"StorageV2\",\n  \"properties\": {\n    \"allowBlobPublicAccess\": false,\n    \"supportsHttpsTrafficOnly\": true,\n    \"minimumTlsVersion\": \"TLS1_2\",\n    \"accessTier\": \"Hot\",\n    \"allowSharedKeyAccess\": false,\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\"\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.Storage/storageAccounts/blobServices\",\n      \"apiVersion\": \"2023-01-01\",\n      \"name\": \"[format('{0}/{1}', parameters('name'), 'default')]\",\n      \"properties\": {\n        \"deleteRetentionPolicy\": {\n          \"enabled\": true,\n          \"days\": 7\n        },\n        \"containerDeleteRetentionPolicy\": {\n          \"enabled\": true,\n          \"days\": 7\n        }\n      },\n      \"dependsOn\": [\n        \"[resourceId('Microsoft.Storage/storageAccounts', parameters('name'))]\"\n      ]\n    }\n  ]\n}\n</code></pre>","tags":["Azure.Storage.SoftDelete","AZR-000197"]},{"location":"en/rules/Azure.Storage.SoftDelete/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Set the <code>properties.deleteRetentionPolicy.enabled</code> property to <code>true</code> on the blob services sub-resource.</li> <li>Configure the <code>properties.deleteRetentionPolicy.days</code> property to the number of days to retain blobs.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard_GRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    allowBlobPublicAccess: false\n    supportsHttpsTrafficOnly: true\n    minimumTlsVersion: 'TLS1_2'\n    accessTier: 'Hot'\n    allowSharedKeyAccess: false\n    networkAcls: {\n      defaultAction: 'Deny'\n    }\n  }\n}\n\nresource blobService 'Microsoft.Storage/storageAccounts/blobServices@2023-01-01' = {\n  parent: storageAccount\n  name: 'default'\n  properties: {\n    deleteRetentionPolicy: {\n      enabled: true\n      days: 7\n    }\n    containerDeleteRetentionPolicy: {\n      enabled: true\n      days: 7\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/storage/storage-account:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/storage/storage-account:0.9.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Storage.SoftDelete","AZR-000197"]},{"location":"en/rules/Azure.Storage.SoftDelete/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az storage account blob-service-properties update --enable-delete-retention true --delete-retention-days 7 -n '&lt;name&gt;' -g '&lt;resource_group&gt;'\n</code></pre>","tags":["Azure.Storage.SoftDelete","AZR-000197"]},{"location":"en/rules/Azure.Storage.SoftDelete/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Enable-AzStorageBlobDeleteRetentionPolicy -ResourceGroupName '&lt;resource_group&gt;' -AccountName '&lt;name&gt;' -RetentionDays 7\n</code></pre>","tags":["Azure.Storage.SoftDelete","AZR-000197"]},{"location":"en/rules/Azure.Storage.SoftDelete/#notes","title":"Notes","text":"<p>Cloud Shell storage with the tag <code>ms-resource-usage = 'azure-cloud-shell'</code> is excluded. Storage accounts used for Cloud Shell are not intended to store data.</p> <p>Storage accounts with:</p> <ul> <li>Hierarchical namespace enabled to not support blob soft delete.</li> <li>Deployed as a <code>FileStorage</code> storage account do not support blob soft delete.</li> </ul>","tags":["Azure.Storage.SoftDelete","AZR-000197"]},{"location":"en/rules/Azure.Storage.SoftDelete/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Storage Accounts and reliability</li> <li>Soft delete for Azure Storage blobs</li> <li>Blob storage features available in Azure Data Lake Storage Gen2</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Storage.SoftDelete","AZR-000197"]},{"location":"en/rules/Azure.Storage.UseReplication/","title":"Storage Account is available in a single zone","text":"Azure.Storage.UseReplicationAZR-000195Error <p> Reliability  \u00b7  Storage Account  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Storage Accounts using the LRS SKU are only replicated within a single zone.</p>","tags":["Azure.Storage.UseReplication","AZR-000195"]},{"location":"en/rules/Azure.Storage.UseReplication/#description","title":"Description","text":"<p>Storage Accounts can be configured with several different durability options that replicate data between regions/ zones.</p> <p>Azure provides a number of geo-replicated options including; Geo-redundant storage and geo-zone-redundant storage. Geo-zone-redundant storage is only available in supported regions.</p> <p>The following geo-replicated and zone-replicated options are available within Azure:</p> <ul> <li><code>Standard_GRS</code></li> <li><code>Standard_RAGRS</code></li> <li><code>Standard_GZRS</code></li> <li><code>Standard_RAGZRS</code></li> <li><code>Premium_ZRS</code></li> <li><code>Standard_GZRS</code></li> <li><code>Standard_RAGZRS</code></li> <li><code>Standard_ZRS</code></li> </ul>","tags":["Azure.Storage.UseReplication","AZR-000195"]},{"location":"en/rules/Azure.Storage.UseReplication/#recommendation","title":"Recommendation","text":"<p>Consider using a zone-redundant or geo-replicated SKU for storage accounts that contain data.</p>","tags":["Azure.Storage.UseReplication","AZR-000195"]},{"location":"en/rules/Azure.Storage.UseReplication/#examples","title":"Examples","text":"","tags":["Azure.Storage.UseReplication","AZR-000195"]},{"location":"en/rules/Azure.Storage.UseReplication/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Set the <code>sku.name</code> property to a geo-replicated SKU.   Such as <code>Standard_GRS</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Storage/storageAccounts\",\n  \"apiVersion\": \"2023-05-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_GRS\"\n  },\n  \"kind\": \"StorageV2\",\n  \"properties\": {\n    \"allowBlobPublicAccess\": false,\n    \"supportsHttpsTrafficOnly\": true,\n    \"minimumTlsVersion\": \"TLS1_2\",\n    \"accessTier\": \"Hot\",\n    \"allowSharedKeyAccess\": false,\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.Storage.UseReplication","AZR-000195"]},{"location":"en/rules/Azure.Storage.UseReplication/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Storage Accounts that pass this rule:</p> <ul> <li>Set the <code>sku.name</code> property to a geo-replicated SKU.   Such as <code>Standard_GRS</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource storageAccount 'Microsoft.Storage/storageAccounts@2023-05-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard_GRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    allowBlobPublicAccess: false\n    supportsHttpsTrafficOnly: true\n    minimumTlsVersion: 'TLS1_2'\n    accessTier: 'Hot'\n    allowSharedKeyAccess: false\n    networkAcls: {\n      defaultAction: 'Deny'\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/storage/storage-account:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/storage/storage-account:0.9.1\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.Storage.UseReplication","AZR-000195"]},{"location":"en/rules/Azure.Storage.UseReplication/#notes","title":"Notes","text":"<p>This rule is not applicable for premium storage accounts. Storage Accounts with the following tags are automatically excluded from this rule:</p> <ul> <li><code>ms-resource-usage = 'azure-cloud-shell'</code> - Storage Accounts used for Cloud Shell are not intended to store data.   This tag is applied by Azure to Cloud Shell Storage Accounts by default.</li> <li><code>resource-usage = 'azure-functions'</code> - Storage Accounts used for Azure Functions.   This tag can be optionally configured.</li> <li><code>resource-usage = 'azure-monitor'</code> - Storage Accounts used by Azure Monitor are intended for diagnostic logs.   This tag can be optionally configured.</li> </ul>","tags":["Azure.Storage.UseReplication","AZR-000195"]},{"location":"en/rules/Azure.Storage.UseReplication/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>Azure Storage redundancy</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.Storage.UseReplication","AZR-000195"]},{"location":"en/rules/Azure.Template.DebugDeployment/","title":"Disable debugging of nested deployments","text":"Azure.Template.DebugDeploymentAZR-000225Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_03  \u00b7  Awareness</p> <p>Use default deployment detail level for nested deployments.</p>","tags":["Azure.Template.DebugDeployment","AZR-000225"]},{"location":"en/rules/Azure.Template.DebugDeployment/#description","title":"Description","text":"<p>When creating Azure template, nested deployments can be created with debugging settings enabled. Deployment debugging detail is intended for troubleshooting deployments during development. Debugging settings may log sensitive values. Use caution when using this setting to debug of nested deployments.</p> <p>To reduce nested deployment detail, remove or configure the <code>properties.debugSetting.detailLevel</code> property to <code>none</code> for nested deployments.</p>","tags":["Azure.Template.DebugDeployment","AZR-000225"]},{"location":"en/rules/Azure.Template.DebugDeployment/#recommendation","title":"Recommendation","text":"<p>Consider disabling debugging of nested deployments before release.</p>","tags":["Azure.Template.DebugDeployment","AZR-000225"]},{"location":"en/rules/Azure.Template.DebugDeployment/#links","title":"Links","text":"<ul> <li>Troubleshoot deployment errors</li> <li>DebugSetting</li> <li>Release deployment</li> </ul>","tags":["Azure.Template.DebugDeployment","AZR-000225"]},{"location":"en/rules/Azure.Template.DefineParameters/","title":"Define template parameters","text":"Azure.Template.DefineParametersAZR-000218Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_03  \u00b7  Awareness</p> <p>Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters.</p>","tags":["Azure.Template.DefineParameters","AZR-000218"]},{"location":"en/rules/Azure.Template.DefineParameters/#description","title":"Description","text":"<p>Azure templates support parameters, which are inputs you can specify when deploying the template resources. Each template can support up to 256 parameters.</p> <p>When defining template parameters:</p> <ul> <li>Minimize the number of parameters that require input by specifying a <code>defaultValue</code>.</li> <li>Use parameters for resource names and deployment locations.</li> <li>Use variables or literal resource properties for values that don't change.</li> </ul>","tags":["Azure.Template.DefineParameters","AZR-000218"]},{"location":"en/rules/Azure.Template.DefineParameters/#recommendation","title":"Recommendation","text":"<p>Consider defining a minimal number of parameters to make the template reusable.</p>","tags":["Azure.Template.DefineParameters","AZR-000218"]},{"location":"en/rules/Azure.Template.DefineParameters/#examples","title":"Examples","text":"","tags":["Azure.Template.DefineParameters","AZR-000218"]},{"location":"en/rules/Azure.Template.DefineParameters/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To author templates that pass this rule:</p> <ul> <li>Define at least one parameter.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"metadata\": {\n        \"name\": \"Managed Identity\",\n        \"description\": \"Create or update a Managed Identity.\"\n    },\n    \"parameters\": {\n        \"identityName\": {\n            \"type\": \"string\",\n            \"metadata\": {\n                \"description\": \"The name of the Managed Identity.\"\n            }\n        },\n        \"location\": {\n            \"type\": \"string\",\n            \"defaultValue\": \"[resourceGroup().location]\",\n            \"metadata\": {\n                \"description\": \"The Azure region to deploy to.\",\n                \"example\": \"eastus\"\n            }\n        },\n        \"tags\": {\n            \"type\": \"object\",\n            \"metadata\": {\n                \"description\": \"Tags to apply to the resource.\",\n                \"example\": {\n                    \"service\": \"app1\",\n                    \"env\": \"prod\"\n                }\n            }\n        }\n    },\n    \"variables\": {\n        \"tenantId\": \"[subscription().tenantId]\"\n    },\n    \"resources\": [\n        {\n            \"comments\": \"Create or update a Managed Identity\",\n            \"type\": \"Microsoft.ManagedIdentity/userAssignedIdentities\",\n            \"apiVersion\": \"2018-11-30\",\n            \"name\": \"[parameters('identityName')]\",\n            \"location\": \"[parameters('location')]\",\n            \"properties\": {\n                \"tenantId\": \"[variables('tenantId')]\"\n            },\n            \"tags\": \"[parameters('tags')]\"\n        }\n    ]\n}\n</code></pre>","tags":["Azure.Template.DefineParameters","AZR-000218"]},{"location":"en/rules/Azure.Template.DefineParameters/#notes","title":"Notes","text":"<p>This rule is not applicable and ignored for templates generated with Bicep, PSArm and AzOps. Generated templates from these tools may not require any parameters to be set.</p> <p>This rule is deprecated from v1.36.0. By default, PSRule will not evaluate this rule unless explicitly enabled. See https://aka.ms/ps-rule-azure/deprecations.</p>","tags":["Azure.Template.DefineParameters","AZR-000218"]},{"location":"en/rules/Azure.Template.DefineParameters/#links","title":"Links","text":"<ul> <li>Parameters</li> <li>ARM template best practices</li> <li>Release deployment</li> </ul>","tags":["Azure.Template.DefineParameters","AZR-000218"]},{"location":"en/rules/Azure.Template.ExpressionLength/","title":"Template expressions should not exceed a maximum length","text":"Azure.Template.ExpressionLengthAZR-000228Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_12  \u00b7  Awareness</p> <p>Template expressions should not exceed the maximum length.</p>","tags":["Azure.Template.ExpressionLength","AZR-000228"]},{"location":"en/rules/Azure.Template.ExpressionLength/#description","title":"Description","text":"<p>Extremely long expressions may be difficult to read and debug. Avoid using expressions that exceed 24,576 characters in length.</p>","tags":["Azure.Template.ExpressionLength","AZR-000228"]},{"location":"en/rules/Azure.Template.ExpressionLength/#recommendation","title":"Recommendation","text":"<p>Consider updating the expression to reduce complexity and length.</p>","tags":["Azure.Template.ExpressionLength","AZR-000228"]},{"location":"en/rules/Azure.Template.ExpressionLength/#notes","title":"Notes","text":"<p>This rule is not applicable and ignored for templates generated with Bicep, PSArm, and AzOps. Generated templates from these tools may not require any parameters to be set.</p>","tags":["Azure.Template.ExpressionLength","AZR-000228"]},{"location":"en/rules/Azure.Template.ExpressionLength/#links","title":"Links","text":"<ul> <li>Deployment considerations for DevOps</li> <li>Template limits</li> </ul>","tags":["Azure.Template.ExpressionLength","AZR-000228"]},{"location":"en/rules/Azure.Template.LocationDefault/","title":"Default to resource group location","text":"Azure.Template.LocationDefaultAZR-000220Error <p> Reliability  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_03  \u00b7  Awareness</p> <p>Set the default value for the location parameter within an ARM template to resource group location.</p>","tags":["Azure.Template.LocationDefault","AZR-000220"]},{"location":"en/rules/Azure.Template.LocationDefault/#description","title":"Description","text":"<p>In the event of a regional outage in the resource group location, you will be unable to control resources inside that resource group, regardless of what region those resources are actually in. Resources for regional services should be deployed into a resource group on the same region.</p> <p>When authoring templates, the resource group location should be the default resource location. This approach minimizes the number of times users are asked to provide location information.</p>","tags":["Azure.Template.LocationDefault","AZR-000220"]},{"location":"en/rules/Azure.Template.LocationDefault/#recommendation","title":"Recommendation","text":"<p>Consider updating the <code>location</code> parameter to use <code>[resourceGroup().location]</code> as the default value.</p>","tags":["Azure.Template.LocationDefault","AZR-000220"]},{"location":"en/rules/Azure.Template.LocationDefault/#examples","title":"Examples","text":"","tags":["Azure.Template.LocationDefault","AZR-000220"]},{"location":"en/rules/Azure.Template.LocationDefault/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To author templates that pass this rule:</p> <ul> <li>If the <code>location</code> parameter is specified, it should be set to <code>[resourceGroup().location]</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": {\n        \"location\": {\n            \"type\": \"string\",\n            \"defaultValue\": \"[resourceGroup().location]\",\n            \"metadata\": {\n                \"description\": \"The location resources will be deployed.\"\n            }\n        }\n    },\n    \"resources\": [\n        {\n            \"type\": \"Microsoft.Network/networkSecurityGroups\",\n            \"apiVersion\": \"2021-02-01\",\n            \"name\": \"nsg-001\",\n            \"location\": \"[parameters('location')]\",\n            \"properties\": {\n                \"securityRules\": [\n                    {\n                        \"name\": \"deny-hop-outbound\",\n                        \"properties\": {\n                            \"priority\": 200,\n                            \"access\": \"Deny\",\n                            \"protocol\": \"Tcp\",\n                            \"direction\": \"Outbound\",\n                            \"sourceAddressPrefix\": \"VirtualNetwork\",\n                            \"destinationAddressPrefix\": \"*\",\n                            \"destinationPortRanges\": [\n                                \"3389\",\n                                \"22\"\n                            ]\n                        }\n                    }\n                ]\n            }\n        }\n    ]\n}\n</code></pre>","tags":["Azure.Template.LocationDefault","AZR-000220"]},{"location":"en/rules/Azure.Template.LocationDefault/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To author bicep source files that pass this rule:</p> <ul> <li>If the <code>location</code> parameter is specified, it should be set to <code>resourceGroup().location</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>@description('The location resources will be deployed.')\nparam location string = resourceGroup().location\n</code></pre>","tags":["Azure.Template.LocationDefault","AZR-000220"]},{"location":"en/rules/Azure.Template.LocationDefault/#notes","title":"Notes","text":"<p>This rule ignores templates using tenant, Management Group, and Subscription deployment schemas. Deployment to these scopes does not occur against a resource group.</p>","tags":["Azure.Template.LocationDefault","AZR-000220"]},{"location":"en/rules/Azure.Template.LocationDefault/#links","title":"Links","text":"<ul> <li>ARM template best practices</li> <li>Operating in multiple regions</li> <li>Resource group</li> </ul>","tags":["Azure.Template.LocationDefault","AZR-000220"]},{"location":"en/rules/Azure.Template.LocationType/","title":"Use type string for location parameters","text":"Azure.Template.LocationTypeAZR-000221Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_03  \u00b7  Important</p> <p>Location parameters should use a string value.</p>","tags":["Azure.Template.LocationType","AZR-000221"]},{"location":"en/rules/Azure.Template.LocationType/#description","title":"Description","text":"<p>The template parameter <code>location</code> is a standard parameter recommended for deployment templates. The <code>location</code> parameter is a intended for specifying the deployment location of the primary resource. When including location parameters in templates use the type <code>string</code>.</p> <p>Additionally, the template may include other resources. Use the <code>location</code> parameter value for resources that are likely to be in the same location. This approach minimizes the number of times users are asked to provide location information.</p>","tags":["Azure.Template.LocationType","AZR-000221"]},{"location":"en/rules/Azure.Template.LocationType/#recommendation","title":"Recommendation","text":"<p>Consider updating the <code>location</code> parameter to be of type <code>string</code>.</p>","tags":["Azure.Template.LocationType","AZR-000221"]},{"location":"en/rules/Azure.Template.LocationType/#examples","title":"Examples","text":"","tags":["Azure.Template.LocationType","AZR-000221"]},{"location":"en/rules/Azure.Template.LocationType/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To author templates that pass this rule:</p> <ul> <li>If the <code>location</code> parameter is specified, it should be set to a <code>string</code> type.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": {\n        \"location\": {\n            \"type\": \"string\",\n            \"defaultValue\": \"[resourceGroup().location]\",\n            \"metadata\": {\n                \"description\": \"The location resources will be deployed.\"\n            }\n        }\n    },\n    \"resources\": [\n        {\n            \"type\": \"Microsoft.Network/networkSecurityGroups\",\n            \"apiVersion\": \"2021-02-01\",\n            \"name\": \"nsg-001\",\n            \"location\": \"[parameters('location')]\",\n            \"properties\": {\n                \"securityRules\": [\n                    {\n                        \"name\": \"deny-hop-outbound\",\n                        \"properties\": {\n                            \"priority\": 200,\n                            \"access\": \"Deny\",\n                            \"protocol\": \"Tcp\",\n                            \"direction\": \"Outbound\",\n                            \"sourceAddressPrefix\": \"VirtualNetwork\",\n                            \"destinationAddressPrefix\": \"*\",\n                            \"destinationPortRanges\": [\n                                \"3389\",\n                                \"22\"\n                            ]\n                        }\n                    }\n                ]\n            }\n        }\n    ]\n}\n</code></pre>","tags":["Azure.Template.LocationType","AZR-000221"]},{"location":"en/rules/Azure.Template.LocationType/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To author bicep source files that pass this rule:</p> <ul> <li>If the <code>location</code> parameter is specified, it should be set to a <code>string</code> type.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>@description('The location resources will be deployed.')\nparam location string = resourceGroup().location\n</code></pre>","tags":["Azure.Template.LocationType","AZR-000221"]},{"location":"en/rules/Azure.Template.LocationType/#links","title":"Links","text":"<ul> <li>ARM template best practices</li> <li>Release deployment</li> </ul>","tags":["Azure.Template.LocationType","AZR-000221"]},{"location":"en/rules/Azure.Template.MetadataLink/","title":"Use parameter file metadata link","text":"Azure.Template.MetadataLinkAZR-000231Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_09  \u00b7  Important</p> <p>Configure a metadata link for each parameter file.</p>","tags":["Azure.Template.MetadataLink","AZR-000231"]},{"location":"en/rules/Azure.Template.MetadataLink/#description","title":"Description","text":"<p>A parameter file can include an additional metadata. This metadata provides additional context for use of the parameter file.</p> <p>PSRule for Azure uses the <code>metadata.template</code> property within parameter files to store a metadata link. A metadata link, is an explicit association between a parameter file it's intended template file.</p> <p>This rule is disabled by default but can be enabled by configuring <code>AZURE_PARAMETER_FILE_METADATA_LINK</code>. Enable this rule to ensure that each parameter file has a metadata link to a valid template file.</p>","tags":["Azure.Template.MetadataLink","AZR-000231"]},{"location":"en/rules/Azure.Template.MetadataLink/#recommendation","title":"Recommendation","text":"<p>Consider setting metadata for each parameter file linking to the deployment template.</p>","tags":["Azure.Template.MetadataLink","AZR-000231"]},{"location":"en/rules/Azure.Template.MetadataLink/#examples","title":"Examples","text":"","tags":["Azure.Template.MetadataLink","AZR-000231"]},{"location":"en/rules/Azure.Template.MetadataLink/#configure-parameter-file","title":"Configure parameter file","text":"<p>To create parameter files that pass this rule:</p> <ul> <li>Set the <code>metadata.template</code> property to a valid template file path.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"metadata\": {\n        \"template\": \"templates/storage/v1/template.json\"\n    },\n    \"parameters\": {\n        \"storageAccountName\": {\n            \"value\": \"...\"\n        }\n    }\n}\n</code></pre>","tags":["Azure.Template.MetadataLink","AZR-000231"]},{"location":"en/rules/Azure.Template.MetadataLink/#notes","title":"Notes","text":"<p>Enable this rule by setting the <code>AZURE_PARAMETER_FILE_METADATA_LINK</code> option to <code>true</code>.</p>","tags":["Azure.Template.MetadataLink","AZR-000231"]},{"location":"en/rules/Azure.Template.MetadataLink/#links","title":"Links","text":"<ul> <li>Using templates</li> </ul>","tags":["Azure.Template.MetadataLink","AZR-000231"]},{"location":"en/rules/Azure.Template.ParameterDataTypes/","title":"Default should match type","text":"Azure.Template.ParameterDataTypesAZR-000226Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_03  \u00b7  Important</p> <p>Set the parameter default value to a value of the same type.</p>","tags":["Azure.Template.ParameterDataTypes","AZR-000226"]},{"location":"en/rules/Azure.Template.ParameterDataTypes/#description","title":"Description","text":"<p>Azure Resource Manager (ARM) template support parameters with a range of types, including:</p> <ul> <li><code>bool</code></li> <li><code>int</code></li> <li><code>string</code></li> <li><code>array</code></li> <li><code>object</code></li> <li><code>secureString</code></li> <li><code>secureObject</code></li> </ul> <p>When including a <code>defaultValue</code>, the default value should match the same type at the <code>type</code> property. For example:</p> Azure Template snippet<pre><code>{\n  \"boolParam\": {\n    \"type\": \"bool\",\n    \"defaultValue\": false\n  },\n  \"intParam\": {\n    \"type\": \"int\",\n    \"defaultValue\": 5\n  },\n  \"stringParam\": {\n    \"type\": \"string\",\n    \"defaultValue\": \"test-rg\"\n  },\n  \"arrayParam\": {\n    \"type\": \"array\",\n    \"defaultValue\": [ 1, 2, 3 ]\n  },\n  \"objectParam\": {\n    \"type\": \"object\",\n    \"defaultValue\": {\n      \"one\": \"a\",\n      \"two\": \"b\"\n      }\n  }\n}\n</code></pre>","tags":["Azure.Template.ParameterDataTypes","AZR-000226"]},{"location":"en/rules/Azure.Template.ParameterDataTypes/#recommendation","title":"Recommendation","text":"<p>Consider updating the parameter default value to a value of the same type.</p>","tags":["Azure.Template.ParameterDataTypes","AZR-000226"]},{"location":"en/rules/Azure.Template.ParameterDataTypes/#links","title":"Links","text":"<ul> <li>Data types</li> <li>Release deployment</li> </ul>","tags":["Azure.Template.ParameterDataTypes","AZR-000226"]},{"location":"en/rules/Azure.Template.ParameterFile/","title":"Use ARM parameter file structure","text":"Azure.Template.ParameterFileAZR-000229Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Use ARM template parameter files that are valid.</p>","tags":["Azure.Template.ParameterFile","AZR-000229"]},{"location":"en/rules/Azure.Template.ParameterFile/#description","title":"Description","text":"<p>Azure Resource Manager (ARM) template parameter files have a pre-defined structure. ARM template parameter files require <code>$schema</code>, <code>contentVersion</code> and <code>parameters</code> sections to be defined. If any of these sections are missing, ARM will not accept the parameter file.</p>","tags":["Azure.Template.ParameterFile","AZR-000229"]},{"location":"en/rules/Azure.Template.ParameterFile/#recommendation","title":"Recommendation","text":"<p>Consider reviewing the requirements for this file. Also consider using Visual Studio Code to assist with authoring these files.</p>","tags":["Azure.Template.ParameterFile","AZR-000229"]},{"location":"en/rules/Azure.Template.ParameterFile/#links","title":"Links","text":"<ul> <li>Automate deployments with ARM Templates</li> <li>Test cases for parameter files</li> <li>Create Resource Manager parameter file</li> <li>Parameters in Azure Resource Manager templates</li> </ul>","tags":["Azure.Template.ParameterFile","AZR-000229"]},{"location":"en/rules/Azure.Template.ParameterMetadata/","title":"Use template parameter descriptions","text":"Azure.Template.ParameterMetadataAZR-000215Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2020_09  \u00b7  Awareness</p> <p>Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter.</p>","tags":["Azure.Template.ParameterMetadata","AZR-000215"]},{"location":"en/rules/Azure.Template.ParameterMetadata/#description","title":"Description","text":"<p>ARM templates supports an additional metadata description to be added to each parameter. The parameter description is visible in Azure when using portal deployment pages. Additionally, descriptions provide context for people editing template and parameter files.</p> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"storageAccountType\": {\n      \"type\": \"string\",\n      \"metadata\": {\n          \"description\": \"The type of the new storage account created to store the VM disks.\"\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.Template.ParameterMetadata","AZR-000215"]},{"location":"en/rules/Azure.Template.ParameterMetadata/#recommendation","title":"Recommendation","text":"<p>Consider defining a metadata description for each template parameter.</p>","tags":["Azure.Template.ParameterMetadata","AZR-000215"]},{"location":"en/rules/Azure.Template.ParameterMetadata/#links","title":"Links","text":"<ul> <li>Parameters</li> <li>ARM template best practices</li> <li>Release deployment</li> </ul>","tags":["Azure.Template.ParameterMetadata","AZR-000215"]},{"location":"en/rules/Azure.Template.ParameterMinMaxValue/","title":"Use minValue and maxValue with correct type","text":"Azure.Template.ParameterMinMaxValueAZR-000224Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_03  \u00b7  Important</p> <p>Template parameters <code>minValue</code> and <code>maxValue</code> constraints must be valid.</p>","tags":["Azure.Template.ParameterMinMaxValue","AZR-000224"]},{"location":"en/rules/Azure.Template.ParameterMinMaxValue/#description","title":"Description","text":"<p>When defining Azure template parameters the <code>minValue</code> or <code>maxValue</code> constraints can be added to parameters. These constraints are only valid for parameters using the <code>int</code> type. When configuring <code>minValue</code> and <code>maxValue</code> an integer must be used.</p>","tags":["Azure.Template.ParameterMinMaxValue","AZR-000224"]},{"location":"en/rules/Azure.Template.ParameterMinMaxValue/#recommendation","title":"Recommendation","text":"<p>Consider updating parameter definitions using <code>minValue</code> or <code>maxValue</code>. When using <code>minValue</code> or <code>maxValue</code> these values must be integers and only apply to <code>int</code> parameters.</p>","tags":["Azure.Template.ParameterMinMaxValue","AZR-000224"]},{"location":"en/rules/Azure.Template.ParameterMinMaxValue/#links","title":"Links","text":"<ul> <li>Parameters</li> <li>ARM template best practices</li> <li>Release deployment</li> </ul>","tags":["Azure.Template.ParameterMinMaxValue","AZR-000224"]},{"location":"en/rules/Azure.Template.ParameterScheme/","title":"Use a https template parameter file schema","text":"Azure.Template.ParameterSchemeAZR-000230Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_09  \u00b7  Awareness</p> <p>Use an Azure template parameter file schema with the https scheme.</p>","tags":["Azure.Template.ParameterScheme","AZR-000230"]},{"location":"en/rules/Azure.Template.ParameterScheme/#description","title":"Description","text":"<p>JSON schemas are used to validate the structure of Azure template parameter files. The JSON schema specification permits schemas to use https or http schemes. When using referencing schemas served by <code>schema.management.azure.com</code> the http scheme redirects to https.</p> <p>While <code>http://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#</code> points to a file. All supported Azure template parameter schemas use the https scheme.</p>","tags":["Azure.Template.ParameterScheme","AZR-000230"]},{"location":"en/rules/Azure.Template.ParameterScheme/#recommendation","title":"Recommendation","text":"<p>Consider using a schema with the https scheme.</p>","tags":["Azure.Template.ParameterScheme","AZR-000230"]},{"location":"en/rules/Azure.Template.ParameterScheme/#examples","title":"Examples","text":"","tags":["Azure.Template.ParameterScheme","AZR-000230"]},{"location":"en/rules/Azure.Template.ParameterScheme/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To define Azure template parameter files that pass this rule:</p> <ul> <li>Configure the template parameter schema to a supported schema with the <code>https://</code> URI prefix,   such as <code>https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": { }\n}\n</code></pre>","tags":["Azure.Template.ParameterScheme","AZR-000230"]},{"location":"en/rules/Azure.Template.ParameterScheme/#links","title":"Links","text":"<ul> <li>Automate deployments with ARM Templates</li> <li>Test cases for parameter files</li> <li>Create Resource Manager parameter file</li> </ul>","tags":["Azure.Template.ParameterScheme","AZR-000230"]},{"location":"en/rules/Azure.Template.ParameterStrongType/","title":"Parameter value should match strong type","text":"Azure.Template.ParameterStrongTypeAZR-000227Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_12  \u00b7  Awareness</p> <p>Set the parameter value to a value that matches the specified strong type.</p>","tags":["Azure.Template.ParameterStrongType","AZR-000227"]},{"location":"en/rules/Azure.Template.ParameterStrongType/#description","title":"Description","text":"<p>Template string parameters can optionally specify a strong type. When parameter files are expanded, if the parameter value does not match the type this rule fails. Support is provided by PSRule for Azure for the following types:</p> <ul> <li>Resource type - Specify a resource type.   For example <code>Microsoft.OperationalInsights/workspaces</code>.   If a resource type is specified the parameter value must be a resource id of that type.</li> <li>Location - Specify <code>location</code> as the strong type.   If <code>location</code> is specified, the parameter value must be a valid Azure location.</li> </ul>","tags":["Azure.Template.ParameterStrongType","AZR-000227"]},{"location":"en/rules/Azure.Template.ParameterStrongType/#recommendation","title":"Recommendation","text":"<p>Consider updating the parameter value to a value that matches the specifed strong type.</p>","tags":["Azure.Template.ParameterStrongType","AZR-000227"]},{"location":"en/rules/Azure.Template.ParameterStrongType/#links","title":"Links","text":"<ul> <li>Deployment considerations for DevOps</li> <li>Strong type</li> </ul>","tags":["Azure.Template.ParameterStrongType","AZR-000227"]},{"location":"en/rules/Azure.Template.ParameterValue/","title":"Specify a value for each parameter","text":"Azure.Template.ParameterValueAZR-000232Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_09  \u00b7  Awareness</p> <p>Specify a value for each parameter in template parameter files.</p>","tags":["Azure.Template.ParameterValue","AZR-000232"]},{"location":"en/rules/Azure.Template.ParameterValue/#description","title":"Description","text":"<p>When defining a template parameter file:</p> <ul> <li>Uou must specify a value for each parameter in the file.</li> <li>If the parameter is optional, you can omit the parameter from the file.</li> <li>If the parameter is required, you must specify a value for the parameter.</li> </ul>","tags":["Azure.Template.ParameterValue","AZR-000232"]},{"location":"en/rules/Azure.Template.ParameterValue/#recommendation","title":"Recommendation","text":"<p>Consider defining a value for each parameter in the template parameter file.</p>","tags":["Azure.Template.ParameterValue","AZR-000232"]},{"location":"en/rules/Azure.Template.ParameterValue/#examples","title":"Examples","text":"","tags":["Azure.Template.ParameterValue","AZR-000232"]},{"location":"en/rules/Azure.Template.ParameterValue/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To define Azure template parameter files that pass this rule:</p> <ul> <li>Set a value for each parameter specified in the file.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": {\n        \"parameter1\": {\n            \"value\": \"value1\"\n        },\n        \"parameter2\": {\n            \"value\": []\n        }\n    }\n}\n</code></pre>","tags":["Azure.Template.ParameterValue","AZR-000232"]},{"location":"en/rules/Azure.Template.ParameterValue/#links","title":"Links","text":"<ul> <li>Automate deployments with ARM Templates</li> <li>Test cases for parameter files</li> <li>Create Resource Manager parameter file</li> <li>Parameters in Azure Resource Manager templates</li> </ul>","tags":["Azure.Template.ParameterValue","AZR-000232"]},{"location":"en/rules/Azure.Template.ResourceLocation/","title":"Use a location parameter for regional resources","text":"Azure.Template.ResourceLocationAZR-000222Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_03  \u00b7  Awareness</p> <p>Resource locations should be an expression or <code>global</code>.</p>","tags":["Azure.Template.ResourceLocation","AZR-000222"]},{"location":"en/rules/Azure.Template.ResourceLocation/#description","title":"Description","text":"<p>The <code>location</code> property is a required property for most Azure resources. For non-regional resources such as Front Door and DNS Zones specify a literal location <code>global</code> instead.</p> <p>The resource <code>location</code> determines where the resource configuration is stored and managed from. Commonly this will also indicate which region your data is stored in.</p> <p>When defining resources in Bicep or ARM templates, avoid hardcoding the location value, even when you know the location. The location value should be a parameter what can be easily set or overridden when deploying the template. This makes the template more flexible and reusable across different environments as requirements change.</p> <p>Reusable templates and modules may include different resources that are deployed to different locations. Define a <code>location</code> parameter value for resources that are likely to be in the same location. This approach minimizes the number of times users are asked to provide location information. For resources that aren't available in all locations, use a separate parameter.</p> <p>Use Azure Policy to enforce the location of resources in your environment at runtime.</p>","tags":["Azure.Template.ResourceLocation","AZR-000222"]},{"location":"en/rules/Azure.Template.ResourceLocation/#recommendation","title":"Recommendation","text":"<p>Consider updating the resource <code>location</code> property to use a parameter to make templates and modules more flexible and reusable.</p>","tags":["Azure.Template.ResourceLocation","AZR-000222"]},{"location":"en/rules/Azure.Template.ResourceLocation/#examples","title":"Examples","text":"","tags":["Azure.Template.ResourceLocation","AZR-000222"]},{"location":"en/rules/Azure.Template.ResourceLocation/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy resources that pass this rule:</p> <ul> <li>Set the <code>location</code> property to a parameter or <code>global</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Storage/storageAccounts\",\n  \"apiVersion\": \"2023-01-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_GRS\"\n  },\n  \"kind\": \"StorageV2\",\n  \"properties\": {\n    \"allowBlobPublicAccess\": false,\n    \"supportsHttpsTrafficOnly\": true,\n    \"minimumTlsVersion\": \"TLS1_2\",\n    \"accessTier\": \"Hot\",\n    \"allowSharedKeyAccess\": false,\n    \"networkAcls\": {\n      \"defaultAction\": \"Deny\"\n    }\n  }\n}\n</code></pre> <p>To define a location parameter:</p> <ul> <li>Under the <code>parameters</code> template property define a <code>string</code> sub-property.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"parameters\": {\n    \"location\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"[resourceGroup().location]\",\n      \"metadata\": {\n        \"description\": \"The location resources will be deployed.\"\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.Template.ResourceLocation","AZR-000222"]},{"location":"en/rules/Azure.Template.ResourceLocation/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy resources that pass this rule:</p> <ul> <li>Set the <code>location</code> property to a parameter or <code>global</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard_GRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    allowBlobPublicAccess: false\n    supportsHttpsTrafficOnly: true\n    minimumTlsVersion: 'TLS1_2'\n    accessTier: 'Hot'\n    allowSharedKeyAccess: false\n    networkAcls: {\n      defaultAction: 'Deny'\n    }\n  }\n}\n</code></pre> <p>To define a location parameter:</p> <ul> <li>Use the <code>param</code> keyword.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>@description('The location resources will be deployed.')\nparam location string = resourceGroup().location\n</code></pre>","tags":["Azure.Template.ResourceLocation","AZR-000222"]},{"location":"en/rules/Azure.Template.ResourceLocation/#notes","title":"Notes","text":"<p>By default, the Bicep linter rule <code>no-hardcoded-location</code> will raise a warning if a resource location is hardcoded.</p>","tags":["Azure.Template.ResourceLocation","AZR-000222"]},{"location":"en/rules/Azure.Template.ResourceLocation/#links","title":"Links","text":"<ul> <li>OE:05 Infrastructure as code</li> <li>Bicep parameters</li> <li>Linter rule - no hardcoded locations</li> <li>ARM template best practices</li> <li>ARM parameters</li> </ul>","tags":["Azure.Template.ResourceLocation","AZR-000222"]},{"location":"en/rules/Azure.Template.Resources/","title":"Include a template resource","text":"Azure.Template.ResourcesAZR-000216Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2020_09  \u00b7  Awareness</p> <p>Each Azure Resource Manager (ARM) template file should deploy at least one resource.</p>","tags":["Azure.Template.Resources","AZR-000216"]},{"location":"en/rules/Azure.Template.Resources/#description","title":"Description","text":"<p>An ARM template file is used to create or update one or more Azure resources. The <code>resources</code> property of an ARM template includes a definition of the resources to deploy.</p>","tags":["Azure.Template.Resources","AZR-000216"]},{"location":"en/rules/Azure.Template.Resources/#recommendation","title":"Recommendation","text":"<p>Consider removing Azure template files that do not deploy any resources.</p>","tags":["Azure.Template.Resources","AZR-000216"]},{"location":"en/rules/Azure.Template.Resources/#links","title":"Links","text":"<ul> <li>Resources</li> <li>Tutorial: Create and deploy your first ARM template</li> <li>Release deployment</li> </ul>","tags":["Azure.Template.Resources","AZR-000216"]},{"location":"en/rules/Azure.Template.TemplateFile/","title":"Use ARM template file structure","text":"Azure.Template.TemplateFileAZR-000212Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Use ARM template files that are valid.</p>","tags":["Azure.Template.TemplateFile","AZR-000212"]},{"location":"en/rules/Azure.Template.TemplateFile/#description","title":"Description","text":"<p>Azure Resource Manager (ARM) template files have a pre-defined structure. ARM templates require <code>$schema</code>, <code>contentVersion</code> and <code>resources</code> sections to be defined. If any of these sections are missing, ARM will not accept the template.</p>","tags":["Azure.Template.TemplateFile","AZR-000212"]},{"location":"en/rules/Azure.Template.TemplateFile/#recommendation","title":"Recommendation","text":"<p>Consider reviewing the requirements for this file. Also consider using Visual Studio Code to assist with authoring these files.</p>","tags":["Azure.Template.TemplateFile","AZR-000212"]},{"location":"en/rules/Azure.Template.TemplateFile/#examples","title":"Examples","text":"","tags":["Azure.Template.TemplateFile","AZR-000212"]},{"location":"en/rules/Azure.Template.TemplateFile/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To define Azure template files that pass this rule:</p> <ul> <li>Always specify the required properties <code>$schema</code>, <code>contentVersion</code> and <code>resources</code> properties.</li> <li>Optional specify <code>languageVersion</code>, <code>definitions</code>, <code>metadata</code>, <code>parameters</code>, <code>functions</code>, <code>variables</code>, and <code>outputs</code> properties.</li> <li>Avoid specifying any other properties.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": { },\n  \"variables\":  { },\n  \"resources\": [ ]\n}\n</code></pre>","tags":["Azure.Template.TemplateFile","AZR-000212"]},{"location":"en/rules/Azure.Template.TemplateFile/#notes","title":"Notes","text":"<p>This rule is not applicable to Azure Bicep files as they have a different structure. If you are running analysis over pre-built Bicep files and they generate a rule failure, please raise an issue.</p>","tags":["Azure.Template.TemplateFile","AZR-000212"]},{"location":"en/rules/Azure.Template.TemplateFile/#links","title":"Links","text":"<ul> <li>OE:05 Infrastructure as code</li> <li>Template file structure</li> <li>Define resources in Azure Resource Manager templates</li> </ul>","tags":["Azure.Template.TemplateFile","AZR-000212"]},{"location":"en/rules/Azure.Template.TemplateSchema/","title":"Use a recent template schema version","text":"Azure.Template.TemplateSchemaAZR-000213Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_09  \u00b7  Awareness</p> <p>Use a more recent version of the Azure template schema.</p>","tags":["Azure.Template.TemplateSchema","AZR-000213"]},{"location":"en/rules/Azure.Template.TemplateSchema/#description","title":"Description","text":"<p>The JSON schemas used to define Azure templates are versioned. When defining templates use templates with a supported schema.</p> <p>The following template schemas are deprecated:</p> <ul> <li><code>https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#</code></li> </ul>","tags":["Azure.Template.TemplateSchema","AZR-000213"]},{"location":"en/rules/Azure.Template.TemplateSchema/#recommendation","title":"Recommendation","text":"<p>Consider using a more recent schema version for Azure template files.</p>","tags":["Azure.Template.TemplateSchema","AZR-000213"]},{"location":"en/rules/Azure.Template.TemplateSchema/#examples","title":"Examples","text":"","tags":["Azure.Template.TemplateSchema","AZR-000213"]},{"location":"en/rules/Azure.Template.TemplateSchema/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To define Azure template files that pass this rule:</p> <ul> <li>Configure the template schema to one of the following:<ul> <li><code>https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#</code></li> <li><code>https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#</code></li> <li><code>https://schema.management.azure.com/schemas/2019-08-01/tenantDeploymentTemplate.json#</code></li> <li><code>https://schema.management.azure.com/schemas/2019-08-01/managementGroupDeploymentTemplate.json#</code></li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": { },\n    \"functions\": [],\n    \"resources\": [ ]\n}\n</code></pre>","tags":["Azure.Template.TemplateSchema","AZR-000213"]},{"location":"en/rules/Azure.Template.TemplateSchema/#links","title":"Links","text":"<ul> <li>Automate deployments with ARM Templates</li> <li>Test cases for ARM templates</li> <li>Template file structure</li> </ul>","tags":["Azure.Template.TemplateSchema","AZR-000213"]},{"location":"en/rules/Azure.Template.TemplateScheme/","title":"Use a https template file schema","text":"Azure.Template.TemplateSchemeAZR-000214Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_09  \u00b7  Awareness</p> <p>Use an Azure template file schema with the https scheme.</p>","tags":["Azure.Template.TemplateScheme","AZR-000214"]},{"location":"en/rules/Azure.Template.TemplateScheme/#description","title":"Description","text":"<p>JSON schemas are used to validate the structure of Azure template files. The JSON schema specification permits schemas to use https or http schemes. When using referencing schemas served by <code>schema.management.azure.com</code> the http scheme redirects to https.</p> <p>While <code>http://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#</code> points to a file. All supported Azure template schemas use the https scheme.</p>","tags":["Azure.Template.TemplateScheme","AZR-000214"]},{"location":"en/rules/Azure.Template.TemplateScheme/#recommendation","title":"Recommendation","text":"<p>Consider using a schema with the https scheme.</p>","tags":["Azure.Template.TemplateScheme","AZR-000214"]},{"location":"en/rules/Azure.Template.TemplateScheme/#examples","title":"Examples","text":"","tags":["Azure.Template.TemplateScheme","AZR-000214"]},{"location":"en/rules/Azure.Template.TemplateScheme/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To define Azure template files that pass this rule:</p> <ul> <li>Configure the template schema to a supported schema with the <code>https://</code> URI prefix,   such as <code>https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": { },\n    \"functions\": [],\n    \"resources\": [ ]\n}\n</code></pre>","tags":["Azure.Template.TemplateScheme","AZR-000214"]},{"location":"en/rules/Azure.Template.TemplateScheme/#links","title":"Links","text":"<ul> <li>Automate deployments with ARM Templates</li> <li>Test cases for ARM templates</li> <li>Template file structure</li> </ul>","tags":["Azure.Template.TemplateScheme","AZR-000214"]},{"location":"en/rules/Azure.Template.UseComments/","title":"Use comments for each ARM template resource","text":"Azure.Template.UseCommentsAZR-000234Information <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_12  \u00b7  Awareness</p> <p>Use comments for each resource in ARM template to communicate purpose.</p>","tags":["Azure.Template.UseComments","AZR-000234"]},{"location":"en/rules/Azure.Template.UseComments/#description","title":"Description","text":"<p>ARM templates can optionally include comments in resources. This helps other contributors understand the purpose of the resource.</p>","tags":["Azure.Template.UseComments","AZR-000234"]},{"location":"en/rules/Azure.Template.UseComments/#recommendation","title":"Recommendation","text":"<p>Specify comments for each resource in the template.</p>","tags":["Azure.Template.UseComments","AZR-000234"]},{"location":"en/rules/Azure.Template.UseComments/#examples","title":"Examples","text":"","tags":["Azure.Template.UseComments","AZR-000234"]},{"location":"en/rules/Azure.Template.UseComments/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To define Azure template files that pass this rule:</p> <ul> <li>Specify <code>comments</code> for each resource in the template.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>\"resources\": [\n  {\n    \"name\": \"[variables('storageAccountName')]\",\n    \"type\": \"Microsoft.Storage/storageAccounts\",\n    \"apiVersion\": \"2019-06-01\",\n    \"location\": \"[resourceGroup().location]\",\n    \"comments\": \"This storage account is used to store the VM disks.\",\n      ...\n  }\n]\n</code></pre>","tags":["Azure.Template.UseComments","AZR-000234"]},{"location":"en/rules/Azure.Template.UseComments/#links","title":"Links","text":"<ul> <li>Better understand your cloud resources</li> <li>ARM template best practices</li> </ul>","tags":["Azure.Template.UseComments","AZR-000234"]},{"location":"en/rules/Azure.Template.UseDescriptions/","title":"Use comments for each generated template resource","text":"Azure.Template.UseDescriptionsAZR-000235Information <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_12  \u00b7  Awareness</p> <p>Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose.</p>","tags":["Azure.Template.UseDescriptions","AZR-000235"]},{"location":"en/rules/Azure.Template.UseDescriptions/#description","title":"Description","text":"<p>Generated templates can optionally include descriptions in resources. This helps other contributors understand the purpose of the resource.</p>","tags":["Azure.Template.UseDescriptions","AZR-000235"]},{"location":"en/rules/Azure.Template.UseDescriptions/#recommendation","title":"Recommendation","text":"<p>Specify descriptions for each resource in the template.</p>","tags":["Azure.Template.UseDescriptions","AZR-000235"]},{"location":"en/rules/Azure.Template.UseDescriptions/#examples","title":"Examples","text":"","tags":["Azure.Template.UseDescriptions","AZR-000235"]},{"location":"en/rules/Azure.Template.UseDescriptions/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To define Bicep template files that pass this rule:</p> <ul> <li>Specify the <code>@description()</code> or <code>@sys.description()</code> decorator for each resource in the template.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>// An example container registry\n@description('abc')\nresource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = {\n  name: registryName\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    adminUserEnabled: false\n    policies: {\n      quarantinePolicy: {\n        status: 'enabled'\n      }\n      trustPolicy: {\n        status: 'enabled'\n        type: 'Notary'\n      }\n      retentionPolicy: {\n        status: 'enabled'\n        days: 30\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.Template.UseDescriptions","AZR-000235"]},{"location":"en/rules/Azure.Template.UseDescriptions/#links","title":"Links","text":"<ul> <li>Better understand your cloud resources</li> <li>Decorators</li> </ul>","tags":["Azure.Template.UseDescriptions","AZR-000235"]},{"location":"en/rules/Azure.Template.UseLocationParameter/","title":"Use a location parameter to specify resource location","text":"Azure.Template.UseLocationParameterAZR-000223Warning <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_03  \u00b7  Awareness</p> <p>Template should reference a location parameter to specify resource location.</p>","tags":["Azure.Template.UseLocationParameter","AZR-000223"]},{"location":"en/rules/Azure.Template.UseLocationParameter/#description","title":"Description","text":"<p>The template parameter <code>location</code> is a standard parameter recommended for deployment templates. The <code>location</code> parameter is a intended for specifying the deployment location of the primary resource.</p> <p>When defining a resource that requires a location, use the <code>location</code> parameter. For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Network/virtualNetworks\",\n    \"name\": \"[parameters('VNETName')]\",\n    \"apiVersion\": \"2020-06-01\",\n    \"location\": \"[parameters('location')]\",\n    \"properties\": {}\n}\n</code></pre> <p>Additionally, the template may include other resources. Use the <code>location</code> parameter value for resources that are likely to be in the same location. This approach minimizes the number of times users are asked to provide location information. For resources that aren't available in all locations, use a separate parameter.</p>","tags":["Azure.Template.UseLocationParameter","AZR-000223"]},{"location":"en/rules/Azure.Template.UseLocationParameter/#recommendation","title":"Recommendation","text":"<p>Consider using <code>parameters('location)</code> instead of <code>resourceGroup().location</code>. Using a location parameter enabled users of the template to specify the location of deployed resources.</p>","tags":["Azure.Template.UseLocationParameter","AZR-000223"]},{"location":"en/rules/Azure.Template.UseLocationParameter/#examples","title":"Examples","text":"","tags":["Azure.Template.UseLocationParameter","AZR-000223"]},{"location":"en/rules/Azure.Template.UseLocationParameter/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To author templates that pass this rule:</p> <ul> <li>Define a parameter named <code>location</code>.</li> <li>Set the location of any deployed resources to <code>[parameters('location')]</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"metadata\": {\n        \"name\": \"Managed Identity\",\n        \"description\": \"Create or update a Managed Identity.\"\n    },\n    \"parameters\": {\n        \"identityName\": {\n            \"type\": \"string\",\n            \"metadata\": {\n                \"description\": \"The name of the Managed Identity.\"\n            }\n        },\n        \"location\": {\n            \"type\": \"string\",\n            \"defaultValue\": \"[resourceGroup().location]\",\n            \"metadata\": {\n                \"description\": \"The Azure region to deploy to.\",\n                \"example\": \"eastus\"\n            }\n        },\n        \"tags\": {\n            \"type\": \"object\",\n            \"metadata\": {\n                \"description\": \"Tags to apply to the resource.\",\n                \"example\": {\n                    \"service\": \"app1\",\n                    \"env\": \"prod\"\n                }\n            }\n        }\n    },\n    \"variables\": {\n        \"tenantId\": \"[subscription().tenantId]\"\n    },\n    \"resources\": [\n        {\n            \"comments\": \"Create or update a Managed Identity\",\n            \"type\": \"Microsoft.ManagedIdentity/userAssignedIdentities\",\n            \"apiVersion\": \"2018-11-30\",\n            \"name\": \"[parameters('identityName')]\",\n            \"location\": \"[parameters('location')]\",\n            \"properties\": {\n                \"tenantId\": \"[variables('tenantId')]\"\n            },\n            \"tags\": \"[parameters('tags')]\"\n        }\n    ]\n}\n</code></pre>","tags":["Azure.Template.UseLocationParameter","AZR-000223"]},{"location":"en/rules/Azure.Template.UseLocationParameter/#notes","title":"Notes","text":"<p>This rule is not applicable and ignored for templates generated with Bicep, PSArm, and AzOps. Generated templates from these tools may not require any parameters to be set.</p>","tags":["Azure.Template.UseLocationParameter","AZR-000223"]},{"location":"en/rules/Azure.Template.UseLocationParameter/#links","title":"Links","text":"<ul> <li>ARM template best practices</li> <li>Parameters</li> <li>Release deployment</li> </ul>","tags":["Azure.Template.UseLocationParameter","AZR-000223"]},{"location":"en/rules/Azure.Template.UseParameters/","title":"Remove unused template parameters","text":"Azure.Template.UseParametersAZR-000217Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2020_09  \u00b7  Awareness</p> <p>Each Azure Resource Manager (ARM) template parameter should be used or removed from template files.</p>","tags":["Azure.Template.UseParameters","AZR-000217"]},{"location":"en/rules/Azure.Template.UseParameters/#description","title":"Description","text":"<p>ARM templates can optionally define parameters that can be reused throughout the template. Parameters that are not used may make template use more complex for no benefit.</p>","tags":["Azure.Template.UseParameters","AZR-000217"]},{"location":"en/rules/Azure.Template.UseParameters/#recommendation","title":"Recommendation","text":"<p>Consider removing unused parameters from Azure template files.</p>","tags":["Azure.Template.UseParameters","AZR-000217"]},{"location":"en/rules/Azure.Template.UseParameters/#notes","title":"Notes","text":"<p>This rule is deprecated from v1.36.0. By default, PSRule will not evaluate this rule unless explicitly enabled. See https://aka.ms/ps-rule-azure/deprecations.</p>","tags":["Azure.Template.UseParameters","AZR-000217"]},{"location":"en/rules/Azure.Template.UseParameters/#links","title":"Links","text":"<ul> <li>Release deployment</li> <li>Parameters</li> <li>ARM template best practices</li> </ul>","tags":["Azure.Template.UseParameters","AZR-000217"]},{"location":"en/rules/Azure.Template.UseVariables/","title":"Remove unused template variables","text":"Azure.Template.UseVariablesAZR-000219Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2020_09  \u00b7  Awareness</p> <p>Each Azure Resource Manager (ARM) template variable should be used or removed from template files.</p>","tags":["Azure.Template.UseVariables","AZR-000219"]},{"location":"en/rules/Azure.Template.UseVariables/#description","title":"Description","text":"<p>ARM templates can optionally define variables that can be reused throughout the template. Variables that are not used may add template complexity for no benefit.</p>","tags":["Azure.Template.UseVariables","AZR-000219"]},{"location":"en/rules/Azure.Template.UseVariables/#recommendation","title":"Recommendation","text":"<p>Consider removing unused variables from Azure template files.</p>","tags":["Azure.Template.UseVariables","AZR-000219"]},{"location":"en/rules/Azure.Template.UseVariables/#notes","title":"Notes","text":"<p>This rule is deprecated from v1.36.0. By default, PSRule will not evaluate this rule unless explicitly enabled. See https://aka.ms/ps-rule-azure/deprecations.</p>","tags":["Azure.Template.UseVariables","AZR-000219"]},{"location":"en/rules/Azure.Template.UseVariables/#links","title":"Links","text":"<ul> <li>Release deployment</li> <li>Variables</li> <li>ARM template best practices</li> </ul>","tags":["Azure.Template.UseVariables","AZR-000219"]},{"location":"en/rules/Azure.Template.ValidSecretRef/","title":"Use a valid secret reference","text":"Azure.Template.ValidSecretRefAZR-000233Error <p> Operational Excellence  \u00b7  All resources  \u00b7  Rule  \u00b7  2021_09  \u00b7  Awareness</p> <p>Use a valid secret reference within parameter files.</p>","tags":["Azure.Template.ValidSecretRef","AZR-000233"]},{"location":"en/rules/Azure.Template.ValidSecretRef/#description","title":"Description","text":"<p>When referencing secrets in a template parameter file:</p> <ul> <li>The secret reference must be a valid Azure resource ID Key Vault.</li> <li>A secret name must be specified.</li> <li>An optional secret version can be specified.</li> </ul>","tags":["Azure.Template.ValidSecretRef","AZR-000233"]},{"location":"en/rules/Azure.Template.ValidSecretRef/#recommendation","title":"Recommendation","text":"<p>Check the secret value Key Vault reference is valid.</p>","tags":["Azure.Template.ValidSecretRef","AZR-000233"]},{"location":"en/rules/Azure.Template.ValidSecretRef/#examples","title":"Examples","text":"","tags":["Azure.Template.ValidSecretRef","AZR-000233"]},{"location":"en/rules/Azure.Template.ValidSecretRef/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To define Azure template parameter files that pass this rule:</p> <ul> <li>When a secret is referenced from Key Vault, provide a valid resource ID and secret name.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"gatewayName\": {\n      \"value\": \"gateway-A\"\n    },\n    \"sku\": {\n      \"value\": \"VpnGw1\"\n    },\n    \"subnetId\": {\n      \"value\": \"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/vnet-A/subnets/GatewaySubnet\"\n    },\n    \"sharedKey\": {\n      \"reference\": {\n        \"keyVault\": {\n          \"id\": \"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.KeyVault/vaults/kv-001\"\n        },\n        \"secretName\": \"valid-secret\"\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.Template.ValidSecretRef","AZR-000233"]},{"location":"en/rules/Azure.Template.ValidSecretRef/#notes","title":"Notes","text":"<p>This rule is deprecated from v1.36.0. By default, PSRule will not evaluate this rule unless explicitly enabled. See https://aka.ms/ps-rule-azure/deprecations.</p>","tags":["Azure.Template.ValidSecretRef","AZR-000233"]},{"location":"en/rules/Azure.Template.ValidSecretRef/#links","title":"Links","text":"<ul> <li>OE:05 Infrastructure as code</li> <li>Reference secrets with static ID</li> <li>Create Resource Manager parameter file</li> </ul>","tags":["Azure.Template.ValidSecretRef","AZR-000233"]},{"location":"en/rules/Azure.TrafficManager.Endpoints/","title":"Use at least two Traffic Manager endpoints","text":"Azure.TrafficManager.EndpointsAZR-000236Error <p> Reliability  \u00b7  Traffic Manager  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Traffic Manager should use at lest two enabled endpoints.</p>","tags":["Azure.TrafficManager.Endpoints","AZR-000236"]},{"location":"en/rules/Azure.TrafficManager.Endpoints/#description","title":"Description","text":"<p>Traffic Manager is a DNS service that enables you to distribute traffic to improve availability and responsiveness. Traffic is distributed across endpoints, which can be located in different availability zones and regions.</p> <p>When only one enabled endpoint exists, routing for high availability and/ or responsiveness is not possible.</p>","tags":["Azure.TrafficManager.Endpoints","AZR-000236"]},{"location":"en/rules/Azure.TrafficManager.Endpoints/#recommendation","title":"Recommendation","text":"<p>Consider adding additional endpoints or enabling disabled endpoints. Also consider, using endpoints deployed across different regions to provide high availability.</p>","tags":["Azure.TrafficManager.Endpoints","AZR-000236"]},{"location":"en/rules/Azure.TrafficManager.Endpoints/#links","title":"Links","text":"<ul> <li>RE:05 Redundancy</li> <li>What is Traffic Manager?</li> <li>How Traffic Manager Works</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.TrafficManager.Endpoints","AZR-000236"]},{"location":"en/rules/Azure.TrafficManager.Protocol/","title":"Use HTTPS to monitor web-based endpoints","text":"Azure.TrafficManager.ProtocolAZR-000237Error <p> Security  \u00b7  Traffic Manager  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Monitor Traffic Manager web-based endpoints with HTTPS.</p>","tags":["Azure.TrafficManager.Protocol","AZR-000237"]},{"location":"en/rules/Azure.TrafficManager.Protocol/#description","title":"Description","text":"<p>Traffic Manager can use TCP, HTTP or HTTPS to monitor endpoint health. For web-based endpoints use HTTPS.</p> <p>If TCP is used, Traffic Manager only checks that it can open a TCP port on the endpoint. This alone does not indicate that the endpoint is operational and ready to receive requests. Additionally when using HTTP and HTTPS, Traffic Manager check HTTP response codes.</p> <p>If HTTP is used, Traffic Manager will send unencrypted health checks to the endpoint. HTTPS-based health checks additionally check if a certificate is present, but do not validate if the certificate is valid.</p>","tags":["Azure.TrafficManager.Protocol","AZR-000237"]},{"location":"en/rules/Azure.TrafficManager.Protocol/#recommendation","title":"Recommendation","text":"<p>Consider using HTTPS to monitor web-based endpoint health. HTTPS-based monitoring improves security and increases accuracy of health probes.</p>","tags":["Azure.TrafficManager.Protocol","AZR-000237"]},{"location":"en/rules/Azure.TrafficManager.Protocol/#examples","title":"Examples","text":"","tags":["Azure.TrafficManager.Protocol","AZR-000237"]},{"location":"en/rules/Azure.TrafficManager.Protocol/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Traffic Manager profiles that pass this rule:</p> <ul> <li>Set the <code>properties.monitorConfig.protocol</code> property to <code>HTTPS</code> for HTTP-based endpoints.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/trafficmanagerprofiles\",\n  \"apiVersion\": \"2022-04-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"global\",\n  \"properties\": {\n    \"endpoints\": \"[parameters('endpoints')]\",\n    \"trafficRoutingMethod\": \"Performance\",\n    \"monitorConfig\": {\n      \"protocol\": \"HTTPS\",\n      \"port\": 443,\n      \"intervalInSeconds\": 30,\n      \"timeoutInSeconds\": 5,\n      \"toleratedNumberOfFailures\": 3,\n      \"path\": \"/healthz\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.TrafficManager.Protocol","AZR-000237"]},{"location":"en/rules/Azure.TrafficManager.Protocol/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Traffic Manager profiles that pass this rule:</p> <ul> <li>Set the <code>properties.monitorConfig.protocol</code> property to <code>HTTPS</code> for HTTP-based endpoints.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource profile 'Microsoft.Network/trafficmanagerprofiles@2022-04-01' = {\n  name: name\n  location: 'global'\n  properties: {\n    endpoints: endpoints\n    trafficRoutingMethod: 'Performance'\n    monitorConfig: {\n      protocol: 'HTTPS'\n      port: 443\n      intervalInSeconds: 30\n      timeoutInSeconds: 5\n      toleratedNumberOfFailures: 3\n      path: '/healthz'\n    }\n  }\n}\n</code></pre>","tags":["Azure.TrafficManager.Protocol","AZR-000237"]},{"location":"en/rules/Azure.TrafficManager.Protocol/#links","title":"Links","text":"<ul> <li>SE:07 Encryption</li> <li>Traffic Manager endpoint monitoring</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.TrafficManager.Protocol","AZR-000237"]},{"location":"en/rules/Azure.VM.ADE/","title":"Use Azure Disk Encryption","text":"Azure.VM.ADEAZR-000252Error <p> Security  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Use Azure Disk Encryption (ADE).</p>","tags":["Azure.VM.ADE","AZR-000252"]},{"location":"en/rules/Azure.VM.ADE/#description","title":"Description","text":"<p>Virtual machines (VMs) can be encrypted using ADE to protect disks with full disk encryption. Storage Service Encryption (SSE) is encryption as rest for Managed Disks and Storage Accounts. SSE automatically decrypts storage as it is read. Full disk encryption varies from SSE by decrypting disks on read within the operating system.</p> <p>ADE protects disk decryption keys within Key Vault.</p>","tags":["Azure.VM.ADE","AZR-000252"]},{"location":"en/rules/Azure.VM.ADE/#recommendation","title":"Recommendation","text":"<p>Consider using Azure Disk Encryption (ADE) to protect VM disks from being downloaded and accessed offline.</p>","tags":["Azure.VM.ADE","AZR-000252"]},{"location":"en/rules/Azure.VM.ADE/#links","title":"Links","text":"<ul> <li>Data encryption in Azure</li> <li>Creating and configuring a key vault for Azure Disk Encryption</li> <li>Azure Disk Encryption scenarios on Windows VMs</li> </ul>","tags":["Azure.VM.ADE","AZR-000252"]},{"location":"en/rules/Azure.VM.AMA/","title":"Use Azure Monitor Agent","text":"Azure.VM.AMAAZR-000345Error <p> Operational Excellence  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Use Azure Monitor Agent for collecting monitoring data from VMs.</p>","tags":["Azure.VM.AMA","AZR-000345"]},{"location":"en/rules/Azure.VM.AMA/#description","title":"Description","text":"<p>Azure Monitor is the platform capability for monitoring and observability in Azure. Azure Monitor collects monitoring telemetry from a variety of on-premises, multi-cloud, and Azure sources.</p> <p>To monitor Windows and Linux operating systems the Azure Monitor Agent (AMA) is deployed. Once the AMA the agent is deployed, collected data gets delivered to Azure Monitor, where is can be used for:</p> <ul> <li>Monitoring visualizations.</li> <li>Triggering alerts.</li> <li>Analysis using workbooks and queries.</li> <li>Integration with other Azure services.</li> <li>Integration with third-party services.</li> </ul> <p>For Azure virtual machines (VMs), virtual machine scale sets (VMSS), and Azure Arc enabled servers the monitoring agent is deployed as an extension. The extension also supports modern management capabilities such as Azure Policy, automatic updates, and deployment as Infrastructure as Code.</p> <p>The AMA replaces Azure Monitor's legacy monitoring agents.</p>","tags":["Azure.VM.AMA","AZR-000345"]},{"location":"en/rules/Azure.VM.AMA/#recommendation","title":"Recommendation","text":"<p>Consider monitoring virtual machines (VMs) with the Azure Monitor Agent.</p>","tags":["Azure.VM.AMA","AZR-000345"]},{"location":"en/rules/Azure.VM.AMA/#examples","title":"Examples","text":"","tags":["Azure.VM.AMA","AZR-000345"]},{"location":"en/rules/Azure.VM.AMA/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy virtual machines that pass this rule:</p> <ul> <li>Deploy a extension sub-resource <code>Microsoft.Compute/virtualMachines/extensions</code>.<ul> <li>Set <code>properties.publisher</code> to <code>Microsoft.Azure.Monitor</code>.</li> <li>Set <code>properties.type</code> to <code>AzureMonitorWindowsAgent</code> (Windows) or <code>AzureMonitorLinuxAgent</code> (Linux).</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\n  \"apiVersion\": \"2023-09-01\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), 'AzureMonitorWindowsAgent')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"publisher\": \"Microsoft.Azure.Monitor\",\n    \"type\": \"AzureMonitorWindowsAgent\",\n    \"typeHandlerVersion\": \"1.0\",\n    \"autoUpgradeMinorVersion\": true,\n    \"enableAutomaticUpgrade\": true,\n    \"settings\": {\n      \"authentication\": {\n        \"managedIdentity\": {\n          \"identifier-name\": \"mi_res_id\",\n          \"identifier-value\": \"[parameters('amaIdentityId')]\"\n        }\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Compute/virtualMachines', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.VM.AMA","AZR-000345"]},{"location":"en/rules/Azure.VM.AMA/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy virtual machines that pass this rule:</p> <ul> <li>Deploy a extension sub-resource <code>Microsoft.Compute/virtualMachines/extensions</code>.<ul> <li>Set <code>properties.publisher</code> to <code>Microsoft.Azure.Monitor</code>.</li> <li>Set <code>properties.type</code> to <code>AzureMonitorWindowsAgent</code> (Windows) or <code>AzureMonitorLinuxAgent</code> (Linux).</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource windowsAgent 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = {\n  parent: vm\n  name: 'AzureMonitorWindowsAgent'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.Monitor'\n    type: 'AzureMonitorWindowsAgent'\n    typeHandlerVersion: '1.0'\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n    settings: {\n      authentication: {\n        managedIdentity: {\n          'identifier-name': 'mi_res_id'\n          'identifier-value': amaIdentityId\n        }\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.VM.AMA","AZR-000345"]},{"location":"en/rules/Azure.VM.AMA/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"<p>To configure virtual machine using a user-assigned identity:</p> <ul> <li>Deploy a extension sub-resource <code>Microsoft.Compute/virtualMachines/extensions</code>.<ul> <li>Set the <code>--name</code> parameter to <code>AzureMonitorWindowsAgent</code> (Windows) or <code>AzureMonitorLinuxAgent</code> (Linux).</li> <li>Fill in the remaining parameters.   For more information see Azure Monitor Agent overview.</li> </ul> </li> </ul> <p>For example:</p> Azure CLI snippet<pre><code>az vm extension set --name 'AzureMonitorWindowsAgent' --publisher Microsoft.Azure.Monitor --ids '&lt;vm-resource-id&gt;' --enable-auto-upgrade true --settings '{\"authentication\":{\"managedIdentity\":{\"identifier-name\":\"mi_res_id\",\"identifier-value\":\"/subscriptions/&lt;my-subscription-id&gt;/resourceGroups/&lt;my-resource-group&gt;/providers/Microsoft.ManagedIdentity/userAssignedIdentities/&lt;my-user-assigned-identity&gt;\"}}}'\n</code></pre>","tags":["Azure.VM.AMA","AZR-000345"]},{"location":"en/rules/Azure.VM.AMA/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"<p>To configure virtual machine using a user-assigned identity:</p> <ul> <li>Deploy a extension sub-resource <code>Microsoft.Compute/virtualMachines/extensions</code>.<ul> <li>Set the <code>-ExtensionType</code> parameter to <code>AzureMonitorWindowsAgent</code> (Windows) or <code>AzureMonitorLinuxAgent</code> (Linux).</li> <li>Fill in the remaining parameters.   For more information see Azure Monitor Agent overview.</li> </ul> </li> </ul> <p>For example:</p> Azure PowerShell snippet<pre><code>Set-AzVMExtension -Name AzureMonitorWindowsAgent -ExtensionType 'AzureMonitorWindowsAgent' -Publisher Microsoft.Azure.Monitor -ResourceGroupName '&lt;resource-group-name&gt;' -VMName '&lt;virtual-machine-name&gt;' -Location '&lt;location&gt;' -TypeHandlerVersion '1.0' -EnableAutomaticUpgrade $true -SettingString '{\"authentication\":{\"managedIdentity\":{\"identifier-name\":\"mi_res_id\",\"identifier-value\":\"/subscriptions/&lt;my-subscription-id&gt;/resourceGroups/&lt;my-resource-group&gt;/providers/Microsoft.ManagedIdentity/userAssignedIdentities/&lt;my-user-assigned-identity&gt;\"}}}'\n</code></pre>","tags":["Azure.VM.AMA","AZR-000345"]},{"location":"en/rules/Azure.VM.AMA/#notes","title":"Notes","text":"<p>Deploying Azure Monitor Agent (AMA) extension alone does not include all configuration needed. Additionally data collection rules and associations are required to specify what data is collected and where it is sent.</p>","tags":["Azure.VM.AMA","AZR-000345"]},{"location":"en/rules/Azure.VM.AMA/#links","title":"Links","text":"<ul> <li>OE:07 Monitoring system</li> <li>Azure Monitor Agent overview</li> <li>Manage Azure Monitor Agent</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.AMA","AZR-000345"]},{"location":"en/rules/Azure.VM.ASAlignment/","title":"Use aligned availability sets","text":"Azure.VM.ASAlignmentAZR-000254Error <p> Reliability  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Use availability sets aligned with managed disks fault domains.</p>","tags":["Azure.VM.ASAlignment","AZR-000254"]},{"location":"en/rules/Azure.VM.ASAlignment/#description","title":"Description","text":"<p>Availability sets can be configured to align with managed disk fault domains. When aligned, the fault domain for storage is co-located with compute. Aligned availability sets help prevent compute and storage from a single VM spanning multiple fault domains.</p>","tags":["Azure.VM.ASAlignment","AZR-000254"]},{"location":"en/rules/Azure.VM.ASAlignment/#recommendation","title":"Recommendation","text":"<p>Consider deploying VMs with managed disks into aligned availability sets.</p>","tags":["Azure.VM.ASAlignment","AZR-000254"]},{"location":"en/rules/Azure.VM.ASAlignment/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Availability sets</li> <li>Managed disk integration with availability sets</li> <li>Reliability checklist</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.ASAlignment","AZR-000254"]},{"location":"en/rules/Azure.VM.ASDistributeTraffic/","title":"Distributing traffic","text":"Azure.VM.ASDistributeTrafficAZR-000451Error <p> Reliability  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2024_09  \u00b7  Important</p> <p>Ensure high availability by distributing traffic among members in an availability set.</p>","tags":["Azure.VM.ASDistributeTraffic","AZR-000451"]},{"location":"en/rules/Azure.VM.ASDistributeTraffic/#description","title":"Description","text":"<p>An availability set is a logical grouping of virtual machines (VMs) in Azure, designed to enhance redundancy and reliability. By organizing VMs within an availability set, Azure optimizes their placement across fault and update domains, minimizing the impact of hardware failures or maintenance events.</p> <p>When VMs in an availability set are part of backend pools, traffic is evenly distributed among them, ensuring continuous application availability. Even if one VM goes offline, the application remains accessible, thanks to the built-in redundancy provided by the availability set.</p>","tags":["Azure.VM.ASDistributeTraffic","AZR-000451"]},{"location":"en/rules/Azure.VM.ASDistributeTraffic/#recommendation","title":"Recommendation","text":"<p>Consider placing availability set members in backend pools.</p>","tags":["Azure.VM.ASDistributeTraffic","AZR-000451"]},{"location":"en/rules/Azure.VM.ASDistributeTraffic/#examples","title":"Examples","text":"","tags":["Azure.VM.ASDistributeTraffic","AZR-000451"]},{"location":"en/rules/Azure.VM.ASDistributeTraffic/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy VM network interfaces that pass this rule:</p> <ul> <li>For each IP configuration specified in the <code>properties.ipConfigurations</code> property:<ul> <li>Ensure that the <code>properties.applicationGatewayBackendAddressPools.id</code> or/ and <code>properties.loadBalancerBackendAddressPools.id</code> property references at least one pool.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/networkInterfaces\",\n  \"apiVersion\": \"2023-11-01\",\n  \"name\": \"[parameters('nicName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"ipConfigurations\": [\n      {\n        \"name\": \"[parameters('ipConfig')]\",\n        \"properties\": {\n          \"privateIPAllocationMethod\": \"Dynamic\",\n          \"subnet\": {\n            \"id\": \"[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworkName'), parameters('subnetName'))]\"\n          },\n          \"loadBalancerBackendAddressPools\": [\n            {\n              \"id\": \"[resourceId('Microsoft.Network/loadBalancers/backendAddressPools', parameters('loadBalancerName'), 'backendPool')]\"\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.VM.ASDistributeTraffic","AZR-000451"]},{"location":"en/rules/Azure.VM.ASDistributeTraffic/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy VM network interfaces that pass this rule:</p> <ul> <li>For each IP configuration specified in the <code>properties.ipConfigurations</code> property:<ul> <li>Ensure that the <code>properties.applicationGatewayBackendAddressPools.id</code> or/ and <code>properties.loadBalancerBackendAddressPools.id</code> property references at least one pool.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource nic 'Microsoft.Network/networkInterfaces@2023-11-01' = {\n  name: nicName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: ipconfig\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\n          }\n          loadBalancerBackendAddressPools: [\n            {\n              id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', loadBalancerName, 'backendPool')\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.VM.ASDistributeTraffic","AZR-000451"]},{"location":"en/rules/Azure.VM.ASDistributeTraffic/#links","title":"Links","text":"<ul> <li>RE:05 Redundancy</li> <li>Availability sets overview</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.ASDistributeTraffic","AZR-000451"]},{"location":"en/rules/Azure.VM.ASMinMembers/","title":"Use availability sets with at least two members","text":"Azure.VM.ASMinMembersAZR-000255Error <p> Reliability  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Availability sets should be deployed with at least two virtual machines (VMs).</p>","tags":["Azure.VM.ASMinMembers","AZR-000255"]},{"location":"en/rules/Azure.VM.ASMinMembers/#description","title":"Description","text":"<p>An availability set is a logical grouping of VMs that allows Azure to optimize the placement of VMs. Azure uses this grouping to separate VMs within the availability set across fault and update domains. Each VM in your availability set is assigned an update domain and a fault domain. VMs in different update and fault domains is mapped to different underlying physical hardware. The reason for doing this is to improve reliability by removing some single points of failure.</p> <p>Deploy two or more VMs within an availability set to provide for a highly available application. There is no cost for the Availability Set itself, you only pay for each VM instance that you create.</p>","tags":["Azure.VM.ASMinMembers","AZR-000255"]},{"location":"en/rules/Azure.VM.ASMinMembers/#recommendation","title":"Recommendation","text":"<p>Consider deploying at least two VMs within an availability set to gain availability benefits.</p>","tags":["Azure.VM.ASMinMembers","AZR-000255"]},{"location":"en/rules/Azure.VM.ASMinMembers/#notes","title":"Notes","text":"<p>This rule applies when analyzing resources deployed to Azure (in-flight).</p>","tags":["Azure.VM.ASMinMembers","AZR-000255"]},{"location":"en/rules/Azure.VM.ASMinMembers/#links","title":"Links","text":"<ul> <li>RE:05 Redundancy</li> <li>Availability sets overview</li> <li>Availability options for virtual machines in Azure</li> <li>Failure mode analysis</li> <li>Tutorial: Create and deploy highly available virtual machines with Azure PowerShell</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.ASMinMembers","AZR-000255"]},{"location":"en/rules/Azure.VM.ASName/","title":"Use valid Availability Set names","text":"Azure.VM.ASNameAZR-000256Error <p> Operational Excellence  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Availability Set names should meet naming requirements.</p>","tags":["Azure.VM.ASName","AZR-000256"]},{"location":"en/rules/Azure.VM.ASName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Availability Set names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>Availability Set names must be unique within a resource group.</li> </ul>","tags":["Azure.VM.ASName","AZR-000256"]},{"location":"en/rules/Azure.VM.ASName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Availability Set naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.VM.ASName","AZR-000256"]},{"location":"en/rules/Azure.VM.ASName/#notes","title":"Notes","text":"<p>This rule does not check if Availability Set names are unique.</p>","tags":["Azure.VM.ASName","AZR-000256"]},{"location":"en/rules/Azure.VM.ASName/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> </ul>","tags":["Azure.VM.ASName","AZR-000256"]},{"location":"en/rules/Azure.VM.AcceleratedNetworking/","title":"Use accelerated networking","text":"Azure.VM.AcceleratedNetworkingAZR-000244Error <p> Performance Efficiency  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Use accelerated networking for supported operating systems and VM types.</p>","tags":["Azure.VM.AcceleratedNetworking","AZR-000244"]},{"location":"en/rules/Azure.VM.AcceleratedNetworking/#description","title":"Description","text":"<p>Enabling accelerated networking for a virtual machine (VM) greatly improves networking performance. Accelerated networking work by enabling single root I/O virtualization (SR-IOV) to a VM. SR-IOV reduces latency, jitter, and CPU utilization network demanding workloads.</p> <p>Accelerated networking is available for supported operating systems and VM types.</p>","tags":["Azure.VM.AcceleratedNetworking","AZR-000244"]},{"location":"en/rules/Azure.VM.AcceleratedNetworking/#recommendation","title":"Recommendation","text":"<p>Consider enabling accelerated networking for supported operating systems and VM types.</p>","tags":["Azure.VM.AcceleratedNetworking","AZR-000244"]},{"location":"en/rules/Azure.VM.AcceleratedNetworking/#links","title":"Links","text":"<ul> <li>PE:07 Code and infrastructure</li> <li>Create a Linux virtual machine with Accelerated Networking using Azure CLI</li> <li>Create a Windows VM with accelerated networking using Azure PowerShell</li> </ul>","tags":["Azure.VM.AcceleratedNetworking","AZR-000244"]},{"location":"en/rules/Azure.VM.Agent/","title":"VM agent is provisioned automatically","text":"Azure.VM.AgentAZR-000246Error <p> Operational Excellence  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Ensure the VM agent is provisioned automatically.</p>","tags":["Azure.VM.Agent","AZR-000246"]},{"location":"en/rules/Azure.VM.Agent/#description","title":"Description","text":"<p>The virtual machine (VM) agent is required for most functionality that interacts with the guest operating system.</p> <p>VM extensions help reduce management overhead by providing an entry point to bootstrap monitoring and configuration of the guest operating system. The VM agent is required to use any VM extensions.</p>","tags":["Azure.VM.Agent","AZR-000246"]},{"location":"en/rules/Azure.VM.Agent/#recommendation","title":"Recommendation","text":"<p>Automatically provision the VM agent for all supported operating systems, this is the default.</p>","tags":["Azure.VM.Agent","AZR-000246"]},{"location":"en/rules/Azure.VM.Agent/#links","title":"Links","text":"<ul> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.Agent","AZR-000246"]},{"location":"en/rules/Azure.VM.BasicSku/","title":"Avoid Basic VM SKU","text":"Azure.VM.BasicSkuAZR-000241Error <p> Reliability  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Virtual machines (VMs) should not use Basic sizes.</p>","tags":["Azure.VM.BasicSku","AZR-000241"]},{"location":"en/rules/Azure.VM.BasicSku/#description","title":"Description","text":"<p>VMs can be deployed in Basic or Standard sizes. Basic VM sizes are suitable only for entry level development scenarios.</p>","tags":["Azure.VM.BasicSku","AZR-000241"]},{"location":"en/rules/Azure.VM.BasicSku/#recommendation","title":"Recommendation","text":"<p>Basic VM sizes are not suitable for production workloads or intensive development workloads. Consider migration to an alternative Standard VM size.</p>","tags":["Azure.VM.BasicSku","AZR-000241"]},{"location":"en/rules/Azure.VM.BasicSku/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Sizes for Windows virtual machines in Azure</li> <li>Sizes for Linux virtual machines in Azure</li> </ul>","tags":["Azure.VM.BasicSku","AZR-000241"]},{"location":"en/rules/Azure.VM.ComputerName/","title":"Use valid VM computer names","text":"Azure.VM.ComputerNameAZR-000249Error <p> Operational Excellence  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Virtual Machine (VM) computer name should meet naming requirements.</p>","tags":["Azure.VM.ComputerName","AZR-000249"]},{"location":"en/rules/Azure.VM.ComputerName/#description","title":"Description","text":"<p>When configuring Azure VMs the assigned computer name must meet operation system (OS) requirements.</p> <p>The requirements for Windows VMs are:</p> <ul> <li>Between 1 and 15 characters long.</li> <li>Alphanumerics, and hyphens.</li> <li>Can not include only numbers.</li> </ul> <p>The requirements for Linux VMs are:</p> <ul> <li>Between 1 and 64 characters long.</li> <li>Alphanumerics, periods, and hyphens.</li> <li>Start with alphanumeric.</li> </ul>","tags":["Azure.VM.ComputerName","AZR-000249"]},{"location":"en/rules/Azure.VM.ComputerName/#recommendation","title":"Recommendation","text":"<p>Consider using computer names that meet OS naming requirements. Additionally, consider using computer names that match the VM resource name.</p>","tags":["Azure.VM.ComputerName","AZR-000249"]},{"location":"en/rules/Azure.VM.ComputerName/#notes","title":"Notes","text":"<p>VM resource names have different naming restrictions. See <code>Azure.VM.Name</code> for details.</p>","tags":["Azure.VM.ComputerName","AZR-000249"]},{"location":"en/rules/Azure.VM.ComputerName/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.ComputerName","AZR-000249"]},{"location":"en/rules/Azure.VM.DiskAttached/","title":"Remove unused managed disks","text":"Azure.VM.DiskAttachedAZR-000250Error <p> Cost Optimization  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Managed disks should be attached to virtual machines or removed.</p>","tags":["Azure.VM.DiskAttached","AZR-000250"]},{"location":"en/rules/Azure.VM.DiskAttached/#description","title":"Description","text":"<p>Unattached managed disks are charged but not in use. Unattached managed disks still consume storage and are charged on their size.</p>","tags":["Azure.VM.DiskAttached","AZR-000250"]},{"location":"en/rules/Azure.VM.DiskAttached/#recommendation","title":"Recommendation","text":"<p>Consider removing managed disks that are no longer required to reduce complexity and costs.</p>","tags":["Azure.VM.DiskAttached","AZR-000250"]},{"location":"en/rules/Azure.VM.DiskAttached/#notes","title":"Notes","text":"<p>This rule applies when analyzing resources deployed (in-flight) to Azure.</p>","tags":["Azure.VM.DiskAttached","AZR-000250"]},{"location":"en/rules/Azure.VM.DiskAttached/#links","title":"Links","text":"<ul> <li>CO:07 Component costs</li> <li>Managed Disk pricing</li> </ul>","tags":["Azure.VM.DiskAttached","AZR-000250"]},{"location":"en/rules/Azure.VM.DiskCaching/","title":"Configure host caching","text":"Azure.VM.DiskCachingAZR-000242Error <p> Performance Efficiency  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Check disk caching is configured correctly for the workload.</p>","tags":["Azure.VM.DiskCaching","AZR-000242"]},{"location":"en/rules/Azure.VM.DiskCaching/#description","title":"Description","text":"<p>Check disk caching is configured correctly for the workload.</p>","tags":["Azure.VM.DiskCaching","AZR-000242"]},{"location":"en/rules/Azure.VM.DiskCaching/#recommendation","title":"Recommendation","text":"<p>Check disk caching is configured correctly for the workload.</p>","tags":["Azure.VM.DiskCaching","AZR-000242"]},{"location":"en/rules/Azure.VM.DiskCaching/#links","title":"Links","text":"<ul> <li>PE:07 Code and infrastructure</li> </ul>","tags":["Azure.VM.DiskCaching","AZR-000242"]},{"location":"en/rules/Azure.VM.DiskName/","title":"Use valid Managed Disk names","text":"Azure.VM.DiskNameAZR-000253Error <p> Operational Excellence  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Managed Disk names should meet naming requirements.</p>","tags":["Azure.VM.DiskName","AZR-000253"]},{"location":"en/rules/Azure.VM.DiskName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Managed Disk names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>Managed Disk names must be unique within a resource group.</li> </ul>","tags":["Azure.VM.DiskName","AZR-000253"]},{"location":"en/rules/Azure.VM.DiskName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Managed Disk naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.VM.DiskName","AZR-000253"]},{"location":"en/rules/Azure.VM.DiskName/#notes","title":"Notes","text":"<p>This rule does not check if Managed Disk names are unique.</p>","tags":["Azure.VM.DiskName","AZR-000253"]},{"location":"en/rules/Azure.VM.DiskName/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> </ul>","tags":["Azure.VM.DiskName","AZR-000253"]},{"location":"en/rules/Azure.VM.DiskSizeAlignment/","title":"Allocate VM disks aligned to billing model","text":"Azure.VM.DiskSizeAlignmentAZR-000251Error <p> Cost Optimization  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Align to the Managed Disk billing increments to improve cost efficiency.</p>","tags":["Azure.VM.DiskSizeAlignment","AZR-000251"]},{"location":"en/rules/Azure.VM.DiskSizeAlignment/#description","title":"Description","text":"<p>Azure managed disks are billed based on predefined size increments. The billing increments are based on the disk storage type. These include:</p> <ul> <li><code>Premium SSD</code> - 4/ 8/ 16/ 32/ 64/ 128/ 256/ 512/ 1024/ 2048/ 4096/ 8192/ 16384/ 32768 GiB.</li> <li><code>Standard SSD</code> - 4/ 8/ 16/ 32/ 64/ 128/ 256/ 512/ 1024/ 2048/ 4096/ 8192/ 16384/ 32768 GiB.</li> <li><code>Standard HDD</code> - 32/ 64/ 128/ 256/ 512/ 1024/ 2048/ 4096/ 8192/ 16384/ 32768 GiB.</li> <li><code>Ultra SSD</code> - 4/ 8/ 16/ 32/ 64/ 128/ 256/ 512 GiB, then 1 TiB increments to 64 TiB.</li> </ul> <p>If you provision a disk that is not aligned to the billing model, you will be billed for the next increment. For example, if a disk is provisioned at 33 GiB, the disk is billed as 64 GiB.</p>","tags":["Azure.VM.DiskSizeAlignment","AZR-000251"]},{"location":"en/rules/Azure.VM.DiskSizeAlignment/#recommendation","title":"Recommendation","text":"<p>Consider aligning provisioned disk sizes to the billing increments for Managed Disks to improve cost efficiency.</p>","tags":["Azure.VM.DiskSizeAlignment","AZR-000251"]},{"location":"en/rules/Azure.VM.DiskSizeAlignment/#examples","title":"Examples","text":"","tags":["Azure.VM.DiskSizeAlignment","AZR-000251"]},{"location":"en/rules/Azure.VM.DiskSizeAlignment/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy managed disks that pass this rule:</p> <ul> <li>Set the <code>properties.diskSizeGB</code> property to a value that aligns to the billing model of the disk storage type.   E.g. <code>32</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Compute/disks\",\n  \"apiVersion\": \"2023-04-02\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Premium_ZRS\"\n  },\n  \"properties\": {\n    \"creationData\": {\n      \"createOption\": \"Empty\"\n    },\n    \"diskSizeGB\": 32\n  }\n}\n</code></pre>","tags":["Azure.VM.DiskSizeAlignment","AZR-000251"]},{"location":"en/rules/Azure.VM.DiskSizeAlignment/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy managed disks that pass this rule:</p> <ul> <li>Set the <code>properties.diskSizeGB</code> property to a value that aligns to the billing model of the disk storage type.   E.g. <code>32</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource dataDisk 'Microsoft.Compute/disks@2023-04-02' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Premium_ZRS'\n  }\n  properties: {\n    creationData: {\n      createOption: 'Empty'\n    }\n    diskSizeGB: 32\n  }\n}\n</code></pre>","tags":["Azure.VM.DiskSizeAlignment","AZR-000251"]},{"location":"en/rules/Azure.VM.DiskSizeAlignment/#notes","title":"Notes","text":"<p>This rule has the following limitations:</p> <ul> <li>This rule applies to managed disks using the following storage type: Ultra SSD, Premium SSD, and Standard SSD/ HDD disks.<ul> <li>Premium v2 disks are billed per provisioned disk capacity based on 1 GiB increments.</li> <li>Unmanaged disks are ignored.</li> </ul> </li> <li>The rule does not fail if the disk size is within 5 GiB on the next size.   For example: A 30 GiB disk is not aligned to the billed size of 32 GiB, but is within 5 GiB.</li> <li>Disks with a marketplace purchase plan are ignored.   These disks are predefined by the publisher are often unable to be reconfigured.</li> </ul>","tags":["Azure.VM.DiskSizeAlignment","AZR-000251"]},{"location":"en/rules/Azure.VM.DiskSizeAlignment/#links","title":"Links","text":"<ul> <li>CO:06 Usage and billing increments</li> <li>Managed Disks pricing</li> <li>Azure managed disk types</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.DiskSizeAlignment","AZR-000251"]},{"location":"en/rules/Azure.VM.MaintenanceConfig/","title":"Associate a maintenance configuration","text":"Azure.VM.MaintenanceConfigAZR-000375Error <p> Reliability  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2024_06  \u00b7  Important</p> <p>Use a maintenance configuration for virtual machines.</p>","tags":["Azure.VM.MaintenanceConfig","AZR-000375"]},{"location":"en/rules/Azure.VM.MaintenanceConfig/#description","title":"Description","text":"<p>Azure Virtual Machines (VMs) support maintenance configurations. You can use the Maintenance Configurations to control and manage updates for Azure VM resources. Configuring a maintenance window and time zone allows you to reduce disruptions to your workloads during peak hours.</p> <p>If a maintenance configuration is not associated:</p> <ul> <li>Updates managed by the platform may be still be scheduled for your virtual machine.</li> <li>The schedule determined by the platform may not align with your maintenance window.</li> </ul> <p>Maintenance configurations also integrate with Azure Update Manager. Azure Update Manager can be used to apply guest operating system (OS) updates to keep your VMs secure and compliant.</p>","tags":["Azure.VM.MaintenanceConfig","AZR-000375"]},{"location":"en/rules/Azure.VM.MaintenanceConfig/#recommendation","title":"Recommendation","text":"<p>Consider associating a maintenance configuration to your VM to reduce unplanned disruptions to your workloads.</p>","tags":["Azure.VM.MaintenanceConfig","AZR-000375"]},{"location":"en/rules/Azure.VM.MaintenanceConfig/#examples","title":"Examples","text":"","tags":["Azure.VM.MaintenanceConfig","AZR-000375"]},{"location":"en/rules/Azure.VM.MaintenanceConfig/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy virtual machines that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.Maintenance/configurationAssignments</code> sub-resource (extension resource).</li> <li>Set the <code>properties.maintenanceConfigurationId</code> property to the linked maintenance configuration resource Id.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Maintenance/configurationAssignments\",\n  \"apiVersion\": \"2023-04-01\",\n  \"scope\": \"[format('Microsoft.Compute/virtualMachines/{0}', parameters('name'))]\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"maintenanceConfigurationId\": \"[resourceId('Microsoft.Maintenance/maintenanceConfigurations', parameters('name'))]\"\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Maintenance/maintenanceConfigurations', parameters('name'))]\",\n    \"[resourceId('Microsoft.Compute/virtualMachines', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.VM.MaintenanceConfig","AZR-000375"]},{"location":"en/rules/Azure.VM.MaintenanceConfig/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy virtual machines that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.Maintenance/configurationAssignments</code> sub-resource (extension resource).</li> <li>Set the <code>properties.maintenanceConfigurationId</code> property to the linked maintenance configuration resource Id.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource config 'Microsoft.Maintenance/configurationAssignments@2023-04-01' = {\n  name: name\n  location: location\n  scope: vm\n  properties: {\n    maintenanceConfigurationId: maintenanceConfiguration.id\n  }\n}\n</code></pre>","tags":["Azure.VM.MaintenanceConfig","AZR-000375"]},{"location":"en/rules/Azure.VM.MaintenanceConfig/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Managing VM updates with Maintenance Configurations</li> <li>About Azure Update Manager</li> <li>Manage update configuration settings</li> <li>Support matrix for Azure Update Manager</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.MaintenanceConfig","AZR-000375"]},{"location":"en/rules/Azure.VM.MigrateAMA/","title":"Migrate to Azure Monitor Agent","text":"Azure.VM.MigrateAMAAZR-000317Error <p> Operational Excellence  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Use Azure Monitor Agent as replacement for Log Analytics Agent.</p>","tags":["Azure.VM.MigrateAMA","AZR-000317"]},{"location":"en/rules/Azure.VM.MigrateAMA/#description","title":"Description","text":"<p>The legacy Log Analytics agent will be retired on August 31, 2024. Before that date, you'll need to start using the Azure Monitor agent to monitor your VMs and servers in Azure. The Azure Monitor agent provdes the following benefits over legacy agents:</p> <ul> <li>Security and performance<ul> <li>Enhanced security through Managed Identity and Azure Active Directory (Azure AD) tokens (for clients).</li> <li>A higher events-per-second (EPS) upload rate.</li> </ul> </li> <li>Cost savings by using data collection rules. Using DCRs is one of the most useful advantages of using Azure Monitor Agent:<ul> <li>DCRs let you configure data collection for specific machines connected to a workspace as compared to the \"all or nothing\" approach of legacy agents.</li> <li>With DCRs, you can define which data to ingest and which data to filter out to reduce workspace clutter and save on costs.</li> </ul> </li> <li>Simpler management of data collection, including ease of troubleshooting:<ul> <li>Easy multihoming on Windows and Linux.</li> <li>Centralized, \"in the cloud\" agent configuration makes every action simpler and more easily scalable throughout the data collection lifecycle, from onboarding to deployment to updates and changes over time.</li> <li>Greater transparency and control of more capabilities and services, such as Microsoft Sentinel, Defender for Cloud, and VM Insights.</li> </ul> </li> <li>A single agent that consolidates all features necessary to address all telemetry data collection needs across servers and client devices running Windows 10 or 11. A single agent is the goal, although Azure Monitor Agent currently converges with the Log Analytics agents.</li> </ul>","tags":["Azure.VM.MigrateAMA","AZR-000317"]},{"location":"en/rules/Azure.VM.MigrateAMA/#recommendation","title":"Recommendation","text":"<p>Virtual Machines should migrate to Azure Monitor Agent.</p>","tags":["Azure.VM.MigrateAMA","AZR-000317"]},{"location":"en/rules/Azure.VM.MigrateAMA/#examples","title":"Examples","text":"","tags":["Azure.VM.MigrateAMA","AZR-000317"]},{"location":"en/rules/Azure.VM.MigrateAMA/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy virtual machines that pass this rule:</p> <ul> <li>Deploy a extension sub-resource (extension resource).</li> <li>Set <code>properties.publisher</code> to <code>'Microsoft.Azure.Monitor'</code>.</li> <li>Set <code>properties.type</code> to <code>'AzureMonitorWindowsAgent'</code> (Windows) or <code>'AzureMonitorLinuxAgent'</code> (Linux).</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"vmName\": {\n      \"type\": \"string\"\n    },\n    \"location\": {\n      \"type\": \"string\"\n    },\n    \"userAssignedManagedIdentity\": {\n      \"type\": \"string\"\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\n      \"apiVersion\": \"2022-08-01\",\n      \"name\": \"[format('{0}/AzureMonitorWindowsAgent', parameters('vmName'))]\",\n      \"location\": \"[parameters('location')]\",\n      \"properties\": {\n        \"publisher\": \"Microsoft.Azure.Monitor\",\n        \"type\": \"AzureMonitorWindowsAgent\",\n        \"typeHandlerVersion\": \"1.0\",\n        \"settings\": {\n          \"authentication\": {\n            \"managedIdentity\": {\n              \"identifier-name\": \"mi_res_id\",\n              \"identifier-value\": \"[parameters('userAssignedManagedIdentity')]\"\n            }\n          }\n        },\n        \"autoUpgradeMinorVersion\": true,\n        \"enableAutomaticUpgrade\": true\n      }\n    }\n  ]\n}\n</code></pre>","tags":["Azure.VM.MigrateAMA","AZR-000317"]},{"location":"en/rules/Azure.VM.MigrateAMA/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy virtual machines that pass this rule:</p> <ul> <li>Deploy a extension sub-resource (extension resource).</li> <li>Set <code>properties.publisher</code> to <code>'Microsoft.Azure.Monitor'</code>.</li> <li>Set <code>properties.type</code> to <code>'AzureMonitorWindowsAgent'</code> (Windows) or <code>'AzureMonitorLinuxAgent'</code> (Linux).</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>param vmName string\nparam location string\nparam userAssignedManagedIdentity string\n\nresource windowsAgent 'Microsoft.Compute/virtualMachines/extensions@2022-08-01' = {\n  name: '${vmName}/AzureMonitorWindowsAgent'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.Monitor'\n    type: 'AzureMonitorWindowsAgent'\n    typeHandlerVersion: '1.0'\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n    settings: {\n      authentication: {\n        managedIdentity: {\n          identifier-name: 'mi_res_id'\n          identifier-value: userAssignedManagedIdentity\n        }\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.VM.MigrateAMA","AZR-000317"]},{"location":"en/rules/Azure.VM.MigrateAMA/#links","title":"Links","text":"<ul> <li>Monitoring</li> <li>Log Analytics agent retiring</li> <li>Migrate to Azure Monitor Agent from Log Analytics Agent</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.MigrateAMA","AZR-000317"]},{"location":"en/rules/Azure.VM.MultiTenantHosting/","title":"Multi-tenant Hosting Rights","text":"Azure.VM.MultiTenantHostingAZR-000452Error <p> Cost Optimization  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2024_09  \u00b7  Awareness</p> <p>Deploy Windows 10 and 11 virtual machines in Azure using Multi-tenant Hosting Rights to leverage your existing Windows licenses.</p>","tags":["Azure.VM.MultiTenantHosting","AZR-000452"]},{"location":"en/rules/Azure.VM.MultiTenantHosting/#description","title":"Description","text":"<p>Multi-tenant Hosting Rights allow you to bring your Windows 10 and 11 licenses to the cloud, enabling you to run virtual machines (VMs) on Azure without incurring additional licensing costs. This benefit is applicable if you have Windows licenses with Software Assurance or qualifying subscription licenses, making it a cost-effective option for your Azure deployments.</p> <p>By utilizing Multi-tenant Hosting Rights, you can reduce the total cost of ownership when running Windows VMs in Azure. This is particularly advantageous for organizations that already have on-premises Windows licenses covered under Software Assurance or eligible subscription plans.</p> <p>Please note that this benefit is available exclusively for Windows 10 Enterprise and Windows 11 Enterprise editions.</p>","tags":["Azure.VM.MultiTenantHosting","AZR-000452"]},{"location":"en/rules/Azure.VM.MultiTenantHosting/#recommendation","title":"Recommendation","text":"<p>Consider using Multi-tenant Hosting Rights to maximize your existing licensing investments when deploying Windows VMs in Azure.</p>","tags":["Azure.VM.MultiTenantHosting","AZR-000452"]},{"location":"en/rules/Azure.VM.MultiTenantHosting/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy virtual machines that pass this rule:</p> <ul> <li>Set the <code>properties.licenseType</code> property to <code>Windows_Client</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Compute/virtualMachines\",\n  \"apiVersion\": \"2024-07-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n      \"hardwareProfile\": {\n          \"vmSize\": \"Standard_D2s_v3\"\n      },\n      \"osProfile\": {\n          \"computerName\": \"[parameters('name')]\",\n          \"adminUsername\": \"[parameters('adminUsername')]\",\n          \"adminPassword\": \"[parameters('adminPassword')]\"\n      },\n      \"storageProfile\": {\n          \"imageReference\": {\n              \"publisher\": \"MicrosoftWindowsDesktop\",\n              \"offer\": \"windows-11\",\n              \"sku\": \"win11-23h2-ent\",\n              \"version\": \"latest\"\n          },\n          \"osDisk\": {\n              \"name\": \"[format('{0}-disk0', parameters('name'))]\",\n              \"caching\": \"ReadWrite\",\n              \"createOption\": \"FromImage\",\n              \"managedDisk\": {\n                  \"storageAccountType\": \"Premium_LRS\"\n              }\n          }\n      },\n      \"licenseType\": \"Windows_Client\",\n      \"networkProfile\": {\n          \"networkInterfaces\": [\n              {\n                  \"id\": \"[resourceId('Microsoft.Network/networkInterfaces', format('{0}-nic0', parameters('name')))]\"\n              }\n          ]\n      }\n  },\n  \"dependsOn\": [\n      \"[resourceId('Microsoft.Network/networkInterfaces', format('{0}-nic0', parameters('name')))]\"\n  ]\n}\n</code></pre>","tags":["Azure.VM.MultiTenantHosting","AZR-000452"]},{"location":"en/rules/Azure.VM.MultiTenantHosting/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy virtual machines that pass this rule:</p> <ul> <li>Set the <code>properties.licenseType</code> property to <code>Windows_Client</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vm 'Microsoft.Compute/virtualMachines@2024-07-01' = {\n  name: name\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: 'Standard_D2s_v3'\n    }\n    osProfile: {\n      computerName: name\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsDesktop'\n        offer: 'windows-11'\n        sku: 'win11-23h2-ent'\n        version: 'latest'\n      }\n      osDisk: {\n        name: '${name}-disk0'\n        caching: 'ReadWrite'\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: 'Premium_LRS'\n        }\n      }\n    }\n    licenseType: 'Windows_Client'\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: nic.id\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.VM.MultiTenantHosting","AZR-000452"]},{"location":"en/rules/Azure.VM.MultiTenantHosting/#notes","title":"Notes","text":"<p>This rule may produce false negatives because it does not verify whether the installed Windows OS is an Enterprise edition.</p>","tags":["Azure.VM.MultiTenantHosting","AZR-000452"]},{"location":"en/rules/Azure.VM.MultiTenantHosting/#rule-configuration","title":"Rule configuration","text":"<p>AZURE_VM_USE_MULTI_TENANT_HOSTING_RIGHTS</p> <p>By default, this rule is ignored. For this rule to apply, set the <code>AZURE_VM_USE_MULTI_TENANT_HOSTING_RIGHTS</code> configuration value to <code>true</code>.</p> <p>For example:</p> <pre><code>configuration:\n  AZURE_VM_USE_MULTI_TENANT_HOSTING_RIGHTS: true\n</code></pre>","tags":["Azure.VM.MultiTenantHosting","AZR-000452"]},{"location":"en/rules/Azure.VM.MultiTenantHosting/#links","title":"Links","text":"<ul> <li>CO:05 Rate optimization</li> <li>Multi-tenant Hosting Rights</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.MultiTenantHosting","AZR-000452"]},{"location":"en/rules/Azure.VM.Name/","title":"Use valid VM names","text":"Azure.VM.NameAZR-000248Error <p> Operational Excellence  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Virtual Machine (VM) names should meet naming requirements.</p>","tags":["Azure.VM.Name","AZR-000248"]},{"location":"en/rules/Azure.VM.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for VM names are:</p> <ul> <li>Between 1 and 64 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>VM names must be unique within a resource group.</li> </ul>","tags":["Azure.VM.Name","AZR-000248"]},{"location":"en/rules/Azure.VM.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet VM resource name requirements. Additionally, consider using a resource name that meeting OS naming requirements.</p>","tags":["Azure.VM.Name","AZR-000248"]},{"location":"en/rules/Azure.VM.Name/#notes","title":"Notes","text":"<p>This rule does not check if VM names are unique. Additionally, VM computer names have additional restrictions. See <code>Azure.VM.ComputerName</code> for details.</p>","tags":["Azure.VM.Name","AZR-000248"]},{"location":"en/rules/Azure.VM.Name/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.Name","AZR-000248"]},{"location":"en/rules/Azure.VM.PPGName/","title":"Use valid PPG names","text":"Azure.VM.PPGNameAZR-000260Error <p> Operational Excellence  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Proximity Placement Group (PPG) names should meet naming requirements.</p>","tags":["Azure.VM.PPGName","AZR-000260"]},{"location":"en/rules/Azure.VM.PPGName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for placement groups names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start and end with alphanumeric.</li> <li>PPG names must be unique within a resource group.</li> </ul>","tags":["Azure.VM.PPGName","AZR-000260"]},{"location":"en/rules/Azure.VM.PPGName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Proximity Placement Group naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.VM.PPGName","AZR-000260"]},{"location":"en/rules/Azure.VM.PPGName/#notes","title":"Notes","text":"<p>This rule does not check if Proximity Placement Group names are unique.</p>","tags":["Azure.VM.PPGName","AZR-000260"]},{"location":"en/rules/Azure.VM.PPGName/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Azure resources</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.PPGName","AZR-000260"]},{"location":"en/rules/Azure.VM.PromoSku/","title":"Use current VM SKUs","text":"Azure.VM.PromoSkuAZR-000240Error <p> Cost Optimization  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Virtual machines (VMs) should not use expired promotional SKU.</p>","tags":["Azure.VM.PromoSku","AZR-000240"]},{"location":"en/rules/Azure.VM.PromoSku/#description","title":"Description","text":"<p>Some VM sizes may offer promotional rates that can be used by deploying VMs with a designated SKU. Promotional rates expire, and while this does not cause interruption to running VMs, the rate that VMs are billed at returns to the original price.</p> <p>Promo SKUs are not eligible for savings from reserved instances. Expired promo SKUs may confuse billing reconciliation when the promotional period expires.</p> <p>VMs should not use expired promo SKU.</p>","tags":["Azure.VM.PromoSku","AZR-000240"]},{"location":"en/rules/Azure.VM.PromoSku/#recommendation","title":"Recommendation","text":"<p>Consider moving from promotional SKUs to SKUs eligible for reserved instances for VMs with an extended life cycle. Alternatively, consider moving from promotional SKUs to the regular SKU once the promotional period has expired.</p>","tags":["Azure.VM.PromoSku","AZR-000240"]},{"location":"en/rules/Azure.VM.PromoSku/#links","title":"Links","text":"<ul> <li>CO:05 Rate optimization</li> <li>Virtual Machine pricing</li> </ul>","tags":["Azure.VM.PromoSku","AZR-000240"]},{"location":"en/rules/Azure.VM.PublicIPAttached/","title":"Public IPs attached","text":"Azure.VM.PublicIPAttachedAZR-000449Error <p> Security  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2024_09  \u00b7  Critical</p> <p>Avoid attaching public IPs directly to virtual machines.</p>","tags":["Azure.VM.PublicIPAttached","AZR-000449"]},{"location":"en/rules/Azure.VM.PublicIPAttached/#description","title":"Description","text":"<p>Attaching a public IP address to a virtual machine network interface (NIC) exposes it directly to the Internet. This exposure can make the VM vulnerable to unauthorized inbound access and security compromise. Minimize the number of Internet ingress/ egress points to enhance security and reduces potential attack surfaces.</p> <p>For enhanced security, consider one or more of the following options:</p> <ul> <li>Secure remote access \u2014 by RDP or SSH to virtual machines can be configured through Azure Bastion.<ul> <li>Azure Bastion provides a secure encrypted connection without exposing a public IP.</li> </ul> </li> <li>Exposing web services \u2014 by HTTP/S can be configured by App Gateway or Azure Front Door (AFD).<ul> <li>App Gateway and AFD provide a secure reverse proxy that supports web application firewall (WAF) filtering.</li> </ul> </li> <li>Internet connectivity \u2014 should be managed through a security hardened device such as Azure Firewall.<ul> <li>This option also allows additional controls to be applied for east/ west and north/ south traffic filtering.</li> <li>Alternatively a Network Virtual Appliance (NVA) can used.</li> </ul> </li> </ul>","tags":["Azure.VM.PublicIPAttached","AZR-000449"]},{"location":"en/rules/Azure.VM.PublicIPAttached/#recommendation","title":"Recommendation","text":"<p>Evaluate alternative methods for inbound access to virtual machines to enhance security and minimize risk.</p>","tags":["Azure.VM.PublicIPAttached","AZR-000449"]},{"location":"en/rules/Azure.VM.PublicIPAttached/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy VM network interfaces that pass this rule:</p> <ul> <li>For each IP configuration specified in the <code>properties.ipConfigurations</code> property:<ul> <li>Ensure that the <code>properties.publicIPAddress.id</code> property does not reference a Public IP resource.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/networkInterfaces\",\n  \"apiVersion\": \"2023-11-01\",\n  \"name\": \"[parameters('nicName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"ipConfigurations\": [\n      {\n        \"name\": \"[parameters('ipConfig')]\",\n        \"properties\": {\n          \"privateIPAllocationMethod\": \"Dynamic\",\n          \"subnet\": {\n            \"id\": \"[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworkName'), parameters('subnetName'))]\"\n          }\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.VM.PublicIPAttached","AZR-000449"]},{"location":"en/rules/Azure.VM.PublicIPAttached/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy VM network interfaces that pass this rule:</p> <ul> <li>For each IP configuration specified in the <code>properties.ipConfigurations</code> property:<ul> <li>Ensure that the <code>properties.publicIPAddress.id</code> property does not reference a Public IP resource.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource nic 'Microsoft.Network/networkInterfaces@2023-11-01' = {\n  name: nicName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: ipconfig\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\n          }\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.VM.PublicIPAttached","AZR-000449"]},{"location":"en/rules/Azure.VM.PublicIPAttached/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Plan for inbound and outbound internet connectivity</li> <li>Dissociate public IP address from a VM</li> <li>Azure Bastion</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.PublicIPAttached","AZR-000449"]},{"location":"en/rules/Azure.VM.PublicKey/","title":"VM password-based authentication is enabled","text":"Azure.VM.PublicKeyAZR-000245Error <p> Security  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Linux virtual machines should use public keys.</p>","tags":["Azure.VM.PublicKey","AZR-000245"]},{"location":"en/rules/Azure.VM.PublicKey/#description","title":"Description","text":"<p>Linux virtual machines should have password authentication disabled to help with eliminating password-based attacks.</p>","tags":["Azure.VM.PublicKey","AZR-000245"]},{"location":"en/rules/Azure.VM.PublicKey/#recommendation","title":"Recommendation","text":"<p>Consider disabling password-based authentication on Linux virtual machines and instead use public keys.</p>","tags":["Azure.VM.PublicKey","AZR-000245"]},{"location":"en/rules/Azure.VM.PublicKey/#examples","title":"Examples","text":"","tags":["Azure.VM.PublicKey","AZR-000245"]},{"location":"en/rules/Azure.VM.PublicKey/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy virtual machines that pass this rule:</p> <ul> <li>Set the <code>properties.osProfile.linuxConfiguration.disablePasswordAuthentication</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Compute/virtualMachines\",\n  \"apiVersion\": \"2024-03-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"hardwareProfile\": {\n      \"vmSize\": \"Standard_D8d_v5\"\n    },\n    \"osProfile\": {\n      \"computerName\": \"[parameters('name')]\",\n      \"adminUsername\": \"[parameters('adminUsername')]\",\n      \"linuxConfiguration\": {\n        \"disablePasswordAuthentication\": true\n      }\n    },\n    \"storageProfile\": {\n      \"imageReference\": {\n        \"publisher\": \"MicrosoftCblMariner\",\n        \"offer\": \"Cbl-Mariner\",\n        \"sku\": \"cbl-mariner-2-gen2\",\n        \"version\": \"latest\"\n      },\n      \"osDisk\": {\n        \"name\": \"[format('{0}-disk0', parameters('name'))]\",\n        \"caching\": \"ReadWrite\",\n        \"createOption\": \"FromImage\",\n        \"managedDisk\": {\n          \"storageAccountType\": \"Premium_LRS\"\n        }\n      }\n    },\n    \"networkProfile\": {\n      \"networkInterfaces\": [\n        {\n          \"id\": \"[resourceId('Microsoft.Network/networkInterfaces', parameters('nicName'))]\"\n        }\n      ]\n    }\n  },\n  \"zones\": [\n    \"1\"\n  ],\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Network/networkInterfaces', parameters('nicName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.VM.PublicKey","AZR-000245"]},{"location":"en/rules/Azure.VM.PublicKey/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy virtual machines that pass this rule:</p> <ul> <li>Set the <code>properties.osProfile.linuxConfiguration.disablePasswordAuthentication</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource linux 'Microsoft.Compute/virtualMachines@2024-03-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    hardwareProfile: {\n      vmSize: 'Standard_D8d_v5'\n    }\n    osProfile: {\n      computerName: name\n      adminUsername: adminUsername\n      linuxConfiguration: {\n        disablePasswordAuthentication: true\n      }\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftCblMariner'\n        offer: 'Cbl-Mariner'\n        sku: 'cbl-mariner-2-gen2'\n        version: 'latest'\n      }\n      osDisk: {\n        name: '${name}-disk0'\n        caching: 'ReadWrite'\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: 'Premium_LRS'\n        }\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: nic.id\n        }\n      ]\n    }\n  }\n  zones: [\n    '1'\n  ]\n}\n</code></pre>","tags":["Azure.VM.PublicKey","AZR-000245"]},{"location":"en/rules/Azure.VM.PublicKey/#links","title":"Links","text":"<ul> <li>SE:08 Hardening resources</li> <li>Azure security baseline for Linux Virtual Machines</li> <li>Detailed steps: Create and manage SSH keys for authentication to a Linux VM in Azure</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.PublicKey","AZR-000245"]},{"location":"en/rules/Azure.VM.SQLServerDisk/","title":"Configure Premium disks or above","text":"Azure.VM.SQLServerDiskAZR-000324Error <p> Performance Efficiency  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Use Premium SSD disks or greater for data and log files for production SQL Server workloads.</p>","tags":["Azure.VM.SQLServerDisk","AZR-000324"]},{"location":"en/rules/Azure.VM.SQLServerDisk/#description","title":"Description","text":"<p>Use premium SSD disks or greater for data and log files for production SQL Server workloads.</p> <p>This is an advanced topic with many considerations, so we highly suggest to follow the <code>LINKS</code> section for more around this with aligned and up-to-date documentation.</p>","tags":["Azure.VM.SQLServerDisk","AZR-000324"]},{"location":"en/rules/Azure.VM.SQLServerDisk/#recommendation","title":"Recommendation","text":"<p>Configure Premium SSD disks or greater for data and log files for production SQL Server workloads.</p>","tags":["Azure.VM.SQLServerDisk","AZR-000324"]},{"location":"en/rules/Azure.VM.SQLServerDisk/#examples","title":"Examples","text":"","tags":["Azure.VM.SQLServerDisk","AZR-000324"]},{"location":"en/rules/Azure.VM.SQLServerDisk/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Virtual Machines that pass this rule:</p> <ul> <li>Set the <code>properties.storageProfile.osDisk.managedDisk.storageAccountType</code> property to <code>Premium_LRS</code> or greater.</li> <li>Configure each data disk included in <code>properties.storageProfile.dataDisks</code> to use <code>Premium_LRS</code> or greater by setting the property <code>managedDisk.storageAccountType</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Compute/virtualMachines\",\n  \"apiVersion\": \"2022-03-01\",\n  \"name\": \"[parameters('virtualMachineName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"hardwareProfile\": {\n      \"vmSize\": \"[parameters('virtualMachineSize')]\"\n    },\n    \"storageProfile\": {\n      \"osDisk\": {\n        \"createOption\": \"FromImage\",\n        \"managedDisk\": {\n          \"storageAccountType\": \"Premium_LRS\"\n        },\n        \"diskSizeGB\": 127\n      },\n      \"imageReference\": {\n        \"publisher\": \"MicrosoftSQLServer\",\n        \"offer\": \"SQL2019-WS2019\",\n        \"sku\": \"Enterprise\",\n        \"version\": \"latest\"\n      },\n      \"dataDisks\": [\n        {\n          \"lun\": 0,\n          \"caching\": \"ReadOnly\",\n          \"createOption\": \"Empty\",\n          \"writeAcceleratorEnabled\": false,\n          \"managedDisk\": {\n            \"storageAccountType\": \"UltraSSD_LRS\"\n          },\n          \"diskSizeGB\": 1023\n        }\n      ]\n    },\n    \"networkProfile\": {\n      \"networkInterfaces\": [\n        {\n          \"id\": \"[resourceId('Microsoft.Network/networkInterfaces', variables('networkInterfaceName'))]\"\n        }\n      ]\n    },\n    \"osProfile\": {\n      \"computerName\": \"[parameters('virtualMachineName')]\",\n      \"adminUsername\": \"[parameters('adminUsername')]\",\n      \"adminPassword\": \"[parameters('adminPassword')]\",\n      \"windowsConfiguration\": {\n        \"enableAutomaticUpdates\": true,\n        \"provisionVMAgent\": true\n      }\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Network/networkInterfaces', variables('networkInterfaceName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.VM.SQLServerDisk","AZR-000324"]},{"location":"en/rules/Azure.VM.SQLServerDisk/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Virtual Machines that pass this rule:</p> <ul> <li>Set the <code>properties.storageProfile.osDisk.managedDisk.storageAccountType</code> property to <code>Premium_LRS</code> or greater.</li> <li>Configure each data disk included in <code>properties.storageProfile.dataDisks</code> to use <code>Premium_LRS</code> or greater by setting the property <code>managedDisk.storageAccountType</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource virtualMachine 'Microsoft.Compute/virtualMachines@2022-03-01' = {\n  name: virtualMachineName\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: virtualMachineSize\n    }\n    storageProfile: {\n      osDisk: {\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: 'Premium_LRS'\n        }\n        diskSizeGB: 127\n      }\n      imageReference: {\n        publisher: 'MicrosoftSQLServer'\n        offer: 'SQL2019-WS2019'\n        sku: 'Enterprise'\n        version: 'latest'\n      }\n      dataDisks: [\n        {\n          lun: 0\n          caching: 'ReadOnly'\n          createOption: 'Empty'\n          writeAcceleratorEnabled: false\n          managedDisk: {\n            storageAccountType: 'UltraSSD_LRS'\n          }\n          diskSizeGB: 1023\n        }\n      ]\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: networkInterface.id\n        }\n      ]\n    }\n    osProfile: {\n      computerName: virtualMachineName\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n      windowsConfiguration: {\n        enableAutomaticUpdates: true\n        provisionVMAgent: true\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.VM.SQLServerDisk","AZR-000324"]},{"location":"en/rules/Azure.VM.SQLServerDisk/#notes","title":"Notes","text":"<p>This rule is only applicable for OS disk and data disks configured with the property <code>properties.storageProfile.osDisk.managedDisk.storageAccountType</code> and the property <code>properties.storageProfile.dataDisks.managedDisk.storageAccountType</code>.</p> <p>Resources declarations can therefore pass the rule which are using not using Premium disks or above.</p>","tags":["Azure.VM.SQLServerDisk","AZR-000324"]},{"location":"en/rules/Azure.VM.SQLServerDisk/#links","title":"Links","text":"<ul> <li>Design for performance</li> <li>Performance best practices for SQL Server on Azure VMs</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.SQLServerDisk","AZR-000324"]},{"location":"en/rules/Azure.VM.ScriptExtensions/","title":"Securely pass secrets to Custom Script Extensions for Virtual Machine","text":"Azure.VM.ScriptExtensionsAZR-000332Error <p> Security  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Custom Script Extensions scripts that reference secret values must use the protectedSettings.</p>","tags":["Azure.VM.ScriptExtensions","AZR-000332"]},{"location":"en/rules/Azure.VM.ScriptExtensions/#description","title":"Description","text":"<p>Virtual Machines support the ability to execute custom scripts on launch. This can be configured via user data and custom script extensions. When the template is rendered, anything in the settings section will be rendered in clear text. To ensure they're kept secret, use the protectedSettings section instead.</p>","tags":["Azure.VM.ScriptExtensions","AZR-000332"]},{"location":"en/rules/Azure.VM.ScriptExtensions/#recommendation","title":"Recommendation","text":"<p>Consider specifying secure values within <code>protectedSettings</code> to avoid exposing secrets during extension deployments.</p>","tags":["Azure.VM.ScriptExtensions","AZR-000332"]},{"location":"en/rules/Azure.VM.ScriptExtensions/#examples","title":"Examples","text":"","tags":["Azure.VM.ScriptExtensions","AZR-000332"]},{"location":"en/rules/Azure.VM.ScriptExtensions/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy VM extensions that pass this rule:</p> <ul> <li>Set any secure values within <code>properties.protectedSettings</code>.</li> </ul> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\n  \"name\": \"installcustomscript\",\n  \"apiVersion\": \"2015-06-15\",\n  \"location\": \"australiaeast\",\n  \"properties\": {\n    \"publisher\": \"Microsoft.Azure.Extensions\",\n    \"type\": \"CustomScript\",\n    \"typeHandlerVersion\": \"2.0\",\n    \"autoUpgradeMinorVersion\": true,\n    \"protectedSettings\": {\n        \"commandToExecute\": \"Write-Output 'hello-world'\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.VM.ScriptExtensions","AZR-000332"]},{"location":"en/rules/Azure.VM.ScriptExtensions/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy VM extensions that pass this rule:</p> <ul> <li>Set any secure values within <code>properties.protectedSettings</code>.</li> </ul> Azure Bicep snippet<pre><code>resource script 'Microsoft.Compute/virtualMachines/extensions@2015-06-15' = {\n  name: 'installcustomscript'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.Extensions'\n    type: 'CustomScript'\n    typeHandlerVersion: '2.0'\n    autoUpgradeMinorVersion: true\n    protectedSettings: {\n        commandToExecute: 'Write-Output \"hello-world\"'\n    }\n  }\n}\n</code></pre>","tags":["Azure.VM.ScriptExtensions","AZR-000332"]},{"location":"en/rules/Azure.VM.ScriptExtensions/#links","title":"Links","text":"<ul> <li>SE:02 Secured development lifecycle</li> <li>Windows Custom Script Extensions</li> <li>Linux Custom Script Extensions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.ScriptExtensions","AZR-000332"]},{"location":"en/rules/Azure.VM.ShouldNotBeStopped/","title":"VMs should not be stopped state","text":"Azure.VM.ShouldNotBeStoppedAZR-000351Error <p> Cost Optimization  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2023_03  \u00b7  Important</p> <p>Azure VMs should be running or in a deallocated state.</p>","tags":["Azure.VM.ShouldNotBeStopped","AZR-000351"]},{"location":"en/rules/Azure.VM.ShouldNotBeStopped/#description","title":"Description","text":"<p>Azure Virtual Machines in a stopped state are still billed hourly for compute usage. Therefor VMs should generally be in a deallocated or running state.</p>","tags":["Azure.VM.ShouldNotBeStopped","AZR-000351"]},{"location":"en/rules/Azure.VM.ShouldNotBeStopped/#recommendation","title":"Recommendation","text":"<p>Consider fully de-allocating VMs instead of stopping VMs to reduce cost.</p>","tags":["Azure.VM.ShouldNotBeStopped","AZR-000351"]},{"location":"en/rules/Azure.VM.ShouldNotBeStopped/#notes","title":"Notes","text":"<p>This rule applies when analyzing resources deployed (in-flight) to Azure.</p>","tags":["Azure.VM.ShouldNotBeStopped","AZR-000351"]},{"location":"en/rules/Azure.VM.ShouldNotBeStopped/#links","title":"Links","text":"<ul> <li>CO:07 Component costs</li> <li>States and billing status of Azure Virtual Machines</li> </ul>","tags":["Azure.VM.ShouldNotBeStopped","AZR-000351"]},{"location":"en/rules/Azure.VM.Standalone/","title":"Standalone Virtual Machine","text":"Azure.VM.StandaloneAZR-000239Error <p> Reliability  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Use VM features to increase reliability and improve covered SLA for VM configurations.</p>","tags":["Azure.VM.Standalone","AZR-000239"]},{"location":"en/rules/Azure.VM.Standalone/#description","title":"Description","text":"<p>All VM configurations within Azure offer an SLA. However, the SLA provided and the overall availability of the system varies depending on the configuration.</p> <p>First, consider performing a Failure Mode Analysis (FMA) of the system. A FMA is the process of analyzing the system to determine the possible failure points.</p> <p>For Virtual Machines (VMs), running a single instance is often a single point of failure. In many but not all cases, the number of VMs can be increased to add redundancy to the system. Taking advantage of some of the features of Azure can further increase the availability of the system.</p> <ul> <li>Availability Zones (AZ) - is a physically separate zone, within an Azure region.   Each Availability Zone has a distinct power source, network, and cooling.</li> <li>Availability Sets - is a logical grouping of VMs that allows Azure to understand how your application is built.   By understanding the distinct tiers of the application, Azure can better organize compute and storage to improve availability.</li> <li>Solid State Storage (SSD) Disks - high performance block-level storage with three replicas of your data.</li> </ul>","tags":["Azure.VM.Standalone","AZR-000239"]},{"location":"en/rules/Azure.VM.Standalone/#recommendation","title":"Recommendation","text":"<p>Consider using availability zones/ sets or only premium/ ultra disks to improve SLA.</p>","tags":["Azure.VM.Standalone","AZR-000239"]},{"location":"en/rules/Azure.VM.Standalone/#examples","title":"Examples","text":"","tags":["Azure.VM.Standalone","AZR-000239"]},{"location":"en/rules/Azure.VM.Standalone/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy VMs that pass this rule with on of the following:</p> <ul> <li>Deploy the VM in an Availability Set by specifying <code>properties.availabilitySet.id</code> in code.</li> <li>Deploy the VM in an Availability Zone by specifying <code>zones</code> with <code>1</code>, <code>2</code>, or <code>3</code> in code.</li> <li>Deploy the VM using only premium disks for OS and data disks by specifying <code>storageAccountType</code> as <code>Premium_LRS</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"type\": \"Microsoft.Compute/virtualMachines\",\n    \"apiVersion\": \"2022-03-01\",\n    \"name\": \"[parameters('name')]\",\n    \"location\": \"[parameters('location')]\",\n    \"zones\": [\n        \"1\"\n    ],\n    \"properties\": {\n        \"hardwareProfile\": {\n            \"vmSize\": \"Standard_D2s_v3\"\n        },\n        \"osProfile\": {\n            \"computerName\": \"[parameters('name')]\",\n            \"adminUsername\": \"[parameters('adminUsername')]\",\n            \"adminPassword\": \"[parameters('adminPassword')]\"\n        },\n        \"storageProfile\": {\n            \"imageReference\": {\n                \"publisher\": \"MicrosoftWindowsServer\",\n                \"offer\": \"WindowsServer\",\n                \"sku\": \"[parameters('sku')]\",\n                \"version\": \"latest\"\n            },\n            \"osDisk\": {\n                \"name\": \"[format('{0}-disk0', parameters('name'))]\",\n                \"caching\": \"ReadWrite\",\n                \"createOption\": \"FromImage\",\n                \"managedDisk\": {\n                    \"storageAccountType\": \"Premium_LRS\"\n                }\n            }\n        },\n        \"licenseType\": \"Windows_Server\",\n        \"networkProfile\": {\n            \"networkInterfaces\": [\n                {\n                    \"id\": \"[resourceId('Microsoft.Network/networkInterfaces', format('{0}-nic0', parameters('name')))]\"\n                }\n            ]\n        }\n    },\n    \"dependsOn\": [\n        \"[resourceId('Microsoft.Network/networkInterfaces', format('{0}-nic0', parameters('name')))]\"\n    ]\n}\n</code></pre>","tags":["Azure.VM.Standalone","AZR-000239"]},{"location":"en/rules/Azure.VM.Standalone/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy VMs that pass this rule with on of the following:</p> <ul> <li>Deploy the VM in an Availability Set by specifying <code>properties.availabilitySet.id</code> in code.</li> <li>Deploy the VM in an Availability Zone by specifying <code>zones</code> with <code>1</code>, <code>2</code>, or <code>3</code> in code.</li> <li>Deploy the VM using only premium disks for OS and data disks by specifying <code>storageAccountType</code> as <code>Premium_LRS</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vm1 'Microsoft.Compute/virtualMachines@2022-03-01' = {\n  name: name\n  location: location\n  zones: [\n    '1'\n  ]\n  properties: {\n    hardwareProfile: {\n      vmSize: 'Standard_D2s_v3'\n    }\n    osProfile: {\n      computerName: name\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: sku\n        version: 'latest'\n      }\n      osDisk: {\n        name: '${name}-disk0'\n        caching: 'ReadWrite'\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: 'Premium_LRS'\n        }\n      }\n    }\n    licenseType: 'Windows_Server'\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: nic.id\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.VM.Standalone","AZR-000239"]},{"location":"en/rules/Azure.VM.Standalone/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Virtual Machine SLA</li> <li>Availability options for virtual machines in Azure</li> <li>Manage the availability of Windows virtual machines in Azure</li> <li>Manage the availability of Linux virtual machines</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.Standalone","AZR-000239"]},{"location":"en/rules/Azure.VM.Updates/","title":"Automatic updates are enabled","text":"Azure.VM.UpdatesAZR-000247Error <p> Security  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Ensure automatic updates are enabled at deployment.</p>","tags":["Azure.VM.Updates","AZR-000247"]},{"location":"en/rules/Azure.VM.Updates/#description","title":"Description","text":"<p>Window virtual machines (VMs) have automatic updates turned on at deployment time by default. The option can be enabled/ disabled at deployment time or updated for VM scale sets.</p> <p>Enabling this option does not prevent automatic updates being disabled or reconfigured within the operating system after deployment.</p>","tags":["Azure.VM.Updates","AZR-000247"]},{"location":"en/rules/Azure.VM.Updates/#recommendation","title":"Recommendation","text":"<p>Enable automatic updates at deployment time, then reconfigure as required to meet patch management requirements.</p>","tags":["Azure.VM.Updates","AZR-000247"]},{"location":"en/rules/Azure.VM.Updates/#links","title":"Links","text":"<ul> <li>SE:08 Hardening resources</li> <li>Automatic Guest Patching for Azure Virtual Machines and Scale Sets</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.Updates","AZR-000247"]},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/","title":"Use Azure Hybrid Benefit","text":"Azure.VM.UseHybridUseBenefitAZR-000243Error <p> Cost Optimization  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads.</p>","tags":["Azure.VM.UseHybridUseBenefit","AZR-000243"]},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/#description","title":"Description","text":"<p>The running cost of Virtual machine (VM) workloads in Azure is composed of several components, including:</p> <ul> <li>Compute usage for the VM size and image billed per second of run time, which may include:<ul> <li>Base compute rate for the VM size.</li> <li>Software included on the VM image billed per second of run time, such as Windows Server or SQL Server.</li> </ul> </li> <li>Storage usage for the VM disks.</li> <li>Network usage for data transfer in and out of the VM.</li> <li>Usage of other supporting Azure resources, such as load balancers, public IP addresses, or log ingestion.</li> <li>Licensing costs for other software installed on the VM.</li> </ul> <p>Azure Hybrid Benefit is a licensing benefit that helps you to reduce your overall cost of ownership. With Azure Hybrid Benefit you to use your existing on-premises licenses to pay a reduced rate on Azure.</p> <p>When Azure Hybrid Benefit enabled on supported VM images:</p> <ul> <li>The billing rate for the VM is adjusted to the base compute rate.</li> <li>You must separately have eligible licenses, such as Windows Server or SQL Server because Azure does not include these anymore.</li> </ul> <p>For additional information on Azure Hybrid Benefit, see the Azure Hybrid Benefit FAQ.</p>","tags":["Azure.VM.UseHybridUseBenefit","AZR-000243"]},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/#recommendation","title":"Recommendation","text":"<p>Consider using Azure Hybrid Benefit for eligible virtual machine (VM) workloads.</p>","tags":["Azure.VM.UseHybridUseBenefit","AZR-000243"]},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/#examples","title":"Examples","text":"","tags":["Azure.VM.UseHybridUseBenefit","AZR-000243"]},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy VMs that pass this rule:</p> <ul> <li>Set the <code>properties.licenseType</code> property to one of the following:<ul> <li><code>Windows_Server</code></li> <li><code>Windows_Client</code></li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Compute/virtualMachines\",\n  \"apiVersion\": \"2023-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"zones\": [\n    \"1\"\n  ],\n  \"properties\": {\n    \"hardwareProfile\": {\n      \"vmSize\": \"Standard_D2s_v3\"\n    },\n    \"osProfile\": {\n      \"computerName\": \"[parameters('name')]\",\n      \"adminUsername\": \"[parameters('adminUsername')]\",\n      \"adminPassword\": \"[parameters('adminPassword')]\"\n    },\n    \"storageProfile\": {\n      \"imageReference\": {\n        \"publisher\": \"MicrosoftWindowsServer\",\n        \"offer\": \"WindowsServer\",\n        \"sku\": \"[parameters('sku')]\",\n        \"version\": \"latest\"\n      },\n      \"osDisk\": {\n        \"name\": \"[format('{0}-disk0', parameters('name'))]\",\n        \"caching\": \"ReadWrite\",\n        \"createOption\": \"FromImage\",\n        \"managedDisk\": {\n          \"storageAccountType\": \"Premium_LRS\"\n        }\n      }\n    },\n    \"licenseType\": \"Windows_Server\",\n    \"networkProfile\": {\n      \"networkInterfaces\": [\n        {\n          \"id\": \"[resourceId('Microsoft.Network/networkInterfaces', parameters('nicName'))]\"\n        }\n      ]\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Network/networkInterfaces', parameters('nicName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.VM.UseHybridUseBenefit","AZR-000243"]},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy VMs that pass this rule:</p> <ul> <li>Set the <code>properties.licenseType</code> property to one of the following:<ul> <li><code>Windows_Server</code></li> <li><code>Windows_Client</code></li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vm_with_benefit 'Microsoft.Compute/virtualMachines@2023-09-01' = {\n  name: name\n  location: location\n  zones: [\n    '1'\n  ]\n  properties: {\n    hardwareProfile: {\n      vmSize: 'Standard_D2s_v3'\n    }\n    osProfile: {\n      computerName: name\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: sku\n        version: 'latest'\n      }\n      osDisk: {\n        name: '${name}-disk0'\n        caching: 'ReadWrite'\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: 'Premium_LRS'\n        }\n      }\n    }\n    licenseType: 'Windows_Server'\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: nic.id\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.VM.UseHybridUseBenefit","AZR-000243"]},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az vm update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --set licenseType=Windows_Server\n</code></pre>","tags":["Azure.VM.UseHybridUseBenefit","AZR-000243"]},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/#notes","title":"Notes","text":"<p>This rule is not processed by default. To enable this rule, set the <code>AZURE_VM_USE_AZURE_HYBRID_BENEFIT</code> configuration value to <code>true</code>.</p> <p>For example:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_VM_USE_AZURE_HYBRID_BENEFIT: true\n</code></pre> <p>The following limitations currently apply:</p> <ul> <li>This rule only applies to Azure Hybrid Benefit for Windows VMs.   Linux VM images are ignored.</li> </ul>","tags":["Azure.VM.UseHybridUseBenefit","AZR-000243"]},{"location":"en/rules/Azure.VM.UseHybridUseBenefit/#links","title":"Links","text":"<ul> <li>CO:05 Rate optimization</li> <li>Azure Hybrid Benefit FAQ</li> <li>Explore Azure Hybrid Benefit for Windows VMs</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.UseHybridUseBenefit","AZR-000243"]},{"location":"en/rules/Azure.VM.UseManagedDisks/","title":"Use Managed Disks","text":"Azure.VM.UseManagedDisksAZR-000238Error <p> Reliability  \u00b7  Virtual Machine  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Virtual machines (VMs) should use managed disks.</p>","tags":["Azure.VM.UseManagedDisks","AZR-000238"]},{"location":"en/rules/Azure.VM.UseManagedDisks/#description","title":"Description","text":"<p>VMs can be configured with un-managed or managed disks. Un-managed disks, are <code>.vhd</code> files stored on a Storage Account that you manage as files. Managed disks are the successor to un-managed disks and improve durability and availability of VMs by the following:</p> <ul> <li>Are designed for 99.999% availability.</li> <li>Are replicated using Locally Redundant Storage or Zone Redundant Storage to improve durability.</li> <li>Are aligned to the fault domains of VM availability sets.</li> <li>Add support for availability zones to VM disk storage.</li> </ul> <p>Additionally, managed disks provide the following benefits:</p> <ul> <li>Simplified management by allowing you to managed the VM disk as a Azure resource instead of a file.</li> <li>Improved security by providing granular access control using Azure Role-Based Access Control (RBAC).</li> </ul>","tags":["Azure.VM.UseManagedDisks","AZR-000238"]},{"location":"en/rules/Azure.VM.UseManagedDisks/#recommendation","title":"Recommendation","text":"<p>Consider using managed disks for virtual machine (VM) storage.</p>","tags":["Azure.VM.UseManagedDisks","AZR-000238"]},{"location":"en/rules/Azure.VM.UseManagedDisks/#examples","title":"Examples","text":"","tags":["Azure.VM.UseManagedDisks","AZR-000238"]},{"location":"en/rules/Azure.VM.UseManagedDisks/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy VMs that pass this rule:</p> <ul> <li>For operating system (OS) disks:<ul> <li>To create a new OS disk:<ol> <li>Set the <code>properties.storageProfile.osDisk.managedDisk.storageAccountType</code> property to valid storage type.</li> <li>Set the <code>properties.storageProfile.osDisk.createOption</code> property to <code>FromImage</code>.</li> </ol> </li> <li>To use an existing OS disk:<ol> <li>Set the <code>properties.storageProfile.osDisk.createOption</code> property to <code>Attach</code>.</li> <li>Set the <code>properties.storageProfile.osDisk.managedDisk.id</code> property to the resource ID of an existing disk resource.</li> </ol> </li> </ul> </li> <li>For data disks:<ul> <li>To create a new data disk:<ol> <li>Set the <code>properties.storageProfile.dataDisks[*].managedDisk.storageAccountType</code> property to valid storage type.</li> <li>Set the <code>properties.storageProfile.dataDisks[*].createOption</code> property to <code>Empty</code> or <code>FromImage</code>.</li> </ol> </li> <li>To use an existing data disk:<ol> <li>Set the <code>properties.storageProfile.dataDisks[*].managedDisk.id</code> property to the resource ID of an existing disk resource.</li> <li>Set the <code>properties.storageProfile.dataDisks[*].createOption</code> property to <code>Attach</code>.</li> </ol> </li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Compute/virtualMachines\",\n  \"apiVersion\": \"2023-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"zones\": [\n    \"1\"\n  ],\n  \"properties\": {\n    \"hardwareProfile\": {\n      \"vmSize\": \"Standard_D2s_v3\"\n    },\n    \"osProfile\": {\n      \"computerName\": \"[parameters('name')]\",\n      \"adminUsername\": \"[parameters('adminUsername')]\",\n      \"adminPassword\": \"[parameters('adminPassword')]\"\n    },\n    \"storageProfile\": {\n      \"imageReference\": {\n        \"publisher\": \"MicrosoftWindowsServer\",\n        \"offer\": \"WindowsServer\",\n        \"sku\": \"[parameters('sku')]\",\n        \"version\": \"latest\"\n      },\n      \"osDisk\": {\n        \"name\": \"[format('{0}-disk0', parameters('name'))]\",\n        \"caching\": \"ReadWrite\",\n        \"createOption\": \"FromImage\",\n        \"managedDisk\": {\n          \"storageAccountType\": \"Premium_LRS\"\n        }\n      },\n      \"dataDisks\": [\n        {\n          \"createOption\": \"Attach\",\n          \"lun\": 0,\n          \"managedDisk\": {\n            \"id\": \"[parameters('dataDiskId')]\"\n          }\n        }\n      ]\n    },\n    \"networkProfile\": {\n      \"networkInterfaces\": [\n        {\n          \"id\": \"[resourceId('Microsoft.Network/networkInterfaces', parameters('nicName'))]\"\n        }\n      ]\n    }\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Network/networkInterfaces', parameters('nicName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.VM.UseManagedDisks","AZR-000238"]},{"location":"en/rules/Azure.VM.UseManagedDisks/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy VMs that pass this rule:</p> <ul> <li>For operating system (OS) disks:<ul> <li>To create a new OS disk:<ol> <li>Set the <code>properties.storageProfile.osDisk.managedDisk.storageAccountType</code> property to valid storage type.</li> <li>Set the <code>properties.storageProfile.osDisk.createOption</code> property to <code>FromImage</code>.</li> </ol> </li> <li>To use an existing OS disk:<ol> <li>Set the <code>properties.storageProfile.osDisk.createOption</code> property to <code>Attach</code>.</li> <li>Set the <code>properties.storageProfile.osDisk.managedDisk.id</code> property to the resource ID of an existing disk resource.</li> </ol> </li> </ul> </li> <li>For data disks:<ul> <li>To create a new data disk:<ol> <li>Set the <code>properties.storageProfile.dataDisks[*].managedDisk.storageAccountType</code> property to valid storage type.</li> <li>Set the <code>properties.storageProfile.dataDisks[*].createOption</code> property to <code>Empty</code> or <code>FromImage</code>.</li> </ol> </li> <li>To use an existing data disk:<ol> <li>Set the <code>properties.storageProfile.dataDisks[*].managedDisk.id</code> property to the resource ID of an existing disk resource.</li> <li>Set the <code>properties.storageProfile.dataDisks[*].createOption</code> property to <code>Attach</code>.</li> </ol> </li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vm 'Microsoft.Compute/virtualMachines@2023-09-01' = {\n  name: name\n  location: location\n  zones: [\n    '1'\n  ]\n  properties: {\n    hardwareProfile: {\n      vmSize: 'Standard_D2s_v3'\n    }\n    osProfile: {\n      computerName: name\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: sku\n        version: 'latest'\n      }\n      osDisk: {\n        name: '${name}-disk0'\n        caching: 'ReadWrite'\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: 'Premium_LRS'\n        }\n      }\n      dataDisks: [\n        {\n          createOption: 'Attach'\n          lun: 0\n          managedDisk: {\n            id: dataDiskId\n          }\n        }\n      ]\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: nic.id\n        }\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.VM.UseManagedDisks","AZR-000238"]},{"location":"en/rules/Azure.VM.UseManagedDisks/#configure-with-azure-policy","title":"Configure with Azure Policy","text":"<p>To address this issue at runtime use the following policies:</p> <ul> <li>Audit VMs that do not use managed disks <code>/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a4d</code>.</li> </ul>","tags":["Azure.VM.UseManagedDisks","AZR-000238"]},{"location":"en/rules/Azure.VM.UseManagedDisks/#links","title":"Links","text":"<ul> <li>RE:01 Simplicity and efficiency</li> <li>Introduction to Azure managed disks</li> <li>Reliability in Virtual Machines</li> <li>Using disks in Azure Resource Manager Templates</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VM.UseManagedDisks","AZR-000238"]},{"location":"en/rules/Azure.VMSS.AMA/","title":"Use Azure Monitor Agent","text":"Azure.VMSS.AMAAZR-000346Error <p> Operational Excellence  \u00b7  Virtual Machine Scale Sets  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Use Azure Monitor Agent for collecting monitoring data from VM scale sets.</p>","tags":["Azure.VMSS.AMA","AZR-000346"]},{"location":"en/rules/Azure.VMSS.AMA/#description","title":"Description","text":"<p>Azure Monitor Agent (AMA) collects monitoring data from the guest operating system of virtual machine scale sets (VMSS) instances. Data collected gets delivered to Azure Monitor for use by features, insights and other services, such as Microsoft Defender for Cloud.</p> <p>Azure Monitor Agent replaces all of Azure Monitor's legacy monitoring agents.</p>","tags":["Azure.VMSS.AMA","AZR-000346"]},{"location":"en/rules/Azure.VMSS.AMA/#recommendation","title":"Recommendation","text":"<p>Consider monitoring Virtual Machine Scale Sets instances using the Azure Monitor Agent.</p>","tags":["Azure.VMSS.AMA","AZR-000346"]},{"location":"en/rules/Azure.VMSS.AMA/#examples","title":"Examples","text":"","tags":["Azure.VMSS.AMA","AZR-000346"]},{"location":"en/rules/Azure.VMSS.AMA/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy virtual machine scale sets that pass this rule:</p> <ul> <li>Set <code>properties.virtualMachineProfile.extensionProfile.extensions.properties.publisher</code> to <code>Microsoft.Azure.Monitor</code>.</li> <li>Set <code>properties.virtualMachineProfile.extensionProfile.extensions.properties.type</code> to <code>AzureMonitorWindowsAgent</code> (Windows) or <code>AzureMonitorLinuxAgent</code> (Linux).</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"vmssName\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"vmss-01\"\n    },\n    \"location\": {\n      \"type\": \"string\"\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.Compute/virtualMachineScaleSets\",\n      \"apiVersion\": \"2022-08-01\",\n      \"name\": \"[parameters('vmssName')]\",\n      \"location\": \"[parameters('location')]\",\n      \"sku\": {\n        \"name\": \"b2ms\",\n        \"tier\": \"Standard\",\n        \"capacity\": 1\n      },\n      \"properties\": {\n        \"overprovision\": true,\n        \"upgradePolicy\": {\n          \"mode\": \"Automatic\"\n        },\n        \"singlePlacementGroup\": true,\n        \"platformFaultDomainCount\": 3,\n        \"virtualMachineProfile\": {\n          \"extensionProfile\": {\n            \"extensions\": [\n              {\n                \"name\": \"[format('{0}/AzureMonitorLinuxAgent', parameters('vmssName'))]\",\n                \"properties\": {\n                  \"autoUpgradeMinorVersion\": true,\n                  \"enableAutomaticUpgrade\": true,\n                  \"publisher\": \"Microsoft.Azure.Monitor\",\n                  \"type\": \"AzureMonitorLinuxAgent\",\n                  \"typeHandlerVersion\": \"1.21\"\n                }\n              }\n            ]\n          },\n          \"storageProfile\": {\n            \"osDisk\": {\n              \"caching\": \"ReadWrite\",\n              \"createOption\": \"FromImage\"\n            },\n            \"imageReference\": {\n              \"publisher\": \"microsoft-aks\",\n              \"offer\": \"aks\",\n              \"sku\": \"aks-ubuntu-1804-202208\",\n              \"version\": \"2022.08.29\"\n            }\n          },\n          \"osProfile\": {\n            \"adminUsername\": \"azureuser\",\n            \"computerNamePrefix\": \"vmss-01\",\n            \"linuxConfiguration\": {\n              \"disablePasswordAuthentication\": true\n            },\n            \"provisionVMAgent\": true,\n            \"ssh\": {\n              \"publicKeys\": [\n                {\n                  \"path\": \"/home/azureuser/.ssh/authorized_keys\"\n                }\n              ]\n            }\n          },\n          \"networkProfile\": {\n            \"networkInterfaceConfigurations\": [\n              {\n                \"name\": \"vmss-001\",\n                \"properties\": {\n                  \"primary\": true,\n                  \"enableAcceleratedNetworking\": true,\n                  \"networkSecurityGroup\": {\n                    \"id\": \"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.Network/networkSecurityGroups/nsg-001\"\n                  },\n                  \"ipConfigurations\": [\n                    {\n                      \"name\": \"ipconfig1\",\n                      \"properties\": {\n                        \"primary\": true,\n                        \"subnet\": {\n                          \"id\": \"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/vnet-001/subnets/subnet-001\"\n                        },\n                        \"privateIPAddressVersion\": \"IPv4\",\n                        \"loadBalancerBackendAddressPools\": [\n                          {\n                            \"id\": \"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.Network/loadBalancers/kubernetes/backendAddressPools/kubernetes\"\n                          }\n                        ]\n                      }\n                    }\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      }\n    }\n  ]\n}\n</code></pre> <p>To deploy virtual machine scale sets with a extension sub resource that pass this rule:</p> <ul> <li>Deploy a extension sub-resource <code>Microsoft.Compute/virtualMachines/extensions</code>.</li> <li>Set <code>properties.publisher</code> to <code>Microsoft.Azure.Monitor</code>.</li> <li>Set <code>properties.type</code> to <code>AzureMonitorWindowsAgent</code> (Windows) or <code>AzureMonitorLinuxAgent</code> (Linux).</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"vmssName\": {\n      \"type\": \"string\"\n    },\n    \"location\": {\n      \"type\": \"string\"\n    },\n    \"userAssignedManagedIdentity\": {\n      \"type\": \"string\"\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\n      \"apiVersion\": \"2022-08-01\",\n      \"name\": \"[format('{0}/AzureMonitorLinuxAgent', parameters('vmssName'))]\",\n      \"location\": \"[parameters('location')]\",\n      \"properties\": {\n        \"publisher\": \"Microsoft.Azure.Monitor\",\n        \"type\": \"AzureMonitorLinuxAgent\",\n        \"typeHandlerVersion\": \"1.21\",\n          \"settings\": {\n          \"authentication\": {\n            \"managedIdentity\": {\n              \"identifier-name\": \"mi_res_id\",\n              \"identifier-value\": \"[parameters('userAssignedManagedIdentity')]\"\n            }\n          }\n        },\n        \"autoUpgradeMinorVersion\": true,\n        \"enableAutomaticUpgrade\": true\n      }\n    }\n  ]\n}\n</code></pre>","tags":["Azure.VMSS.AMA","AZR-000346"]},{"location":"en/rules/Azure.VMSS.AMA/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy virtual machine scale sets that pass this rule:</p> <ul> <li>Set <code>properties.virtualMachineProfile.extensionProfile.extensions.properties.publisher</code> to <code>Microsoft.Azure.Monitor</code>.</li> <li>Set <code>properties.virtualMachineProfile.extensionProfile.extensions.properties.type</code> to <code>AzureMonitorWindowsAgent</code> (Windows) or <code>AzureMonitorLinuxAgent</code> (Linux).</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>param vmssName string = 'vmss-01'\nparam location string\n\nresource vmScaleSet 'Microsoft.Compute/virtualMachineScaleSets@2022-08-01' = {\n  name: vmssName\n  location: location\n  sku: {\n    name: 'b2ms'\n    tier: 'Standard'\n    capacity: 1\n  }\n  properties: {\n    overprovision: true\n    upgradePolicy: {\n      mode: 'Automatic'\n    }\n    singlePlacementGroup: true\n    platformFaultDomainCount: 3\n    virtualMachineProfile: {\n      extensionProfile: {\n        extensions: [\n          {\n            name: '${vmssName}/AzureMonitorLinuxAgent'\n\n            properties: {\n              autoUpgradeMinorVersion: true\n              enableAutomaticUpgrade: true\n              publisher: 'Microsoft.Azure.Monitor'\n              type: 'AzureMonitorLinuxAgent'\n              typeHandlerVersion: '1.21'\n            }\n          }\n        ]\n      }\n      storageProfile: {\n        osDisk: {\n          caching: 'ReadWrite'\n          createOption: 'FromImage'\n        }\n        imageReference: {\n          publisher: 'microsoft-aks'\n          offer: 'aks'\n          sku: 'aks-ubuntu-1804-202208'\n          version: '2022.08.29'\n        }\n      }\n      osProfile: {\n        adminUsername: 'azureuser'\n        computerNamePrefix: 'vmss-01'\n        linuxConfiguration: {\n          disablePasswordAuthentication: true\n        }\n        provisionVMAgent: true\n        ssh: {\n          publicKeys: [\n            {\n              path: '/home/azureuser/.ssh/authorized_keys'\n            }\n          ]\n        }\n      }\n      networkProfile: {\n        networkInterfaceConfigurations: [\n          {\n            name: 'vmss-001'\n            properties: {\n              primary: true\n              enableAcceleratedNetworking: true\n              networkSecurityGroup: {\n                id: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.Network/networkSecurityGroups/nsg-001'\n              }\n              ipConfigurations: [\n                {\n                  name: 'ipconfig1'\n                  properties: {\n                    primary: true\n                    subnet: {\n                      id: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/vnet-001/subnets/subnet-001'\n                    }\n                    privateIPAddressVersion: 'IPv4'\n                    loadBalancerBackendAddressPools: [\n                      {\n                        id: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.Network/loadBalancers/kubernetes/backendAddressPools/kubernetes'\n                      }\n                    ]\n                  }\n                }\n              ]\n            }\n          }\n        ]\n      }\n    }\n  }\n}\n</code></pre> <p>To deploy virtual machine scale sets with a extension sub resource that pass this rule:</p> <ul> <li>Deploy a extension sub-resource <code>Microsoft.Compute/virtualMachines/extensions</code>.</li> <li>Set <code>properties.publisher</code> to <code>Microsoft.Azure.Monitor</code>.</li> <li>Set <code>properties.type</code> to <code>AzureMonitorWindowsAgent</code> (Windows) or <code>AzureMonitorLinuxAgent</code> (Linux).</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>param vmssName string\nparam location string\nparam userAssignedManagedIdentity string\n\nresource linuxAgent 'Microsoft.Compute/virtualMachineScaleSets/extensions@2022-08-01' = {\n  name: '${vmssName}/AzureMonitorLinuxAgent'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.Monitor'\n    type: 'AzureMonitorLinuxAgent'\n    typeHandlerVersion: '1.21'\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n    settings: {\n      authentication: {\n        managedIdentity: {\n          identifier-name: 'mi_res_id'\n          identifier-value: userAssignedManagedIdentity\n        }\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.VMSS.AMA","AZR-000346"]},{"location":"en/rules/Azure.VMSS.AMA/#notes","title":"Notes","text":"<p>The Azure Monitor Agent (AMA) itself does not include all configuration needed, additionally data collection rules and associations are required.</p>","tags":["Azure.VMSS.AMA","AZR-000346"]},{"location":"en/rules/Azure.VMSS.AMA/#links","title":"Links","text":"<ul> <li>OE:07 Monitoring system</li> <li>Azure Monitor Agent overview</li> <li>Manage Azure Monitor Agent</li> <li>Azure virtual machine scale set deployment reference</li> <li>Azure extension deployment reference</li> </ul>","tags":["Azure.VMSS.AMA","AZR-000346"]},{"location":"en/rules/Azure.VMSS.AutoInstanceRepairs/","title":"Automatic instance repairs","text":"Azure.VMSS.AutoInstanceRepairsAZR-000426Error <p> Reliability  \u00b7  Virtual Machine Scale Sets  \u00b7  Rule  \u00b7  Preview  \u00b7  2024_06  \u00b7  Important</p> <p>Automatic instance repairs are enabled.</p>","tags":["Azure.VMSS.AutoInstanceRepairs","AZR-000426"]},{"location":"en/rules/Azure.VMSS.AutoInstanceRepairs/#description","title":"Description","text":"<p>Enabling automatic instance repairs helps to achieve high application availability by automatically detecting and recovering unhealthy VM instances at runtime.</p> <p>The automatic instance repair feature relies on health monitoring of individual VM instances in a scale set. VM Instances in a scale set can be configured to emit application health status using either the Application Health extension or Load balancer health probes. If an VM instance is found to be unhealthy, the scale set will perform a preconfigured repair action on the unhealthy VM instance. Automatic instance repairs can be enabled in the Virtual Machine Scale Set model by using the\u202f<code>automaticRepairsPolicy</code>\u202fobject.</p> <p>See documentation references below for additional limitations and important information.</p>","tags":["Azure.VMSS.AutoInstanceRepairs","AZR-000426"]},{"location":"en/rules/Azure.VMSS.AutoInstanceRepairs/#recommendation","title":"Recommendation","text":"<p>Consider enabling automatic instance repairs to achieve high application availability by maintaining a set of healthy VM instances.</p>","tags":["Azure.VMSS.AutoInstanceRepairs","AZR-000426"]},{"location":"en/rules/Azure.VMSS.AutoInstanceRepairs/#examples","title":"Examples","text":"","tags":["Azure.VMSS.AutoInstanceRepairs","AZR-000426"]},{"location":"en/rules/Azure.VMSS.AutoInstanceRepairs/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy virtual machine scale sets that pass this rule:</p> <ul> <li>Set the <code>properties.automaticRepairsPolicy.enabled</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Compute/virtualMachineScaleSets\",\n  \"apiVersion\": \"2023-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"b2ms\",\n    \"tier\": \"Standard\",\n    \"capacity\": 1\n  },\n  \"properties\": {\n    \"automaticRepairsPolicy\": {\n      \"enabled\": true\n    }\n  }\n}\n</code></pre>","tags":["Azure.VMSS.AutoInstanceRepairs","AZR-000426"]},{"location":"en/rules/Azure.VMSS.AutoInstanceRepairs/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy virtual machine scale sets that pass this rule:</p> <ul> <li>Set the <code>properties.automaticRepairsPolicy.enabled</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vmss 'Microsoft.Compute/virtualMachineScaleSets@2023-09-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'b2ms'\n    tier: 'Standard'\n    capacity: 1\n  }\n  properties: {\n    automaticRepairsPolicy: {\n      enabled: true\n    }\n  }\n}\n</code></pre>","tags":["Azure.VMSS.AutoInstanceRepairs","AZR-000426"]},{"location":"en/rules/Azure.VMSS.AutoInstanceRepairs/#notes","title":"Notes","text":"<p>This feature for virtual machine scale sets is currently in preview.</p> <p>In order for automatic repairs policy to work properly, ensure that all the requirements for opting in to this feature are met.</p>","tags":["Azure.VMSS.AutoInstanceRepairs","AZR-000426"]},{"location":"en/rules/Azure.VMSS.AutoInstanceRepairs/#links","title":"Links","text":"<ul> <li>RE:07 Self-preservation</li> <li>Automatic instance repairs</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.VMSS.AutoInstanceRepairs","AZR-000426"]},{"location":"en/rules/Azure.VMSS.AvailabilityZone/","title":"Deploy virtual machine scale set instances using availability zones","text":"Azure.VMSS.AvailabilityZoneAZR-000436Error <p> Reliability  \u00b7  Virtual Machine Scale Sets  \u00b7  Rule  \u00b7  2024_09  \u00b7  Important</p> <p>Deploy virtual machine scale set instances using availability zones in supported regions to ensure high availability and resilience.</p>","tags":["Azure.VMSS.AvailabilityZone","AZR-000436"]},{"location":"en/rules/Azure.VMSS.AvailabilityZone/#description","title":"Description","text":"<p>Virtual machine scale sets (VMSS) supports the use of availability zones to provide redundancy across physically separated zones. When new instances are added to the VMSS as it scales, these instances are deployed across any zones that are configured.</p> <p>For example:</p> <ul> <li>If the VMSS is configured to use only Zone 1, all new instances will be created in Zone 1.</li> <li>If the VMSS is configured to use three zones (Zone 1, Zone 2, and Zone 3), new instances will be distributed across these zones.</li> </ul> <p>Also note:</p> <ul> <li>Using availability zones is suitable for stateless workloads.</li> <li>During scale-in operations, the number of instances in each zone may not be evenly distributed for all zones.</li> </ul> <p>See documentation references below for additional limitations and important information.</p>","tags":["Azure.VMSS.AvailabilityZone","AZR-000436"]},{"location":"en/rules/Azure.VMSS.AvailabilityZone/#recommendation","title":"Recommendation","text":"<p>Consider configuring VM scale sets to spread instances across at least two (2) availability zones to improve resiliency to issues impacting a zone.</p>","tags":["Azure.VMSS.AvailabilityZone","AZR-000436"]},{"location":"en/rules/Azure.VMSS.AvailabilityZone/#examples","title":"Examples","text":"","tags":["Azure.VMSS.AvailabilityZone","AZR-000436"]},{"location":"en/rules/Azure.VMSS.AvailabilityZone/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To set availability zones for a virtual machine scale set:</p> <ul> <li>Set <code>zones</code> to a minimum of two zones from <code>[\"1\", \"2\", \"3\"]</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Compute/virtualMachineScaleSets\",\n  \"apiVersion\": \"2023-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"b2ms\",\n    \"tier\": \"Standard\",\n    \"capacity\": 3\n  },\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ]\n}\n</code></pre>","tags":["Azure.VMSS.AvailabilityZone","AZR-000436"]},{"location":"en/rules/Azure.VMSS.AvailabilityZone/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To set availability zones for a virtual machine scale set:</p> <ul> <li>Set <code>zones</code> to a minimum of two zones from <code>[\"1\", \"2\", \"3\"]</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vmss 'Microsoft.Compute/virtualMachineScaleSets@2023-09-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'b2ms'\n    tier: 'Standard'\n    capacity: 3\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n}\n</code></pre>","tags":["Azure.VMSS.AvailabilityZone","AZR-000436"]},{"location":"en/rules/Azure.VMSS.AvailabilityZone/#links","title":"Links","text":"<ul> <li>RE:05 Regions and availability zones</li> <li>Availability zone support for Virtual Machine Scale Set</li> <li>Azure regions with availability zone support</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.VMSS.AvailabilityZone","AZR-000436"]},{"location":"en/rules/Azure.VMSS.ComputerName/","title":"Use valid VMSS computer names","text":"Azure.VMSS.ComputerNameAZR-000262Error <p> Operational Excellence  \u00b7  Virtual Machine Scale Sets  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Virtual Machine Scale Set (VMSS) computer name should meet naming requirements.</p>","tags":["Azure.VMSS.ComputerName","AZR-000262"]},{"location":"en/rules/Azure.VMSS.ComputerName/#description","title":"Description","text":"<p>When configuring Azure VMSS the assigned computer name prefix must meet operation system (OS) requirements.</p> <p>The requirements for Windows VM instances are:</p> <ul> <li>Between 1 and 15 characters long.</li> <li>Alphanumerics, and hyphens.</li> <li>Can not include only numbers.</li> </ul> <p>The requirements for Linux VM instances are:</p> <ul> <li>Between 1 and 64 characters long.</li> <li>Alphanumerics, periods, and hyphens.</li> <li>Start with alphanumeric.</li> </ul>","tags":["Azure.VMSS.ComputerName","AZR-000262"]},{"location":"en/rules/Azure.VMSS.ComputerName/#recommendation","title":"Recommendation","text":"<p>Consider using computer names that meet OS naming requirements. Additionally, consider using computer names that match the VMSS resource name.</p>","tags":["Azure.VMSS.ComputerName","AZR-000262"]},{"location":"en/rules/Azure.VMSS.ComputerName/#notes","title":"Notes","text":"<p>VMSS resource names have different naming restrictions. See <code>Azure.VMSS.Name</code> for details.</p>","tags":["Azure.VMSS.ComputerName","AZR-000262"]},{"location":"en/rules/Azure.VMSS.ComputerName/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> </ul>","tags":["Azure.VMSS.ComputerName","AZR-000262"]},{"location":"en/rules/Azure.VMSS.MigrateAMA/","title":"Migrate to Azure Monitor Agent","text":"Azure.VMSS.MigrateAMAAZR-000318Error <p> Operational Excellence  \u00b7  Virtual Machine Scale Sets  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Use Azure Monitor Agent as replacement for Log Analytics Agent.</p>","tags":["Azure.VMSS.MigrateAMA","AZR-000318"]},{"location":"en/rules/Azure.VMSS.MigrateAMA/#description","title":"Description","text":"<p>The legacy Log Analytics agent will be retired on August 31, 2024. Before that date, you'll need to start using the Azure Monitor agent to monitor your virtual machine scale sets. The Azure Monitor agent provdes the following benefits over legacy agents:</p> <ul> <li>Security and performance<ul> <li>Enhanced security through Managed Identity and Azure Active Directory (Azure AD) tokens (for clients).</li> <li>A higher events-per-second (EPS) upload rate.</li> </ul> </li> <li>Cost savings by using data collection rules. Using DCRs is one of the most useful advantages of using Azure Monitor Agent:<ul> <li>DCRs let you configure data collection for specific machines connected to a workspace as compared to the \"all or nothing\" approach of legacy agents.</li> <li>With DCRs, you can define which data to ingest and which data to filter out to reduce workspace clutter and save on costs.</li> </ul> </li> <li>Simpler management of data collection, including ease of troubleshooting:<ul> <li>Easy multihoming on Windows and Linux.</li> <li>Centralized, \"in the cloud\" agent configuration makes every action simpler and more easily scalable throughout the data collection lifecycle, from onboarding to deployment to updates and changes over time.</li> <li>Greater transparency and control of more capabilities and services, such as Microsoft Sentinel, Defender for Cloud, and VM Insights.</li> </ul> </li> <li>A single agent that consolidates all features necessary to address all telemetry data collection needs across servers and client devices running Windows 10 or 11. A single agent is the goal, although Azure Monitor Agent currently converges with the Log Analytics agents.</li> </ul>","tags":["Azure.VMSS.MigrateAMA","AZR-000318"]},{"location":"en/rules/Azure.VMSS.MigrateAMA/#recommendation","title":"Recommendation","text":"<p>Virtual Machine Scale Sets should migrate to Azure Monitor Agent.</p>","tags":["Azure.VMSS.MigrateAMA","AZR-000318"]},{"location":"en/rules/Azure.VMSS.MigrateAMA/#examples","title":"Examples","text":"","tags":["Azure.VMSS.MigrateAMA","AZR-000318"]},{"location":"en/rules/Azure.VMSS.MigrateAMA/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy virtual machine scale sets that pass this rule:</p> <ul> <li>Set <code>properties.virtualMachineProfile.extensionProfile.extensions.properties.publisher</code> to <code>'Microsoft.Azure.Monitor'</code>.</li> <li>Set <code>properties.virtualMachineProfile.extensionProfile.extensions.properties.type</code> to <code>'AzureMonitorWindowsAgent'</code> (Windows) or <code>'AzureMonitorLinuxAgent'</code> (Linux).</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"vmssName\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"vmss-01\"\n    },\n    \"location\": {\n      \"type\": \"string\"\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.Compute/virtualMachineScaleSets\",\n      \"apiVersion\": \"2022-08-01\",\n      \"name\": \"[parameters('vmssName')]\",\n      \"location\": \"[parameters('location')]\",\n      \"sku\": {\n        \"name\": \"b2ms\",\n        \"tier\": \"Standard\",\n        \"capacity\": 1\n      },\n      \"properties\": {\n        \"overprovision\": true,\n        \"upgradePolicy\": {\n          \"mode\": \"Automatic\"\n        },\n        \"singlePlacementGroup\": true,\n        \"platformFaultDomainCount\": 3,\n        \"virtualMachineProfile\": {\n          \"extensionProfile\": {\n            \"extensions\": [\n              {\n                \"name\": \"[format('{0}/AzureMonitorLinuxAgent', parameters('vmssName'))]\",\n                \"properties\": {\n                  \"autoUpgradeMinorVersion\": true,\n                  \"enableAutomaticUpgrade\": true,\n                  \"publisher\": \"Microsoft.Azure.Monitor\",\n                  \"type\": \"AzureMonitorLinuxAgent\",\n                  \"typeHandlerVersion\": \"1.21\"\n                }\n              }\n            ]\n          },\n          \"storageProfile\": {\n            \"osDisk\": {\n              \"caching\": \"ReadWrite\",\n              \"createOption\": \"FromImage\"\n            },\n            \"imageReference\": {\n              \"publisher\": \"microsoft-aks\",\n              \"offer\": \"aks\",\n              \"sku\": \"aks-ubuntu-1804-202208\",\n              \"version\": \"2022.08.29\"\n            }\n          },\n          \"osProfile\": {\n            \"adminUsername\": \"azureuser\",\n            \"computerNamePrefix\": \"vmss-01\",\n            \"linuxConfiguration\": {\n              \"disablePasswordAuthentication\": true\n            },\n            \"provisionVMAgent\": true,\n            \"ssh\": {\n              \"publicKeys\": [\n                {\n                  \"path\": \"/home/azureuser/.ssh/authorized_keys\"\n                }\n              ]\n            }\n          },\n          \"networkProfile\": {\n            \"networkInterfaceConfigurations\": [\n              {\n                \"name\": \"vmss-001\",\n                \"properties\": {\n                  \"primary\": true,\n                  \"enableAcceleratedNetworking\": true,\n                  \"networkSecurityGroup\": {\n                    \"id\": \"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.Network/networkSecurityGroups/nsg-001\"\n                  },\n                  \"ipConfigurations\": [\n                    {\n                      \"name\": \"ipconfig1\",\n                      \"properties\": {\n                        \"primary\": true,\n                        \"subnet\": {\n                          \"id\": \"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/vnet-001/subnets/subnet-001\"\n                        },\n                        \"privateIPAddressVersion\": \"IPv4\",\n                        \"loadBalancerBackendAddressPools\": [\n                          {\n                            \"id\": \"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.Network/loadBalancers/kubernetes/backendAddressPools/kubernetes\"\n                          }\n                        ]\n                      }\n                    }\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      }\n    }\n  ]\n}\n</code></pre> <p>To deploy virtual machine scale sets with a extension sub resource that pass this rule:</p> <ul> <li>Deploy a extension sub-resource (extension resource).</li> <li>Set <code>properties.publisher</code> to <code>'Microsoft.Azure.Monitor'</code>.</li> <li>Set <code>properties.type</code> to <code>'AzureMonitorWindowsAgent'</code> (Windows) or <code>'AzureMonitorLinuxAgent'</code> (Linux).</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"vmssName\": {\n      \"type\": \"string\"\n    },\n    \"location\": {\n      \"type\": \"string\"\n    },\n    \"userAssignedManagedIdentity\": {\n      \"type\": \"string\"\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\n      \"apiVersion\": \"2022-08-01\",\n      \"name\": \"[format('{0}/AzureMonitorLinuxAgent', parameters('vmssName'))]\",\n      \"location\": \"[parameters('location')]\",\n      \"properties\": {\n        \"publisher\": \"Microsoft.Azure.Monitor\",\n        \"type\": \"AzureMonitorLinuxAgent\",\n        \"typeHandlerVersion\": \"1.21\",\n          \"settings\": {\n          \"authentication\": {\n            \"managedIdentity\": {\n              \"identifier-name\": \"mi_res_id\",\n              \"identifier-value\": \"[parameters('userAssignedManagedIdentity')]\"\n            }\n          }\n        },\n        \"autoUpgradeMinorVersion\": true,\n        \"enableAutomaticUpgrade\": true\n      }\n    }\n  ]\n}\n</code></pre>","tags":["Azure.VMSS.MigrateAMA","AZR-000318"]},{"location":"en/rules/Azure.VMSS.MigrateAMA/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy virtual machine scale sets that pass this rule:</p> <ul> <li>Set <code>properties.virtualMachineProfile.extensionProfile.extensions.properties.publisher</code> to <code>'Microsoft.Azure.Monitor'</code>.</li> <li>Set <code>properties.virtualMachineProfile.extensionProfile.extensions.properties.type</code> to <code>'AzureMonitorWindowsAgent'</code> (Windows) or <code>'AzureMonitorLinuxAgent'</code> (Linux).</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>param vmssName string = 'vmss-01'\nparam location string\n\nresource vmScaleSet 'Microsoft.Compute/virtualMachineScaleSets@2022-08-01' = {\n  name: vmssName\n  location: location\n  sku: {\n    name: 'b2ms'\n    tier: 'Standard'\n    capacity: 1\n  }\n  properties: {\n    overprovision: true\n    upgradePolicy: {\n      mode: 'Automatic'\n    }\n    singlePlacementGroup: true\n    platformFaultDomainCount: 3\n    virtualMachineProfile: {\n      extensionProfile: {\n        extensions: [\n          {\n            name: '${vmssName}/AzureMonitorLinuxAgent'\n\n            properties: {\n              autoUpgradeMinorVersion: true\n              enableAutomaticUpgrade: true\n              publisher: 'Microsoft.Azure.Monitor'\n              type: 'AzureMonitorLinuxAgent'\n              typeHandlerVersion: '1.21'\n            }\n          }\n        ]\n      }\n      storageProfile: {\n        osDisk: {\n          caching: 'ReadWrite'\n          createOption: 'FromImage'\n        }\n        imageReference: {\n          publisher: 'microsoft-aks'\n          offer: 'aks'\n          sku: 'aks-ubuntu-1804-202208'\n          version: '2022.08.29'\n        }\n      }\n      osProfile: {\n        adminUsername: 'azureuser'\n        computerNamePrefix: 'vmss-01'\n        linuxConfiguration: {\n          disablePasswordAuthentication: true\n        }\n        provisionVMAgent: true\n        ssh: {\n          publicKeys: [\n            {\n              path: '/home/azureuser/.ssh/authorized_keys'\n            }\n          ]\n        }\n      }\n      networkProfile: {\n        networkInterfaceConfigurations: [\n          {\n            name: 'vmss-001'\n            properties: {\n              primary: true\n              enableAcceleratedNetworking: true\n              networkSecurityGroup: {\n                id: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.Network/networkSecurityGroups/nsg-001'\n              }\n              ipConfigurations: [\n                {\n                  name: 'ipconfig1'\n                  properties: {\n                    primary: true\n                    subnet: {\n                      id: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/vnet-001/subnets/subnet-001'\n                    }\n                    privateIPAddressVersion: 'IPv4'\n                    loadBalancerBackendAddressPools: [\n                      {\n                        id: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-rg/providers/Microsoft.Network/loadBalancers/kubernetes/backendAddressPools/kubernetes'\n                      }\n                    ]\n                  }\n                }\n              ]\n            }\n          }\n        ]\n      }\n    }\n  }\n}\n</code></pre> <p>To deploy virtual machine scale sets with a extension sub resource that pass this rule:</p> <ul> <li>Deploy a extension sub-resource (extension resource).</li> <li>Set <code>properties.publisher</code> to <code>'Microsoft.Azure.Monitor'</code>.</li> <li>Set <code>properties.type</code> to <code>'AzureMonitorWindowsAgent'</code> (Windows) or <code>'AzureMonitorLinuxAgent'</code> (Linux).</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>param vmssName string\nparam location string\nparam userAssignedManagedIdentity string\n\nresource linuxAgent 'Microsoft.Compute/virtualMachineScaleSets/extensions@2022-08-01' = {\n  name: '${vmssName}/AzureMonitorLinuxAgent'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.Monitor'\n    type: 'AzureMonitorLinuxAgent'\n    typeHandlerVersion: '1.21'\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n    settings: {\n      authentication: {\n        managedIdentity: {\n          identifier-name: 'mi_res_id'\n          identifier-value: userAssignedManagedIdentity\n        }\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.VMSS.MigrateAMA","AZR-000318"]},{"location":"en/rules/Azure.VMSS.MigrateAMA/#links","title":"Links","text":"<ul> <li>Monitoring</li> <li>Log Analytics agent retiring</li> <li>Migrate to Azure Monitor Agent from Log Analytics Agent</li> <li>Azure deployment reference</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VMSS.MigrateAMA","AZR-000318"]},{"location":"en/rules/Azure.VMSS.Name/","title":"Use valid VMSS names","text":"Azure.VMSS.NameAZR-000261Error <p> Operational Excellence  \u00b7  Virtual Machine Scale Sets  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Virtual Machine Scale Set (VMSS) names should meet naming requirements.</p>","tags":["Azure.VMSS.Name","AZR-000261"]},{"location":"en/rules/Azure.VMSS.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for VMSS names are:</p> <ul> <li>Between 1 and 64 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>VM names must be unique within a resource group.</li> </ul>","tags":["Azure.VMSS.Name","AZR-000261"]},{"location":"en/rules/Azure.VMSS.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet VMSS resource name requirements. Additionally, consider using a resource name that meeting OS naming requirements.</p>","tags":["Azure.VMSS.Name","AZR-000261"]},{"location":"en/rules/Azure.VMSS.Name/#notes","title":"Notes","text":"<p>This rule does not check if VMSS names are unique. Additionally, VMSS computer names have additional restrictions. See <code>Azure.VMSS.ComputerName</code> for details.</p>","tags":["Azure.VMSS.Name","AZR-000261"]},{"location":"en/rules/Azure.VMSS.Name/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> </ul>","tags":["Azure.VMSS.Name","AZR-000261"]},{"location":"en/rules/Azure.VMSS.PublicIPAttached/","title":"Public IPs attached","text":"Azure.VMSS.PublicIPAttachedAZR-000450Error <p> Security  \u00b7  Virtual Machine Scale Sets  \u00b7  Rule  \u00b7  2024_09  \u00b7  Critical</p> <p>Avoid attaching public IPs directly to virtual machine scale set instances.</p>","tags":["Azure.VMSS.PublicIPAttached","AZR-000450"]},{"location":"en/rules/Azure.VMSS.PublicIPAttached/#description","title":"Description","text":"<p>Attaching a public IP address to a virtual machine network interface (NIC) exposes it directly to the Internet. This exposure can make the virtual machine scale set instance vulnerable to unauthorized inbound access and security compromise. Minimize the number of Internet ingress/ egress points to enhance security and reduces potential attack surfaces.</p> <p>For enhanced security, consider one or more of the following options:</p> <ul> <li>Secure remote access \u2014 by RDP or SSH to virtual machine scale set instances can be configured through Azure Bastion.<ul> <li>Azure Bastion provides a secure encrypted connection without exposing a public IP.</li> </ul> </li> <li>Exposing web services \u2014 by HTTP/S can be configured by App Gateway or Azure Front Door (AFD).<ul> <li>App Gateway and AFD provide a secure reverse proxy that supports web application firewall (WAF) filtering.</li> </ul> </li> <li>Internet connectivity \u2014 should be managed through a security hardened device such as Azure Firewall.<ul> <li>This option also allows additional controls to be applied for east/ west and north/ south traffic filtering.</li> <li>Alternatively a Network Virtual Appliance (NVA) can used.</li> </ul> </li> </ul>","tags":["Azure.VMSS.PublicIPAttached","AZR-000450"]},{"location":"en/rules/Azure.VMSS.PublicIPAttached/#recommendation","title":"Recommendation","text":"<p>Evaluate alternative methods for inbound access to virtual machine scale set instances to enhance security and minimize risk.</p>","tags":["Azure.VMSS.PublicIPAttached","AZR-000450"]},{"location":"en/rules/Azure.VMSS.PublicIPAttached/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy virtual machine scale sets that pass this rule:</p> <ul> <li>For each interface configuration specified in the <code>properties.virtualMachineProfile.networkProfile.networkInterfaceConfigurations.ipConfigurations</code> property:<ul> <li>For each IP configuration specified in the <code>properties.ipConfigurations</code> property:<ul> <li>Ensure that the <code>properties.publicIPAddressConfiguration.name</code> property does specify a public IP address.</li> </ul> </li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Compute/virtualMachineScaleSets\",\n  \"apiVersion\": \"2023-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"b2ms\",\n    \"tier\": \"Standard\",\n    \"capacity\": 3\n  },\n  \"properties\": {\n    \"virtualMachineProfile\": {\n      \"networkProfile\": {\n        \"networkInterfaceConfigurations\": [\n          {\n            \"name\": \"nic-001\",\n            \"properties\": {\n              \"primary\": true,\n              \"ipConfigurations\": [\n                {\n                  \"name\": \"nic-001-defaultIpConfiguration\",\n                  \"properties\": {\n                    \"privateIPAddressVersion\": \"IPv4\",\n                    \"subnet\": {\n                      \"id\": \"[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworkName'), parameters('subnetName'))]\"\n                    },\n                    \"primary\": true\n                  }\n                }\n              ]\n            }\n          }\n        ]\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.VMSS.PublicIPAttached","AZR-000450"]},{"location":"en/rules/Azure.VMSS.PublicIPAttached/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy virtual machine scale sets that pass this rule:</p> <ul> <li>For each interface configuration specified in the <code>properties.virtualMachineProfile.networkProfile.networkInterfaceConfigurations.ipConfigurations</code> property:<ul> <li>For each IP configuration specified in the <code>properties.ipConfigurations</code> property:<ul> <li>Ensure that the <code>properties.publicIPAddressConfiguration.name</code> property does specify a public IP address.</li> </ul> </li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vmss 'Microsoft.Compute/virtualMachineScaleSets@2023-09-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'b2ms'\n    tier: 'Standard'\n    capacity: 3\n  }\n  properties: {\n    virtualMachineProfile: {\n      networkProfile: {\n        networkInterfaceConfigurations: [\n          {\n            name: 'nic-001'\n            properties: {\n              primary: true\n              ipConfigurations: [\n                {\n                  name: 'nic-001-defaultIpConfiguration'\n                  properties: {\n                    privateIPAddressVersion: 'IPv4'\n                    subnet: {\n                      id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\n                    }\n                    primary: true\n                  }\n                }\n              ]\n            }\n          }\n        ]\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.VMSS.PublicIPAttached","AZR-000450"]},{"location":"en/rules/Azure.VMSS.PublicIPAttached/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Plan for inbound and outbound internet connectivity</li> <li>Networking for scale sets</li> <li>Public IPv4 per virtual machine</li> <li>Azure Bastion</li> <li>Azure deployment reference - VMSS</li> <li>Azure deployment reference - VMSS instance</li> </ul>","tags":["Azure.VMSS.PublicIPAttached","AZR-000450"]},{"location":"en/rules/Azure.VMSS.PublicKey/","title":"VMSS password-based authentication is enabled","text":"Azure.VMSS.PublicKeyAZR-000288Error <p> Security  \u00b7  Virtual Machine Scale Sets  \u00b7  Rule  \u00b7  2022_09  \u00b7  Important</p> <p>Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities.</p>","tags":["Azure.VMSS.PublicKey","AZR-000288"]},{"location":"en/rules/Azure.VMSS.PublicKey/#description","title":"Description","text":"<p>Linux virtual machine scale sets should have password authentication disabled to help with eliminating password-based attacks.</p>","tags":["Azure.VMSS.PublicKey","AZR-000288"]},{"location":"en/rules/Azure.VMSS.PublicKey/#recommendation","title":"Recommendation","text":"<p>Consider disabling password-based authentication on Linux VM scale sets and instead use public keys.</p>","tags":["Azure.VMSS.PublicKey","AZR-000288"]},{"location":"en/rules/Azure.VMSS.PublicKey/#examples","title":"Examples","text":"","tags":["Azure.VMSS.PublicKey","AZR-000288"]},{"location":"en/rules/Azure.VMSS.PublicKey/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy an virtual machine scale set that pass this rule:</p> <ul> <li>Set the <code>properties.virtualMachineProfile.OsProfile.linuxConfiguration.disablePasswordAuthentication</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Compute/virtualMachineScaleSets\",\n  \"apiVersion\": \"2024-07-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"sku\": {\n    \"name\": \"Standard_D8d_v5\",\n    \"tier\": \"Standard\",\n    \"capacity\": 3\n  },\n  \"properties\": {\n    \"overprovision\": true,\n    \"upgradePolicy\": {\n      \"mode\": \"Automatic\"\n    },\n    \"singlePlacementGroup\": true,\n    \"virtualMachineProfile\": {\n      \"storageProfile\": {\n        \"osDisk\": {\n          \"caching\": \"ReadWrite\",\n          \"createOption\": \"FromImage\"\n        },\n        \"imageReference\": {\n          \"publisher\": \"MicrosoftCblMariner\",\n          \"offer\": \"Cbl-Mariner\",\n          \"sku\": \"cbl-mariner-2-gen2\",\n          \"version\": \"latest\"\n        }\n      },\n      \"osProfile\": {\n        \"adminUsername\": \"[parameters('adminUsername')]\",\n        \"computerNamePrefix\": \"vmss-01\",\n        \"linuxConfiguration\": {\n          \"disablePasswordAuthentication\": true,\n          \"provisionVMAgent\": true,\n          \"ssh\": {\n            \"publicKeys\": [\n              {\n                \"path\": \"/home/azureuser/.ssh/authorized_keys\"\n              }\n            ]\n          }\n        }\n      },\n      \"networkProfile\": {\n        \"networkInterfaceConfigurations\": [\n          {\n            \"name\": \"vmss-001\",\n            \"properties\": {\n              \"primary\": true,\n              \"enableAcceleratedNetworking\": true,\n              \"ipConfigurations\": [\n                {\n                  \"name\": \"ipconfig1\",\n                  \"properties\": {\n                    \"primary\": true,\n                    \"subnet\": {\n                      \"id\": \"[parameters('subnetId')]\"\n                    },\n                    \"privateIPAddressVersion\": \"IPv4\",\n                    \"loadBalancerBackendAddressPools\": [\n                      {\n                        \"id\": \"[parameters('backendPoolId')]\"\n                      }\n                    ]\n                  }\n                }\n              ]\n            }\n          }\n        ]\n      }\n    }\n  },\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ]\n}\n</code></pre>","tags":["Azure.VMSS.PublicKey","AZR-000288"]},{"location":"en/rules/Azure.VMSS.PublicKey/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy an virtual machine scale set that pass this rule:</p> <ul> <li>Set the <code>properties.virtualMachineProfile.OsProfile.linuxConfiguration.disablePasswordAuthentication</code> property to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vmss 'Microsoft.Compute/virtualMachineScaleSets@2024-07-01' = {\n  name: name\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'Standard_D8d_v5'\n    tier: 'Standard'\n    capacity: 3\n  }\n  properties: {\n    overprovision: true\n    upgradePolicy: {\n      mode: 'Automatic'\n    }\n    singlePlacementGroup: true\n    virtualMachineProfile: {\n      storageProfile: {\n        osDisk: {\n          caching: 'ReadWrite'\n          createOption: 'FromImage'\n        }\n        imageReference: {\n          publisher: 'MicrosoftCblMariner'\n          offer: 'Cbl-Mariner'\n          sku: 'cbl-mariner-2-gen2'\n          version: 'latest'\n        }\n      }\n      osProfile: {\n        adminUsername: adminUsername\n        computerNamePrefix: 'vmss-01'\n        linuxConfiguration: {\n          disablePasswordAuthentication: true\n          provisionVMAgent: true\n          ssh: {\n            publicKeys: [\n              {\n                path: '/home/azureuser/.ssh/authorized_keys'\n              }\n            ]\n          }\n        }\n      }\n      networkProfile: {\n        networkInterfaceConfigurations: [\n          {\n            name: 'vmss-001'\n            properties: {\n              primary: true\n              enableAcceleratedNetworking: true\n              ipConfigurations: [\n                {\n                  name: 'ipconfig1'\n                  properties: {\n                    primary: true\n                    subnet: {\n                      id: subnetId\n                    }\n                    privateIPAddressVersion: 'IPv4'\n                    loadBalancerBackendAddressPools: [\n                      {\n                        id: backendPoolId\n                      }\n                    ]\n                  }\n                }\n              ]\n            }\n          }\n        ]\n      }\n    }\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n}\n</code></pre>","tags":["Azure.VMSS.PublicKey","AZR-000288"]},{"location":"en/rules/Azure.VMSS.PublicKey/#links","title":"Links","text":"<ul> <li>SE:08 Hardening resources</li> <li>Azure security baseline for Linux Virtual Machines</li> <li>Detailed steps: Create and manage SSH keys for authentication to a Linux VM in Azure</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VMSS.PublicKey","AZR-000288"]},{"location":"en/rules/Azure.VMSS.ScriptExtensions/","title":"Securely pass secrets to Custom Script Extensions for Virtual Machine Scale Sets","text":"Azure.VMSS.ScriptExtensionsAZR-000333Error <p> Security  \u00b7  Virtual Machine Scale Sets  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Custom Script Extensions scripts that reference secret values must use the protectedSettings.</p>","tags":["Azure.VMSS.ScriptExtensions","AZR-000333"]},{"location":"en/rules/Azure.VMSS.ScriptExtensions/#description","title":"Description","text":"<p>Virtual Machines Scale Sets support the ability to execute custom scripts on launch. This can be configured via user data and custom script extensions. When the template is rendered, anything in the settings section will be rendered in clear text. To ensure they're kept secret, use the protectedSettings section instead.</p>","tags":["Azure.VMSS.ScriptExtensions","AZR-000333"]},{"location":"en/rules/Azure.VMSS.ScriptExtensions/#recommendation","title":"Recommendation","text":"<p>Consider specifying secure values within  <code>properties.extensionProfile.extensions.protectedSettings</code> to avoid exposing secrets during extension deployments.</p>","tags":["Azure.VMSS.ScriptExtensions","AZR-000333"]},{"location":"en/rules/Azure.VMSS.ScriptExtensions/#examples","title":"Examples","text":"<p>To deploy VMSS extensions that pass this rule:</p> <ul> <li>Set any secure values within <code>properties.extensionProfile.extensions.protectedSettings</code></li> </ul>","tags":["Azure.VMSS.ScriptExtensions","AZR-000333"]},{"location":"en/rules/Azure.VMSS.ScriptExtensions/#configure-with-azure-template","title":"Configure with Azure template","text":"Azure Template snippet<pre><code>\"extensionProfile\": {\n  \"extensions\": [\n    {\n      \"name\": \"customScript\",\n      \"properties\": {\n          \"publisher\": \"Microsoft.Compute\",\n          \"protectedSettings\": {\n              \"commandToExecute\": \"Write-Output 'example'\"\n          },\n          \"typeHandlerVersion\": \"1.8\",\n          \"autoUpgradeMinorVersion\": true,\n          \"type\": \"CustomScriptExtension\"\n      }\n    }\n  ]\n}\n</code></pre>","tags":["Azure.VMSS.ScriptExtensions","AZR-000333"]},{"location":"en/rules/Azure.VMSS.ScriptExtensions/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy VMSS extensions that pass this rule:</p> <ul> <li>Set any secure values within <code>properties.extensionProfile.extensions.protectedSettings</code></li> </ul> Azure Bicep snippet<pre><code>extensionProfile: {\n  extensions: [\n    {\n      name: 'customScript'\n      properties: {\n        publisher: 'Microsoft.Compute'\n        protectedSettings: {\n          commandToExecute: 'Write-Output \"example\"'\n        },\n        typeHandlerVersion: '1.8'\n        autoUpgradeMinorVersion: true\n        type: 'CustomScriptExtension'\n      }\n    }\n  ]\n}\n</code></pre>","tags":["Azure.VMSS.ScriptExtensions","AZR-000333"]},{"location":"en/rules/Azure.VMSS.ScriptExtensions/#links","title":"Links","text":"<ul> <li>SE:02 Secured development lifecycle</li> <li>Azure VMSS Extensions Overview</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VMSS.ScriptExtensions","AZR-000333"]},{"location":"en/rules/Azure.VMSS.ZoneBalance/","title":"Deploy virtual machine scale set instances using best-effort zone balance","text":"Azure.VMSS.ZoneBalanceAZR-000438Error <p> Reliability  \u00b7  Virtual Machine Scale Sets  \u00b7  Rule  \u00b7  2024_09  \u00b7  Important</p> <p>Deploy virtual machine scale set instances using the best-effort zone balance in supported regions.</p>","tags":["Azure.VMSS.ZoneBalance","AZR-000438"]},{"location":"en/rules/Azure.VMSS.ZoneBalance/#description","title":"Description","text":"<p>Virtual machine scale sets (VMSS) scale-in/ out based on scaling rules your configured. When scaling-out (adding instances) using availability zones instances are distribution over the configured zones. However, it may not be possible to create an instance in a zone if there is an active issue affecting that zone.</p> <p>The distribution behavior of instances across zones can be configured with two modes:</p> <ul> <li>Best-effort zone balance - Attempt to scale-in/ out while maintaining balance across zones.   If that is not possible, allow temporary imbalance so the scaling operation can complete.<ul> <li>On subsequent scale-out attempts, the scale set adds VMs to the zones needing more VMs to restore balance.</li> <li>On subsequent scale-in attempts, the scale set removes VMs from zones that have more VMs than required to restore balance.</li> </ul> </li> <li>Strict zone balance - Only allow the scaling operation to continue if zone balanced can be maintained.   If that is not possible, the scaling operation will fail.</li> </ul> <p>Key points:</p> <ul> <li>Both modes attempt to keep balance across zones but have a different approach when balance can't be maintained.</li> <li>Scale-out typically occurs to reduce pressure on the already provisioned instances by increasing capacity.</li> <li>If scale-out fails, the workload may become unstable due to increasing pressure.</li> <li>Balance only applies when two or more zones are configured on the VMSS.</li> <li>An outage or disruption in a zone may impact a higher percentage of the workload instances when the workload is not balanced.</li> </ul>","tags":["Azure.VMSS.ZoneBalance","AZR-000438"]},{"location":"en/rules/Azure.VMSS.ZoneBalance/#recommendation","title":"Recommendation","text":"<p>Consider using best-effort zone balancing to maintain stability of the workload under load.</p>","tags":["Azure.VMSS.ZoneBalance","AZR-000438"]},{"location":"en/rules/Azure.VMSS.ZoneBalance/#examples","title":"Examples","text":"","tags":["Azure.VMSS.ZoneBalance","AZR-000438"]},{"location":"en/rules/Azure.VMSS.ZoneBalance/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To set best-effort zone balance for a virtual machine scale set:</p> <ul> <li>Set the <code>properties.zoneBalance</code> property to <code>false</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Compute/virtualMachineScaleSets\",\n  \"apiVersion\": \"2023-09-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"b2ms\",\n    \"tier\": \"Standard\",\n    \"capacity\": 3\n  },\n  \"properties\": {\n    \"zoneBalance\": false\n  },\n  \"zones\": [\n    \"1\",\n    \"2\",\n    \"3\"\n  ]\n}\n</code></pre>","tags":["Azure.VMSS.ZoneBalance","AZR-000438"]},{"location":"en/rules/Azure.VMSS.ZoneBalance/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To set best-effort zone balance for a virtual machine scale set:</p> <ul> <li>Set the <code>properties.zoneBalance</code> property to <code>false</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vmss 'Microsoft.Compute/virtualMachineScaleSets@2023-09-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'b2ms'\n    tier: 'Standard'\n    capacity: 3\n  }\n  properties: {\n    zoneBalance: false\n  }\n  zones: [\n    '1'\n    '2'\n    '3'\n  ]\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/compute/virtual-machine-scale-set:&lt;version&gt;\n</code></pre> <p>For example:</p> <pre><code>br/public:avm/res/compute/virtual-machine-scale-set:0.4.0\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/compute/virtual-machine-scale-set:0.5.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.VMSS.ZoneBalance","AZR-000438"]},{"location":"en/rules/Azure.VMSS.ZoneBalance/#links","title":"Links","text":"<ul> <li>RE:07 Self-preservation</li> <li>Zone balancing</li> <li>Azure resource deployment</li> </ul>","tags":["Azure.VMSS.ZoneBalance","AZR-000438"]},{"location":"en/rules/Azure.VNET.BastionSubnet/","title":"Configure VNETs with a AzureBastionSubnet subnet","text":"Azure.VNET.BastionSubnetAZR-000314Error <p> Reliability  \u00b7  Virtual Network  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs.</p>","tags":["Azure.VNET.BastionSubnet","AZR-000314"]},{"location":"en/rules/Azure.VNET.BastionSubnet/#description","title":"Description","text":"<p>Azure Bastion lets you securely connect to a virtual machine using your browser or native SSH/RDP client on Windows workstations or the Azure portal. An Azure Bastion host is deployed inside an Azure Virtual Network and can access virtual machines in the virtual network (VNet), or virtual machines in peered VNets.</p> <p>Azure Bastion is a fully managed service that provides more secure and seamless Remote Desktop Protocol (RDP) and Secure Shell Protocol (SSH) access to virtual machines (VMs), without any exposure through public IP addresses.</p> <p>This is a recommended pattern for virtual machine remote access.</p> <p>Adding Azure Bastion in your configuration adds the following benefits:</p> <ul> <li>Added resiliency (out of band remote access).</li> <li>Negates the need for hybrid connectivity.</li> <li>Provides an extra layer of control.   It enables secure and seamless RDP/SSH connectivity to your VMs directly from the Azure portal or native client in preview over a secure TLS channel.</li> </ul>","tags":["Azure.VNET.BastionSubnet","AZR-000314"]},{"location":"en/rules/Azure.VNET.BastionSubnet/#recommendation","title":"Recommendation","text":"<p>Consider an Azure Bastion Subnet to allow for out of band remote access to VMs and provide an extra layer of control.</p>","tags":["Azure.VNET.BastionSubnet","AZR-000314"]},{"location":"en/rules/Azure.VNET.BastionSubnet/#examples","title":"Examples","text":"","tags":["Azure.VNET.BastionSubnet","AZR-000314"]},{"location":"en/rules/Azure.VNET.BastionSubnet/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Virtual Networks that pass this rule:</p> <ul> <li>Configure an <code>AzureBastionSubnet</code> defined in <code>properties.subnets</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"apiVersion\": \"2023-05-01\",\n  \"type\": \"Microsoft.Network/virtualNetworks\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"addressSpace\": {\n      \"addressPrefixes\": [\"10.0.0.0/16\"]\n    },\n    \"subnets\": [\n      {\n        \"name\": \"GatewaySubnet\",\n        \"properties\": {\n          \"addressPrefix\": \"10.0.0.0/27\"\n        }\n      },\n      {\n        \"name\": \"AzureBastionSubnet\",\n        \"properties\": {\n          \"addressPrefix\": \"10.0.1.64/26\"\n        }\n      }\n    ]\n  }\n}\n</code></pre> <p>To deploy Virtual Networks with a subnet sub-resource that pass this rule:</p> <ul> <li>Configure an <code>AzureBastionSubnet</code> sub-resource.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"apiVersion\": \"2023-05-01\",\n  \"type\": \"Microsoft.Network/virtualNetworks/subnets\",\n  \"name\": \"[format('{0}/{1}', parameters('name'), 'AzureBastionSubnet')]\",\n  \"properties\": {\n    \"addressPrefix\": \"10.0.1.64/26\"\n  },\n  \"dependsOn\": [\"[resourceId('Microsoft.Network/virtualNetworks', parameters('name'))]\"]\n}\n</code></pre>","tags":["Azure.VNET.BastionSubnet","AZR-000314"]},{"location":"en/rules/Azure.VNET.BastionSubnet/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Virtual Networks that pass this rule:</p> <ul> <li>Configure an <code>AzureBastionSubnet</code> defined in <code>properties.subnets</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vnet 'Microsoft.Network/virtualNetworks@2023-05-01' = {\n  name: name\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        '10.0.0.0/16'\n      ]\n    }\n    subnets: [\n      {\n        name: 'GatewaySubnet'\n        properties: {\n          addressPrefix: '10.0.0.0/27'\n        }\n      }\n      {\n        name: 'AzureBastionSubnet'\n        properties: {\n          addressPrefix: '10.0.1.64/26'\n        }\n      }\n    ]\n  }\n}\n</code></pre> <p>To deploy Virtual Networks with a subnet sub-resource that pass this rule:</p> <ul> <li>Configure an <code>AzureBastionSubnet</code> sub-resource.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource bastionSubnet 'Microsoft.Network/virtualNetworks/subnets@2023-05-01' = {\n  name: 'AzureBastionSubnet'\n  parent: vnet\n  properties: {\n    addressPrefix: '10.0.1.64/26'\n  }\n}\n</code></pre>","tags":["Azure.VNET.BastionSubnet","AZR-000314"]},{"location":"en/rules/Azure.VNET.BastionSubnet/#links","title":"Links","text":"<ul> <li>Best practices</li> <li>Plan for virtual machine remote access</li> <li>Hub-spoke network topology in Azure</li> <li>What is Azure Bastion?</li> <li>Azure VNET deployment reference</li> <li>Azure subnet deployment reference</li> </ul>","tags":["Azure.VNET.BastionSubnet","AZR-000314"]},{"location":"en/rules/Azure.VNET.FirewallSubnet/","title":"Configure VNETs with a AzureFirewallSubnet subnet","text":"Azure.VNET.FirewallSubnetAZR-000322Error <p> Security  \u00b7  Virtual Network  \u00b7  Rule  \u00b7  2022_12  \u00b7  Important</p> <p>Use Azure Firewall to filter network traffic to and from Azure resources.</p>","tags":["Azure.VNET.FirewallSubnet","AZR-000322"]},{"location":"en/rules/Azure.VNET.FirewallSubnet/#description","title":"Description","text":"<p>Network segmentation is a key component of a secure network architecture. Azure provides several features that work together to provide strong network segmentation controls.</p> <p>Azure Firewall is a cloud native stateful Firewall as a service. It can be used to perform deep packet inspection on both east-west and north-south traffic. Firewalls rules can be defined as policies and centrally managed.</p> <p>Some key advantages that Azure Firewall has over traditional solutions include:</p> <ul> <li>Azure Firewall integrates directly with Virtual Network (VNET) and subnet level security.   Supports Azure concepts that minimize the need for complex network configuration such as service/ FQDN tags and load balancing.</li> <li>Managed by Azure, there is no need to deploy additional management infrastructure or consoles.</li> <li>Built-in support for Infrastructure as Code (IaC), version control, and DevOps.</li> </ul> <p>For guidance on defining your network topology in Azure see Cloud Adoption Framework (CAF).</p>","tags":["Azure.VNET.FirewallSubnet","AZR-000322"]},{"location":"en/rules/Azure.VNET.FirewallSubnet/#recommendation","title":"Recommendation","text":"<p>Consider deploying an Azure Firewall within hub networks to filter traffic between VNETs and on-premises networks.</p>","tags":["Azure.VNET.FirewallSubnet","AZR-000322"]},{"location":"en/rules/Azure.VNET.FirewallSubnet/#examples","title":"Examples","text":"","tags":["Azure.VNET.FirewallSubnet","AZR-000322"]},{"location":"en/rules/Azure.VNET.FirewallSubnet/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Virtual Networks that pass this rule:</p> <ul> <li>Configure an <code>AzureFirewallSubnet</code> defined in <code>properties.subnets</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/virtualNetworks\",\n  \"apiVersion\": \"2023-05-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"addressSpace\": {\n      \"addressPrefixes\": [\n        \"10.0.0.0/16\"\n      ]\n    },\n    \"subnets\": [\n      {\n        \"name\": \"GatewaySubnet\",\n        \"properties\": {\n          \"addressPrefix\": \"10.0.0.0/27\"\n        }\n      },\n      {\n        \"name\": \"AzureFirewallSubnet\",\n        \"properties\": {\n          \"addressPrefix\": \"10.0.1.0/26\"\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.VNET.FirewallSubnet","AZR-000322"]},{"location":"en/rules/Azure.VNET.FirewallSubnet/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Virtual Networks that pass this rule:</p> <ul> <li>Configure an <code>AzureFirewallSubnet</code> defined in <code>properties.subnets</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vnet 'Microsoft.Network/virtualNetworks@2023-05-01' = {\n  name: name\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        '10.0.0.0/16'\n      ]\n    }\n    subnets: [\n      {\n        name: 'GatewaySubnet'\n        properties: {\n          addressPrefix: '10.0.0.0/27'\n        }\n      }\n      {\n        name: 'AzureFirewallSubnet'\n        properties: {\n          addressPrefix: '10.0.1.0/26'\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.VNET.FirewallSubnet","AZR-000322"]},{"location":"en/rules/Azure.VNET.FirewallSubnet/#links","title":"Links","text":"<ul> <li>Azure features for segmentation</li> <li>Hub-spoke network topology in Azure</li> <li>Define an Azure network topology</li> <li>What is Azure Firewall?</li> <li>Azure VNET deployment reference</li> <li>Azure subnet deployment reference</li> </ul>","tags":["Azure.VNET.FirewallSubnet","AZR-000322"]},{"location":"en/rules/Azure.VNET.FirewallSubnetNAT/","title":"Use NAT gateway with Azure Firewall for outbound access","text":"Azure.VNET.FirewallSubnetNATAZR-000448Warning <p> Reliability  \u00b7  Virtual Network  \u00b7  Rule  \u00b7  2024_09  \u00b7  Awareness</p> <p>Zonal-deployed Azure Firewalls should consider using an Azure NAT Gateway for outbound access.</p>","tags":["Azure.VNET.FirewallSubnetNAT","AZR-000448"]},{"location":"en/rules/Azure.VNET.FirewallSubnetNAT/#description","title":"Description","text":"<p>Azure Firewall can be deployed with up to 250 public IP addresses, each providing 2,496 SNAT ports. This setup offers a maximum of 1,248,000 SNAT ports.</p> <p>Managing a large number of public IP addresses comes with challenges, particularly regarding downstream IP address filtering requirements. When Azure Firewall is associated with multiple public IP addresses, these filtering requirements must be applied to all associated addresses.  Even when using Public IP address prefixes, associating 250 public IP addresses requires managing 16 public IP address prefixes on the downstream side.</p> <p>A more efficient solution for scaling and dynamically allocating outbound SNAT ports is to use an Azure NAT Gateway:</p> <ul> <li>High Capacity: Each public IP address on a NAT Gateway provides 64,512 SNAT ports, and up to 16 public IP addresses can be associated, resulting in up to 1,032,192 SNAT ports.</li> <li>Dynamic Allocation: SNAT ports are dynamically allocated at the subnet level, making all provided SNAT ports available on demand for outbound connectivity.</li> </ul> <p>This configuration simplifies management for downstream systems, as it requires handling only up to 16 public IP addresses.</p> <p>When an Azure NAT Gateway is associated with an Azure Firewall subnet:</p> <ul> <li>All outbound internet traffic uses the NAT Gateway\u2019s public IP addresses.<ul> <li>Response traffic for outbound flows also passes through the NAT Gateway.</li> </ul> </li> <li>If multiple public IP addresses are associated with the NAT Gateway, the IP address used is randomly selected, and specific addresses cannot be chosen.</li> </ul> <p>Important Azure NAT Gateway supports only zonal deployment. Therefore, only zonal-deployed Azure Firewalls should utilize Azure NAT Gateway. Azure Firewalls with zone redundancy might face reduced availability if a NAT Gateway is deployed in a single zone that experiences a failure.</p>","tags":["Azure.VNET.FirewallSubnetNAT","AZR-000448"]},{"location":"en/rules/Azure.VNET.FirewallSubnetNAT/#recommendation","title":"Recommendation","text":"<p>Consider using an Azure NAT gateway for zonal-deployed Azure Firewalls for outbound access.</p>","tags":["Azure.VNET.FirewallSubnetNAT","AZR-000448"]},{"location":"en/rules/Azure.VNET.FirewallSubnetNAT/#examples","title":"Examples","text":"","tags":["Azure.VNET.FirewallSubnetNAT","AZR-000448"]},{"location":"en/rules/Azure.VNET.FirewallSubnetNAT/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure virtual networks that pass this rule:</p> <ul> <li>For the <code>AzureFirewallSubnet</code> subnet in defined the <code>properties.subnets</code> property:<ul> <li>Set the <code>properties.natGateway.id</code> property to the resource id of the NAT gateway.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/virtualNetworks\",\n  \"apiVersion\": \"2023-11-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"addressSpace\": {\n      \"addressPrefixes\": [\n        \"10.0.0.0/16\"\n      ]\n    },\n    \"subnets\": [\n      {\n        \"name\": \"AzureFirewallSubnet\",\n        \"properties\": {\n          \"addressPrefix\": \"10.0.0.0/26\",\n          \"natGateway\": {\n            \"id\": \"[parameters('natGatewayResourceId')]\",\n          }\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.VNET.FirewallSubnetNAT","AZR-000448"]},{"location":"en/rules/Azure.VNET.FirewallSubnetNAT/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure virtual networks that pass this rule:</p> <ul> <li>For the <code>AzureFirewallSubnet</code> subnet in defined the <code>properties.subnets</code> property:<ul> <li>Set the <code>properties.natGateway.id</code> property to the resource id of the NAT gateway.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vnet 'Microsoft.Network/virtualNetworks@2023-11-01' = {\n  name: name\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        '10.0.0.0/16'\n      ]\n    }\n    subnets: [\n      {\n        name: 'AzureFirewallSubnet'\n        properties: {\n          addressPrefix: '10.0.0.0/26'\n           natGateway: {\n            id: natGatewayResourceId\n          }\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.VNET.FirewallSubnetNAT","AZR-000448"]},{"location":"en/rules/Azure.VNET.FirewallSubnetNAT/#notes","title":"Notes","text":"<p>This rule applies if you're environment requires Azure Firewall deployed in a zonal configuration for outbound Internet access.</p> <p>This rule is not applicable if:</p> <ul> <li>Azure Firewall is deployed across multiple availability zones.</li> <li>Force tunneling mode is configured.</li> </ul>","tags":["Azure.VNET.FirewallSubnetNAT","AZR-000448"]},{"location":"en/rules/Azure.VNET.FirewallSubnetNAT/#rule-configuration","title":"Rule configuration","text":"<p>AZURE_FIREWALL_IS_ZONAL</p> <p>By default, this rule is ignored. For this rule to apply, set the <code>AZURE_FIREWALL_IS_ZONAL</code> configuration value to <code>true</code>.</p> <p>For example:</p> <pre><code>configuration:\n  AZURE_FIREWALL_IS_ZONAL: true\n</code></pre>","tags":["Azure.VNET.FirewallSubnetNAT","AZR-000448"]},{"location":"en/rules/Azure.VNET.FirewallSubnetNAT/#links","title":"Links","text":"<ul> <li>RE:05 Redundancy</li> <li>Scale SNAT ports with Azure NAT Gateway</li> <li>Plan for inbound and outbound internet connectivity</li> <li>Azure Firewall forced tunneling</li> <li>Azure deployment reference - Virtual Network</li> <li>Azure deployment reference - Subnet</li> </ul>","tags":["Azure.VNET.FirewallSubnetNAT","AZR-000448"]},{"location":"en/rules/Azure.VNET.LocalDNS/","title":"Use local DNS servers","text":"Azure.VNET.LocalDNSAZR-000265Error <p> Reliability  \u00b7  Virtual Network  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Virtual networks (VNETs) should use DNS servers deployed within the same Azure region.</p>","tags":["Azure.VNET.LocalDNS","AZR-000265"]},{"location":"en/rules/Azure.VNET.LocalDNS/#description","title":"Description","text":"<p>Virtual networks allow one or more custom DNS servers to be specified. These DNS servers are inherited by connected services such as virtual machines.</p> <p>When configuring custom DNS server IP addresses, these servers must be accessible for name resolution to occur. Connectivity between services may be impacted if DNS server IP addresses are temporarily or permanently unavailable.</p> <p>Avoid taking a dependency on external DNS servers for local communication such as those deployed on-premises. This can be achieved by using DNS services deployed into the same Azure region.</p> <p>Where possible consider deploying:</p> <ul> <li>Azure DNS Private Resolver.</li> <li>Azure Private DNS Zones.</li> </ul> <p>Alternatively, redundant virtual machines (VMs) can be deployed into Azure to perform DNS resolution.</p>","tags":["Azure.VNET.LocalDNS","AZR-000265"]},{"location":"en/rules/Azure.VNET.LocalDNS/#recommendation","title":"Recommendation","text":"<p>Consider deploying redundant DNS services within a connected Azure VNET.</p>","tags":["Azure.VNET.LocalDNS","AZR-000265"]},{"location":"en/rules/Azure.VNET.LocalDNS/#examples","title":"Examples","text":"","tags":["Azure.VNET.LocalDNS","AZR-000265"]},{"location":"en/rules/Azure.VNET.LocalDNS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Virtual Networks that pass this rule:</p> <ul> <li>Set <code>properties.dhcpOptions.dnsServers</code> to an IP address within the same or peered network within Azure. OR</li> <li>Use the default Azure DNS servers.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/virtualNetworks\",\n  \"apiVersion\": \"2023-05-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"addressSpace\": {\n      \"addressPrefixes\": [\n        \"10.0.0.0/16\"\n      ]\n    },\n    \"dhcpOptions\": {\n      \"dnsServers\": [\n        \"10.0.1.4\",\n        \"10.0.1.5\"\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.VNET.LocalDNS","AZR-000265"]},{"location":"en/rules/Azure.VNET.LocalDNS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Virtual Networks that pass this rule:</p> <ul> <li>Set <code>properties.dhcpOptions.dnsServers</code> to an IP address within the same or peered network within Azure. OR</li> <li>Use the default Azure DNS servers.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vnet 'Microsoft.Network/virtualNetworks@2023-05-01' = {\n  name: name\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        '10.0.0.0/16'\n      ]\n    }\n    dhcpOptions: {\n      dnsServers: [\n        '10.0.1.4'\n        '10.0.1.5'\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.VNET.LocalDNS","AZR-000265"]},{"location":"en/rules/Azure.VNET.LocalDNS/#notes","title":"Notes","text":"<p>This rule applies when analyzing resources deployed to Azure (in-flight).</p> <p>When deploying Active Directory Domain Services (ADDS) within Azure, you may decide to:</p> <ul> <li>Deploy an Identity subscription aligned to the Cloud Adoption Framework (CAF) Azure landing zone architecture.</li> <li>Host DNS services on the same VMs as ADDS, located in a separate VNET spoke for the Identity subscription.</li> </ul> <p>When you do this, this rule may report a false positive by default. If you are using this configuration, we recommend you set the configuration option <code>AZURE_VNET_DNS_WITH_IDENTITY</code> to <code>true</code>.</p> <p>For example:</p> <pre><code>configuration:\n  AZURE_VNET_DNS_WITH_IDENTITY: true\n</code></pre>","tags":["Azure.VNET.LocalDNS","AZR-000265"]},{"location":"en/rules/Azure.VNET.LocalDNS/#links","title":"Links","text":"<ul> <li>Understand the impact of dependencies</li> <li>Hub-spoke network topology in Azure</li> <li>Azure landing zone conceptual architecture</li> <li>What is Azure DNS Private Resolver?</li> <li>What is Azure Private DNS?</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VNET.LocalDNS","AZR-000265"]},{"location":"en/rules/Azure.VNET.Name/","title":"Use valid VNET names","text":"Azure.VNET.NameAZR-000268Error <p> Operational Excellence  \u00b7  Virtual Network  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Virtual Network (VNET) names should meet naming requirements.</p>","tags":["Azure.VNET.Name","AZR-000268"]},{"location":"en/rules/Azure.VNET.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Virtual Network names are:</p> <ul> <li>Between 2 and 64 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>VNET names must be unique within a resource group.</li> </ul>","tags":["Azure.VNET.Name","AZR-000268"]},{"location":"en/rules/Azure.VNET.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Virtual Network naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.VNET.Name","AZR-000268"]},{"location":"en/rules/Azure.VNET.Name/#notes","title":"Notes","text":"<p>This rule does not check if Virtual Network names are unique.</p>","tags":["Azure.VNET.Name","AZR-000268"]},{"location":"en/rules/Azure.VNET.Name/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Azure resources</li> <li>Recommended abbreviations for Azure resource types</li> <li>Parameters in Bicep</li> <li>Bicep functions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VNET.Name","AZR-000268"]},{"location":"en/rules/Azure.VNET.PeerState/","title":"VNET peer is not connected","text":"Azure.VNET.PeerStateAZR-000266Error <p> Operational Excellence  \u00b7  Virtual Network  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>VNET peering connections must be connected.</p>","tags":["Azure.VNET.PeerState","AZR-000266"]},{"location":"en/rules/Azure.VNET.PeerState/#description","title":"Description","text":"<p>When peering virtual networks, a peering connection must be established from both virtual networks. Only once both peering connections are in the Connected state will traffic be allowed to flow between the virtual networks.</p> <p>Connections in the <code>Initiated</code> or <code>Disconnected</code> state should be investigated to determine if the connection is required. When the connection is no longer required, it should be removed to prevent confusion during management and monitoring operations.</p> <p>Most customers will use a hub and spoke topology to connect virtual networks. For guidance on defining your network topology in Azure see Cloud Adoption Framework (CAF).</p>","tags":["Azure.VNET.PeerState","AZR-000266"]},{"location":"en/rules/Azure.VNET.PeerState/#recommendation","title":"Recommendation","text":"<p>Consider removing peering connections that are not longer required or complete peering connections.</p>","tags":["Azure.VNET.PeerState","AZR-000266"]},{"location":"en/rules/Azure.VNET.PeerState/#examples","title":"Examples","text":"","tags":["Azure.VNET.PeerState","AZR-000266"]},{"location":"en/rules/Azure.VNET.PeerState/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy virtual networks that pass this rule:</p> <ul> <li>Create a peering connection from the spoke to the hub. AND</li> <li>Create a peering connection from the hub to the spoke.</li> </ul> <p>For example a peering connection from a spoke to a hub:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/virtualNetworks/virtualNetworkPeerings\",\n  \"apiVersion\": \"2023-05-01\",\n  \"name\": \"[format('{0}/{1}', parameters('spokeName'), format('peer-to-{0}', parameters('hubName')))]\",\n  \"properties\": {\n    \"remoteVirtualNetwork\": {\n      \"id\": \"[resourceId('Microsoft.Network/virtualNetworks', parameters('hubName'))]\"\n    },\n    \"allowVirtualNetworkAccess\": true,\n    \"allowForwardedTraffic\": true,\n    \"allowGatewayTransit\": false,\n    \"useRemoteGateways\": true\n  }\n}\n</code></pre> <p>For example a peering connection from a hub to a spoke:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/virtualNetworks/virtualNetworkPeerings\",\n  \"apiVersion\": \"2023-05-01\",\n  \"name\": \"[format('{0}/{1}', parameters('hubName'), format('peer-to-{0}', parameters('spokeName')))]\",\n  \"properties\": {\n    \"remoteVirtualNetwork\": {\n      \"id\": \"[resourceId('Microsoft.Network/virtualNetworks', parameters('spokeName'))]\"\n    },\n    \"allowVirtualNetworkAccess\": true,\n    \"allowForwardedTraffic\": false,\n    \"allowGatewayTransit\": true,\n    \"useRemoteGateways\": false\n  }\n}\n</code></pre>","tags":["Azure.VNET.PeerState","AZR-000266"]},{"location":"en/rules/Azure.VNET.PeerState/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy virtual networks that pass this rule:</p> <ul> <li>Create a peering connection from the spoke to the hub. AND</li> <li>Create a peering connection from the hub to the spoke.</li> </ul> <p>For example a peering connection from a spoke to a hub:</p> Azure Bicep snippet<pre><code>resource toHub 'Microsoft.Network/virtualNetworks/virtualNetworkPeerings@2023-05-01' = {\n  parent: spoke\n  name: 'peer-to-${hub.name}'\n  properties: {\n    remoteVirtualNetwork: {\n      id: hub.id\n    }\n    allowVirtualNetworkAccess: true\n    allowForwardedTraffic: true\n    allowGatewayTransit: false\n    useRemoteGateways: true\n  }\n}\n</code></pre> <p>For example a peering connection from a hub to a spoke:</p> Azure Bicep snippet<pre><code>resource toSpoke 'Microsoft.Network/virtualNetworks/virtualNetworkPeerings@2023-05-01' = {\n  parent: hub\n  name: 'peer-to-${spoke.name}'\n  properties: {\n    remoteVirtualNetwork: {\n      id: spoke.id\n    }\n    allowVirtualNetworkAccess: true\n    allowForwardedTraffic: false\n    allowGatewayTransit: true\n    useRemoteGateways: false\n  }\n}\n</code></pre>","tags":["Azure.VNET.PeerState","AZR-000266"]},{"location":"en/rules/Azure.VNET.PeerState/#notes","title":"Notes","text":"<p>This rule applies when analyzing resources deployed to Azure (in-flight).</p>","tags":["Azure.VNET.PeerState","AZR-000266"]},{"location":"en/rules/Azure.VNET.PeerState/#links","title":"Links","text":"<ul> <li>OE:04 Tools and processes</li> <li>Virtual network peering</li> <li>Create, change, or delete a virtual network peering</li> <li>Networking limits</li> <li>Hub-spoke network topology in Azure</li> <li>Define an Azure network topology</li> <li>Azure VNET deployment reference</li> <li>Azure VNET peering deployment reference</li> </ul>","tags":["Azure.VNET.PeerState","AZR-000266"]},{"location":"en/rules/Azure.VNET.PrivateSubnet/","title":"Disable default outbound access","text":"Azure.VNET.PrivateSubnetAZR-000447Error <p> Security  \u00b7  Virtual Network  \u00b7  Rule  \u00b7  Preview  \u00b7  2024_09  \u00b7  Critical</p> <p>Disable default outbound access for virtual machines.</p>","tags":["Azure.VNET.PrivateSubnet","AZR-000447"]},{"location":"en/rules/Azure.VNET.PrivateSubnet/#description","title":"Description","text":"<p>Azure virtual network (VNET) subnets support disabling default outbound Internet access. By default, virtual machines (VMs) have outbound connectivity to the Internet. Default outbound Internet access also applies to virtual machine scale sets (VMSS) configured with the uniform orchestration mode.</p> <p>When default outbound is enabled traffic to the Internet is automatically routing via a shared NAT pool. The IP address used by the shared NAT pool is used across multiple customers, and is subject to change.</p> <p>Default outbound access for new VMs and VMSS is scheduled for retirement in September 2025.</p> <p>Alternatively, outbound access to the Internet can be explicitly configured. Explicit outbound access has the following benefits:</p> <ul> <li>Security: Outbound Internet access can be used to transfer data or control out of your organization.   Controlling outbound access allows you to make an explicit choice about which workloads require this vs those that don't.</li> <li>Ownership and stability: The default outbound access IP is managed by Microsoft and used by multiple customers.   As a result, you can't assume use the address for network security rules and the address might change unexpectedly in the future,   potentially causing disruptions to any configuration relying on a stable or fixed IP address.</li> </ul> <p>Explicit outbound access can be provided to a specific workload or application by:</p> <ul> <li>Deploying a NAT gateway into the subnet where the VM or VMSS is deployed.</li> <li>Deploying a Standard load balancer and configuring an outbound SNAT rule.</li> </ul> <p>A public IP address can also be attached to a specific VM instance to provide explicit outbound access. However, attaching a public IP address to a VM also allows inbound access from the Internet which further compromises the security of the VM.</p> <p>To provide outbound access to multiple workloads or applications a VWAN or hub and spoke network topology can be deployed. See the Azure Cloud Adoption Framework (CAF) for guidance and a reference architecture for deploying network connectivity in Azure.</p> <p>Note that there are limitations to this feature, so please refer to the documentation for detailed information.</p>","tags":["Azure.VNET.PrivateSubnet","AZR-000447"]},{"location":"en/rules/Azure.VNET.PrivateSubnet/#recommendation","title":"Recommendation","text":"<p>Consider using an explicit method of public connectivity for virtual machines.</p>","tags":["Azure.VNET.PrivateSubnet","AZR-000447"]},{"location":"en/rules/Azure.VNET.PrivateSubnet/#examples","title":"Examples","text":"","tags":["Azure.VNET.PrivateSubnet","AZR-000447"]},{"location":"en/rules/Azure.VNET.PrivateSubnet/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure virtual networks that pass this rule:</p> <ul> <li>For each subnet in defined the <code>properties.subnets</code> property:<ul> <li>Set the <code>properties.defaultOutboundAccess</code> property to <code>false</code>.</li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/virtualNetworks\",\n  \"apiVersion\": \"2023-11-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"addressSpace\": {\n      \"addressPrefixes\": [\n        \"10.0.0.0/16\"\n      ]\n    },\n    \"subnets\": [\n      {\n        \"name\": \"subnet-A\",\n        \"properties\": {\n          \"addressPrefix\": \"10.0.0.0/27\",\n          \"defaultOutboundAccess\": false\n        }\n      },\n      {\n        \"name\": \"subnet-B\",\n        \"properties\": {\n          \"addressPrefix\": \"10.0.0.32/27\",\n          \"defaultOutboundAccess\": false\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.VNET.PrivateSubnet","AZR-000447"]},{"location":"en/rules/Azure.VNET.PrivateSubnet/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure virtual networks that pass this rule:</p> <ul> <li>For each subnet in defined the <code>properties.subnets</code> property:<ul> <li>Set the <code>properties.defaultOutboundAccess</code> property to <code>false</code>.</li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vnet 'Microsoft.Network/virtualNetworks@2023-11-01' = {\n  name: name\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        '10.0.0.0/16'\n      ]\n    }\n    subnets: [\n      {\n        name: 'subnet-A'\n        properties: {\n          addressPrefix: '10.0.0.0/27'\n          defaultOutboundAccess: false\n        }\n      }\n      {\n        name: 'subnet-B'\n        properties: {\n          addressPrefix: '10.0.0.32/27'\n          defaultOutboundAccess: false\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.VNET.PrivateSubnet","AZR-000447"]},{"location":"en/rules/Azure.VNET.PrivateSubnet/#notes","title":"Notes","text":"<p>This feature is currently in preview.</p>","tags":["Azure.VNET.PrivateSubnet","AZR-000447"]},{"location":"en/rules/Azure.VNET.PrivateSubnet/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Default outbound access</li> <li>Plan for inbound and outbound internet connectivity</li> <li>Azure deployment reference - Virtual Network</li> <li>Azure deployment reference - Subnet</li> </ul>","tags":["Azure.VNET.PrivateSubnet","AZR-000447"]},{"location":"en/rules/Azure.VNET.SingleDNS/","title":"Use redundant DNS servers","text":"Azure.VNET.SingleDNSAZR-000264Error <p> Reliability  \u00b7  Virtual Network  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Virtual networks (VNETs) should have at least two DNS servers assigned.</p>","tags":["Azure.VNET.SingleDNS","AZR-000264"]},{"location":"en/rules/Azure.VNET.SingleDNS/#description","title":"Description","text":"<p>Virtual networks (VNETs) should have at least two (2) DNS servers assigned. Using a single DNS server may indicate a single point of failure where the DNS IP address is not load balanced.</p>","tags":["Azure.VNET.SingleDNS","AZR-000264"]},{"location":"en/rules/Azure.VNET.SingleDNS/#recommendation","title":"Recommendation","text":"<p>Virtual networks should have at least two (2) DNS servers set when not using Azure-provided DNS.</p>","tags":["Azure.VNET.SingleDNS","AZR-000264"]},{"location":"en/rules/Azure.VNET.SingleDNS/#examples","title":"Examples","text":"","tags":["Azure.VNET.SingleDNS","AZR-000264"]},{"location":"en/rules/Azure.VNET.SingleDNS/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy Virtual Networks that pass this rule:</p> <ul> <li>Set <code>properties.dhcpOptions.dnsServers</code> to at least two DNS server addresses. OR</li> <li>Use the default Azure DNS servers.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/virtualNetworks\",\n  \"apiVersion\": \"2023-05-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"addressSpace\": {\n      \"addressPrefixes\": [\n        \"10.0.0.0/16\"\n      ]\n    },\n    \"dhcpOptions\": {\n      \"dnsServers\": [\n        \"10.0.1.4\",\n        \"10.0.1.5\"\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.VNET.SingleDNS","AZR-000264"]},{"location":"en/rules/Azure.VNET.SingleDNS/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy Virtual Networks that pass this rule:</p> <ul> <li>Set <code>properties.dhcpOptions.dnsServers</code> to at least two DNS server addresses. OR</li> <li>Use the default Azure DNS servers.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vnet 'Microsoft.Network/virtualNetworks@2023-05-01' = {\n  name: name\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        '10.0.0.0/16'\n      ]\n    }\n    dhcpOptions: {\n      dnsServers: [\n        '10.0.1.4'\n        '10.0.1.5'\n      ]\n    }\n  }\n}\n</code></pre>","tags":["Azure.VNET.SingleDNS","AZR-000264"]},{"location":"en/rules/Azure.VNET.SingleDNS/#links","title":"Links","text":"<ul> <li>Understand the impact of dependencies</li> <li>Hub-spoke network topology in Azure</li> <li>Azure landing zone conceptual architecture</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VNET.SingleDNS","AZR-000264"]},{"location":"en/rules/Azure.VNET.SubnetName/","title":"Use valid subnet names","text":"Azure.VNET.SubnetNameAZR-000267Error <p> Operational Excellence  \u00b7  Virtual Network  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Subnet names should meet naming requirements.</p>","tags":["Azure.VNET.SubnetName","AZR-000267"]},{"location":"en/rules/Azure.VNET.SubnetName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for Route table names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>Subnet names must be unique within a virtual network.</li> </ul>","tags":["Azure.VNET.SubnetName","AZR-000267"]},{"location":"en/rules/Azure.VNET.SubnetName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet subnet naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.VNET.SubnetName","AZR-000267"]},{"location":"en/rules/Azure.VNET.SubnetName/#notes","title":"Notes","text":"<p>This rule does not check if subnet names are unique.</p>","tags":["Azure.VNET.SubnetName","AZR-000267"]},{"location":"en/rules/Azure.VNET.SubnetName/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> </ul>","tags":["Azure.VNET.SubnetName","AZR-000267"]},{"location":"en/rules/Azure.VNET.UseNSGs/","title":"Use NSGs on subnets","text":"Azure.VNET.UseNSGsAZR-000263Error <p> Security  \u00b7  Virtual Network  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned.</p>","tags":["Azure.VNET.UseNSGs","AZR-000263"]},{"location":"en/rules/Azure.VNET.UseNSGs/#description","title":"Description","text":"<p>Each VNET subnet should have a network security group (NSG) assigned. NSGs are basic stateful firewalls that provide network isolation and security within a VNET. A key benefit of NSGS is that they provide network segmentation between and within a subnet.</p> <p>NSGs can be assigned to a virtual machine network interface or a subnet. When assigning NSGs to a subnet, all network traffic within the subnet is subject to the NSG rules.</p> <p>There is a small subset of special purpose subnets that do not support NSGs. These subnets are:</p> <ul> <li><code>GatewaySubnet</code> - used for hybrid connectivity with VPN and ExpressRoute gateways.</li> <li><code>AzureFirewallSubnet</code> and <code>AzureFirewallManagementSubnet</code> - are for Azure Firewall.   Azure Firewall includes an intrinsic NSG that is not directly manageable or visible.</li> <li><code>RouteServerSubnet</code> - used by managed routing provided by Azure Route Server.</li> <li>Any subnet delegated to a dedicated HSM with <code>Microsoft.HardwareSecurityModules/dedicatedHSMs</code>.</li> </ul>","tags":["Azure.VNET.UseNSGs","AZR-000263"]},{"location":"en/rules/Azure.VNET.UseNSGs/#recommendation","title":"Recommendation","text":"<p>Consider assigning a network security group (NSG) to each virtual network subnet.</p>","tags":["Azure.VNET.UseNSGs","AZR-000263"]},{"location":"en/rules/Azure.VNET.UseNSGs/#examples","title":"Examples","text":"","tags":["Azure.VNET.UseNSGs","AZR-000263"]},{"location":"en/rules/Azure.VNET.UseNSGs/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy virtual networks subnets that pass this rule:</p> <ul> <li>Set the <code>properties.networkSecurityGroup.id</code> property for each supported subnet to a NSG resource id.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/virtualNetworks\",\n  \"apiVersion\": \"2023-05-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"addressSpace\": {\n      \"addressPrefixes\": [\n        \"10.0.0.0/16\"\n      ]\n    },\n    \"dhcpOptions\": {\n      \"dnsServers\": [\n        \"10.0.1.4\",\n        \"10.0.1.5\"\n      ]\n    },\n    \"subnets\": [\n      {\n        \"name\": \"GatewaySubnet\",\n        \"properties\": {\n          \"addressPrefix\": \"10.0.0.0/24\"\n        }\n      },\n      {\n        \"name\": \"snet-001\",\n        \"properties\": {\n          \"addressPrefix\": \"10.0.1.0/24\",\n          \"networkSecurityGroup\": {\n            \"id\": \"[resourceId('Microsoft.Network/networkSecurityGroups', parameters('nsgName'))]\"\n          }\n        }\n      }\n    ]\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Network/networkSecurityGroups', parameters('nsgName'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.VNET.UseNSGs","AZR-000263"]},{"location":"en/rules/Azure.VNET.UseNSGs/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy virtual network subnets that pass this rule:</p> <ul> <li>Set the <code>properties.networkSecurityGroup.id</code> property for each supported subnet to a NSG resource id.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vnet 'Microsoft.Network/virtualNetworks@2023-05-01' = {\n  name: name\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        '10.0.0.0/16'\n      ]\n    }\n    dhcpOptions: {\n      dnsServers: [\n        '10.0.1.4'\n        '10.0.1.5'\n      ]\n    }\n    subnets: [\n      {\n        name: 'GatewaySubnet'\n        properties: {\n          addressPrefix: '10.0.0.0/24'\n        }\n      }\n      {\n        name: 'snet-001'\n        properties: {\n          addressPrefix: '10.0.1.0/24'\n          networkSecurityGroup: {\n            id: nsg.id\n          }\n        }\n      }\n    ]\n  }\n}\n</code></pre>","tags":["Azure.VNET.UseNSGs","AZR-000263"]},{"location":"en/rules/Azure.VNET.UseNSGs/#configure-with-azure-cli","title":"Configure with Azure CLI","text":"Azure CLI snippet<pre><code>az network vnet subnet update -n '&lt;subnet&gt;' -g '&lt;resource_group&gt;' --vnet-name '&lt;vnet_name&gt;' --network-security-group '&lt;nsg_name&gt;`\n</code></pre>","tags":["Azure.VNET.UseNSGs","AZR-000263"]},{"location":"en/rules/Azure.VNET.UseNSGs/#configure-with-azure-powershell","title":"Configure with Azure PowerShell","text":"Azure PowerShell snippet<pre><code>$vnet = Get-AzVirtualNetwork -Name '&lt;vnet_name&gt;' -ResourceGroupName '&lt;resource_group&gt;'\n$nsg = Get-AzNetworkSecurityGroup -Name '&lt;nsg_name&gt;' -ResourceGroupName '&lt;resource_group&gt;'\nSet-AzVirtualNetworkSubnetConfig -Name '&lt;subnet&gt;' -VirtualNetwork $vnet -AddressPrefix '10.0.1.0/24' -NetworkSecurityGroup $nsg\n</code></pre>","tags":["Azure.VNET.UseNSGs","AZR-000263"]},{"location":"en/rules/Azure.VNET.UseNSGs/#notes","title":"Notes","text":"<p>If you identify a false positive for an Azure service that does not support NSGs, please open an issue to help us improve this rule.</p> <p>To exclude subnets that are specific to your environment, use the <code>AZURE_VNET_SUBNET_EXCLUDED_FROM_NSG</code> configuration option. Any subnet names specified by this option will be ignored by this rule.</p> <p>For example:</p> <pre><code>configuration:\n  AZURE_VNET_SUBNET_EXCLUDED_FROM_NSG:\n  - subnet-1\n  - subnet-2\n</code></pre>","tags":["Azure.VNET.UseNSGs","AZR-000263"]},{"location":"en/rules/Azure.VNET.UseNSGs/#links","title":"Links","text":"<ul> <li>SE:06 Network controls</li> <li>Network Security Best Practices</li> <li>Azure Firewall FAQ</li> <li>Forced tunneling configuration</li> <li>Azure Route Server FAQ</li> <li>Azure Dedicated HSM networking</li> <li>NS-1: Establish network segmentation boundaries</li> <li>Azure VNET deployment reference</li> <li>Azure NSG deployment reference</li> </ul>","tags":["Azure.VNET.UseNSGs","AZR-000263"]},{"location":"en/rules/Azure.VNG.ConnectionName/","title":"Use valid connection names","text":"Azure.VNG.ConnectionNameAZR-000275Error <p> Operational Excellence  \u00b7  Virtual Network Gateway  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Virtual Network Gateway (VNG) connection names should meet naming requirements.</p>","tags":["Azure.VNG.ConnectionName","AZR-000275"]},{"location":"en/rules/Azure.VNG.ConnectionName/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for connection names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>Connection names must be unique within a resource group.</li> </ul>","tags":["Azure.VNG.ConnectionName","AZR-000275"]},{"location":"en/rules/Azure.VNG.ConnectionName/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet connection naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.VNG.ConnectionName","AZR-000275"]},{"location":"en/rules/Azure.VNG.ConnectionName/#notes","title":"Notes","text":"<p>This rule does not check if connection names are unique.</p>","tags":["Azure.VNG.ConnectionName","AZR-000275"]},{"location":"en/rules/Azure.VNG.ConnectionName/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Azure resources</li> <li>Recommended abbreviations for Azure resource types</li> <li>Parameters in Bicep</li> <li>Bicep functions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VNG.ConnectionName","AZR-000275"]},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/","title":"Use availability zone SKU for ExpressRoute gateways","text":"Azure.VNG.ERAvailabilityZoneSKUAZR-000273Error <p> Reliability  \u00b7  Virtual Network Gateway  \u00b7  Rule  \u00b7  2021_12  \u00b7  Important</p> <p>Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type.</p>","tags":["Azure.VNG.ERAvailabilityZoneSKU","AZR-000273"]},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/#description","title":"Description","text":"<p>ExpressRoute gateways can be deployed in Availability Zones with the following SKUs:</p> <ul> <li>ErGw1AZ</li> <li>ErGw2AZ</li> <li>ErGw3AZ</li> </ul> <p>This brings resiliency, scalability, and higher availability to ExpressRoute gateways. Deploying ExpressRoute gateways in Azure Availability Zones physically and logically separates gateways within a region, while protecting your on-premises network connectivity to Azure from zone-level failures.</p>","tags":["Azure.VNG.ERAvailabilityZoneSKU","AZR-000273"]},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/#recommendation","title":"Recommendation","text":"<p>Consider deploying ExpressRoute gateways with an availability zone SKU to improve reliability of virtual network gateways.</p>","tags":["Azure.VNG.ERAvailabilityZoneSKU","AZR-000273"]},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/#notes","title":"Notes","text":"<p>ExpressRoute gateway availability zones are managed via Public IP addresses, and are flagged separately under the <code>Azure.PublicIP.AvailabilityZone</code> rule.</p>","tags":["Azure.VNG.ERAvailabilityZoneSKU","AZR-000273"]},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/#examples","title":"Examples","text":"","tags":["Azure.VNG.ERAvailabilityZoneSKU","AZR-000273"]},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure an AZ SKU for an ExpressRoute gateway:</p> <ul> <li>Set <code>properties.gatewayType</code> to <code>'ExpressRoute'</code></li> <li>Set <code>properties.sku.name</code> and <code>properties.sku.tier</code> to one of the following AZ SKUs:<ul> <li><code>'ErGw1AZ'</code></li> <li><code>'ErGw2AZ'</code></li> <li><code>'ErGw3AZ'</code></li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n    \"apiVersion\": \"2020-11-01\",\n    \"name\": \"[parameters('name')]\",\n    \"type\": \"Microsoft.Network/virtualNetworkGateways\",\n    \"location\": \"[parameters('location')]\",\n    \"dependsOn\": [\n        \"[concat('Microsoft.Network/publicIPAddresses/', parameters('newPublicIpAddressName'))]\"\n    ],\n    \"tags\": {},\n    \"properties\": {\n        \"gatewayType\": \"ExpressRoute\",\n        \"ipConfigurations\": [\n            {\n                \"name\": \"default\",\n                \"properties\": {\n                    \"privateIPAllocationMethod\": \"Dynamic\",\n                    \"subnet\": {\n                        \"id\": \"[parameters('subnetId')]\"\n                    },\n                    \"publicIpAddress\": {\n                        \"id\": \"[resourceId('vpn-rg', 'Microsoft.Network/publicIPAddresses', parameters('newPublicIpAddressName'))]\"\n                    }\n                }\n            }\n        ],\n        \"vpnType\": \"[parameters('vpnType')]\",\n        \"vpnGatewayGeneration\": \"[parameters('vpnGatewayGeneration')]\",\n        \"sku\": {\n            \"name\": \"ErGw1AZ\",\n            \"tier\": \"ErGw1AZ\"\n        }\n    }\n}\n</code></pre>","tags":["Azure.VNG.ERAvailabilityZoneSKU","AZR-000273"]},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure an AZ SKU for an ExpressRoute gateway:</p> <ul> <li>Set <code>properties.gatewayType</code> to <code>'ExpressRoute'</code></li> <li>Set <code>properties.sku.name</code> and <code>properties.sku.tier</code> to one of the following AZ SKUs:<ul> <li><code>'ErGw1AZ'</code></li> <li><code>'ErGw2AZ'</code></li> <li><code>'ErGw3AZ'</code></li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource name_resource 'Microsoft.Network/virtualNetworkGateways@2020-11-01' = {\n  name: name\n  location: location\n  tags: {}\n  properties: {\n    gatewayType: 'ExpressRoute'\n    ipConfigurations: [\n      {\n        name: 'default'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: subnetId\n          }\n          publicIPAddress: {\n            id: resourceId('vpn-rg', 'Microsoft.Network/publicIPAddresses', newPublicIpAddressName)\n          }\n        }\n      }\n    ]\n    vpnType: vpnType\n    vpnGatewayGeneration: vpnGatewayGeneration\n    sku: {\n      name: 'ErGw1AZ'\n      tier: 'ErGw1AZ'\n    }\n  }\n  dependsOn: [\n    newPublicIpAddressName_resource\n  ]\n}\n</code></pre>","tags":["Azure.VNG.ERAvailabilityZoneSKU","AZR-000273"]},{"location":"en/rules/Azure.VNG.ERAvailabilityZoneSKU/#links","title":"Links","text":"<ul> <li>Azure deployment reference</li> <li>About zone-redundant virtual network gateways in Azure Availability Zones</li> <li>ExpressRoute gateway SKUs</li> <li>Use zone-aware services</li> </ul>","tags":["Azure.VNG.ERAvailabilityZoneSKU","AZR-000273"]},{"location":"en/rules/Azure.VNG.ERLegacySKU/","title":"Migrate from legacy ER gateway SKUs","text":"Azure.VNG.ERLegacySKUAZR-000271Error <p> Reliability  \u00b7  Virtual Network Gateway  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways.</p>","tags":["Azure.VNG.ERLegacySKU","AZR-000271"]},{"location":"en/rules/Azure.VNG.ERLegacySKU/#description","title":"Description","text":"<p>When deploying a ER gateway a number of options are available including SKU/ size. The gateway SKU affects the reliance and performance of the underlying gateway instances. Previously the following SKUs were available however have been depreciated.</p> <ul> <li><code>Basic</code></li> </ul>","tags":["Azure.VNG.ERLegacySKU","AZR-000271"]},{"location":"en/rules/Azure.VNG.ERLegacySKU/#recommendation","title":"Recommendation","text":"<p>Consider redeploying ER gateways using new SKUs to improve reliability and performance of gateways.</p>","tags":["Azure.VNG.ERLegacySKU","AZR-000271"]},{"location":"en/rules/Azure.VNG.ERLegacySKU/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Estimated performances by gateway SKU</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VNG.ERLegacySKU","AZR-000271"]},{"location":"en/rules/Azure.VNG.MaintenanceConfig/","title":"Associate a customer-controlled maintenance configuration","text":"Azure.VNG.MaintenanceConfigAZR-000430Error <p> Reliability  \u00b7  Virtual Network Gateway  \u00b7  Rule  \u00b7  Preview  \u00b7  2024_06  \u00b7  Important</p> <p>Use a customer-controlled maintenance configuration for virtual network gateways.</p>","tags":["Azure.VNG.MaintenanceConfig","AZR-000430"]},{"location":"en/rules/Azure.VNG.MaintenanceConfig/#description","title":"Description","text":"<p>Virtual network gateways require regular updates to maintain and enhance their functionality, reliability, performance, and security. These updates include patching software, upgrading networking components, and decommissioning outdated hardware.</p> <p>By attaching virtual network gateways to a maintenance configuration, customers can schedule these updates to occur during a preferred maintenance window, ideally outside of business hours, to minimize disruptions.</p> <p>Both the VPN and ExpressRoute virtual network gateway types support customer-controlled maintenance configurations.</p>","tags":["Azure.VNG.MaintenanceConfig","AZR-000430"]},{"location":"en/rules/Azure.VNG.MaintenanceConfig/#recommendation","title":"Recommendation","text":"<p>Consider using a customer-controlled maintenance configuration to efficiently schedule updates and minimize disruptions.</p>","tags":["Azure.VNG.MaintenanceConfig","AZR-000430"]},{"location":"en/rules/Azure.VNG.MaintenanceConfig/#examples","title":"Examples","text":"","tags":["Azure.VNG.MaintenanceConfig","AZR-000430"]},{"location":"en/rules/Azure.VNG.MaintenanceConfig/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure virtual network gateways that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.Maintenance/configurationAssignments</code> sub-resource (extension resource).</li> <li>Set the <code>properties.maintenanceConfigurationId</code> property to the linked maintenance configuration resource Id.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Maintenance/configurationAssignments\",\n  \"apiVersion\": \"2023-04-01\",\n  \"name\": \"[parameters('assignmentName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"scope\": \"[format('Microsoft.Network/virtualNetworkGateways/{0}', parameters('name'))]\",\n  \"properties\": {\n    \"maintenanceConfigurationId\": \"[parameters('maintenanceConfigurationId')]\"\n  },\n  \"dependsOn\": [\n    \"[resourceId('Microsoft.Network/virtualNetworkGateways', parameters('name'))]\"\n  ]\n}\n</code></pre>","tags":["Azure.VNG.MaintenanceConfig","AZR-000430"]},{"location":"en/rules/Azure.VNG.MaintenanceConfig/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure virtual network gateways that pass this rule:</p> <ul> <li>Deploy a <code>Microsoft.Maintenance/configurationAssignments</code> sub-resource (extension resource).</li> <li>Set the <code>properties.maintenanceConfigurationId</code> property to the linked maintenance configuration resource Id.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource config 'Microsoft.Maintenance/configurationAssignments@2023-04-01' = {\n  name: assignmentName\n  location: location\n  scope: virtualNetworkGateway\n  properties: {\n    maintenanceConfigurationId: maintenanceConfigurationId\n  }\n}\n</code></pre>","tags":["Azure.VNG.MaintenanceConfig","AZR-000430"]},{"location":"en/rules/Azure.VNG.MaintenanceConfig/#notes","title":"Notes","text":"<p>This feature is currently in preview for both the VPN and ExpressRoute virtual network gateway types.</p>","tags":["Azure.VNG.MaintenanceConfig","AZR-000430"]},{"location":"en/rules/Azure.VNG.MaintenanceConfig/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Configure customer-controlled gateway maintenance for VPN Gateway</li> <li>Configure customer-controlled gateway maintenance for ExpressRoute</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VNG.MaintenanceConfig","AZR-000430"]},{"location":"en/rules/Azure.VNG.Name/","title":"Use valid VNG names","text":"Azure.VNG.NameAZR-000274Error <p> Operational Excellence  \u00b7  Virtual Network Gateway  \u00b7  Rule  \u00b7  2020_06  \u00b7  Awareness</p> <p>Virtual Network Gateway (VNG) names should meet naming requirements.</p>","tags":["Azure.VNG.Name","AZR-000274"]},{"location":"en/rules/Azure.VNG.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for VNG names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>VNG names must be unique within a resource group.</li> </ul>","tags":["Azure.VNG.Name","AZR-000274"]},{"location":"en/rules/Azure.VNG.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Virtual Network Gateway (VNG) naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.VNG.Name","AZR-000274"]},{"location":"en/rules/Azure.VNG.Name/#notes","title":"Notes","text":"<p>This rule does not check if VNG names are unique.</p>","tags":["Azure.VNG.Name","AZR-000274"]},{"location":"en/rules/Azure.VNG.Name/#links","title":"Links","text":"<ul> <li>OE:04 Continuous integration</li> <li>Naming rules and restrictions for Azure resources</li> <li>Recommended abbreviations for Azure resource types</li> <li>Parameters in Bicep</li> <li>Bicep functions</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VNG.Name","AZR-000274"]},{"location":"en/rules/Azure.VNG.VPNActiveActive/","title":"Use Active-Active VPN gateways","text":"Azure.VNG.VPNActiveActiveAZR-000270Error <p> Reliability  \u00b7  Virtual Network Gateway  \u00b7  Rule  \u00b7  2020_06  \u00b7  Important</p> <p>Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime.</p>","tags":["Azure.VNG.VPNActiveActive","AZR-000270"]},{"location":"en/rules/Azure.VNG.VPNActiveActive/#description","title":"Description","text":"<p>VPN Gateways can be configured as either Active-Passive or Active-Active for Site-to-Site (S2S) connections. When deploying VPN gateways, Azure deploys two instances for high-availability (HA).</p> <p>When using an Active-Passive configuration, one instance is designated a standby for failover.</p> <p>Gateways configured to use an Active-Active configuration:</p> <ul> <li>Establish two IPSEC tunnels, one from each instance per connection.</li> <li>Each instance will load balance network traffic.</li> </ul>","tags":["Azure.VNG.VPNActiveActive","AZR-000270"]},{"location":"en/rules/Azure.VNG.VPNActiveActive/#recommendation","title":"Recommendation","text":"<p>Consider using Active-Active VPN gateways to reduce connectivity downtime during HA failover.</p>","tags":["Azure.VNG.VPNActiveActive","AZR-000270"]},{"location":"en/rules/Azure.VNG.VPNActiveActive/#examples","title":"Examples","text":"","tags":["Azure.VNG.VPNActiveActive","AZR-000270"]},{"location":"en/rules/Azure.VNG.VPNActiveActive/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure VPN gateways that pass this rule:</p> <ul> <li>Set <code>properties.activeActive</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/virtualNetworkGateways\",\n  \"apiVersion\": \"2023-11-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"gatewayType\": \"Vpn\",\n    \"ipConfigurations\": [\n      {\n        \"name\": \"default\",\n        \"properties\": {\n          \"privateIPAllocationMethod\": \"Dynamic\",\n          \"subnet\": {\n            \"id\": \"[parameters('subnetId')]\"\n          },\n          \"publicIPAddress\": {\n            \"id\": \"[parameters('pipId')]\"\n          }\n        }\n      }\n    ],\n    \"activeActive\": true,\n    \"vpnType\": \"RouteBased\",\n    \"vpnGatewayGeneration\": \"Generation2\",\n    \"sku\": {\n      \"name\": \"VpnGw1AZ\",\n      \"tier\": \"VpnGw1AZ\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.VNG.VPNActiveActive","AZR-000270"]},{"location":"en/rules/Azure.VNG.VPNActiveActive/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure VPN gateways that pass this rule:</p> <ul> <li>Set <code>properties.activeActive</code> to <code>true</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vng 'Microsoft.Network/virtualNetworkGateways@2023-11-01' = {\n  name: name\n  location: location\n  properties: {\n    gatewayType: 'Vpn'\n    ipConfigurations: [\n      {\n        name: 'default'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: subnetId\n          }\n          publicIPAddress: {\n            id: pipId\n          }\n        }\n      }\n    ]\n    activeActive: true\n    vpnType: 'RouteBased'\n    vpnGatewayGeneration: 'Generation2'\n    sku: {\n      name: 'VpnGw1AZ'\n      tier: 'VpnGw1AZ'\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/network/virtual-network-gateway:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/network/virtual-network-gateway:0.5.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.VNG.VPNActiveActive","AZR-000270"]},{"location":"en/rules/Azure.VNG.VPNActiveActive/#notes","title":"Notes","text":"<p>Azure provisions a single instance for Basic (legacy) VPN gateways. As a result, Basic VPN gateways do not support Active-Active connections. To use Active-Active VPN connections, migrate to a gateway configured as VpnGw1 or higher SKU.</p>","tags":["Azure.VNG.VPNActiveActive","AZR-000270"]},{"location":"en/rules/Azure.VNG.VPNActiveActive/#links","title":"Links","text":"<ul> <li>RE:05 Redundancy</li> <li>Highly Available Cross-Premises and VNet-to-VNet Connectivity</li> <li>Update an existing VPN gateway</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VNG.VPNActiveActive","AZR-000270"]},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/","title":"Use availability zone SKU for VPN gateways","text":"Azure.VNG.VPNAvailabilityZoneSKUAZR-000272Error <p> Reliability  \u00b7  Virtual Network Gateway  \u00b7  Rule  \u00b7  2021_12  \u00b7  Important</p> <p>Use availability zone SKU for virtual network gateways deployed with VPN gateway type.</p>","tags":["Azure.VNG.VPNAvailabilityZoneSKU","AZR-000272"]},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/#description","title":"Description","text":"<p>VPN gateways can be deployed in Availability Zones with the following SKUs:</p> <ul> <li><code>VpnGw1AZ</code></li> <li><code>VpnGw2AZ</code></li> <li><code>VpnGw3AZ</code></li> <li><code>VpnGw4AZ</code></li> <li><code>VpnGw5AZ</code></li> </ul> <p>This brings resiliency, scalability, and higher availability to VPN gateways. Deploying VPN gateways in Azure Availability Zones physically and logically separates gateways within a region, while protecting your on-premises network connectivity to Azure from zone-level failures.</p>","tags":["Azure.VNG.VPNAvailabilityZoneSKU","AZR-000272"]},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/#recommendation","title":"Recommendation","text":"<p>Consider deploying VPN gateways with an availability zone SKU to improve reliability of virtual network gateways.</p>","tags":["Azure.VNG.VPNAvailabilityZoneSKU","AZR-000272"]},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/#examples","title":"Examples","text":"","tags":["Azure.VNG.VPNAvailabilityZoneSKU","AZR-000272"]},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure VPN gateways that pass this rule:</p> <ul> <li>Set <code>properties.gatewayType</code> to <code>Vpn</code>.</li> <li>Set <code>properties.sku.name</code> and <code>properties.sku.tier</code> to one of the following AZ SKUs:<ul> <li><code>VpnGw1AZ</code></li> <li><code>VpnGw2AZ</code></li> <li><code>VpnGw3AZ</code></li> <li><code>VpnGw4AZ</code></li> <li><code>VpnGw5AZ</code></li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/virtualNetworkGateways\",\n  \"apiVersion\": \"2023-11-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"gatewayType\": \"Vpn\",\n    \"ipConfigurations\": [\n      {\n        \"name\": \"default\",\n        \"properties\": {\n          \"privateIPAllocationMethod\": \"Dynamic\",\n          \"subnet\": {\n            \"id\": \"[parameters('subnetId')]\"\n          },\n          \"publicIPAddress\": {\n            \"id\": \"[parameters('pipId')]\"\n          }\n        }\n      }\n    ],\n    \"activeActive\": true,\n    \"vpnType\": \"RouteBased\",\n    \"vpnGatewayGeneration\": \"Generation2\",\n    \"sku\": {\n      \"name\": \"VpnGw1AZ\",\n      \"tier\": \"VpnGw1AZ\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.VNG.VPNAvailabilityZoneSKU","AZR-000272"]},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure VPN gateways that pass this rule:</p> <ul> <li>Set <code>properties.gatewayType</code> to <code>Vpn</code>.</li> <li>Set <code>properties.sku.name</code> and <code>properties.sku.tier</code> to one of the following AZ SKUs:<ul> <li><code>VpnGw1AZ</code></li> <li><code>VpnGw2AZ</code></li> <li><code>VpnGw3AZ</code></li> <li><code>VpnGw4AZ</code></li> <li><code>VpnGw5AZ</code></li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vng 'Microsoft.Network/virtualNetworkGateways@2023-11-01' = {\n  name: name\n  location: location\n  properties: {\n    gatewayType: 'Vpn'\n    ipConfigurations: [\n      {\n        name: 'default'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: subnetId\n          }\n          publicIPAddress: {\n            id: pipId\n          }\n        }\n      }\n    ]\n    activeActive: true\n    vpnType: 'RouteBased'\n    vpnGatewayGeneration: 'Generation2'\n    sku: {\n      name: 'VpnGw1AZ'\n      tier: 'VpnGw1AZ'\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/network/virtual-network-gateway:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/network/virtual-network-gateway:0.5.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.VNG.VPNAvailabilityZoneSKU","AZR-000272"]},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/#notes","title":"Notes","text":"<p>VPN gateway availability zones are managed via Public IP addresses, and are flagged separately under the <code>Azure.PublicIP.AvailabilityZone</code> rule.</p>","tags":["Azure.VNG.VPNAvailabilityZoneSKU","AZR-000272"]},{"location":"en/rules/Azure.VNG.VPNAvailabilityZoneSKU/#links","title":"Links","text":"<ul> <li>RE:05 Redundancy</li> <li>About zone-redundant virtual network gateway in Azure availability zones</li> <li>VPN gateway SKUs</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VNG.VPNAvailabilityZoneSKU","AZR-000272"]},{"location":"en/rules/Azure.VNG.VPNLegacySKU/","title":"Migrate from legacy VPN gateway SKUs","text":"Azure.VNG.VPNLegacySKUAZR-000269Error <p> Reliability  \u00b7  Virtual Network Gateway  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critical</p> <p>Migrate from legacy SKUs to improve reliability and performance of VPN gateways.</p>","tags":["Azure.VNG.VPNLegacySKU","AZR-000269"]},{"location":"en/rules/Azure.VNG.VPNLegacySKU/#description","title":"Description","text":"<p>When deploying a VPN gateway a number of options are available including SKU/ size. The gateway SKU affects the reliance and performance of the underlying gateway instances. Previously the following SKUs were available however have been depreciated.</p> <ul> <li><code>Basic</code></li> <li><code>Standard</code></li> <li><code>HighPerformance</code></li> </ul> <p>The Standard and High Performance SKUs will be deprecated on September 30, 2025.</p>","tags":["Azure.VNG.VPNLegacySKU","AZR-000269"]},{"location":"en/rules/Azure.VNG.VPNLegacySKU/#recommendation","title":"Recommendation","text":"<p>Consider redeploying VPN gateways using new SKUs to improve reliability and performance of gateways.</p>","tags":["Azure.VNG.VPNLegacySKU","AZR-000269"]},{"location":"en/rules/Azure.VNG.VPNLegacySKU/#examples","title":"Examples","text":"","tags":["Azure.VNG.VPNLegacySKU","AZR-000269"]},{"location":"en/rules/Azure.VNG.VPNLegacySKU/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To configure VPN gateways that pass this rule:</p> <ul> <li>Set <code>properties.gatewayType</code> to <code>Vpn</code>.</li> <li>Set <code>properties.sku.name</code> and <code>properties.sku.tier</code> to one of the following SKUs:<ul> <li><code>VpnGw1</code></li> <li><code>VpnGw1AZ</code></li> <li><code>VpnGw2</code></li> <li><code>VpnGw2AZ</code></li> <li><code>VpnGw3</code></li> <li><code>VpnGw3AZ</code></li> <li><code>VpnGw4</code></li> <li><code>VpnGw4AZ</code></li> <li><code>VpnGw5</code></li> <li><code>VpnGw5AZ</code></li> </ul> </li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Network/virtualNetworkGateways\",\n  \"apiVersion\": \"2023-11-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"properties\": {\n    \"gatewayType\": \"Vpn\",\n    \"ipConfigurations\": [\n      {\n        \"name\": \"default\",\n        \"properties\": {\n          \"privateIPAllocationMethod\": \"Dynamic\",\n          \"subnet\": {\n            \"id\": \"[parameters('subnetId')]\"\n          },\n          \"publicIPAddress\": {\n            \"id\": \"[parameters('pipId')]\"\n          }\n        }\n      }\n    ],\n    \"activeActive\": true,\n    \"vpnType\": \"RouteBased\",\n    \"vpnGatewayGeneration\": \"Generation2\",\n    \"sku\": {\n      \"name\": \"VpnGw1AZ\",\n      \"tier\": \"VpnGw1AZ\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.VNG.VPNLegacySKU","AZR-000269"]},{"location":"en/rules/Azure.VNG.VPNLegacySKU/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To configure VPN gateways that pass this rule:</p> <ul> <li>Set <code>properties.gatewayType</code> to <code>Vpn</code>.</li> <li>Set <code>properties.sku.name</code> and <code>properties.sku.tier</code> to one of the following SKUs:<ul> <li><code>VpnGw1</code></li> <li><code>VpnGw1AZ</code></li> <li><code>VpnGw2</code></li> <li><code>VpnGw2AZ</code></li> <li><code>VpnGw3</code></li> <li><code>VpnGw3AZ</code></li> <li><code>VpnGw4</code></li> <li><code>VpnGw4AZ</code></li> <li><code>VpnGw5</code></li> <li><code>VpnGw5AZ</code></li> </ul> </li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource vng 'Microsoft.Network/virtualNetworkGateways@2023-11-01' = {\n  name: name\n  location: location\n  properties: {\n    gatewayType: 'Vpn'\n    ipConfigurations: [\n      {\n        name: 'default'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: subnetId\n          }\n          publicIPAddress: {\n            id: pipId\n          }\n        }\n      }\n    ]\n    activeActive: true\n    vpnType: 'RouteBased'\n    vpnGatewayGeneration: 'Generation2'\n    sku: {\n      name: 'VpnGw1AZ'\n      tier: 'VpnGw1AZ'\n    }\n  }\n}\n</code></pre> <p>Configure with Azure Verified Modules</p> <p>A pre-validated module supported by Microsoft is available from the Azure Bicep public registry. To reference the module, please use the following syntax:</p> <pre><code>br/public:avm/res/network/virtual-network-gateway:&lt;version&gt;\n</code></pre> <p>To use the latest version:</p> <pre><code>br/public:avm/res/network/virtual-network-gateway:0.5.0\n</code></pre> <ul> <li>What is Azure Verified Modules?</li> <li>Usage and parameters for this module</li> </ul>","tags":["Azure.VNG.VPNLegacySKU","AZR-000269"]},{"location":"en/rules/Azure.VNG.VPNLegacySKU/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Change to the new gateway SKUs</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.VNG.VPNLegacySKU","AZR-000269"]},{"location":"en/rules/Azure.WebPubSub.ManagedIdentity/","title":"Use managed identities for Web PubSub Services","text":"Azure.WebPubSub.ManagedIdentityAZR-000277Error <p> Security  \u00b7  Web PubSub Service  \u00b7  Rule  \u00b7  2022_03  \u00b7  Important</p> <p>Configure Web PubSub Services to use managed identities to access Azure resources securely.</p>","tags":["Azure.WebPubSub.ManagedIdentity","AZR-000277"]},{"location":"en/rules/Azure.WebPubSub.ManagedIdentity/#description","title":"Description","text":"<p>A managed identity allows your service to access other Azure AD-protected resources such as Azure Functions. The identity is managed by the Azure platform and doesn't require you to provision or rotate any secrets.</p> <p>Using Azure managed identities have the following benefits:</p> <ul> <li>You don't need to store or manage credentials.   Azure automatically generates tokens and performs rotation.</li> <li>You can use managed identities to authenticate to any Azure service that supports Azure AD authentication.</li> <li>Managed identities can be used without any additional cost.</li> </ul>","tags":["Azure.WebPubSub.ManagedIdentity","AZR-000277"]},{"location":"en/rules/Azure.WebPubSub.ManagedIdentity/#recommendation","title":"Recommendation","text":"<p>Consider configuring a managed identity for each Web PubSub Service. Also consider using managed identities to authenticate to related Azure services.</p>","tags":["Azure.WebPubSub.ManagedIdentity","AZR-000277"]},{"location":"en/rules/Azure.WebPubSub.ManagedIdentity/#examples","title":"Examples","text":"","tags":["Azure.WebPubSub.ManagedIdentity","AZR-000277"]},{"location":"en/rules/Azure.WebPubSub.ManagedIdentity/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy services that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.SignalRService/webPubSub\",\n  \"apiVersion\": \"2023-02-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n      \"name\": \"Standard_S1\"\n  },\n  \"identity\": {\n      \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n      \"disableLocalAuth\": true\n  }\n}\n</code></pre>","tags":["Azure.WebPubSub.ManagedIdentity","AZR-000277"]},{"location":"en/rules/Azure.WebPubSub.ManagedIdentity/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy services that pass this rule:</p> <ul> <li>Set the <code>identity.type</code> to <code>SystemAssigned</code> or <code>UserAssigned</code>.</li> <li>If <code>identity.type</code> is <code>UserAssigned</code>, reference the identity with <code>identity.userAssignedIdentities</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource service 'Microsoft.SignalRService/webPubSub@2023-02-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard_S1'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    disableLocalAuth: true\n  }\n}\n</code></pre>","tags":["Azure.WebPubSub.ManagedIdentity","AZR-000277"]},{"location":"en/rules/Azure.WebPubSub.ManagedIdentity/#links","title":"Links","text":"<ul> <li>Use identity-based authentication</li> <li>Managed identities for Azure Web PubSub Service</li> <li>IM-1: Use centralized identity and authentication system</li> <li>IM-3: Manage application identities securely and automatically</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.WebPubSub.ManagedIdentity","AZR-000277"]},{"location":"en/rules/Azure.WebPubSub.SLA/","title":"Use an SLA for Web PubSub Services","text":"Azure.WebPubSub.SLAAZR-000278Error <p> Reliability  \u00b7  Web PubSub Service  \u00b7  Rule  \u00b7  2022_03  \u00b7  Important</p> <p>Use SKUs that include an SLA when configuring Web PubSub Services.</p>","tags":["Azure.WebPubSub.SLA","AZR-000278"]},{"location":"en/rules/Azure.WebPubSub.SLA/#description","title":"Description","text":"<p>When choosing a SKU for a Web PubSub Service you should consider the SLA that is included in the SKU. Web PubSub Services offer a range of SKU offerings:</p> <ul> <li><code>Free</code> - Are designed for early non-production use and do not include any SLA.</li> <li><code>Standard</code> - Are designed for production use and include an SLA.</li> </ul>","tags":["Azure.WebPubSub.SLA","AZR-000278"]},{"location":"en/rules/Azure.WebPubSub.SLA/#recommendation","title":"Recommendation","text":"<p>Consider using a Standard SKU that includes an SLA.</p>","tags":["Azure.WebPubSub.SLA","AZR-000278"]},{"location":"en/rules/Azure.WebPubSub.SLA/#examples","title":"Examples","text":"","tags":["Azure.WebPubSub.SLA","AZR-000278"]},{"location":"en/rules/Azure.WebPubSub.SLA/#configure-with-azure-template","title":"Configure with Azure template","text":"<p>To deploy services that pass this rule:</p> <ul> <li>Set the <code>sku.name</code> property to <code>Standard_S1</code>.</li> </ul> <p>For example:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.SignalRService/webPubSub\",\n  \"apiVersion\": \"2023-02-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Standard_S1\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"disableLocalAuth\": true\n  }\n}\n</code></pre>","tags":["Azure.WebPubSub.SLA","AZR-000278"]},{"location":"en/rules/Azure.WebPubSub.SLA/#configure-with-bicep","title":"Configure with Bicep","text":"<p>To deploy services that pass this rule:</p> <ul> <li>Set the <code>sku.name</code> property to <code>Standard_S1</code>.</li> </ul> <p>For example:</p> Azure Bicep snippet<pre><code>resource service 'Microsoft.SignalRService/webPubSub@2023-02-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Standard_S1'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    disableLocalAuth: true\n  }\n}\n</code></pre>","tags":["Azure.WebPubSub.SLA","AZR-000278"]},{"location":"en/rules/Azure.WebPubSub.SLA/#links","title":"Links","text":"<ul> <li>RE:04 Target metrics</li> <li>Azure Web PubSub pricing</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.WebPubSub.SLA","AZR-000278"]},{"location":"en/rules/Azure.vWAN.Name/","title":"Use valid vWAN names","text":"Azure.vWAN.NameAZR-000276Error <p> Operational Excellence  \u00b7  Virtual WAN  \u00b7  Rule  \u00b7  2021_12  \u00b7  Awareness</p> <p>Virtual WAN (vWAN) names should meet naming requirements.</p>","tags":["Azure.vWAN.Name","AZR-000276"]},{"location":"en/rules/Azure.vWAN.Name/#description","title":"Description","text":"<p>When naming Azure resources, resource names must meet service requirements. The requirements for vWAN names are:</p> <ul> <li>Between 1 and 80 characters long.</li> <li>Alphanumerics, underscores, periods, and hyphens.</li> <li>Start with alphanumeric.</li> <li>End alphanumeric or underscore.</li> <li>vWAN names must be unique within a resource group.</li> </ul>","tags":["Azure.vWAN.Name","AZR-000276"]},{"location":"en/rules/Azure.vWAN.Name/#recommendation","title":"Recommendation","text":"<p>Consider using names that meet Virtual WAN (vWAN) naming requirements. Additionally consider naming resources with a standard naming convention.</p>","tags":["Azure.vWAN.Name","AZR-000276"]},{"location":"en/rules/Azure.vWAN.Name/#notes","title":"Notes","text":"<p>This rule does not check if vWAN names are unique.</p>","tags":["Azure.vWAN.Name","AZR-000276"]},{"location":"en/rules/Azure.vWAN.Name/#links","title":"Links","text":"<ul> <li>Repeatable infrastructure</li> <li>Naming rules and restrictions for Azure resources</li> <li>Recommended abbreviations for Azure resource types</li> <li>Azure deployment reference</li> </ul>","tags":["Azure.vWAN.Name","AZR-000276"]},{"location":"en/rules/module/","title":"Rules by pillar","text":"<p>PSRule for Azure includes the following rules across five pillars of the Microsoft Azure Well-Architected Framework.</p>"},{"location":"en/rules/module/#cost-optimization","title":"Cost Optimization","text":""},{"location":"en/rules/module/#co03-cost-data-and-reporting","title":"CO:03 Cost data and reporting","text":"Name Synopsis Severity Level Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Error"},{"location":"en/rules/module/#co04-spending-guardrails","title":"CO:04 Spending guardrails","text":"Name Synopsis Severity Level Azure.DevBox.ProjectLimit Limit the number of Dev Boxes a single user can create for a project. Important Error"},{"location":"en/rules/module/#co05-rate-optimization","title":"CO:05 Rate optimization","text":"Name Synopsis Severity Level Azure.VM.MultiTenantHosting Deploy Windows 10 and 11 virtual machines in Azure using Multi-tenant Hosting Rights to leverage your existing Windows licenses. Awareness Error Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Error Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Error"},{"location":"en/rules/module/#co06-usage-and-billing-increments","title":"CO:06 Usage and billing increments","text":"Name Synopsis Severity Level Azure.ML.ComputeIdleShutdown Configure an idle shutdown timeout for Machine Learning compute instances. Critical Error Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Error"},{"location":"en/rules/module/#co07-component-costs","title":"CO:07 Component costs","text":"Name Synopsis Severity Level Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Error Azure.AKS.AuditAdmin Use kube-audit-admin instead of kube-audit to capture administrative actions in AKS clusters. Important Error Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Error Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. Important Error"},{"location":"en/rules/module/#co10-data-costs","title":"CO:10 Data costs","text":"Name Synopsis Severity Level Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Error"},{"location":"en/rules/module/#co13-personnel-time","title":"CO:13 Personnel time","text":"Name Synopsis Severity Level Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Error Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Error"},{"location":"en/rules/module/#co14-consolidation","title":"CO:14 Consolidation","text":"Name Synopsis Severity Level Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Error Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Error Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Error Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Error Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Error"},{"location":"en/rules/module/#operational-excellence","title":"Operational Excellence","text":""},{"location":"en/rules/module/#configuration","title":"Configuration","text":"Name Synopsis Severity Level Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Error Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Error"},{"location":"en/rules/module/#deployment","title":"Deployment","text":"Name Synopsis Severity Level Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Error Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Error"},{"location":"en/rules/module/#infrastructure-provisioning","title":"Infrastructure provisioning","text":"Name Synopsis Severity Level Azure.AppGw.MigrateV2 Use a Application Gateway v2 SKU. Important Error Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. Important Error"},{"location":"en/rules/module/#monitoring","title":"Monitoring","text":"Name Synopsis Severity Level Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Error Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Error Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Error Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Error Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Error Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Error"},{"location":"en/rules/module/#oe04-continuous-integration","title":"OE:04 Continuous integration","text":"Name Synopsis Severity Level Azure.ACR.Name Container registry names should meet naming requirements. Awareness Error Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Error Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Error Azure.APIM.Name API Management service names should meet naming requirements. Awareness Error Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Error Azure.AppGw.Name Application Gateways should meet naming requirements. Awareness Error Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Error Azure.ContainerApp.Name Container Apps should meet naming requirements. Awareness Error Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Error Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Error Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Error Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. Awareness Error Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Error Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Error Azure.Search.Name AI Search service names should meet naming requirements. Awareness Error Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Error Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Error Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Error Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Error Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Error Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Error Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Error"},{"location":"en/rules/module/#oe04-tools-and-processes","title":"OE:04 Tools and processes","text":"Name Synopsis Severity Level Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Warning Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Warning Azure.ContainerApp.APIVersion Migrate from retired API version to a supported version. Important Error Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Error Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Error Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Error Azure.VNET.PeerState VNET peering connections must be connected. Important Error"},{"location":"en/rules/module/#oe05-infrastructure-as-code","title":"OE:05 Infrastructure as code","text":"Name Synopsis Severity Level Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Error Azure.Template.TemplateFile Use ARM template files that are valid. Important Error Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Error"},{"location":"en/rules/module/#oe07-monitoring-system","title":"OE:07 Monitoring system","text":"Name Synopsis Severity Level Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Error Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. Important Error Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. Important Error"},{"location":"en/rules/module/#oe09-task-automation","title":"OE:09 Task automation","text":"Name Synopsis Severity Level Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Error"},{"location":"en/rules/module/#release-engineering","title":"Release engineering","text":"Name Synopsis Severity Level Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Error Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Error Azure.Template.LocationType Location parameters should use a string value. Important Error Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Error Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Error Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Error Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Error Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Error Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Warning Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Error Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Error"},{"location":"en/rules/module/#repeatable-infrastructure","title":"Repeatable infrastructure","text":"Name Synopsis Severity Level Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. Important Error Azure.Arc.Server.MaintenanceConfig Use a maintenance configuration for Arc-enabled servers. Important Error Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Error Azure.Bastion.Name Bastion hosts should meet naming requirements. Awareness Error Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Error Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Error Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. Awareness Error Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Error Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Error Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Error Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Error Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Error Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Error Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. Awareness Error Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. Awareness Error Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. Awareness Error Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Error Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Error Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Error Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Error Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Error Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Error Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Error Azure.PublicIP.MigrateStandard Use the Standard SKU for Public IP addresses as the Basic SKU will be retired. Important Error Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Error Azure.Route.Name Route table names should meet naming requirements. Awareness Error Azure.RSV.Name Recovery Services vaults should meet naming requirements. Awareness Error Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Error Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Error Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Error Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Error Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Error Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Error Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Error Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Error Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Error Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Error Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Error Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Error Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Information Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Information Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Error Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Error Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Error Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Error Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Error Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Error"},{"location":"en/rules/module/#performance-efficiency","title":"Performance Efficiency","text":""},{"location":"en/rules/module/#application-capacity","title":"Application capacity","text":"Name Synopsis Severity Level Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Error"},{"location":"en/rules/module/#application-scalability","title":"Application scalability","text":"Name Synopsis Severity Level Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Error Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Error"},{"location":"en/rules/module/#design-for-performance","title":"Design for performance","text":"Name Synopsis Severity Level Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. Important Error"},{"location":"en/rules/module/#pe02-capacity-planning","title":"PE:02 Capacity planning","text":"Name Synopsis Severity Level Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Error"},{"location":"en/rules/module/#pe03-selecting-services","title":"PE:03 Selecting services","text":"Name Synopsis Severity Level Azure.Databricks.SKU Ensure Databricks workspaces are non-trial SKUs for production workloads. Critical Error Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Error"},{"location":"en/rules/module/#pe05-scaling-and-partitioning","title":"PE:05 Scaling and partitioning","text":"Name Synopsis Severity Level Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Error Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Error Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Error Azure.ContainerApp.DisableAffinity Disable session affinity to prevent unbalanced distribution. Awareness Error Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Error"},{"location":"en/rules/module/#pe07-code-and-infrastructure","title":"PE:07 Code and infrastructure","text":"Name Synopsis Severity Level Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Error Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Error Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Error"},{"location":"en/rules/module/#pe08-data-performance","title":"PE:08 Data performance","text":"Name Synopsis Severity Level Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. Important Error"},{"location":"en/rules/module/#performance-efficiency-checklist","title":"Performance efficiency checklist","text":"Name Synopsis Severity Level Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Warning Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Error"},{"location":"en/rules/module/#reliability","title":"Reliability","text":""},{"location":"en/rules/module/#application-design","title":"Application design","text":"Name Synopsis Severity Level Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Error"},{"location":"en/rules/module/#best-practices","title":"Best practices","text":"Name Synopsis Severity Level Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. Important Error"},{"location":"en/rules/module/#data-management","title":"Data management","text":"Name Synopsis Severity Level Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. Important Error"},{"location":"en/rules/module/#design","title":"Design","text":"Name Synopsis Severity Level Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Error Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Error Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Error Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Error"},{"location":"en/rules/module/#health-modeling","title":"Health modeling","text":"Name Synopsis Severity Level Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Error Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Error Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Error"},{"location":"en/rules/module/#load-balancing-and-failover","title":"Load balancing and failover","text":"Name Synopsis Severity Level Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Error"},{"location":"en/rules/module/#re01-simplicity-and-efficiency","title":"RE:01 Simplicity and efficiency","text":"Name Synopsis Severity Level Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Error Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Error"},{"location":"en/rules/module/#re04-target-metrics","title":"RE:04 Target metrics","text":"Name Synopsis Severity Level Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Error Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Important Error Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Error Azure.AKS.MaintenanceWindow Configure customer-controlled maintenance windows for AKS clusters. Important Error Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Error Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Error Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Error Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Error Azure.AppGw.MigrateWAFPolicy Migrate to Application Gateway WAF policy. Critical Error Azure.AppService.WebProbe Configure and enable instance health probes. Important Error Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Error Azure.AVD.ScheduleAgentUpdate Define a windows for agent updates to minimize disruptions to users. Important Error Azure.Cosmos.SLA Use a paid tier to qualify for a Service Level Agreement (SLA). Important Error Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Error Azure.Grafana.Version Grafana workspaces should be on Grafana version 10. Important Error Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Error Azure.MySQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for MySQL servers. Important Error Azure.PostgreSQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for PostgreSQL servers. Important Error Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Error Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. Important Error Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Error Azure.SQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL databases. Important Error Azure.SQLMI.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL Managed Instances. Important Error Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Error Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Error Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Error Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Error Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Error Azure.VM.MaintenanceConfig Use a maintenance configuration for virtual machines. Important Error Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Error Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Error Azure.VNG.MaintenanceConfig Use a customer-controlled maintenance configuration for virtual network gateways. Important Error Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Error Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important Error"},{"location":"en/rules/module/#re05-high-availability-multi-region-design","title":"RE:05 High-availability multi-region design","text":"Name Synopsis Severity Level Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Error"},{"location":"en/rules/module/#re05-redundancy","title":"RE:05 Redundancy","text":"Name Synopsis Severity Level Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Error Azure.AKS.MinUserPoolNodes User node pools in an AKS cluster should have a minimum number of nodes for failover and updates. Important Error Azure.AppConfig.GeoReplica Replicate app configuration store across all points of presence for an application. Important Error Azure.ContainerApp.MinReplicas Use multiple replicas to remove a single point of failure. Important Error Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. Awareness Error Azure.LB.Probe Use a specific probe for web protocols. Important Error Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. Important Warning Azure.ServiceBus.GeoReplica Enhance resilience to regional outages by replicating namespaces. Important Error Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Error Azure.VM.ASDistributeTraffic Ensure high availability by distributing traffic among members in an availability set. Important Error Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Error Azure.VNET.FirewallSubnetNAT Zonal-deployed Azure Firewalls should consider using an Azure NAT Gateway for outbound access. Awareness Warning Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Error Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Error"},{"location":"en/rules/module/#re05-regions-and-availability-zones","title":"RE:05 Regions and availability zones","text":"Name Synopsis Severity Level Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Error Azure.APIM.AvailabilityZone API Management instances should use availability zones in supported regions for high availability. Important Error Azure.APIM.MultiRegion Enhance service availability and resilience by deploying API Management instances across multiple regions. Important Error Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Error Azure.AppService.AvailabilityZone Deploy app service plan instances using availability zones in supported regions to ensure high availability and resilience. Important Error Azure.ASE.AvailabilityZone Deploy app service environments using availability zones in supported regions to ensure high availability and resilience. Important Error Azure.ContainerApp.AvailabilityZone Use Container Apps environments that are zone redundant to improve reliability. Important Error Azure.Firewall.AvailabilityZone Deploy firewall instances using availability zones in supported regions to ensure high availability and resilience. Important Error Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Error Azure.LogAnalytics.Replication Log Analytics workspaces should have workspace replication enabled to improve service availability. Important Error Azure.MySQL.ZoneRedundantHA Deploy Azure Database for MySQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Error Azure.PostgreSQL.ZoneRedundantHA Deploy Azure Database for PostgreSQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Error Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Error Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Error Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Error Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Error Azure.VMSS.AvailabilityZone Deploy virtual machine scale set instances using availability zones in supported regions to ensure high availability and resilience. Important Error"},{"location":"en/rules/module/#re06-data-partitioning","title":"RE:06 Data partitioning","text":"Name Synopsis Severity Level Azure.Cosmos.ContinuousBackup Enable continuous backup on Cosmos DB accounts. Important Error Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Error Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Error"},{"location":"en/rules/module/#re07-self-preservation","title":"RE:07 Self-preservation","text":"Name Synopsis Severity Level Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Error Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Error Azure.VMSS.AutoInstanceRepairs Automatic instance repairs are enabled. Important Error Azure.VMSS.ZoneBalance Deploy virtual machine scale set instances using the best-effort zone balance in supported regions. Important Error"},{"location":"en/rules/module/#re10-monitoring-and-alerting","title":"RE:10 Monitoring and alerting","text":"Name Synopsis Severity Level Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Error"},{"location":"en/rules/module/#resiliency-and-dependencies","title":"Resiliency and dependencies","text":"Name Synopsis Severity Level Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. Important Error Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Error Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Error Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Error"},{"location":"en/rules/module/#resource-deployment","title":"Resource deployment","text":"Name Synopsis Severity Level Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Error"},{"location":"en/rules/module/#scalability","title":"Scalability","text":"Name Synopsis Severity Level Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Error"},{"location":"en/rules/module/#target-and-non-functional-requirements","title":"Target and non-functional requirements","text":"Name Synopsis Severity Level Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. Important Error Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. Important Error Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. Important Error"},{"location":"en/rules/module/#security","title":"Security","text":""},{"location":"en/rules/module/#authentication","title":"Authentication","text":"Name Synopsis Severity Level Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Error Azure.FrontDoor.ManagedIdentity Ensure Front Door uses a managed identity to authorize access to Azure resources. Important Error Azure.ML.DisableLocalAuth Azure Machine Learning compute resources should have local authentication methods disabled. Critical Error Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Error Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. Critical Error Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. Important Error Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Error"},{"location":"en/rules/module/#azure-resources","title":"Azure resources","text":"Name Synopsis Severity Level Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Error Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. Important Error"},{"location":"en/rules/module/#connectivity","title":"Connectivity","text":"Name Synopsis Severity Level Azure.ML.ComputeVnet Azure Machine Learning Computes should be hosted in a virtual network (VNet). Critical Error Azure.ML.PublicAccess Disable public network access from a Azure Machine Learning workspace. Critical Error"},{"location":"en/rules/module/#data-protection","title":"Data protection","text":"Name Synopsis Severity Level Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. Important Error Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Error Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. Critical Error Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Error"},{"location":"en/rules/module/#design_1","title":"Design","text":"Name Synopsis Severity Level Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. Important Error Azure.APIM.PolicyBase Base element for any policy element in a section should be configured. Important Error"},{"location":"en/rules/module/#encryption","title":"Encryption","text":"Name Synopsis Severity Level Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Error Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Error Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. Critical Error"},{"location":"en/rules/module/#identity-and-access-management","title":"Identity and access management","text":"Name Synopsis Severity Level Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Error Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Error Azure.ML.UserManagedIdentity ML workspaces should use user-assigned managed identity, rather than the default system-assigned managed identity. Important Error Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Error Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Error Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Error Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Error Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Error Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Error Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. Important Error"},{"location":"en/rules/module/#key-and-secret-management","title":"Key and secret management","text":"Name Synopsis Severity Level Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Error Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Error"},{"location":"en/rules/module/#monitor","title":"Monitor","text":"Name Synopsis Severity Level Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Error Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. Important Error"},{"location":"en/rules/module/#network-security-and-containment","title":"Network security and containment","text":"Name Synopsis Severity Level Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Error Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Error Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Error Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Error Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Error Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.AppGwWAF.RuleGroups Use recommended rule groups in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Error Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. Important Error"},{"location":"en/rules/module/#network-segmentation","title":"Network segmentation","text":"Name Synopsis Severity Level Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. Important Error"},{"location":"en/rules/module/#se01-security-baseline","title":"SE:01 Security baseline","text":"Name Synopsis Severity Level Azure.AKS.NodeAutoUpgrade Deploy AKS Clusters with Node Auto-Upgrade enabled Important Error Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Error Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Error"},{"location":"en/rules/module/#se02-secured-development-lifecycle","title":"SE:02 Secured development lifecycle","text":"Name Synopsis Severity Level Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Error Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Error Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Error Azure.AppService.NodeJsVersion Configure applications to use supported Node.js runtime versions. Important Error Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Error Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Error Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. Critical Error Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Error Azure.Deployment.SecureParameter Sensitive parameters that have been not been marked as secure may leak the secret into deployment history or logs. Critical Error Azure.Deployment.SecureValue A secret property set from a non-secure value may leak the secret into deployment history or logs. Critical Error Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Error Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Error"},{"location":"en/rules/module/#se04-segmentation","title":"SE:04 Segmentation","text":"Name Synopsis Severity Level Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Error Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Error"},{"location":"en/rules/module/#se05-identity-and-access-management","title":"SE:05 Identity and access management","text":"Name Synopsis Severity Level Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Error Azure.ACR.AnonymousAccess Anonymous pull access allows unidentified downloading of images and metadata from a container registry. Important Error Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Error Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Error Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Error Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Error Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Error Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Error Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.APIM.ProductApproval Configure products to require approval. Important Error Azure.APIM.ProductSubscription Configure products to require a subscription. Important Error Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Error Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. Important Error Azure.Cosmos.DisableLocalAuth Access keys allow depersonalized access to Cosmos DB accounts using a shared secret. Critical Error Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Error Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Error Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Error Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Error Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Error Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. Awareness Warning Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. Critical Error Azure.MySQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases. Important Error Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. Critical Error Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. Important Error Azure.Redis.EntraID Use Entra ID authentication with cache instances. Critical Error Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Error Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Error Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Error Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. Important Error Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Error Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Error"},{"location":"en/rules/module/#se06-network-controls","title":"SE:06 Network controls","text":"Name Synopsis Severity Level Azure.ACR.Firewall Container Registry without restrictions can be accessed from any network location including the Internet. Important Error Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Error Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Error Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Error Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Error Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Error Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Error Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. Important Error Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. Important Error Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. Important Error Azure.Cosmos.PublicAccess Azure Cosmos DB should have public network access disabled. Critical Error Azure.Databricks.PublicAccess Azure Databricks workspaces should disable public network access. Critical Error Azure.Databricks.SecureConnectivity Use Databricks workspaces configured for secure cluster connectivity. Critical Error Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Error Azure.EventHub.Firewall Access to the namespace endpoints should be restricted to only allowed sources. Critical Error Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Error Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Error Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Error Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Error Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. Important Error Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Error Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Error Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Error Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Error Azure.VM.PublicIPAttached Avoid attaching public IPs directly to virtual machines. Critical Error Azure.VMSS.PublicIPAttached Avoid attaching public IPs directly to virtual machine scale set instances. Critical Error Azure.VNET.PrivateSubnet Disable default outbound access for virtual machines. Critical Error Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Error"},{"location":"en/rules/module/#se07-encryption","title":"SE:07 Encryption","text":"Name Synopsis Severity Level Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Error Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Error Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Error Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Error Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Error Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Error Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Error Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Error Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Error Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Error Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Error Azure.Cosmos.MinTLS Cosmos DB accounts should reject TLS versions older than 1.2. Critical Error Azure.EntraDS.NTLM Disable NTLM v1 for Microsoft Entra Domain Services. Critical Error Azure.EntraDS.RC4 Disable RC4 encryption for Microsoft Entra Domain Services. Critical Error Azure.EntraDS.TLS Disable TLS v1 for Microsoft Entra Domain Services. Critical Error Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. Critical Error Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Error Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. Critical Error Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Error Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Error Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Error Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Error Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Error Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Error Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Error Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Error Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Error Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Error Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Error Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Error Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Error"},{"location":"en/rules/module/#se08-hardening-resources","title":"SE:08 Hardening resources","text":"Name Synopsis Severity Level Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Error Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Error Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Error Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Error Azure.VM.PublicKey Linux virtual machines should use public keys. Important Error Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Error Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Error"},{"location":"en/rules/module/#se09-application-secrets","title":"SE:09 Application secrets","text":"Name Synopsis Severity Level Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Error"},{"location":"en/rules/module/#se10-monitoring-and-threat-detection","title":"SE:10 Monitoring and threat detection","text":"Name Synopsis Severity Level Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Error Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Error Azure.APIM.DefenderCloud APIs published in Azure API Management should be onboarded to Microsoft Defender for APIs. Critical Error Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Error Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. Critical Error Azure.Defender.Api Enable Microsoft Defender for APIs. Critical Error Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Error Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). Critical Error Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Error Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. Critical Error Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. Critical Error Azure.Defender.Dns Enable Microsoft Defender for DNS. Critical Error Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. Critical Error Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. Critical Error Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Error Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Error Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Error Azure.Defender.Storage Enable Microsoft Defender for Storage. Critical Error Azure.Defender.Storage.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Error Azure.Defender.Storage.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Error Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Error Azure.Firewall.PolicyMode Deny high confidence malicious IP addresses, domains and URLs. Critical Error Azure.FrontDoor.Logs Audit and monitor access through Azure Front Door profiles. Important Error Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Error Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Error Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Error Azure.Storage.Defender.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Error Azure.Storage.Defender.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Error Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. Critical Error"},{"location":"en/rules/module/#se12-incident-response","title":"SE:12 Incident response","text":"Name Synopsis Severity Level Azure.Defender.SecurityContact Important security notifications may be lost or not processed in a timely manner when a clear security contact is not identified. Important Error"},{"location":"en/rules/module/#security-design-principles","title":"Security design principles","text":"Name Synopsis Severity Level Azure.BV.Immutable Ensure immutability is configured to protect backup data. Important Error Azure.RSV.Immutable Ensure immutability is configured to protect backup data. Important Error"},{"location":"en/rules/module/#security-operations","title":"Security operations","text":"Name Synopsis Severity Level Azure.Arc.Kubernetes.Defender Deploy Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters. Important Error Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Error Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. Important Error Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. Important Error Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. Important Error"},{"location":"en/rules/resource/","title":"Rules by resource type","text":"<p>PSRule for Azure includes the following rules organized by resource type.</p>"},{"location":"en/rules/resource/#ai-search","title":"AI Search","text":"Name Synopsis Severity Level Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Error Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.Search.Name AI Search service names should meet naming requirements. Awareness Error Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Error Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Error"},{"location":"en/rules/resource/#all-resources","title":"All resources","text":"Name Synopsis Severity Level Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Error Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Error Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Error Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Error Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Error Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Error Azure.Template.LocationType Location parameters should use a string value. Important Error Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Error Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Error Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Error Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Error Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Error Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Error Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Error Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Error Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Error Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Error Azure.Template.TemplateFile Use ARM template files that are valid. Important Error Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Error Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Error Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Information Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Information Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Warning Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Error Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Error Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Error"},{"location":"en/rules/resource/#api-management","title":"API Management","text":"Name Synopsis Severity Level Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Warning Azure.APIM.AvailabilityZone API Management instances should use availability zones in supported regions for high availability. Important Error Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Error Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Error Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. Important Error Azure.APIM.DefenderCloud APIs published in Azure API Management should be onboarded to Microsoft Defender for APIs. Critical Error Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. Important Error Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Error Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Error Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. Important Error Azure.APIM.MultiRegion Enhance service availability and resilience by deploying API Management instances across multiple regions. Important Error Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. Important Error Azure.APIM.Name API Management service names should meet naming requirements. Awareness Error Azure.APIM.PolicyBase Base element for any policy element in a section should be configured. Important Error Azure.APIM.ProductApproval Configure products to require approval. Important Error Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Warning Azure.APIM.ProductSubscription Configure products to require a subscription. Important Error Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Error Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Error Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Error"},{"location":"en/rules/resource/#app-configuration","title":"App Configuration","text":"Name Synopsis Severity Level Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Error Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Error Azure.AppConfig.GeoReplica Replicate app configuration store across all points of presence for an application. Important Error Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Error Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. Important Error Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Error"},{"location":"en/rules/resource/#app-service","title":"App Service","text":"Name Synopsis Severity Level Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Error Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Error Azure.AppService.AvailabilityZone Deploy app service plan instances using availability zones in supported regions to ensure high availability and resilience. Important Error Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Error Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Error Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Error Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Error Azure.AppService.NodeJsVersion Configure applications to use supported Node.js runtime versions. Important Error Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Error Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Error Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Error Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Error Azure.AppService.WebProbe Configure and enable instance health probes. Important Error Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Error Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Error"},{"location":"en/rules/resource/#app-service-environment","title":"App Service Environment","text":"Name Synopsis Severity Level Azure.ASE.AvailabilityZone Deploy app service environments using availability zones in supported regions to ensure high availability and resilience. Important Error Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. Important Error"},{"location":"en/rules/resource/#application-gateway","title":"Application Gateway","text":"Name Synopsis Severity Level Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Error Azure.AppGw.MigrateV2 Use a Application Gateway v2 SKU. Important Error Azure.AppGw.MigrateWAFPolicy Migrate to Application Gateway WAF policy. Critical Error Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Error Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Error Azure.AppGw.Name Application Gateways should meet naming requirements. Awareness Error Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Error Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Error Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Error Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Error Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Error Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Error Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Error Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Error Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Error Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.AppGwWAF.RuleGroups Use recommended rule groups in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Error"},{"location":"en/rules/resource/#application-insights","title":"Application Insights","text":"Name Synopsis Severity Level Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Error Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Error"},{"location":"en/rules/resource/#application-security-group","title":"Application Security Group","text":"Name Synopsis Severity Level Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Error"},{"location":"en/rules/resource/#arc","title":"Arc","text":"Name Synopsis Severity Level Azure.Arc.Kubernetes.Defender Deploy Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters. Important Error Azure.Arc.Server.MaintenanceConfig Use a maintenance configuration for Arc-enabled servers. Important Error"},{"location":"en/rules/resource/#automation-account","title":"Automation Account","text":"Name Synopsis Severity Level Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Error Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Error Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Error Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Error Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Error"},{"location":"en/rules/resource/#azure-ai","title":"Azure AI","text":"Name Synopsis Severity Level Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Error Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Error Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Error"},{"location":"en/rules/resource/#azure-cache-for-redis","title":"Azure Cache for Redis","text":"Name Synopsis Severity Level Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Error Azure.Redis.EntraID Use Entra ID authentication with cache instances. Critical Error Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Error Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Error Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Error Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Error Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Error Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Error Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Error Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. Important Error"},{"location":"en/rules/resource/#azure-cache-for-redis-enterprise","title":"Azure Cache for Redis Enterprise","text":"Name Synopsis Severity Level Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Error Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Error"},{"location":"en/rules/resource/#azure-database","title":"Azure Database","text":"Name Synopsis Severity Level Azure.SQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL databases. Important Error"},{"location":"en/rules/resource/#azure-database-for-mariadb","title":"Azure Database for MariaDB","text":"Name Synopsis Severity Level Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. Awareness Error Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. Important Error Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. Awareness Error Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. Important Error Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. Critical Error Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. Awareness Error Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. Critical Error Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. Awareness Error"},{"location":"en/rules/resource/#azure-database-for-mysql","title":"Azure Database for MySQL","text":"Name Synopsis Severity Level Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. Critical Error Azure.MySQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases. Important Error Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. Important Error Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. Important Error Azure.MySQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for MySQL servers. Important Error Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Error Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Error Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. Important Warning Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Error Azure.MySQL.ZoneRedundantHA Deploy Azure Database for MySQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Error"},{"location":"en/rules/resource/#azure-database-for-postgresql","title":"Azure Database for PostgreSQL","text":"Name Synopsis Severity Level Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. Critical Error Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. Important Error Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. Important Error Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. Important Error Azure.PostgreSQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for PostgreSQL servers. Important Error Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Error Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Error Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Error Azure.PostgreSQL.ZoneRedundantHA Deploy Azure Database for PostgreSQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Error"},{"location":"en/rules/resource/#azure-kubernetes-service","title":"Azure Kubernetes Service","text":"Name Synopsis Severity Level Azure.AKS.AuditAdmin Use kube-audit-admin instead of kube-audit to capture administrative actions in AKS clusters. Important Error Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Error Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Error Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Error Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Error Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Error Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Error Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Error Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Error Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Error Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. Important Error Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Error Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Warning Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Error Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Error Azure.AKS.MaintenanceWindow Configure customer-controlled maintenance windows for AKS clusters. Important Error Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Error Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Error Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Error Azure.AKS.MinUserPoolNodes User node pools in an AKS cluster should have a minimum number of nodes for failover and updates. Important Error Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Error Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Error Azure.AKS.NodeAutoUpgrade Deploy AKS Clusters with Node Auto-Upgrade enabled Important Error Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Error Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Error Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Error Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Error Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Error Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Error Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Error Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Error Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Error Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Error"},{"location":"en/rules/resource/#azure-managed-grafana","title":"Azure Managed Grafana","text":"Name Synopsis Severity Level Azure.Grafana.Version Grafana workspaces should be on Grafana version 10. Important Error"},{"location":"en/rules/resource/#azure-virtual-desktop","title":"Azure Virtual Desktop","text":"Name Synopsis Severity Level Azure.AVD.ScheduleAgentUpdate Define a windows for agent updates to minimize disruptions to users. Important Error"},{"location":"en/rules/resource/#backup-vault","title":"Backup Vault","text":"Name Synopsis Severity Level Azure.BV.Immutable Ensure immutability is configured to protect backup data. Important Error"},{"location":"en/rules/resource/#bastion","title":"Bastion","text":"Name Synopsis Severity Level Azure.Bastion.Name Bastion hosts should meet naming requirements. Awareness Error"},{"location":"en/rules/resource/#container-app","title":"Container App","text":"Name Synopsis Severity Level Azure.ContainerApp.APIVersion Migrate from retired API version to a supported version. Important Error Azure.ContainerApp.AvailabilityZone Use Container Apps environments that are zone redundant to improve reliability. Important Error Azure.ContainerApp.DisableAffinity Disable session affinity to prevent unbalanced distribution. Awareness Error Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. Important Error Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Error Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. Important Error Azure.ContainerApp.MinReplicas Use multiple replicas to remove a single point of failure. Important Error Azure.ContainerApp.Name Container Apps should meet naming requirements. Awareness Error Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. Important Error Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. Important Error Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. Awareness Error"},{"location":"en/rules/resource/#container-registry","title":"Container Registry","text":"Name Synopsis Severity Level Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Error Azure.ACR.AnonymousAccess Anonymous pull access allows unidentified downloading of images and metadata from a container registry. Important Error Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Error Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Error Azure.ACR.Firewall Container Registry without restrictions can be accessed from any network location including the Internet. Important Error Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Error Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Error Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Error Azure.ACR.Name Container registry names should meet naming requirements. Awareness Error Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Error Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Error Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Important Error Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Error"},{"location":"en/rules/resource/#content-delivery-network","title":"Content Delivery Network","text":"Name Synopsis Severity Level Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Error Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Error Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Error"},{"location":"en/rules/resource/#cosmos-db","title":"Cosmos DB","text":"Name Synopsis Severity Level Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Error Azure.Cosmos.ContinuousBackup Enable continuous backup on Cosmos DB accounts. Important Error Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. Critical Error Azure.Cosmos.DisableLocalAuth Access keys allow depersonalized access to Cosmos DB accounts using a shared secret. Critical Error Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Error Azure.Cosmos.MinTLS Cosmos DB accounts should reject TLS versions older than 1.2. Critical Error Azure.Cosmos.PublicAccess Azure Cosmos DB should have public network access disabled. Critical Error Azure.Cosmos.SLA Use a paid tier to qualify for a Service Level Agreement (SLA). Important Error"},{"location":"en/rules/resource/#data-explorer","title":"Data Explorer","text":"Name Synopsis Severity Level Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Error Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Error Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Error Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Error"},{"location":"en/rules/resource/#data-factory","title":"Data Factory","text":"Name Synopsis Severity Level Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Error"},{"location":"en/rules/resource/#databricks","title":"Databricks","text":"Name Synopsis Severity Level Azure.Databricks.PublicAccess Azure Databricks workspaces should disable public network access. Critical Error Azure.Databricks.SecureConnectivity Use Databricks workspaces configured for secure cluster connectivity. Critical Error Azure.Databricks.SKU Ensure Databricks workspaces are non-trial SKUs for production workloads. Critical Error"},{"location":"en/rules/resource/#deployment","title":"Deployment","text":"Name Synopsis Severity Level Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Error Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. Awareness Error Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. Critical Error Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Error Azure.Deployment.SecureParameter Sensitive parameters that have been not been marked as secure may leak the secret into deployment history or logs. Critical Error Azure.Deployment.SecureValue A secret property set from a non-secure value may leak the secret into deployment history or logs. Critical Error"},{"location":"en/rules/resource/#dev-box","title":"Dev Box","text":"Name Synopsis Severity Level Azure.DevBox.ProjectLimit Limit the number of Dev Boxes a single user can create for a project. Important Error"},{"location":"en/rules/resource/#entra-domain-services","title":"Entra Domain Services","text":"Name Synopsis Severity Level Azure.EntraDS.NTLM Disable NTLM v1 for Microsoft Entra Domain Services. Critical Error Azure.EntraDS.RC4 Disable RC4 encryption for Microsoft Entra Domain Services. Critical Error Azure.EntraDS.TLS Disable TLS v1 for Microsoft Entra Domain Services. Critical Error"},{"location":"en/rules/resource/#event-grid","title":"Event Grid","text":"Name Synopsis Severity Level Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Error Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Error Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Error"},{"location":"en/rules/resource/#event-hub","title":"Event Hub","text":"Name Synopsis Severity Level Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Error Azure.EventHub.Firewall Access to the namespace endpoints should be restricted to only allowed sources. Critical Error Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. Critical Error Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Error"},{"location":"en/rules/resource/#firewall","title":"Firewall","text":"Name Synopsis Severity Level Azure.Firewall.AvailabilityZone Deploy firewall instances using availability zones in supported regions to ensure high availability and resilience. Important Error Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Error Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Error Azure.Firewall.PolicyMode Deny high confidence malicious IP addresses, domains and URLs. Critical Error Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Error"},{"location":"en/rules/resource/#front-door","title":"Front Door","text":"Name Synopsis Severity Level Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Error Azure.FrontDoor.Logs Audit and monitor access through Azure Front Door profiles. Important Error Azure.FrontDoor.ManagedIdentity Ensure Front Door uses a managed identity to authorize access to Azure resources. Important Error Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Error Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Error Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Error Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Error Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Error Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Error Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. Important Error Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Error Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Error Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Error Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Error Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Error Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Error"},{"location":"en/rules/resource/#iot-hub","title":"IoT Hub","text":"Name Synopsis Severity Level Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. Critical Error"},{"location":"en/rules/resource/#key-vault","title":"Key Vault","text":"Name Synopsis Severity Level Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Error Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Error Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. Important Error Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Error Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Error Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Error Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Error Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. Awareness Warning Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Error Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Error"},{"location":"en/rules/resource/#load-balancer","title":"Load Balancer","text":"Name Synopsis Severity Level Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Error Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Error Azure.LB.Probe Use a specific probe for web protocols. Important Error Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Error"},{"location":"en/rules/resource/#log-analytics","title":"Log Analytics","text":"Name Synopsis Severity Level Azure.LogAnalytics.Replication Log Analytics workspaces should have workspace replication enabled to improve service availability. Important Error"},{"location":"en/rules/resource/#logic-app","title":"Logic App","text":"Name Synopsis Severity Level Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Error"},{"location":"en/rules/resource/#machine-learning","title":"Machine Learning","text":"Name Synopsis Severity Level Azure.ML.ComputeIdleShutdown Configure an idle shutdown timeout for Machine Learning compute instances. Critical Error Azure.ML.ComputeVnet Azure Machine Learning Computes should be hosted in a virtual network (VNet). Critical Error Azure.ML.DisableLocalAuth Azure Machine Learning compute resources should have local authentication methods disabled. Critical Error Azure.ML.PublicAccess Disable public network access from a Azure Machine Learning workspace. Critical Error Azure.ML.UserManagedIdentity ML workspaces should use user-assigned managed identity, rather than the default system-assigned managed identity. Important Error"},{"location":"en/rules/resource/#microsoft-defender-for-cloud","title":"Microsoft Defender for Cloud","text":"Name Synopsis Severity Level Azure.Defender.Api Enable Microsoft Defender for APIs. Critical Error Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Error Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). Critical Error Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Error Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. Critical Error Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. Critical Error Azure.Defender.Dns Enable Microsoft Defender for DNS. Critical Error Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. Critical Error Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. Critical Error Azure.Defender.SecurityContact Important security notifications may be lost or not processed in a timely manner when a clear security contact is not identified. Important Error Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Error Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Error Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Error Azure.Defender.Storage Enable Microsoft Defender for Storage. Critical Error Azure.Defender.Storage.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Error Azure.Defender.Storage.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Error Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Error"},{"location":"en/rules/resource/#monitor","title":"Monitor","text":"Name Synopsis Severity Level Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Error"},{"location":"en/rules/resource/#network-interface","title":"Network Interface","text":"Name Synopsis Severity Level Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Error Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Error Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Error"},{"location":"en/rules/resource/#network-security-group","title":"Network Security Group","text":"Name Synopsis Severity Level Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Error Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Error Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Error Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Error Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Error Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Error"},{"location":"en/rules/resource/#policy","title":"Policy","text":"Name Synopsis Severity Level Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Error Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Error Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Error Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Error Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Error"},{"location":"en/rules/resource/#private-endpoint","title":"Private Endpoint","text":"Name Synopsis Severity Level Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Error"},{"location":"en/rules/resource/#public-ip-address","title":"Public IP address","text":"Name Synopsis Severity Level Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Error Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Error Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Error Azure.PublicIP.MigrateStandard Use the Standard SKU for Public IP addresses as the Basic SKU will be retired. Important Error Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Error Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Error"},{"location":"en/rules/resource/#recovery-services-vault","title":"Recovery Services Vault","text":"Name Synopsis Severity Level Azure.RSV.Immutable Ensure immutability is configured to protect backup data. Important Error Azure.RSV.Name Recovery Services vaults should meet naming requirements. Awareness Error Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Error Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Error"},{"location":"en/rules/resource/#resource-group","title":"Resource Group","text":"Name Synopsis Severity Level Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Error"},{"location":"en/rules/resource/#route-table","title":"Route table","text":"Name Synopsis Severity Level Azure.Route.Name Route table names should meet naming requirements. Awareness Error"},{"location":"en/rules/resource/#service-bus","title":"Service Bus","text":"Name Synopsis Severity Level Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. Important Error Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Error Azure.ServiceBus.GeoReplica Enhance resilience to regional outages by replicating namespaces. Important Error Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Error Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Error"},{"location":"en/rules/resource/#service-fabric","title":"Service Fabric","text":"Name Synopsis Severity Level Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Error"},{"location":"en/rules/resource/#signalr-service","title":"SignalR Service","text":"Name Synopsis Severity Level Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Error Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Error Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Error"},{"location":"en/rules/resource/#sql-database","title":"SQL Database","text":"Name Synopsis Severity Level Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Error Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. Important Error Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Error Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Error Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Error Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Error Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Error Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Error Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Error Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Error"},{"location":"en/rules/resource/#sql-managed-instance","title":"SQL Managed Instance","text":"Name Synopsis Severity Level Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. Critical Error Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. Important Error Azure.SQLMI.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL Managed Instances. Important Error Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. Important Error Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Error"},{"location":"en/rules/resource/#storage-account","title":"Storage Account","text":"Name Synopsis Severity Level Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Error Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Error Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Error Azure.Storage.Defender.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Error Azure.Storage.Defender.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Error Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. Critical Error Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Error Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Error Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Error Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Error Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Error Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Error Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Error"},{"location":"en/rules/resource/#subscription","title":"Subscription","text":"Name Synopsis Severity Level Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Error Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Error Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Error Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Error Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Error Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Error"},{"location":"en/rules/resource/#traffic-manager","title":"Traffic Manager","text":"Name Synopsis Severity Level Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Error Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Error"},{"location":"en/rules/resource/#user-assigned-managed-identity","title":"User Assigned Managed Identity","text":"Name Synopsis Severity Level Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Error"},{"location":"en/rules/resource/#virtual-machine","title":"Virtual Machine","text":"Name Synopsis Severity Level Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Error Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Error Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Error Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. Important Error Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Error Azure.VM.ASDistributeTraffic Ensure high availability by distributing traffic among members in an availability set. Important Error Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Error Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Error Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Error Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Error Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Error Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Error Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Error Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Error Azure.VM.MaintenanceConfig Use a maintenance configuration for virtual machines. Important Error Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Error Azure.VM.MultiTenantHosting Deploy Windows 10 and 11 virtual machines in Azure using Multi-tenant Hosting Rights to leverage your existing Windows licenses. Awareness Error Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Error Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Error Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Error Azure.VM.PublicIPAttached Avoid attaching public IPs directly to virtual machines. Critical Error Azure.VM.PublicKey Linux virtual machines should use public keys. Important Error Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Error Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. Important Error Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. Important Error Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Error Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Error Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Error Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Error"},{"location":"en/rules/resource/#virtual-machine-scale-sets","title":"Virtual Machine Scale Sets","text":"Name Synopsis Severity Level Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. Important Error Azure.VMSS.AutoInstanceRepairs Automatic instance repairs are enabled. Important Error Azure.VMSS.AvailabilityZone Deploy virtual machine scale set instances using availability zones in supported regions to ensure high availability and resilience. Important Error Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Error Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Error Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Error Azure.VMSS.PublicIPAttached Avoid attaching public IPs directly to virtual machine scale set instances. Critical Error Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Error Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Error Azure.VMSS.ZoneBalance Deploy virtual machine scale set instances using the best-effort zone balance in supported regions. Important Error"},{"location":"en/rules/resource/#virtual-network","title":"Virtual Network","text":"Name Synopsis Severity Level Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. Important Error Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. Important Error Azure.VNET.FirewallSubnetNAT Zonal-deployed Azure Firewalls should consider using an Azure NAT Gateway for outbound access. Awareness Warning Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Error Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Error Azure.VNET.PeerState VNET peering connections must be connected. Important Error Azure.VNET.PrivateSubnet Disable default outbound access for virtual machines. Critical Error Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Error Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Error Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Error"},{"location":"en/rules/resource/#virtual-network-gateway","title":"Virtual Network Gateway","text":"Name Synopsis Severity Level Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Error Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Error Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Error Azure.VNG.MaintenanceConfig Use a customer-controlled maintenance configuration for virtual network gateways. Important Error Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Error Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Error Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Error Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Error"},{"location":"en/rules/resource/#virtual-wan","title":"Virtual WAN","text":"Name Synopsis Severity Level Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Error"},{"location":"en/rules/resource/#web-pubsub-service","title":"Web PubSub Service","text":"Name Synopsis Severity Level Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Error Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important Error"},{"location":"en/selectors/Azure.AppService.IsAPIApp/","title":"Azure.AppService.IsAPIApp","text":"<p>Azure App Services API apps.</p>"},{"location":"en/selectors/Azure.AppService.IsAPIApp/#description","title":"Description","text":"<p>Use this selector to filter rules to only run against API apps.</p>"},{"location":"en/selectors/Azure.AppService.IsAPIApp/#examples","title":"Examples","text":""},{"location":"en/selectors/Azure.AppService.IsAPIApp/#configure-with-yaml-based-rules","title":"Configure with YAML-based rules","text":"<ul> <li>Use the <code>with</code> property to set <code>PSRule.Rules.Azure\\Azure.AppService.IsAPIApp</code>.</li> </ul> <pre><code>---\n# Synopsis: An example rule.\napiVersion: github.com/microsoft/PSRule/v1\nkind: Rule\nmetadata:\n  name: Local.MyRule\nspec:\n  with:\n  - PSRule.Rules.Azure\\Azure.AppService.IsAPIApp\n  condition:\n    # Rule logic goes here\n</code></pre>"},{"location":"en/selectors/Azure.AppService.IsAPIApp/#configure-with-json-based-rules","title":"Configure with JSON-based rules","text":"<ul> <li>Use the <code>with</code> property to set <code>PSRule.Rules.Azure\\Azure.AppService.IsAPIApp</code>.</li> </ul> <pre><code>{\n    // Synopsis: An example rule.\n    \"apiVersion\": \"github.com/microsoft/PSRule/v1\",\n    \"kind\": \"Rule\",\n    \"metadata\": {\n        \"name\": \"Local.MyRule\"\n    },\n    \"spec\": {\n        \"with\": [\n            \"PSRule.Rules.Azure\\\\Azure.AppService.IsAPIApp\"\n        ],\n        \"condition\": {\n            // Rule logic goes here\n        }\n    }\n}\n</code></pre>"},{"location":"en/selectors/Azure.AppService.IsAPIApp/#configure-with-powershell-based-rules","title":"Configure with PowerShell-based rules","text":"<ul> <li>Use the <code>-With</code> parameter to set <code>PSRule.Rules.Azure\\Azure.AppService.IsAPIApp</code>.</li> </ul> <pre><code># Synopsis: An example rule.\nRule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.AppService.IsAPIApp' {\n  # Rule logic goes here\n}\n</code></pre>"},{"location":"en/selectors/Azure.AppService.IsFunctionApp/","title":"Azure.AppService.IsFunctionApp","text":"<p>Azure App Services function apps.</p>"},{"location":"en/selectors/Azure.AppService.IsFunctionApp/#description","title":"Description","text":"<p>Use this selector to filter rules to only run against Azure Functions apps.</p>"},{"location":"en/selectors/Azure.AppService.IsFunctionApp/#examples","title":"Examples","text":""},{"location":"en/selectors/Azure.AppService.IsFunctionApp/#configure-with-yaml-based-rules","title":"Configure with YAML-based rules","text":"<ul> <li>Use the <code>with</code> property to set <code>PSRule.Rules.Azure\\Azure.AppService.IsFunctionApp</code>.</li> </ul> <pre><code>---\n# Synopsis: An example rule.\napiVersion: github.com/microsoft/PSRule/v1\nkind: Rule\nmetadata:\n  name: Local.MyRule\nspec:\n  with:\n  - PSRule.Rules.Azure\\Azure.AppService.IsFunctionApp\n  condition:\n    # Rule logic goes here\n</code></pre>"},{"location":"en/selectors/Azure.AppService.IsFunctionApp/#configure-with-json-based-rules","title":"Configure with JSON-based rules","text":"<ul> <li>Use the <code>with</code> property to set <code>PSRule.Rules.Azure\\Azure.AppService.IsFunctionApp</code>.</li> </ul> <pre><code>{\n    // Synopsis: An example rule.\n    \"apiVersion\": \"github.com/microsoft/PSRule/v1\",\n    \"kind\": \"Rule\",\n    \"metadata\": {\n        \"name\": \"Local.MyRule\"\n    },\n    \"spec\": {\n        \"with\": [\n            \"PSRule.Rules.Azure\\\\Azure.AppService.IsFunctionApp\"\n        ],\n        \"condition\": {\n            // Rule logic goes here\n        }\n    }\n}\n</code></pre>"},{"location":"en/selectors/Azure.AppService.IsFunctionApp/#configure-with-powershell-based-rules","title":"Configure with PowerShell-based rules","text":"<ul> <li>Use the <code>-With</code> parameter to set <code>PSRule.Rules.Azure\\Azure.AppService.IsFunctionApp</code>.</li> </ul> <pre><code># Synopsis: An example rule.\nRule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.AppService.IsFunctionApp' {\n  # Rule logic goes here\n}\n</code></pre>"},{"location":"en/selectors/Azure.AppService.IsLogicApp/","title":"Azure.AppService.IsLogicApp","text":"<p>Single tenanted Logic Apps.</p>"},{"location":"en/selectors/Azure.AppService.IsLogicApp/#description","title":"Description","text":"<p>Use this selector to filter rules to only run against Logic Apps with the Standard SKU.</p>"},{"location":"en/selectors/Azure.AppService.IsLogicApp/#examples","title":"Examples","text":""},{"location":"en/selectors/Azure.AppService.IsLogicApp/#configure-with-yaml-based-rules","title":"Configure with YAML-based rules","text":"<ul> <li>Use the <code>with</code> property to set <code>PSRule.Rules.Azure\\Azure.AppService.IsLogicApp</code>.</li> </ul> <pre><code>---\n# Synopsis: An example rule.\napiVersion: github.com/microsoft/PSRule/v1\nkind: Rule\nmetadata:\n  name: Local.MyRule\nspec:\n  with:\n  - PSRule.Rules.Azure\\Azure.AppService.IsLogicApp\n  condition:\n    # Rule logic goes here\n</code></pre>"},{"location":"en/selectors/Azure.AppService.IsLogicApp/#configure-with-json-based-rules","title":"Configure with JSON-based rules","text":"<ul> <li>Use the <code>with</code> property to set <code>PSRule.Rules.Azure\\Azure.AppService.IsLogicApp</code>.</li> </ul> <pre><code>{\n    // Synopsis: An example rule.\n    \"apiVersion\": \"github.com/microsoft/PSRule/v1\",\n    \"kind\": \"Rule\",\n    \"metadata\": {\n        \"name\": \"Local.MyRule\"\n    },\n    \"spec\": {\n        \"with\": [\n            \"PSRule.Rules.Azure\\\\Azure.AppService.IsLogicApp\"\n        ],\n        \"condition\": {\n            // Rule logic goes here\n        }\n    }\n}\n</code></pre>"},{"location":"en/selectors/Azure.AppService.IsLogicApp/#configure-with-powershell-based-rules","title":"Configure with PowerShell-based rules","text":"<ul> <li>Use the <code>-With</code> parameter to set <code>PSRule.Rules.Azure\\Azure.AppService.IsLogicApp</code>.</li> </ul> <pre><code># Synopsis: An example rule.\nRule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.AppService.IsLogicApp' {\n  # Rule logic goes here\n}\n</code></pre>"},{"location":"en/selectors/Azure.AppService.IsWebApp/","title":"Azure.AppService.IsWebApp","text":"<p>Azure App Services web apps.</p>"},{"location":"en/selectors/Azure.AppService.IsWebApp/#description","title":"Description","text":"<p>Use this selector to filter rules to only run against web apps.</p>"},{"location":"en/selectors/Azure.AppService.IsWebApp/#examples","title":"Examples","text":""},{"location":"en/selectors/Azure.AppService.IsWebApp/#configure-with-yaml-based-rules","title":"Configure with YAML-based rules","text":"<ul> <li>Use the <code>with</code> property to set <code>PSRule.Rules.Azure\\Azure.AppService.IsWebApp</code>.</li> </ul> <pre><code>---\n# Synopsis: An example rule.\napiVersion: github.com/microsoft/PSRule/v1\nkind: Rule\nmetadata:\n  name: Local.MyRule\nspec:\n  with:\n  - PSRule.Rules.Azure\\Azure.AppService.IsWebApp\n  condition:\n    # Rule logic goes here\n</code></pre>"},{"location":"en/selectors/Azure.AppService.IsWebApp/#configure-with-json-based-rules","title":"Configure with JSON-based rules","text":"<ul> <li>Use the <code>with</code> property to set <code>PSRule.Rules.Azure\\Azure.AppService.IsWebApp</code>.</li> </ul> <pre><code>{\n    // Synopsis: An example rule.\n    \"apiVersion\": \"github.com/microsoft/PSRule/v1\",\n    \"kind\": \"Rule\",\n    \"metadata\": {\n        \"name\": \"Local.MyRule\"\n    },\n    \"spec\": {\n        \"with\": [\n            \"PSRule.Rules.Azure\\\\Azure.AppService.IsWebApp\"\n        ],\n        \"condition\": {\n            // Rule logic goes here\n        }\n    }\n}\n</code></pre>"},{"location":"en/selectors/Azure.AppService.IsWebApp/#configure-with-powershell-based-rules","title":"Configure with PowerShell-based rules","text":"<ul> <li>Use the <code>-With</code> parameter to set <code>PSRule.Rules.Azure\\Azure.AppService.IsWebApp</code>.</li> </ul> <pre><code># Synopsis: An example rule.\nRule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.AppService.IsWebApp' {\n  # Rule logic goes here\n}\n</code></pre>"},{"location":"en/selectors/Azure.FrontDoor.IsClassic/","title":"AAzure.FrontDoor.IsClassic","text":"<p>Azure Front Door profiles using the Classic SKU.</p>"},{"location":"en/selectors/Azure.FrontDoor.IsClassic/#description","title":"Description","text":"<p>Use this selector to filter rules to only run against Azure Front Door profiles using the Classic SKU.</p>"},{"location":"en/selectors/Azure.FrontDoor.IsClassic/#examples","title":"Examples","text":""},{"location":"en/selectors/Azure.FrontDoor.IsClassic/#configure-with-yaml-based-rules","title":"Configure with YAML-based rules","text":"<ul> <li>Use the <code>with</code> property to set <code>PSRule.Rules.Azure\\Azure.FrontDoor.IsClassic</code>.</li> </ul> <pre><code>---\n# Synopsis: An example rule.\napiVersion: github.com/microsoft/PSRule/v1\nkind: Rule\nmetadata:\n  name: Local.MyRule\nspec:\n  with:\n  - PSRule.Rules.Azure\\Azure.FrontDoor.IsClassic\n  condition:\n    # Rule logic goes here\n</code></pre>"},{"location":"en/selectors/Azure.FrontDoor.IsClassic/#configure-with-json-based-rules","title":"Configure with JSON-based rules","text":"<ul> <li>Use the <code>with</code> property to set <code>PSRule.Rules.Azure\\Azure.FrontDoor.IsClassic</code>.</li> </ul> <pre><code>{\n    // Synopsis: An example rule.\n    \"apiVersion\": \"github.com/microsoft/PSRule/v1\",\n    \"kind\": \"Rule\",\n    \"metadata\": {\n        \"name\": \"Local.MyRule\"\n    },\n    \"spec\": {\n        \"with\": [\n            \"PSRule.Rules.Azure\\\\Azure.FrontDoor.IsClassic\"\n        ],\n        \"condition\": {\n            // Rule logic goes here\n        }\n    }\n}\n</code></pre>"},{"location":"en/selectors/Azure.FrontDoor.IsClassic/#configure-with-powershell-based-rules","title":"Configure with PowerShell-based rules","text":"<ul> <li>Use the <code>-With</code> parameter to set <code>PSRule.Rules.Azure\\Azure.FrontDoor.IsClassic</code>.</li> </ul> <pre><code># Synopsis: An example rule.\nRule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.FrontDoor.IsClassic' {\n  # Rule logic goes here\n}\n</code></pre>"},{"location":"en/selectors/Azure.FrontDoor.IsStandardOrPremium/","title":"Azure.FrontDoor.IsStandardOrPremium","text":"<p>Azure Front Door profiles using the Standard or Premium SKU.</p>"},{"location":"en/selectors/Azure.FrontDoor.IsStandardOrPremium/#description","title":"Description","text":"<p>Use this selector to filter rules to only run against Azure Front Door profiles using the Standard or Premium SKU.</p>"},{"location":"en/selectors/Azure.FrontDoor.IsStandardOrPremium/#examples","title":"Examples","text":""},{"location":"en/selectors/Azure.FrontDoor.IsStandardOrPremium/#configure-with-yaml-based-rules","title":"Configure with YAML-based rules","text":"<ul> <li>Use the <code>with</code> property to set <code>PSRule.Rules.Azure\\Azure.FrontDoor.IsStandardOrPremium</code>.</li> </ul> <pre><code>---\n# Synopsis: An example rule.\napiVersion: github.com/microsoft/PSRule/v1\nkind: Rule\nmetadata:\n  name: Local.MyRule\nspec:\n  with:\n  - PSRule.Rules.Azure\\Azure.FrontDoor.IsStandardOrPremium\n  condition:\n    # Rule logic goes here\n</code></pre>"},{"location":"en/selectors/Azure.FrontDoor.IsStandardOrPremium/#configure-with-json-based-rules","title":"Configure with JSON-based rules","text":"<ul> <li>Use the <code>with</code> property to set <code>PSRule.Rules.Azure\\Azure.FrontDoor.IsStandardOrPremium</code>.</li> </ul> <pre><code>{\n    // Synopsis: An example rule.\n    \"apiVersion\": \"github.com/microsoft/PSRule/v1\",\n    \"kind\": \"Rule\",\n    \"metadata\": {\n        \"name\": \"Local.MyRule\"\n    },\n    \"spec\": {\n        \"with\": [\n            \"PSRule.Rules.Azure\\\\Azure.FrontDoor.IsStandardOrPremium\"\n        ],\n        \"condition\": {\n            // Rule logic goes here\n        }\n    }\n}\n</code></pre>"},{"location":"en/selectors/Azure.FrontDoor.IsStandardOrPremium/#configure-with-powershell-based-rules","title":"Configure with PowerShell-based rules","text":"<ul> <li>Use the <code>-With</code> parameter to set <code>PSRule.Rules.Azure\\Azure.FrontDoor.IsStandardOrPremium</code>.</li> </ul> <pre><code># Synopsis: An example rule.\nRule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.FrontDoor.IsStandardOrPremium' {\n  # Rule logic goes here\n}\n</code></pre>"},{"location":"en/selectors/Azure.Resource.SupportsTags/","title":"Azure.Resource.SupportsTags","text":"<p>Resources that supports tags.</p>"},{"location":"en/selectors/Azure.Resource.SupportsTags/#description","title":"Description","text":"<p>Use this selector to filter rules to only run against resources that support tags.</p>"},{"location":"en/selectors/Azure.Resource.SupportsTags/#examples","title":"Examples","text":""},{"location":"en/selectors/Azure.Resource.SupportsTags/#configure-with-yaml-based-rules","title":"Configure with YAML-based rules","text":"<ul> <li>Use the <code>with</code> property to set <code>PSRule.Rules.Azure\\Azure.Resource.SupportsTags</code>.</li> </ul> <pre><code>---\n# Synopsis: An example rule.\napiVersion: github.com/microsoft/PSRule/v1\nkind: Rule\nmetadata:\n  name: Local.MyRule\nspec:\n  with:\n  - PSRule.Rules.Azure\\Azure.Resource.SupportsTags\n  condition:\n    # Rule logic goes here\n</code></pre>"},{"location":"en/selectors/Azure.Resource.SupportsTags/#configure-with-json-based-rules","title":"Configure with JSON-based rules","text":"<ul> <li>Use the <code>with</code> property to set <code>PSRule.Rules.Azure\\Azure.Resource.SupportsTags</code>.</li> </ul> <pre><code>{\n    // Synopsis: An example rule.\n    \"apiVersion\": \"github.com/microsoft/PSRule/v1\",\n    \"kind\": \"Rule\",\n    \"metadata\": {\n        \"name\": \"Local.MyRule\"\n    },\n    \"spec\": {\n        \"with\": [\n            \"PSRule.Rules.Azure\\\\Azure.Resource.SupportsTags\"\n        ],\n        \"condition\": {\n            // Rule logic goes here\n        }\n    }\n}\n</code></pre>"},{"location":"en/selectors/Azure.Resource.SupportsTags/#configure-with-powershell-based-rules","title":"Configure with PowerShell-based rules","text":"<ul> <li>Use the <code>-With</code> parameter to set <code>PSRule.Rules.Azure\\Azure.Resource.SupportsTags</code>.</li> </ul> <pre><code># Synopsis: An example rule.\nRule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.Resource.SupportsTags' {\n  # Rule logic goes here\n}\n</code></pre>"},{"location":"en/selectors/Azure.ServiceBus.IsPremium/","title":"Azure.ServiceBus.IsPremium","text":"<p>Azure Service Bus premium namespaces.</p>"},{"location":"en/selectors/Azure.ServiceBus.IsPremium/#description","title":"Description","text":"<p>Use this selector to filter rules to only run against premium Service Bus namespaces.</p>"},{"location":"en/selectors/Azure.ServiceBus.IsPremium/#examples","title":"Examples","text":""},{"location":"en/selectors/Azure.ServiceBus.IsPremium/#configure-with-yaml-based-rules","title":"Configure with YAML-based rules","text":"<ul> <li>Use the <code>with</code> property to set <code>PSRule.Rules.Azure\\Azure.ServiceBus.IsPremium</code>.</li> </ul> <pre><code>---\n# Synopsis: An example rule.\napiVersion: github.com/microsoft/PSRule/v1\nkind: Rule\nmetadata:\n  name: Local.MyRule\nspec:\n  with:\n  - PSRule.Rules.Azure\\Azure.ServiceBus.IsPremium\n  condition:\n    # Rule logic goes here\n</code></pre>"},{"location":"en/selectors/Azure.ServiceBus.IsPremium/#configure-with-json-based-rules","title":"Configure with JSON-based rules","text":"<ul> <li>Use the <code>with</code> property to set <code>PSRule.Rules.Azure\\Azure.ServiceBus.IsPremium</code>.</li> </ul> <pre><code>{\n    // Synopsis: An example rule.\n    \"apiVersion\": \"github.com/microsoft/PSRule/v1\",\n    \"kind\": \"Rule\",\n    \"metadata\": {\n        \"name\": \"Local.MyRule\"\n    },\n    \"spec\": {\n        \"with\": [\n            \"PSRule.Rules.Azure\\\\Azure.ServiceBus.IsPremium\"\n        ],\n        \"condition\": {\n            // Rule logic goes here\n        }\n    }\n}\n</code></pre>"},{"location":"en/selectors/Azure.ServiceBus.IsPremium/#configure-with-powershell-based-rules","title":"Configure with PowerShell-based rules","text":"<ul> <li>Use the <code>-With</code> parameter to set <code>PSRule.Rules.Azure\\Azure.ServiceBus.IsPremium</code>.</li> </ul> <pre><code># Synopsis: An example rule.\nRule 'Local.MyRule' -With 'PSRule.Rules.Azure\\Azure.ServiceBus.IsPremium' {\n  # Rule logic goes here\n}\n</code></pre>"},{"location":"es/asb-v3/","title":"Azure Security Benchmark","text":"<p>Azure Security Benchmark (ASB) es un conjunto de controles y recomendaciones que ayudan a mejorar la seguridad de las cargas de trabajo en Azure. Los controles del ASB tambi\u00e9n se asignan a los marcos de la industria, como CIS, PCI-DSS y NIST. Si esta es su primera introduccion a ASB o esta busecano por ayudo a como utilizarlo, refiera a la Introducci\u00f3n a Azure Security Benchmark</p>"},{"location":"es/asb-v3/#azure-security-benchmark-v3","title":"Azure Security Benchmark v3","text":"<p>Esta es la versi\u00f3n mas reciente del ASB. Las reglas incluidas en PSRule para Azure se han asignado a v3 para que pueda comprender el impacto de las reglas. Esto es particularmente \u00fatil cuando busca comprender c\u00f3mo abordar un requisito de cumplimiento espec\u00edfico de su organizaci\u00f3n.</p> <p>Los siguientes controles est\u00e1n incluidos en Azure Security Benchmark v3:</p> <ul> <li>Seguridad de red (NS)</li> <li>Administraci\u00f3n de identidades (IM)</li> <li>Acceso con privilegios (PA)</li> <li>Protecci\u00f3n de datos (DP)</li> <li>Administraci\u00f3n de recursos (AM)</li> <li>Registro y detecci\u00f3n de amenazas (LT)</li> <li>Respuesta a incidentes IR)</li> <li>Posici\u00f3n y administraci\u00f3n de vulnerabilidades (PV)</li> <li>Seguridad de los puntos de conexi\u00f3n (ES)</li> <li>Copia de seguridad y recuperaci\u00f3n (BR)</li> <li>Seguridad de DevOps (DS)</li> <li> <p>Gobernanza y estrategia (GS)</p> </li> </ul>"},{"location":"es/asb-v3/#links","title":"Links","text":"<ul> <li>Introducci\u00f3n a los controles de seguridad de Azure (v3)</li> </ul>"},{"location":"es/rules/","title":"Reference","text":"<p>The following rules and features are included in PSRule for Azure.</p> <p>Info</p> <p>The rule release indicates if the Azure feature is generally available (GA) or available under preview. Features provided under previews may have additional limits, availability restrictions, or terms. By default, PSRule for Azure will not provide recommendations that relate to preview features. To include rules for preview features see working with baselines.</p>"},{"location":"es/rules/#rules","title":"Rules","text":"<p>The following rules are included in PSRule for Azure.</p> Reference Name Synopsis Release AZR-000001 Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. GA AZR-000002 Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. GA AZR-000003 Azure.ACR.ImageHealth Remove container images with known vulnerabilities. GA AZR-000004 Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. GA AZR-000005 Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. GA AZR-000006 Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. GA AZR-000007 Azure.ACR.Name Container registry names should meet naming requirements. GA AZR-000008 Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Preview AZR-000009 Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. GA AZR-000010 Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Preview AZR-000011 Azure.ADX.Usage Regularly remove unused resources to reduce costs. GA AZR-000012 Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. GA AZR-000013 Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. GA AZR-000014 Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. GA AZR-000015 Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. GA AZR-000016 Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. GA AZR-000017 Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. GA AZR-000018 Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. GA AZR-000019 Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. GA AZR-000020 Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. GA AZR-000021 Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. GA AZR-000022 Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. GA AZR-000023 Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. GA AZR-000024 Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. GA AZR-000025 Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. GA AZR-000026 Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. GA AZR-000027 Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. GA AZR-000028 Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. GA AZR-000029 Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. GA AZR-000030 Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. GA AZR-000031 Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. GA AZR-000032 Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. GA AZR-000033 Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. GA AZR-000034 Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. GA AZR-000035 Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. GA AZR-000036 Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. GA AZR-000038 Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. GA AZR-000039 Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. GA AZR-000040 Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. GA AZR-000041 Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. GA AZR-000042 Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. GA AZR-000043 Azure.APIM.APIDescriptors APIs should have a display name and description. GA AZR-000044 Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. GA AZR-000045 Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. GA AZR-000046 Azure.APIM.ProductSubscription Configure products to require a subscription. GA AZR-000047 Azure.APIM.ProductApproval Configure products to require approval. GA AZR-000048 Azure.APIM.SampleProducts Remove starter and unlimited sample products. GA AZR-000049 Azure.APIM.ProductDescriptors API Management products should have a display name and description. GA AZR-000050 Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. GA AZR-000051 Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. GA AZR-000052 Azure.APIM.AvailabilityZone API Management instances should use availability zones in supported regions for high availability. GA AZR-000053 Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. GA AZR-000054 Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. GA AZR-000055 Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. GA AZR-000056 Azure.APIM.Name API Management service names should meet naming requirements. GA AZR-000057 Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. GA AZR-000058 Azure.AppConfig.Name App Configuration store names should meet naming requirements. GA AZR-000059 Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. GA AZR-000060 Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. GA AZR-000061 Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. GA AZR-000062 Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. GA AZR-000063 Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. GA AZR-000064 Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. GA AZR-000065 Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. GA AZR-000066 Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. GA AZR-000067 Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. GA AZR-000068 Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. GA AZR-000069 Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. GA AZR-000070 Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. GA AZR-000071 Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. GA AZR-000072 Azure.AppService.MinPlan Use at least a Standard App Service Plan. GA AZR-000073 Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. GA AZR-000074 Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. GA AZR-000075 Azure.AppService.NETVersion Configure applications to use newer .NET versions. GA AZR-000076 Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. GA AZR-000077 Azure.AppService.AlwaysOn Configure Always On for App Service apps. GA AZR-000078 Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. GA AZR-000079 Azure.AppService.WebProbe Configure and enable instance health probes. GA AZR-000080 Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. GA AZR-000081 Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. GA AZR-000082 Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. GA AZR-000083 Azure.AppService.ARRAffinity Disable client affinity for stateless services. GA AZR-000084 Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. GA AZR-000085 Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. GA AZR-000086 Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. GA AZR-000087 Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). GA AZR-000088 Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. GA AZR-000089 Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. GA AZR-000090 Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. GA AZR-000091 Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. GA AZR-000092 Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. GA AZR-000093 Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. GA AZR-000094 Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. GA AZR-000095 Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. GA AZR-000096 Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. GA AZR-000097 Azure.DataFactory.Version Consider migrating to DataFactory v2. GA AZR-000098 Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. GA AZR-000099 Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. GA AZR-000100 Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. GA AZR-000101 Azure.EventHub.Usage Regularly remove unused resources to reduce costs. GA AZR-000102 Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. GA AZR-000103 Azure.Firewall.Name Firewall names should meet naming requirements. GA AZR-000104 Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. GA AZR-000105 Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. GA AZR-000106 Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. GA AZR-000107 Azure.FrontDoor.Logs Audit and monitor access through Azure Front Door profiles. GA AZR-000108 Azure.FrontDoor.Probe Use health probes to check the health of each backend. GA AZR-000109 Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. GA AZR-000110 Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. GA AZR-000111 Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. GA AZR-000112 Azure.FrontDoor.State Enable Azure Front Door Classic instance. GA AZR-000113 Azure.FrontDoor.Name Front Door names should meet naming requirements. GA AZR-000114 Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. GA AZR-000115 Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. GA AZR-000116 Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. GA AZR-000117 Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. GA AZR-000118 Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. GA AZR-000119 Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. GA AZR-000120 Azure.KeyVault.Name Key Vault names should meet naming requirements. GA AZR-000121 Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. GA AZR-000122 Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. GA AZR-000123 Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. GA AZR-000124 Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. GA AZR-000125 Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. GA AZR-000126 Azure.LB.Probe Use a specific probe for web protocols. GA AZR-000127 Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. GA AZR-000128 Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. GA AZR-000129 Azure.LB.Name Load Balancer names should meet naming requirements. GA AZR-000130 Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. GA AZR-000131 Azure.MySQL.UseSSL Enforce encrypted MySQL connections. GA AZR-000132 Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. GA AZR-000133 Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. GA AZR-000134 Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. GA AZR-000135 Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. GA AZR-000136 Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. GA AZR-000137 Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. GA AZR-000138 Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. GA AZR-000139 Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. GA AZR-000140 Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. GA AZR-000141 Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. GA AZR-000142 Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. GA AZR-000143 Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. GA AZR-000144 Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. GA AZR-000145 Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. GA AZR-000146 Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. GA AZR-000147 Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. GA AZR-000148 Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. GA AZR-000149 Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. GA AZR-000150 Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. GA AZR-000151 Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. GA AZR-000152 Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. GA AZR-000153 Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. GA AZR-000154 Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. GA AZR-000155 Azure.PublicIP.Name Public IP names should meet naming requirements. GA AZR-000156 Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. GA AZR-000157 Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. GA AZR-000158 Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. GA AZR-000159 Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. GA AZR-000160 Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. GA AZR-000161 Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. GA AZR-000162 Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. GA AZR-000163 Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. GA AZR-000164 Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. GA AZR-000165 Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. GA AZR-000166 Azure.Resource.UseTags Azure resources should be tagged using a standard convention. GA AZR-000167 Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. GA AZR-000168 Azure.ResourceGroup.Name Resource Group names should meet naming requirements. GA AZR-000169 Azure.Route.Name Route table names should meet naming requirements. GA AZR-000170 Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. GA AZR-000171 Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. GA AZR-000172 Azure.Search.SKU Use the basic and standard tiers for entry level workloads. GA AZR-000173 Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. GA AZR-000174 Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. GA AZR-000175 Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. GA AZR-000176 Azure.Search.Name AI Search service names should meet naming requirements. GA AZR-000177 Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. GA AZR-000178 Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. GA AZR-000179 Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. GA AZR-000180 Azure.SignalR.Name SignalR service instance names should meet naming requirements. GA AZR-000181 Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. GA AZR-000182 Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. GA AZR-000183 Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. GA AZR-000184 Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. GA AZR-000185 Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. GA AZR-000186 Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. GA AZR-000187 Azure.SQL.Auditing Enable auditing for Azure SQL logical server. GA AZR-000188 Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. GA AZR-000189 Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. GA AZR-000190 Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. GA AZR-000191 Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. GA AZR-000192 Azure.SQL.DBName Azure SQL Database names should meet naming requirements. GA AZR-000193 Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. GA AZR-000194 Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. GA AZR-000195 Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. GA AZR-000196 Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. GA AZR-000197 Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. GA AZR-000198 Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. GA AZR-000199 Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. GA AZR-000200 Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. GA AZR-000201 Azure.Storage.Name Storage Account names should meet naming requirements. GA AZR-000202 Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. GA AZR-000203 Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. GA AZR-000204 Azure.RBAC.LimitOwner Limit the number of subscription Owners. GA AZR-000205 Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. GA AZR-000206 Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). GA AZR-000207 Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. GA AZR-000208 Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. GA AZR-000209 Azure.Defender.SecurityContact Important security notifications may be lost or not processed in a timely manner when a clear security contact is not identified. GA AZR-000210 Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. GA AZR-000211 Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. GA AZR-000212 Azure.Template.TemplateFile Use ARM template files that are valid. GA AZR-000213 Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. GA AZR-000214 Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. GA AZR-000215 Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. GA AZR-000216 Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. GA AZR-000217 Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. deprecated AZR-000218 Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. deprecated AZR-000219 Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. deprecated AZR-000220 Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. GA AZR-000221 Azure.Template.LocationType Location parameters should use a string value. GA AZR-000222 Azure.Template.ResourceLocation Resource locations should be an expression or global. GA AZR-000223 Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. GA AZR-000224 Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. GA AZR-000225 Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. GA AZR-000226 Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. GA AZR-000227 Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. GA AZR-000228 Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. GA AZR-000229 Azure.Template.ParameterFile Use ARM template parameter files that are valid. GA AZR-000230 Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. GA AZR-000231 Azure.Template.MetadataLink Configure a metadata link for each parameter file. GA AZR-000232 Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. GA AZR-000233 Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. deprecated AZR-000234 Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. GA AZR-000235 Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. GA AZR-000236 Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. GA AZR-000237 Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. GA AZR-000238 Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. GA AZR-000239 Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. GA AZR-000240 Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. GA AZR-000241 Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. GA AZR-000242 Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. GA AZR-000243 Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. GA AZR-000244 Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. GA AZR-000245 Azure.VM.PublicKey Linux virtual machines should use public keys. GA AZR-000246 Azure.VM.Agent Ensure the VM agent is provisioned automatically. GA AZR-000247 Azure.VM.Updates Ensure automatic updates are enabled at deployment. GA AZR-000248 Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. GA AZR-000249 Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. GA AZR-000250 Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. GA AZR-000251 Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. GA AZR-000252 Azure.VM.ADE Use Azure Disk Encryption (ADE). GA AZR-000253 Azure.VM.DiskName Managed Disk names should meet naming requirements. GA AZR-000254 Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. GA AZR-000255 Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). GA AZR-000256 Azure.VM.ASName Availability Set names should meet naming requirements. GA AZR-000257 Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. GA AZR-000258 Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. GA AZR-000259 Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. GA AZR-000260 Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. GA AZR-000261 Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. GA AZR-000262 Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. GA AZR-000263 Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. GA AZR-000264 Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. GA AZR-000265 Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. GA AZR-000266 Azure.VNET.PeerState VNET peering connections must be connected. GA AZR-000267 Azure.VNET.SubnetName Subnet names should meet naming requirements. GA AZR-000268 Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. GA AZR-000269 Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. GA AZR-000270 Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. GA AZR-000271 Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. GA AZR-000272 Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. GA AZR-000273 Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. GA AZR-000274 Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. GA AZR-000275 Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. GA AZR-000276 Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. GA AZR-000277 Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. GA AZR-000278 Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. GA AZR-000279 Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. GA AZR-000280 Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. GA AZR-000281 Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. GA AZR-000282 Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. GA AZR-000283 Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. GA AZR-000284 Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. GA AZR-000285 Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. GA AZR-000286 Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. GA AZR-000287 Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. GA AZR-000288 Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. GA AZR-000289 Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. GA AZR-000290 Azure.Defender.Containers Enable Microsoft Defender for Containers. GA AZR-000291 Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. GA AZR-000292 Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. GA AZR-000293 Azure.Defender.Servers Enable Microsoft Defender for Servers. GA AZR-000294 Azure.Defender.SQL Enable Microsoft Defender for SQL servers. GA AZR-000295 Azure.Defender.AppServices Enable Microsoft Defender for App Service. GA AZR-000296 Azure.Defender.Storage Enable Microsoft Defender for Storage. GA AZR-000297 Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. GA AZR-000298 Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. GA AZR-000299 Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. GA AZR-000300 Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. GA AZR-000301 Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. GA AZR-000302 Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. GA AZR-000303 Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. GA AZR-000304 Azure.AppGwWAF.RuleGroups Use recommended rule groups in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. GA AZR-000305 Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. GA AZR-000306 Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. GA AZR-000307 Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. GA AZR-000308 Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. GA AZR-000309 Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. GA AZR-000310 Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Preview AZR-000311 Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. GA AZR-000312 Azure.AppConfig.GeoReplica Replicate app configuration store across all points of presence for an application. GA AZR-000313 Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. GA AZR-000314 Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. GA AZR-000315 Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. GA AZR-000316 Azure.Deployment.SecureValue A secret property set from a non-secure value may leak the secret into deployment history or logs. GA AZR-000317 Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. GA AZR-000318 Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. GA AZR-000319 Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. GA AZR-000320 Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. GA AZR-000321 Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. GA AZR-000322 Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. GA AZR-000323 Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. GA AZR-000324 Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. GA AZR-000325 Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. GA AZR-000326 Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. GA AZR-000327 Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. GA AZR-000328 Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. GA AZR-000329 Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. GA AZR-000330 Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. GA AZR-000331 Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. GA AZR-000332 Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. GA AZR-000333 Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. GA AZR-000334 Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. GA AZR-000335 Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. GA AZR-000336 Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. GA AZR-000337 Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. GA AZR-000338 Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. GA AZR-000339 Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. GA AZR-000340 Azure.APIM.MultiRegion Enhance service availability and resilience by deploying API Management instances across multiple regions. GA AZR-000341 Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. GA AZR-000342 Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. GA AZR-000343 Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. GA AZR-000344 Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. GA AZR-000345 Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. GA AZR-000346 Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. GA AZR-000347 Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. GA AZR-000348 Azure.AppGw.Name Application Gateways should meet naming requirements. GA AZR-000349 Azure.Bastion.Name Bastion hosts should meet naming requirements. GA AZR-000350 Azure.RSV.Name Recovery Services vaults should meet naming requirements. GA AZR-000351 Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. GA AZR-000352 Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. GA AZR-000353 Azure.Defender.Dns Enable Microsoft Defender for DNS. GA AZR-000354 Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). GA AZR-000355 Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. GA AZR-000356 Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. GA AZR-000357 Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. GA AZR-000358 Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. GA AZR-000359 Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. GA AZR-000360 Azure.ContainerApp.Name Container Apps should meet naming requirements. GA AZR-000361 Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. GA AZR-000362 Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. GA AZR-000363 Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. GA AZR-000364 Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. GA AZR-000365 Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. GA AZR-000366 Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. GA AZR-000367 Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. GA AZR-000368 Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. GA AZR-000369 Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. GA AZR-000370 Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. GA AZR-000371 Azure.APIM.PolicyBase Base element for any policy element in a section should be configured. GA AZR-000372 Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. GA AZR-000373 Azure.Arc.Kubernetes.Defender Deploy Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters. Preview AZR-000374 Azure.Arc.Server.MaintenanceConfig Use a maintenance configuration for Arc-enabled servers. Preview AZR-000375 Azure.VM.MaintenanceConfig Use a maintenance configuration for virtual machines. GA AZR-000376 Azure.AppGw.MigrateV2 Use a Application Gateway v2 SKU. GA AZR-000377 Azure.Defender.Api Enable Microsoft Defender for APIs. GA AZR-000378 Azure.ContainerApp.DisableAffinity Disable session affinity to prevent unbalanced distribution. GA AZR-000379 Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. GA AZR-000380 Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. GA AZR-000381 Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. GA AZR-000382 Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. GA AZR-000383 Azure.Defender.Storage.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. GA AZR-000384 Azure.Storage.Defender.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. GA AZR-000385 Azure.Defender.Storage.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Preview AZR-000386 Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. GA AZR-000387 Azure.APIM.DefenderCloud APIs published in Azure API Management should be onboarded to Microsoft Defender for APIs. GA AZR-000388 Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. GA AZR-000389 Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. GA AZR-000390 Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. GA AZR-000391 Azure.Storage.Defender.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Preview AZR-000392 Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. GA AZR-000393 Azure.Databricks.SecureConnectivity Use Databricks workspaces configured for secure cluster connectivity. GA AZR-000394 Azure.MySQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases. GA AZR-000395 Azure.PublicIP.MigrateStandard Use the Standard SKU for Public IP addresses as the Basic SKU will be retired. GA AZR-000396 Azure.FrontDoor.ManagedIdentity Ensure Front Door uses a managed identity to authorize access to Azure resources. GA AZR-000397 Azure.RSV.Immutable Ensure immutability is configured to protect backup data. GA AZR-000398 Azure.BV.Immutable Ensure immutability is configured to protect backup data. GA AZR-000399 Azure.Firewall.PolicyMode Deny high confidence malicious IP addresses, domains and URLs. GA AZR-000400 Azure.ContainerApp.APIVersion Migrate from retired API version to a supported version. GA AZR-000401 Azure.ACR.AnonymousAccess Anonymous pull access allows unidentified downloading of images and metadata from a container registry. Preview AZR-000402 Azure.ACR.Firewall Container Registry without restrictions can be accessed from any network location including the Internet. GA AZR-000403 Azure.ML.ComputeIdleShutdown Configure an idle shutdown timeout for Machine Learning compute instances. GA AZR-000404 Azure.ML.DisableLocalAuth Azure Machine Learning compute resources should have local authentication methods disabled. GA AZR-000405 Azure.ML.ComputeVnet Azure Machine Learning Computes should be hosted in a virtual network (VNet). GA AZR-000406 Azure.ML.PublicAccess Disable public network access from a Azure Machine Learning workspace. GA AZR-000407 Azure.ML.UserManagedIdentity ML workspaces should use user-assigned managed identity, rather than the default system-assigned managed identity. GA AZR-000408 Azure.Deployment.SecureParameter Sensitive parameters that have been not been marked as secure may leak the secret into deployment history or logs. GA AZR-000409 Azure.Databricks.SKU Ensure Databricks workspaces are non-trial SKUs for production workloads. GA AZR-000410 Azure.Databricks.PublicAccess Azure Databricks workspaces should disable public network access. GA AZR-000411 Azure.DevBox.ProjectLimit Limit the number of Dev Boxes a single user can create for a project. GA AZR-000412 Azure.AKS.MinUserPoolNodes User node pools in an AKS cluster should have a minimum number of nodes for failover and updates. GA AZR-000413 Azure.ContainerApp.MinReplicas Use multiple replicas to remove a single point of failure. GA AZR-000414 Azure.ContainerApp.AvailabilityZone Use Container Apps environments that are zone redundant to improve reliability. GA AZR-000415 Azure.Cosmos.MinTLS Cosmos DB accounts should reject TLS versions older than 1.2. GA AZR-000416 Azure.EntraDS.NTLM Disable NTLM v1 for Microsoft Entra Domain Services. GA AZR-000417 Azure.EntraDS.TLS Disable TLS v1 for Microsoft Entra Domain Services. GA AZR-000418 Azure.EntraDS.RC4 Disable RC4 encryption for Microsoft Entra Domain Services. GA AZR-000419 Azure.Cosmos.SLA Use a paid tier to qualify for a Service Level Agreement (SLA). GA AZR-000420 Azure.Cosmos.DisableLocalAuth Access keys allow depersonalized access to Cosmos DB accounts using a shared secret. GA AZR-000421 Azure.Cosmos.PublicAccess Azure Cosmos DB should have public network access disabled. GA AZR-000422 Azure.EventHub.Firewall Access to the namespace endpoints should be restricted to only allowed sources. GA AZR-000423 Azure.AppGw.MigrateWAFPolicy Migrate to Application Gateway WAF policy. GA AZR-000424 Azure.Grafana.Version Grafana workspaces should be on Grafana version 10. GA AZR-000425 Azure.LogAnalytics.Replication Log Analytics workspaces should have workspace replication enabled to improve service availability. Preview AZR-000426 Azure.VMSS.AutoInstanceRepairs Automatic instance repairs are enabled. Preview AZR-000427 Azure.Redis.EntraID Use Entra ID authentication with cache instances. GA AZR-000428 Azure.AppService.NodeJsVersion Configure applications to use supported Node.js runtime versions. GA AZR-000429 Azure.Firewall.AvailabilityZone Deploy firewall instances using availability zones in supported regions to ensure high availability and resilience. GA AZR-000430 Azure.VNG.MaintenanceConfig Use a customer-controlled maintenance configuration for virtual network gateways. Preview AZR-000431 Azure.MySQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for MySQL servers. GA AZR-000432 Azure.MySQL.ZoneRedundantHA Deploy Azure Database for MySQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. GA AZR-000433 Azure.PostgreSQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for PostgreSQL servers. GA AZR-000434 Azure.PostgreSQL.ZoneRedundantHA Deploy Azure Database for PostgreSQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. GA AZR-000435 Azure.AKS.NodeAutoUpgrade Deploy AKS Clusters with Node Auto-Upgrade enabled GA AZR-000436 Azure.VMSS.AvailabilityZone Deploy virtual machine scale set instances using availability zones in supported regions to ensure high availability and resilience. GA AZR-000437 Azure.AVD.ScheduleAgentUpdate Define a windows for agent updates to minimize disruptions to users. GA AZR-000438 Azure.VMSS.ZoneBalance Deploy virtual machine scale set instances using the best-effort zone balance in supported regions. GA AZR-000439 Azure.Cosmos.ContinuousBackup Enable continuous backup on Cosmos DB accounts. GA AZR-000440 Azure.SQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL databases. GA AZR-000441 Azure.SQLMI.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL Managed Instances. GA AZR-000442 Azure.AppService.AvailabilityZone Deploy app service plan instances using availability zones in supported regions to ensure high availability and resilience. GA AZR-000443 Azure.ASE.AvailabilityZone Deploy app service environments using availability zones in supported regions to ensure high availability and resilience. GA AZR-000444 Azure.ServiceBus.GeoReplica Enhance resilience to regional outages by replicating namespaces. Preview AZR-000445 Azure.AKS.AuditAdmin Use kube-audit-admin instead of kube-audit to capture administrative actions in AKS clusters. GA AZR-000446 Azure.AKS.MaintenanceWindow Configure customer-controlled maintenance windows for AKS clusters. GA AZR-000447 Azure.VNET.PrivateSubnet Disable default outbound access for virtual machines. Preview AZR-000448 Azure.VNET.FirewallSubnetNAT Zonal-deployed Azure Firewalls should consider using an Azure NAT Gateway for outbound access. GA AZR-000449 Azure.VM.PublicIPAttached Avoid attaching public IPs directly to virtual machines. GA AZR-000450 Azure.VMSS.PublicIPAttached Avoid attaching public IPs directly to virtual machine scale set instances. GA AZR-000451 Azure.VM.ASDistributeTraffic Ensure high availability by distributing traffic among members in an availability set. GA AZR-000452 Azure.VM.MultiTenantHosting Deploy Windows 10 and 11 virtual machines in Azure using Multi-tenant Hosting Rights to leverage your existing Windows licenses. GA"},{"location":"es/rules/Azure.ACR.AdminUser/","title":"Deshabilitar el usuario adminstrador para ACR","text":"Azure.ACR.AdminUserAZR-000005Error <p> Seguridad  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2020_06  \u00b7  Critico</p>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"es/rules/Azure.ACR.AdminUser/#sinopsis","title":"Sinopsis","text":"<p>Usar identidades de Azure AD en lugar de usar el usuario administrador del registro.</p>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"es/rules/Azure.ACR.AdminUser/#descripcion","title":"Descripci\u00f3n","text":"<p>Azure Container Registry (ACR) incluye una cuenta de usuario administrador incorporada. La cuenta de usuario administrador es una cuenta de usuario \u00fanica con acceso administrativo al registro. Esta cuenta proporciona acceso de usuario \u00fanico para pruebas y desarrollo tempranos. La cuenta de usuario administrador no est\u00e1 dise\u00f1ada para usarse con registros de contenedores de producci\u00f3n.</p> <p>En su lugar, utilice el control de acceso basado en roles (RBAC). RBAC se puede usar para delegar permisos de registro a una identidad de Azure AD (AAD).</p>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"es/rules/Azure.ACR.AdminUser/#recomendacion","title":"Recomendaci\u00f3n","text":"<p>Considere deshabilitar la cuenta de usuario administrador y solo use la autenticaci\u00f3n basada en identidad para las operaciones de registro.</p>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"es/rules/Azure.ACR.AdminUser/#ejemplos","title":"Ejemplos","text":"","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"es/rules/Azure.ACR.AdminUser/#configurar-con-plantilla-de-arm","title":"Configurar con plantilla de ARM","text":"<p>Para implementar Container Registries, pasa la siguiente regla:</p> <ul> <li>Establezca <code>properties.adminUserEnabled</code> a <code>false</code>.</li> </ul> <p>Por ejemplo:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerRegistry/registries\",\n  \"apiVersion\": \"2023-07-01\",\n  \"name\": \"[parameters('name')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Premium\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"adminUserEnabled\": false,\n    \"policies\": {\n      \"trustPolicy\": {\n        \"status\": \"enabled\",\n        \"type\": \"Notary\"\n      },\n      \"retentionPolicy\": {\n        \"days\": 30,\n        \"status\": \"enabled\"\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"es/rules/Azure.ACR.AdminUser/#configurar-con-bicep","title":"Configurar con Bicep","text":"<p>Para implementar Container Registries, pasa la siguiente regla:</p> <ul> <li>Establezca <code>properties.adminUserEnabled</code> a <code>false</code>.</li> </ul> <p>Por ejemplo:</p> Azure Bicep snippet<pre><code>resource registry 'Microsoft.ContainerRegistry/registries@2023-07-01' = {\n  name: name\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    adminUserEnabled: false\n    policies: {\n      trustPolicy: {\n        status: 'enabled'\n        type: 'Notary'\n      }\n      retentionPolicy: {\n        days: 30\n        status: 'enabled'\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"es/rules/Azure.ACR.AdminUser/#configurar-con-azure-cli","title":"Configurar con Azure CLI","text":"Azure CLI snippet<pre><code>az acr update -n '&lt;name&gt;' -g '&lt;resource_group&gt;' --admin-enabled false\n</code></pre>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"es/rules/Azure.ACR.AdminUser/#configurar-con-azure-powershell","title":"Configurar con Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Update-AzContainerRegistry -ResourceGroupName '&lt;resource_group&gt;' -Name '&lt;name&gt;' -DisableAdminUser\n</code></pre>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"es/rules/Azure.ACR.AdminUser/#enlaces","title":"Enlaces","text":"<ul> <li>Uso de la autenticaci\u00f3n basada en identidad</li> <li>Autenticaci\u00f3n con un registro de contenedor de Azure</li> <li>Procedimientos recomendados para Azure Container Registry</li> <li>Use la identidad administrada de Azure para autenticarse en Azure Container Registry</li> <li>Roles y permisos de Azure Container Registry</li> <li>\u00bfQu\u00e9 es el control de acceso basado en rol de Azure (RBAC)?</li> <li>Referencia de implementaci\u00f3n de Azure</li> </ul>","tags":["Azure.ACR.AdminUser","AZR-000005"]},{"location":"es/rules/Azure.ACR.ContainerScan/","title":"Examen de im\u00e1genes del registro","text":"Azure.ACR.ContainerScanAZR-000002Error <p> Seguridad  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2020_12  \u00b7  Critico</p>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"es/rules/Azure.ACR.ContainerScan/#sinopsis","title":"Sinopsis","text":"<p>Habilite el an\u00e1lisis de vulnerabilidades para im\u00e1genes de contenedores.</p>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"es/rules/Azure.ACR.ContainerScan/#descripcion","title":"Descripci\u00f3n","text":"<p>Un riesgo potencial con las cargas de trabajo basadas en contenedores son las vulnerabilidades de seguridad sin parches en:</p> <ul> <li>Im\u00e1genes base del sistema operativo.</li> <li>Marcos y dependencias de tiempo de ejecuci\u00f3n utilizados por el c\u00f3digo de la aplicaci\u00f3n.</li> </ul> <p>Es importante adoptar una estrategia para escanear activamente las im\u00e1genes en busca de vulnerabilidades de seguridad. Una opci\u00f3n para escanear im\u00e1genes de contenedores es usar Microsoft Defender para registros de contenedores. Microsoft Defender para registros de contenedores analiza cada imagen de contenedor enviada al registro.</p> <p>Microsoft Defender para registros de contenedores analiza im\u00e1genes en im\u00e1genes insertadas, importadas y extra\u00eddas recientemente. Las im\u00e1genes extra\u00eddas recientemente se escanean peri\u00f3dicamente cuando se extrajeron en los \u00faltimos 30 d\u00edas. Cualquier vulnerabilidad detectada se informa a Microsoft Defender for Cloud.</p> <p>Escaneo de vulnerabilidades de im\u00e1genes de contenedores con Microsoft Defender para registros de contenedores:</p> <ul> <li>Actualmente solo est\u00e1 disponible para registros ACR alojados en Linux.</li> <li>El registro de contenedores debe ser accesible para los registros de contenedores de Microsoft Defender.   El acceso a la red no puede estar restringido por firewall, puntos de conexi\u00f3n de servicio o puntos de conexi\u00f3n privados.</li> <li>Es compatible para clientes de la nube comerciales.   Actualmente no se admite en nubes soberanas o nacionales (por ejemplo, gobierno de EE. UU., gobierno de China, etc.).</li> </ul>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"es/rules/Azure.ACR.ContainerScan/#recomendacion","title":"Recomendaci\u00f3n","text":"<p>Considere usar Microsoft Defender para la nube para buscar vulnerabilidades de seguridad en im\u00e1genes de contenedores.</p>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"es/rules/Azure.ACR.ContainerScan/#ejemplos","title":"Ejemplos","text":"","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"es/rules/Azure.ACR.ContainerScan/#configurar-con-plantilla-de-arm","title":"Configurar con plantilla de ARM","text":"<p>Para habilitar el escaneo de im\u00e1genes de contenedores:</p> <ul> <li>Establezca <code>pricingTier</code> a <code>Standard</code> para Microsoft Defender para container registries.</li> </ul> <p>Por ejemplo:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.Security/pricings\",\n  \"apiVersion\": \"2018-06-01\",\n  \"name\": \"ContainerRegistry\",\n  \"properties\": {\n    \"pricingTier\": \"Standard\"\n  }\n}\n</code></pre>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"es/rules/Azure.ACR.ContainerScan/#configurar-con-bicep","title":"Configurar con Bicep","text":"<p>Para habilitar el escaneo de im\u00e1genes de contenedores:</p> <ul> <li>Establezca <code>pricingTier</code> a <code>Standard</code> para Microsoft Defender para container registries.</li> </ul> <p>Por ejemplo:</p> Azure Bicep snippet<pre><code>resource defenderForContainerRegistry 'Microsoft.Security/pricings@2018-06-01' = {\n  name: 'ContainerRegistry'\n  properties: {\n    pricingTier: 'Standard'\n  }\n}\n</code></pre>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"es/rules/Azure.ACR.ContainerScan/#configurar-con-azure-cli","title":"Configurar con Azure CLI","text":"Azure CLI snippet<pre><code>az security pricing create -n 'ContainerRegistry' --tier 'standard'\n</code></pre>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"es/rules/Azure.ACR.ContainerScan/#configurar-con-azure-powershell","title":"Configurar con Azure PowerShell","text":"Azure PowerShell snippet<pre><code>Set-AzSecurityPricing -Name 'ContainerRegistry' -PricingTier 'Standard'\n</code></pre>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"es/rules/Azure.ACR.ContainerScan/#notas","title":"Notas","text":"<p>Esta regla se aplica cuando se analizan los recursos implementados en Azure.</p>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"es/rules/Azure.ACR.ContainerScan/#enlaces","title":"Enlaces","text":"<ul> <li>Supervisi\u00f3n de recursos de Azure en Microsoft Defender for Cloud</li> <li>Introducci\u00f3n a Microsoft Defender para registros de contenedor</li> <li>Introducci\u00f3n a Microsoft Defender for Containers</li> <li>Proteger las im\u00e1genes y el tiempo de ejecuci\u00f3n</li> </ul>","tags":["Azure.ACR.ContainerScan","AZR-000002"]},{"location":"es/rules/Azure.ACR.ContentTrust/","title":"Utilica im\u00e1genes de contenedores de confianza","text":"Azure.ACR.ContentTrustAZR-000009Error <p> Seguridad  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2020_12  \u00b7  Importante</p>","tags":["Azure.ACR.ContentTrust","AZR-000009"]},{"location":"es/rules/Azure.ACR.ContentTrust/#sinopsis","title":"Sinopsis","text":"<p>Utilica im\u00e1genes de contenedores firmadas por un publicador de im\u00e1genes de confianza. Use container images signed by a trusted image publisher.</p>","tags":["Azure.ACR.ContentTrust","AZR-000009"]},{"location":"es/rules/Azure.ACR.ContentTrust/#descripcion","title":"Descripci\u00f3n","text":"<p>La confianza en el contenido de Azure Container Registry (ACR) permite insertar y extraer im\u00e1genes firmadas. Las im\u00e1genes firmadas brindan una garant\u00eda adicional de que se han creado en una fuente confiable. Para habilitar la confianza en el contenido, el registro del contenedor debe usar una SKU Premium.</p>","tags":["Azure.ACR.ContentTrust","AZR-000009"]},{"location":"es/rules/Azure.ACR.ContentTrust/#recomendacion","title":"Recomendaci\u00f3n","text":"<p>Considere habilitar la confianza en el contenido en registros, clientes e im\u00e1genes de contenedores de firmas.</p>","tags":["Azure.ACR.ContentTrust","AZR-000009"]},{"location":"es/rules/Azure.ACR.ContentTrust/#ejemplos","title":"Ejemplos","text":"","tags":["Azure.ACR.ContentTrust","AZR-000009"]},{"location":"es/rules/Azure.ACR.ContentTrust/#configurar-con-plantilla-de-arm","title":"Configurar con plantilla de ARM","text":"<p>Para implementar resgistros de contenedores que superen esta regla:</p> <ul> <li>Establezca <code>properties.trustPolicy.status</code> a <code>enabled</code>.</li> <li>Establezca <code>properties.trustPolicy.type</code> a <code>Notary</code>.</li> </ul> <p>Por ejemplo:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerRegistry/registries\",\n  \"apiVersion\": \"2021-06-01-preview\",\n  \"name\": \"[parameters('registryName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Premium\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"adminUserEnabled\": false,\n    \"policies\": {\n      \"quarantinePolicy\": {\n        \"status\": \"enabled\"\n      },\n      \"trustPolicy\": {\n        \"status\": \"enabled\",\n        \"type\": \"Notary\"\n      },\n      \"retentionPolicy\": {\n        \"status\": \"enabled\",\n        \"days\": 30\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.ContentTrust","AZR-000009"]},{"location":"es/rules/Azure.ACR.ContentTrust/#configurar-con-bicep","title":"Configurar con Bicep","text":"<p>Para implementar resgistros de contenedores que superen esta regla:</p> <ul> <li>Establezca <code>properties.trustPolicy.status</code> a <code>enabled</code>.</li> <li>Establezca <code>properties.trustPolicy.type</code> a <code>Notary</code>.</li> </ul> <p>Por ejemplo:</p> Azure Bicep snippet<pre><code>resource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = {\n  name: registryName\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    adminUserEnabled: false\n    policies: {\n      quarantinePolicy: {\n        status: 'enabled'\n      }\n      trustPolicy: {\n        status: 'enabled'\n        type: 'Notary'\n      }\n      retentionPolicy: {\n        status: 'enabled'\n        days: 30\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.ContentTrust","AZR-000009"]},{"location":"es/rules/Azure.ACR.ContentTrust/#enlaces","title":"Enlaces","text":"<ul> <li>Confianza en el contenido en Azure Container Registry</li> <li>Content trust in Docker</li> <li>Referencia de implementaci\u00f3n de Azure</li> </ul>","tags":["Azure.ACR.ContentTrust","AZR-000009"]},{"location":"es/rules/Azure.ACR.GeoReplica/","title":"Geo-replicar im\u00e1genes de contenedores","text":"Azure.ACR.GeoReplicaAZR-000004Error <p> Confiabilidad  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2020_12  \u00b7  Importante</p>","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"es/rules/Azure.ACR.GeoReplica/#sinopsis","title":"Sinopsis","text":"<p>Utilice registros de contenedores replicados geogr\u00e1ficamente para complementar las implementaciones de contenedores en varias regiones.</p>","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"es/rules/Azure.ACR.GeoReplica/#descripcion","title":"Descripci\u00f3n","text":"<p>Un registro de contenedor se almacena y mantiene de forma predeterminada en una sola regi\u00f3n. Opcionalmente, se puede habilitar la replicaci\u00f3n geogr\u00e1fica en una o m\u00e1s regiones adicionales.</p> <p>Los registros de contenedores de replicaci\u00f3n geogr\u00e1fica brindan los siguientes beneficios:</p> <ul> <li>Los nombres \u00fanicos de registros/im\u00e1genes/etiquetas se pueden usar en m\u00faltiples regiones.</li> <li>El acceso al registro de cierre de red dentro de la regi\u00f3n reduce la latencia.</li> <li>Como las im\u00e1genes se extraen de un registro replicado local, cada extracci\u00f3n no genera costos de salida adicionales.</li> </ul>","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"es/rules/Azure.ACR.GeoReplica/#recomendacion","title":"Recomendaci\u00f3n","text":"<p>Considere usar un registro de contenedor replicado geogr\u00e1ficamente para implementaciones en varias regiones.</p>","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"es/rules/Azure.ACR.GeoReplica/#ejemplos","title":"Ejemplos","text":"","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"es/rules/Azure.ACR.GeoReplica/#configurar-con-plantilla-de-arm","title":"Configurar con plantilla de ARM","text":"<p>Para habilitar la replicaci\u00f3n geogr\u00e1fica para registros de contenedores que pasan esta regla:</p> <ul> <li>Establezca <code>sku.name</code> a <code>Premium</code> (necesario para la replicaci\u00f3n geogr\u00e1fica).</li> <li>Agrega el recurso secundario <code>replications</code> con <code>location</code> establecida en la regi\u00f3n para replicar.</li> </ul> <p>Por ejemplo:</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"metadata\": {\n    \"_generator\": {\n      \"name\": \"bicep\",\n      \"version\": \"0.5.6.12127\",\n      \"templateHash\": \"12610175857982700190\"\n    }\n  },\n  \"parameters\": {\n    \"acrName\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"[format('acr{0}', uniqueString(resourceGroup().id))]\",\n      \"maxLength\": 50,\n      \"minLength\": 5,\n      \"metadata\": {\n        \"description\": \"Globally unique name of your Azure Container Registry\"\n      }\n    },\n    \"acrAdminUserEnabled\": {\n      \"type\": \"bool\",\n      \"defaultValue\": false,\n      \"metadata\": {\n        \"description\": \"Enable admin user that has push / pull permission to the registry.\"\n      }\n    },\n    \"location\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"[resourceGroup().location]\",\n      \"metadata\": {\n        \"description\": \"Location for registry home replica.\"\n      }\n    },\n    \"acrSku\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"Premium\",\n      \"allowedValues\": [\"Premium\"],\n      \"metadata\": {\n        \"description\": \"Tier of your Azure Container Registry. Geo-replication requires Premium SKU.\"\n      }\n    },\n    \"acrReplicaLocation\": {\n      \"type\": \"string\",\n      \"metadata\": {\n        \"description\": \"Short name for registry replica location.\"\n      }\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.ContainerRegistry/registries\",\n      \"apiVersion\": \"2019-12-01-preview\",\n      \"name\": \"[parameters('acrName')]\",\n      \"location\": \"[parameters('location')]\",\n      \"sku\": {\n        \"name\": \"[parameters('acrSku')]\"\n      },\n      \"tags\": {\n        \"displayName\": \"Container Registry\",\n        \"container.registry\": \"[parameters('acrName')]\"\n      },\n      \"properties\": {\n        \"adminUserEnabled\": \"[parameters('acrAdminUserEnabled')]\"\n      }\n    },\n    {\n      \"type\": \"Microsoft.ContainerRegistry/registries/replications\",\n      \"apiVersion\": \"2019-12-01-preview\",\n      \"name\": \"[format('{0}/{1}', parameters('acrName'), parameters('acrReplicaLocation'))]\",\n      \"location\": \"[parameters('acrReplicaLocation')]\",\n      \"properties\": {},\n      \"dependsOn\": [\n        \"[resourceId('Microsoft.ContainerRegistry/registries', parameters('acrName'))]\"\n      ]\n    }\n  ],\n  \"outputs\": {\n    \"acrLoginServer\": {\n      \"type\": \"string\",\n      \"value\": \"[reference(resourceId('Microsoft.ContainerRegistry/registries', parameters('acrName'))).loginServer]\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"es/rules/Azure.ACR.GeoReplica/#configurar-con-bicep","title":"Configurar con Bicep","text":"<p>Para habilitar la replicaci\u00f3n geogr\u00e1fica para registros de contenedores que pasan esta regla:</p> <ul> <li>Establezca <code>sku.name</code> a <code>Premium</code> (necesario para la replicaci\u00f3n geogr\u00e1fica).</li> <li>Agrega el recurso secundario <code>replications</code> con <code>location</code> establecida en la regi\u00f3n para replicar.</li> </ul> <p>Por ejemplo:</p> Azure Bicep snippet<pre><code>resource containerRegistry 'Microsoft.ContainerRegistry/registries@2019-12-01-preview' = {\n  name: acrName\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  tags: {\n    displayName: 'Container Registry'\n    'container.registry': acrName\n  }\n  properties: {\n    adminUserEnabled: acrAdminUserEnabled\n  }\n}\n\nresource containerRegistryReplica 'Microsoft.ContainerRegistry/registries/replications@2019-12-01-preview' = {\n  parent: containerRegistry\n  name: '${acrReplicaLocation}'\n  location: acrReplicaLocation\n  properties: {\n  }\n}\n</code></pre>","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"es/rules/Azure.ACR.GeoReplica/#notas","title":"Notas","text":"<p>Esta regla se aplica cuando se analizan los recursos implementados en Azure.</p>","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"es/rules/Azure.ACR.GeoReplica/#elaces","title":"Elaces","text":"<ul> <li>Resistencia y dependencias</li> <li>Implementaci\u00f3n de la replicaci\u00f3n geogr\u00e1fica en varias regiones</li> <li>Replicaci\u00f3n geogr\u00e1fica en Azure Container Registry</li> <li>Tutorial: Preparar un registro de contenedor de Azure con replicaci\u00f3n geogr\u00e1fica</li> </ul>","tags":["Azure.ACR.GeoReplica","AZR-000004"]},{"location":"es/rules/Azure.ACR.ImageHealth/","title":"Eliminar im\u00e1genes de contenedores vulnerables","text":"Azure.ACR.ImageHealthAZR-000003Error <p> Seguridad  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2020_12  \u00b7  Critico</p>","tags":["Azure.ACR.ImageHealth","AZR-000003"]},{"location":"es/rules/Azure.ACR.ImageHealth/#sinopsis","title":"Sinopsis","text":"<p>Eliminar im\u00e1genes de contenedores con vulnerabilidades conocidas.</p>","tags":["Azure.ACR.ImageHealth","AZR-000003"]},{"location":"es/rules/Azure.ACR.ImageHealth/#descripcion","title":"Descripci\u00f3n","text":"<p>Cuando Microsoft Defender para registros de contenedores est\u00e1 habilitado, Microsoft Defender analiza las im\u00e1genes de contenedores. Las im\u00e1genes de contenedores se escanean en busca de vulnerabilidades conocidas y se marcan como saludables o no saludables. No se deben utilizar im\u00e1genes de contenedores vulnerables.</p>","tags":["Azure.ACR.ImageHealth","AZR-000003"]},{"location":"es/rules/Azure.ACR.ImageHealth/#recomendacion","title":"Recomendaci\u00f3n","text":"<p>Considere usar la eliminaci\u00f3n de im\u00e1genes de contenedores con vulnerabilidades conocidas.</p>","tags":["Azure.ACR.ImageHealth","AZR-000003"]},{"location":"es/rules/Azure.ACR.ImageHealth/#notas","title":"Notas","text":"<p>Esta regla se aplica cuando se analizan los recursos implementados en Azure.</p>","tags":["Azure.ACR.ImageHealth","AZR-000003"]},{"location":"es/rules/Azure.ACR.ImageHealth/#enlaces","title":"Enlaces","text":"<ul> <li>Recomendaciones de revisi\u00f3n y correcci\u00f3n</li> <li>Introducci\u00f3n a Microsoft Defender para registros de contenedor</li> <li>Introducci\u00f3n a Microsoft Defender for Containers</li> <li>Proteger las im\u00e1genes y el tiempo de ejecuci\u00f3n</li> </ul>","tags":["Azure.ACR.ImageHealth","AZR-000003"]},{"location":"es/rules/Azure.ACR.MinSku/","title":"Utilice el SKU de producci\u00f3n de ACR","text":"Azure.ACR.MinSkuAZR-000006Error <p> Confiabilidad  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2020_06  \u00b7  Importante</p>","tags":["Azure.ACR.MinSku","AZR-000006"]},{"location":"es/rules/Azure.ACR.MinSku/#sinopsis","title":"Sinopsis","text":"<p>ACR debe usar el SKU Premium o Est\u00e1ndar para las implementaciones de producci\u00f3n.</p>","tags":["Azure.ACR.MinSku","AZR-000006"]},{"location":"es/rules/Azure.ACR.MinSku/#descripcion","title":"Descripci\u00f3n","text":"<p>Azure Container Registry (ACR) proporciona una gama de diferentes niveles de servicio (tambi\u00e9n conocidos como SKU). Estos niveles de servicio proporcionan diferentes niveles de rendimiento y caracter\u00edsticas.</p> <p>Hay tres niveles de servicio disponibles: B\u00e1sico, Est\u00e1ndar y Premium. Los registros de contenedores b\u00e1sicos solo se recomiendan para implementaciones que no sean de producci\u00f3n. Utilice un m\u00ednimo de Est\u00e1ndar para registros de contenedores de producci\u00f3n.</p> <p>El SKU Premium proporciona un mayor rendimiento de im\u00e1genes y almacenamiento incluido, y es necesario para:</p> <ul> <li>Geo-replicaci\u00f3n</li> <li>Zonas de disponibilidad</li> <li>Puntos de conexi\u00f3n privados</li> <li>Restricciones de firewall</li> <li>Tokens y mapas de alcance</li> </ul>","tags":["Azure.ACR.MinSku","AZR-000006"]},{"location":"es/rules/Azure.ACR.MinSku/#recomendacion","title":"Recomendaci\u00f3n","text":"<p>Considere usar el SKU de Premium de registros de contenedores para implementaciones de producci\u00f3n.</p>","tags":["Azure.ACR.MinSku","AZR-000006"]},{"location":"es/rules/Azure.ACR.MinSku/#ejemplos","title":"Ejemplos","text":"","tags":["Azure.ACR.MinSku","AZR-000006"]},{"location":"es/rules/Azure.ACR.MinSku/#configurar-con-plantilla-de-arm","title":"Configurar con plantilla de ARM","text":"<p>Para implementar registros de contenedores que superen esta regla:</p> <ul> <li>Establezca <code>sku.name</code> a <code>Premium</code> o <code>Standard</code>.</li> </ul> <p>Por ejemplo:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerRegistry/registries\",\n  \"apiVersion\": \"2021-06-01-preview\",\n  \"name\": \"[parameters('registryName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Premium\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"adminUserEnabled\": false,\n    \"policies\": {\n      \"quarantinePolicy\": {\n        \"status\": \"enabled\"\n      },\n      \"trustPolicy\": {\n        \"status\": \"enabled\",\n        \"type\": \"Notary\"\n      },\n      \"retentionPolicy\": {\n        \"status\": \"enabled\",\n        \"days\": 30\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.MinSku","AZR-000006"]},{"location":"es/rules/Azure.ACR.MinSku/#configurar-con-bicep","title":"Configurar con Bicep","text":"<p>Para implementar registros de contenedores que superen esta regla:</p> <ul> <li>Establezca <code>sku.name</code> a <code>Premium</code> o <code>Standard</code>.</li> </ul> <p>Por ejemplo:</p> Azure Bicep snippet<pre><code>resource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = {\n  name: registryName\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    adminUserEnabled: false\n    policies: {\n      quarantinePolicy: {\n        status: 'enabled'\n      }\n      trustPolicy: {\n        status: 'enabled'\n        type: 'Notary'\n      }\n      retentionPolicy: {\n        status: 'enabled'\n        days: 30\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.MinSku","AZR-000006"]},{"location":"es/rules/Azure.ACR.MinSku/#elaces","title":"Elaces","text":"<ul> <li>Requisitos no funcionales y de destino</li> <li>Niveles del servicio Azure Container Registry</li> <li>Replicaci\u00f3n geogr\u00e1fica en Azure Container Registry</li> <li>Implementaci\u00f3n de la replicaci\u00f3n geogr\u00e1fica en varias regiones</li> <li>Referencia de implementaci\u00f3n de Azure</li> </ul>","tags":["Azure.ACR.MinSku","AZR-000006"]},{"location":"es/rules/Azure.ACR.Name/","title":"Utilice nombres de registro v\u00e1lidos","text":"Azure.ACR.NameAZR-000007Error <p> Excelencia operativa  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2020_06  \u00b7  Consciente</p>","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"es/rules/Azure.ACR.Name/#sinopsis","title":"Sinopsis","text":"<p>Los nombres de registro de contenedores deben cumplir con los requisitos de denominaci\u00f3n.</p>","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"es/rules/Azure.ACR.Name/#descripcion","title":"Descripci\u00f3n","text":"<p>Al nombrar los recursos de Azure, los nombres de los recursos deben cumplir con los requisitos del servicio. Los requisitos para los nombres de registro de contenedores son:</p> <ul> <li>Entre 5 y 50 caracteres de longitud.</li> <li>Alfanum\u00e9ricos.</li> <li>Los nombres de registros de contenedores deben ser \u00fanicos a nivel mundial.</li> </ul>","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"es/rules/Azure.ACR.Name/#recomendacion","title":"Recomendaci\u00f3n","text":"<p>Considere usar nombres que cumplan con los requisitos de nombres del registro de contenedores. Adem\u00e1s, considere nombrar recursos con una convenci\u00f3n de nomenclatura est\u00e1ndar.</p>","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"es/rules/Azure.ACR.Name/#ejemplos","title":"Ejemplos","text":"","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"es/rules/Azure.ACR.Name/#configurar-con-plantilla-de-arm","title":"Configurar con plantilla de ARM","text":"<p>Puede asegurarse de que el par\u00e1metro <code>acrName</code> cumpla con los requisitos de nomenclatura utilizando las propiedades de los par\u00e1metros <code>MinLength</code> y <code>maxLength</code>. Tambi\u00e9n puede usar una funci\u00f3n <code>uniqueString()</code> para asegurarse de que el nombre sea globalmente \u00fanico.</p> <p>Por ejemplo</p> Azure Template snippet<pre><code>{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"acrName\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"[format('acr{0}', uniqueString(resourceGroup().id))]\",\n      \"maxLength\": 50,\n      \"minLength\": 5,\n      \"metadata\": {\n        \"description\": \"Globally unique name of your Azure Container Registry\"\n      }\n    },\n    \"location\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"[resourceGroup().location]\",\n      \"metadata\": {\n        \"description\": \"Location for registry home replica.\"\n      }\n    },\n    \"acrSku\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"Premium\",\n      \"allowedValues\": [\n        \"Standard\"\n        \"Premium\"\n      ],\n      \"metadata\": {\n        \"description\": \"Tier of your Azure Container Registry.\"\n      }\n    }\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.ContainerRegistry/registries\",\n      \"apiVersion\": \"2019-12-01-preview\",\n      \"name\": \"[parameters('acrName')]\",\n      \"location\": \"[parameters('location')]\",\n      \"sku\": {\n        \"name\": \"[parameters('acrSku')]\"\n      },\n      \"tags\": {\n        \"displayName\": \"Container Registry\",\n        \"container.registry\": \"[parameters('acrName')]\"\n      }\n    }\n  ],\n  \"outputs\": {\n    \"acrLoginServer\": {\n      \"type\": \"string\",\n      \"value\": \"[reference(resourceId('Microsoft.ContainerRegistry/registries', parameters('acrName'))).loginServer]\"\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"es/rules/Azure.ACR.Name/#configurar-con-bicep","title":"Configurar con Bicep","text":"<p>Puede asegurarse de que el par\u00e1metro <code>acrName</code> cumpla con los requisitos de nomenclatura utilizando las propiedades de los par\u00e1metros <code>MinLength</code> y <code>maxLength</code>. Tambi\u00e9n puede usar una funci\u00f3n <code>uniqueString()</code> para asegurarse de que el nombre sea globalmente \u00fanico.</p> <p>Por ejemplo:</p> Azure Bicep snippet<pre><code>@description('Globally unique name of your Azure Container Registry')\n@minLength(5)\n@maxLength(50)\nparam acrName string = 'acr${uniqueString(resourceGroup().id)}'\n\n@description('Location for registry home replica.')\nparam location string = resourceGroup().location\n\n@description('Tier of your Azure Container Registry. Geo-replication requires Premium SKU.')\n@allowed([\n  'Standard'\n  'Premium'\n])\nparam acrSku string = 'Premium'\n\nresource containerRegistry 'Microsoft.ContainerRegistry/registries@2019-12-01-preview' = {\n  name: acrName\n  location: location\n  sku: {\n    name: acrSku\n  }\n  tags: {\n    displayName: 'Container Registry'\n    'container.registry': acrName\n  }\n}\n\noutput acrLoginServer string = containerRegistry.properties.loginServer\n</code></pre>","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"es/rules/Azure.ACR.Name/#notas","title":"Notas","text":"<p>Esta regla no comprueba si los nombres de registro de contenedores son \u00fanicos.</p>","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"es/rules/Azure.ACR.Name/#enlaces","title":"Enlaces","text":"<ul> <li>Infraestructura repetible</li> <li>Reglas y restricciones de nomenclatura para los recursos de Azure</li> <li>Abreviaturas recomendadas para los tipos de recursos de Azure</li> <li>Referencia de implementaci\u00f3n de Azure</li> </ul>","tags":["Azure.ACR.Name","AZR-000007"]},{"location":"es/rules/Azure.ACR.Quarantine/","title":"Utilice patr\u00f3n de cuarentena de imagen de contenedor","text":"Azure.ACR.QuarantineAZR-000008Error <p> Seguridad  \u00b7  Container Registry  \u00b7  Rule  \u00b7  Preview  \u00b7  2020_12  \u00b7  Importante</p>","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"es/rules/Azure.ACR.Quarantine/#sinopsis","title":"Sinopsis","text":"<p>Habilite la cuarentena de im\u00e1genes de contenedores, escanee y marque im\u00e1genes como verificadas.</p>","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"es/rules/Azure.ACR.Quarantine/#descripcion","title":"Descripci\u00f3n","text":"<p>La cuarentena de im\u00e1genes es una opci\u00f3n configurable para Azure Container Registry (ACR). Cuando est\u00e1 habilitado, las im\u00e1genes enviadas al registro del contenedor no est\u00e1n disponibles de forma predeterminada. Cada imagen debe verificarse y marcarse como <code>Aprobada</code> antes de que est\u00e9 disponible para extraer.</p> <p>Para verificar im\u00e1genes de contenedores, integre con una herramienta de seguridad externa que admita esta funci\u00f3n.</p>","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"es/rules/Azure.ACR.Quarantine/#recomendacion","title":"Recomendaci\u00f3n","text":"<p>Considere configurar una herramienta de seguridad para implementar el patr\u00f3n de cuarentena de im\u00e1genes. Habilite la cuarentena de im\u00e1genes en el registro de contenedores para garantizar que cada imagen se verifique antes de su uso.</p>","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"es/rules/Azure.ACR.Quarantine/#ejemplos","title":"Ejemplos","text":"","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"es/rules/Azure.ACR.Quarantine/#configurar-con-plantilla-de-arm","title":"Configurar con plantilla de ARM","text":"<p>Para implementar registros de contenedores que superen esta regla:</p> <ul> <li>Establezca <code>properties.quarantinePolicy.status</code> a <code>enabled</code>.</li> </ul> <p>Por ejemplo:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerRegistry/registries\",\n  \"apiVersion\": \"2021-06-01-preview\",\n  \"name\": \"[parameters('registryName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Premium\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"adminUserEnabled\": false,\n    \"policies\": {\n      \"quarantinePolicy\": {\n        \"status\": \"enabled\"\n      },\n      \"trustPolicy\": {\n        \"status\": \"enabled\",\n        \"type\": \"Notary\"\n      },\n      \"retentionPolicy\": {\n        \"status\": \"enabled\",\n        \"days\": 30\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"es/rules/Azure.ACR.Quarantine/#configurar-con-bicep","title":"Configurar con Bicep","text":"<p>Para implementar registros de contenedores que superen esta regla:</p> <ul> <li>Establezca <code>properties.quarantinePolicy.status</code> a <code>enabled</code>.</li> </ul> <p>Por ejemplo:</p> Azure Bicep snippet<pre><code>resource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = {\n  name: registryName\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    adminUserEnabled: false\n    policies: {\n      quarantinePolicy: {\n        status: 'enabled'\n      }\n      trustPolicy: {\n        status: 'enabled'\n        type: 'Notary'\n      }\n      retentionPolicy: {\n        status: 'enabled'\n        days: 30\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"es/rules/Azure.ACR.Quarantine/#notas","title":"Notas","text":"<p>La cuarentena de im\u00e1genes para Azure Container Registry se encuentra actualmente en versi\u00f3n preliminar.</p>","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"es/rules/Azure.ACR.Quarantine/#enlaces","title":"Enlaces","text":"<ul> <li>Supervisi\u00f3n de recursos de Azure en Microsoft Defender for Cloud</li> <li>\u00bfC\u00f3mo se habilita la cuarentena autom\u00e1tica de im\u00e1genes para un registro?</li> <li>Patr\u00f3n de cuarentena</li> <li>Proteger las im\u00e1genes y el tiempo de ejecuci\u00f3n</li> <li>Referencia de implementaci\u00f3n de Azure</li> </ul>","tags":["Azure.ACR.Quarantine","AZR-000008"]},{"location":"es/rules/Azure.ACR.Retention/","title":"Configurar directiva de retenci\u00f3n de ACR","text":"Azure.ACR.RetentionAZR-000010Error <p> Optimizaci\u00f3n de costos  \u00b7  Container Registry  \u00b7  Rule  \u00b7  Preview  \u00b7  2020_12  \u00b7  Importante</p>","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"es/rules/Azure.ACR.Retention/#sinopsis","title":"Sinopsis","text":"<p>Use una directiva de retenci\u00f3n para limpiar los manifiestos sin etiquetar.</p>","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"es/rules/Azure.ACR.Retention/#descripcion","title":"Descripci\u00f3n","text":"<p>La directiva de retenci\u00f3n es una opci\u00f3n configurable de Premium Azure Container Registry (ACR). Cuando se configura una directiva de retenci\u00f3n, los manifiestos sin etiquetar en el registro se eliminan autom\u00e1ticamente. Un manifiesto no est\u00e1 etiquetado cuando se env\u00eda una imagen m\u00e1s reciente con la misma etiqueta. es decir, lo \u00faltimo.</p> <p>La directiva de retenci\u00f3n (en d\u00edas) se puede establecer en 0-365. El valor predeterminado es 7 d\u00edas.</p> <p>Para configurar una directiva de retenci\u00f3n, el registro del contenedor debe usar una SKU Premium.</p>","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"es/rules/Azure.ACR.Retention/#recomendacion","title":"Recomendaci\u00f3n","text":"<p>Considere habilitar una directiva de retenci\u00f3n para manifiestos sin etiquetar.</p>","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"es/rules/Azure.ACR.Retention/#ejemplos","title":"Ejemplos","text":"","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"es/rules/Azure.ACR.Retention/#configurar-con-plantilla-de-arm","title":"Configurar con plantilla de ARM","text":"<p>Para implementar registros de contenedores que superen esta regla:</p> <ul> <li>Establezca <code>properties.retentionPolicy.status</code> a <code>enabled</code>.</li> </ul> <p>Por ejemplo:</p> Azure Template snippet<pre><code>{\n  \"type\": \"Microsoft.ContainerRegistry/registries\",\n  \"apiVersion\": \"2021-06-01-preview\",\n  \"name\": \"[parameters('registryName')]\",\n  \"location\": \"[parameters('location')]\",\n  \"sku\": {\n    \"name\": \"Premium\"\n  },\n  \"identity\": {\n    \"type\": \"SystemAssigned\"\n  },\n  \"properties\": {\n    \"adminUserEnabled\": false,\n    \"policies\": {\n      \"quarantinePolicy\": {\n        \"status\": \"enabled\"\n      },\n      \"trustPolicy\": {\n        \"status\": \"enabled\",\n        \"type\": \"Notary\"\n      },\n      \"retentionPolicy\": {\n        \"status\": \"enabled\",\n        \"days\": 30\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"es/rules/Azure.ACR.Retention/#configurar-con-bicep","title":"Configurar con Bicep","text":"<p>Para implementar registros de contenedores que superen esta regla:</p> <ul> <li>Establezca <code>properties.retentionPolicy.status</code> a <code>enabled</code>.</li> </ul> <p>Por ejemplo:</p> Azure Bicep snippet<pre><code>resource acr 'Microsoft.ContainerRegistry/registries@2021-06-01-preview' = {\n  name: registryName\n  location: location\n  sku: {\n    name: 'Premium'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    adminUserEnabled: false\n    policies: {\n      quarantinePolicy: {\n        status: 'enabled'\n      }\n      trustPolicy: {\n        status: 'enabled'\n        type: 'Notary'\n      }\n      retentionPolicy: {\n        status: 'enabled'\n        days: 30\n      }\n    }\n  }\n}\n</code></pre>","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"es/rules/Azure.ACR.Retention/#notas","title":"Notas","text":"<p>Las directivas de retenci\u00f3n para Azure Container Registry est\u00e1n actualmente en versi\u00f3n preliminar.</p>","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"es/rules/Azure.ACR.Retention/#enlaces","title":"Enlaces","text":"<ul> <li>Almacenamiento escalable</li> <li>Establecimiento de una directiva de retenci\u00f3n para manifiestos sin etiqueta</li> <li>Bloqueo de una imagen de contenedor en una instancia de Azure Container Registry</li> <li>Referencia de implementaci\u00f3n de Azure</li> </ul>","tags":["Azure.ACR.Retention","AZR-000010"]},{"location":"es/rules/Azure.ACR.Usage/","title":"Uso del almacenamiento del registro de contenedores","text":"Azure.ACR.UsageAZR-000001Error <p> Optimizaci\u00f3n de costos  \u00b7  Container Registry  \u00b7  Rule  \u00b7  2020_12  \u00b7  Importante</p>","tags":["Azure.ACR.Usage","AZR-000001"]},{"location":"es/rules/Azure.ACR.Usage/#sinopsis","title":"Sinopsis","text":"<p>Elimine peri\u00f3dicamente las im\u00e1genes obsoletas e innecesarias para reducir el uso del almacenamiento.</p>","tags":["Azure.ACR.Usage","AZR-000001"]},{"location":"es/rules/Azure.ACR.Usage/#descripcion","title":"Descripci\u00f3n","text":"<p>Cada SKU de ACR tiene una cantidad de almacenamiento incluido. Cuando se excede la cantidad de almacenamiento incluido, se acumulan costos de almacenamiento adicionales por GiB.</p> <p>Es una buena pr\u00e1ctica limpiar regularmente las im\u00e1genes hu\u00e9rfanas. Estas im\u00e1genes son el resultado de enviar im\u00e1genes actualizadas con la misma etiqueta.</p>","tags":["Azure.ACR.Usage","AZR-000001"]},{"location":"es/rules/Azure.ACR.Usage/#recomendacion","title":"Recomendaci\u00f3n","text":"<p>Considere eliminar las im\u00e1genes obsoletas e innecesarias para reducir el consumo de almacenamiento. Tambi\u00e9n considere actualizar a Premium SKU para registros b\u00e1sicos o est\u00e1ndar para aumentar el almacenamiento incluido.</p>","tags":["Azure.ACR.Usage","AZR-000001"]},{"location":"es/rules/Azure.ACR.Usage/#notas","title":"Notas","text":"<p>Esta regla se aplica cuando se analizan los recursos implementados en Azure.</p>","tags":["Azure.ACR.Usage","AZR-000001"]},{"location":"es/rules/Azure.ACR.Usage/#enlaces","title":"Enlaces","text":"<ul> <li>Generar informes de costos</li> <li>Niveles del servicio Azure Container Registry</li> <li>Almacenamiento escalable</li> <li>Administraci\u00f3n del tama\u00f1o del registro</li> <li>Eliminaci\u00f3n de im\u00e1genes de contenedor en Azure Container Registry</li> </ul>","tags":["Azure.ACR.Usage","AZR-000001"]},{"location":"es/rules/module/","title":"Rules by pillar","text":"<p>PSRule for Azure includes the following rules across five pillars of the Microsoft Azure Well-Architected Framework.</p>"},{"location":"es/rules/module/#cost-optimization","title":"Cost Optimization","text":""},{"location":"es/rules/module/#co03-cost-data-and-reporting","title":"CO:03 Cost data and reporting","text":"Name Synopsis Severity Level Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Error"},{"location":"es/rules/module/#co04-spending-guardrails","title":"CO:04 Spending guardrails","text":"Name Synopsis Severity Level Azure.DevBox.ProjectLimit Limit the number of Dev Boxes a single user can create for a project. Important Error"},{"location":"es/rules/module/#co05-rate-optimization","title":"CO:05 Rate optimization","text":"Name Synopsis Severity Level Azure.VM.MultiTenantHosting Deploy Windows 10 and 11 virtual machines in Azure using Multi-tenant Hosting Rights to leverage your existing Windows licenses. Awareness Error Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Error Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Error"},{"location":"es/rules/module/#co06-usage-and-billing-increments","title":"CO:06 Usage and billing increments","text":"Name Synopsis Severity Level Azure.ML.ComputeIdleShutdown Configure an idle shutdown timeout for Machine Learning compute instances. Critical Error Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Error"},{"location":"es/rules/module/#co07-component-costs","title":"CO:07 Component costs","text":"Name Synopsis Severity Level Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Error Azure.AKS.AuditAdmin Use kube-audit-admin instead of kube-audit to capture administrative actions in AKS clusters. Important Error Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Error Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. Important Error"},{"location":"es/rules/module/#co10-data-costs","title":"CO:10 Data costs","text":"Name Synopsis Severity Level Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Error"},{"location":"es/rules/module/#co13-personnel-time","title":"CO:13 Personnel time","text":"Name Synopsis Severity Level Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Error Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Error"},{"location":"es/rules/module/#co14-consolidation","title":"CO:14 Consolidation","text":"Name Synopsis Severity Level Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Error Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Error Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Error Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Error Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Error"},{"location":"es/rules/module/#operational-excellence","title":"Operational Excellence","text":""},{"location":"es/rules/module/#configuration","title":"Configuration","text":"Name Synopsis Severity Level Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Error Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Error"},{"location":"es/rules/module/#deployment","title":"Deployment","text":"Name Synopsis Severity Level Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Error Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Error"},{"location":"es/rules/module/#infrastructure-provisioning","title":"Infrastructure provisioning","text":"Name Synopsis Severity Level Azure.AppGw.MigrateV2 Use a Application Gateway v2 SKU. Important Error Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. Important Error"},{"location":"es/rules/module/#monitoring","title":"Monitoring","text":"Name Synopsis Severity Level Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Error Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Error Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Error Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Error Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Error Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Error"},{"location":"es/rules/module/#oe04-continuous-integration","title":"OE:04 Continuous integration","text":"Name Synopsis Severity Level Azure.ACR.Name Container registry names should meet naming requirements. Awareness Error Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Error Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Error Azure.APIM.Name API Management service names should meet naming requirements. Awareness Error Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Error Azure.AppGw.Name Application Gateways should meet naming requirements. Awareness Error Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Error Azure.ContainerApp.Name Container Apps should meet naming requirements. Awareness Error Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Error Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Error Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Error Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. Awareness Error Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Error Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Error Azure.Search.Name AI Search service names should meet naming requirements. Awareness Error Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Error Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Error Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Error Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Error Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Error Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Error Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Error"},{"location":"es/rules/module/#oe04-tools-and-processes","title":"OE:04 Tools and processes","text":"Name Synopsis Severity Level Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Warning Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Warning Azure.ContainerApp.APIVersion Migrate from retired API version to a supported version. Important Error Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Error Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Error Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Error Azure.VNET.PeerState VNET peering connections must be connected. Important Error"},{"location":"es/rules/module/#oe05-infrastructure-as-code","title":"OE:05 Infrastructure as code","text":"Name Synopsis Severity Level Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Error Azure.Template.TemplateFile Use ARM template files that are valid. Important Error Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Error"},{"location":"es/rules/module/#oe07-monitoring-system","title":"OE:07 Monitoring system","text":"Name Synopsis Severity Level Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Error Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. Important Error Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. Important Error"},{"location":"es/rules/module/#oe09-task-automation","title":"OE:09 Task automation","text":"Name Synopsis Severity Level Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Error"},{"location":"es/rules/module/#release-engineering","title":"Release engineering","text":"Name Synopsis Severity Level Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Error Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Error Azure.Template.LocationType Location parameters should use a string value. Important Error Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Error Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Error Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Error Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Error Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Error Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Warning Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Error Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Error"},{"location":"es/rules/module/#repeatable-infrastructure","title":"Repeatable infrastructure","text":"Name Synopsis Severity Level Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. Important Error Azure.Arc.Server.MaintenanceConfig Use a maintenance configuration for Arc-enabled servers. Important Error Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Error Azure.Bastion.Name Bastion hosts should meet naming requirements. Awareness Error Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Error Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Error Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. Awareness Error Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Error Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Error Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Error Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Error Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Error Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Error Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. Awareness Error Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. Awareness Error Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. Awareness Error Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Error Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Error Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Error Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Error Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Error Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Error Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Error Azure.PublicIP.MigrateStandard Use the Standard SKU for Public IP addresses as the Basic SKU will be retired. Important Error Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Error Azure.Route.Name Route table names should meet naming requirements. Awareness Error Azure.RSV.Name Recovery Services vaults should meet naming requirements. Awareness Error Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Error Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Error Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Error Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Error Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Error Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Error Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Error Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Error Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Error Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Error Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Error Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Error Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Information Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Information Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Error Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Error Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Error Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Error Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Error Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Error"},{"location":"es/rules/module/#performance-efficiency","title":"Performance Efficiency","text":""},{"location":"es/rules/module/#application-capacity","title":"Application capacity","text":"Name Synopsis Severity Level Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Error"},{"location":"es/rules/module/#application-scalability","title":"Application scalability","text":"Name Synopsis Severity Level Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Error Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Error"},{"location":"es/rules/module/#design-for-performance","title":"Design for performance","text":"Name Synopsis Severity Level Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. Important Error"},{"location":"es/rules/module/#pe02-capacity-planning","title":"PE:02 Capacity planning","text":"Name Synopsis Severity Level Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Error"},{"location":"es/rules/module/#pe03-selecting-services","title":"PE:03 Selecting services","text":"Name Synopsis Severity Level Azure.Databricks.SKU Ensure Databricks workspaces are non-trial SKUs for production workloads. Critical Error Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Error"},{"location":"es/rules/module/#pe05-scaling-and-partitioning","title":"PE:05 Scaling and partitioning","text":"Name Synopsis Severity Level Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Error Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Error Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Error Azure.ContainerApp.DisableAffinity Disable session affinity to prevent unbalanced distribution. Awareness Error Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Error"},{"location":"es/rules/module/#pe07-code-and-infrastructure","title":"PE:07 Code and infrastructure","text":"Name Synopsis Severity Level Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Error Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Error Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Error"},{"location":"es/rules/module/#pe08-data-performance","title":"PE:08 Data performance","text":"Name Synopsis Severity Level Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. Important Error"},{"location":"es/rules/module/#performance-efficiency-checklist","title":"Performance efficiency checklist","text":"Name Synopsis Severity Level Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Warning Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Error"},{"location":"es/rules/module/#reliability","title":"Reliability","text":""},{"location":"es/rules/module/#application-design","title":"Application design","text":"Name Synopsis Severity Level Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Error"},{"location":"es/rules/module/#best-practices","title":"Best practices","text":"Name Synopsis Severity Level Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. Important Error"},{"location":"es/rules/module/#data-management","title":"Data management","text":"Name Synopsis Severity Level Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. Important Error"},{"location":"es/rules/module/#design","title":"Design","text":"Name Synopsis Severity Level Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Error Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Error Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Error Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Error"},{"location":"es/rules/module/#health-modeling","title":"Health modeling","text":"Name Synopsis Severity Level Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Error Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Error Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Error"},{"location":"es/rules/module/#load-balancing-and-failover","title":"Load balancing and failover","text":"Name Synopsis Severity Level Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Error"},{"location":"es/rules/module/#re01-simplicity-and-efficiency","title":"RE:01 Simplicity and efficiency","text":"Name Synopsis Severity Level Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Error Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Error"},{"location":"es/rules/module/#re04-target-metrics","title":"RE:04 Target metrics","text":"Name Synopsis Severity Level Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Error Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Important Error Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Error Azure.AKS.MaintenanceWindow Configure customer-controlled maintenance windows for AKS clusters. Important Error Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Error Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Error Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Error Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Error Azure.AppGw.MigrateWAFPolicy Migrate to Application Gateway WAF policy. Critical Error Azure.AppService.WebProbe Configure and enable instance health probes. Important Error Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Error Azure.AVD.ScheduleAgentUpdate Define a windows for agent updates to minimize disruptions to users. Important Error Azure.Cosmos.SLA Use a paid tier to qualify for a Service Level Agreement (SLA). Important Error Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Error Azure.Grafana.Version Grafana workspaces should be on Grafana version 10. Important Error Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Error Azure.MySQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for MySQL servers. Important Error Azure.PostgreSQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for PostgreSQL servers. Important Error Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Error Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. Important Error Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Error Azure.SQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL databases. Important Error Azure.SQLMI.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL Managed Instances. Important Error Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Error Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Error Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Error Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Error Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Error Azure.VM.MaintenanceConfig Use a maintenance configuration for virtual machines. Important Error Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Error Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Error Azure.VNG.MaintenanceConfig Use a customer-controlled maintenance configuration for virtual network gateways. Important Error Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Error Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important Error"},{"location":"es/rules/module/#re05-high-availability-multi-region-design","title":"RE:05 High-availability multi-region design","text":"Name Synopsis Severity Level Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Error"},{"location":"es/rules/module/#re05-redundancy","title":"RE:05 Redundancy","text":"Name Synopsis Severity Level Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Error Azure.AKS.MinUserPoolNodes User node pools in an AKS cluster should have a minimum number of nodes for failover and updates. Important Error Azure.AppConfig.GeoReplica Replicate app configuration store across all points of presence for an application. Important Error Azure.ContainerApp.MinReplicas Use multiple replicas to remove a single point of failure. Important Error Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. Awareness Error Azure.LB.Probe Use a specific probe for web protocols. Important Error Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. Important Warning Azure.ServiceBus.GeoReplica Enhance resilience to regional outages by replicating namespaces. Important Error Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Error Azure.VM.ASDistributeTraffic Ensure high availability by distributing traffic among members in an availability set. Important Error Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Error Azure.VNET.FirewallSubnetNAT Zonal-deployed Azure Firewalls should consider using an Azure NAT Gateway for outbound access. Awareness Warning Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Error Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Error"},{"location":"es/rules/module/#re05-regions-and-availability-zones","title":"RE:05 Regions and availability zones","text":"Name Synopsis Severity Level Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Error Azure.APIM.AvailabilityZone API Management instances should use availability zones in supported regions for high availability. Important Error Azure.APIM.MultiRegion Enhance service availability and resilience by deploying API Management instances across multiple regions. Important Error Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Error Azure.AppService.AvailabilityZone Deploy app service plan instances using availability zones in supported regions to ensure high availability and resilience. Important Error Azure.ASE.AvailabilityZone Deploy app service environments using availability zones in supported regions to ensure high availability and resilience. Important Error Azure.ContainerApp.AvailabilityZone Use Container Apps environments that are zone redundant to improve reliability. Important Error Azure.Firewall.AvailabilityZone Deploy firewall instances using availability zones in supported regions to ensure high availability and resilience. Important Error Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Error Azure.LogAnalytics.Replication Log Analytics workspaces should have workspace replication enabled to improve service availability. Important Error Azure.MySQL.ZoneRedundantHA Deploy Azure Database for MySQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Error Azure.PostgreSQL.ZoneRedundantHA Deploy Azure Database for PostgreSQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Error Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Error Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Error Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Error Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Error Azure.VMSS.AvailabilityZone Deploy virtual machine scale set instances using availability zones in supported regions to ensure high availability and resilience. Important Error"},{"location":"es/rules/module/#re06-data-partitioning","title":"RE:06 Data partitioning","text":"Name Synopsis Severity Level Azure.Cosmos.ContinuousBackup Enable continuous backup on Cosmos DB accounts. Important Error Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Error Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Error"},{"location":"es/rules/module/#re07-self-preservation","title":"RE:07 Self-preservation","text":"Name Synopsis Severity Level Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Error Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Error Azure.VMSS.AutoInstanceRepairs Automatic instance repairs are enabled. Important Error Azure.VMSS.ZoneBalance Deploy virtual machine scale set instances using the best-effort zone balance in supported regions. Important Error"},{"location":"es/rules/module/#re10-monitoring-and-alerting","title":"RE:10 Monitoring and alerting","text":"Name Synopsis Severity Level Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Error"},{"location":"es/rules/module/#resiliency-and-dependencies","title":"Resiliency and dependencies","text":"Name Synopsis Severity Level Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. Important Error Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Error Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Error Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Error"},{"location":"es/rules/module/#resource-deployment","title":"Resource deployment","text":"Name Synopsis Severity Level Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Error"},{"location":"es/rules/module/#scalability","title":"Scalability","text":"Name Synopsis Severity Level Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Error"},{"location":"es/rules/module/#target-and-non-functional-requirements","title":"Target and non-functional requirements","text":"Name Synopsis Severity Level Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. Important Error Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. Important Error Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. Important Error"},{"location":"es/rules/module/#security","title":"Security","text":""},{"location":"es/rules/module/#authentication","title":"Authentication","text":"Name Synopsis Severity Level Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Error Azure.FrontDoor.ManagedIdentity Ensure Front Door uses a managed identity to authorize access to Azure resources. Important Error Azure.ML.DisableLocalAuth Azure Machine Learning compute resources should have local authentication methods disabled. Critical Error Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Error Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. Critical Error Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. Important Error Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Error"},{"location":"es/rules/module/#azure-resources","title":"Azure resources","text":"Name Synopsis Severity Level Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Error Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. Important Error"},{"location":"es/rules/module/#connectivity","title":"Connectivity","text":"Name Synopsis Severity Level Azure.ML.ComputeVnet Azure Machine Learning Computes should be hosted in a virtual network (VNet). Critical Error Azure.ML.PublicAccess Disable public network access from a Azure Machine Learning workspace. Critical Error"},{"location":"es/rules/module/#data-protection","title":"Data protection","text":"Name Synopsis Severity Level Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. Important Error Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Error Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. Critical Error Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Error"},{"location":"es/rules/module/#design_1","title":"Design","text":"Name Synopsis Severity Level Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. Important Error Azure.APIM.PolicyBase Base element for any policy element in a section should be configured. Important Error"},{"location":"es/rules/module/#encryption","title":"Encryption","text":"Name Synopsis Severity Level Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Error Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Error Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. Critical Error"},{"location":"es/rules/module/#identity-and-access-management","title":"Identity and access management","text":"Name Synopsis Severity Level Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Error Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Error Azure.ML.UserManagedIdentity ML workspaces should use user-assigned managed identity, rather than the default system-assigned managed identity. Important Error Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Error Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Error Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Error Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Error Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Error Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Error Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. Important Error"},{"location":"es/rules/module/#key-and-secret-management","title":"Key and secret management","text":"Name Synopsis Severity Level Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Error Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Error"},{"location":"es/rules/module/#monitor","title":"Monitor","text":"Name Synopsis Severity Level Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Error Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. Important Error"},{"location":"es/rules/module/#network-security-and-containment","title":"Network security and containment","text":"Name Synopsis Severity Level Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Error Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Error Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Error Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Error Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Error Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.AppGwWAF.RuleGroups Use recommended rule groups in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Error Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. Important Error"},{"location":"es/rules/module/#network-segmentation","title":"Network segmentation","text":"Name Synopsis Severity Level Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. Important Error"},{"location":"es/rules/module/#se01-security-baseline","title":"SE:01 Security baseline","text":"Name Synopsis Severity Level Azure.AKS.NodeAutoUpgrade Deploy AKS Clusters with Node Auto-Upgrade enabled Important Error Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Error Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Error"},{"location":"es/rules/module/#se02-secured-development-lifecycle","title":"SE:02 Secured development lifecycle","text":"Name Synopsis Severity Level Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Error Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Error Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Error Azure.AppService.NodeJsVersion Configure applications to use supported Node.js runtime versions. Important Error Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Error Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Error Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. Critical Error Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Error Azure.Deployment.SecureParameter Sensitive parameters that have been not been marked as secure may leak the secret into deployment history or logs. Critical Error Azure.Deployment.SecureValue A secret property set from a non-secure value may leak the secret into deployment history or logs. Critical Error Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Error Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Error"},{"location":"es/rules/module/#se04-segmentation","title":"SE:04 Segmentation","text":"Name Synopsis Severity Level Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Error Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Error"},{"location":"es/rules/module/#se05-identity-and-access-management","title":"SE:05 Identity and access management","text":"Name Synopsis Severity Level Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Error Azure.ACR.AnonymousAccess Anonymous pull access allows unidentified downloading of images and metadata from a container registry. Important Error Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Error Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Error Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Error Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Error Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Error Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Error Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.APIM.ProductApproval Configure products to require approval. Important Error Azure.APIM.ProductSubscription Configure products to require a subscription. Important Error Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Error Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. Important Error Azure.Cosmos.DisableLocalAuth Access keys allow depersonalized access to Cosmos DB accounts using a shared secret. Critical Error Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Error Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Error Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Error Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Error Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Error Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. Awareness Warning Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. Critical Error Azure.MySQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases. Important Error Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. Critical Error Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. Important Error Azure.Redis.EntraID Use Entra ID authentication with cache instances. Critical Error Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Error Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Error Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Error Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. Important Error Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Error Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Error"},{"location":"es/rules/module/#se06-network-controls","title":"SE:06 Network controls","text":"Name Synopsis Severity Level Azure.ACR.Firewall Container Registry without restrictions can be accessed from any network location including the Internet. Important Error Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Error Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Error Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Error Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Error Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Error Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Error Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. Important Error Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. Important Error Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. Important Error Azure.Cosmos.PublicAccess Azure Cosmos DB should have public network access disabled. Critical Error Azure.Databricks.PublicAccess Azure Databricks workspaces should disable public network access. Critical Error Azure.Databricks.SecureConnectivity Use Databricks workspaces configured for secure cluster connectivity. Critical Error Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Error Azure.EventHub.Firewall Access to the namespace endpoints should be restricted to only allowed sources. Critical Error Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Error Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Error Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Error Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Error Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. Important Error Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Error Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Error Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Error Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Error Azure.VM.PublicIPAttached Avoid attaching public IPs directly to virtual machines. Critical Error Azure.VMSS.PublicIPAttached Avoid attaching public IPs directly to virtual machine scale set instances. Critical Error Azure.VNET.PrivateSubnet Disable default outbound access for virtual machines. Critical Error Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Error"},{"location":"es/rules/module/#se07-encryption","title":"SE:07 Encryption","text":"Name Synopsis Severity Level Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Error Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Error Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Error Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Error Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Error Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Error Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Error Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Error Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Error Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Error Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Error Azure.Cosmos.MinTLS Cosmos DB accounts should reject TLS versions older than 1.2. Critical Error Azure.EntraDS.NTLM Disable NTLM v1 for Microsoft Entra Domain Services. Critical Error Azure.EntraDS.RC4 Disable RC4 encryption for Microsoft Entra Domain Services. Critical Error Azure.EntraDS.TLS Disable TLS v1 for Microsoft Entra Domain Services. Critical Error Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. Critical Error Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Error Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. Critical Error Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Error Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Error Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Error Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Error Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Error Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Error Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Error Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Error Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Error Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Error Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Error Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Error Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Error"},{"location":"es/rules/module/#se08-hardening-resources","title":"SE:08 Hardening resources","text":"Name Synopsis Severity Level Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Error Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Error Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Error Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Error Azure.VM.PublicKey Linux virtual machines should use public keys. Important Error Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Error Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Error"},{"location":"es/rules/module/#se09-application-secrets","title":"SE:09 Application secrets","text":"Name Synopsis Severity Level Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Error"},{"location":"es/rules/module/#se10-monitoring-and-threat-detection","title":"SE:10 Monitoring and threat detection","text":"Name Synopsis Severity Level Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Error Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Error Azure.APIM.DefenderCloud APIs published in Azure API Management should be onboarded to Microsoft Defender for APIs. Critical Error Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Error Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. Critical Error Azure.Defender.Api Enable Microsoft Defender for APIs. Critical Error Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Error Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). Critical Error Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Error Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. Critical Error Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. Critical Error Azure.Defender.Dns Enable Microsoft Defender for DNS. Critical Error Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. Critical Error Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. Critical Error Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Error Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Error Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Error Azure.Defender.Storage Enable Microsoft Defender for Storage. Critical Error Azure.Defender.Storage.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Error Azure.Defender.Storage.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Error Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Error Azure.Firewall.PolicyMode Deny high confidence malicious IP addresses, domains and URLs. Critical Error Azure.FrontDoor.Logs Audit and monitor access through Azure Front Door profiles. Important Error Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Error Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Error Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Error Azure.Storage.Defender.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Error Azure.Storage.Defender.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Error Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. Critical Error"},{"location":"es/rules/module/#se12-incident-response","title":"SE:12 Incident response","text":"Name Synopsis Severity Level Azure.Defender.SecurityContact Important security notifications may be lost or not processed in a timely manner when a clear security contact is not identified. Important Error"},{"location":"es/rules/module/#security-design-principles","title":"Security design principles","text":"Name Synopsis Severity Level Azure.BV.Immutable Ensure immutability is configured to protect backup data. Important Error Azure.RSV.Immutable Ensure immutability is configured to protect backup data. Important Error"},{"location":"es/rules/module/#security-operations","title":"Security operations","text":"Name Synopsis Severity Level Azure.Arc.Kubernetes.Defender Deploy Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters. Important Error Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Error Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. Important Error Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. Important Error Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. Important Error"},{"location":"es/rules/resource/","title":"Rules by resource type","text":"<p>PSRule for Azure includes the following rules organized by resource type.</p>"},{"location":"es/rules/resource/#ai-search","title":"AI Search","text":"Name Synopsis Severity Level Azure.Search.IndexSLA Use a minimum of 3 replicas to receive an SLA for query and index updates. Important Error Azure.Search.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.Search.Name AI Search service names should meet naming requirements. Awareness Error Azure.Search.QuerySLA Use a minimum of 2 replicas to receive an SLA for index queries. Important Error Azure.Search.SKU Use the basic and standard tiers for entry level workloads. Critical Error"},{"location":"es/rules/resource/#all-resources","title":"All resources","text":"Name Synopsis Severity Level Azure.Resource.AllowedRegions Resources should be deployed to allowed regions. Important Error Azure.Resource.UseTags Azure resources should be tagged using a standard convention. Awareness Error Azure.Template.DebugDeployment Use default deployment detail level for nested deployments. Awareness Error Azure.Template.DefineParameters Each Azure Resource Manager (ARM) template file should contain a minimal number of parameters. Awareness Error Azure.Template.ExpressionLength Template expressions should not exceed the maximum length. Awareness Error Azure.Template.LocationDefault Set the default value for the location parameter within an ARM template to resource group location. Awareness Error Azure.Template.LocationType Location parameters should use a string value. Important Error Azure.Template.MetadataLink Configure a metadata link for each parameter file. Important Error Azure.Template.ParameterDataTypes Set the parameter default value to a value of the same type. Important Error Azure.Template.ParameterFile Use ARM template parameter files that are valid. Important Error Azure.Template.ParameterMetadata Set metadata descriptions in Azure Resource Manager (ARM) template for each parameter. Awareness Error Azure.Template.ParameterMinMaxValue Template parameters minValue and maxValue constraints must be valid. Important Error Azure.Template.ParameterScheme Use an Azure template parameter file schema with the https scheme. Awareness Error Azure.Template.ParameterStrongType Set the parameter value to a value that matches the specified strong type. Awareness Error Azure.Template.ParameterValue Specify a value for each parameter in template parameter files. Awareness Error Azure.Template.ResourceLocation Resource locations should be an expression or global. Awareness Error Azure.Template.Resources Each Azure Resource Manager (ARM) template file should deploy at least one resource. Awareness Error Azure.Template.TemplateFile Use ARM template files that are valid. Important Error Azure.Template.TemplateSchema Use a more recent version of the Azure template schema. Awareness Error Azure.Template.TemplateScheme Use an Azure template file schema with the https scheme. Awareness Error Azure.Template.UseComments Use comments for each resource in ARM template to communicate purpose. Awareness Information Azure.Template.UseDescriptions Use descriptions for each resource in generated template(bicep, psarm, AzOps) to communicate purpose. Awareness Information Azure.Template.UseLocationParameter Template should reference a location parameter to specify resource location. Awareness Warning Azure.Template.UseParameters Each Azure Resource Manager (ARM) template parameter should be used or removed from template files. Awareness Error Azure.Template.UseVariables Each Azure Resource Manager (ARM) template variable should be used or removed from template files. Awareness Error Azure.Template.ValidSecretRef Use a valid secret reference within parameter files. Awareness Error"},{"location":"es/rules/resource/#api-management","title":"API Management","text":"Name Synopsis Severity Level Azure.APIM.APIDescriptors APIs should have a display name and description. Awareness Warning Azure.APIM.AvailabilityZone API Management instances should use availability zones in supported regions for high availability. Important Error Azure.APIM.CertificateExpiry Renew certificates used for custom domain bindings. Important Error Azure.APIM.Ciphers API Management should not accept weak or deprecated ciphers for client or backend communication. Critical Error Azure.APIM.CORSPolicy Avoid using wildcard for any configuration option in CORS policies. Important Error Azure.APIM.DefenderCloud APIs published in Azure API Management should be onboarded to Microsoft Defender for APIs. Critical Error Azure.APIM.EncryptValues Encrypt all API Management named values with Key Vault secrets. Important Error Azure.APIM.HTTPBackend Unencrypted communication could allow disclosure of information to an untrusted party. Critical Error Azure.APIM.HTTPEndpoint Unencrypted communication could allow disclosure of information to an untrusted party. Important Error Azure.APIM.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.APIM.MinAPIVersion API Management instances should limit control plane API calls to API Management with version '2021-08-01' or newer. Important Error Azure.APIM.MultiRegion Enhance service availability and resilience by deploying API Management instances across multiple regions. Important Error Azure.APIM.MultiRegionGateway API Management instances should have multi-region deployment gateways enabled. Important Error Azure.APIM.Name API Management service names should meet naming requirements. Awareness Error Azure.APIM.PolicyBase Base element for any policy element in a section should be configured. Important Error Azure.APIM.ProductApproval Configure products to require approval. Important Error Azure.APIM.ProductDescriptors API Management products should have a display name and description. Awareness Warning Azure.APIM.ProductSubscription Configure products to require a subscription. Important Error Azure.APIM.ProductTerms Set legal terms for each product registered in API Management. Important Error Azure.APIM.Protocols API Management should only accept a minimum of TLS 1.2 for client and backend communication. Critical Error Azure.APIM.SampleProducts Remove starter and unlimited sample products. Awareness Error"},{"location":"es/rules/resource/#app-configuration","title":"App Configuration","text":"Name Synopsis Severity Level Azure.AppConfig.AuditLogs Ensure app configuration store audit diagnostic logs are enabled. Important Error Azure.AppConfig.DisableLocalAuth Access keys allow depersonalized access to App Configuration using a shared secret. Important Error Azure.AppConfig.GeoReplica Replicate app configuration store across all points of presence for an application. Important Error Azure.AppConfig.Name App Configuration store names should meet naming requirements. Awareness Error Azure.AppConfig.PurgeProtect Consider purge protection for app configuration store to ensure store cannot be purged in the retention period. Important Error Azure.AppConfig.SKU App Configuration should use a minimum size of Standard. Important Error"},{"location":"es/rules/resource/#app-service","title":"App Service","text":"Name Synopsis Severity Level Azure.AppService.AlwaysOn Configure Always On for App Service apps. Important Error Azure.AppService.ARRAffinity Disable client affinity for stateless services. Awareness Error Azure.AppService.AvailabilityZone Deploy app service plan instances using availability zones in supported regions to ensure high availability and resilience. Important Error Azure.AppService.HTTP2 Use HTTP/2 instead of HTTP/1.x to improve protocol efficiency. Awareness Error Azure.AppService.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.AppService.MinPlan Use at least a Standard App Service Plan. Important Error Azure.AppService.MinTLS App Service should reject TLS versions older than 1.2. Critical Error Azure.AppService.NETVersion Configure applications to use newer .NET versions. Important Error Azure.AppService.NodeJsVersion Configure applications to use supported Node.js runtime versions. Important Error Azure.AppService.PHPVersion Configure applications to use newer PHP runtime versions. Important Error Azure.AppService.PlanInstanceCount App Service Plan should use a minimum number of instances for failover. Important Error Azure.AppService.RemoteDebug Disable remote debugging on App Service apps when not in use. Important Error Azure.AppService.UseHTTPS Unencrypted communication could allow disclosure of information to an untrusted party. Important Error Azure.AppService.WebProbe Configure and enable instance health probes. Important Error Azure.AppService.WebProbePath Configure a dedicated path for health probe requests. Important Error Azure.AppService.WebSecureFtp Web apps should disable insecure FTP and configure SFTP when required. Important Error"},{"location":"es/rules/resource/#app-service-environment","title":"App Service Environment","text":"Name Synopsis Severity Level Azure.ASE.AvailabilityZone Deploy app service environments using availability zones in supported regions to ensure high availability and resilience. Important Error Azure.ASE.MigrateV3 Use ASEv3 as replacement for the classic app service environment versions ASEv1 and ASEv2. Important Error"},{"location":"es/rules/resource/#application-gateway","title":"Application Gateway","text":"Name Synopsis Severity Level Azure.AppGw.AvailabilityZone Application Gateway (App Gateway) should use availability zones in supported regions for improved resiliency. Important Error Azure.AppGw.MigrateV2 Use a Application Gateway v2 SKU. Important Error Azure.AppGw.MigrateWAFPolicy Migrate to Application Gateway WAF policy. Critical Error Azure.AppGw.MinInstance Application Gateways should use a minimum of two instances. Important Error Azure.AppGw.MinSku Application Gateway should use a minimum instance size of Medium. Important Error Azure.AppGw.Name Application Gateways should meet naming requirements. Awareness Error Azure.AppGw.OWASP Application Gateway Web Application Firewall (WAF) should use OWASP 3.x rules. Important Error Azure.AppGw.Prevention Internet exposed Application Gateways should use prevention mode to protect backend resources. Critical Error Azure.AppGw.SSLPolicy Application Gateway should only accept a minimum of TLS 1.2. Critical Error Azure.AppGw.UseHTTPS Application Gateways should only expose frontend HTTP endpoints over HTTPS. Critical Error Azure.AppGw.UseWAF Internet accessible Application Gateways should use protect endpoints with WAF. Critical Error Azure.AppGw.WAFEnabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Error Azure.AppGw.WAFRules Application Gateway Web Application Firewall (WAF) should have all rules enabled. Important Error Azure.AppGwWAF.Enabled Application Gateway Web Application Firewall (WAF) must be enabled to protect backend resources. Critical Error Azure.AppGwWAF.Exclusions Application Gateway Web Application Firewall (WAF) should have all rules enabled. Critical Error Azure.AppGwWAF.PreventionMode Use protection mode in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.AppGwWAF.RuleGroups Use recommended rule groups in Application Gateway Web Application Firewall (WAF) policies to protect back end resources. Critical Error"},{"location":"es/rules/resource/#application-insights","title":"Application Insights","text":"Name Synopsis Severity Level Azure.AppInsights.Name Azure Application Insights resources names should meet naming requirements. Awareness Error Azure.AppInsights.Workspace Configure Application Insights resources to store data in a workspace. Important Error"},{"location":"es/rules/resource/#application-security-group","title":"Application Security Group","text":"Name Synopsis Severity Level Azure.ASG.Name Application Security Group (ASG) names should meet naming requirements. Awareness Error"},{"location":"es/rules/resource/#arc","title":"Arc","text":"Name Synopsis Severity Level Azure.Arc.Kubernetes.Defender Deploy Microsoft Defender for Containers extension for Arc-enabled Kubernetes clusters. Important Error Azure.Arc.Server.MaintenanceConfig Use a maintenance configuration for Arc-enabled servers. Important Error"},{"location":"es/rules/resource/#automation-account","title":"Automation Account","text":"Name Synopsis Severity Level Azure.Automation.AuditLogs Ensure automation account audit diagnostic logs are enabled. Important Error Azure.Automation.EncryptVariables Azure Automation variables should be encrypted. Important Error Azure.Automation.ManagedIdentity Ensure Managed Identity is used for authentication. Important Error Azure.Automation.PlatformLogs Ensure automation account platform diagnostic logs are enabled. Important Error Azure.Automation.WebHookExpiry Do not create webhooks with an expiry time greater than 1 year (default). Awareness Error"},{"location":"es/rules/resource/#azure-ai","title":"Azure AI","text":"Name Synopsis Severity Level Azure.AI.DisableLocalAuth Access keys allow depersonalized access to Azure AI using a shared secret. Important Error Azure.AI.ManagedIdentity Configure managed identities to access Azure resources. Important Error Azure.AI.PrivateEndpoints Use Private Endpoints to access Azure AI services accounts. Important Error Azure.AI.PublicAccess Restrict access of Azure AI services to authorized virtual networks. Important Error"},{"location":"es/rules/resource/#azure-cache-for-redis","title":"Azure Cache for Redis","text":"Name Synopsis Severity Level Azure.Redis.AvailabilityZone Premium Redis cache should be deployed with availability zones for high availability. Important Error Azure.Redis.EntraID Use Entra ID authentication with cache instances. Critical Error Azure.Redis.FirewallIPRange Determine if there is an excessive number of permitted IP addresses for the Redis cache. Critical Error Azure.Redis.FirewallRuleCount Determine if there is an excessive number of firewall rules for the Redis cache. Awareness Error Azure.Redis.MaxMemoryReserved Configure maxmemory-reserved to reserve memory for non-cache operations. Important Error Azure.Redis.MinSKU Use Azure Cache for Redis instances of at least Standard C1. Important Error Azure.Redis.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Error Azure.Redis.NonSslPort Azure Cache for Redis should only accept secure connections. Critical Error Azure.Redis.PublicNetworkAccess Redis cache should disable public network access. Critical Error Azure.Redis.Version Azure Cache for Redis should use the latest supported version of Redis. Important Error"},{"location":"es/rules/resource/#azure-cache-for-redis-enterprise","title":"Azure Cache for Redis Enterprise","text":"Name Synopsis Severity Level Azure.RedisEnterprise.MinTLS Redis Cache should reject TLS versions older than 1.2. Critical Error Azure.RedisEnterprise.Zones Enterprise Redis cache should be zone-redundant for high availability. Important Error"},{"location":"es/rules/resource/#azure-database","title":"Azure Database","text":"Name Synopsis Severity Level Azure.SQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL databases. Important Error"},{"location":"es/rules/resource/#azure-database-for-mariadb","title":"Azure Database for MariaDB","text":"Name Synopsis Severity Level Azure.MariaDB.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.MariaDB.DatabaseName Azure Database for MariaDB databases should meet naming requirements. Awareness Error Azure.MariaDB.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MariaDB. Important Error Azure.MariaDB.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.MariaDB.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.MariaDB.FirewallRuleName Azure Database for MariaDB firewall rules should meet naming requirements. Awareness Error Azure.MariaDB.GeoRedundantBackup Azure Database for MariaDB should store backups in a geo-redundant storage. Important Error Azure.MariaDB.MinTLS Azure Database for MariaDB servers should reject TLS versions older than 1.2. Critical Error Azure.MariaDB.ServerName Azure Database for MariaDB servers should meet naming requirements. Awareness Error Azure.MariaDB.UseSSL Azure Database for MariaDB servers should only accept encrypted connections. Critical Error Azure.MariaDB.VNETRuleName Azure Database for MariaDB VNET rules should meet naming requirements. Awareness Error"},{"location":"es/rules/resource/#azure-database-for-mysql","title":"Azure Database for MySQL","text":"Name Synopsis Severity Level Azure.MySQL.AAD Use Entra ID authentication with Azure Database for MySQL databases. Critical Error Azure.MySQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for MySQL databases. Important Error Azure.MySQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.MySQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for MySQL. Important Error Azure.MySQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.MySQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.MySQL.GeoRedundantBackup Azure Database for MySQL should store backups in a geo-redundant storage. Important Error Azure.MySQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for MySQL servers. Important Error Azure.MySQL.MinTLS MySQL DB servers should reject TLS versions older than 1.2. Critical Error Azure.MySQL.ServerName Azure MySQL DB server names should meet naming requirements. Awareness Error Azure.MySQL.UseFlexible Use Azure Database for MySQL Flexible Server deployment model. Important Warning Azure.MySQL.UseSSL Enforce encrypted MySQL connections. Critical Error Azure.MySQL.ZoneRedundantHA Deploy Azure Database for MySQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Error"},{"location":"es/rules/resource/#azure-database-for-postgresql","title":"Azure Database for PostgreSQL","text":"Name Synopsis Severity Level Azure.PostgreSQL.AAD Use Entra ID authentication with Azure Database for PostgreSQL databases. Critical Error Azure.PostgreSQL.AADOnly Ensure Entra ID only authentication is enabled with Azure Database for PostgreSQL databases. Important Error Azure.PostgreSQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.PostgreSQL.DefenderCloud Enable Microsoft Defender for Cloud for Azure Database for PostgreSQL. Important Error Azure.PostgreSQL.FirewallIPRange Determine if there is an excessive number of permitted IP addresses. Important Error Azure.PostgreSQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.PostgreSQL.GeoRedundantBackup Azure Database for PostgreSQL should store backups in a geo-redundant storage. Important Error Azure.PostgreSQL.MaintenanceWindow Configure a customer-controlled maintenance window for Azure Database for PostgreSQL servers. Important Error Azure.PostgreSQL.MinTLS PostgreSQL DB servers should reject TLS versions older than 1.2. Critical Error Azure.PostgreSQL.ServerName Azure PostgreSQL DB server names should meet naming requirements. Awareness Error Azure.PostgreSQL.UseSSL Enforce encrypted PostgreSQL connections. Critical Error Azure.PostgreSQL.ZoneRedundantHA Deploy Azure Database for PostgreSQL servers using zone-redundant high availability (HA) in supported regions to ensure high availability and resilience. Important Error"},{"location":"es/rules/resource/#azure-kubernetes-service","title":"Azure Kubernetes Service","text":"Name Synopsis Severity Level Azure.AKS.AuditAdmin Use kube-audit-admin instead of kube-audit to capture administrative actions in AKS clusters. Important Error Azure.AKS.AuditLogs AKS clusters should collect security-based audit logs to assess and monitor the compliance status of workloads. Important Error Azure.AKS.AuthorizedIPs Restrict access to API server endpoints to authorized IP addresses. Important Error Azure.AKS.AutoScaling Use autoscaling to scale clusters based on workload requirements. Important Error Azure.AKS.AutoUpgrade Configure AKS to automatically upgrade to newer supported AKS versions as they are made available. Important Error Azure.AKS.AvailabilityZone AKS clusters deployed with virtual machine scale sets should use availability zones in supported regions for high availability. Important Error Azure.AKS.AzurePolicyAddOn Configure Azure Kubernetes Service (AKS) clusters to use Azure Policy Add-on for Kubernetes. Important Error Azure.AKS.AzureRBAC Use Azure RBAC for Kubernetes Authorization with AKS clusters. Important Error Azure.AKS.CNISubnetSize AKS clusters using Azure CNI should use large subnets to reduce IP exhaustion issues. Important Error Azure.AKS.ContainerInsights Enable Container insights to monitor AKS cluster workloads. Important Error Azure.AKS.DefenderProfile Enable the Defender profile with Azure Kubernetes Service (AKS) cluster. Important Error Azure.AKS.DNSPrefix Azure Kubernetes Service (AKS) cluster DNS prefix should meet naming requirements. Awareness Error Azure.AKS.EphemeralOSDisk AKS clusters should use ephemeral OS disks which can provide lower read/write latency, along with faster node scaling and cluster upgrades. Important Warning Azure.AKS.HttpAppRouting Disable HTTP application routing add-on in AKS clusters. Important Error Azure.AKS.LocalAccounts Enforce named user accounts with RBAC assigned permissions. Important Error Azure.AKS.MaintenanceWindow Configure customer-controlled maintenance windows for AKS clusters. Important Error Azure.AKS.ManagedAAD Use AKS-managed Azure AD to simplify authorization and improve security. Important Error Azure.AKS.ManagedIdentity Configure AKS clusters to use managed identities for managing cluster infrastructure. Important Error Azure.AKS.MinNodeCount AKS clusters should have minimum number of system nodes for failover and updates. Important Error Azure.AKS.MinUserPoolNodes User node pools in an AKS cluster should have a minimum number of nodes for failover and updates. Important Error Azure.AKS.Name Azure Kubernetes Service (AKS) cluster names should meet naming requirements. Awareness Error Azure.AKS.NetworkPolicy AKS clusters without inter-pod network restrictions may be permit unauthorized lateral movement. Important Error Azure.AKS.NodeAutoUpgrade Deploy AKS Clusters with Node Auto-Upgrade enabled Important Error Azure.AKS.NodeMinPods Azure Kubernetes Cluster (AKS) nodes should use a minimum number of pods. Important Error Azure.AKS.PlatformLogs AKS clusters should collect platform diagnostic logs to monitor the state of workloads. Important Error Azure.AKS.PoolScaleSet Deploy AKS clusters with nodes pools based on VM scale sets. Important Error Azure.AKS.PoolVersion AKS node pools should match Kubernetes control plane version. Important Error Azure.AKS.SecretStore Deploy AKS clusters with Secrets Store CSI Driver and store Secrets in Key Vault. Important Error Azure.AKS.SecretStoreRotation Enable autorotation of Secrets Store CSI Driver secrets for AKS clusters. Important Error Azure.AKS.StandardLB Azure Kubernetes Clusters (AKS) should use a Standard load balancer SKU. Important Error Azure.AKS.UptimeSLA AKS clusters should have Uptime SLA enabled for a financially backed SLA. Important Error Azure.AKS.UseRBAC Deploy AKS cluster with role-based access control (RBAC) enabled. Important Error Azure.AKS.Version AKS control plane and nodes pools should use a current stable release. Important Error"},{"location":"es/rules/resource/#azure-managed-grafana","title":"Azure Managed Grafana","text":"Name Synopsis Severity Level Azure.Grafana.Version Grafana workspaces should be on Grafana version 10. Important Error"},{"location":"es/rules/resource/#azure-virtual-desktop","title":"Azure Virtual Desktop","text":"Name Synopsis Severity Level Azure.AVD.ScheduleAgentUpdate Define a windows for agent updates to minimize disruptions to users. Important Error"},{"location":"es/rules/resource/#backup-vault","title":"Backup Vault","text":"Name Synopsis Severity Level Azure.BV.Immutable Ensure immutability is configured to protect backup data. Important Error"},{"location":"es/rules/resource/#bastion","title":"Bastion","text":"Name Synopsis Severity Level Azure.Bastion.Name Bastion hosts should meet naming requirements. Awareness Error"},{"location":"es/rules/resource/#container-app","title":"Container App","text":"Name Synopsis Severity Level Azure.ContainerApp.APIVersion Migrate from retired API version to a supported version. Important Error Azure.ContainerApp.AvailabilityZone Use Container Apps environments that are zone redundant to improve reliability. Important Error Azure.ContainerApp.DisableAffinity Disable session affinity to prevent unbalanced distribution. Awareness Error Azure.ContainerApp.ExternalIngress Limit inbound communication for Container Apps is limited to callers within the Container Apps Environment. Important Error Azure.ContainerApp.Insecure Ensure insecure inbound traffic is not permitted to the container app. Important Error Azure.ContainerApp.ManagedIdentity Ensure managed identity is used for authentication. Important Error Azure.ContainerApp.MinReplicas Use multiple replicas to remove a single point of failure. Important Error Azure.ContainerApp.Name Container Apps should meet naming requirements. Awareness Error Azure.ContainerApp.PublicAccess Ensure public network access for Container Apps environment is disabled. Important Error Azure.ContainerApp.RestrictIngress IP ingress restrictions mode should be set to allow action for all rules defined. Important Error Azure.ContainerApp.Storage Use of Azure Files volume mounts to persistent storage container data. Awareness Error"},{"location":"es/rules/resource/#container-registry","title":"Container Registry","text":"Name Synopsis Severity Level Azure.ACR.AdminUser The local admin account allows depersonalized access to a container registry using a shared secret. Critical Error Azure.ACR.AnonymousAccess Anonymous pull access allows unidentified downloading of images and metadata from a container registry. Important Error Azure.ACR.ContainerScan Container images or their base images may have vulnerabilities discovered after they are built. Critical Error Azure.ACR.ContentTrust Use container images signed by a trusted image publisher. Important Error Azure.ACR.Firewall Container Registry without restrictions can be accessed from any network location including the Internet. Important Error Azure.ACR.GeoReplica Applications or infrastructure relying on a container image may fail if the registry is not available at the time they start. Important Error Azure.ACR.ImageHealth Remove container images with known vulnerabilities. Critical Error Azure.ACR.MinSku ACR should use the Premium or Standard SKU for production deployments. Important Error Azure.ACR.Name Container registry names should meet naming requirements. Awareness Error Azure.ACR.Quarantine Enable container image quarantine, scan, and mark images as verified. Important Error Azure.ACR.Retention Use a retention policy to cleanup untagged manifests. Important Error Azure.ACR.SoftDelete Azure Container Registries should have soft delete policy enabled. Important Error Azure.ACR.Usage Regularly remove deprecated and unneeded images to reduce storage usage. Important Error"},{"location":"es/rules/resource/#content-delivery-network","title":"Content Delivery Network","text":"Name Synopsis Severity Level Azure.CDN.EndpointName Azure CDN Endpoint names should meet naming requirements. Awareness Error Azure.CDN.HTTP Unencrypted communication could allow disclosure of information to an untrusted party. Important Error Azure.CDN.MinTLS Azure CDN endpoints should reject TLS versions older than 1.2. Important Error"},{"location":"es/rules/resource/#cosmos-db","title":"Cosmos DB","text":"Name Synopsis Severity Level Azure.Cosmos.AccountName Cosmos DB account names should meet naming requirements. Awareness Error Azure.Cosmos.ContinuousBackup Enable continuous backup on Cosmos DB accounts. Important Error Azure.Cosmos.DefenderCloud Enable Microsoft Defender for Azure Cosmos DB. Critical Error Azure.Cosmos.DisableLocalAuth Access keys allow depersonalized access to Cosmos DB accounts using a shared secret. Critical Error Azure.Cosmos.DisableMetadataWrite Use Entra ID identities for management place operations in Azure Cosmos DB. Important Error Azure.Cosmos.MinTLS Cosmos DB accounts should reject TLS versions older than 1.2. Critical Error Azure.Cosmos.PublicAccess Azure Cosmos DB should have public network access disabled. Critical Error Azure.Cosmos.SLA Use a paid tier to qualify for a Service Level Agreement (SLA). Important Error"},{"location":"es/rules/resource/#data-explorer","title":"Data Explorer","text":"Name Synopsis Severity Level Azure.ADX.DiskEncryption Use disk encryption for Azure Data Explorer (ADX) clusters. Important Error Azure.ADX.ManagedIdentity Configure Data Explorer clusters to use managed identities to access Azure resources securely. Important Error Azure.ADX.SLA Use SKUs that include an SLA when configuring Azure Data Explorer (ADX) clusters. Important Error Azure.ADX.Usage Regularly remove unused resources to reduce costs. Important Error"},{"location":"es/rules/resource/#data-factory","title":"Data Factory","text":"Name Synopsis Severity Level Azure.DataFactory.Version Consider migrating to DataFactory v2. Awareness Error"},{"location":"es/rules/resource/#databricks","title":"Databricks","text":"Name Synopsis Severity Level Azure.Databricks.PublicAccess Azure Databricks workspaces should disable public network access. Critical Error Azure.Databricks.SecureConnectivity Use Databricks workspaces configured for secure cluster connectivity. Critical Error Azure.Databricks.SKU Ensure Databricks workspaces are non-trial SKUs for production workloads. Critical Error"},{"location":"es/rules/resource/#deployment","title":"Deployment","text":"Name Synopsis Severity Level Azure.Deployment.AdminUsername A sensitive property set from deterministic or hardcoded values is not secure. Awareness Error Azure.Deployment.Name Nested deployments should meet naming requirements of deployments. Awareness Error Azure.Deployment.OuterSecret Outer evaluation deployments may leak secrets exposed as secure parameters into logs and nested deployments. Critical Error Azure.Deployment.OutputSecretValue Outputting a sensitive value from deployment may leak secrets into deployment history or logs. Critical Error Azure.Deployment.SecureParameter Sensitive parameters that have been not been marked as secure may leak the secret into deployment history or logs. Critical Error Azure.Deployment.SecureValue A secret property set from a non-secure value may leak the secret into deployment history or logs. Critical Error"},{"location":"es/rules/resource/#dev-box","title":"Dev Box","text":"Name Synopsis Severity Level Azure.DevBox.ProjectLimit Limit the number of Dev Boxes a single user can create for a project. Important Error"},{"location":"es/rules/resource/#entra-domain-services","title":"Entra Domain Services","text":"Name Synopsis Severity Level Azure.EntraDS.NTLM Disable NTLM v1 for Microsoft Entra Domain Services. Critical Error Azure.EntraDS.RC4 Disable RC4 encryption for Microsoft Entra Domain Services. Critical Error Azure.EntraDS.TLS Disable TLS v1 for Microsoft Entra Domain Services. Critical Error"},{"location":"es/rules/resource/#event-grid","title":"Event Grid","text":"Name Synopsis Severity Level Azure.EventGrid.DisableLocalAuth Authenticate publishing clients with Azure AD identities. Important Error Azure.EventGrid.ManagedIdentity Use managed identities to deliver Event Grid Topic events. Important Error Azure.EventGrid.TopicPublicAccess Use Private Endpoints to access Event Grid topics and domains. Important Error"},{"location":"es/rules/resource/#event-hub","title":"Event Hub","text":"Name Synopsis Severity Level Azure.EventHub.DisableLocalAuth Authenticate Event Hub publishers and consumers with Entra ID identities. Important Error Azure.EventHub.Firewall Access to the namespace endpoints should be restricted to only allowed sources. Critical Error Azure.EventHub.MinTLS Event Hub namespaces should reject TLS versions older than 1.2. Critical Error Azure.EventHub.Usage Regularly remove unused resources to reduce costs. Important Error"},{"location":"es/rules/resource/#firewall","title":"Firewall","text":"Name Synopsis Severity Level Azure.Firewall.AvailabilityZone Deploy firewall instances using availability zones in supported regions to ensure high availability and resilience. Important Error Azure.Firewall.Mode Deny high confidence malicious IP addresses and domains on classic managed Azure Firewalls. Critical Error Azure.Firewall.Name Firewall names should meet naming requirements. Awareness Error Azure.Firewall.PolicyMode Deny high confidence malicious IP addresses, domains and URLs. Critical Error Azure.Firewall.PolicyName Firewall policy names should meet naming requirements. Awareness Error"},{"location":"es/rules/resource/#front-door","title":"Front Door","text":"Name Synopsis Severity Level Azure.CDN.UseFrontDoor Use Azure Front Door Standard or Premium SKU to improve the performance of web pages with dynamic content and overall capabilities. Important Error Azure.FrontDoor.Logs Audit and monitor access through Azure Front Door profiles. Important Error Azure.FrontDoor.ManagedIdentity Ensure Front Door uses a managed identity to authorize access to Azure resources. Important Error Azure.FrontDoor.MinTLS Front Door Classic instances should reject TLS versions older than 1.2. Critical Error Azure.FrontDoor.Name Front Door names should meet naming requirements. Awareness Error Azure.FrontDoor.Probe Use health probes to check the health of each backend. Important Error Azure.FrontDoor.ProbeMethod Configure health probes to use HEAD requests to reduce performance overhead. Important Error Azure.FrontDoor.ProbePath Configure a dedicated path for health probe requests. Important Error Azure.FrontDoor.State Enable Azure Front Door Classic instance. Important Error Azure.FrontDoor.UseCaching Use caching to reduce retrieving contents from origins. Important Error Azure.FrontDoor.UseWAF Enable Web Application Firewall (WAF) policies on each Front Door endpoint. Critical Error Azure.FrontDoor.WAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Error Azure.FrontDoor.WAF.Mode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.FrontDoor.WAF.Name Front Door WAF policy names should meet naming requirements. Awareness Error Azure.FrontDoorWAF.Enabled Front Door Web Application Firewall (WAF) policy must be enabled to protect back end resources. Critical Error Azure.FrontDoorWAF.Exclusions Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Avoid configuring rule exclusions. Critical Error Azure.FrontDoorWAF.PreventionMode Use protection mode in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Error Azure.FrontDoorWAF.RuleGroups Use recommended rule groups in Front Door Web Application Firewall (WAF) policies to protect back end resources. Critical Error"},{"location":"es/rules/resource/#iot-hub","title":"IoT Hub","text":"Name Synopsis Severity Level Azure.IoTHub.MinTLS IoT Hubs should reject TLS versions older than 1.2. Critical Error"},{"location":"es/rules/resource/#key-vault","title":"Key Vault","text":"Name Synopsis Severity Level Azure.KeyVault.AccessPolicy Use the principal of least privilege when assigning access to Key Vault. Important Error Azure.KeyVault.AutoRotationPolicy Key Vault keys should have auto-rotation enabled. Important Error Azure.KeyVault.Firewall Key Vault should only accept explicitly allowed traffic. Important Error Azure.KeyVault.KeyName Key Vault Key names should meet naming requirements. Awareness Error Azure.KeyVault.Logs Ensure audit diagnostics logs are enabled to audit Key Vault access. Important Error Azure.KeyVault.Name Key Vault names should meet naming requirements. Awareness Error Azure.KeyVault.PurgeProtect Enable Purge Protection on Key Vaults to prevent early purge of vaults and vault items. Important Error Azure.KeyVault.RBAC Key Vaults should use Azure RBAC as the authorization system for the data plane. Awareness Warning Azure.KeyVault.SecretName Key Vault Secret names should meet naming requirements. Awareness Error Azure.KeyVault.SoftDelete Enable Soft Delete on Key Vaults to protect vaults and vault items from accidental deletion. Important Error"},{"location":"es/rules/resource/#load-balancer","title":"Load Balancer","text":"Name Synopsis Severity Level Azure.LB.AvailabilityZone Load balancers deployed with Standard SKU should be zone-redundant for high availability. Important Error Azure.LB.Name Load Balancer names should meet naming requirements. Awareness Error Azure.LB.Probe Use a specific probe for web protocols. Important Error Azure.LB.StandardSKU Load balancers should be deployed with Standard SKU for production workloads. Important Error"},{"location":"es/rules/resource/#log-analytics","title":"Log Analytics","text":"Name Synopsis Severity Level Azure.LogAnalytics.Replication Log Analytics workspaces should have workspace replication enabled to improve service availability. Important Error"},{"location":"es/rules/resource/#logic-app","title":"Logic App","text":"Name Synopsis Severity Level Azure.LogicApp.LimitHTTPTrigger Limit HTTP request trigger access to trusted IP addresses. Critical Error"},{"location":"es/rules/resource/#machine-learning","title":"Machine Learning","text":"Name Synopsis Severity Level Azure.ML.ComputeIdleShutdown Configure an idle shutdown timeout for Machine Learning compute instances. Critical Error Azure.ML.ComputeVnet Azure Machine Learning Computes should be hosted in a virtual network (VNet). Critical Error Azure.ML.DisableLocalAuth Azure Machine Learning compute resources should have local authentication methods disabled. Critical Error Azure.ML.PublicAccess Disable public network access from a Azure Machine Learning workspace. Critical Error Azure.ML.UserManagedIdentity ML workspaces should use user-assigned managed identity, rather than the default system-assigned managed identity. Important Error"},{"location":"es/rules/resource/#microsoft-defender-for-cloud","title":"Microsoft Defender for Cloud","text":"Name Synopsis Severity Level Azure.Defender.Api Enable Microsoft Defender for APIs. Critical Error Azure.Defender.AppServices Enable Microsoft Defender for App Service. Critical Error Azure.Defender.Arm Enable Microsoft Defender for Azure Resource Manager (ARM). Critical Error Azure.Defender.Containers Enable Microsoft Defender for Containers. Critical Error Azure.Defender.CosmosDb Enable Microsoft Defender for Azure Cosmos DB. Critical Error Azure.Defender.Cspm Enable Microsoft Defender Cloud Security Posture Management Standard plan. Critical Error Azure.Defender.Dns Enable Microsoft Defender for DNS. Critical Error Azure.Defender.KeyVault Enable Microsoft Defender for Key Vault. Critical Error Azure.Defender.OssRdb Enable Microsoft Defender for open-source relational databases. Critical Error Azure.Defender.SecurityContact Important security notifications may be lost or not processed in a timely manner when a clear security contact is not identified. Important Error Azure.Defender.Servers Enable Microsoft Defender for Servers. Critical Error Azure.Defender.SQL Enable Microsoft Defender for SQL servers. Critical Error Azure.Defender.SQLOnVM Enable Microsoft Defender for SQL servers on machines. Critical Error Azure.Defender.Storage Enable Microsoft Defender for Storage. Critical Error Azure.Defender.Storage.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Error Azure.Defender.Storage.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Error Azure.DefenderCloud.Provisioning Enable auto-provisioning on to improve Microsoft Defender for Cloud insights. Important Error"},{"location":"es/rules/resource/#monitor","title":"Monitor","text":"Name Synopsis Severity Level Azure.Monitor.ServiceHealth Configure Service Health alerts to notify administrators. Important Error"},{"location":"es/rules/resource/#network-interface","title":"Network Interface","text":"Name Synopsis Severity Level Azure.NIC.Attached Network interfaces (NICs) that are not used should be removed. Awareness Error Azure.NIC.Name Network Interface (NIC) names should meet naming requirements. Awareness Error Azure.NIC.UniqueDns Network interfaces (NICs) should inherit DNS from virtual networks. Awareness Error"},{"location":"es/rules/resource/#network-security-group","title":"Network Security Group","text":"Name Synopsis Severity Level Azure.NSG.AKSRules AKS Network Security Group (NSG) should not have custom rules. Awareness Error Azure.NSG.AnyInboundSource Network security groups (NSGs) should avoid rules that allow \"any\" as an inbound source. Critical Error Azure.NSG.Associated Network Security Groups (NSGs) should be associated to a subnet or network interface. Awareness Error Azure.NSG.DenyAllInbound When all inbound traffic is denied, some functions that affect the reliability of your service may not work as expected. Important Error Azure.NSG.LateralTraversal Deny outbound management connections from non-management hosts. Important Error Azure.NSG.Name Network Security Group (NSG) names should meet naming requirements. Awareness Error"},{"location":"es/rules/resource/#policy","title":"Policy","text":"Name Synopsis Severity Level Azure.Policy.AssignmentAssignedBy Policy assignments should use assignedBy metadata. Awareness Error Azure.Policy.AssignmentDescriptors Policy assignments should use a display name and description. Awareness Error Azure.Policy.Descriptors Policy and initiative definitions should use a display name, description, and category. Awareness Error Azure.Policy.ExemptionDescriptors Policy exemptions should use a display name and description. Awareness Error Azure.Policy.WaiverExpiry Configure policy waiver exemptions to expire. Awareness Error"},{"location":"es/rules/resource/#private-endpoint","title":"Private Endpoint","text":"Name Synopsis Severity Level Azure.PrivateEndpoint.Name Private Endpoint names should meet naming requirements. Awareness Error"},{"location":"es/rules/resource/#public-ip-address","title":"Public IP address","text":"Name Synopsis Severity Level Azure.PublicIP.AvailabilityZone Public IP addresses deployed with Standard SKU should use availability zones in supported regions for high availability. Important Error Azure.PublicIP.DNSLabel Public IP domain name labels should meet naming requirements. Awareness Error Azure.PublicIP.IsAttached Public IP addresses should be attached or cleaned up if not in use. Important Error Azure.PublicIP.MigrateStandard Use the Standard SKU for Public IP addresses as the Basic SKU will be retired. Important Error Azure.PublicIP.Name Public IP names should meet naming requirements. Awareness Error Azure.PublicIP.StandardSKU The basic SKU is being retired on 30 September 2025, and does not include several reliability and security features. Important Error"},{"location":"es/rules/resource/#recovery-services-vault","title":"Recovery Services Vault","text":"Name Synopsis Severity Level Azure.RSV.Immutable Ensure immutability is configured to protect backup data. Important Error Azure.RSV.Name Recovery Services vaults should meet naming requirements. Awareness Error Azure.RSV.ReplicationAlert Recovery Services Vaults (RSV) without replication alerts configured may be at risk. Important Error Azure.RSV.StorageType Recovery Services Vaults (RSV) not using geo-replicated storage (GRS) may be at risk. Important Error"},{"location":"es/rules/resource/#resource-group","title":"Resource Group","text":"Name Synopsis Severity Level Azure.ResourceGroup.Name Resource Group names should meet naming requirements. Awareness Error"},{"location":"es/rules/resource/#route-table","title":"Route table","text":"Name Synopsis Severity Level Azure.Route.Name Route table names should meet naming requirements. Awareness Error"},{"location":"es/rules/resource/#service-bus","title":"Service Bus","text":"Name Synopsis Severity Level Azure.ServiceBus.AuditLogs Ensure namespaces audit diagnostic logs are enabled. Important Error Azure.ServiceBus.DisableLocalAuth Authenticate Service Bus publishers and consumers with Entra ID identities. Important Error Azure.ServiceBus.GeoReplica Enhance resilience to regional outages by replicating namespaces. Important Error Azure.ServiceBus.MinTLS Service Bus namespaces should reject TLS versions older than 1.2. Important Error Azure.ServiceBus.Usage Regularly remove unused resources to reduce costs. Important Error"},{"location":"es/rules/resource/#service-fabric","title":"Service Fabric","text":"Name Synopsis Severity Level Azure.ServiceFabric.AAD Use Entra ID client authentication for Service Fabric clusters. Critical Error"},{"location":"es/rules/resource/#signalr-service","title":"SignalR Service","text":"Name Synopsis Severity Level Azure.SignalR.ManagedIdentity Configure SignalR Services to use managed identities to access Azure resources securely. Important Error Azure.SignalR.Name SignalR service instance names should meet naming requirements. Awareness Error Azure.SignalR.SLA Use SKUs that include an SLA when configuring SignalR Services. Important Error"},{"location":"es/rules/resource/#sql-database","title":"SQL Database","text":"Name Synopsis Severity Level Azure.SQL.AAD Use Entra ID authentication with Azure SQL databases. Critical Error Azure.SQL.AADOnly Ensure Entra ID only authentication is enabled with Azure SQL Database. Important Error Azure.SQL.AllowAzureAccess Determine if access from Azure services is required. Important Error Azure.SQL.Auditing Enable auditing for Azure SQL logical server. Important Error Azure.SQL.DBName Azure SQL Database names should meet naming requirements. Awareness Error Azure.SQL.DefenderCloud Enable Microsoft Defender for Azure SQL logical server. Important Error Azure.SQL.FGName Azure SQL failover group names should meet naming requirements. Awareness Error Azure.SQL.FirewallIPRange Each IP address in the permitted IP list is allowed network access to any databases hosted on the same logical server. Important Error Azure.SQL.FirewallRuleCount Determine if there is an excessive number of firewall rules. Awareness Error Azure.SQL.MinTLS Azure SQL Database servers should reject TLS versions older than 1.2. Critical Error Azure.SQL.ServerName Azure SQL logical server names should meet naming requirements. Awareness Error Azure.SQL.TDE Use Transparent Data Encryption (TDE) with Azure SQL Database. Critical Error"},{"location":"es/rules/resource/#sql-managed-instance","title":"SQL Managed Instance","text":"Name Synopsis Severity Level Azure.SQLMI.AAD Use Azure Active Directory (AAD) authentication with Azure SQL Managed Instance. Critical Error Azure.SQLMI.AADOnly Ensure Azure AD-only authentication is enabled with Azure SQL Managed Instance. Important Error Azure.SQLMI.MaintenanceWindow Configure a customer-controlled maintenance window for Azure SQL Managed Instances. Important Error Azure.SQLMI.ManagedIdentity Ensure managed identity is used to allow support for Azure AD authentication. Important Error Azure.SQLMI.Name SQL Managed Instance names should meet naming requirements. Awareness Error"},{"location":"es/rules/resource/#storage-account","title":"Storage Account","text":"Name Synopsis Severity Level Azure.Storage.BlobAccessType Use containers configured with a private access type that requires authorization. Important Error Azure.Storage.BlobPublicAccess Storage Accounts should only accept authorized requests. Important Error Azure.Storage.ContainerSoftDelete Enable container soft delete on Storage Accounts. Important Error Azure.Storage.Defender.DataScan Enable sensitive data threat detection in Microsoft Defender for Storage. Critical Error Azure.Storage.Defender.MalwareScan Enable Malware Scanning in Microsoft Defender for Storage. Critical Error Azure.Storage.DefenderCloud Enable Microsoft Defender for Storage for storage accounts. Critical Error Azure.Storage.FileShareSoftDelete Enable soft delete on Storage Accounts file shares. Important Error Azure.Storage.Firewall Storage Accounts should only accept explicitly allowed traffic. Important Error Azure.Storage.MinTLS Storage Accounts should reject TLS versions older than 1.2. Critical Error Azure.Storage.Name Storage Account names should meet naming requirements. Awareness Error Azure.Storage.SecureTransfer Storage accounts should only accept encrypted connections. Important Error Azure.Storage.SoftDelete Enable blob soft delete on Storage Accounts. Important Error Azure.Storage.UseReplication Storage Accounts using the LRS SKU are only replicated within a single zone. Important Error"},{"location":"es/rules/resource/#subscription","title":"Subscription","text":"Name Synopsis Severity Level Azure.RBAC.CoAdministrator Delegate access to manage Azure resources using role-based access control (RBAC). Important Error Azure.RBAC.LimitMGDelegation Limit Role-Base Access Control (RBAC) inheritance from Management Groups. Important Error Azure.RBAC.LimitOwner Limit the number of subscription Owners. Important Error Azure.RBAC.PIM Use just-in-time (JiT) activation of roles instead of persistent role assignment. Important Error Azure.RBAC.UseGroups Use groups for assigning permissions instead of individual user accounts. Important Error Azure.RBAC.UseRGDelegation Use RBAC assignments on resource groups instead of individual resources. Important Error"},{"location":"es/rules/resource/#traffic-manager","title":"Traffic Manager","text":"Name Synopsis Severity Level Azure.TrafficManager.Endpoints Traffic Manager should use at lest two enabled endpoints. Important Error Azure.TrafficManager.Protocol Monitor Traffic Manager web-based endpoints with HTTPS. Important Error"},{"location":"es/rules/resource/#user-assigned-managed-identity","title":"User Assigned Managed Identity","text":"Name Synopsis Severity Level Azure.Identity.UserAssignedName Managed Identity names should meet naming requirements. Awareness Error"},{"location":"es/rules/resource/#virtual-machine","title":"Virtual Machine","text":"Name Synopsis Severity Level Azure.VM.AcceleratedNetworking Use accelerated networking for supported operating systems and VM types. Important Error Azure.VM.ADE Use Azure Disk Encryption (ADE). Important Error Azure.VM.Agent Ensure the VM agent is provisioned automatically. Important Error Azure.VM.AMA Use Azure Monitor Agent for collecting monitoring data from VMs. Important Error Azure.VM.ASAlignment Use availability sets aligned with managed disks fault domains. Important Error Azure.VM.ASDistributeTraffic Ensure high availability by distributing traffic among members in an availability set. Important Error Azure.VM.ASMinMembers Availability sets should be deployed with at least two virtual machines (VMs). Important Error Azure.VM.ASName Availability Set names should meet naming requirements. Awareness Error Azure.VM.BasicSku Virtual machines (VMs) should not use Basic sizes. Important Error Azure.VM.ComputerName Virtual Machine (VM) computer name should meet naming requirements. Awareness Error Azure.VM.DiskAttached Managed disks should be attached to virtual machines or removed. Important Error Azure.VM.DiskCaching Check disk caching is configured correctly for the workload. Important Error Azure.VM.DiskName Managed Disk names should meet naming requirements. Awareness Error Azure.VM.DiskSizeAlignment Align to the Managed Disk billing increments to improve cost efficiency. Awareness Error Azure.VM.MaintenanceConfig Use a maintenance configuration for virtual machines. Important Error Azure.VM.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Error Azure.VM.MultiTenantHosting Deploy Windows 10 and 11 virtual machines in Azure using Multi-tenant Hosting Rights to leverage your existing Windows licenses. Awareness Error Azure.VM.Name Virtual Machine (VM) names should meet naming requirements. Awareness Error Azure.VM.PPGName Proximity Placement Group (PPG) names should meet naming requirements. Awareness Error Azure.VM.PromoSku Virtual machines (VMs) should not use expired promotional SKU. Awareness Error Azure.VM.PublicIPAttached Avoid attaching public IPs directly to virtual machines. Critical Error Azure.VM.PublicKey Linux virtual machines should use public keys. Important Error Azure.VM.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Error Azure.VM.ShouldNotBeStopped Azure VMs should be running or in a deallocated state. Important Error Azure.VM.SQLServerDisk Use Premium SSD disks or greater for data and log files for production SQL Server workloads. Important Error Azure.VM.Standalone Use VM features to increase reliability and improve covered SLA for VM configurations. Important Error Azure.VM.Updates Ensure automatic updates are enabled at deployment. Important Error Azure.VM.UseHybridUseBenefit Use Azure Hybrid Benefit for applicable virtual machine (VM) workloads. Awareness Error Azure.VM.UseManagedDisks Virtual machines (VMs) should use managed disks. Important Error"},{"location":"es/rules/resource/#virtual-machine-scale-sets","title":"Virtual Machine Scale Sets","text":"Name Synopsis Severity Level Azure.VMSS.AMA Use Azure Monitor Agent for collecting monitoring data from VM scale sets. Important Error Azure.VMSS.AutoInstanceRepairs Automatic instance repairs are enabled. Important Error Azure.VMSS.AvailabilityZone Deploy virtual machine scale set instances using availability zones in supported regions to ensure high availability and resilience. Important Error Azure.VMSS.ComputerName Virtual Machine Scale Set (VMSS) computer name should meet naming requirements. Awareness Error Azure.VMSS.MigrateAMA Use Azure Monitor Agent as replacement for Log Analytics Agent. Important Error Azure.VMSS.Name Virtual Machine Scale Set (VMSS) names should meet naming requirements. Awareness Error Azure.VMSS.PublicIPAttached Avoid attaching public IPs directly to virtual machine scale set instances. Critical Error Azure.VMSS.PublicKey Use SSH keys instead of common credentials to secure virtual machine scale sets against malicious activities. Important Error Azure.VMSS.ScriptExtensions Custom Script Extensions scripts that reference secret values must use the protectedSettings. Important Error Azure.VMSS.ZoneBalance Deploy virtual machine scale set instances using the best-effort zone balance in supported regions. Important Error"},{"location":"es/rules/resource/#virtual-network","title":"Virtual Network","text":"Name Synopsis Severity Level Azure.VNET.BastionSubnet VNETs with a GatewaySubnet should have an AzureBastionSubnet to allow for out of band remote access to VMs. Important Error Azure.VNET.FirewallSubnet Use Azure Firewall to filter network traffic to and from Azure resources. Important Error Azure.VNET.FirewallSubnetNAT Zonal-deployed Azure Firewalls should consider using an Azure NAT Gateway for outbound access. Awareness Warning Azure.VNET.LocalDNS Virtual networks (VNETs) should use DNS servers deployed within the same Azure region. Important Error Azure.VNET.Name Virtual Network (VNET) names should meet naming requirements. Awareness Error Azure.VNET.PeerState VNET peering connections must be connected. Important Error Azure.VNET.PrivateSubnet Disable default outbound access for virtual machines. Critical Error Azure.VNET.SingleDNS Virtual networks (VNETs) should have at least two DNS servers assigned. Important Error Azure.VNET.SubnetName Subnet names should meet naming requirements. Awareness Error Azure.VNET.UseNSGs Virtual network (VNET) subnets should have Network Security Groups (NSGs) assigned. Critical Error"},{"location":"es/rules/resource/#virtual-network-gateway","title":"Virtual Network Gateway","text":"Name Synopsis Severity Level Azure.VNG.ConnectionName Virtual Network Gateway (VNG) connection names should meet naming requirements. Awareness Error Azure.VNG.ERAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with ExpressRoute gateway type. Important Error Azure.VNG.ERLegacySKU Migrate from legacy SKUs to improve reliability and performance of ExpressRoute (ER) gateways. Critical Error Azure.VNG.MaintenanceConfig Use a customer-controlled maintenance configuration for virtual network gateways. Important Error Azure.VNG.Name Virtual Network Gateway (VNG) names should meet naming requirements. Awareness Error Azure.VNG.VPNActiveActive Use VPN gateways configured to operate in an Active-Active configuration to reduce connectivity downtime. Important Error Azure.VNG.VPNAvailabilityZoneSKU Use availability zone SKU for virtual network gateways deployed with VPN gateway type. Important Error Azure.VNG.VPNLegacySKU Migrate from legacy SKUs to improve reliability and performance of VPN gateways. Critical Error"},{"location":"es/rules/resource/#virtual-wan","title":"Virtual WAN","text":"Name Synopsis Severity Level Azure.vWAN.Name Virtual WAN (vWAN) names should meet naming requirements. Awareness Error"},{"location":"es/rules/resource/#web-pubsub-service","title":"Web PubSub Service","text":"Name Synopsis Severity Level Azure.WebPubSub.ManagedIdentity Configure Web PubSub Services to use managed identities to access Azure resources securely. Important Error Azure.WebPubSub.SLA Use SKUs that include an SLA when configuring Web PubSub Services. Important Error"},{"location":"learn/learn-video-series/","title":"Learn PSRule for Azure series","text":""},{"location":"learn/learn-video-series/#introducing-psrule-for-azure","title":"Introducing PSRule for Azure","text":"<p>An introduction to PSRule for Azure and how it relates to the Azure Well-Architected Framework. We also give an quick overview of baselines, handling exceptions, and reporting options.</p>"},{"location":"learn/learn-video-series/#getting-started-using-github","title":"Getting started using GitHub","text":"<p>Getting started with PSRule for Azure using GitHub. We create a GitHub Actions workflow, enabled expansion, and iterate on Bicep code.</p>"},{"location":"learn/official/","title":"Official learning","text":""},{"location":"learn/official/#blog-posts","title":"Blog posts","text":""},{"location":"learn/official/#2022","title":"2022","text":"<ul> <li>Visualize Infrastructure as Code Maturity</li> <li>Introduction to Infrastructure As Code (IAC) Testing</li> </ul>"},{"location":"license-contributing/","title":"License and contributing","text":"<p>PSRule for Azure is licensed with an  MIT License, which means it's free to use and modify. But please check out the details.</p> <p>We  open source at Microsoft.</p> <p>In addition to our team, we hope you will think about contributing too. Here is how you can get started:</p> <ul> <li> Report issues.</li> <li> Upvote existing issues that are important to you.</li> <li> Improve documentation.</li> <li> Contribute code.</li> </ul> <p>Please read our contributing guidelines and code of conduct to learn how to contribute.</p>"},{"location":"license-contributing/get-started-contributing/","title":"Get started contributing","text":"<p>Welcome to PSRule for Azure! We are excited to have you contribute to the project. This guide will walk you through the process of setting up your local development environment, understanding the project structure, and submitting your first contribution.</p>"},{"location":"license-contributing/get-started-contributing/#fork-and-clone-the-repository","title":"Fork and clone the repository","text":"<p>To start contributing, the first step is to fork the repository to your GitHub account and then clone it to your local machine.</p> <ol> <li>Fork the repository \u2014  Fork.</li> <li>Clone your fork \u2014 Once the repository is forked, clone it to your local machine.</li> </ol> Git<pre><code>git clone https://github.com/YOUR_USERNAME/PSRule.Rules.Azure.git\ncd PSRule.Rules.Azure\n</code></pre>"},{"location":"license-contributing/get-started-contributing/#set-up-your-local-development-environment","title":"Set up your local development environment","text":"<p>PSRule for Azure requires the following dependencies for development:</p> <ul> <li>.NET SDK 8.0 \u2014 is used for building the project and core features.</li> <li>PowerShell \u2014 is used for building the project, running the rules tests, and development of some rules.</li> <li>Az PowerShell module \u2014 is used for exporting Azure resources and policies (in-flight).</li> </ul> <p>To install development dependencies, refer to the installation guide.</p>"},{"location":"license-contributing/get-started-contributing/#understand-the-project-structure","title":"Understand the Project Structure","text":"<p>Before you start coding, it's helpful to understand the organization of the repository. Some of the most common sub-directories that are worth knowing about include:</p> <ul> <li>docs/ \u2014 All documentation lives written in markdown.<ul> <li>en/rules/ \u2014 Markdown files for each rule.</li> <li>CHANGELOG-v1.md \u2014 Change log.</li> </ul> </li> <li>samples/ \u2014 Community samples.</li> <li>src/PSRule.Rules.Azure/ \u2014 Module source code.<ul> <li>rules/ \u2014 Rule source code.</li> </ul> </li> <li>tests/PSRule.Rules.Azure.Tests/ \u2014 Tests for rules and modules features.</li> </ul>"},{"location":"license-contributing/get-started-contributing/#contributing-to-code","title":"Contributing to Code","text":"<p>Before writing a fix or feature enhancement, ensure that an issue is logged. Be prepared to discuss your feature and take feedback. Additionally, ensure that your changes include unit tests and any necessary updates to the documentation.</p> <ol> <li>Create a new branch from <code>main</code> in your fork for your changes.</li> <li>Add commits in your branch, making sure they are logically grouped and well-described.</li> <li>If you have updated module code or rules, also update the <code>docs/CHANGELOG-v1.md</code>.<ul> <li>Note: You don't need to update the <code>docs/CHANGELOG-v1.md</code> for changes to unit tests or documentation.</li> </ul> </li> <li>Build your changes locally before pushing them. This ensures that they work as expected.</li> <li>Create a Pull Request (PR):<ul> <li>Once you are ready for your changes to be reviewed, create a PR to merge changes into the <code>main</code> branch.</li> <li>If your changes are not ready for review, create a draft pull request instead.</li> </ul> </li> <li>The Continuous Integration (CI) process will automatically build your changes.    Ensure that your changes build successfully to be merged.<ul> <li>If there are build errors, push new commits to your branch to fix them.</li> </ul> </li> </ol>"},{"location":"license-contributing/get-started-contributing/#building-and-testing-your-changes","title":"Building and testing your changes","text":"<p>Before opening a pull request, it\u2019s important to build and test your changes locally. PSRule for Azure uses Continuous Integration (CI) pipelines to test changes across MacOS, Linux, and Windows configurations.</p> <ol> <li>Build and test locally \u2014 Ensure that you can build your changes locally.    Follow the instructions in the Building from Source guide to set up your local environment for testing.</li> <li>Run all tests \u2014 Before creating your PR, run the tests to make sure your changes are working as expected.</li> </ol> PowerShell<pre><code>Invoke-Build Test -AssertStyle Client\n</code></pre>"},{"location":"license-contributing/get-started-contributing/#example-unit-test","title":"Example Unit Test","text":"<p>Here is an example of a unit test for validating rules: Azure.ACR.Tests.ps1 Example</p>"},{"location":"license-contributing/get-started-contributing/#commit-your-changes","title":"Commit your changes","text":"<p>Once your changes are ready, commit your changes to your fork:</p> Git<pre><code>git add .\ngit commit -m \"Brief description of your changes\"\ngit push origin YOUR_BRANCH\n</code></pre>"},{"location":"license-contributing/get-started-contributing/#submit-a-pull-request-pr","title":"Submit a pull request (PR)","text":"<ul> <li>Go to your forked repository on GitHub.</li> <li>Click on \"Compare &amp; pull request.\"</li> <li>In the provided PR template provide a clear and concise description of your changes.</li> </ul>"},{"location":"license-contributing/get-started-contributing/#review-and-approval","title":"Review and approval","text":"<p>What you can expect from review and approval of your contribution:</p> <ul> <li>Once your PR is submitted \u2014 project maintainers will review your changes and make suggestions or comments.   Be prepared to make updates based on feedback until your PR is approved.   If you are unclear on the feedback you can comment in the PR to get clarification.</li> <li>Automated CI tests \u2014 for your PR do not run automatically, a maintainer must approve running the workflow.   Once approved, if any automated CI tests fail be prepared to test your changes locally and update your branch.   If you get stuck, you can comment in the PR to ask questions.</li> <li>Update your PR \u2014 by adding commits to your branch and pushing changes to GitHub.   After a few moments your PR will update with your latest changes.   Avoid using forced pushes or squashing changes while your PR is active, as this makes it harder to review your changes.</li> <li>Contributor License Agreement (CLA) \u2014 The Microsoft policy bot may request you accept the CLA.   Please read and follow the instructions of the bot to complete acceptance of the Microsoft CLA.   We can not approve and merge your PR if it is flagged by the bot until the CLA is accepted.</li> <li>After PR approval \u2014 your PR will be merged into the main repository by the maintainers.</li> </ul>"},{"location":"license-contributing/get-started-contributing/#stay-engaged","title":"Stay engaged","text":"<ul> <li>Follow discussions and updates by subscribing to issues and PRs.</li> <li>Keep up with the latest changes in the project by regularly pulling updates from the upstream repository.</li> <li>Share feedback and help others when possible.</li> </ul>"},{"location":"license-contributing/get-started-contributing/#further-resources","title":"Further resources","text":"<ul> <li>Contributing Guide \u2013 Detailed guidelines for contributing to the project.</li> <li>PSRule Documentation \u2013 Learn about the PSRule engine used in this project.</li> <li>Azure Well-Architected Framework \u2013 Understand the principles that guide this project.</li> </ul>"},{"location":"license-contributing/hackathons/","title":"Past hackathons","text":""},{"location":"license-contributing/hackathons/#microsoft-global-hackathon-2022","title":"Microsoft Global Hackathon 2022","text":"<p>Thanks to the team who made the following contributions during the hackathon:</p> <ul> <li>New features:<ul> <li>Mapping of Azure Security Benchmark v3 to security rules by @jagoodwin.   #1610</li> </ul> </li> <li>New rules:<ul> <li>Azure Cache for Redis:<ul> <li>Check the number of firewall rules for caches by @jonathanruiz.   #544</li> <li>Check the number of IP addresses in firewall rules for caches by @jonathanruiz.   #544</li> </ul> </li> <li>App Configuration:<ul> <li>Check identity-based authentication is used for configuration stores by @pazdedav.   #1691</li> </ul> </li> <li>Application Gateway WAF:<ul> <li>Check policy is enabled by @fbinotto.   #1470</li> <li>Check policy uses prevention mode by @fbinotto.   #1470</li> <li>Check policy uses managed rule sets by @fbinotto.   #1470</li> <li>Check policy does not have any exclusions defined by @fbinotto.   #1470</li> </ul> </li> <li>Defender for Cloud:<ul> <li>Check Microsoft Defender for Cloud is enabled for Containers by @jdewisscher.   #1632</li> <li>Check Microsoft Defender for Cloud is enabled for Virtual Machines by @jdewisscher.   #1632</li> <li>Check Microsoft Defender for Cloud is enabled for SQL Servers by @jdewisscher.   #1632</li> <li>Check Microsoft Defender for Cloud is enabled for App Services by @jdewisscher.   #1632</li> <li>Check Microsoft Defender for Cloud is enabled for Storage Accounts by @jdewisscher.   #1632</li> <li>Check Microsoft Defender for Cloud is enabled for SQL Servers on machines by @jdewisscher.   #1632</li> </ul> </li> <li>Front Door WAF:<ul> <li>Check policy is enabled by @fbinotto.   #1470</li> <li>Check policy uses prevention mode by @fbinotto.   #1470</li> <li>Check policy uses managed rule sets by @fbinotto.   #1470</li> <li>Check policy does not have any exclusions defined by @fbinotto.   #1470</li> </ul> </li> <li>Network Security Group:<ul> <li>Check AKS managed NSGs don't contain custom rules by @ms-sambell.   #8</li> </ul> </li> <li>Storage Account:<ul> <li>Check blob container soft delete is enabled by @pazdedav.   #1671</li> <li>Check file share soft delete is enabled by @jonathanruiz.   #966</li> </ul> </li> </ul> </li> <li>Updated rules:<ul> <li>Updated rules, tests and docs with Microsoft Defender for Cloud by @jonathanruiz.   #545<ul> <li>The following rules have been renamed with aliases:<ul> <li>Renamed <code>Azure.SQL.ThreatDetection</code> to <code>Azure.SQL.DefenderCloud</code>.</li> <li>Renamed <code>Azure.SecurityCenter.Contact</code> to <code>Azure.DefenderCloud.Contact</code>.</li> <li>Renamed <code>Azure.SecurityCenter.Provisioning</code> to <code>Azure.DefenderCloud.Provisioning</code>.</li> </ul> </li> <li>If you are referencing the old names please consider updating to the new names.</li> </ul> </li> <li>Updated documentation examples for Front Door and Key Vault rules by @lluppesms.   #1667</li> </ul> </li> <li>General improvements:<ul> <li>Updated NSG documentation with code snippets and links by @simone-bennett.   #1607</li> <li>Updated Application Gateway documentation with code snippets by @ms-sambell.   #1608</li> <li>Updated SQL firewall rules documentation by @ms-sambell.   #1569</li> <li>Updated Container Apps documentation and rule to new resource type by @marie-schmidt.   #1672</li> <li>Updated KeyVault and FrontDoor documentation with code snippets by @lluppesms.   #1667</li> <li>Added tag and annotation metadata from policy for rules generation by @BernieWhite.   #1652</li> </ul> </li> <li>Bug fixes:<ul> <li>Fixed continue processing policy assignments on error by @BernieWhite.   #1651</li> <li>Fixed handling of runtime assessment data by @BernieWhite.   #1707</li> <li>Fixed conversion of type conditions to pre-conditions by @BernieWhite.   #1708</li> </ul> </li> </ul>"},{"location":"license-contributing/writing-documentation/","title":"Writing documentation","text":"<p>PSRule for Azure contains documentation ranging from conceptual, code examples, to recommendations. All of this documentation is written in markdown, open source, and available for you to contribute to.</p> <p>Some of the documentation that you might like to improve includes:</p> <ul> <li>Rule recommendations (<code>docs/en/rules/</code>).</li> <li>Scenarios and examples (<code>docs/customization/</code> and <code>docs/scenarios/</code>).</li> <li>PowerShell cmdlet and conceptual topics (<code>docs/commands/</code> and <code>docs/concepts/</code>).</li> </ul> <p>Abstract</p> <p>This topic covers contributing documentation in PSRule for Azure.</p>"},{"location":"license-contributing/writing-documentation/#rule-help","title":"Rule help","text":"<p>PSRule for Azure includes recommendations and expanded documentation with each rule. The recommendations are written in markdown and consumed by PSRule during analysis. This allows us to present easy to read web documentation without writing it separately for anaylsis.</p> <p>As a result, PSRule does require rule documentation to be structured in a standard way. Also we have standards about the metadata we required to ensure there is consistency across documentation.</p> <p>Some key points for writing rule help:</p> <ul> <li>Aligned \u2014 PSRule for Azure is aligned to the Microsoft Azure Well-Archtected Framework (WAF).</li> <li>Actionable \u2014 Any recommendations must be clear and actionable.   The reader must be able to understand:<ul> <li>What has been detected as an issue.</li> <li>Why it is considered an issue.</li> </ul> </li> <li>Learn by examples \u2014 For most cases, recommendations should include Azure Bicep and template examples.   Optionally CLI or PowerShell command reference may be included.   Examples should be as concise as possible.</li> <li>Documentation references \u2014 Each recommendation must include references to the WAF.   Additionally consider adding:<ul> <li>Links to provide more detail about the service feature.</li> <li>Azure deployment reference.</li> </ul> </li> </ul> <p>Please read our contributing guidelines and code of conduct to learn how to contribute.</p>"},{"location":"quickstarts/test-bicep-with-github/","title":"Test a Bicep deployment with GitHub Actions","text":"<p>Bicep supports using a parameter file to deploy a module to Azure.</p> <p>Abstract</p> <p>Learn how to setup your GitHub repository to automatically test Bicep deployments referenced using <code>.bicepparam</code> files.</p>"},{"location":"quickstarts/test-bicep-with-github/#before-you-begin","title":"Before you begin","text":"<p>This quickstart assumes you have already:</p> <ol> <li>Installed Git locally and created a GitHub account.    For more information, see Setup Git and Signing up for a new GitHub account.</li> <li>Created a GitHub repository and cloned it locally.    For more information, see Create a repo and Clone a repo.</li> <li> <p>Installed an editor or IDE locally to edit your repository files.    For more information, see Visual Studio Code.</p> </li> </ol>"},{"location":"quickstarts/test-bicep-with-github/#add-a-sample-bicep-deployment","title":"Add a sample Bicep deployment","text":"<p>If you don't already have a Bicep deployment in your repository, add a sample deployment.</p> <ol> <li>In the root of your repository, create a new folder called <code>deployments</code>.</li> <li>In the <code>deployments</code> folder, create a new file called <code>dev.bicepparam</code>.</li> <li>In the <code>deployments</code> folder, create a new file called <code>main.bicep</code>.</li> </ol> Example parameter file deployments/dev.bicepparam<pre><code>using 'main.bicep'\n\nparam environment = 'dev'\nparam name = 'kv-example-001'\nparam defaultAction = 'Deny'\nparam workspaceId = '/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/rg-test/providers/microsoft.operationalinsights/workspaces/workspace-001'\n</code></pre> Example deployment module deployments/main.bicep<pre><code>targetScope = 'resourceGroup'\n\nparam name string\nparam location string = resourceGroup().location\n\n@allowed([\n  'Allow'\n  'Deny'\n])\nparam defaultAction string = 'Deny'\nparam environment string\nparam workspaceId string = ''\n\nresource vault 'Microsoft.KeyVault/vaults@2023-02-01' = {\n  name: name\n  location: location\n  properties: {\n    sku: {\n      family: 'A'\n      name: 'standard'\n    }\n    tenantId: tenant().tenantId\n    enableSoftDelete: true\n    enablePurgeProtection: true\n    enableRbacAuthorization: true\n    networkAcls: {\n      defaultAction: defaultAction\n    }\n  }\n  tags: {\n    env: environment\n  }\n}\n\n@sys.description('Configure auditing for Key Vault.')\nresource logs 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = if (!empty(workspaceId)) {\n  name: 'service'\n  scope: vault\n  properties: {\n    workspaceId: workspaceId\n    logs: [\n      {\n        category: 'AuditEvent'\n        enabled: true\n      }\n    ]\n  }\n}\n</code></pre> <p>You can also find a copy of these files in the quickstart sample repository.</p>"},{"location":"quickstarts/test-bicep-with-github/#create-an-options-file","title":"Create an options file","text":"<p>PSRule can be configured using a default YAML options file called <code>ps-rule.yaml</code>. Many of configuration options you are likely to want to use can be set using this file. Options in this file will automatically be detected by other PSRule commands and tools.</p> <ol> <li>Create a new branch in your repository for your changes.    For more information, see Creating a branch.</li> <li>In the root of your repository, create a new file called <code>ps-rule.yaml</code>.</li> <li>Update the file with the following contents and save.</li> </ol> ps-rule.yaml<pre><code>#\n# PSRule configuration\n#\n\n# Please see the documentation for all configuration options:\n# https://aka.ms/ps-rule-azure/options\n\n# Require a minimum version of PSRule for Azure.\nrequires:\n  PSRule.Rules.Azure: '&gt;=1.34.0' # (1)\n\n# Automatically use rules for Azure.\ninclude:\n  module:\n  - PSRule.Rules.Azure # (2)\n\n# Ignore all files except .bicepparam files.\ninput:\n  pathIgnore:\n  - '**' # (3)\n  - '!**/*.bicepparam' # (4)\n</code></pre> <ol> <li>Set the minimum required version of PSRule for Azure to use.     This does not install the required version, but will fail if the version is not available.     Across a team and CI/CD pipeline, this can help ensure a consistent version of PSRule is used.</li> <li>Automatically use the rules in PSRule for Azure for each run.</li> <li>Ignore all files by default.     PSRule will not try to analyze ignored files.</li> <li>Add an exception for <code>.bicepparam</code> files.</li> </ol>"},{"location":"quickstarts/test-bicep-with-github/#create-a-workflow","title":"Create a workflow","text":"<p>GitHub Actions are configured using a YAML file called a workflow. A workflow is made up of one or more jobs and steps.</p> <ol> <li>In the root of your repository, create a new folder called <code>.github/workflows</code>.</li> <li>In the <code>.github/workflows</code> folder, create a new file called <code>analysis.yaml</code>.</li> <li>Update the file with the following contents and save.</li> </ol> GitHub Actions workflow<pre><code>#\n# Analyze repository with PSRule\n#\n\n# For PSRule documentation see:\n# https://aka.ms/ps-rule\n# https://aka.ms/ps-rule-azure\n\n# For action details see:\n# https://aka.ms/ps-rule-action\n\nname: Analyze repository\n\n# Run analysis for main or PRs against main\non:\n  push:\n    branches:\n    - main\n  pull_request:\n    branches:\n    - main\n\njobs:\n  analyze:\n    name: Analyze repository\n    runs-on: ubuntu-latest\n    steps:\n\n    - name: Checkout\n      uses: actions/checkout@v4\n\n    - name: Run PSRule analysis\n      uses: microsoft/ps-rule@v2.9.0 # (1)\n      with:\n        modules: PSRule.Rules.Azure # (2)\n</code></pre> <ol> <li>Reference the PSRule action.     You can find the latest version of the action on the GitHub Marketplace.</li> <li>Automatically download and use PSRule for Azure during analysis.</li> </ol>"},{"location":"quickstarts/test-bicep-with-github/#commit-and-push-changes","title":"Commit and push changes","text":"<ol> <li>Commit and push the changes to your repository.    For more information, see Committing changes to your project.</li> <li>Create a pull request to merge the changes into the <code>main</code> branch in GitHub.    For more information, see Creating a pull request.</li> <li> <p>Navigate to the Actions tab in your repository to check the status of the workflow.</p> </li> </ol>"},{"location":"quickstarts/test-bicep-with-github/#recommended-content","title":"Recommended content","text":"<ul> <li>Testing Bicep modules</li> <li>Restoring modules from a private registry</li> <li>Suppression and excluding rules</li> <li> <p>Enforcing custom tags</p> </li> </ul>"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/","title":"Validate Azure resources from templates with Azure Pipelines","text":"<p>Azure Resource Manager (ARM) templates are a JSON-based file structure. ARM templates are typically not static, they include parameters, functions and conditions. Depending on the parameters provided to a template, resources may differ significantly.</p> <p>Important resource properties that should be validated are often variables, parameters or deployed conditionally. Under these circumstances, to correctly validate resources in a template, parameters must be resolved.</p> <p>The following scenario shows how PSRule can be used to validate Azure resource templates within an Azure Pipeline.</p> <p>This scenario covers the following:</p> <ul> <li>Installing PSRule extension</li> <li>Linking parameter files to templates</li> <li>Creating a YAML pipeline<ul> <li>Installing Azure rules</li> <li>Exporting resource data for analysis</li> <li>Validating exported resources</li> </ul> </li> <li>Generating NUnit output</li> <li>Complete example</li> </ul>"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#installing-psrule-extension","title":"Installing PSRule extension","text":"<p>PSRule includes an extension that can be installed from the Visual Studio Marketplace. Once installed, Azure Pipelines tasks are available to install PSRule modules and run analysis.</p>"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#linking-parameter-files-to-templates","title":"Linking parameter files to templates","text":"<p>ARM template parameter files allows parameters for a deployment to be saved and checked into source control. PSRule can automatically resolve ARM templates from parameter files by using a metadata link.</p> <p>To link a parameter file to an ARM template add the <code>metadata.template</code> property within a parameter file.</p> <p>For example:</p> <pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"metadata\": {\n        \"template\": \"./azuredeploy.json\"\n    },\n    \"parameters\": {\n        \"vnetName\": {\n            \"value\": \"vnet-001\"\n        },\n        \"addressPrefix\": {\n            \"value\": [\n                \"10.1.0.0/24\"\n            ]\n        }\n    }\n}\n</code></pre> <p>In the example parameter file <code>azuredeploy.parameters.json</code> is linked to the template <code>azuredeploy.json</code>. The prefix of <code>./</code> indicates that the template file is in a relative path to the parameter file. If <code>./</code> is not included, PSRule will look for the template relative to the working directory.</p> <p>For example:</p> <pre><code>{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"metadata\": {\n        \"template\": \"templates/vnet-hub/v1/template.json\"\n    },\n    \"parameters\": {\n        \"vnetName\": {\n            \"value\": \"vnet-001\"\n        },\n        \"addressPrefix\": {\n            \"value\": [\n                \"10.1.0.0/24\"\n            ]\n        }\n    }\n}\n</code></pre>"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#creating-a-yaml-pipeline","title":"Creating a YAML pipeline","text":"<p>Azure Pipelines supports defining pipelines in YAML. PSRule uses a number of configurable task steps to install modules, export data and perform analysis.</p>"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#installing-azure-rules","title":"Installing Azure rules","text":"<p>To install the module containing Azure rules use the <code>ps-rule-install</code> YAML task.</p> <pre><code># Install PSRule.Rules.Azure from the PowerShell Gallery.\n- task: ps-rule-install@2\n  inputs:\n    module: PSRule.Rules.Azure   # Install PSRule.Rules.Azure from the PowerShell Gallery.\n</code></pre>"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#exporting-resource-data-for-analysis","title":"Exporting resource data for analysis","text":"<p>PSRule provides a pre-built cmdlets for finding template files within a path and exporting resource data.</p> <ul> <li><code>Get-AzRuleTemplateLink</code> finds linked templates from parameter files. By default, parameter files with the <code>*.parameters.json</code> extension are discovered. Files are found recursively from the current working path.</li> <li><code>Export-AzRuleTemplateData</code> exports resource data from template files.</li> </ul> <p>To generate data for analysis use a PowerShell YAML task to export resource data from linked templates.</p> <pre><code># Export resource data from parameter files within the current working directory.\n- powershell: Get-AzRuleTemplateLink | Export-AzRuleTemplateData -OutputPath out/templates/;\n  displayName: 'Export template data'\n</code></pre> <p>If parameter files are located in a specific sub-directory the path can be updated as follows.</p> <pre><code># Export resource data from parameter files in the deployments/ sub-directory.\n- powershell: Get-AzRuleTemplateLink ./deployments/ | Export-AzRuleTemplateData -OutputPath out/templates/;\n  displayName: 'Export template data'\n</code></pre> <p>If parameter files do not use the file extension <code>.parameters.json</code> input path can be set.</p> <pre><code># Export resource data from parameter files ending in *.json instead of default *.parameters.json.\n- powershell: Get-AzRuleTemplateLink -InputPath *.json | Export-AzRuleTemplateData -OutputPath out/templates/;\n  displayName: 'Export template data'\n</code></pre> <p>In both cases, resource data for analysis is exported to <code>out/templates/</code>.</p>"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#validating-exported-resources","title":"Validating exported resources","text":"<p>To validate exported resources use the <code>ps-rule-assert</code> YAML task. The following task uses previously exported resource data for analysis.</p> <pre><code># Run analysis from JSON files using the `PSRule.Rules.Azure` module and custom rules from `.ps-rule/`.\n- task: ps-rule-assert@2\n  inputs:\n    inputType: inputPath\n    inputPath: 'out/templates/*.json'        # Read exported resource data from 'out/templates/'.\n    modules: 'PSRule.Rules.Azure'            # Analyze objects using the rules within the PSRule.Rules.Azure PowerShell module.\n    # Optionally, also analyze objects using custom rules from '.ps-rule/'.\n    source: '.ps-rule/'\n    # Optionally, save results to an NUnit report.\n    outputFormat: NUnit3\n    outputPath: reports/ps-rule-resources.xml\n</code></pre> <p>In the example:</p> <ul> <li>Resource data is read from <code>out/templates/</code>.</li> <li>If custom rules are defined in the <code>.ps-rule/</code> these are also evaluated.</li> <li>Validation results are saved as an NUnit report.</li> </ul>"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#generating-nunit-output","title":"Generating NUnit output","text":"<p>NUnit is a popular unit test framework for .NET. PSRule supports publishing validation results in the NUnit format. With Azure DevOps, an NUnit report can be published using Publish Test Results task.</p> <p>An example YAML snippet is included below:</p> <pre><code># Publish NUnit report as test results\n- task: PublishTestResults@2\n  displayName: 'Publish PSRule results'\n  inputs:\n    testRunTitle: 'PSRule'                          # The title to use for the test run.\n    testRunner: NUnit                               # Import report using the NUnit format.\n    testResultsFiles: 'reports/ps-rule-results.xml' # The previously saved NUnit report.\n  condition: succeededOrFailed()                    # Run this task if previous steps succeeded of failed.\n</code></pre>"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#complete-example","title":"Complete example","text":"<p>Putting each of these steps together.</p>"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#azure-devops-pipeline","title":"Azure DevOps Pipeline","text":"<pre><code>#\n# PSRule with Azure Pipelines\n#\n\ntrigger:\n- main\n\npool:\n  vmImage: 'ubuntu-latest'\n\nsteps:\n\n# Install PSRule.Rules.Azure from the PowerShell Gallery\n- task: ps-rule-install@2\n  inputs:\n    module: PSRule.Rules.Azure   # Install PSRule.Rules.Azure from the PowerShell Gallery.\n\n# Export resource data from parameter files within the current working directory.\n- powershell: Get-AzRuleTemplateLink | Export-AzRuleTemplateData -OutputPath out/templates/;\n  displayName: 'Export template data'\n\n# Run analysis from JSON files using the `PSRule.Rules.Azure` module and custom rules from `.ps-rule/`.\n- task: ps-rule-assert@2\n  inputs:\n    inputType: inputPath\n    inputPath: 'out/templates/*.json'        # Read exported resource data from 'out/templates/'.\n    modules: 'PSRule.Rules.Azure'            # Analyze objects using the rules within the PSRule.Rules.Azure PowerShell module.\n    # Optionally, also analyze objects using custom rules from '.ps-rule/'.\n    source: '.ps-rule/'\n    # Optionally, save results to an NUnit report.\n    outputFormat: NUnit3\n    outputPath: reports/ps-rule-resources.xml\n\n# Publish NUnit report as test results\n- task: PublishTestResults@2\n  displayName: 'Publish PSRule results'\n  inputs:\n    testRunTitle: 'PSRule'                          # The title to use for the test run.\n    testRunner: NUnit                               # Import report using the NUnit format.\n    testResultsFiles: 'reports/ps-rule-*.xml'       # Use previously saved NUnit reports.\n    mergeTestResults: true                          # Merge multiple reports.\n  condition: succeededOrFailed()                    # Run this task if previous steps succeeded of failed.\n</code></pre>"},{"location":"scenarios/azure-pipelines-ci/azure-pipelines-ci/#more-information","title":"More information","text":"<ul> <li>azure-pipelines.yaml - An example Azure DevOps Pipeline.</li> <li>azuredeploy.json - An example template file.</li> <li>azuredeploy.parameters.json - An example parameters file.</li> </ul>"},{"location":"scenarios/azure-template-ci/azure-template-ci/","title":"Validate Azure resources from templates with continuous integration (CI)","text":"<p>Azure Resource Manager (ARM) templates are a JSON-based file structure. ARM templates are typically not static, they include parameters, functions and conditions. Depending on the parameters provided to a template, resources may differ significantly.</p> <p>Important resource properties that should be validated are often variables, parameters or deployed conditionally. Under these circumstances, to correctly validate resources in a template, parameters must be resolved.</p> <p>The following scenario shows how to validate Azure resources from templates using a generic pipeline. The examples provided can be integrated into a continuous integration (CI) pipeline able to run PowerShell.</p> <p>For integrating into Azure DevOps see Validate Azure resources from templates with Azure Pipelines.</p> <p>This scenario covers the following:</p> <ul> <li>Installing PSRule within a CI pipeline</li> <li>Exporting rule data for analysis</li> <li>Validating exported resources</li> <li>Formatting output</li> <li>Failing the pipeline</li> <li>Generating NUnit output</li> <li>Complete example</li> <li>Additional options</li> </ul>"},{"location":"scenarios/azure-template-ci/azure-template-ci/#installing-psrule-within-a-ci-pipeline","title":"Installing PSRule within a CI pipeline","text":"<p>Typically, PSRule is not pre-installed on CI worker nodes and must be installed within the pipeline. PSRule PowerShell modules need to be installed prior to calling PSRule cmdlets.</p> <p>If your CI pipeline runs on a persistent virtual machine that you control, consider pre-installing PSRule. The following examples focus on installing PSRule dynamically during execution of the pipeline. Which is suitable for cloud-based CI worker nodes.</p> <p>To install PSRule within a CI pipeline, execute the <code>Install-Module</code> PowerShell cmdlet.</p> <p>Depending on your environment, the CI worker process may not have administrative permissions. To install modules into the current context running the CI pipeline use <code>-Scope CurrentUser</code>. The PowerShell Gallery is not a trusted source by default. Use the <code>-Force</code> switch to suppress a prompt to install modules from PowerShell Gallery.</p> <p>For example:</p> <pre><code>$Null = Install-Module -Name PSRule.Rules.Azure -Scope CurrentUser -Force;\n</code></pre> <p>Installing <code>PSRule.Rules.Azure</code> also installs the base <code>PSRule</code> module and associated Azure dependencies. The <code>PSRule.Rules.Azure</code> module includes cmdlets and pre-built rules for validating Azure resources. Using the pre-built rules is completely optional.</p> <p>In some cases, installing NuGet and PowerShellGet may be required to connect to the PowerShell Gallery. The NuGet package provider can be installed using the <code>Install-PackageProvider</code> PowerShell cmdlet.</p> <pre><code>$Null = Install-PackageProvider -Name NuGet -Scope CurrentUser -Force;\n</code></pre> <p>The example below includes both steps together with checks:</p> <pre><code>if ($Null -eq (Get-PackageProvider -Name NuGet -ErrorAction SilentlyContinue)) {\n    $Null = Install-PackageProvider -Name NuGet -Scope CurrentUser -Force;\n}\n\nif ($Null -eq (Get-InstalledModule -Name PowerShellGet -MinimumVersion 2.2.1 -ErrorAction Ignore)) {\n    Install-Module PowerShellGet -MinimumVersion 2.2.1 -Scope CurrentUser -Force -AllowClobber;\n}\n\nif ($Null -eq (Get-InstalledModule -Name PSRule.Rules.Azure -MinimumVersion '0.12.1' -ErrorAction SilentlyContinue)) {\n    $Null = Install-Module -Name PSRule.Rules.Azure -Scope CurrentUser -MinimumVersion '0.12.1' -Force;\n}\n</code></pre> <p>Add <code>-AllowPrerelease</code> to install pre-release versions. See the change log for the latest version.</p>"},{"location":"scenarios/azure-template-ci/azure-template-ci/#exporting-rule-data-for-analysis","title":"Exporting rule data for analysis","text":"<p>In PSRule, the <code>Export-AzRuleTemplateData</code> cmdlet resolves a template and returns a resultant set of resources. The resultant set of resources can then be validated.</p> <p>No connectivity to Azure is required by default when calling <code>Export-AzRuleTemplateData</code>.</p>"},{"location":"scenarios/azure-template-ci/azure-template-ci/#export-cmdlet-parameters","title":"Export cmdlet parameters","text":"<p>To run <code>Export-AzRuleTemplateData</code> two key parameters are required:</p> <ul> <li><code>-TemplateFile</code> - An absolute or relative path to the template JSON file.</li> <li><code>-ParameterFile</code> - An absolute or relative path to one or more parameter JSON files.</li> </ul> <p>The <code>-ParameterFile</code> parameter is optional when all parameters defined in the template have <code>defaultValue</code> set.</p> <p>Optionally the following parameters can be used:</p> <ul> <li><code>-Name</code> - The name of the deployment. If not specified a default name of <code>export-&lt;xxxxxxxx&gt;</code> will be used.</li> <li><code>-OutputPath</code> - An absolute or relative path where the resultant resources will be written to JSON. If not specified the current working path be used.</li> <li><code>-ResourceGroup</code> - The name of a resource group where the deployment is intended to be run. If not specified placeholder values will be used.</li> <li><code>-Subscription</code> - The name or subscription Id of a subscription where the deployment is intended to be run. If not specified placeholder values will be used.</li> </ul> <p>See cmdlet help for a full list of parameters.</p> <p>If <code>-OutputPath</code> is a directory or is not set, the output file will be automatically named <code>resources-&lt;name&gt;.json</code>.</p> <p>For example:</p> <pre><code>Export-AzRuleTemplateData -TemplateFile .\\template.json -ParameterFile .\\parameters.json;\n</code></pre> <p>Multiple parameter files that map to the same template can be supplied in a single cmdlet call. Additional templates can be exported by calling <code>Export-AzRuleTemplateData</code> multiple times.</p>"},{"location":"scenarios/azure-template-ci/azure-template-ci/#use-of-placeholder-values","title":"Use of placeholder values","text":"<p>A number of functions that can be used within Azure templates retrieve information from Azure. Some examples include <code>reference</code>, <code>subscription</code>, <code>resourceGroup</code>, <code>list*</code>.</p> <p>The default for <code>Export-AzRuleTemplateData</code> is to operate without requiring authenticated connectivity to Azure. As a result, functions that retrieve information from Azure use placeholders such as <code>{{Subscription.SubscriptionId}}</code>.</p> <p>To provide a real value for <code>subscription</code> and <code>resourceGroup</code> use the <code>-Subscription</code> and <code>-ResourceGroup</code> parameters. When using <code>-Subscription</code> and <code>-ResourceGroup</code> the subscription and resource group must already exist. Additionally the context running the cmdlet must have at least read access (i.e. <code>Reader</code>).</p> <p>It is currently not possible to provide a real value for <code>reference</code> and <code>list*</code>, only placeholders will be used.</p> <p>Key Vault references in parameter files use placeholders instead of the real value to prevent accidental exposure of secrets.</p>"},{"location":"scenarios/azure-template-ci/azure-template-ci/#validating-exported-resources","title":"Validating exported resources","text":"<p>To validate exported resources use <code>Invoke-PSRule</code>, <code>Assert-PSRule</code> or <code>Test-PSRuleTarget</code>. In a CI pipeline, <code>Assert-PSRule</code> is recommended. <code>Assert-PSRule</code> outputs preformatted results ideal for use within a CI pipeline.</p> <p>Use <code>Assert-PSRule</code> with the resolved resource output as an input using <code>-InputPath</code>.</p> <p>In the following example, resources from <code>.\\resources.json</code> are validated against pre-built rules:</p> <pre><code>Assert-PSRule -InputPath .\\resources-export-*.json -Module PSRule.Rules.Azure;\n</code></pre> <p>Example output:</p> <pre><code> -&gt; vnet-001 : Microsoft.Network/virtualNetworks\n\n    [PASS] Azure.Resource.UseTags\n    [PASS] Azure.VirtualNetwork.UseNSGs\n    [PASS] Azure.VirtualNetwork.SingleDNS\n    [PASS] Azure.VirtualNetwork.LocalDNS\n\n -&gt; vnet-001/subnet2 : Microsoft.Network/virtualNetworks/subnets\n\n    [FAIL] Azure.Resource.UseTags\n</code></pre> <p>To process multiple input files a wildcard <code>*</code> can be used.</p> <pre><code>Assert-PSRule -InputPath .\\out\\*.json -Module PSRule.Rules.Azure;\n</code></pre>"},{"location":"scenarios/azure-template-ci/azure-template-ci/#formatting-output","title":"Formatting output","text":"<p>When executing a CI pipeline, feedback on any validation failures is important. The <code>Assert-PSRule</code> cmdlet provides easy to read formatted output instead of PowerShell objects.</p> <p>Additionally, <code>Assert-PSRule</code> supports styling formatted output for Azure Pipelines and GitHub Actions. Use the <code>-Style AzurePipelines</code> or <code>-Style GitHubActions</code> parameter to style output.</p> <p>For example:</p> <pre><code>Assert-PSRule -InputPath .\\out\\*.json -Style AzurePipelines -Module PSRule.Rules.Azure;\n</code></pre>"},{"location":"scenarios/azure-template-ci/azure-template-ci/#failing-the-pipeline","title":"Failing the pipeline","text":"<p>When using PSRule within a CI pipeline, a failed rule should stop the pipeline. When using <code>Assert-PSRule</code> if any rules fail, an error will be generated.</p> <pre><code>Assert-PSRule : One or more rules reported failure.\nAt line:1 char:1\n+ Assert-PSRule -Module PSRule.Rules.Azure -InputPath .\\out\\tests\\Resou ...\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+ CategoryInfo          : InvalidData: (:) [Assert-PSRule], FailPipelineException\n+ FullyQualifiedErrorId : PSRule.Fail,Assert-PSRule\n</code></pre> <p>A single PowerShell error is typically enough to stop a CI pipeline. If you are using a different configuration additionally <code>-ErrorAction Stop</code> can be used.</p> <p>For example:</p> <pre><code>Assert-PSRule -Module PSRule.Rules.Azure -InputPath .\\out\\*.json -ErrorAction Stop;\n</code></pre>"},{"location":"scenarios/azure-template-ci/azure-template-ci/#generating-nunit-output","title":"Generating NUnit output","text":"<p>NUnit is a popular unit test framework for .NET. NUnit generates a test report format that is widely interpreted by CI systems. While PSRule does not use NUnit directly, it support outputting validation results in the NUnit3 format. Using a common format allows integration with any system that supports the NUnit3 for publishing test results.</p> <p>To generate an NUnit report:</p> <ul> <li>Use the <code>-OutputFormat NUnit3</code> parameter.</li> <li>Use the <code>-OutputPath</code> parameter to specify the path of the report file to write.</li> </ul> <pre><code>Assert-PSRule -OutputFormat NUnit3 -OutputPath .\\reports\\rule-report.xml -Module PSRule.Rules.Azure -InputPath .\\out\\*.json;\n</code></pre> <p>The output path will be created if it does not exist.</p>"},{"location":"scenarios/azure-template-ci/azure-template-ci/#complete-example","title":"Complete example","text":"<p>Putting each of these steps together.</p>"},{"location":"scenarios/azure-template-ci/azure-template-ci/#install-dependencies","title":"Install dependencies","text":"<pre><code># Install dependencies for connecting to PowerShell Gallery\nif ($Null -eq (Get-PackageProvider -Name NuGet -ErrorAction Ignore)) {\n    Install-PackageProvider -Name NuGet -Force -Scope CurrentUser;\n}\n\nif ($Null -eq (Get-InstalledModule -Name PowerShellGet -MinimumVersion 2.2.1 -ErrorAction Ignore)) {\n    Install-Module PowerShellGet -MinimumVersion 2.2.1 -Scope CurrentUser -Force -AllowClobber;\n}\n</code></pre>"},{"location":"scenarios/azure-template-ci/azure-template-ci/#validate-templates","title":"Validate templates","text":"<pre><code># Install PSRule.Rules.Azure module\nif ($Null -eq (Get-InstalledModule -Name PSRule.Rules.Azure -MinimumVersion '0.12.1' -ErrorAction SilentlyContinue)) {\n    $Null = Install-Module -Name PSRule.Rules.Azure -Scope CurrentUser -MinimumVersion '0.12.1' -Force;\n}\n\n# Resolve resources\nExport-AzRuleTemplateData -TemplateFile .\\template.json -ParameterFile .\\parameters.json -OutputPath out/;\n\n# Validate resources\n$assertParams = @{\n    InputPath = 'out/*.json'\n    Module = 'PSRule.Rules.Azure'\n    Style = 'AzurePipelines'\n    OutputFormat = 'NUnit3'\n    OutputPath = 'reports/rule-report.xml'\n}\nAssert-PSRule @assertParams;\n</code></pre>"},{"location":"scenarios/azure-template-ci/azure-template-ci/#additional-options","title":"Additional options","text":""},{"location":"scenarios/azure-template-ci/azure-template-ci/#using-invoke-build","title":"Using Invoke-Build","text":"<p><code>Invoke-Build</code> is a build automation cmdlet that can be installed from the PowerShell Gallery by installing the InvokeBuild module. Within Invoke-Build, each build process is broken into tasks.</p> <p>The following example shows an example of using PSRule.Rules.Azure with InvokeBuild tasks.</p> <pre><code># Synopsis: Install PSRule modules\ntask InstallPSRule {\n    if ($Null -eq (Get-InstalledModule -Name PSRule.Rules.Azure -MinimumVersion '0.12.1' -ErrorAction SilentlyContinue)) {\n        $Null = Install-Module -Name PSRule.Rules.Azure -Scope CurrentUser -MinimumVersion '0.12.1' -Force;\n    }\n}\n\n# Synopsis: Run validation\ntask ValidateTemplate InstallPSRule, {\n    # Resolve resources\n    Export-AzRuleTemplateData -TemplateFile .\\template.json -ParameterFile .\\parameters.json -OutputPath out/;\n\n    # Validate resources\n    $assertParams = @{\n        InputPath = 'out/*.json'\n        Module = 'PSRule.Rules.Azure'\n        Style = 'AzurePipelines'\n        OutputFormat = 'NUnit3'\n        OutputPath = 'reports/rule-report.xml'\n    }\n    Assert-PSRule @assertParams;\n}\n\n# Synopsis: Run all build tasks\ntask Build ValidateTemplate\n</code></pre> <pre><code>Invoke-Build Build;\n</code></pre>"},{"location":"scenarios/azure-template-ci/azure-template-ci/#calling-from-pester","title":"Calling from Pester","text":"<p>Pester is a unit test framework for PowerShell that can be installed from the PowerShell Gallery.</p> <p>Typically, Pester unit tests are built for a particular pipeline. PSRule can complement Pester unit tests by providing dynamic and sharable rules that are easy to reuse. By using <code>-If</code> or <code>-Type</code> pre-conditions, rules can dynamically provide validation for a range of use cases.</p> <p>When calling PSRule from Pester use <code>Invoke-PSRule</code> instead of <code>Assert-PSRule</code>. <code>Invoke-PSRule</code> returns validation result objects that can be tested by Pester <code>Should</code> conditions.</p> <p>Additionally, the <code>Logging.RuleFail</code> option can be included to generate an error message for each failing rule.</p> <p>For example:</p> <pre><code>Describe 'Azure' {\n    Context 'Resource templates' {\n        It 'Use content rules' {\n            Export-AzRuleTemplateData -TemplateFile .\\template.json -ParameterFile .\\parameters.json -OutputPath .\\out\\resources.json;\n\n            # Validate resources\n            $invokeParams = @{\n                InputPath = 'out/*.json'\n                Module = 'PSRule.Rules.Azure'\n                OutputFormat = 'NUnit3'\n                OutputPath = 'reports/rule-report.xml'\n                Option = (New-PSRuleOption -LoggingRuleFail Error)\n            }\n            Invoke-PSRule @invokeParams -Outcome Fail,Error | Should -BeNullOrEmpty;\n        }\n    }\n}\n</code></pre>"},{"location":"scenarios/azure-template-ci/azure-template-ci/#more-information","title":"More information","text":"<ul> <li>pipeline-deps.ps1 - Example script installing pipeline dependencies.</li> <li>validate-template.ps1 - Example script for running template validation.</li> <li>template.json - Example template file.</li> <li>parameters.json - Example parameters file.</li> </ul>"},{"location":"setup/","title":"Configuring options","text":"<p>PSRule for Azure comes with many configuration options. Additionally, the PSRule engine includes several options that apply to all rules. You can visit the about_PSRule_Options topic to read about general PSRule options.</p> <p>Abstract</p> <p>This topic covers the basics of configuration options. A list of configuration options is available for:</p> <ul> <li>Configuring rule defaults</li> <li>Configuring expansion</li> <li>Configuring exports</li> </ul>"},{"location":"setup/#setting-options-in-yaml","title":"Setting options in YAML","text":"<p>Configuration options are set within the <code>ps-rule.yaml</code> file. PSRule will automatically find this file within the current working directory. To set options, create a new file named <code>ps-rule.yaml</code> in the root directory of your repository.</p> <p>For configuring pre-flight analysis, create a <code>ps-rule.yaml</code> in your current working directory.</p> <p>Tip</p> <p>This file should be committed to your repository so it is available when your pipeline runs.</p> <p>Note</p> <p>Use all lowercase characters <code>ps-rule.yaml</code> to name the file. On case-sensitive file systems, a file with uppercase characters may not be found.</p> <p>Configuration can be combined as indented keys. Use comments to add context.</p> <p>Example <code>ps-rule.yaml</code></p> <pre><code>requires:\n  # Require a minimum of PSRule for Azure v1.34.2\n  PSRule.Rules.Azure: '&gt;=1.34.2'\n\nconfiguration:\n  # Enable expansion of Azure Template files.\n  AZURE_PARAMETER_FILE_EXPANSION: true\n\n  # Enable expansion of Azure Bicep files.\n  AZURE_BICEP_FILE_EXPANSION: true\n\n  # Configure the timeout for bicep build to 15 seconds.\n  AZURE_BICEP_FILE_EXPANSION_TIMEOUT: 15\n\n  # Enable Bicep CLI checks.\n  AZURE_BICEP_CHECK_TOOL: true\n\n  # Optionally, configure the minimum version of the Bicep CLI.\n  AZURE_BICEP_MINIMUM_VERSION: '0.28.1'\n\n  # Configure the minimum AKS cluster version.\n  AZURE_AKS_CLUSTER_MINIMUM_VERSION: '1.29.7'\n\nrule:\n  # Enable custom rules that don't exist in the baseline\n  includeLocal: true\n  exclude:\n  # Ignore the following rules for all resources\n  - Azure.VM.UseHybridUseBenefit\n  - Azure.VM.Standalone\n\nsuppression:\n  Azure.AKS.AuthorizedIPs:\n  # Exclude the following externally managed AKS clusters\n  - aks-cluster-prod-eus-001\n  Azure.Storage.SoftDelete:\n  # Exclude the following non-production storage accounts\n  - storagedeveus6jo36t\n  - storagedeveus1df278\n</code></pre> <p>Tip</p> <p>YAML can be a bit particular about indenting. If something is not working, double check that you have consistent spacing in your options file. We recommend using two (2) spaces to indent.</p>"},{"location":"setup/#setting-environment-variables","title":"Setting environment variables","text":"<p>In addition to <code>ps-rule.yaml</code>, most options can be set using environment variables. When configuring environment variables we recommend that all capital letters are used. This is because environment variables are case-sensitive on some operating systems.</p> <p>PSRule environment variables use a consistent naming pattern of <code>PSRULE_&lt;PARENT&gt;_&lt;NAME&gt;</code>. Where <code>&lt;PARENT&gt;</code> is the parent class and <code>&lt;NAME&gt;</code> is the specific option.</p> <p>When setting environment variables:</p> <ul> <li>Enum values are set by string and are not case-sensitive.   For example <code>PSRULE_OUTPUT_FORMAT</code> could be set to <code>Yaml</code>.</li> <li>Boolean values are set by <code>true</code>, <code>false</code>, <code>1</code>, or <code>0</code> and are not case-sensitive.   For example <code>PSRULE_CONFIGURATION_AZURE_BICEP_FILE_EXPANSION</code> could be set to <code>true</code>.</li> <li>String array values can specify multiple items by using a semi-colon separator.   For example <code>PSRULE_RULE_EXCLUDE</code> could be set to <code>'Azure.VM.UseHybridUseBenefit;Azure.VM.Standalone'</code>.</li> </ul> GitHub ActionsAzure PipelinesPowerShellBash <pre><code>env:\n  PSRULE_CONFIGURATION_AZURE_BICEP_FILE_EXPANSION: true\n  PSRULE_OUTPUT_FORMAT: Yaml\n  PSRULE_RULE_EXCLUDE: 'Azure.VM.UseHybridUseBenefit;Azure.VM.Standalone'\n</code></pre> <pre><code>variables:\n- name: PSRULE_CONFIGURATION_AZURE_BICEP_FILE_EXPANSION\n  value: true\n- name: PSRULE_OUTPUT_FORMAT\n  value: Yaml\n- name: PSRULE_RULE_EXCLUDE\n  value: 'Azure.VM.UseHybridUseBenefit;Azure.VM.Standalone'\n</code></pre> <pre><code>$Env:PSRULE_CONFIGURATION_AZURE_BICEP_FILE_EXPANSION = 'true'\n$Env:PSRULE_OUTPUT_FORMAT = 'Yaml'\n$Env:PSRULE_RULE_EXCLUDE = 'Azure.VM.UseHybridUseBenefit;Azure.VM.Standalone'\n</code></pre> <pre><code>export PSRULE_CONFIGURATION_AZURE_BICEP_FILE_EXPANSION=true\nexport PSRULE_OUTPUT_FORMAT=Yaml\nexport PSRULE_RULE_EXCLUDE='Azure.VM.UseHybridUseBenefit;Azure.VM.Standalone'\n</code></pre>"},{"location":"setup/configuring-expansion/","title":"Configuring expansion","text":"<p>PSRule for Azure can automatically resolve Azure resource context at runtime from infrastructure code. This feature can be enabled by using the following configuration options.</p> <p>Tip</p> <p>Each of these configuration options are set within the <code>ps-rule.yaml</code> file. To learn how to set configuration options see Configuring options.</p>"},{"location":"setup/configuring-expansion/#available-options","title":"Available options","text":""},{"location":"setup/configuring-expansion/#parameter-file-expansion","title":"Parameter file expansion","text":"<p>v1.4.1</p> <p>This configuration option determines if Azure template parameter files will automatically be expanded. By default, parameter files will not be automatically expanded. When enabled, PSRule will discover and expand JSON parameter files for Azure templates or Bicep modules.</p> <p>Parameter files are expanded when PSRule cmdlets with the <code>-Format File</code> parameter are used.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_PARAMETER_FILE_EXPANSION: bool\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_PARAMETER_FILE_EXPANSION configuration option\nconfiguration:\n  AZURE_PARAMETER_FILE_EXPANSION: false\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_PARAMETER_FILE_EXPANSION configuration option to enable expansion\nconfiguration:\n  AZURE_PARAMETER_FILE_EXPANSION: true\n</code></pre>"},{"location":"setup/configuring-expansion/#bicep-source-expansion","title":"Bicep source expansion","text":"<p>v1.11.0</p> <p>This configuration option determines if Azure Bicep source files will automatically be expanded. By default, Bicep files will not be automatically expanded.</p> <p>Bicep files are expanded when PSRule cmdlets with the <code>-Format File</code> parameter are used.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_BICEP_FILE_EXPANSION: bool\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_BICEP_FILE_EXPANSION configuration option\nconfiguration:\n  AZURE_BICEP_FILE_EXPANSION: false\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_BICEP_FILE_EXPANSION configuration option to enable expansion\nconfiguration:\n  AZURE_BICEP_FILE_EXPANSION: true\n</code></pre>"},{"location":"setup/configuring-expansion/#bicep-parameter-expansion","title":"Bicep parameter expansion","text":"<p>v1.34.0</p> <p>This configuration option determines if Azure Bicep parameter files (<code>.bicepparam</code>) are expanded. By default, Bicep parameter files will be automatically expanded.</p> <p>Bicep files are expanded when PSRule cmdlets with the <code>-Format File</code> parameter are used.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_BICEP_PARAMS_FILE_EXPANSION: bool\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_BICEP_PARAMS_FILE_EXPANSION configuration option\nconfiguration:\n  AZURE_BICEP_PARAMS_FILE_EXPANSION: true\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_BICEP_PARAMS_FILE_EXPANSION configuration option to enable expansion\nconfiguration:\n  AZURE_BICEP_PARAMS_FILE_EXPANSION: false\n</code></pre>"},{"location":"setup/configuring-expansion/#bicep-compilation-timeout","title":"Bicep compilation timeout","text":"<p>v1.13.3</p> <p>This configuration option determines the maximum time to spend building a single Bicep source file. The timeout is configured in seconds.</p> <p>When a timeout occurs, PSRule for Azure stops the build and returns an error. Any resources contained within Bicep source files that exceeded the timeout are not analyzed.</p> <p>The default timeout is 5 seconds, however the timeout can be set to an integer between <code>1</code> and <code>120</code>.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_BICEP_FILE_EXPANSION_TIMEOUT: int\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_BICEP_FILE_EXPANSION_TIMEOUT configuration option\nconfiguration:\n  AZURE_BICEP_FILE_EXPANSION_TIMEOUT: 5\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_BICEP_FILE_EXPANSION_TIMEOUT configuration option to enable expansion\nconfiguration:\n  AZURE_BICEP_FILE_EXPANSION_TIMEOUT: 15\n</code></pre>"},{"location":"setup/configuring-expansion/#require-template-metadata-link","title":"Require template metadata link","text":"<p>v1.7.0</p> <p>This configuration option determines if Azure template parameter files require a metadata link. When configured to <code>true</code>, the <code>Azure.Template.MetadataLink</code> rule is enabled. Any Azure template parameter files that do not include a metadata link will report a fail for this rule.</p> <p>The rule <code>Azure.Template.MetadataLink</code> is not enabled by default. Additionally, when enabled this rule can still be excluded or suppressed like all other rules.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_PARAMETER_FILE_METADATA_LINK: bool\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_PARAMETER_FILE_METADATA_LINK configuration option\nconfiguration:\n  AZURE_PARAMETER_FILE_METADATA_LINK: false\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_PARAMETER_FILE_METADATA_LINK configuration option to enable expansion\nconfiguration:\n  AZURE_PARAMETER_FILE_METADATA_LINK: true\n</code></pre>"},{"location":"setup/configuring-expansion/#deployment-properties","title":"Deployment properties","text":"<p>v1.17.0</p> <p>This configuration option sets the deployment object use by the <code>deployment()</code> function. Configure this option to change the details of the deployment when exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below.</p> <p>This configuration option applies to the parent deployment. Nested deployments will use any properties configured within code. Additionally, this configuration option will be ignore when <code>-Name</code> is used with <code>Export-AzRuleTemplateData</code>.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_DEPLOYMENT:\n    name: string\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_DEPLOYMENT configuration option\nconfiguration:\n  AZURE_DEPLOYMENT:\n    name: 'ps-rule-test-deployment'\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Override the name of the deployment object.\nconfiguration:\n  AZURE_DEPLOYMENT:\n    name: 'deploy-web-application'\n</code></pre>"},{"location":"setup/configuring-expansion/#deployment-resource-group","title":"Deployment resource group","text":"<p>v1.1.0</p> <p>This configuration option sets the resource group object used by the <code>resourceGroup()</code> function. Configure this option to change the resource group object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below.</p> <p>This configuration option will be ignored when <code>-ResourceGroup</code> is used with <code>Export-AzRuleTemplateData</code>.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_RESOURCE_GROUP:\n    name: string\n    location: string\n    tags: object\n    properties:\n      provisioningState: string\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_RESOURCE_GROUP configuration option\nconfiguration:\n  AZURE_RESOURCE_GROUP:\n    name: 'ps-rule-test-rg'\n    location: 'eastus'\n    tags: { }\n    properties:\n      provisioningState: 'Succeeded'\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Override the location of the resource group object.\nconfiguration:\n  AZURE_RESOURCE_GROUP:\n    location: 'australiasoutheast'\n</code></pre>"},{"location":"setup/configuring-expansion/#deployment-subscription","title":"Deployment subscription","text":"<p>v1.1.0</p> <p>This configuration option sets the subscription object used by the <code>subscription()</code> function. Configure this option to change the subscription object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below.</p> <p>This configuration option will be ignored when <code>-Subscription</code> is used with <code>Export-AzRuleTemplateData</code>.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_SUBSCRIPTION:\n    subscriptionId: string\n    displayName: string\n    state: string\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_SUBSCRIPTION configuration option\nconfiguration:\n  AZURE_SUBSCRIPTION:\n    subscriptionId: 'ffffffff-ffff-ffff-ffff-ffffffffffff'\n    displayName: 'PSRule Test Subscription'\n    state: 'NotDefined'\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Override the display name of the subscription object\nconfiguration:\n  AZURE_SUBSCRIPTION:\n    displayName: 'My test subscription'\n</code></pre>"},{"location":"setup/configuring-expansion/#deployment-tenant","title":"Deployment tenant","text":"<p>v1.11.0</p> <p>This configuration option sets the tenant object used by the <code>tenant()</code> function. Configure this option to change the tenant object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_TENANT:\n    countryCode: string\n    tenantId: string\n    displayName: string\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_TENANT configuration option\nconfiguration:\n  AZURE_TENANT:\n    countryCode: 'US'\n    tenantId: 'ffffffff-ffff-ffff-ffff-ffffffffffff'\n    displayName: 'PSRule'\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Override the display name of the tenant object\nconfiguration:\n  AZURE_TENANT:\n    displayName: 'Contoso'\n</code></pre>"},{"location":"setup/configuring-expansion/#deployment-management-group","title":"Deployment management group","text":"<p>v1.11.0</p> <p>This configuration option sets the management group object used by the <code>managementGroup()</code> function. Configure this option to change the management group object when using exporting templates for analysis. Provided properties will override the default. Any properties that are not provided with use the defaults as specified below.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_MANAGEMENT_GROUP:\n    name: string\n    properties:\n      displayName: string\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_MANAGEMENT_GROUP configuration option\nconfiguration:\n  AZURE_MANAGEMENT_GROUP:\n    name: 'psrule-test'\n    properties:\n      displyName: 'PSRule Test Management Group'\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Override the display name of the management group object\nconfiguration:\n  AZURE_MANAGEMENT_GROUP:\n    properties:\n      displayName: 'My test management group'\n</code></pre>"},{"location":"setup/configuring-expansion/#required-parameter-defaults","title":"Required parameter defaults","text":"<p>v1.13.0</p> <p>This configuration option allows a fallback value to be configured for required parameters. When a parameter value is not provided and a default is not set, the fallback value will be used.</p> <p>Configure this option when you are providing a set of common parameters dynamically during a pipeline. In this scenario, it may not make sense to add the parameters to a parameter file or Bicep deployment.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_PARAMETER_DEFAULTS:\n    &lt;parameter&gt;: &lt;value&gt;\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_PARAMETER_DEFAULTS configuration option\nconfiguration:\n  AZURE_PARAMETER_DEFAULTS: { }\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set fallback values for adminPassword and workspaceId parameters.\nconfiguration:\n  AZURE_PARAMETER_DEFAULTS:\n    adminPassword: $CREDENTIAL_PLACEHOLDER$\n    workspaceId: /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.OperationalInsights/workspaces/{workspaceName}\n</code></pre>"},{"location":"setup/configuring-expansion/#excluding-files","title":"Excluding files","text":"<p>Template or Bicep source files can be excluded from being processed by PSRule and expansion. To exclude a file, configure the <code>input.pathIgnore</code> option by providing a path spec to ignore.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>input:\n  pathIgnore:\n  - string\n  - string\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default input.pathIgnore option\ninput:\n  pathIgnore: []\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Exclude a file from being processed by PSRule and expansion\ninput:\n  pathIgnore:\n  - 'out/'\n  - 'modules/**/*.bicep'\n</code></pre>"},{"location":"setup/configuring-exports/","title":"Configuring exports","text":"<p>For in-flight analysis or when using policy as rules data may be exported from one or more subscriptions. To configure the export process see the following configuration options.</p> <p>To use a configuration option, you must use the minimum version specified. Earlier versions of PSRule for Azure will ignore the configuration option.</p>"},{"location":"setup/configuring-exports/#general","title":"General","text":""},{"location":"setup/configuring-exports/#psrule_azure_resource_module_nowarn","title":"PSRULE_AZURE_RESOURCE_MODULE_NOWARN","text":"<p>v1.38.0</p> <p>This configuration option suppresses a warning when the minimum version of <code>Az.Resources</code> module is not installed. Unlike most options, this option can only set by environment variable.</p> <p>Syntax:</p> <pre><code>PSRULE_AZURE_RESOURCE_MODULE_NOWARN: boolean\n</code></pre> <p>Default:</p> <pre><code>PSRULE_AZURE_RESOURCE_MODULE_NOWARN: false\n</code></pre> <p>Example:</p> GitHub ActionsAzure PipelinesPowerShellBash <pre><code>env:\n  PSRULE_AZURE_RESOURCE_MODULE_NOWARN: true\n</code></pre> <pre><code>variables:\n- name: PSRULE_AZURE_RESOURCE_MODULE_NOWARN\n  value: true\n</code></pre> <pre><code>$Env:PSRULE_AZURE_RESOURCE_MODULE_NOWARN = 'true'\n</code></pre> <pre><code>export PSRULE_AZURE_RESOURCE_MODULE_NOWARN=true\n</code></pre>"},{"location":"setup/configuring-exports/#policy-as-rules","title":"Policy as rules","text":"<p>The following configuration options apply when using policy as rules.</p>"},{"location":"setup/configuring-exports/#azure_policy_ignore_list","title":"AZURE_POLICY_IGNORE_LIST","text":"<p>v1.21.0</p> <p>This configuration option configures a custom list policy definitions to ignore when exporting policy to rules. In addition to the custom list, a built-in list of policies are ignored. The built-in list can be found here.</p> <p>Configure this option to ignore policy definitions that:</p> <ul> <li>Already have a rule defined.</li> <li>Are not relevant to testing Infrastructure as Code.</li> </ul> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_POLICY_IGNORE_LIST: array\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_POLICY_IGNORE_LIST configuration option\nconfiguration:\n  AZURE_POLICY_IGNORE_LIST: []\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Add custom policy definitions to ignore\nconfiguration:\n  AZURE_POLICY_IGNORE_LIST:\n  - '/providers/Microsoft.Authorization/policyDefinitions/1f314764-cb73-4fc9-b863-8eca98ac36e9'\n  - '/providers/Microsoft.Authorization/policyDefinitions/b54ed75b-3e1a-44ac-a333-05ba39b99ff0'\n</code></pre>"},{"location":"setup/configuring-exports/#azure_policy_rule_prefix","title":"AZURE_POLICY_RULE_PREFIX","text":"<p>v1.20.0</p> <p>This configuration option sets the prefix for names of exported rules. Configure this option to change the prefix, which defaults to <code>Azure</code>.</p> <p>This configuration option will be ignored when <code>-Prefix</code> is used with <code>Export-AzPolicyAssignmentRuleData</code>.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_POLICY_RULE_PREFIX: string\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_POLICY_RULE_PREFIX configuration option\nconfiguration:\n  AZURE_POLICY_RULE_PREFIX: Azure\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Override the prefix of exported policy rules\nconfiguration:\n  AZURE_POLICY_RULE_PREFIX: AzureCustomPrefix\n</code></pre>"},{"location":"setup/configuring-rules/","title":"Configuring rule defaults","text":"<p>PSRule for Azure include several rules that can be configured. Setting these values overrides the default configuration with organization specific values.</p> <p>To use a configuration option, you must use the minimum version specified. Earlier versions of PSRule for Azure will ignore the configuration option.</p> <p>Tip</p> <p>Each of these configuration options are set within the <code>ps-rule.yaml</code> file. To learn how to set configuration options see Configuring options.</p>"},{"location":"setup/configuring-rules/#available-options","title":"Available options","text":""},{"location":"setup/configuring-rules/#azure_aks_cluster_minimum_system_nodes","title":"AZURE_AKS_CLUSTER_MINIMUM_SYSTEM_NODES","text":"<p>v1.34.0 Azure.AKS.MinNodeCount</p> <p>This configuration option determines the minimum number of nodes in an AKS clusters across all system node pools.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_AKS_CLUSTER_MINIMUM_SYSTEM_NODES: integer\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_AKS_CLUSTER_MINIMUM_SYSTEM_NODES configuration option\nconfiguration:\n  AZURE_AKS_CLUSTER_MINIMUM_SYSTEM_NODES: 3\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_AKS_CLUSTER_MINIMUM_SYSTEM_NODES configuration option to 2\nconfiguration:\n  AZURE_AKS_CLUSTER_MINIMUM_SYSTEM_NODES: 2\n</code></pre>"},{"location":"setup/configuring-rules/#azure_aks_cluster_minimum_version","title":"AZURE_AKS_CLUSTER_MINIMUM_VERSION","text":"<p>v1.12.0 Azure.AKS.Version</p> <p>This configuration option determines the minimum version of Kubernetes for AKS clusters and node pools. Rules that check the Kubernetes version fail when the version is older than the version specified.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_AKS_CLUSTER_MINIMUM_VERSION: string # A version string\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option\nconfiguration:\n  AZURE_AKS_CLUSTER_MINIMUM_VERSION: 1.29.7\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_AKS_CLUSTER_MINIMUM_VERSION configuration option to 1.22.4\nconfiguration:\n  AZURE_AKS_CLUSTER_MINIMUM_VERSION: 1.22.4\n</code></pre>"},{"location":"setup/configuring-rules/#azure_aks_cni_minimum_cluster_subnet_size","title":"AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE","text":"<p>v1.7.0 Azure.AKS.CNISubnetSize</p> <p>This configuration option determines the minimum subnet size for Azure AKS CNI.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE: integer\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE configuration option\nconfiguration:\n  AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE: 23\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE configuration option to 26\nconfiguration:\n  AZURE_AKS_CNI_MINIMUM_CLUSTER_SUBNET_SIZE: 26\n</code></pre>"},{"location":"setup/configuring-rules/#azure_aks_additional_region_availability_zone_list","title":"AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST","text":"<p>This configuration option adds availability zones that are not included in the existing providers. You can use this option to add availability zones that are not included in the default list.</p> <p>The following providers are supported:</p> <ul> <li><code>Microsoft.Compute/virtualMachineScaleSets</code></li> <li><code>Microsoft.Network/applicationGateways</code></li> <li><code>Microsoft.Network/publicIPAddresses</code></li> <li><code>Microsoft.ApiManagement/service</code></li> <li><code>Microsoft.Cache/Redis</code></li> <li><code>Microsoft.Cache/redisEnterprise</code></li> </ul> <p>The following rules and configuration options are supported:</p> <ul> <li><code>Azure.AKS.AvailabilityZone</code> - <code>AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST</code></li> <li><code>Azure.AppGw.AvailabilityZone</code> - <code>AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST</code></li> <li><code>Azure.PublicIP.AvailabilityZone</code> - <code>AZURE_PUBLICIP_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST</code></li> <li><code>Azure.APIM.AvailabilityZone</code> - <code>AZURE_APIM_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST</code></li> <li><code>Azure.Redis.AvailabilityZone</code> - <code>AZURE_REDISCACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST</code></li> <li><code>Azure.RedisEnterprise.Zones</code> - <code>AZURE_REDISENTERPRISECACHE_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST</code></li> </ul> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST: array\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option\nconfiguration:\n  AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST: []\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option to Antarctica North and Antarctica South, with zones 1, 2, 3.\nconfiguration:\n  AZURE_AKS_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST:\n  - location: Antarctica North\n    zones:\n      - '1'\n      - '2'\n      - '3'\n  - location: Antarctica South\n    zones:\n      - '1'\n      - '2'\n      - '3'\n</code></pre> <p>The above example, both these forms of location are accepted:</p> <ul> <li><code>Antarctica North</code> or <code>antarcticanorth</code></li> <li><code>Antarctica South</code> or <code>antarcticasouth</code></li> </ul> <p>The rules normalize these location formats so either is accepted in the configuration.</p> <p>Note</p> <p>The above are examples for illustration purpose only. At the time of writing, <code>Antarctica North</code> and <code>Antarctica South</code> are fictional locations. If they do in the future exist, use this option add them prior to PSRule for Azure support. The above shows examples specific to <code>Azure.AKS.AvailabilityZone</code>, but behavior is consistent across all supported rules.</p>"},{"location":"setup/configuring-rules/#azure_aks_enabled_platform_log_categories_list","title":"AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST","text":"<p>This configuration option sets selective platform diagnostic categories to report on being enabled.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST: array\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option\nconfiguration:\n  AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST:\n  - cluster-autoscaler\n  - kube-apiserver\n  - kube-controller-manager\n  - kube-scheduler\n  - AllMetrics\n</code></pre> <p>Example:</p> <pre><code># YAML: Set the AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option to cluster-autoscaler and AllMetrics categories only.\nconfiguration:\n  AZURE_AKS_ENABLED_PLATFORM_LOG_CATEGORIES_LIST:\n  - cluster-autoscaler\n  - AllMetrics\n</code></pre>"},{"location":"setup/configuring-rules/#azure_automationaccount_enabled_platform_log_categories_list","title":"AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST","text":"<p>This configuration option sets selective platform diagnostic categories to report on being enabled.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST: array\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option\nconfiguration:\n  AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST:\n  - JobLogs\n  - JobStreams\n  - DscNodeStatus\n  - AllMetrics\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST configuration option to JobLogs and AllMetrics categories only.\nconfiguration:\n  AZURE_AUTOMATIONACCOUNT_ENABLED_PLATFORM_LOG_CATEGORIES_LIST:\n  - JobLogs\n  - AllMetrics\n</code></pre>"},{"location":"setup/configuring-rules/#azure_aks_pool_minimum_maxpods","title":"AZURE_AKS_POOL_MINIMUM_MAXPODS","text":"<p>v1.39.0 Azure.AKS.NodeMinPods</p> <p>This configuration option determines the minimum allowed max pods setting per node pool. When an AKS cluster node pool is created, a <code>maxPods</code> option is used to determine the maximum number of pods for each node in the node pool.</p> <p>Depending on your workloads it may make sense to change this option:</p> <ul> <li>Micro-services/ web applications: 50+</li> <li>Data movement/ processing: 20-30</li> </ul> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_AKS_POOL_MINIMUM_MAXPODS: integer\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_AKS_POOL_MINIMUM_MAXPODS configuration option\nconfiguration:\n  AZURE_AKS_POOL_MINIMUM_MAXPODS: 50\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_AKS_POOL_MINIMUM_MAXPODS configuration option to 30\nconfiguration:\n  AZURE_AKS_POOL_MINIMUM_MAXPODS: 30\n</code></pre>"},{"location":"setup/configuring-rules/#azure_aks_cluster_user_pool_minimum_nodes","title":"AZURE_AKS_CLUSTER_USER_POOL_MINIMUM_NODES","text":"<p>v1.34.0 Azure.AKS.MinUserPoolNodes</p> <p>This configuration option determines the minimum number of nodes in each user node pool for an AKS clusters.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_AKS_CLUSTER_USER_POOL_MINIMUM_NODES: integer\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_AKS_CLUSTER_USER_POOL_MINIMUM_NODES configuration option\nconfiguration:\n  AZURE_AKS_CLUSTER_USER_POOL_MINIMUM_NODES: 3\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_AKS_CLUSTER_USER_POOL_MINIMUM_NODES configuration option to 2\nconfiguration:\n  AZURE_AKS_CLUSTER_USER_POOL_MINIMUM_NODES: 2\n</code></pre>"},{"location":"setup/configuring-rules/#azure_aks_cluster_user_pool_excluded_from_minimum_nodes","title":"AZURE_AKS_CLUSTER_USER_POOL_EXCLUDED_FROM_MINIMUM_NODES","text":"<p>v1.34.0 Azure.AKS.MinUserPoolNodes</p> <p>This configuration option excludes specific user node pools by name from requiring a minimum number of nodes. By default, no user node pools are configured to be excluded.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_AKS_CLUSTER_USER_POOL_EXCLUDED_FROM_MINIMUM_NODES: array\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_AKS_CLUSTER_USER_POOL_EXCLUDED_FROM_MINIMUM_NODES configuration option\nconfiguration:\n  AZURE_AKS_CLUSTER_USER_POOL_EXCLUDED_FROM_MINIMUM_NODES: []\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_AKS_CLUSTER_USER_POOL_EXCLUDED_FROM_MINIMUM_NODES configuration option to exclude nodepool2\nconfiguration:\n  AZURE_AKS_CLUSTER_USER_POOL_EXCLUDED_FROM_MINIMUM_NODES:\n  - nodepool2\n</code></pre>"},{"location":"setup/configuring-rules/#azure_apim_min_api_version","title":"AZURE_APIM_MIN_API_VERSION","text":"<p>v1.22.0 Azure.APIM.MinAPIVersion</p> <p>This configuration option sets the minimum API version used for control plane API calls to API Management instances. Configure this option to change the minimum API version, which defaults to <code>'2021-08-01'</code>.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_APIM_MIN_API_VERSION: string\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_APIM_MIN_API_VERSION configuration option\nconfiguration:\n  AZURE_APIM_MIN_API_VERSION: '2021-08-01'\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_APIM_MIN_API_VERSION configuration option to '2021-12-01-preview'\nconfiguration:\n  AZURE_APIM_MIN_API_VERSION: '2021-12-01-preview'\n</code></pre>"},{"location":"setup/configuring-rules/#azure_appgw_additional_region_availability_zone_list","title":"AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST","text":"<p>v1.8.0 Azure.AppGw.AvailabilityZone</p> <p>This configuration option adds availability zones that are not included in the existing providers. You can use this option to add availability zones that are not included in the default list.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST: array\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option\nconfiguration:\n  AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST: []\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST configuration option to Antarctica North and Antarctica South, with zones 1, 2, 3.\nconfiguration:\n  AZURE_APPGW_ADDITIONAL_REGION_AVAILABILITY_ZONE_LIST:\n  - location: Antarctica North\n    zones:\n      - '1'\n      - '2'\n      - '3'\n  - location: Antarctica South\n    zones:\n      - '1'\n      - '2'\n      - '3'\n</code></pre> <p>The above example, both these forms of location are accepted:</p> <ul> <li><code>Antarctica North</code> or <code>antarcticanorth</code></li> <li><code>Antarctica South</code> or <code>antarcticasouth</code></li> </ul> <p>The rules normalize these location formats so either is accepted in the configuration.</p> <p>Note</p> <p>The above are examples for illustration purpose only. At the time of writing, <code>Antarctica North</code> and <code>Antarctica South</code> are fictional locations. If they do in the future exist, use this option add them prior to PSRule for Azure support.</p>"},{"location":"setup/configuring-rules/#azure_containerapps_restrict_ingress","title":"AZURE_CONTAINERAPPS_RESTRICT_INGRESS","text":"<p>This configuration specifies whether if external ingress should be enabled or disabled.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_CONTAINERAPPS_RESTRICT_INGRESS: boolean\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_CONTAINERAPPS_RESTRICT_INGRESS configuration option\nconfiguration:\n  AZURE_CONTAINERAPPS_RESTRICT_INGRESS: false\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_CONTAINERAPPS_RESTRICT_INGRESS configuration option to enabled\nconfiguration:\n  AZURE_CONTAINERAPPS_RESTRICT_INGRESS: true\n</code></pre>"},{"location":"setup/configuring-rules/#azure_cosmos_defender_per_account","title":"AZURE_COSMOS_DEFENDER_PER_ACCOUNT","text":"<p>This configuration option enables validation for that each Cosmos DB account is associated with a Microsoft Defender for Cosmos DB resource level plan. Configure this option to enable the per account validation, which defaults to <code>false</code>.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_COSMOS_DEFENDER_PER_ACCOUNT: boolean\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_COSMOS_DEFENDER_PER_ACCOUNT configuration option\nconfiguration:\n  AZURE_COSMOS_DEFENDER_PER_ACCOUNT: false\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_COSMOS_DEFENDER_PER_ACCOUNT configuration option to true\nconfiguration:\n  AZURE_COSMOS_DEFENDER_PER_ACCOUNT: true\n</code></pre>"},{"location":"setup/configuring-rules/#azure_deployment_nonsensitive_parameter_names","title":"AZURE_DEPLOYMENT_NONSENSITIVE_PARAMETER_NAMES","text":"<p>v1.31.1 Azure.Deployment.SecureParameter</p> <p>This configuration overrides the default list of parameter names that are considered sensitive. By setting this configuration option, any parameters names specified are not considered sensitive.</p> <p>By default, <code>AZURE_DEPLOYMENT_NONSENSITIVE_PARAMETER_NAMES</code> is not configured.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_DEPLOYMENT_NONSENSITIVE_PARAMETER_NAMES: array\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_DEPLOYMENT_NONSENSITIVE_PARAMETER_NAMES configuration option\nconfiguration:\n  AZURE_DEPLOYMENT_NONSENSITIVE_PARAMETER_NAMES: []\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_DEPLOYMENT_NONSENSITIVE_PARAMETER_NAMES configuration option to enabled\nconfiguration:\n  AZURE_DEPLOYMENT_NONSENSITIVE_PARAMETER_NAMES:\n    - notSecret\n</code></pre>"},{"location":"setup/configuring-rules/#azure_deployment_sensitive_property_names","title":"AZURE_DEPLOYMENT_SENSITIVE_PROPERTY_NAMES","text":"<p>v1.20.0 Azure.Deployment.AdminUsername</p> <p>This configuration identifies potentially sensitive properties that should not use hardcoded values. By setting this configuration option, properties with the specified names will generate a failure when a hardcoded value is detected.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_DEPLOYMENT_SENSITIVE_PROPERTY_NAMES: array\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_DEPLOYMENT_SENSITIVE_PROPERTY_NAMES configuration option\nconfiguration:\n  AZURE_DEPLOYMENT_SENSITIVE_PROPERTY_NAMES:\n    - adminUsername\n    - administratorLogin\n    - administratorLoginPassword\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_DEPLOYMENT_SENSITIVE_PROPERTY_NAMES configuration option to enabled\nconfiguration:\n  AZURE_DEPLOYMENT_SENSITIVE_PROPERTY_NAMES:\n    - adminUsername\n    - administratorLogin\n    - administratorLoginPassword\n    - loginName\n</code></pre>"},{"location":"setup/configuring-rules/#azure_firewall_is_zonal","title":"AZURE_FIREWALL_IS_ZONAL","text":"<p>v1.39.0 Azure.VNET.FirewallSubnetNAT</p> <p>This configuration identifies if Azure Firewall deployments are expected to be zonal or zone redundant. Some specific configurations may require Azure Firewall deployed zonal. If you environment requires a zonal configuration set this to <code>true</code> which will toggle rules that apply to this configuration. By default, <code>AZURE_FIREWALL_IS_ZONAL</code> is set to <code>false</code>.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_FIREWALL_IS_ZONAL: boolean\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_FIREWALL_IS_ZONAL configuration option\nconfiguration:\n  AZURE_FIREWALL_IS_ZONAL: false\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_FIREWALL_IS_ZONAL configuration option to true\nconfiguration:\n  AZURE_FIREWALL_IS_ZONAL: true\n</code></pre>"},{"location":"setup/configuring-rules/#azure_resource_allowed_locations","title":"AZURE_RESOURCE_ALLOWED_LOCATIONS","text":"<p>v1.30.0 Azure.Resource.AllowedRegions</p> <p>This configuration option specifies a list of allowed locations that resources can be deployed to. Rules that check the location of Azure resources fail when a resource or resource group is created in a different region.</p> <p>By default, <code>AZURE_RESOURCE_ALLOWED_LOCATIONS</code> is not configured.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_RESOURCE_ALLOWED_LOCATIONS: array # An array of regions\n</code></pre> <p>Default:</p> <pre><code># YAML: The default Azure_AllowedRegions configuration option\nconfiguration:\n  AZURE_RESOURCE_ALLOWED_LOCATIONS: []\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_RESOURCE_ALLOWED_LOCATIONS configuration option to Australia East, Australia South East\nconfiguration:\n  AZURE_RESOURCE_ALLOWED_LOCATIONS:\n  - australiaeast\n  - australiasoutheast\n</code></pre> <p>If you configure the <code>AZURE_RESOURCE_ALLOWED_LOCATIONS</code> configuration value, also consider setting <code>AZURE_RESOURCE_GROUP</code> the configuration value to when resources use the location of the resource group.</p> <p>For example:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_RESOURCE_GROUP:\n    location: australiaeast\n</code></pre>"},{"location":"setup/configuring-rules/#azure_apim_minimum_certificate_lifetime","title":"AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME","text":"<p>v1.39.0 Azure.APIM.CertificateExpiry</p> <p>This configuration option determines the minimum number of days allowed before certificate expiry. Rules that check certificate lifetime fail when the days remaining before expiry drop below this number.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME: integer\n</code></pre> <p>Default:</p> <pre><code># YAML: The default AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME configuration option\nconfiguration:\n  AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME: 30\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME configuration option to 90\nconfiguration:\n  AZURE_APIM_MINIMUM_CERTIFICATE_LIFETIME: 90\n</code></pre>"},{"location":"setup/configuring-rules/#azure_linux_os_offers","title":"AZURE_LINUX_OS_OFFERS","text":"<p>v1.20.0</p> <p>This configurations specifies names of offers corresponding to the Linux OS. It's mostly intended to be used when analyzing templates that use private Linux offerings. Rules that check if a VM or VMSS has Linux OS also validate against the values set by this configuration.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_LINUX_OS_OFFERS: array # An array of offer names\n</code></pre> <p>Default:</p> <pre><code># YAML: The default AZURE_LINUX_OS_OFFERS configuration option\nconfiguration:\n  AZURE_LINUX_OS_OFFERS: []\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_LINUX_OS_OFFERS configuration option to aLinuxOffer, anotherLinuxOffer\nconfiguration:\n  AZURE_LINUX_OS_OFFERS:\n  - 'aLinuxOffer'\n  - 'anotherLinuxOffer'\n</code></pre>"},{"location":"setup/configuring-rules/#azure_policy_waiver_max_expiry","title":"AZURE_POLICY_WAIVER_MAX_EXPIRY","text":"<p>v1.3.0 Azure.Policy.WaiverExpiry</p> <p>This configuration option determines the maximum number of days in the future for a waiver policy exemption.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_POLICY_WAIVER_MAX_EXPIRY: integer\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code># YAML: The default AZURE_POLICY_WAIVER_MAX_EXPIRY configuration option\nconfiguration:\n  AZURE_POLICY_WAIVER_MAX_EXPIRY: 366\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_POLICY_WAIVER_MAX_EXPIRY configuration option to 90\nconfiguration:\n  AZURE_POLICY_WAIVER_MAX_EXPIRY: 90\n</code></pre>"},{"location":"setup/configuring-rules/#azure_storage_defender_per_account","title":"AZURE_STORAGE_DEFENDER_PER_ACCOUNT","text":"<p>v1.27.0 Azure.Storage.DefenderCloud</p> <p>This configuration option enables validation that storage accounts are associated with a resource level Microsoft Defender for Storage plan. By default, this option is set to <code>false</code> because configuration at the subscription level is recommended. Configure this option to enable the per account validation, which defaults to <code>false</code>.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_STORAGE_DEFENDER_PER_ACCOUNT: boolean\n</code></pre> <p>Default:</p> <pre><code># YAML: The default AZURE_STORAGE_DEFENDER_PER_ACCOUNT configuration option\nconfiguration:\n  AZURE_STORAGE_DEFENDER_PER_ACCOUNT: false\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># YAML: Set the AZURE_STORAGE_DEFENDER_PER_ACCOUNT configuration option to true\nconfiguration:\n  AZURE_STORAGE_DEFENDER_PER_ACCOUNT: true\n</code></pre>"},{"location":"setup/configuring-rules/#azure_vm_use_azure_hybrid_benefit","title":"AZURE_VM_USE_AZURE_HYBRID_BENEFIT","text":"<p>v1.33.0 Azure.VM.UseHybridUseBenefit</p> <p>This configuration option determines whether to check for Azure Hybrid Benefit (AHB) when deploying Windows VMs. When enabled, rules that check for AHB fail when the VM is not configured to use AHB.</p> <p>To use AHB, you must separately have eligible licenses, such as Windows Server or SQL Server.</p> <p>By default, this configuration option is set to <code>false</code>.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_VM_USE_AZURE_HYBRID_BENEFIT: boolean\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_VM_USE_AZURE_HYBRID_BENEFIT: false\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># Set the configuration option to enabled.\nconfiguration:\n  AZURE_VM_USE_AZURE_HYBRID_BENEFIT: true\n</code></pre>"},{"location":"setup/configuring-rules/#azure_vm_use_multi_tenant_hosting_rights","title":"AZURE_VM_USE_MULTI_TENANT_HOSTING_RIGHTS","text":"<p>v1.39.0 Azure.VM.MultiTenantHosting</p> <p>This configuration option determines weather to check for Multi-tenant Hosting Rights when deploying Windows VMs. When enabled, rules that check for MHR fail when a client VM is not configured to use MHR.</p> <p>By default, this configuration option is set to <code>false</code>.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_VM_USE_MULTI_TENANT_HOSTING_RIGHTS: boolean\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_VM_USE_MULTI_TENANT_HOSTING_RIGHTS: false\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># Set the configuration option to enabled.\nconfiguration:\n  AZURE_VM_USE_MULTI_TENANT_HOSTING_RIGHTS: true\n</code></pre>"},{"location":"setup/configuring-rules/#azure_vnet_dns_with_identity","title":"AZURE_VNET_DNS_WITH_IDENTITY","text":"<p>v1.30.0 Azure.VNET.LocalDNS</p> <p>Set this configuration option to <code>true</code> when DNS is deployed within the Identity subscription to avoid false positives.</p> <p>When deploying Active Directory Domain Services (ADDS) within Azure, you may decide to:</p> <ul> <li>Deploy an Identity subscription aligned to the Cloud Adoption Framework (CAF) Azure landing zone architecture.</li> <li>Host DNS services on the same VMs as ADDS, located in a separate VNET spoke for the Identity subscription.</li> </ul> <p>If you are using this configuration, we recommend you set the configuration option <code>AZURE_VNET_DNS_WITH_IDENTITY</code> to <code>true</code>. By default, this configuration option is set to <code>false</code>.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_VNET_DNS_WITH_IDENTITY: boolean\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_VNET_DNS_WITH_IDENTITY: false\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># Set the configuration option to enabled.\nconfiguration:\n  AZURE_VNET_DNS_WITH_IDENTITY: true\n</code></pre>"},{"location":"setup/configuring-rules/#azure_vnet_subnet_excluded_from_nsg","title":"AZURE_VNET_SUBNET_EXCLUDED_FROM_NSG","text":"<p>v1.33.0 Azure.VNET.UseNSGs</p> <p>This configuration option excludes subnets from requiring a Network Security Group (NSG). You can use this configuration option to exclude subnets that are specific to your environment. To configure this option, specify a list of subnet names to exclude.</p> <p>Syntax:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_VNET_SUBNET_EXCLUDED_FROM_NSG: array\n</code></pre> <p>Default:</p> ps-rule.yaml<pre><code>configuration:\n  AZURE_VNET_SUBNET_EXCLUDED_FROM_NSG: []\n</code></pre> <p>Example:</p> ps-rule.yaml<pre><code># Configure two customs subnets to be excluded from NSG checks.\nconfiguration:\n  AZURE_VNET_SUBNET_EXCLUDED_FROM_NSG:\n  - subnet-1\n  - subnet-2\n</code></pre>"},{"location":"setup/setup-azure-monitor-logs/","title":"Setup Azure Monitor logs","text":"<p>When analyzing Azure resources, you may want to capture the results of each analysis run. Azure Monitor provides a central storage location for log data through Log Analytics workspaces. Centrally storing PSRule results enables the following scenarios:</p> <ul> <li>Auditing and reporting \u2014 Report on analysis pass or failures.<ul> <li>Use Azure Monitor workbooks or custom queries to perform analysis and display results.</li> <li>Perform security analysis within Microsoft Azure Sentinel your a scalable, cloud-native SIEM.   Alternatively, export log data from Log Analytics for ingestion into a third-party SIEM.</li> </ul> </li> <li>Send notifications using alerts \u2014 Trigger alerts to send notifications.</li> <li>Integration with other workflows \u2014 Configure alerts and action groups to trigger integration.</li> </ul> <p>Abstract</p> <p>This topic covers setting up PSRule to log rule results into a Log Analytics workspace.</p>"},{"location":"setup/setup-azure-monitor-logs/#logging-into-a-log-analytics-workspace","title":"Logging into a Log Analytics workspace","text":"<p>Logging of PSRule results into a workspace is done using the PSRule for Azure Monitor module. PSRule for Azure Monitor extends the PSRule pipeline to import results into the specified workspace.</p> <p>Once configured, PSRule will log results into the <code>PSRule_CL</code> custom log table of the chosen workspace.</p> <p>Info</p> <p>Integration between PSRule and Azure Monitor is done by means of a convention. Conventions extend the pipeline to be able to upload results after rules have run.</p>"},{"location":"setup/setup-azure-monitor-logs/#setting-environment-variables","title":"Setting environment variables","text":"<p>PSRule for Azure Monitor requires a Log Analytics workspace to import results into. To configure the workspace to import results to the following environment variables must be set.</p> <ul> <li><code>PSRULE_CONFIGURATION_MONITOR_WORKSPACE_ID</code> - The unique ID (GUID) for the workspace to import results.</li> <li><code>PSRULE_CONFIGURATION_MONITOR_WORKSPACE_KEY</code> - Either the primary or secondary key of the workspace.</li> </ul> <p>How to set these environment variables is covered in the next section for GitHub Actions and Azure Pipelines.</p> <p>Tip</p> <p>Both the workspace ID and keys can be found under the Agents management settings of the workspace.</p>"},{"location":"setup/setup-azure-monitor-logs/#configuring-your-pipeline","title":"Configuring your pipeline","text":"<p>The convention that imports PSRule analysis results is not executed by default. To enable, reference the <code>Monitor.LogAnalytics.Import</code> convention in your analysis pipeline.</p>"},{"location":"setup/setup-azure-monitor-logs/#with-github-actions","title":"With GitHub Actions","text":"<p> GitHub Action</p> <p>Import analysis results into Azure Monitor with GitHub Actions by:</p> <ul> <li>Using the <code>PSRule.Monitor</code> module.</li> <li>Referencing the <code>Monitor.LogAnalytics.Import</code> convention.</li> <li>Configure secrets for <code>MONITOR_WORKSPACE_ID</code> and <code>MONITOR_WORKSPACE_KEY</code>.</li> </ul> StablePre-release <p>Install the latest stable module versions.</p> <pre><code>- name: Analyze Azure template files\n  uses: microsoft/ps-rule@v2.9.0\n  with:\n    modules: PSRule.Rules.Azure,PSRule.Monitor\n    conventions: Monitor.LogAnalytics.Import\n  env:\n    # Define environment variables using GitHub encrypted secrets\n    PSRULE_CONFIGURATION_MONITOR_WORKSPACE_ID: ${{ secrets.MONITOR_WORKSPACE_ID }}\n    PSRULE_CONFIGURATION_MONITOR_WORKSPACE_KEY: ${{ secrets.MONITOR_WORKSPACE_KEY }}\n</code></pre> <p>Install the latest stable or pre-release module versions.</p> <pre><code>- name: Analyze Azure template files\n  uses: microsoft/ps-rule@v2.9.0\n  with:\n    modules: PSRule.Rules.Azure,PSRule.Monitor\n    conventions: Monitor.LogAnalytics.Import\n    prerelease: true\n  env:\n    # Define environment variables using GitHub encrypted secrets\n    PSRULE_CONFIGURATION_MONITOR_WORKSPACE_ID: ${{ secrets.MONITOR_WORKSPACE_ID }}\n    PSRULE_CONFIGURATION_MONITOR_WORKSPACE_KEY: ${{ secrets.MONITOR_WORKSPACE_KEY }}\n</code></pre> <p>Important</p> <p>Environment variables can be configured in the workflow or from a secret. To keep <code>MONITOR_WORKSPACE_KEY</code> secure, use an encrypted secret.</p>"},{"location":"setup/setup-azure-monitor-logs/#with-azure-pipelines","title":"With Azure Pipelines","text":"<p> Extension</p> <p>Import analysis results into Azure Monitor with Azure Pipelines by:</p> <ul> <li>Installing the PSRule extension, then using the <code>ps-rule-assert</code> task in pipeline steps.</li> <li>Using the <code>PSRule.Monitor</code> module.</li> <li>Referencing the <code>Monitor.LogAnalytics.Import</code> convention.</li> <li>Configure variables for <code>MONITORWORKSPACEID</code> and <code>MONITORWORKSPACEKEY</code>.</li> </ul> StablePre-release <p>Install the latest stable module versions.</p> <pre><code>- task: ps-rule-assert@2\n  displayName: Analyze Azure template files\n  inputs:\n    modules: PSRule.Rules.Azure,PSRule.Monitor\n    conventions: Monitor.LogAnalytics.Import\n  env:\n    # Define environment variables within Azure Pipelines\n    PSRULE_CONFIGURATION_MONITOR_WORKSPACE_ID: $(MONITORWORKSPACEID)\n    PSRULE_CONFIGURATION_MONITOR_WORKSPACE_KEY: $(MONITORWORKSPACEKEY)\n</code></pre> <p>Install the latest stable or pre-release module versions.</p> <pre><code>- task: ps-rule-install@2\n  displayName: Install PSRule for Azure (pre-release)\n  inputs:\n    module: PSRule.Rules.Azure\n    prerelease: true\n\n- task: ps-rule-install@2\n  displayName: Install PSRule for Azure Monitor (pre-release)\n  inputs:\n    module: PSRule.Monitor\n    prerelease: true\n\n- task: ps-rule-assert@2\n  displayName: Analyze Azure template files\n  inputs:\n    modules: PSRule.Rules.Azure,PSRule.Monitor\n    conventions: Monitor.LogAnalytics.Import\n  env:\n    # Define environment variables within Azure Pipelines\n    PSRULE_CONFIGURATION_MONITOR_WORKSPACE_ID: $(MONITORWORKSPACEID)\n    PSRULE_CONFIGURATION_MONITOR_WORKSPACE_KEY: $(MONITORWORKSPACEKEY)\n</code></pre> <p>Important</p> <p>Variables can be configured in YAML, on the pipeline, or referenced from a defined variable group. To keep <code>MONITORWORKSPACEKEY</code> secure, use a variable group linked to an Azure Key Vault.</p>"},{"location":"setup/setup-azure-monitor-logs/#samples","title":"Samples","text":"<p>Continue reading for some sample resources you can try once this integration is setup Azure Monitor integration.</p>"},{"location":"setup/setup-azure-monitor-logs/#log-analytics-queries","title":"Log Analytics Queries","text":""},{"location":"setup/setup-azure-monitor-logs/#results-with-annotations","title":"Results with annotations","text":"Kusto<pre><code>// Show extended info\nPSRule_CL\n| where TimeGenerated &gt; ago(30d)\n| extend Pillar = tostring(parse_json(Annotations_s).pillar)\n| extend Link = tostring(parse_json(Annotations_s).[\"online version\"])\n</code></pre>"},{"location":"setup/setup-azure-monitor-logs/#summarize-results-by-run","title":"Summarize results by run","text":"Kusto<pre><code>// Group by run\nPSRule_CL\n| where TimeGenerated &gt; ago(30d)\n| summarize Pass=countif(Outcome_s == \"Pass\"), Fail=countif(Outcome_s  == \"Fail\") by RunId_s\n</code></pre>"},{"location":"setup/setup-azure-monitor-logs/#querying-the-data","title":"Querying The Data","text":"<p>Once the results have been published to the Log Analytics workspace, they can be queried by executing results against the <code>PSRule_CL</code> table (under Custom Logs). For more information on how to write Log Analytics querys, review the Log Analytics tutortial.</p>"},{"location":"setup/setup-azure-monitor-logs/#workbook","title":"Workbook","text":"<p> Workbook</p> <p>A sample Azure Monitor Workbook is available in the PSRule for Azure GitHub repository. This workbook can be imported directly into Azure Monitor and used as a foundation to build from. Review the Workbook creation tutorial for instructions on how to work with the sample Workbook.</p>"},{"location":"setup/setup-bicep/","title":"Setup Bicep","text":"<p>To expand Azure resources for analysis from Bicep source files the Bicep CLI is required. The Bicep CLI is already installed on hosted runners and agents used by GitHub Actions and Azure Pipelines.</p> <p>Abstract</p> <p>This topic covers setting up support for analyzing Azure resources within Bicep source files.</p>"},{"location":"setup/setup-bicep/#installing-bicep-cli","title":"Installing Bicep CLI","text":"<p>PSRule for Azure requires a minimum of Bicep CLI version 0.4.451. However the features you use within Bicep may require a newer version of the Bicep CLI.</p> <p>You may need to install or upgrade the Bicep CLI in the following scenarios:</p> <ul> <li>Your Bicep source files require a newer version of the CLI then supported by hosted agents.   The Bicep CLI version can be found in the included software list for each supported platform.</li> <li>You are using self-hosted runners with your GitHub Actions workflow.</li> <li>You are using self-hosted agents with Azure Pipelines.</li> <li>You are performing local validation or using a different CI platform.</li> </ul> <p>The Bicep CLI can be installed on MacOS, Linux, and Windows. For installation instructions see Setup your Bicep development environment.</p> <p>Tip</p> <p>When installing Bicep using the Azure CLI, Bicep is not added to the <code>PATH</code> environment variable. To use PSRule for Azure with the Azure CLI set the <code>PSRULE_AZURE_BICEP_USE_AZURE_CLI</code> to <code>true</code>. Setting this environment variable is explained in the next section.</p>"},{"location":"setup/setup-bicep/#setting-environment-variables","title":"Setting environment variables","text":"<p>When expanding Bicep files, the path to the Bicep CLI binary is required. By default, the <code>PATH</code> environment variable will be used to discover the binary path. When using this option, add the sub-directory containing the Bicep binary to the environment variable.</p> <p>Alternatively, the path can be overridden by setting the <code>PSRULE_AZURE_BICEP_PATH</code> environment variable. When setting <code>PSRULE_AZURE_BICEP_PATH</code> specify the full path to the Bicep binary including the file name. File names used for Bicep binaries include <code>bicep</code>, or <code>bicep.exe</code>.</p> <p>Example</p> Bash<pre><code>export PSRULE_AZURE_BICEP_PATH='/usr/local/bin/bicep'\n</code></pre> PowerShell<pre><code>$Env:PSRULE_AZURE_BICEP_PATH = '/usr/local/bin/bicep';\n</code></pre> GitHub Actions<pre><code>env:\n  PSRULE_AZURE_BICEP_PATH: '/usr/local/bin/bicep'\n</code></pre> Azure Pipelines<pre><code>variables:\n- name: PSRULE_AZURE_BICEP_PATH\n  value: '/usr/local/bin/bicep'\n</code></pre>"},{"location":"setup/setup-bicep/#using-azure-cli","title":"Using Azure CLI","text":"<p>By default, PSRule for Azure uses the Bicep CLI directly. An additional option is to use the Azure CLI to invoke the Bicep CLI. When using this option the required version of the CLI must be installed prior to using PSRule for Azure. This is explained in Setup your Bicep development environment.</p> <p>To enable this option, set the <code>PSRULE_AZURE_BICEP_USE_AZURE_CLI</code> environment variable to <code>true</code>.</p> <p>Syntax:</p> Environment variable<pre><code>PSRULE_AZURE_BICEP_USE_AZURE_CLI: boolean\n</code></pre> <p>Default:</p> Environment variable<pre><code>PSRULE_AZURE_BICEP_USE_AZURE_CLI: false\n</code></pre> <p>Example:</p> GitHub ActionsAzure PipelinesPowerShellBash <pre><code>env:\n  PSRULE_AZURE_BICEP_USE_AZURE_CLI: true\n</code></pre> <pre><code>variables:\n- name: PSRULE_AZURE_BICEP_USE_AZURE_CLI\n  value: true\n</code></pre> <pre><code>$Env:PSRULE_AZURE_BICEP_USE_AZURE_CLI = 'true'\n</code></pre> <pre><code>export PSRULE_AZURE_BICEP_USE_AZURE_CLI=true\n</code></pre>"},{"location":"setup/setup-bicep/#additional-arguments","title":"Additional arguments","text":"<p>For configuration, additional arguments can be passed to the Bicep CLI. This is intended to improve forward compatibility with Bicep CLI.</p> <p>To configure additional arguments, set the <code>PSRULE_AZURE_BICEP_ARGS</code> environment variable.</p>"},{"location":"setup/setup-bicep/#configuring-expansion","title":"Configuring expansion","text":"<p> Docs</p> <p>PSRule for Azure can automatically expand Bicep source files. When enabled, PSRule for Azure automatically expands and analyzes Azure resource from <code>.bicep</code> files.</p> <p>To enabled this feature, set the <code>Configuration.AZURE_BICEP_FILE_EXPANSION</code> to <code>true</code>. This option can be set within the <code>ps-rule.yaml</code> file.</p> ps-rule.yaml<pre><code>configuration:\n  # Enable automatic expansion of bicep source files.\n  AZURE_BICEP_FILE_EXPANSION: true\n</code></pre> <p>Tip</p> <p>If you deploy Bicep code using JSON parameter files this option does not need to be set. Set <code>Configuration.AZURE_PARAMETER_FILE_EXPANSION</code> to <code>true</code> instead. See Using parameter files and By metadata for more information.</p>"},{"location":"setup/setup-bicep/#configuring-timeout","title":"Configuring timeout","text":"<p> Docs</p> <p>In certain environments it may be necessary to increase the default timeout for building Bicep files. This can occur if your Bicep deployments are:</p> <ul> <li>Large and complex.</li> <li>Use nested modules.</li> <li>Use modules restored from a registry.</li> </ul> <p>If you are experiencing timeout errors you can increase the default timeout of 5 seconds. To configure the timeout, set <code>Configuration.AZURE_BICEP_FILE_EXPANSION_TIMEOUT</code> to the timeout in seconds.</p> ps-rule.yaml<pre><code>configuration:\n  # Enable automatic expansion of bicep source files.\n  AZURE_BICEP_FILE_EXPANSION: true\n\n  # Configure the timeout for bicep build to 15 seconds.\n  AZURE_BICEP_FILE_EXPANSION_TIMEOUT: 15\n</code></pre>"},{"location":"setup/setup-bicep/#checking-bicep-version","title":"Checking Bicep version","text":"<p>v1.25.0</p> <p>To use Bicep files with PSRule for Azure:</p> <ul> <li>The Bicep CLI must be installed or you must configure the Azure CLI.</li> <li>The version installed  must support the features you are using.</li> </ul> <p>It may not always be clear which version of Bicep CLI is being used if you have multiple versions installed. Additionally, the version installed in your CI/ CD pipeline may not be the same as your local development environment.</p> <p>You can enable checking the Bicep CLI version during initialization. To enable this feature, set the <code>Configuration.AZURE_BICEP_CHECK_TOOL</code> option to <code>true</code>. Additionally, you can set the minimum version required using the <code>Configuration.AZURE_BICEP_MINIMUM_VERSION</code> option.</p> ps-rule.yaml<pre><code>configuration:\n  # Enable Bicep CLI checks.\n  AZURE_BICEP_CHECK_TOOL: true\n\n  # Optionally, configure the minimum version of the Bicep CLI.\n  AZURE_BICEP_MINIMUM_VERSION: '0.16.2'\n</code></pre>"},{"location":"setup/setup-bicep/#configuring-minimum-version","title":"Configuring minimum version","text":"<p>v1.25.0</p> <p>The Azure Bicep CLI is updated regularly, with new features and bug fixes. You must use a version of the Bicep CLI that supports the features you are using. If you attempt to use a feature that is not supported by the Bicep CLI, expansion will fail with a BCP error.</p> <p>Tip</p> <p>It may not always be clear which version of Bicep CLI is being used if you have multiple versions installed. Using the Bicep CLI via <code>az bicep</code> is not the default, and you may need to set additional options to use it.</p> <p>To ensure you are using the correct version of the Bicep CLI, you can configure the minimum version required. If an earlier version is detected, PSRule for Azure will generate an error. To configure the minimum version, set the <code>Configuration.AZURE_BICEP_MINIMUM_VERSION</code> option. By default, the minimum version is set to <code>0.4.451</code>.</p> ps-rule.yaml<pre><code>configuration:\n  # Enable Bicep CLI checks.\n  AZURE_BICEP_CHECK_TOOL: true\n\n  # Configure the minimum version of the Bicep CLI.\n  AZURE_BICEP_MINIMUM_VERSION: '0.16.2'\n</code></pre> <p>Important</p> <p>The <code>Configuration.AZURE_BICEP_CHECK_TOOL</code> must be set to <code>true</code> for this option to take effect.</p> <p>Tip</p> <p>For troubleshooting Bicep compilation errors see Bicep compile errors.</p>"},{"location":"setup/setup-bicep/#recommended-content","title":"Recommended content","text":"<ul> <li>Using Bicep source</li> <li>Restoring modules from a private registry</li> </ul>"}]}