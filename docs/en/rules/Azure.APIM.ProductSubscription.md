---
reviewed: 2023-12-05
severity: Important
pillar: Security
category: SE:05 Identity and access management
resource: API Management
resourceType: Microsoft.ApiManagement/service,Microsoft.ApiManagement/service/products
online version: https://azure.github.io/PSRule.Rules.Azure/en/rules/Azure.APIM.ProductSubscription/
---

# Require a subscription for products

## SYNOPSIS

Configure products to require a subscription.

## DESCRIPTION

When publishing APIs through Azure API Management (APIM), APIs can optionally be assigned to products.
Products are a grouping and management construct within API Management.
API Management uses products:

- To organize APIs and make them available to developers via the developer portal.
  For an API to be discoverable within the developer portal, it must be assigned to a published product.
- To control access and assign policies to APIs with subscription keys.
  Subscription keys are a form of credential secret that is used to authenticate a client application to an API.
  Examples of policies include throttling, caching, and transformation.

Requiring subscriptions on products and requiring approval is an _optional_ security control within API Management.
However, for authorizing access to APIs it is recommended to use stronger forms of authorization such as OAuth 2.0.

Using subscriptions and approval on products helps by:

- Reducing the risk of unintended exposure of APIs.
- Allowing organization governance processes to ensure any issued subscription keys are stored securely, rotated, and expired.

If a product does not require subscriptions (called an open product):

- Any API assigned to that product can be called without a subscription key.
  This applies even if the API is configured to require a subscription key.

If a product requires subscriptions, but does not require approval:

- A subscription key can be generated by any developer portal user with permission to the product.

## RECOMMENDATION

Consider configuring all API Management products to require a subscription.

## EXAMPLES

### Configure with Azure template

To deploy API Management Products that pass this rule:

- Set the `properties.subscriptionRequired` property to `true`.

For example:

```json
{
  "type": "Microsoft.ApiManagement/service/products",
  "apiVersion": "2022-08-01",
  "name": "[format('{0}/{1}', parameters('name'), 'echo')]",
  "properties": {
    "displayName": "Echo",
    "description": "Echo API services for Contoso.",
    "approvalRequired": true,
    "subscriptionRequired": true
  },
  "dependsOn": [
    "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
  ]
}
```

### Configure with Bicep

To deploy API Management Products that pass this rule:

- Set the `properties.subscriptionRequired` property to `true`.

For example:

```bicep
resource product 'Microsoft.ApiManagement/service/products@2022-08-01' = {
  parent: service
  name: 'echo'
  properties: {
    displayName: 'Echo'
    description: 'Echo API services for Contoso.'
    approvalRequired: true
    subscriptionRequired: true
  }
}
```

## LINKS

- [SE:05 Identity and access management](https://learn.microsoft.com/azure/well-architected/security/identity-access#protect-nonidentity-based-secrets)
- [Create and publish a product](https://learn.microsoft.com/azure/api-management/api-management-howto-add-products)
- [Subscriptions in Azure API Management](https://learn.microsoft.com/azure/api-management/api-management-subscriptions)
- [Azure deployment reference](https://learn.microsoft.com/azure/templates/microsoft.apimanagement/service/products)
