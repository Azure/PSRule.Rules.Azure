{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# PSRule - For Azure Workbook\r\n\r\nPSRule for Azure scans Azure Infrastructure as Code (IaC) templates/modules and evaluates the state of the templates (`Bicep` and `ARM`) against the Azure Well-Architected Framework.  To see any data information must be ingested into an Azure Monitor Log Analytics Workspace. For instructions on setup please see [Setup Azure Monitor logs](https://aka.ms/ps-rule-azure/monitor). \r\n\r\nFor information on the rules that are being Assessed click [here](https://azure.github.io/PSRule.Rules.Azure/en/rules/).\r\n\r\n<br>"
      },
      "name": "overview-md"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "value::all"
        ],
        "parameters": [
          {
            "id": "2b958e92-76ef-4959-9c0a-952c33937378",
            "version": "KqlParameterItem/1.0",
            "name": "Timeframe",
            "type": 4,
            "value": {
              "durationMs": 1209600000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ]
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "ce553086-e775-4f62-917e-1919e9a347b9",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type =~ \"Microsoft.OperationalInsights/workspaces\"\r\n| project id",
            "crossComponentResources": [
              "value::all"
            ],
            "value": [],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": true
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "workspaceParameter"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "c2a59c6d-d666-4466-bd5c-3e869e76e57c",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Overview",
            "subTarget": "overview",
            "style": "link"
          },
          {
            "id": "1bd72894-4391-4c0c-aec7-f8c7c2cf2852",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Cost",
            "subTarget": "Cost Optimization",
            "style": "link"
          },
          {
            "id": "ac6177f3-c155-4813-a62d-cb826efc78ca",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Reliability",
            "subTarget": "Reliability",
            "style": "link"
          },
          {
            "id": "a4bf3088-d565-4da8-9f5b-e840d91cd51e",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Operational Excellence",
            "subTarget": "Operational Excellence",
            "style": "link"
          },
          {
            "id": "991a6150-fa73-44d3-b582-c7bfad3a6d53",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Performance",
            "subTarget": "Performance Efficiency",
            "style": "link"
          },
          {
            "id": "99df98be-e4bc-4b16-8c72-7850b1e6935d",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Security",
            "subTarget": "Security",
            "style": "link"
          }
        ]
      },
      "name": "links - 6"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project org_parsed=split(RunId_s, '/')\r\n| extend organisation = tostring(org_parsed[0])\r\n| distinct organisation\r\n| summarize count()\r\n",
              "size": 4,
              "title": "ADO/Github - Orgs",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "card",
              "textSettings": {
                "style": "bignumber"
              }
            },
            "customWidth": "10",
            "name": "cicd-tool-org-count"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project CorrelationId\r\n| distinct CorrelationId\r\n| summarize count()",
              "size": 4,
              "title": "Total - Pipeline Runs",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "card",
              "textSettings": {
                "style": "bignumber"
              }
            },
            "customWidth": "10",
            "name": "total-pipeline-executions"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project TargetName_s\r\n| distinct TargetName_s\r\n| summarize Bicep = countif(TargetName_s contains '.bicep')",
              "size": 4,
              "title": "Total - Bicep Modules",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "card",
              "sortBy": [],
              "textSettings": {
                "style": "bignumber"
              }
            },
            "customWidth": "12",
            "name": "total-bicep-files-scanned"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project TargetName_s\r\n| distinct TargetName_s\r\n| summarize ARM = countif(TargetName_s endswith 'template.json')",
              "size": 4,
              "title": "Total - ARM Templates",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "card",
              "sortBy": [],
              "textSettings": {
                "style": "bignumber"
              }
            },
            "customWidth": "12",
            "name": "total-json-files"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project Outcome_s, TargetName_s\r\n| where TargetName_s !endswith 'parameters.json'\r\n| summarize count() by Outcome_s",
              "size": 0,
              "title": "Total - Rules Assessedby Results",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Pass",
                    "color": "green"
                  },
                  {
                    "seriesName": "Fail",
                    "color": "redBright"
                  }
                ],
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  }
                }
              }
            },
            "customWidth": "30",
            "name": "outcomes-summary"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project Annotations_s, Outcome_s, TargetName_s\r\n| where TargetName_s !endswith 'parameters.json'\r\n| where Annotations_s != \"\"\r\n| extend annotations=parsejson(Annotations_s)\r\n| summarize Total = count(), Pass = countif(Outcome_s == \"Pass\"), Fail = countif(Outcome_s == \"Fail\")  by Pillars = tostring(annotations.pillar)\r\n",
              "size": 0,
              "title": "Outcomes by Pillar",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Total",
                    "formatter": 22,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "Pass",
                            "color": "green"
                          },
                          {
                            "columnName": "Fail",
                            "color": "redBright"
                          }
                        ]
                      },
                      "customColumnWidthSetting": "50%"
                    }
                  },
                  {
                    "columnMatch": "Pass",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Fail",
                    "formatter": 5
                  }
                ]
              },
              "chartSettings": {
                "group": "count_Outcome_s",
                "createOtherGroup": null
              }
            },
            "customWidth": "25",
            "name": "overview-outcomes-by-pillar"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project Annotations_s, TargetName_s\r\n| where Annotations_s != \"\"\r\n| where TargetName_s !endswith '.json' and TargetName_s !endswith '.bicep'\r\n| extend annotations=parsejson(Annotations_s)\r\n| summarize count() by tostring(annotations.severity)\r\n\r\n",
              "size": 0,
              "title": "Total Severities by Resources",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Awareness",
                    "color": "gray"
                  },
                  {
                    "seriesName": "Important",
                    "color": "orange"
                  },
                  {
                    "seriesName": "Critical",
                    "color": "redBright"
                  }
                ]
              }
            },
            "customWidth": "30",
            "name": "total-by-severities"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project Annotations_s, TargetName_s, TargetType_s\r\n| where Annotations_s != \"\"\r\n| where TargetName_s !endswith '.json' and TargetName_s !endswith '.bicep'\r\n| extend annotations=parsejson(Annotations_s)\r\n| extend online_version_ = tostring(parse_json(Annotations_s).[\"online version\"])\r\n| summarize by Resource = TargetName_s, ResourceType = TargetType_s, Severity = tostring(annotations.severity), Pillar = tostring(annotations.pillar), Recommendation = online_version_\r\n\r\n\r\n",
              "size": 0,
              "title": "Severities By Resources - Detailed",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20%"
                    }
                  },
                  {
                    "columnMatch": "ResourceType",
                    "formatter": 16,
                    "formatOptions": {
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Pillar",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Recommendation",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkIsContextBlade": false
                    }
                  },
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20%"
                    }
                  }
                ],
                "rowLimit": 10000,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "Severity",
                    "Pillar"
                  ]
                }
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "RuleName_s",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "count_",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "70",
            "name": "total-severities-detailed"
          },
          {
            "type": 1,
            "content": {
              "json": "# Maturity Over Time\r\n\r\nThe following tables visualize the results over time. This can be useful to:\r\n\r\n- Understand growth of the IAC repository\r\n- Failed outcomes over time (how frequently are templates failing assessments)\r\n- Transition from ARM to Bicep modules\r\n\r\n",
              "style": "info"
            },
            "customWidth": "20",
            "name": "text - 11"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project Outcome_s, TimeGenerated, TargetName_s\r\n| where TargetName_s !endswith 'parameters.json'\r\n| summarize count() by Outcome_s, bin(TimeGenerated, 1h)\r\n",
              "size": 0,
              "title": "Outcomes - Overtime",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "timechart",
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "RuleName_s",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "count_",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Pass",
                    "color": "green"
                  },
                  {
                    "seriesName": "Fail",
                    "color": "redBright"
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "outcomes-overtime"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project TargetName_s, TimeGenerated\r\n| distinct TargetName_s, TimeGenerated\r\n| summarize ARM = countif (TargetName_s endswith 'template.json'), Bicep = countif (TargetName_s endswith '.bicep') by bin(TimeGenerated, 24h)\r\n//| summarize dcount(TargetName_s)\r\n\r\n\r\n",
              "size": 0,
              "title": "IAC Type Assessed - Overtime",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "timechart",
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "RuleName_s",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "count_",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "dcount_TargetName_s",
                    "label": "IAC Files"
                  },
                  {
                    "seriesName": "Bicep",
                    "color": "magenta"
                  }
                ],
                "xSettings": {
                  "numberFormatSettings": {
                    "unit": 17,
                    "options": {
                      "style": "percent",
                      "useGrouping": true
                    }
                  }
                }
              }
            },
            "customWidth": "40",
            "name": "files-assessed-overtime"
          },
          {
            "type": 1,
            "content": {
              "json": "# Resource Types\r\n\r\nInsights into the type of IAC Templates that are scanned / availabile in these IAC repositories.",
              "style": "info"
            },
            "customWidth": "20",
            "name": "text - 11"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project TargetType_s, TimeGenerated, TargetName_s\r\n| where TargetName_s !endswith '.json' and TargetName_s !endswith '.bicep'\r\n| summarize by ResourceType = TargetType_s\r\n| distinct ResourceType\r\n| order by ResourceType desc\r\n//| summarize count() by TargetName_s, bin(TimeGenerated, 24h)\r\n\r\n\r\n",
              "size": 0,
              "title": "ResourceTypes Assessed",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ResourceType",
                    "formatter": 16,
                    "formatOptions": {
                      "showIcon": true,
                      "customColumnWidthSetting": "100%"
                    }
                  }
                ]
              },
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "TargetType_s",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "RuleName_s",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "count_",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "dcount_TargetName_s",
                    "label": "IAC Files"
                  },
                  {
                    "seriesName": "Bicep",
                    "color": "magenta"
                  }
                ],
                "xSettings": {
                  "numberFormatSettings": {
                    "unit": 17,
                    "options": {
                      "style": "percent",
                      "useGrouping": true
                    }
                  }
                }
              }
            },
            "customWidth": "20",
            "name": "iac-templates-by-resourcetype"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project TargetType_s, TargetName_s, TimeGenerated\r\n| where TargetName_s !endswith '.json' and TargetName_s !endswith '.bicep'\r\n| distinct TargetType_s, TimeGenerated\r\n| summarize count() by ResourceType = TargetType_s, bin(TimeGenerated, 24h)\r\n\r\n\r\n\r\n",
              "size": 0,
              "title": "Resources Assessed By Resource Type - Overtime",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "timechart",
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "TargetType_s",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "RuleName_s",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "count_",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "dcount_TargetName_s",
                    "label": "IAC Files"
                  },
                  {
                    "seriesName": "Bicep",
                    "color": "magenta"
                  }
                ],
                "xSettings": {
                  "numberFormatSettings": {
                    "unit": 17,
                    "options": {
                      "style": "percent",
                      "useGrouping": true
                    }
                  }
                }
              }
            },
            "customWidth": "60",
            "name": "resourcetypes-assessed-total"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "overview"
      },
      "name": "overview"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Well Architected Framework - Pillar Maturity\r\n\r\nThe following panels display detailed information about the maturity of the Infrastructure As Code scanned by PSRule for Azure by Pillar."
            },
            "name": "text - 3"
          },
          {
            "type": 1,
            "content": {
              "json": "# {selectedTab} - Pillar\r\n\r\nThe {selectedTab} Pillar provides guidance around governing costs of resources in the Cloud. This includes checklists, principals and tradeoffs.\r\n\r\nFor more information about this pillar: \r\n\r\n- [Well-Archited Framework - {selectedTab}](https://docs.microsoft.com/azure/architecture/framework/#cost-optimization)\r\n- [PSRule for Azure {selectedTab} Rules](https://azure.github.io/PSRule.Rules.Azure/en/rules/module/#cost-optimization)\r\n\r\n<br>"
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Cost Optimization"
            },
            "name": "cost-pillar-md"
          },
          {
            "type": 1,
            "content": {
              "json": "# {selectedTab} - Pillar\r\n\r\nThe {selectedTab} Pillar provides guidance around building highly resiliency solutions in Azure. It details recommendations for different services and best practices for ensuring solutions are as resilient as possible. \r\n\r\nFor more information about this pillar: \r\n\r\n- [Well-Archited Framework - {selectedTab}](https://docs.microsoft.com/azure/architecture/framework/resiliency)\r\n- [PSRule for Azure {selectedTab} Rules](https://azure.github.io/PSRule.Rules.Azure/en/rules/module/#reliability)\r\n\r\n<br>"
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Reliability"
            },
            "name": "reliability-pillar-md"
          },
          {
            "type": 1,
            "content": {
              "json": "# {selectedTab} - Pillar\r\n\r\nThe {selectedTab} Pillar provides guidance and best practices for securing resources running in Azure. It details recommendations for different services and checklists to increase the security of a solution. \r\n\r\nFor more information about this pillar: \r\n\r\n- [Well-Archited Framework - {selectedTab}](https://docs.microsoft.com/azure/architecture/framework/security/)\r\n- [PSRule for Azure {selectedTab} Rules](https://azure.github.io/PSRule.Rules.Azure/en/rules/module/#security)\r\n\r\n<br>"
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Security"
            },
            "name": "security-pillar-md"
          },
          {
            "type": 1,
            "content": {
              "json": "# {selectedTab} - Pillar\r\n\r\nThe {selectedTab} Pillar provides guidance and best practices for optimising a solution for performance. This includes tips for horizontally scaling and which services to pick for the best performance. \r\n\r\nFor more information about this pillar: \r\n\r\n- [Well-Archited Framework - {selectedTab}](https://docs.microsoft.com/azure/architecture/framework/scalability/)\r\n- [PSRule for Azure {selectedTab} Rules](https://azure.github.io/PSRule.Rules.Azure/en/rules/module/#performance-efficiency)\r\n\r\n<br>"
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Performance Efficiency"
            },
            "name": "performance-pillar-md"
          },
          {
            "type": 1,
            "content": {
              "json": "# {selectedTab} - Pillar\r\n\r\nThe {selectedTab} Pillar provides guidance on operational excellency.\r\n\r\nFor more information about this pillar: \r\n\r\n- [Well-Archited Framework - {selectedTab}](https://docs.microsoft.com/azure/architecture/framework/devops/)\r\n- [PSRule for Azure {selectedTab} Rules](https://azure.github.io/PSRule.Rules.Azure/en/rules/module/#operational-excellence)\r\n\r\n<br>"
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Operational Excellence"
            },
            "name": "operational-pillar-md"
          },
          {
            "type": 1,
            "content": {
              "json": "# Rules Assessed\r\n\r\nThese are the PSRule for Azure rules for the pillar {selectedTab} that were scanned. ",
              "style": "info"
            },
            "customWidth": "20",
            "name": "rules-asssessed-md"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project Annotations_s, Outcome_s\r\n| extend annotations=parsejson(Annotations_s)\r\n| where annotations.pillar == \"{selectedTab}\"\r\n| summarize count() by Outcome_s",
              "size": 0,
              "title": "Total - Rules assessed by result",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Pass",
                    "color": "green"
                  },
                  {
                    "seriesName": "Fail",
                    "color": "redBright"
                  }
                ],
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  }
                }
              }
            },
            "customWidth": "30",
            "name": "outcomes-summary"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project Annotations_s, Outcome_s, TimeGenerated\r\n| extend annotations=parsejson(Annotations_s)\r\n| where annotations.pillar == \"{selectedTab}\"\r\n| extend annotations=parsejson(Annotations_s)\r\n| summarize count() by Outcome_s, bin(TimeGenerated, 1h)\r\n",
              "size": 0,
              "title": "Outcomes - Overtime",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "timechart",
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "RuleName_s",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "count_",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Pass",
                    "color": "green"
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "result-assessed-overtime"
          },
          {
            "type": 1,
            "content": {
              "json": "# Outcomes By Severity\r\n\r\nThere's 3 severity levels PSRule will alert on:\r\n\r\n- **Critical:**\r\n- **Important:**\r\n- **Awareness:**",
              "style": "info"
            },
            "customWidth": "20",
            "name": "outcomes-by-severity-md"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project Annotations_s\r\n| where Annotations_s != \"\"\r\n| extend annotations=parsejson(Annotations_s)\r\n| where annotations.pillar == \"{selectedTab}\"\r\n| extend annotations=parsejson(Annotations_s)\r\n| summarize count() by tostring(annotations.severity)\r\n",
              "size": 0,
              "title": "Total - By Severity",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Awareness",
                    "color": "gray"
                  },
                  {
                    "seriesName": "Important",
                    "color": "orange"
                  },
                  {
                    "seriesName": "Critical",
                    "color": "redBright"
                  }
                ]
              }
            },
            "customWidth": "30",
            "name": "total-by-severity"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project Annotations_s, TimeGenerated\r\n| where Annotations_s != \"\"\r\n| extend annotations=parsejson(Annotations_s)\r\n| where annotations.pillar == \"{selectedTab}\"\r\n| extend annotations=parsejson(Annotations_s)\r\n| summarize count() by tostring(annotations.severity), bin(TimeGenerated, 1h)\r\n",
              "size": 0,
              "title": "Total - By Severity",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "timechart",
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Awareness",
                    "color": "gray"
                  },
                  {
                    "seriesName": "Important",
                    "color": "orange"
                  },
                  {
                    "seriesName": "Critical",
                    "color": "redBright"
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "total-by-severity-overtime"
          },
          {
            "type": 1,
            "content": {
              "json": "# Outcomes By Category\r\n\r\nEach rule that is scanned is categorised. This provides additional insights into the template maturity. ",
              "style": "info"
            },
            "customWidth": "20",
            "name": "outcomes-by-category-md"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project Annotations_s, Outcome_s\r\n| extend annotations=parsejson(Annotations_s)\r\n| where annotations.pillar == \"{selectedTab}\"\r\n| summarize Total = count(), Pass = countif(Outcome_s == \"Pass\"), Fail = countif(Outcome_s == \"Fail\") by tostring(annotations.category)\r\n| order by Total",
              "size": 0,
              "title": "Outcomes by Category",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Total",
                    "formatter": 22,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "Pass",
                            "color": "green"
                          },
                          {
                            "columnName": "Fail",
                            "color": "redBright"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "Pass",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Fail",
                    "formatter": 5
                  }
                ]
              },
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "annotations_category",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Total",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "RuleName_s",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "count_",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "30",
            "name": "outcomes-by-category"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project Annotations_s, Outcome_s, TimeGenerated\r\n| extend annotations=parsejson(Annotations_s)\r\n| where annotations.pillar == \"{selectedTab}\"\r\n| summarize Total = count() by tostring(annotations.category), bin(TimeGenerated, 1h)\r\n| order by Total",
              "size": 0,
              "title": "Outcomes by Category",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "timechart",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Total",
                    "formatter": 22,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "Pass",
                            "color": "green"
                          },
                          {
                            "columnName": "Fail",
                            "color": "redBright"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "Pass",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Fail",
                    "formatter": 5
                  }
                ]
              },
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "annotations_category",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Total",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "RuleName_s",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "count_",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "50",
            "name": "outcomes-by-category-overtime"
          },
          {
            "type": 1,
            "content": {
              "json": "# Detailed Analysis\r\n\r\nThe panels to the right provides a deep dive into the telemetry by severity. This allows you to examine the specific recommendations for each resource and each IAC template / module. \r\n",
              "style": "info"
            },
            "customWidth": "20",
            "name": "detailed-anaylisis-md"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project Annotations_s, TargetName_s, TargetType_s\r\n| where Annotations_s != \"\"\r\n| where TargetName_s !endswith '.json' and TargetName_s !endswith '.bicep'\r\n| extend annotations=parsejson(Annotations_s)\r\n| where annotations.pillar == \"{selectedTab}\"\r\n| extend online_version_ = tostring(parse_json(Annotations_s).[\"online version\"])\r\n| summarize by Resource = TargetName_s, ResourceType = TargetType_s, Severity =  tostring(annotations.severity), tostring(annotations.category), Recommendation = online_version_\r\n\r\n\r\n",
              "size": 0,
              "title": "Resources by Severity",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20%"
                    }
                  },
                  {
                    "columnMatch": "ResourceType",
                    "formatter": 16,
                    "formatOptions": {
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "annotations_category",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Recommendation",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "customColumnWidthSetting": "35%"
                    }
                  },
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20%"
                    }
                  },
                  {
                    "columnMatch": "annotations_severity",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "Severity",
                    "annotations_category"
                  ]
                }
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "RuleName_s",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "count_",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "80",
            "name": "result-by-severity-detailed"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "20",
            "name": "text - 17"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PSRule_CL\r\n| project Annotations_s, TargetName_s, TargetType_s\r\n| where Annotations_s != \"\"\r\n| where TargetName_s endswith '.json' or TargetName_s endswith '.bicep'\r\n| extend annotations=parsejson(Annotations_s)\r\n| extend fileGitHubParse = replace_string(TargetName_s, '/home/runner/work/*/', '')\r\n| extend fileADOParse = replace_string(fileGitHubParse, '/home/vsts/work/1/s/', '')\r\n| extend parsedFileName = fileADOParse\r\n| extend online_version_ = tostring(parse_json(Annotations_s).[\"online version\"])\r\n| where annotations.pillar == \"{selectedTab}\"\r\n| summarize by File = parsedFileName, ResourceType = TargetType_s, Severity =  tostring(annotations.severity), Category = tostring(annotations.category), Recommendation = online_version_\r\n| distinct File, Severity, Category, Recommendation\r\n\r\n\r\n",
              "size": 0,
              "title": "IAC Files by Severity",
              "noDataMessage": "No severities found.",
              "timeContextFromParameter": "Timeframe",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20%"
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResourceType",
                    "formatter": 16,
                    "formatOptions": {
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Recommendation",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "customColumnWidthSetting": "35%"
                    }
                  },
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20%"
                    }
                  },
                  {
                    "columnMatch": "annotations_category",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "annotations_severity",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "Severity",
                    "Category"
                  ]
                }
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "RuleName_s",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "count_",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "80",
            "name": "result-by-file-severity-detailed"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isNotEqualTo",
        "value": "overview"
      },
      "name": "pillars"
    }
  ],
  "fallbackResourceIds": [
    "azure monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
